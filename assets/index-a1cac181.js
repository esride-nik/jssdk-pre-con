(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}})();function h(t,e,r,i){var s,n=arguments.length,o=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,r,o):s(e,r))||o);return n>3&&o&&Object.defineProperty(e,r,o),o}function cpt(t,e,r,i){function s(n){return n instanceof r?n:new r(function(o){o(n)})}return new(r||(r=Promise))(function(n,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?n(u.value):s(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})}const Nxe="modulepreload",Fxe=function(t,e){return new URL(t,e).href},lq={},he=function(e,r,i){if(!r||r.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(r.map(n=>{if(n=Fxe(n,i),n in lq)return;lq[n]=!0;const o=n.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let u=s.length-1;u>=0;u--){const d=s[u];if(d.href===n&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":Nxe,o||(c.as="script",c.crossOrigin=""),c.href=n,document.head.appendChild(c),o)return new Promise((u,d)=>{c.addEventListener("load",u),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e()).catch(n=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n})};let d0;function te(t){return typeof d0[t]=="function"?d0[t]=d0[t](globalThis):d0[t]}var fse,mse,gse,yse;d0=(fse=globalThis.dojoConfig)!=null&&fse.has||(mse=globalThis.esriConfig)!=null&&mse.has?{...(gse=globalThis.dojoConfig)==null?void 0:gse.has,...(yse=globalThis.esriConfig)==null?void 0:yse.has}:{},te.add=(t,e,r,i)=>((i||d0[t]===void 0)&&(d0[t]=e),r&&te(t)),te.cache=d0,te.add("big-integer-warning-enabled",!0),te.add("esri-deprecation-warnings",!0),te.add("esri-tests-disable-screenshots",!1),te.add("esri-tests-use-full-window",!1),te.add("esri-tests-post-to-influx",!0),(()=>{var e;te.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(te.add("host-browser",t),te.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),te.add("dom",t),te("host-browser")){const r=navigator,i=r.userAgent,s=r.appVersion,n=parseFloat(s);if(te.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),te.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),te.add("khtml",s.includes("Konqueror")?n:void 0),te.add("edge",parseFloat(i.split("Edge/")[1])||void 0),te.add("opr",parseFloat(i.split("OPR/")[1])||void 0),te.add("webkit",!te("wp")&&!te("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),te.add("chrome",!te("edge")&&!te("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),te.add("android",!te("wp")&&parseFloat(i.split("Android ")[1])||void 0),te.add("safari",!s.includes("Safari")||te("wp")||te("chrome")||te("android")||te("edge")||te("opr")?void 0:parseFloat(s.split("Version/")[1])),te.add("mac",s.includes("Macintosh")),!te("wp")&&/(iPhone|iPod|iPad)/.test(i)){const o=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(i)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replaceAll("_",""));te.add(o,l),te.add("ios",l)}te("webkit")||(!i.includes("Gecko")||te("wp")||te("khtml")||te("edge")||te.add("mozilla",n),te("mozilla")&&te.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),r=/iPhone/i.test(t);e&&te.add("esri-mobile",e),r&&te.add("esri-iPhone",r),te.add("esri-geolocation",!!navigator.geolocation)}te.add("esri-wasm","WebAssembly"in globalThis),te.add("esri-performance-mode-frames-between-render",20),te.add("esri-force-performance-mode",!1),te.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),te.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),te.add("esri-atomics","Atomics"in globalThis),te.add("esri-workers","Worker"in globalThis),te.add("web-feat:cache","caches"in globalThis),te.add("esri-workers-arraybuffer-transfer",!te("safari")||Number(te("safari"))>=12),te.add("workers-pool-size",8),te.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),te.add("featurelayer-simplify-payload-size-factors",[1,1,4]),te.add("featurelayer-animation-enabled",!0),te.add("featurelayer-snapshot-enabled",!0),te.add("featurelayer-snapshot-point-min-threshold",8e4),te.add("featurelayer-snapshot-point-max-threshold",4e5),te.add("featurelayer-snapshot-point-coverage",.1),te.add("featurelayer-advanced-symbols",!1),te.add("featurelayer-pbf",!0),te.add("featurelayer-pbf-statistics",!1),te.add("feature-layers-workers",!0),te.add("feature-polyline-generalization-factor",1),te.add("mapview-transitions-duration",200),te.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),te.add("mapserver-pbf-version-support",10.81),te.add("mapservice-popup-identify-max-tolerance",20),te.add("heatmap-allow-raster-fallback",!1),te.add("heatmap-force-raster",!1),te("host-webworker")||te("host-browser")&&(te.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),te.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{te.add("esri-image-decode",!0,!0,!0)}).catch(()=>{te.add("esri-image-decode",!1,!0,!0)})}return!1}),te.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();let gE=class h_{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*h_._m}getInt(){return this._seed=(h_._a*this._seed+h_._c)%h_._m,this._seed}getFloat(){return this.getInt()/(h_._m-1)}getIntRange(e,r){return Math.round(this.getFloatRange(e,r))}getFloatRange(e,r){const i=r-e;return e+this.getInt()/h_._m*i}};gE._m=2147483647,gE._a=48271,gE._c=0;const OL=1.5,Uxe=1/OL,kxe=.5;function PL(t,e){return e?t.filter((r,i,s)=>s.findIndex(e.bind(null,r))===i):Array.from(new Set(t))}function pm(t,e,r){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function Nz(t,e){let r=t.length!==e.length;r&&(t.length=e.length);for(let i=0;i<e.length;++i)t[i]!==e[i]&&(t[i]=e[i],r=!0);return r}function Bxe(t,e,r){let i,s;return r?(i=e.filter(n=>!t.some(o=>r(o,n))),s=t.filter(n=>!e.some(o=>r(o,n)))):(i=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:i,removed:s}}function zxe(t){return t&&typeof t.length=="number"}function upt(t,e){const r=t.length;if(r===0)return[];const i=[];for(let s=0;s<r;s+=e)i.push(t.slice(s,s+e));return i}const Vxe=!!Array.prototype.fill;function hpt(t,e){if(Vxe)return new Array(t).fill(e);const r=new Array(t);for(let i=0;i<t;i++)r[i]=e;return r}function Gxe(t,e){e===void 0&&(e=t,t=0);const r=new Array(e-t);for(let i=t;i<e;i++)r[i-t]=i;return r}function jxe(t,e,r){const i=t.length;let s=0,n=i-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return r?e>=t[i-1]?-1:o===e?s:s-1:o===e?s:-1}let xse=class{constructor(){this.last=0}};const Tse=new xse;function j6(t,e,r,i){i=i||Tse;const s=Math.max(0,i.last-10);for(let o=s;o<r;++o)if(t[o]===e)return i.last=o,o;const n=Math.min(s,r);for(let o=0;o<n;++o)if(t[o]===e)return i.last=o,o;return-1}function gC(t,e,r,i){const s=r??t.length,n=j6(t,e,s,i);if(n!==-1)return t[n]=t[s-1],r==null&&t.pop(),e}const qu=new Set;function Hxe(t,e,r=t.length,i=e.length,s,n){if(i===0||r===0)return r;qu.clear();for(let a=0;a<i;++a)qu.add(e[a]);s=s||Tse;const o=Math.max(0,s.last-10);for(let a=o;a<r;++a)if(qu.has(t[a])&&(n==null||n.push(t[a]),qu.delete(t[a]),t[a]=t[r-1],--r,--a,qu.size===0||r===0))return qu.clear(),r;for(let a=0;a<o;++a)if(qu.has(t[a])&&(n==null||n.push(t[a]),qu.delete(t[a]),t[a]=t[r-1],--r,--a,qu.size===0||r===0))return qu.clear(),r;return qu.clear(),r}function qxe(t,e){let r=0;for(let i=0;i<t.length;++i){const s=t[i];e(s,i)&&(t[r]=s,r++)}t.length=r}function Wxe(t){return t?(cq.seed=t,()=>cq.getFloat()):Math.random}function ppt(t,e){const r=Wxe(e);for(let i=t.length-1;i>0;i--){const s=Math.floor(r()*(i+1)),n=t[i];t[i]=t[s],t[s]=n}return t}const cq=new gE;function Fz(t,e){const r=t.indexOf(e);return r!==-1?(t.splice(r,1),e):null}function fpt(t,e){const r=new Map,i=t.length;for(let s=0;s<i;s++){const n=t[s],o=e(n,s,t),a=r.get(o);a?a.push(n):r.set(o,[n])}return r}function v3(t,e){return t!=null}const Yxe=[];function Sse(t){return 32+t.length}function Uz(){return 16}function Ese(t){if(!t)return 0;let e=Rse;for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];switch(typeof i){case"string":e+=Sse(i);break;case"number":e+=Uz();break;case"boolean":e+=4}}return e}function Cse(t){if(!t)return 0;if(Array.isArray(t))return Xxe(t);let e=Rse;for(const r in t)t.hasOwnProperty(r)&&(e+=Ase(t[r]));return e}function Xxe(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let r=Ose;for(let i=0;i<e;i++)r+=Ase(t[i]);return r}function Ase(t){switch(typeof t){case"object":return Cse(t);case"string":return Sse(t);case"number":return Uz();case"boolean":return 4;default:return 8}}function Zxe(t,e){return Ose+t.length*e}const Rse=32,Ose=32;function YT(t){return t instanceof ArrayBuffer}function kz(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int8Array"}function p0(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8Array"}function Pse(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8ClampedArray"}function Bz(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int16Array"}function ML(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint16Array"}function zz(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int32Array"}function $L(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint32Array"}function y2(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float32Array"}function _2(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float64Array"}function Cu(t){return!("buffer"in t)}function F0(...t){return t.reduce((e,r)=>e+(r?Cu(r)?Zxe(r,Uz()):r.byteLength+Mse:0),0)}const Mse=145,Oc=1024;function Jxe(t){return _2(t)||y2(t)||zz(t)||Bz(t)||kz(t)}function Qxe(t){return _2(t)||y2(t)}function Kxe(t){return _2(t)?179769e303:y2(t)?3402823e32:$L(t)?4294967295:ML(t)?65535:p0(t)||Pse(t)?255:zz(t)?2147483647:Bz(t)?32767:kz(t)?127:256}function $se(t,e){let r;if(e)for(r in t)t.hasOwnProperty(r)&&(t[r]===void 0?delete t[r]:t[r]instanceof Object&&$se(t[r],!0));else for(r in t)t.hasOwnProperty(r)&&t[r]===void 0&&delete t[r];return t}function ye(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=Dse(t);if(e!=null)return e;if(i$(t))return t.clone();if(Ise(t))return t.map(ye);if(Lse(t))return t.clone();const r={};for(const i of Object.getOwnPropertyNames(t))r[i]=ye(t[i]);return r}function H6(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=Dse(t);if(e!=null)return e;if(Ise(t)){let r=!0;const i=t.map(s=>{const n=H6(s);return s!=null&&n==null&&(r=!1),n});return r?i:null}if(i$(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!Lse(t)){const r=new(Object.getPrototypeOf(t)).constructor;for(const i of Object.getOwnPropertyNames(t)){const s=t[i],n=H6(s);if(s!=null&&n==null)return null;r[i]=n}return r}return null}function i$(t){return typeof t.clone=="function"}function Ise(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function Lse(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function uq(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function Dse(t){if(kz(t)||p0(t)||Pse(t)||Bz(t)||ML(t)||zz(t)||$L(t)||y2(t)||_2(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[r,i]of t)e.set(r,ye(i));return e}if(t instanceof Set){const e=new Set;for(const r of t)e.add(ye(r));return e}return null}function Vz(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t==null?void 0:t.getTime)=="function"&&typeof(e==null?void 0:e.getTime)=="function"&&t.getTime()===e.getTime()||!1}function Nse(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&pm(t,e):t instanceof Set?e instanceof Set&&t2e(t,e):t instanceof Map?e instanceof Map&&r2e(t,e):!!uq(t)&&uq(e)&&e2e(t,e))}function e2e(t,e){if(t===null||e===null)return!1;const r=Object.keys(t);if(e===null||Object.keys(e).length!==r.length)return!1;for(const i of r)if(t[i]!==e[i]||!Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function t2e(t,e){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function r2e(t,e){if(t.size!==e.size)return!1;for(const[r,i]of t){const s=e.get(r);if(s!==i||s===void 0&&!e.has(r))return!1}return!0}function i2e(t,e,r=!1){return Use(t,e,r)}function b3(t,e){if(e!=null)return e[t]||Fse(t.split("."),!1,e)}function v2(t,e,r){const i=t.split("."),s=i.pop(),n=Fse(i,!0,r);n&&s&&(n[s]=e)}function Fse(t,e,r){let i=r;for(const s of t){if(i==null)return;if(!(s in i)){if(!e)return;i[s]={}}i=i[s]}return i}function Use(t,e,r){return e?Object.keys(e).reduce((i,s)=>{let n=i[s],o=e[s];return n===o?i:n===void 0?(i[s]=ye(o),i):(Array.isArray(o)||Array.isArray(i)?(n=n?Array.isArray(n)?i[s]=n.concat():i[s]=[n]:i[s]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{n.includes(a)||n.push(a)}):i[s]=o.concat())):o&&typeof o=="object"?i[s]=Use(n,o,r):i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[s]=o),i)},t||{}):t}var _se;const kr={apiKey:void 0,applicationName:"",applicationUrl:(_se=globalThis.location)==null?void 0:_se.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(i2e(kr,globalThis.esriConfig,!0),delete kr.has),!kr.assetsPath){{const t="4.28";kr.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}kr.defaultAssetsPath=kr.assetsPath}const s2e=/\{([^\}]+)\}/g;function hq(t){return t??""}function IL(t,e){return e?t.replaceAll(s2e,typeof e=="object"?(r,i)=>hq(b3(i,e)):(r,i)=>hq(e(i))):t}function mpt(t,e){return t.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>e&&e.includes(r)?r:`\\${r}`)}function kse(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}function gpt(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}function ypt(t,e){return new RegExp(`{${e}}`,"ig").test(t)}const dq={info:0,warn:1,error:2,none:3};let ne=class ea{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,ea._loggers.set(this.module,this);const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=ea.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get test(){return{resetLoggers(e=new Map){const r=ea._loggers;return ea._loggers=e,r},set throttlingDisabled(e){ea._throttlingDisabled=e}}}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,ea._loggers.get(e)||new ea({module:e})}_log(e,r,...i){if(this._matchLevel(e)){if(r!=="always"&&!ea._throttlingDisabled){const s=this._argsToKey(i),n=this._loggedMessages[e].get(s);if(r==="once"&&n!=null||r==="oncePerTick"&&n&&n>=ea._tickCounter)return;this._loggedMessages[e].set(s,ea._tickCounter),ea._scheduleTickCounterIncrement()}for(const s of kr.log.interceptors)if(s(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,r){let i=this;for(;i!=null;){const s=i[e];if(s!=null)return s;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,r,...i){console[e](`[${r}]`,...i)}_matchLevel(e){const r=kr.log.level||"warn";return dq[this._parentWithMember("level",r)]<=dq[e]}_argsToKey(...e){return kse(JSON.stringify(e,(i,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]"))}static _scheduleTickCounterIncrement(){ea._tickCounterScheduled||(ea._tickCounterScheduled=!0,Promise.resolve().then(()=>{ea._tickCounter++,ea._tickCounterScheduled=!1}))}};ne._loggers=new Map,ne._tickCounter=0,ne._tickCounterScheduled=!1,ne._throttlingDisabled=!1;function n2e(t,e){return t.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>i===""?"$":(b3(i,e)??"").toString())}let Bse=class{constructor(e,r,i){this.name=e,this.details=i,this.message=(r&&n2e(r,i))??""}toString(){return"["+this.name+"]: "+this.message}},X=class zse extends Bse{constructor(e,r,i){super(e,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return ye(r)}catch{return"[object]"}}))}}catch(e){throw ne.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new zse(e.name,e.message,e.details)}};X.prototype.type="error";const pq=new Set;function o2e(t,e,r=!1){r&&pq.has(e)||(r&&pq.add(e),t.warn(`ðŸ›‘ DEPRECATED - ${e}`))}function Vse(t,e,r={}){if(te("esri-deprecation-warnings")){const{moduleName:i}=r;wx(t,`Function: ${(i?i+"::":"")+e+"()"}`,r)}}function f0(t,e,r={}){if(te("esri-deprecation-warnings")){const{moduleName:i}=r;wx(t,`Property: ${(i?i+"::":"")+e}`,r)}}function wx(t,e,r={}){if(te("esri-deprecation-warnings")){const{replacement:i,version:s,see:n,warnOnce:o}=r;let a=e;i&&(a+=`
	ðŸ› ï¸ Replacement: ${i}`),s&&(a+=`
	âš™ï¸ Version: ${s}`),n&&(a+=`
	ðŸ”— See ${n} for more details.`),o2e(t,a,o)}}function vpt(t){const e=[];return function*(){yield*e;for(const r of t)e.push(r),yield r}}function a2e(t,e){for(const r of t)if(r!=null&&e(r))return r}function q6(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let Am=class W6{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(r=>{e+=r.length}),e}add(e,r){if(q6(e)){const i=this._getOrCreateGroup(r);for(const s of e)this._isHandle(s)&&i.push(s)}else this._isHandle(e)&&this._getOrCreateGroup(r).push(e);return this}forEach(e,r){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&r&&i.forEach(r)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&q6(e)){for(const r of e)this.remove(r);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&(!!e.remove||e instanceof W6)}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const r=[];return this._groups.set(this._ensureGroupKey(e),r),r}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){for(const r of e)r instanceof W6?r.removeAll():r.remove()}};function LL(t,e){if(t==null)throw new Error(e??"value is None")}function Oe(t){return t==null||t.destroy(),null}function Ke(t){return t==null||t.dispose(),null}function di(t){return t==null||t.remove(),null}function Ml(t){return t==null||t.abort(),null}function Zt(t){return t==null||t.release(),null}function bpt(t,e,r){return t!=null&&e!=null?r!=null?r(t,e):t.equals(e):t===e}function fq(t,e){return t==null?void 0:t[e]}const Gse=Symbol("Accessor-beforeDestroy"),l2e={remove:()=>{}};function Rr(t){return t?{remove(){t&&(t(),t=void 0)}}:l2e}function c2e(t){t.forEach(e=>e==null?void 0:e.remove())}function U1(t){return Rr(()=>c2e(t))}function jse(t){return Rr(t!=null?()=>t.destroy():void 0)}function U0(t){return t.__accessor__??null}function u2e(t,e){var r;return((r=t==null?void 0:t.metadatas)==null?void 0:r[e])!=null}function yP(t,e,r){return r?s$(t,e,{policy:r,path:""}):s$(t,e,null)}function s$(t,e,r){return e?Object.keys(e).reduce((i,s)=>{const n=s;let o=null,a="merge";if(r&&(o=r.path?`${r.path}.${s}`:s,a=r.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(i[n]))return i[n]=e[n],i;if(i[n]===void 0)return i[n]=ye(e[n]),i;let l=i[n],c=e[n];if(l===c)return i;if(Array.isArray(c)||Array.isArray(i))l=l?Array.isArray(l)?i[n]=l.concat():i[n]=[l]:i[n]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(u=>{l.includes(u)||l.push(u)}));else if(c&&typeof c=="object")if(r){const u=r.path;r.path=o,i[n]=s$(l,c,r),r.path=u}else i[n]=s$(l,c,null);else i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[n]=c);return i},t||{}):t}function Hse(t){return Array.isArray(t)?t:t.split(".")}function mq(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function h2e(t){if(Array.isArray(t)){const e=[];for(const r of t)e.push(...mq(r));return e}return mq(t)}function qse(t,e,r,i){const s=h2e(e);if(s.length!==1){const n=s.map(o=>i(t,o,r));return U1(n)}return i(t,s[0],r)}function Wse(t,e){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.at(s)}const i=U0(e);return u2e(i,r)?i.get(r):e[r]}function Yse(t,e,r){if(t==null)return t;const i=Wse(e[r],t);return!i&&r<e.length-1?void 0:r===e.length-1?i:Yse(i,e,r+1)}function w3(t,e,r=0){return typeof e!="string"||e.includes(".")?Yse(t,Hse(e),r):Wse(e,t)}function Tp(t,e){return w3(t,e)}function gq(t,e){return w3(e,t)!==void 0}function x3(t){let e=t.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!r){e=Object.create(e);for(const i in e)e[i]=ye(e[i]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function DL(t,e){const r=x3(t);let i=r[e];return i||(i=r[e]={}),i}function d2e(t,e){return yP(t,e,f2e)}const p2e=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function f2e(t){return p2e.test(t)?"replace":"merge"}function m2e(t){return(t==null?void 0:t.release)&&typeof t.release=="function"}function g2e(t){return(t==null?void 0:t.acquire)&&typeof t.acquire=="function"}let Vo=class Y6{constructor(e,r,i,s=1,n=0){if(this._ctor=e,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let r;if(Y6.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let s=0;s<i;s++)this._pool[s]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...e):g2e(r)&&r.acquire(...e),r}release(e){e&&!Y6.test.disabled&&(this._releaseFunction?this._releaseFunction(e):m2e(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let r=e;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};Vo.test={disabled:!1};var Wf;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(Wf||(Wf={}));let y2e=class{constructor(e,r){this._observers=e,this._observer=r}remove(){Fz(this._observers,this._observer)}},Xse=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return _2e;this._observers==null&&(this._observers=[]);const r=this._observers;let i=!1,s=!1;const n=r.length;for(let o=0;o<n;++o){const a=r[o];if(a.destroyed)s=!0;else if(a===e){i=!0;break}}return i||(r.push(e),s&&this._removeDestroyedObservers()),new y2e(r,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const r=e.length;let i=0;for(let s=0;s<r;++s){for(;s+i<r&&e[s+i].destroyed;)++i;if(i>0){if(!(s+i<r))break;e[s]=e[s+i]}}e.length=r-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const r of e)r.onCommitted();this._observers=null}}};const _2e=Rr();var Yr;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(Yr||(Yr={}));const Tpt=Yr.USER+1;function Zse(t){switch(t){case"defaults":return Yr.DEFAULTS;case"service":return Yr.SERVICE;case"portal-item":return Yr.PORTAL_ITEM;case"web-scene":return Yr.WEB_SCENE;case"web-map":return Yr.WEB_MAP;case"link-chart":return Yr.LINK_CHART;case"user":return Yr.USER;default:return null}}function X6(t){switch(t){case Yr.DEFAULTS:return"defaults";case Yr.SERVICE:return"service";case Yr.PORTAL_ITEM:return"portal-item";case Yr.WEB_SCENE:return"web-scene";case Yr.WEB_MAP:return"web-map";case Yr.LINK_CHART:return"link-chart";case Yr.USER:return"user"}}function v2e(t){return X6(t)}var yi;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(yi||(yi={}));const n$={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},XT=[];let yE=n$;function xt(t){yE.onObservableAccessed(t)}let _P=!1,vP=!1;function fm(t,e,r){if(_P)return Gz(t,e,r);Jse(t);const i=e.call(r);return Qse(),i}function b2e(t,e){return fm(n$,t,e)}function Gz(t,e,r){const i=_P;_P=!0,Jse(t);let s=null;try{s=e.call(r)}catch(n){vP&&ne.getLogger("esri.core.accessorSupport.tracking").error(n)}return Qse(),_P=i,s}function Jse(t){yE=t,XT.push(t)}function Qse(){const t=XT.length;if(t>1){const e=XT.pop();yE=XT[t-2],e.onTrackingEnd()}else if(t===1){const e=XT.pop();yE=n$,e.onTrackingEnd()}else yE=n$}function Kse(t,e){if(e.flags&yi.DepTrackingInitialized)return;const r=vP;vP=!1,e.flags&yi.AutoTracked?Gz(e,e.metadata.get,t):ene(t,e),vP=r}const w2e=[];function ene(t,e){e.flags&yi.ExplicitlyTracking||(e.flags|=yi.ExplicitlyTracking,Gz(e,()=>{const r=e.metadata.dependsOn||w2e;for(const i of r)if(typeof i!="string"||i.includes(".")){const s=Hse(i);for(let n=0,o=t;n<s.length&&o!=null&&typeof o=="object";++n)o=yq(o,s[n],n!==s.length-1)}else yq(t,i,!1)}),e.flags&=~yi.ExplicitlyTracking)}function yq(t,e,r){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(i,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const s=U0(t);if(s){const n=s.propertiesByName.get(i);n&&(xt(n),Kse(t,n))}return r?t[i]:void 0}let _q=class extends Xse{constructor(e,r){super(),this.propertyName=e,this.metadata=r,this._accessed=null,this._handles=null,this.flags=0,this.flags=yi.Dirty|(r.nonNullable?yi.NonNullable:0)|(r.hasOwnProperty("value")?yi.HasDefaultValue:0)|(r.get===void 0?yi.DepTrackingInitialized:0)|(r.dependsOn===void 0?yi.AutoTracked:0)}destroy(){this.flags&yi.Dirty&&this.onCommitted(),super.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){xt(this);const r=e.store,i=this.propertyName,s=this.flags,n=r.get(i);if(s&yi.Computing||~s&yi.Dirty&&r.has(i))return n;this.flags|=yi.Computing;const o=e.host;let a;s&yi.AutoTracked?a=fm(this,this.metadata.get,o):(ene(o,this),a=this.metadata.get.call(o)),r.set(i,a,Yr.COMPUTED);const l=r.get(i);return l===n?this.flags&=~yi.Dirty:b2e(this.commit,this),this.flags&=~yi.Computing,l}onObservableAccessed(e){if(e===this)return;let r=this._accessed;if(r==null)r=[],this._accessed=r;else if(r.includes(e))return;r.push(e)}onTrackingEnd(){this._clearObservationHandles(),this.flags|=yi.DepTrackingInitialized;const e=this._accessed;if(e==null||e.length===0)return;let r=this._handles;r==null&&(r=[],this._handles=r);for(let i=0;i<e.length;++i)r.push(e[i].observe(this));e.length=0}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~yi.Dirty,this.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let r=0;r<e.length;++r)e[r].remove();e.length=0}}onInvalidated(){~this.flags&yi.Overriden&&(this.flags|=yi.Dirty);const e=this._observers;if(e&&e.length>0)for(const r of e)r.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onCommitted()}}},x2e=class tne{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new tne;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,ye(i))}),r}get(e){return this._values.get(e)}originOf(){return Yr.USER}keys(){return[...this._values.keys()]}set(e,r){this._values.set(e,r)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function xA(t,e,r){return t!==void 0}function vq(t,e,r,i){return t!==void 0&&(!(r==null&&t.flags&yi.NonNullable)||(i.lifecycle,Wf.INITIALIZING,!1))}function T2e(t){return t&&typeof t.destroy=="function"}ne.getLogger("esri.core.accessorSupport.Properties");let S2e=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=Wf.INITIALIZING,this.store=new x2e,this._origin=Yr.USER;const r=this.host.constructor.__accessorMetadata__;for(const i in r){const s=new _q(i,r[i]);this.propertiesByName.set(i,s)}this.metadatas=r}initialize(){this.lifecycle=Wf.CONSTRUCTING}constructed(){this.lifecycle=Wf.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,r]of this.propertiesByName){if(r.metadata.autoDestroy){const i=this.internalGet(e);i&&T2e(i)&&(i.destroy(),~r.flags&yi.NonNullable&&this._internalSet(r,null))}r.destroy()}}get initialized(){return this.lifecycle!==Wf.INITIALIZING}get(e){const r=this.propertiesByName.get(e);if(r.metadata.get)return r.getComputed(this);xt(r);const i=this.store;return i.has(e)?i.get(e):r.metadata.value}originOf(e){const r=this.store.originOf(e);if(r===void 0){const i=this.propertiesByName.get(e);if(i!==void 0&&i.flags&yi.HasDefaultValue)return"defaults"}return X6(r)}has(e){return!!this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const r=this.propertiesByName.get(e);if(xA(r))return this.store.has(e)?this.store.get(e):r.metadata.value}internalSet(e,r){const i=this.propertiesByName.get(e);xA(i)&&this._internalSet(i,r)}getDependsInfo(e,r,i){const s=this.propertiesByName.get(r);if(!xA(s))return"";const n=new Set,o=fm({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(e)});let a=`${i}${e.declaredClass.split(".").pop()}.${r}: ${o}
`;if(n.size===0)return a;i+="  ";for(const l of n)l instanceof _q&&(a+=`${i}${l.propertyName}: undefined
`);return a}setAtOrigin(e,r,i){const s=this.propertiesByName.get(e);if(xA(s))return this._setAtOrigin(s,r,i)}isOverridden(e){const r=this.propertiesByName.get(e);return r!==void 0&&!!(r.flags&yi.Overriden)}clearOverride(e){const r=this.propertiesByName.get(e);r&&r.flags&yi.Overriden&&(r.flags&=~yi.Overriden,r.notifyChange())}override(e,r){const i=this.propertiesByName.get(e);if(!vq(i,e,r,this))return;const s=i.metadata.cast;if(s){const n=this._cast(s,r),{valid:o,value:a}=n;if(KN.release(n),!o)return;r=a}i.flags|=yi.Overriden,this._internalSet(i,r)}set(e,r){const i=this.propertiesByName.get(e);if(!vq(i,e,r,this))return;const s=i.metadata.cast;if(s){const o=this._cast(s,r),{valid:a,value:l}=o;if(KN.release(o),!a)return;r=l}const n=i.metadata.set;n?n.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(e){this._origin=Zse(e)}getDefaultOrigin(){return X6(this._origin)}notifyChange(e){const r=this.propertiesByName.get(e);r!==void 0&&r.notifyChange()}invalidate(e){const r=this.propertiesByName.get(e);r!==void 0&&r.invalidate()}commit(e){const r=this.propertiesByName.get(e);r!==void 0&&r.commit()}_internalSet(e,r){const i=this.lifecycle!==Wf.INITIALIZING?this._origin:Yr.DEFAULTS;this._setAtOrigin(e,r,i)}_setAtOrigin(e,r,i){const s=this.store,n=e.propertyName;s.has(n,i)&&Vz(r,s.get(n))&&~e.flags&yi.Overriden&&i===s.originOf(n)||(e.invalidate(),s.set(n,r,i),e.commit(),Kse(this.host,e))}_cast(e,r){const i=KN.acquire();return i.valid=!0,i.value=r,e&&(i.value=e.call(this.host,r,i)),i}},E2e=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const KN=new Vo(E2e);function o$(t,e,r){if(t&&e)if(typeof e=="object")for(const i of Object.getOwnPropertyNames(e))o$(t,i,e[i]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(-1,1)[0];return void o$(Tp(t,s),n,r)}const i=t.__accessor__;i!=null&&C2e(e,i),t[e]=r}}function C2e(t,e){if(te("esri-unknown-property-errors")&&!A2e(t,e))throw new X("set:unknown-property",R2e(t,e))}function A2e(t,e){return e.metadatas[t]!=null}function R2e(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let O2e;function P2e(){return O2e}var bq;(function(t){t[t.Ignore=0]="Ignore",t[t.Destroy=1]="Destroy",t[t.ThrowError=2]="ThrowError"})(bq||(bq={}));function M2e(t){t.length=0}let bl=class{constructor(e=50,r=50){this._pool=new Vo(Array,void 0,M2e,r,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return e4.acquire()}static release(e){return e4.release(e)}static prune(){e4.prune()}};const e4=new bl(100);let rne=class extends Vo{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const r=super.acquire(...e);return this._set.delete(r),r}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const TA=[];function xx(t){TA.push(t),TA.length===1&&queueMicrotask(()=>{const e=TA.slice();TA.length=0;for(const r of e)r()})}let Zf=class{constructor(e,r=30){this.name=e,this._counter=0,this._samples=new Array(r)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,r)=>e-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,r)=>e+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var Z6;(function(t){const e=(n,o,a,l)=>{let c=o,u=o;const d=a>>>1,p=n[c-1];for(;u<=d;){u=c<<1,u<a&&l(n[u-1],n[u])<0&&++u;const g=n[u-1];if(l(g,p)<=0)break;n[c-1]=g,c=u}n[c-1]=p},r=(n,o)=>n<o?-1:n>o?1:0;function i(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)e(n,u,a,l);const c=o+1;for(let u=a-1;u>o;u--){const d=n[o];n[o]=n[u],n[u]=d,e(n,c,u,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)e(n,u,a,l),yield;const c=o+1;for(let u=a-1;u>o;u--){const d=n[o];n[o]=n[u],n[u]=d,e(n,c,u,l),yield}}t.sort=i,t.iterableSort=s})(Z6||(Z6={}));const wq=Z6,$2e=1.5,I2e=1.1;let It=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new xse,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>xq(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const r=new Array;for(let i=0;i<this._length;i++){const s=this.data[i];e(s)&&r.push(s)}return r}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,r){const i=this.data.indexOf(e,r);return i!==-1&&i<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let r=e;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,r=e.length){for(let i=0;i<r;i++)this.data[this._length++]=e[i]}fill(e,r){for(let i=0;i<r;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,xq(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const r=j6(this.data,e,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(j6(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,r=e.length,i){this.length=Hxe(this.data,e,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,r){if(e>=this.length||r>=this.length||e===r)return;const i=this.data[e];this.data[e]=this.data[r],this.data[r]=i}sort(e){wq.sort(this.data,0,this.length,e)}iterableSort(e){return wq.iterableSort(this.data,0,this.length,e)}some(e,r){for(let i=0;i<this.length;++i)if(e.call(r,this.data[i],i,this.data))return!0;return!1}find(e,r){for(let i=0;i<this.length;++i){const s=this.data[i];if(e.call(r,s,i))return s}}filterInPlace(e,r){let i=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(r,n,s,this.data)&&(this.data[s]=this.data[i],this.data[i]=n,i++)}if(this._deallocator)for(let s=i;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=i,this._shrink(),this}forAll(e,r){const i=this.length,s=this.data;for(let n=0;n<i;++n)e.call(r,s[n],n,s)}forEach(e,r){for(let i=0;i<this.length;++i)e.call(r,this.data[i],i,this.data)}map(e,r){const i=new Array(this.length);for(let s=0;s<this.length;++s)i[s]=e.call(r,this.data[s],s,this.data);return i}reduce(e,r){let i=r;for(let s=0;s<this.length;++s)i=e(i,this.data[s],s,this.data);return i}has(e){const r=this.length,i=this.data;for(let s=0;s<r;++s)if(i[s]===e)return!0;return!1}};function xq(t){t.data.length>$2e*t.length&&(t.data.length=Math.floor(t.length*I2e))}function L2e(t){return{setTimeout:(e,r)=>{const i=t.setTimeout(e,r);return Rr(()=>t.clearTimeout(i))}}}const T3=L2e(globalThis);function NL(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function b2(t,e,r){if(!NL(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,r);if(Array.isArray(e)){const i=e.slice();for(const s of i)t.addEventListener(s,r);return Rr(()=>{for(const s of i)t.removeEventListener(s,r)})}return t.addEventListener(e,r),Rr(()=>t.removeEventListener(e,r))}function ine(t,e,r){if(!NL(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,r);const i=b2(t,e,s=>{i.remove(),r.call(t,s)});return i}const D2e={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function N2e({key:t}){return D2e[t]||t}function ur(t="Aborted"){return new X("AbortError",t)}function wt(t,e="Aborted"){if(Ys(t))throw ur(e)}function FL(t){return t!=null?"aborted"in t?t:t.signal:t}function Ys(t){const e=FL(t);return e!=null&&e.aborted}function ly(t){if(Os(t))throw t}function Tq(t){if(!Os(t))throw t}function Uo(t,e){const r=FL(t);if(r!=null){if(!r.aborted)return ine(r,"abort",()=>e());e()}}function UL(t,e){const r=FL(t);if(r!=null)return wt(r),ine(r,"abort",()=>e(ur()))}function F2e(t,e){return FL(e)==null?t:new Promise((r,i)=>{let s=Uo(e,()=>i(ur()));const n=()=>{s=di(s)};t.then(n,n),t.then(r,i)})}function Os(t){return(t==null?void 0:t.name)==="AbortError"}async function yC(t){try{return await t}catch(e){if(!Os(e))throw e;return}}async function Mpt(t,e=ne.getLogger("esri")){try{return await t}catch(r){Os(r)||e.error(r)}}async function kL(t){if(!t)return;if(typeof t.forEach!="function"){const r=Object.keys(t),i=r.map(o=>t[o]),s=await kL(i),n={};return r.map((o,a)=>n[o]=s[a]),n}const e=t;return Promise.allSettled(e).then(r=>Array.from(e,(i,s)=>{const n=r[s];return n.status==="fulfilled"?{promise:i,value:n.value}:{promise:i,error:n.reason}}))}async function U2e(t){return(await kL(t)).filter(e=>!!e.value).map(e=>e.value)}async function Sq(t){return(await Promise.allSettled(t)).filter(e=>e.status==="fulfilled").map(e=>e.value)}async function $pt(t){return(await Promise.allSettled(t)).filter(e=>e.status==="rejected").map(e=>e.reason)}function _C(t,e=void 0,r){const i=new AbortController;return Uo(r,()=>i.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);Uo(i,()=>{o&&(clearTimeout(o),n(ur()))})})}function Fl(t){return t&&typeof t.then=="function"}function J6(t){return Fl(t)?t:Promise.resolve(t)}function sne(t,e=-1){let r,i,s,n,o=null;const a=(...l)=>{if(r){i=l,n&&n.reject(ur()),n=Go();const p=n.promise;if(o){const g=o;o=null,g.abort()}return p}if(s=n||Go(),n=null,e>0){const p=new AbortController;r=J6(t(...l,p.signal));const g=r;_C(e).then(()=>{r===g&&(n?p.abort():o=p)})}else r=1,r=J6(t(...l));const c=()=>{const p=i;i=s=r=o=null,p!=null&&a(...p)},u=r,d=s;return u.then(c,c),u.then(d.resolve,d.reject),d.promise};return a}function Go(){let t,e;const r=new Promise((s,n)=>{t=s,e=n}),i=s=>{t(s)};return i.resolve=s=>t(s),i.reject=s=>e(s),i.timeout=(s,n)=>T3.setTimeout(()=>i.reject(n),s),i.promise=r,i}function Ipt(t,e){return t.then(e,e)}async function Eq(t){await Promise.resolve(),wt(t)}function Lpt(t){return t}function nne(t){return 1e3*t}function Dpt(t){return t}function jz(t){return .001*t}let k2e=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},B2e=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},Q6=0,K6=0;const q2={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},e8=["prepare","preRender","render","postRender","update","finish"],t8=[],k1=new It;let z2e=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const a$={frameTasks:k1,willDispatch:!1,clearFrameTasks:V2e,dispatch:lne,executeFrameTasks:j2e};function w2(t){const e=new B2e(t);return t8.push(e),a$.willDispatch||(a$.willDispatch=!0,xx(lne)),e}function B1(t){const e=new k2e(t);return k1.push(e),l$==null&&(Q6=performance.now(),l$=requestAnimationFrame(one)),new z2e(e)}let l$=null;function V2e(t=!1){k1.forAll(e=>{e.removed=!0}),t&&ane()}function G2e(t){K6=Math.max(0,t)}function one(){const t=performance.now();l$=null,l$=k1.length>0?requestAnimationFrame(one):null,a$.executeFrameTasks(t)}function j2e(t){const e=t-Q6;Q6=t;const r=K6>0?K6:1e3/60,i=Math.max(0,e-r);q2.time=t,q2.frameDuration=r-i;for(let s=0;s<e8.length;s++){const n=performance.now(),o=e8[s];k1.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(q2.elapsedFrameTime=performance.now()-t,q2.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,q2)))}),H2e[s].record(performance.now()-n)}ane(),q2e.record(performance.now()-t)}const SA=new It;function ane(){k1.forAll(t=>{t.removed&&SA.push(t)}),k1.removeUnorderedMany(SA.data,SA.length),SA.clear()}function lne(){for(;t8.length;){const t=t8.shift();t.isActive&&t.callback()}a$.willDispatch=!1}function kpt(t=1,e){const r=Go(),i=()=>{Ys(e)?r.reject(ur()):t===0?r():(--t,xx(()=>i()))};return i(),r.promise}const H2e=e8.map(t=>new Zf(t)),q2e=new Zf("total");function bP(t,e){for(const r of t.entries())if(e(r[0]))return!0;return!1}function Cq(t,e){if(!e)return t;for(const r of e)t.add(r);return t}function W2e(t,e){const r=new Set;return Cq(r,t),Cq(r,e),r}function Bpt(t,e){const r=new Set;for(const i of e)t.has(i)&&r.add(i);return r}function zpt(t,e){if(!t||!e)return!1;if(t===e)return!0;for(const r of t)if(!e.has(r))return!1;return!0}function Vpt(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function Gpt(t,e){const r=new Set(t);for(const i of e)r.delete(i);return r}let Y2e=0;const X2e=0;function bc(){return++Y2e}let BL=class{constructor(e){this._accessed=[],this._handles=[],this._observerObject=new Z2e(e),Aq.register(this,new WeakRef(this._observerObject),this)}destroy(){var e;Aq.unregister(this._observerObject),this._accessed.length=0,(e=this._observerObject)==null||e.destroy(),this.clear()}onObservableAccessed(e){const r=this._accessed;r.includes(e)||r.push(e)}onTrackingEnd(){const e=this._handles,r=this._accessed,i=this._observerObject;for(let s=0;s<r.length;++s)e.push(r[s].observe(i));r.length=0}clear(){const e=this._handles;for(let r=0;r<e.length;++r)e[r].remove();e.length=0}},Z2e=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=J2e}};const Aq=new FinalizationRegistry(t=>{var e;(e=t.deref())==null||e.destroy()});function J2e(){}let Jw=!1;const c$=[];function cne(t,e){let r=new BL(n),i=null,s=!1;function n(){if(!r||s)return;if(Jw)return void dne(n);const a=i;r.clear(),Jw=!0,s=!0,i=fm(r,t),s=!1,Jw=!1,e(i,a),pne()}function o(){r&&(r.destroy(),r=null,i=null)}return s=!0,i=fm(r,t),s=!1,Rr(o)}function une(t,e){let r=new BL(s),i=null;function s(){e(i,o)}function n(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=fm(r,t),i):null}return o(),Rr(n)}function hne(t){let e=new BL(i),r=!1;function i(){e&&!r&&(Jw?dne(i):(e.clear(),Jw=!0,r=!0,fm(e,t),r=!1,Jw=!1,pne()))}function s(){e&&(e.destroy(),e=null)}return r=!0,fm(e,t),r=!1,Rr(s)}function dne(t){c$.includes(t)||c$.unshift(t)}function pne(){for(;c$.length;)c$.pop()()}var _E;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(_E||(_E={}));let vC=class{constructor(){this.uid=bc(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,r,i,s,n){return this.pool.acquire(_E.Untracked,e,r,i,s,n,Vz)}static acquireTracked(e,r,i,s){return this.pool.acquire(_E.Tracked,e,r,i,null,null,s)}notify(e,r){this.type===_E.Untracked?this.callback.call(this.target,e,r,this.path,this.target):this.callback.call(null,e,r,void 0,void 0)}acquire(e,r,i,s,n,o,a){this.uid=bc(),this.removed=!1,this.type=e,this.oldValue=r,this.callback=i,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=bc(),this.removed=!0}};vC.pool=new rne(vC);const wP=new bl,tm=new Set;let u$;function h$(t){tm.delete(t),tm.add(t),u$||(u$=w2(eTe))}function Q2e(t){if(t.removed)return;const e=t.oldValue,r=t.getValue();t.equals(e,r)||(t.oldValue=r,t.notify(r,e))}function K2e(t){for(const e of tm.values())e.target===t&&(e.removed=!0)}function eTe(){let t=10;for(;u$&&t--;){u$=null;const e=tTe(),r=wP.acquire();for(const i of e){const s=i.uid;Q2e(i),s===i.uid&&i.removed&&r.push(i)}for(const i of tm)i.removed&&(r.push(i),tm.delete(i));for(const i of r)vC.pool.release(i);wP.release(r),wP.release(e),r8.forEach(i=>i())}}function tTe(){const t=wP.acquire();t.length=tm.size;let e=0;for(const r of tm)t[e]=r,++e;return tm.clear(),t}const r8=new Set;function fne(t){return r8.add(t),Rr(()=>r8.delete(t))}function rTe(t,e,r){let i=qse(t,e,r,(s,n,o)=>{let a,l,c=une(()=>w3(s,n),(u,d)=>{s.__accessor__.destroyed||a&&a.uid!==l?i.remove():(a||(a=vC.acquireUntracked(u,o,d,s,n),l=a.uid),h$(a))});return Rr(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,h$(a)),a=null),i=c=null})});return i}function iTe(t,e,r){const i=qse(t,e,r,(s,n,o)=>{let a=!1;return cne(()=>w3(s,n),(l,c)=>{s.__accessor__.destroyed?i.remove():a||(a=!0,Vz(c,l)||o.call(s,l,c,n,s),a=!1)})});return i}function sTe(t,e,r,i=!1){return!t.__accessor__||t.__accessor__.destroyed?Rr():i?iTe(t,e,r):rTe(t,e,r)}function nTe(t,e,r){let i,s,n=une(t,(o,a)=>{i&&i.uid!==s?n.remove():(i||(i=vC.acquireTracked(o,e,a,r),s=i.uid),h$(i))});return Rr(()=>{n.remove(),i&&(i.uid!==s||i.removed||(i.removed=!0,h$(i)),i=null),n=null})}function oTe(t,e,r){let i=!1;return cne(t,(s,n)=>{i||(i=!0,r(n,s)||e(s,n),i=!1)})}function aTe(t,e,r=!1,i=Nse){return r?oTe(t,e,i):nTe(t,e,i)}function Rq(t){return bP(tm,e=>e.oldValue===t)}function hc(t,e){for(const[r,i]of t)if(e(i,r))return!0;return!1}function Wpt(t,e){for(const[r,i]of t)if(e(i,r))return i;return null}function mne(t,e,r){const i=t.get(e);if(i!==void 0)return i;const s=r();return t.set(e,s),s}const Qw=ne.getLogger("esri.core.accessorSupport.ensureTypes");function lTe(t){return t==null?t:new Date(t)}function cTe(t){return t==null?t:!!t}function uTe(t){return t==null?t:t.toString()}function Mh(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function Hz(t){return t==null?t:Math.round(parseFloat(t))}function gne(t){return(t==null?void 0:t.constructor)&&t.constructor.__accessorMetadata__!==void 0}function d$(t,e){return e!=null&&t&&!(e instanceof t)}function yne(t){return t&&"isCollection"in t}function Oq(t){return t!=null&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function hTe(t,e){if(!(e!=null&&e.constructor)||!yne(e.constructor))return i8(t,e)?e:new t(e);const r=Oq(t.prototype.itemType),i=Oq(e.constructor.prototype.itemType);return r?i?r===i?e:r.prototype.isPrototypeOf(i.prototype)?new t(e):(i8(t,e),e):new t(e):e}function i8(t,e){return!!gne(e)&&(Qw.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+zL(t)+"'"),!0)}function Tx(t,e){return e==null?e:yne(t)?hTe(t,e):d$(t,e)?i8(t,e)?e:new t(e):e}function zL(t){var e;return((e=t==null?void 0:t.prototype)==null?void 0:e.declaredClass)||"unknown"}const dTe=new WeakMap;function pTe(t){switch(t){case Number:return Mh;case Qs:return Hz;case Boolean:return cTe;case String:return uTe;case Date:return lTe;default:return mne(dTe,t,()=>Tx.bind(null,t))}}function ya(t,e){const r=pTe(t);return arguments.length===1?r:r(e)}function bC(t,e,r){return arguments.length===1?bC.bind(null,t):e&&(Array.isArray(e)?e.map(i=>t(i,r)):[t(e,r)])}function fTe(t,e){return arguments.length===1?bC(r=>ya(t,r)):bC(r=>ya(t,r),e)}function _ne(t,e,r){return e!==0&&Array.isArray(r)?r.map(i=>_ne(t,e-1,i)):t(r)}function p$(t,e,r){if(arguments.length===2)return n=>p$(t,e,n);if(!r)return r;r=_ne(t,e,r);let i=e,s=r;for(;i>0&&Array.isArray(s);)i--,s=s[0];if(s!==void 0)for(let n=0;n<i;n++)r=[r];return r}function mTe(t,e,r){return arguments.length===2?p$(i=>ya(t,i),e):p$(i=>ya(t,i),e,r)}function vne(t){return!!Array.isArray(t)&&!t.some(e=>{const r=typeof e;return!(r==="string"||r==="number"||r==="function"&&t.length>1)})}function s8(t,e){if(arguments.length===2)return s8(t).call(null,e);const r=new Set,i=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||r.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,u=c==="string"||c==="number";return u&&(r.has(a)||s.some(d=>c==="string"&&d===String||c==="number"&&d===Number))||c==="object"&&s.some(d=>!d$(a,d))?a:(u&&i.length?(n||(n=i.map(d=>typeof d=="string"?`'${d}'`:`${d}`).join(", ")),Qw.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(d=>zL(d)).join(", ")),Qw.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):Qw.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function k0(t,e){if(arguments.length===2)return k0(t).call(null,e);const r={},i=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];r[l]=ya(c),i.push(zL(c)),s.push(l)}const n=()=>`'${i.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!d$(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,u=r[c];if(!u)return Qw.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!d$(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!gne(l)){const d={};for(const p in l)p!==t.key&&(d[p]=l[p]);return u(d)}return u(l)}}let Qs=class{};const Xpt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function gTe(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function bne(t){switch(t.type){case"native":return ya(t.value);case"array":return bC(bne(t.value));case"one-of":return yTe(t);default:return null}}function yTe(t){let e=null;return(r,i)=>o8(r,t)?r:(e==null&&(e=n8(t)),Qw.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),i&&(i.valid=!1),null)}function n8(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Qs:return"integer";case Date:return"date";default:return zL(t.value)}case"array":return`array of ${n8(t.value)}`;case"one-of":{const e=t.values.map(r=>n8(r));return`one of ${e.slice(0,-1)} or ${e[e.length-1]}`}}return"unknown"}function o8(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Qs:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(r=>!o8(r,e.value));case"one-of":return e.values.some(r=>o8(t,r))}}function f(t={}){return(e,r)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(e,r),s=DL(e,r);i&&(i.get||i.set?(s.get=i.get||s.get,s.set=i.set||s.set):"value"in i&&("value"in t&&ne.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=i.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let u;s.dependsOn=[l],s.get=function(){let d=Tp(this,l);if(typeof d=="function"){u||(u=l.split(".").slice(0,-1).join("."));const p=Tp(this,u);p&&(d=d.bind(p))}return d},s.readOnly||(s.set=c?function(d){this._override(r,d)}:function(d){o$(this,l,d)})}const o=t.type,a=t.types;s.cast||(o?s.cast=_Te(o):a&&(Array.isArray(a)?s.cast=bC(k0(a[0])):s.cast=k0(a))),d2e(s,t),t.range&&(s.cast=vTe(s.cast,t.range))}}function wne(t,e,r){const i=DL(t,r);i.json||(i.json={});let s=i.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function _Te(t){let e=0,r=t;if(gTe(t))return bne(t);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],e++;const i=r;if(vne(i))return e===0?s8(i):p$(s8(i),e);if(e===1)return fTe(i);if(e>1)return mTe(i,e);const s=t;return s.from?s.from:ya(s)}function vTe(t,e){return r=>{let i=+t(r);return e.step!=null&&(i=Math.round(i/e.step)*e.step),e.min!=null&&(i=Math.max(e.min,i)),e.max!=null&&(i=Math.min(e.max,i)),i}}function bTe(t){if(t.json&&t.json.origins){const e=t.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(e[i]){const s=e[i];r[i].forEach(n=>{e[n]=s}),delete e[i]}}}let z1=class extends Bse{constructor(e,r,i){super(e,r,i)}};z1.prototype.type="warning";function xne(t){var e;return!!t&&((e=t.prototype)==null?void 0:e.declaredClass)&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const a8=ne.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function Pq(t,e,r){var i,s;t&&(!r&&!e.read||(i=e.read)!=null&&i.reader||((s=e.read)==null?void 0:s.enabled)===!1||TTe(t)&&v2("read.reader",Tne(t),e))}function Tne(t){var r,i;const e=t.ndimArray??0;if(e>1)return xTe(t);if(e===1)return Mq(t);if("type"in t&&Ene(t.type)){const s=(i=(r=t.type.prototype)==null?void 0:r.itemType)==null?void 0:i.Type,n=Mq(typeof s=="function"?{type:s}:{types:s});return(o,a,l)=>{const c=n(o,a,l);return c&&new t.type(c)}}return qz(t)}function qz(t){return"type"in t?wTe(t.type):STe(t.types)}function wTe(t){return t.prototype.read?(e,r,i)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void a8.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,i),n}:t.fromJSON}function Sne(t,e,r,i){return i!==0&&Array.isArray(e)?e.map(s=>Sne(t,s,r,i-1)):t(e,void 0,r)}function xTe(t){const e=qz(t),r=Sne.bind(null,e),i=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=r(s,o,i);let a=i,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function Mq(t){const e=qz(t);return(r,i,s)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(r,void 0,s);return n!==void 0?[n]:void 0}}function Ene(t){if(!xne(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?Wz(e.Type):Cne(e.Type))}function TTe(t){return"types"in t?Cne(t.types):Wz(t.type)}function Wz(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||Ene(t))}function Cne(t){for(const e in t.typeMap)if(!Wz(t.typeMap[e]))return!1;return!0}function STe(t){let e=null;const r=t.errorContext??"type",i=t.validate;return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void a8.error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);e||(e=ETe(t));const l=t.key;if(typeof l!="string")return;const c=s[l],u=c?e[c]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!u){const p=`Type '${c||"unknown"}' is not supported`;return o!=null&&o.messages&&s&&o.messages.push(new z1(`${r}:unsupported`,p,{definition:s,context:o})),void a8.error(p)}const d=new u;return d.read(s,o),i?i(d):d}}function ETe(t){var r,i;const e={};for(const s in t.typeMap){const n=t.typeMap[s],o=x3(n.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;(r=a.json)!=null&&r.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(e[a.json.type[0]]=n);const l=(i=a.json)==null?void 0:i.write;if(!(l!=null&&l.writer)){e[s]=n;continue}const c=l.target,u=typeof c=="string"?c:t.key,d={};l.writer(s,d,u),d[u]&&(e[d[u]]=n)}return e}function CTe(t){if(t.json||(t.json={}),Iq(t.json),Lq(t.json),$q(t.json),t.json.origins)for(const e in t.json.origins)Iq(t.json.origins[e]),Lq(t.json.origins[e]),$q(t.json.origins[e]);return!0}function $q(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function Iq(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function Lq(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function Dq(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const r=(t==null?void 0:t.ndimArray)??0;t&&(r===1||"type"in t&&xne(t.type))?e.write.writer=OTe:r>1?e.write.writer=PTe(r):e.types?Array.isArray(e.types)?e.write.writer=RTe(e.types[0]):e.write.writer=ATe(e.types):e.write.writer=wC}function ATe(t){return(e,r,i,s)=>e?Ane(e,t,s)?wC(e,r,i,s):void 0:wC(e,r,i,s)}function Ane(t,e,r){for(const i in e.typeMap)if(t instanceof e.typeMap[i])return!0;if(r!=null&&r.messages){const i=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&t&&r.messages.push(new X(`${i}:unsupported`,s,{definition:t,context:r})),ne.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function RTe(t){return(e,r,i,s)=>!e||!Array.isArray(e)?wC(e,r,i,s):wC(e.filter(n=>Ane(n,t,s)),r,i,s)}function wC(t,e,r,i){v2(r,f$(t,i),e)}function f$(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?m$(t):t}function m$(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function OTe(t,e,r,i){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>f$(n,i)),typeof s.toArray=="function"&&(s=s.toArray())):s=[f$(t,i)],v2(r,s,e)}function Rne(t,e,r){return r!==0&&Array.isArray(t)?t.map(i=>Rne(i,e,r-1)):f$(t,e)}function PTe(t){return(e,r,i,s)=>{let n;if(e===null)n=null;else{n=Rne(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}v2(i,n,r)}}function MTe(t,e){return Yz(t,"any",e==null?void 0:e.origin)}function l8(t,e){return Yz(t,"read",e==null?void 0:e.origin)}function One(t,e){return Yz(t,"write",e==null?void 0:e.origin)}function Yz(t,e,r){let i=t==null?void 0:t.json;if(i!=null&&i.origins&&r){let s;s=r==="link-chart"?i.origins[r]&&(e==="any"||e in i.origins[r])?i.origins[r]:i.origins["web-map"]:i.origins[r],s&&(e==="any"||e in s)&&(i=s)}return i}function $Te(t){const e=ITe(t);if(t.json.origins)for(const r in t.json.origins){const i=t.json.origins[r],s=i.types?LTe(i):e;Pq(s,i,!1),i.types&&!i.write&&t.json.write&&t.json.write.enabled&&(i.write={...t.json.write}),Dq(s,i)}Pq(e,t.json,!0),Dq(e,t.json)}function ITe(t){return t.json.types?c8(t.json):t.type?Pne(t):c8(t)}function LTe(t){return t.type?Pne(t):c8(t)}function Pne(t){if(!t.type)return;let e=0,r=t.type;for(;Array.isArray(r)&&!vne(r);)r=r[0],e++;return{type:r,ndimArray:e}}function c8(t){if(!t.types)return;let e=0,r=t.types;for(;Array.isArray(r);)r=r[0],e++;return{types:r,ndimArray:e}}function DTe(t){CTe(t)&&(bTe(t),$Te(t))}const t4=new Set,r4=new Set;function k(t){return e=>{t??(t="esri.core.Accessor"),e.prototype.declaredClass=t,FTe(e);const r=[],i=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!t4.has(s.initialize)&&(t4.add(s.initialize),r.push(s.initialize)),s.hasOwnProperty("destroy")&&!r4.has(s.destroy)&&(r4.add(s.destroy),i.push(s.destroy)),s=Object.getPrototypeOf(s);t4.clear(),r4.clear();const n=class extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;const c=this[Gse];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let u=0;u<i.length;u++)i[u].call(this)}}})}this.postscript(...a)}}};n.__accessorMetadata__=x3(e.prototype),n.prototype.declaredClass=t;const o=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(n,"name",{value:o,configurable:!0}),n}}function NTe(t,e){return e.get==null?function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i===void 0)return;xt(i);const s=r.store;return s.has(t)?s.get(t):i.metadata.value}:function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i!==void 0)return i.getComputed(r)}}function FTe(t){const e=t.prototype,r=x3(e),i={};for(const s of Object.getOwnPropertyNames(r)){const n=r[s];DTe(n),i[s]={enumerable:!0,configurable:!0,get:NTe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===Wf.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,i)}var Mne,$ne;function UTe(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const Rg=Symbol("Accessor-Handles"),u8=Symbol("Accessor-Initialized");let xe=class Ine{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}x3(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const u=this.inherited;let d;this.inherited=function(...p){if(n.prototype[a])return n.prototype[a].apply(this,p)};try{d=l.apply(this,c)}catch(p){throw this.inherited=u,p}return this.inherited=u,d}:e[a]}for(const a in r){const l=UTe(r[a]);f(l)(o.prototype,a)}return k(i)(o)}constructor(...e){if(this[Mne]=null,this[$ne]=!1,this.constructor===Ine)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const r=new S2e(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:r}),e.length>0&&this.normalizeCtorArgs&&(r.ctorArgs=this.normalizeCtorArgs.apply(this,e))}postscript(e){const r=this.__accessor__,i=r.ctorArgs||e;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[u8]=!0}initialize(){}[Gse](){this[Rg]=Oe(this[Rg])}destroy(){var e;this.destroyed||(K2e(this),this.__accessor__.destroy(),(e=P2e())==null||e.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[u8]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){Tp(this,e)}get(e){return Vse(ne.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),Tp(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,r){return o$(this,e,r),this}watch(e,r,i){return sTe(this,e,r,i)}addHandles(e,r){if(this.destroyed){const s=Array.isArray(e)?e:[e];for(const n of s)n.remove();return}let i=this[Rg];i==null&&(i=this[Rg]=new Am),i.add(e,r)}removeHandles(e){const r=this[Rg];r!=null&&r.remove(e)}removeAllHandles(){const e=this[Rg];e!=null&&e.removeAll()}hasHandles(e){const r=this[Rg];return r!=null&&r.has(e)}_override(e,r){r===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,r){r==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,r){return this.__accessor__.internalSet(e,r),this}};Mne=Rg,$ne=u8;let kTe=class Lne{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new Lne;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,ye(i.value),i.origin)}),r}get(e,r){r=this._normalizeOrigin(r);const i=this._values.get(e);return r==null||(i==null?void 0:i.origin)===r?i==null?void 0:i.value:void 0}originOf(e){var r;return((r=this._values.get(e))==null?void 0:r.origin)??Yr.USER}keys(e){e=this._normalizeOrigin(e);const r=[...this._values.keys()];return e==null?r:r.filter(i=>{var s;return((s=this._values.get(i))==null?void 0:s.origin)===e})}set(e,r,i){if((i=this._normalizeOrigin(i))===Yr.DEFAULTS){const s=this._values.get(e);if((s==null?void 0:s.origin)!=null&&s.origin>i)return}this._values.set(e,new BTe(r,i))}delete(e,r){var i;(r=this._normalizeOrigin(r))!=null&&((i=this._values.get(e))==null?void 0:i.origin)!==r||this._values.delete(e)}has(e,r){var i;return(r=this._normalizeOrigin(r))!=null?((i=this._values.get(e))==null?void 0:i.origin)===r:this._values.has(e)}forEach(e){this._values.forEach(({value:r},i)=>e(r,i))}_normalizeOrigin(e){if(e!=null)return e===Yr.DEFAULTS?e:Yr.USER}},BTe=class{constructor(e,r){this.value=e,this.origin=r}};function zTe(t,e,r){e.keys().forEach(s=>{r.set(s,e.get(s),Yr.DEFAULTS)});const i=t.metadatas;Object.keys(i).forEach(s=>{t.internalGet(s)&&r.set(s,t.internalGet(s),Yr.DEFAULTS)})}function VTe(t,e,r){if(!(t!=null&&t.read)||t.read.enabled===!1||!t.read.source)return!1;const i=t.read.source;if(typeof i=="string"){if(i===e||i.includes(".")&&i.indexOf(e)===0&&gq(i,r))return!0}else for(const s of i)if(s===e||s.includes(".")&&s.indexOf(e)===0&&gq(s,r))return!0;return!1}function GTe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function jTe(t,e,r,i,s){let n=l8(e[r],s);GTe(n)&&(t[r]=!0);for(const o of Object.getOwnPropertyNames(e))n=l8(e[o],s),VTe(n,r,i)&&(t[o]=!0)}function HTe(t,e,r,i){const s=r.metadatas,n=MTe(s[e],i),o=n==null?void 0:n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,i):o;a!==void 0&&r.set(e,a)}const Dne={origin:"service"};function qTe(t,e,r=Dne){if(!e||typeof e!="object")return;const i=U0(t),s=i.metadatas,n={};for(const o of Object.getOwnPropertyNames(e))jTe(n,s,o,e,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(n)){const a=l8(s[o],r).read,l=a==null?void 0:a.source;let c;c=l&&typeof l=="string"?w3(e,l):e[o],a!=null&&a.reader&&(c=a.reader.call(t,c,e,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||HTe(t,o,i,r)}i.setDefaultOrigin("user")}function Qpt(t,e,r,i=Dne){var n;const s={...i,messages:[]};r(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||t.loaded?i!=null&&i.messages&&i.messages.push(o):t.loadWarnings.push(o)})}function WTe(t,e,r,i,s){var o,a;const n={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,i,n,r,s),n}function Nne(t,e,r,i,s,n){if(!(i!=null&&i.write))return!1;const o=Tp(t,r);if(!s&&i.write.overridePolicy){const a=i.write.overridePolicy.call(t,o,r,n??void 0);a!==void 0&&(s=a)}if(s||(s=i.write),!s||s.enabled===!1||s.layerContainerTypes&&(n!=null&&n.layerContainerType)&&!s.layerContainerTypes.includes(n.layerContainerType))return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new X("web-document-write:property-required",`Missing value for required property '${r}' on '${t.declaredClass}'`,{propertyName:r,target:t});return a&&(n!=null&&n.messages)?n.messages.push(a):a&&!n&&ne.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(r)===Yr.DEFAULTS)&&YTe(t,r,n,i,o)||!s.ignoreOrigin&&(n!=null&&n.origin)&&e.store.multipleOriginsSupported&&e.store.originOf(r)<Zse(n.origin))}function YTe(t,e,r,i,s){const n=i.default;if(n===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,r??void 0);return pm(o,s)}return!1}return n===s}function Kpt(t,e,r,i){const s=U0(t),n=s.metadatas,o=One(n[e],i);return!!o&&Nne(t,s,e,o,r,i)}function XTe(t,e,r){var n,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return yP(e,t.toJSON(r));const i=U0(t),s=i.metadatas;for(const a in s){const l=One(s[a],r);if(!Nne(t,i,a,l,void 0,r))continue;const c=Tp(t,a),u=WTe(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,r);Object.keys(u).length>0&&(e=yP(e,u),(o=(n=r==null?void 0:r.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>yP(e,u,()=>"replace-arrays"))),r!=null&&r.writtenProperties&&r.writtenProperties.push({target:t,propName:a,oldOrigin:v2e(i.store.originOf(a)),newOrigin:r.origin}))}return e}const S3=t=>{let e=class extends t{constructor(...r){super(...r);const i=U0(this),s=i.store,n=new kTe;i.store=n,zTe(i,s,n)}read(r,i){qTe(this,r,i)}write(r,i){return XTe(this,r??{},i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return ZTe.call(this,r,i)}};return e=h([k("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function ZTe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(t,e),r}function h8(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}let st=class extends S3(xe){};st=h([k("esri.core.JSONSupport")],st);const JTe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,QTe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function Nq(t){const e=t==null?void 0:t.match(JTe);if(!e)return null;const[,r,i,s]=e;if(!r)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:u}=QTe;if(i)if(n=r,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=u);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=u);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function KTe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function Fne(t){const e=atob(t),r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r.buffer}function eSe(t){const e=new Uint8Array(t);let r="";for(let i=0;i<e.length;i++)r+=String.fromCharCode(e[i]);return btoa(r)}const tSe=ne.getLogger("esri.core.urlUtils"),x2=kr.request,Fq="esri/config: esriConfig.request.proxyUrl is not set.",Une=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,kne=/^\s*http:/i,rSe=/^\s*https:/i,iSe=/^\s*file:/i,sSe=/:\d+$/,nSe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,oSe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),aSe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let Kw=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(oSe);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match(aSe),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}};const EA={},lSe=new Kw(kr.applicationUrl);let da=lSe;const cSe=uSe();let Xz=cSe;const Zz=()=>da,rft=()=>Xz;function uSe(){const t=da.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${da.scheme}://${da.host}${da.port!=null?`:${da.port}`:""}`}${e}`}function Wn(t){if(!t)return null;const e={path:null,query:null},r=new Kw(t),i=t.indexOf("?");return r.query===null?e.path=t:(e.path=t.substring(0,i),e.query=Jz(r.query)),r.fragment&&(e.hash=r.fragment,r.query===null&&(e.path=e.path.substring(0,e.path.length-(r.fragment.length+1)))),e}function Jz(t){const e=t.split("&"),r={};for(const i of e){if(!i)continue;const s=i.indexOf("=");let n,o;s<0?(n=decodeURIComponent(i),o=""):(n=decodeURIComponent(i.slice(0,s)),o=decodeURIComponent(i.slice(s+1)));let a=r[n];typeof a=="string"&&(a=r[n]=[a]),Array.isArray(a)?a.push(o):r[n]=o}return r}function xC(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(e(r,t[r]))).join("&"):Object.keys(t).map(r=>{const i=t[r];if(i==null)return"";const s=encodeURIComponent(r)+"=",n=e==null?void 0:e[r];return n?s+encodeURIComponent(n(i)):Array.isArray(i)?i.map(o=>h8(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):h8(i)?s+encodeURIComponent(JSON.stringify(i)):s+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function hSe(t=!1){let e,r=x2.proxyUrl;if(typeof t=="string"){e=ySe(t);const i=VL(t);i&&(r=i.proxyUrl)}else e=!!t;if(!r)throw tSe.warn(Fq),new X("urlutils:proxy-not-set",Fq);return e&&d8()&&(r=i7(r)),Wn(r)}function ift(t){const e=VL(t);let r,i;if(e){const s=Qz(e.proxyUrl);r=s.path,i=s.query?Jz(s.query):null}if(r){const s=Wn(t);t=r+"?"+s.path;const n=xC({...i,...s.query});n&&(t=`${t}?${n}`)}return t}const W2={path:"",query:""};function Qz(t){const e=t.indexOf("?");return e!==-1?(W2.path=t.slice(0,e),W2.query=t.slice(e+1)):(W2.path=t,W2.query=null),W2}function Bne(t){return t=(t=y$(t=xSe(t=Qz(t).path),!0)).toLowerCase()}function dSe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:Bne(t.urlPrefix)},r=x2.proxyRules,i=e.urlPrefix;let s=r.length;for(let n=0;n<r.length;n++){const o=r[n].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;s=n;break}o.indexOf(i)===0&&(s=n+1)}return r.splice(s,0,e),s}function VL(t){const e=x2.proxyRules,r=Bne(t);for(let i=0;i<e.length;i++)if(r.indexOf(e[i].urlPrefix)===0)return e[i]}function sft(t,e){if(!t||!e)return!1;t=g$(t),e=g$(e);const r=Nq(t),i=Nq(e);return r!=null&&i!=null?r.portalHostname===i.portalHostname:r==null&&i==null&&Sx(t,e,!0)}function pSe(t,e){return t=g$(t),e=g$(e),y$(t)===y$(e)}function g$(t){const e=(t=rm(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function zne(t){const e=i=>i==null||i instanceof RegExp&&i.test(t)||typeof i=="string"&&t.startsWith(i),r=x2.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(e))return i}else if(e(i.urls))return i}return null}function Sx(t,e,r=!1){if(!t||!e)return!1;const i=f8(t),s=f8(e);return!(!r&&i.scheme!==s.scheme)&&i.host!=null&&s.host!=null&&i.host.toLowerCase()===s.host.toLowerCase()&&i.port===s.port}function Kz(t){if(typeof t=="string"){if(!wc(t))return!0;t=f8(t)}if(Sx(t,da))return!0;const e=x2.trustedServers||[];for(let r=0;r<e.length;r++){const i=fSe(e[r]);for(let s=0;s<i.length;s++)if(Sx(t,i[s]))return!0}return!1}function fSe(t){return EA[t]||(r7(t)||Dp(t)?EA[t]=[new Kw(dc(t))]:EA[t]=[new Kw(`http://${t}`),new Kw(`https://${t}`)]),EA[t]}function dc(t,e=Xz,r){return Dp(t)?r&&r.preserveProtocolRelative?t:da.scheme==="http"&&da.authority===Hh(t).slice(2)?`http:${t}`:`https:${t}`:r7(t)?t:GL(t[0]==="/"?wSe(e):e,t)}function e7(t,e=Xz,r){if(t==null||!wc(t))return t;const i=rm(t),s=i.toLowerCase(),n=rm(e).toLowerCase().replace(/\/+$/,""),o=r?rm(r).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(d,p,g)=>(g=d.indexOf(p,g))===-1?d.length:g;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=i.slice(c);const u=n.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let d=0;d<u;d++)t=`../${t}`;else t=`./${t}`;return t}function rm(t){return t=ESe(t=SSe(t=TSe(t=dc(t=t.trim()))))}function GL(...t){const e=t.filter(v3);if(!(e!=null&&e.length))return;const r=[];if(wc(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(r.push(s.slice(0,n+1)),vSe(e[0])&&(r[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&r.push("");const i=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<i.length;s++){const n=i[s];n===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!n&&s===i.length-1||n&&(n!=="."||r.length===0))&&r.push(n)}return r.join("/")}function Hh(t,e=!1){if(t==null||TC(t)||qp(t))return null;let r=t.indexOf("://");if(r===-1&&Dp(t))r=2;else{if(r===-1)return null;r+=3}const i=t.indexOf("/",r);return i!==-1&&(t=t.slice(0,i)),e&&(t=y$(t,!0)),t}function wc(t){return Dp(t)||r7(t)}function TC(t){return t!=null&&t.slice(0,5)==="blob:"}function qp(t){return t!=null&&t.slice(0,5)==="data:"}function t7(t){const e=B0(t);return e&&e.isBase64?Fne(e.data):null}function nft(t){return eSe(t).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const mSe=/^data:(.*?)(;base64)?,(.*)$/;function B0(t){const e=t.match(mSe);if(!e)return null;const[,r,i,s]=e;return{mediaType:r,isBase64:!!i,data:s}}function Vne(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}async function oft(t){return(await fetch(t)).blob()}function aft(t){const e=t7(t);if(!e)return null;const r=B0(t);return new Blob([e],{type:r.mediaType})}function lft(t,e){gSe(t,e)}function gSe(t,e){if(!t)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(t);return r.download=e,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function Dp(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function r7(t){return t!=null&&Une.test(t)}function ySe(t){return t!=null&&rSe.test(t)||da.scheme==="https"&&Dp(t)}function _Se(t){return t!=null&&kne.test(t)||da.scheme==="http"&&Dp(t)}function vSe(t){return t!=null&&iSe.test(t)}function i7(t){return Dp(t)?`https:${t}`:t.replace(kne,"https:")}function bSe(){return da.scheme==="http"}function d8(){return da.scheme==="https"}function y$(t,e=!1){return Dp(t)?t.slice(2):(t=t.replace(Une,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function wSe(t){const e=t.indexOf("//"),r=t.indexOf("/",e+2);return r===-1?t:t.slice(0,r)}function s7(t){let e=0;if(wc(t)){const i=t.indexOf("//");i!==-1&&(e=i+2)}const r=t.lastIndexOf("/");return r<e?t:t.slice(0,r+1)}function cft(t,e){if(!t)return"";const r=Wn(t).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!(e!=null&&e.length))return i;const s=new RegExp(`.(${e.join("|")})$`,"ig");return i.replace(s,"")}function xSe(t){return t.endsWith("/")?t:`${t}/`}function Gne(t){return t.replace(/\/+$/,"")}function TSe(t){if(/^https?:\/\//i.test(t)){const e=Qz(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function SSe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function ESe(t){const e=x2.httpsDomains;if(!_Se(t))return t;const r=t.indexOf("/",7);let i;if(i=r===-1?t:t.slice(0,r),i=i.toLowerCase().slice(7),sSe.test(i)){if(!i.endsWith(":80"))return t;i=i.slice(0,-3),t=t.replace(":80","")}return bSe()&&i===da.authority&&!nSe.test(t)||(d8()&&i===da.authority||e&&e.some(s=>i===s||i.endsWith(`.${s}`))||d8()&&!VL(t))&&(t=i7(t)),t}function p8(t,e,r){if(!(e&&r&&t&&wc(t)))return t;const i=t.indexOf("//"),s=t.indexOf("/",i+2),n=t.indexOf(":",i+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(i+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,i+2)}${r}${t.slice(o)}`}function f8(t){return typeof t=="string"?new Kw(dc(t)):(t.scheme||(t.scheme=da.scheme),t)}function jne(t){return CSe.test(t)}function Hne(t,e){const r=Wn(t),i=Object.keys(r.query||{});return i.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function qne(t,e,r){const i=Wn(t),s=i.query||{};return s[e]=String(r),`${i.path}?${xC(s)}`}function i4(t,e){if(!e)return t;const r=Wn(t),i=r.query||{};for(const[n,o]of Object.entries(e))o!=null&&(i[n]=o);const s=xC(i);return s?`${r.path}?${s}`:r.path}function uft(t){if(t==null)return null;const e=t.match(Wne);return e?e[2]:null}function Uq(t){if(t==null)return null;const e=t.match(Wne);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function hft(t){return typeof t=="string"?B0(t)??{data:t}:new Promise((e,r)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>e(B0(i.result)),i.onerror=s=>r(s)})}const Wne=/([^.]*)\.([^\/]*)$/,CSe=/(^data:image\/svg|\.svg$)/i,Yne="20231107",Xne="2701956fe778d3eb0b5dc84951136bfe12a19332";Symbol.dispose??(Symbol.dispose=Symbol("Symbol.dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));const ASe="4.28";let Qi,n7=ASe;n7="4.28.8";function dft(t){Qi=t}function pft(t){const e=Qi==null?void 0:Qi.findCredential(t);return e!=null&&e.token?qne(t,"token",e.token):t}te("host-webworker");const RSe=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function Zne(t){const e=Hh(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!RSe.has(e)&&!t.endsWith("/sharing/rest/generateToken")}function Jne(t,e,r=!1,i){return new Promise((s,n)=>{if(Ys(i))return void n(kq());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const u=t;c(),s(u)},l=()=>{if(!t)return;const u=t;c(),u.src="",n(kq())};const c=()=>{te("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,i!=null&&i.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(e)};i!=null&&i.addEventListener("abort",l),te("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function kq(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const Qne="Timeout exceeded";function OSe(){return new Error(Qne)}function fft(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===Qne}function PSe(t){kr.request.crossOriginNoCorsDomains||(kr.request.crossOriginNoCorsDomains={});const e=kr.request.crossOriginNoCorsDomains;for(let r of t)r=r.toLowerCase(),/^https?:\/\//.test(r)?e[Hh(r)??""]=0:(e[Hh("http://"+r)??""]=0,e[Hh("https://"+r)??""]=0)}function MSe(t){const e=kr.request.crossOriginNoCorsDomains;if(e){let r=Hh(t);if(r)return r=r.toLowerCase(),!Sx(r,Zz())&&e[r]<Date.now()-36e5}return!1}async function $Se(t){var s;const e=kr.request.crossOriginNoCorsDomains,r=Hh(t);e&&r&&(e[r.toLowerCase()]=Date.now());const i=Wn(t);t=i.path,((s=i.query)==null?void 0:s.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function Hi(t,e){var c;t instanceof URL&&(t=t.toString()),(e==null?void 0:e.query)instanceof URLSearchParams&&(e.query=Jz(e.query.toString().replaceAll("+"," ")));const r=qp(t),i=TC(t);i||r||(t=rm(t));const s={url:t,requestOptions:{...e}};let n=zne(t);if(n){const u=await BSe(n,s);if(u!=null)return{data:u,getHeader:o7,httpStatus:200,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"&&(te("host-webworker")||te("host-node")))throw Sp("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(e.method==="head"){if(e.body)throw Sp("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(r||i)throw Sp("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await FSe(),_$)return _$.execute(t,e);const o=new AbortController;Uo(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:Eh.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await VSe(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let _$;const Eh=kr.request,Kne="FormData"in globalThis,ISe=new Set([499,498,403,401]),LSe=new Set(["COM_0056","COM_0057","SB_0008"]),DSe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],o7=()=>null,v$=Symbol();function NSe(t){const e=Hh(t);e&&!Hi._corsServers.includes(e)&&Hi._corsServers.push(e)}function Bq(t){const e=Hh(t);return!e||e.endsWith(".arcgis.com")||Hi._corsServers.includes(e)||Kz(e)}function Sp(t,e,r,i){let s="Error";const n={url:r.url,requestOptions:r.requestOptions,getHeader:o7,ssl:!1};if(e instanceof X)return e.details?(e.details=ye(e.details),e.details.url=r.url,e.details.requestOptions=r.requestOptions):e.details=n,e;if(e){const o=i&&(c=>i.headers.get(c)),a=i==null?void 0:i.status,l=e.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=v$ in e?e[v$]:e}return Os(e)?ur():new X(t,s,n)}async function FSe(){te("host-webworker")?_$||(_$=await he(()=>import("./request-5523124f.js"),[],import.meta.url)):Hi._abortableFetch||(Hi._abortableFetch=globalThis.fetch.bind(globalThis))}async function m8(){Qi||await he(()=>import("./IdentityManager-cab09e09.js"),["./IdentityManager-cab09e09.js","./widget-f26105cd.js"],import.meta.url)}async function USe(t){var a;const e=t.params.url,r=t.params.requestOptions,i=t.controller.signal,s=r.body;let n=null,o=null;if(Kne&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:r.cacheBust&&!("polyfill"in Hi._abortableFetch)?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:Eh.priority,redirect:"follow",signal:i},(n||o)&&(t.fetchOptions.body=n||o),r.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=r.query)!=null&&a.token||n!=null&&n.get("token")),!t.hasToken&&kr.apiKey&&Zne(e)&&(r.query||(r.query={}),r.query.token=kr.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!eoe(e)&&!Ys(i)){let l;r.authMode==="immediate"?(await m8(),l=await Qi.getCredential(e,{signal:i}),t.credential=l):r.authMode==="no-prompt"?(await m8(),l=await Qi.getCredential(e,{prompt:!1,signal:i}).catch(()=>{}),t.credential=l):Qi&&(l=Qi.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function eoe(t){return DSe.some(e=>e.test(t))}async function kSe(t){let e=t.params.url;const r=t.params.requestOptions,i=t.fetchOptions??{},s=TC(e)||qp(e),n=r.responseType||"json",o=s?0:r.timeout!=null?r.timeout:Eh.timeout;let a=!1;if(!s){t.useSSL&&(e=i7(e)),r.cacheBust&&i.cache==="default"&&(e=qne(e,"request.preventCache",Date.now()));let p={...r.query};t.credentialToken&&(p.token=t.credentialToken);let g=xC(p);te("esri-url-encodes-apostrophe")&&(g=g.replaceAll("'","%27"));const y=e.length+1+g.length;let _;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||y>Eh.maxUrlLength;const v=r.useProxy||!!VL(e);if(v){const w=hSe(e);_=w.path,!a&&_.length+1+y>Eh.maxUrlLength&&(a=!0),w.query&&(p={...w.query,...p})}if(i.method==="HEAD"&&(a||v)){if(a)throw y>Eh.maxUrlLength?Sp("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):Sp("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw Sp("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?e=i4(e,p):(i.body=xC(p),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):e=i4(e,p),v&&(t.useProxy=!0,e=`${_}?${e}`),p.token&&Kne&&i.body instanceof FormData&&!KTe(e)&&i.body.set("token",p.token),r.hasOwnProperty("withCredentials"))t.withCredentials=r.withCredentials;else if(!Sx(e,Zz())){if(Kz(e))t.withCredentials=!0;else if(Qi){const w=Qi.findServerInfo(e);w!=null&&w.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(i.credentials="include",MSe(e)&&await $Se(a?i4(e,p):e))}let l,c,u=0,d=!1;o>0&&(u=setTimeout(()=>{d=!0,t.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=e;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||zSe(r.headers)||!s&&!t.useProxy&&Eh.proxyUrl&&!Bq(e)){if(l=await Hi._abortableFetch(e,i),t.useProxy||NSe(e),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=zq(c,"application/xml");break;case"document":c=zq(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const p=l.headers.get("Content-Type");if(p&&/application\/json|text\/plain/i.test(p)&&c[n==="blob"?"size":"byteLength"]<=750)try{const g=await new Response(c).json();g.error&&(c=g)}catch{}}n==="image"&&c instanceof Blob&&(c=await Vq(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await Vq(e,t)}catch(p){if(p.name==="AbortError")throw d?OSe():ur("Request canceled");if(!(!l&&p instanceof TypeError&&Eh.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||t.useProxy||Bq(e))throw p;t.redoRequest=!0,dSe({proxyUrl:Eh.proxyUrl,urlPrefix:Hh(e)??""})}finally{u&&clearTimeout(u)}return[l,c]}async function BSe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let r,i;try{i=await t.before(e)}catch(s){r=Sp("request:interceptor",s,e)}if((i instanceof Error||i instanceof X)&&(r=Sp("request:interceptor",i,e)),r)throw t.error&&t.error(r),r;return i}}function zSe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function zq(t,e){let r;try{r=new DOMParser().parseFromString(t,e)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function VSe(t){var n,o;let e,r;await USe(t);try{do[e,r]=await kSe(t);while(!await GSe(t,e,r))}catch(a){const l=Sp("request:server",a,t.params,e);throw l.details.ssl=t.useSSL,(n=t.interceptor)!=null&&n.error&&t.interceptor.error(l),l}const i=t.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!t.hasToken&&!t.credentialToken&&((o=r.user)!=null&&o.username)&&!Kz(i)){const a=Hh(i,!0);a&&Eh.trustedServers.push(a)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&PSe(r.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&Qi){const a=Qi.findServerInfo(s.server);let l=a==null?void 0:a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=Qi.findCredential(l,s.userId);c&&Qi._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:r,getHeader:e?a=>e==null?void 0:e.headers.get(a):o7,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function GSe(t,e,r){var c;if(t.redoRequest)return t.redoRequest=!1,!1;const i=t.params.requestOptions;if(!e||i.responseType==="native"||i.responseType==="native-request-init")return!0;let s,n;if(r&&(r.error?s=r.error:r.status==="error"&&Array.isArray(r.messages)&&(s={...r},s[v$]=r,s.details=r.messages)),!s&&!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[v$]=r,s;let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o==null?void 0:o.toUpperCase());const l=i.authMode;if(n===403&&(a===4||(c=s.message)!=null&&c.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&ISe.has(n)&&!eoe(t.params.url)&&(n!==403||(!o||!LSe.has(o))&&(a==null||a===2&&t.credentialToken))){await m8();try{const u=await Qi.getCredential(t.params.url,{error:Sp("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=u,t.credentialToken=u.token,t.useSSL=t.useSSL||u.ssl,!1}catch(u){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=u}}if(s)throw s;return!0}function Vq(t,e,r=!1){const i=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Eh.priority,s.src=t,Jne(s,t,r,i)}Hi._abortableFetch=null,Hi._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];let xP=class toe{constructor(){this._emitter=new toe.EventEmitter(this)}emit(e,r){return this._emitter.emit(e,r)}on(e,r){return this._emitter.on(e,r)}once(e,r){return this._emitter.once(e,r)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){var s;(s=this._listenersMap)==null||s.clear(),this._listenersMap=null}destroy(){this.clear()}emit(s,n){var c;let o=(c=this._listenersMap)==null?void 0:c.get(s);if(!o)return!1;const a=this._target||this;let l=!1;for(const u of o.slice()){const d="deref"in u?u.deref():u;d?d==null||d.call(a,n):l=!0}return l&&(o=o.filter(u=>!("deref"in u)||u.deref()!=null),this._listenersMap.set(s,o)),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return U1(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),Rr(()=>{var c;const a=(c=this._listenersMap)==null?void 0:c.get(s),l=(a==null?void 0:a.indexOf(n))??-1;l>=0&&a.splice(l,1)})}once(s,n){const o=this.on(s,a=>{o.remove();const l="deref"in n?n.deref():n;l==null||l.call(null,a)});return o}hasEventListener(s){var o;const n=(o=this._listenersMap)==null?void 0:o.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=i=>{let s=class extends i{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=h([k("esri.core.Evented")],s),s};let r=class extends xe{constructor(){super(...arguments),this._emitter=new xP.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,s){return this._emitter.emit(i,s)}on(i,s){return this._emitter.on(i,s)}once(i,s){return this._emitter.once(i,s)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=h([k("esri.core.Evented")],r),t.EventedAccessor=r})(xP||(xP={}));const Ps=xP;var qr;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(qr||(qr={}));function roe(t){return(e,r)=>{e[r]=t}}let E3=class extends Xse{notify(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onInvalidated(),i.onCommitted()}}};var jf;let jSe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},HSe=class{constructor(e,r,i,s,n){this.target=e,this.added=r,this.removed=i,this.start=s,this.deleteCount=n}};const Nc=new Vo(jSe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1});function s4(t){return t?t instanceof Q_?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function n4(t){if(t!=null&&t.length)return t[0]}function qSe(t,e,r,i){const s=Math.min(t.length-r,e.length-i);let n=0;for(;n<s&&t[r+n]===e[i+n];)n++;return n}function ioe(t,e,r,i){e&&e.forEach((s,n,o)=>{t.push(s),ioe(t,r.call(i,s,n,o),r,i)})}const qm=new Set,Wm=new Set,Ym=new Set,o4=new Map;let WSe=0,Q_=jf=class extends Ps.EventedAccessor{static isCollection(t){return t!=null&&t instanceof jf}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new E3,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:WSe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof jf?{items:t}:t:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return xt(this._observable),this._items}set items(t){this._emitBeforeChanges(qr.ADD)||(this._splice(0,this.length,s4(t)),this._emitAfterChanges(qr.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const r=this._chgListeners,i={removed:!1,callback:e};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),Rr(()=>{i.removed=!0,r.splice(r.indexOf(i),1)})}return this._emitter.on(t,e)}once(t,e){const r="deref"in e?()=>e.deref():()=>e,i=this.on(t,s=>{var n;(n=r())==null||n.call(null,s),i.remove()});return i}add(t,e){if(xt(this._observable),this._emitBeforeChanges(qr.ADD))return this;const r=this.getNextIndex(e??null);return this._splice(r,0,[t]),this._emitAfterChanges(qr.ADD),this}addMany(t,e=this._items.length){if(xt(this._observable),!(t!=null&&t.length))return this;if(this._emitBeforeChanges(qr.ADD))return this;const r=this.getNextIndex(e);return this._splice(r,0,s4(t)),this._emitAfterChanges(qr.ADD),this}at(t){if(xt(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(xt(this._observable),!this.length||this._emitBeforeChanges(qr.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(qr.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return xt(this._observable),this._createNewInstance({items:this._items.map(ye)})}concat(...t){xt(this._observable);const e=t.map(s4);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(xt(this._observable),!this.length||this._emitBeforeChanges(qr.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let s=0;s<i;s++)t.call(e,r[s],s,r);this._emitAfterChanges(qr.REMOVE)}every(t,e){return xt(this._observable),this._items.every(t,e)}filter(t,e){let r;return xt(this._observable),r=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:r})}find(t,e){return xt(this._observable),this._items.find(t,e)}findIndex(t,e){return xt(this._observable),this._items.findIndex(t,e)}flatten(t,e){xt(this._observable);const r=[];return ioe(r,this,t,e),new jf(r)}forEach(t,e){return xt(this._observable),this._items.forEach(t,e)}getItemAt(t){return xt(this._observable),this._items[t]}getNextIndex(t){xt(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return xt(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return xt(this._observable),this._items.indexOf(t,e)}join(t=","){return xt(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return xt(this._observable),this._items.lastIndexOf(t,e)}map(t,e){xt(this._observable);const r=this._items.map(t,e);return new jf({items:r})}reorder(t,e=this.length-1){xt(this._observable);const r=this.indexOf(t);if(r!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),r!==e){if(this._emitBeforeChanges(qr.MOVE))return t;this._splice(r,1),this._splice(e,0,[t]),this._emitAfterChanges(qr.MOVE)}return t}}pop(){if(xt(this._observable),!this.length||this._emitBeforeChanges(qr.REMOVE))return;const t=n4(this._splice(this.length-1,1));return this._emitAfterChanges(qr.REMOVE),t}push(...t){return xt(this._observable),this._emitBeforeChanges(qr.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(qr.ADD)),this.length}reduce(t,e){xt(this._observable);const r=this._items;return arguments.length===2?r.reduce(t,e):r.reduce(t)}reduceRight(t,e){xt(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(t,e):r.reduceRight(t)}remove(t){return xt(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(xt(this._observable),t<0||t>=this.length||this._emitBeforeChanges(qr.REMOVE))return;const e=n4(this._splice(t,1));return this._emitAfterChanges(qr.REMOVE),e}removeMany(t){if(xt(this._observable),!(t!=null&&t.length)||this._emitBeforeChanges(qr.REMOVE))return[];const e=t instanceof jf?t.toArray():t,r=this._items,i=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=r.indexOf(o);if(a>-1){const l=1+qSe(e,r,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),n+=l-1}}return this._emitAfterChanges(qr.REMOVE),i}reverse(){if(xt(this._observable),this._emitBeforeChanges(qr.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(qr.MOVE),this}shift(){if(xt(this._observable),!this.length||this._emitBeforeChanges(qr.REMOVE))return;const t=n4(this._splice(0,1));return this._emitAfterChanges(qr.REMOVE),t}slice(t=0,e=this.length){return xt(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return xt(this._observable),this._items.some(t,e)}sort(t){if(xt(this._observable),!this.length||this._emitBeforeChanges(qr.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(qr.MOVE),this}splice(t,e,...r){xt(this._observable);const i=(e?qr.REMOVE:0)|(r.length?qr.ADD:0);if(this._emitBeforeChanges(i))return[];const s=this._splice(t,e,r)||[];return this._emitAfterChanges(i),s}toArray(){return xt(this._observable),this._items.slice()}toJSON(){return xt(this._observable),this.toArray()}toLocaleString(){return xt(this._observable),this._items.toLocaleString()}toString(){return xt(this._observable),this._items.toString()}unshift(...t){return xt(this._observable),!t.length||this._emitBeforeChanges(qr.ADD)||(this._splice(0,0,t),this._emitAfterChanges(qr.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,r){const i=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=w2(()=>this._dispatchChange())),t<0&&(t+=this.length),e){if(o=i.splice(t,e),this.hasEventListener("before-remove")){const a=Nc.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(t,0,n),t+=1,l-=1,c-=1);Nc.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Nc.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Nc.release(a)}}if(r!=null&&r.length){if(s){const u=[];for(const d of r){const p=s.ensureType(d);p==null&&d!=null||u.push(p)}r=u}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const u=Nc.acquire();u.target=this,u.cancellable=!0;const d=Nc.acquire();d.target=this,d.cancellable=!1;for(const p of r)a?(u.reset(p),this.emit("before-add",u),u.defaultPrevented||(c?i.push(p):i.splice(t++,0,p),this._set("length",i.length),l&&(d.reset(p),this.emit("after-add",d)))):(c?i.push(p):i.splice(t++,0,p),this._set("length",i.length),d.reset(p),this.emit("after-add",d));Nc.release(d),Nc.release(u)}else{if(c)for(const u of r)i.push(u);else i.splice(t,0,...r);this._set("length",i.length)}}if((r!=null&&r.length||o!=null&&o.length)&&this._notifyChangeEvent(r,o),this.hasEventListener("after-splice")){const a=new HSe(this,r,o,t,e);this.emit("after-splice",a)}return o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const r=Nc.acquire();r.target=this,r.cancellable=!0,r.type=t,this.emit("before-changes",r),e=r.defaultPrevented,Nc.release(r)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=Nc.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),Nc.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const r=e.changes;qm.clear(),Wm.clear(),Ym.clear();for(const{added:l,removed:c}of r){if(l)if(Ym.size===0&&Wm.size===0)for(const u of l)qm.add(u);else for(const u of l)Wm.has(u)?(Ym.add(u),Wm.delete(u)):Ym.has(u)||qm.add(u);if(c)if(Ym.size===0&&qm.size===0)for(const u of c)Wm.add(u);else for(const u of c)qm.has(u)?qm.delete(u):(Ym.delete(u),Wm.add(u))}const i=bl.acquire();qm.forEach(l=>{i.push(l)});const s=bl.acquire();Wm.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=bl.acquire();if(Ym.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(i.length||s.length||a.length)){const l={target:this,added:i,removed:s,moved:a},c=e.listeners.length;for(let u=0;u<c;u++){const d=e.listeners[u];d.removed||d.callback.call(this,l)}}bl.release(i),bl.release(s),bl.release(a)}qm.clear(),Wm.clear(),Ym.clear()}};Q_.ofType=t=>{if(!t)return jf;if(o4.has(t))return o4.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const i in t.typeMap){const s=t.typeMap[i].prototype.declaredClass;e?e+=` | ${s}`:e=s}let r=class extends jf{};return h([roe({Type:t,ensureType:typeof t=="function"?ya(t):k0(t)})],r.prototype,"itemType",void 0),r=h([k(`esri.core.Collection<${e}>`)],r),o4.set(t,r),r},h([f()],Q_.prototype,"length",void 0),h([f()],Q_.prototype,"items",null),Q_=jf=h([k("esri.core.Collection")],Q_);const St=Q_;function V1(t,e,r=St){return e||(e=new r),e===t||(e.removeAll(),YSe(t)?e.addMany(t):t&&e.add(t)),e}function soe(t){return t}function YSe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}var Qg;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(Qg||(Qg={}));let XSe=class{constructor(){this._resolver=Go(),this._status=Qg.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=Qg.RESOLVED,this._cleanUp()},()=>{this._status=Qg.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===Qg.RESOLVED}isRejected(){return this._status===Qg.REJECTED}isFulfilled(){return this._status!==Qg.PENDING}abort(){this._resolver.reject(ur())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=Go(),r=[...this._resolvingPromises,e.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==i||Os(s)||this._resolver.reject(s)}),e.resolve()}};const a7=t=>{let e=class extends t{constructor(...r){super(...r),this._promiseProps=new XSe,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return this._promiseProps.promise.then(()=>this).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return e=h([k("esri.core.Promise")],e),e};let b$=class extends a7(xe){};b$=h([k("esri.core.Promise")],b$);const ZSe="not-loaded",JSe="loading",QSe="failed",Gq="loaded",noe=t=>{let e=class extends t{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=UL(n,l);this.destroyed&&l(new X("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===ZSe){this._set("loadStatus",JSe);const a=this._loadController=new AbortController;s({signal:a.signal})}return i(),o}})),this.when(()=>{this._set("loadStatus",Gq),this._loadController=null},i=>{this._set("loadStatus",QSe),this._set("loadError",i),this._loadController=null})}destroy(){this._loadController&&(this._loadController=Ml(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===Gq}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var r;return this.isFulfilled()||(this._set("loadError",new X("load:cancelled","Cancelled")),(r=this._loadController)==null||r.abort(),this._promiseProps.abort()),this}};return h([f({readOnly:!0})],e.prototype,"loaded",null),h([f({readOnly:!0})],e.prototype,"loadError",void 0),h([f({clonable:!1})],e.prototype,"loadStatus",void 0),h([f({type:[z1],readOnly:!0})],e.prototype,"loadWarnings",null),e=h([k("esri.core.Loadable")],e),e};let ZT=class extends noe(b$){};ZT=h([k("esri.core.Loadable")],ZT),function(t){function e(r){return!(!r||!r.load)}t.LoadableMixin=noe,t.isLoadable=e}(ZT||(ZT={}));const z0=ZT;function jL(t,e,r){return kL(t.map((i,s)=>e.apply(r,[i,s])))}async function KSe(t,e,r){return(await kL(t.map((i,s)=>e.apply(r,[i,s])))).map(i=>i.value)}function l7(t){return{ok:!0,value:t}}function c7(t){return{ok:!1,error:t}}function eEe(t){return t!=null&&t.ok===!0?t.value:null}function tEe(t){return t!=null&&t.ok===!1?t.error:null}async function mm(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return l7(await t)}catch(e){return c7(e)}}async function wft(t){try{return l7(await t)}catch(e){return ly(e),c7(e)}}function xft(t){if(t.ok===!0)return t.value;throw t.error}function cy(t,e){return new Og(t,e)}let Og=class extends xe{get value(){return eEe(this._result)}get error(){return tEe(this._result)}get finished(){return this._result!=null}constructor(e,r){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=Ml(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=e(i),this.promise.then(s=>{this._result=l7(s),this._cleanup()},s=>{this._result=c7(s),this._cleanup()}),this._abortHandle=Uo(r,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=di(this._abortHandle),this._abortController=null}};h([f()],Og.prototype,"value",null),h([f()],Og.prototype,"error",null),h([f()],Og.prototype,"finished",null),h([f()],Og.prototype,"promise",void 0),h([f()],Og.prototype,"_result",void 0),Og=h([k("esri.core.asyncUtils.ReactiveTask")],Og);async function ooe(t,e){return await t.load(),rEe(t,e)}async function rEe(t,e){const r=[],i=(...n)=>{for(const o of n)o!=null&&(Array.isArray(o)?i(...o):St.isCollection(o)?o.forEach(a=>i(a)):z0.isLoadable(o)&&r.push(o))};e(i);let s=null;if(await KSe(r,async n=>{const o=await mm(iEe(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function iEe(t){return"loadAll"in t&&typeof t.loadAll=="function"}function ni(t,e,r){let i,s;return e===void 0?(s=t,i=[void 0]):typeof e!="string"?(s=t,i=[void 0],r=e):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of i){const c=wne(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}let Pc=class{constructor(e,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,s,n)=>{const o=this.toJSON(i);o!==void 0&&v2(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const r=this._apiToJSON[e];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const r={};for(const i in e)r[e[i]]=i;return r}_getKeysSorted(e){const r=[];for(const i in e)r.push(i);return r.sort(),r}};function Ic(){return function(t,e){return new Pc(t,{ignoreUnknown:!0,...e})}}let u7=class{constructor(e,r,i,s){this.semiMajorAxis=e,this.flattening=r,this.outerAtmosphereRimWidth=i;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const mr=new u7(6378137,1/298.257223563,3e5,.006694379990137799),Ep=new u7(3396190,1/169.8944472236118,23e4),gm=new u7(1737400,0,0),sEe=ne.getLogger("esri.assets");function nEe(t,e){return Hi(ei(t),e)}function ei(t){if(!kr.assetsPath)throw sEe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new X("assets:path-not-set","config.assetsPath is not set");return GL(kr.assetsPath,t)}let a4,Q=null;function aoe(){return!!Q}function oEe(){return!!te("esri-wasm")}function loe(){return a4||(a4=he(()=>import("./pe-wasm-f59cdabd.js"),[],import.meta.url).then(t=>t.p).then(({default:t})=>t({locateFile:e=>ei(`esri/geometry/support/${e}`)})).then(t=>{uoe(t)}),a4)}var g8,_s,y8;(function(t){function e(n,o,a){Q.ensureCache.prepare();const l=K_(a),c=a===l,u=Q.ensureFloat64(l),d=Q._pe_geog_to_proj(Q.getPointer(n),o,u);return d&&o0(a,o,u,c),d}function r(n,o,a,l){switch(l){case _s.PE_TRANSFORM_P_TO_G:return i(n,o,a);case _s.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function i(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){Q.ensureCache.prepare();const c=K_(a),u=a===c,d=Q.ensureFloat64(c),p=Q._pe_proj_to_geog_center(Q.getPointer(n),o,d,l);return p&&o0(a,o,d,u),p}t.geogToProj=e,t.projGeog=r,t.projToGeog=i,t.projToGeogCenter=s})(g8||(g8={})),function(t){function e(){t.PE_BUFFER_MAX=Q.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=Q.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=Q.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=Q.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=Q.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=Q.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=Q.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=Q.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=Q.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=Q.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=Q.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=Q.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=Q.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=Q.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=Q.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=Q.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=Q.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=Q.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=Q.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=Q.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_STR_FMT_WKT=Q.PeDefs.prototype.PE_STR_FMT_WKT,t.PE_STR_FMT_WKT2=Q.PeDefs.prototype.PE_STR_FMT_WKT2,t.PE_PARM_X0=Q.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=Q.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=Q.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=Q.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=Q.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=Q.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=Q.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=Q.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=Q.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=Q.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(_s||(_s={})),function(t){const e={},r={},i=g=>{if(g){const y=g.getType();switch(y){case _s.PE_TYPE_GEOGCS:g=Q.castObject(g,Q.PeGeogcs);break;case _s.PE_TYPE_PROJCS:g=Q.castObject(g,Q.PeProjcs);break;case _s.PE_TYPE_GEOGTRAN:g=Q.castObject(g,Q.PeGeogtran);break;default:y&_s.PE_TYPE_UNIT&&(g=Q.castObject(g,Q.PeUnit))}}return g};function s(){Q.PeFactory.prototype.initialize(null)}function n(g){return o(_s.PE_TYPE_COORDSYS,g)}function o(g,y){let _=null,v=e[g];if(v||(v={},e[g]=v),v.hasOwnProperty(String(y)))_=v[y];else{const w=Q.PeFactory.prototype.factoryByType(g,y);Q.compare(w,Q.NULL)||(_=w,v[y]=_)}return _=i(_),_}function a(g,y){let _=null,v=r[g];if(v||(v={},r[g]=v),v.hasOwnProperty(y))_=v[y];else{const w=Q.PeFactory.prototype.fromString(g,y);Q.compare(w,Q.NULL)||(_=w,v[y]=_)}return _=i(_),_}function l(g){return o(_s.PE_TYPE_GEOGCS,g)}function c(g){return o(_s.PE_TYPE_GEOGTRAN,g)}function u(g){return Q.PeFactory.prototype.getCode(g)}function d(g){return o(_s.PE_TYPE_PROJCS,g)}function p(g){return o(_s.PE_TYPE_UNIT,g)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=u,t.projcs=d,t.unit=p}(y8||(y8={}));let coe=null;var w$,_8,v8,b8,x$,w8,T$,S$,x8;function uoe(t){function e(n,o,a){n[o]=a(n[o])}Q=t,_s.init(),w$.init(),x$.init(),T$.init(),S$.init(),coe=class extends Q.PeGCSExtent{destroy(){Q.destroy(this)}};const r=[Q.PeDatum,Q.PeGeogcs,Q.PeGeogtran,Q.PeObject,Q.PeParameter,Q.PePrimem,Q.PeProjcs,Q.PeSpheroid,Q.PeUnit];for(const n of r)e(n.prototype,"getName",o=>function(){return o.call(this,new Array(_s.PE_NAME_MAX))});for(const n of[Q.PeGeogtran,Q.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array(_s.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const u=Q.getValue(l,"*");a[c]=u?Q.wrapPointer(u,Q.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(Q.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return o0(a,o,n.call(this)),a}),e(Q.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=Q._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!Q.compare(l,Q.NULL)){a=[l];const c=this.getSteps();if(c>1){const u=Q.getPointer(l);for(let d=1;d<c;d++)a.push(Q.wrapPointer(u+o*d,Q.PeGTlistExtendedGTs))}}return a}});const i=Q._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!Q.compare(l,Q.NULL)){a=[l];const c=l.getNump();if(c>1){const u=Q.getPointer(l);for(let d=1;d<c;d++)a.push(Q.wrapPointer(u+i*d,Q.PeHorizon))}}return o.set(n,a),a};e(Q.PeProjcs.prototype,"horizonGcsGenerate",s),e(Q.PeProjcs.prototype,"horizonPcsGenerate",s),Q.PeObject.prototype.toString=function(n=_s.PE_STR_OPTS_NONE){Q.ensureCache.prepare();const o=Q.getPointer(this),a=Q.ensureInt8(new Array(_s.PE_BUFFER_MAX));return Q.UTF8ToString(Q._pe_object_to_string_ext(o,n,a))}}function af(t){if(!t)return;const e=Q.getClass(t);if(!e)return;const r=Q.getCache(e);if(!r)return;const i=Q.getPointer(t);i&&delete r[i]}function CA(t,e){const r=[],i=new Array(e);for(let s=0;s<t;s++)r.push(Q.ensureInt8(i));return r}function K_(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(r=>{e.push(r[0],r[1])})):e=t,e}function o0(t,e,r,i=!1){if(i)for(let s=0;s<2*e;s++)t[s]=Q.getValue(r+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=Q.getValue(r,"double"),t[n][1]=Q.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function r(){t.PE_GTLIST_OPTS_COMMON=Q.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=Q._pe_getPeGTlistExtendedEntrySize()}function i(s,n,o,a,l,c){let u=null;const d=new Q.PeInteger(c);try{const p=Q.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,d);if((c=d.val)&&(u=[p],c>1)){const g=Q.getPointer(p);for(let y=1;y<c;y++)u.push(Q.wrapPointer(g+e*y,Q.PeGTlistExtendedEntry))}}finally{Q.destroy(d)}return u}t.init=r,t.getGTlist=i})(w$||(w$={})),function(t){function e(r){if(r!=null&&r.length){for(const i of r)af(i),i.getEntries().forEach(s=>{af(s);const n=s.getGeogtran();af(n),n.getParameters().forEach(af),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{af(o);const a=o.getDatum();af(a),af(a.getSpheroid()),af(o.getPrimem()),af(o.getUnit())})});Q.PeGTlistExtendedEntry.prototype.Delete(r[0])}}t.destroy=e}(_8||(_8={})),function(t){function e(r,i,s,n,o){Q.ensureCache.prepare();const a=K_(s),l=s===a,c=Q.ensureFloat64(a);let u=0;n&&(u=Q.ensureFloat64(n));const d=Q._pe_geog_to_geog(Q.getPointer(r),i,c,u,o);return d&&o0(s,i,c,l),d}t.geogToGeog=e}(v8||(v8={})),function(t){const e=(c,u,d,p,g,y)=>{let _,v;switch(Q.ensureCache.prepare(),c){case"dd":_=Q._pe_geog_to_dd,v=_s.PE_DD_MAX;break;case"ddm":_=Q._pe_geog_to_ddm,v=_s.PE_DDM_MAX;break;case"dms":_=Q._pe_geog_to_dms,v=_s.PE_DMS_MAX}let w=0;u&&(w=Q.getPointer(u));const x=K_(p),T=Q.ensureFloat64(x),S=CA(d,v),C=_(w,d,T,g,Q.ensureInt32(S));if(C)for(let A=0;A<d;A++)y[A]=Q.UTF8ToString(S[A]);return C},r=(c,u,d,p,g)=>{let y;switch(Q.ensureCache.prepare(),c){case"dd":y=Q._pe_dd_to_geog;break;case"ddm":y=Q._pe_ddm_to_geog;break;case"dms":y=Q._pe_dms_to_geog}let _=0;u&&(_=Q.getPointer(u));const v=p.map(S=>Q.ensureString(S)),w=Q.ensureInt32(v),x=Q.ensureFloat64(new Array(2*d)),T=y(_,d,w,x);return T&&o0(g,d,x),T};function i(c,u,d,p,g){return e("dms",c,u,d,p,g)}function s(c,u,d,p){return r("dms",c,u,d,p)}function n(c,u,d,p,g){return e("ddm",c,u,d,p,g)}function o(c,u,d,p){return r("ddm",c,u,d,p)}function a(c,u,d,p,g){return e("dd",c,u,d,p,g)}function l(c,u,d,p){return r("dd",c,u,d,p)}t.geogToDms=i,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(b8||(b8={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=Q.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=Q.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=Q.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=Q.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=Q.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(s,n,o,a,l,c,u){Q.ensureCache.prepare();let d=0;s&&(d=Q.getPointer(s));const p=K_(o),g=Q.ensureFloat64(p),y=CA(n,_s.PE_MGRS_MAX),_=Q.ensureInt32(y),v=Q._pe_geog_to_mgrs_extended(d,n,g,a,l,c,_);if(v)for(let w=0;w<n;w++)u[w]=Q.UTF8ToString(y[w]);return v}function i(s,n,o,a,l){Q.ensureCache.prepare();let c=0;s&&(c=Q.getPointer(s));const u=o.map(y=>Q.ensureString(y)),d=Q.ensureInt32(u),p=Q.ensureFloat64(new Array(2*n)),g=Q._pe_mgrs_to_geog_extended(c,n,d,a,p);return g&&o0(l,n,p),g}t.init=e,t.geogToMgrsExtended=r,t.mgrsToGeogExtended=i}(x$||(x$={})),function(t){function e(i,s,n,o,a,l,c){Q.ensureCache.prepare();let u=0;i&&(u=Q.getPointer(i));const d=K_(n),p=Q.ensureFloat64(d),g=CA(s,_s.PE_MGRS_MAX),y=Q.ensureInt32(g),_=Q._pe_geog_to_usng(u,s,p,o,a,l,y);if(_)for(let v=0;v<s;v++)c[v]=Q.UTF8ToString(g[v]);return _}function r(i,s,n,o){Q.ensureCache.prepare();let a=0;i&&(a=Q.getPointer(i));const l=n.map(p=>Q.ensureString(p)),c=Q.ensureInt32(l),u=Q.ensureFloat64(new Array(2*s)),d=Q._pe_usng_to_geog(a,s,c,u);return d&&o0(o,s,u),d}t.geogToUsng=e,t.usngToGeog=r}(w8||(w8={})),function(t){function e(){t.PE_UTM_OPTS_NONE=Q.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=Q.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=Q.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(s,n,o,a,l){Q.ensureCache.prepare();let c=0;s&&(c=Q.getPointer(s));const u=K_(o),d=Q.ensureFloat64(u),p=CA(n,_s.PE_UTM_MAX),g=Q.ensureInt32(p),y=Q._pe_geog_to_utm(c,n,d,a,g);if(y)for(let _=0;_<n;_++)l[_]=Q.UTF8ToString(p[_]);return y}function i(s,n,o,a,l){Q.ensureCache.prepare();let c=0;s&&(c=Q.getPointer(s));const u=o.map(y=>Q.ensureString(y)),d=Q.ensureInt32(u),p=Q.ensureFloat64(new Array(2*n)),g=Q._pe_utm_to_geog(c,n,d,a,p);return g&&o0(l,n,p),g}t.init=e,t.geogToUtm=r,t.utmToGeog=i}(T$||(T$={})),function(t){const e=new Map;function r(){t.PE_PCSINFO_OPTION_NONE=Q.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=Q.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=Q.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=Q.PePCSInfo.prototype.PE_POLE_POINT}function i(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=Q.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=r,t.generate=i}(S$||(S$={})),function(t){function e(){return Q.PeVersion.prototype.version_string()}t.versionString=e}(x8||(x8={}));const aEe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return g8},get PeDefs(){return _s},get PeFactory(){return y8},get PeGCSExtent(){return coe},get PeGTTransformations(){return v8},get PeGTlistExtended(){return w$},get PeGTlistExtendedEntry(){return _8},get PeNotationDms(){return b8},get PeNotationMgrs(){return x$},get PeNotationUsng(){return w8},get PeNotationUtm(){return T$},get PePCSInfo(){return S$},get PeVersion(){return x8},_init:uoe,get _pe(){return Q},isLoaded:aoe,isSupported:oEe,load:loe},Symbol.toStringTag,{value:"Module"}));var _u;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(_u||(_u={}));let m;const M={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1};for(m=2e3;m<=2045;m++)M[m]=0;for(m=2056;m<=2065;m++)M[m]=0;for(m=2067;m<=2135;m++)M[m]=0;for(m=2137;m<=2154;m++)M[m]=0;for(m=2161;m<=2170;m++)M[m]=0;for(m=2172;m<=2193;m++)M[m]=0;for(m=2195;m<=2198;m++)M[m]=0;for(m=2200;m<=2203;m++)M[m]=0;for(m=2205;m<=2217;m++)M[m]=0;for(m=2222;m<=2224;m++)M[m]=1;for(m=2225;m<=2250;m++)M[m]=2;for(m=2251;m<=2253;m++)M[m]=1;for(m=2257;m<=2264;m++)M[m]=2;for(m=2274;m<=2279;m++)M[m]=2;for(m=2280;m<=2282;m++)M[m]=1;for(m=2283;m<=2289;m++)M[m]=2;for(m=2290;m<=2292;m++)M[m]=0;for(m=2308;m<=2313;m++)M[m]=0;for(m=2315;m<=2491;m++)M[m]=0;for(m=2494;m<=2866;m++)M[m]=0;for(m=2867;m<=2869;m++)M[m]=1;for(m=2870;m<=2888;m++)M[m]=2;for(m=2891;m<=2895;m++)M[m]=2;for(m=2896;m<=2898;m++)M[m]=1;for(m=2902;m<=2908;m++)M[m]=2;for(m=2915;m<=2920;m++)M[m]=2;for(m=2921;m<=2923;m++)M[m]=1;for(m=2924;m<=2930;m++)M[m]=2;for(m=2931;m<=2962;m++)M[m]=0;for(m=2964;m<=2968;m++)M[m]=2;for(m=2969;m<=2973;m++)M[m]=0;for(m=2975;m<=2991;m++)M[m]=0;for(m=2995;m<=3051;m++)M[m]=0;for(m=3054;m<=3079;m++)M[m]=0;for(m=3081;m<=3088;m++)M[m]=0;for(m=3092;m<=3101;m++)M[m]=0;for(m=3106;m<=3138;m++)M[m]=0;for(m=3146;m<=3151;m++)M[m]=0;for(m=3153;m<=3166;m++)M[m]=0;for(m=3168;m<=3172;m++)M[m]=0;for(m=3174;m<=3203;m++)M[m]=0;for(m=3294;m<=3358;m++)M[m]=0;for(m=3367;m<=3403;m++)M[m]=0;for(m=3408;m<=3416;m++)M[m]=0;for(m=3417;m<=3438;m++)M[m]=2;for(m=3441;m<=3446;m++)M[m]=2;for(m=3447;m<=3450;m++)M[m]=0;for(m=3451;m<=3459;m++)M[m]=2;for(m=3460;m<=3478;m++)M[m]=0;for(m=3554;m<=3559;m++)M[m]=0;for(m=3560;m<=3570;m++)M[m]=2;for(m=3571;m<=3581;m++)M[m]=0;for(m=3594;m<=3597;m++)M[m]=0;for(m=3601;m<=3604;m++)M[m]=0;for(m=3637;m<=3639;m++)M[m]=0;for(m=3665;m<=3667;m++)M[m]=0;for(m=3693;m<=3695;m++)M[m]=0;for(m=3701;m<=3727;m++)M[m]=0;for(m=3728;m<=3739;m++)M[m]=2;for(m=3740;m<=3751;m++)M[m]=0;for(m=3753;m<=3760;m++)M[m]=2;for(m=3761;m<=3773;m++)M[m]=0;for(m=3775;m<=3777;m++)M[m]=0;for(m=3779;m<=3781;m++)M[m]=0;for(m=3783;m<=3785;m++)M[m]=0;for(m=3788;m<=3791;m++)M[m]=0;for(m=3797;m<=3802;m++)M[m]=0;for(m=3814;m<=3816;m++)M[m]=0;for(m=3825;m<=3829;m++)M[m]=0;for(m=3832;m<=3841;m++)M[m]=0;for(m=3844;m<=3852;m++)M[m]=0;for(m=3873;m<=3885;m++)M[m]=0;for(m=3890;m<=3893;m++)M[m]=0;for(m=3907;m<=3912;m++)M[m]=0;for(m=3942;m<=3950;m++)M[m]=0;for(m=3968;m<=3970;m++)M[m]=0;for(m=3973;m<=3976;m++)M[m]=0;for(m=3986;m<=3989;m++)M[m]=0;for(m=3994;m<=3997;m++)M[m]=0;for(m=4048;m<=4051;m++)M[m]=0;for(m=4056;m<=4063;m++)M[m]=0;for(m=4093;m<=4096;m++)M[m]=0;for(m=4390;m<=4398;m++)M[m]=0;for(m=4399;m<=4413;m++)M[m]=2;for(m=4418;m<=4433;m++)M[m]=2;for(m=4455;m<=4457;m++)M[m]=2;for(m=4484;m<=4489;m++)M[m]=0;for(m=4491;m<=4554;m++)M[m]=0;for(m=4568;m<=4589;m++)M[m]=0;for(m=4652;m<=4656;m++)M[m]=0;for(m=4766;m<=4800;m++)M[m]=0;for(m=5014;m<=5016;m++)M[m]=0;for(m=5069;m<=5072;m++)M[m]=0;for(m=5105;m<=5130;m++)M[m]=0;for(m=5167;m<=5188;m++)M[m]=0;for(m=5253;m<=5259;m++)M[m]=0;for(m=5269;m<=5275;m++)M[m]=0;for(m=5292;m<=5311;m++)M[m]=0;for(m=5329;m<=5331;m++)M[m]=0;for(m=5343;m<=5349;m++)M[m]=0;for(m=5355;m<=5357;m++)M[m]=0;for(m=5387;m<=5389;m++)M[m]=0;for(m=5459;m<=5463;m++)M[m]=0;for(m=5479;m<=5482;m++)M[m]=0;for(m=5518;m<=5520;m++)M[m]=0;for(m=5530;m<=5539;m++)M[m]=0;for(m=5550;m<=5552;m++)M[m]=0;for(m=5562;m<=5583;m++)M[m]=0;for(m=5623;m<=5625;m++)M[m]=2;for(m=5631;m<=5639;m++)M[m]=0;for(m=5649;m<=5653;m++)M[m]=0;for(m=5663;m<=5680;m++)M[m]=0;for(m=5682;m<=5685;m++)M[m]=0;for(m=5875;m<=5877;m++)M[m]=0;for(m=5896;m<=5899;m++)M[m]=0;for(m=5921;m<=5940;m++)M[m]=0;for(m=6050;m<=6125;m++)M[m]=0;for(m=6244;m<=6275;m++)M[m]=0;for(m=6328;m<=6348;m++)M[m]=0;for(m=6350;m<=6356;m++)M[m]=0;for(m=6366;m<=6372;m++)M[m]=0;for(m=6381;m<=6387;m++)M[m]=0;for(m=6393;m<=6404;m++)M[m]=0;for(m=6480;m<=6483;m++)M[m]=0;for(m=6511;m<=6514;m++)M[m]=0;for(m=6579;m<=6581;m++)M[m]=0;for(m=6619;m<=6624;m++)M[m]=0;for(m=6625;m<=6627;m++)M[m]=2;for(m=6628;m<=6632;m++)M[m]=0;for(m=6634;m<=6637;m++)M[m]=0;for(m=6669;m<=6692;m++)M[m]=0;for(m=6707;m<=6709;m++)M[m]=0;for(m=6720;m<=6723;m++)M[m]=0;for(m=6732;m<=6738;m++)M[m]=0;for(m=6931;m<=6933;m++)M[m]=0;for(m=6956;m<=6959;m++)M[m]=0;for(m=7005;m<=7007;m++)M[m]=0;for(m=7057;m<=7070;m++)M[m]=2;for(m=7074;m<=7082;m++)M[m]=0;for(m=7109;m<=7118;m++)M[m]=0;for(m=7119;m<=7127;m++)M[m]=1;for(m=7374;m<=7376;m++)M[m]=0;for(m=7528;m<=7586;m++)M[m]=0;for(m=7587;m<=7645;m++)M[m]=2;for(m=7692;m<=7696;m++)M[m]=0;for(m=7755;m<=7787;m++)M[m]=0;for(m=7791;m<=7795;m++)M[m]=0;for(m=7799;m<=7801;m++)M[m]=0;for(m=7803;m<=7805;m++)M[m]=0;for(m=7825;m<=7831;m++)M[m]=0;for(m=7845;m<=7859;m++)M[m]=0;for(m=8013;m<=8032;m++)M[m]=0;for(m=8065;m<=8068;m++)M[m]=1;for(m=8518;m<=8529;m++)M[m]=2;for(m=8533;m<=8536;m++)M[m]=2;for(m=8538;m<=8540;m++)M[m]=2;for(m=8677;m<=8679;m++)M[m]=0;for(m=8836;m<=8840;m++)M[m]=0;for(m=8857;m<=8859;m++)M[m]=0;for(m=8908;m<=8910;m++)M[m]=0;for(m=9154;m<=9159;m++)M[m]=0;for(m=9205;m<=9218;m++)M[m]=0;for(m=9271;m<=9273;m++)M[m]=0;for(m=9295;m<=9297;m++)M[m]=0;for(m=9356;m<=9360;m++)M[m]=0;for(m=9404;m<=9407;m++)M[m]=0;for(m=9476;m<=9482;m++)M[m]=0;for(m=9487;m<=9494;m++)M[m]=0;for(m=9697;m<=9699;m++)M[m]=0;for(m=9821;m<=9865;m++)M[m]=0;for(m=10285;m<=10291;m++)M[m]=0;for(m=10314;m<=10317;m++)M[m]=0;for(m=10448;m<=10465;m++)M[m]=0;for(m=11114;m<=11118;m++)M[m]=0;for(m=20004;m<=20032;m++)M[m]=0;for(m=20047;m<=20049;m++)M[m]=0;for(m=20062;m<=20092;m++)M[m]=0;for(m=20135;m<=20138;m++)M[m]=0;for(m=20248;m<=20258;m++)M[m]=0;for(m=20348;m<=20358;m++)M[m]=0;for(m=20436;m<=20440;m++)M[m]=0;for(m=20822;m<=20824;m++)M[m]=0;for(m=20904;m<=20932;m++)M[m]=0;for(m=20934;m<=20936;m++)M[m]=0;for(m=21004;m<=21032;m++)M[m]=0;for(m=21035;m<=21037;m++)M[m]=0;for(m=21095;m<=21097;m++)M[m]=0;for(m=21148;m<=21150;m++)M[m]=0;for(m=21207;m<=21264;m++)M[m]=0;for(m=21307;m<=21364;m++)M[m]=0;for(m=21413;m<=21423;m++)M[m]=0;for(m=21453;m<=21463;m++)M[m]=0;for(m=21473;m<=21483;m++)M[m]=0;for(m=21780;m<=21782;m++)M[m]=0;for(m=21891;m<=21894;m++)M[m]=0;for(m=21896;m<=21899;m++)M[m]=0;for(m=22171;m<=22177;m++)M[m]=0;for(m=22181;m<=22187;m++)M[m]=0;for(m=22191;m<=22197;m++)M[m]=0;for(m=22207;m<=22222;m++)M[m]=0;for(m=22229;m<=22232;m++)M[m]=0;for(m=22234;m<=22236;m++)M[m]=0;for(m=22243;m<=22250;m++)M[m]=0;for(m=22262;m<=22265;m++)M[m]=0;for(m=22307;m<=22322;m++)M[m]=0;for(m=22348;m<=22357;m++)M[m]=0;for(m=22407;m<=22422;m++)M[m]=0;for(m=22462;m<=22465;m++)M[m]=0;for(m=22521;m<=22525;m++)M[m]=0;for(m=22607;m<=22622;m++)M[m]=0;for(m=22641;m<=22646;m++)M[m]=0;for(m=22648;m<=22657;m++)M[m]=0;for(m=22707;m<=22722;m++)M[m]=0;for(m=22762;m<=22765;m++)M[m]=0;for(m=22807;m<=22822;m++)M[m]=0;for(m=22991;m<=22994;m++)M[m]=0;for(m=23028;m<=23038;m++)M[m]=0;for(m=23301;m<=23333;m++)M[m]=2;for(m=23830;m<=23853;m++)M[m]=0;for(m=23866;m<=23872;m++)M[m]=0;for(m=23877;m<=23884;m++)M[m]=0;for(m=23886;m<=23894;m++)M[m]=0;for(m=23946;m<=23948;m++)M[m]=0;for(m=24311;m<=24313;m++)M[m]=0;for(m=24342;m<=24347;m++)M[m]=0;for(m=24370;m<=24374;m++)M[m]=10;for(m=24375;m<=24381;m++)M[m]=0;for(m=24718;m<=24721;m++)M[m]=0;for(m=24817;m<=24821;m++)M[m]=0;for(m=24877;m<=24882;m++)M[m]=0;for(m=24891;m<=24893;m++)M[m]=0;for(m=25391;m<=25395;m++)M[m]=0;for(m=25828;m<=25838;m++)M[m]=0;for(m=26191;m<=26195;m++)M[m]=0;for(m=26391;m<=26393;m++)M[m]=0;for(m=26701;m<=26722;m++)M[m]=0;for(m=26729;m<=26799;m++)M[m]=2;for(m=26801;m<=26803;m++)M[m]=2;for(m=26811;m<=26813;m++)M[m]=2;for(m=26847;m<=26870;m++)M[m]=2;for(m=26891;m<=26899;m++)M[m]=0;for(m=26901;m<=26923;m++)M[m]=0;for(m=26929;m<=26946;m++)M[m]=0;for(m=26948;m<=26998;m++)M[m]=0;for(m=27037;m<=27040;m++)M[m]=0;for(m=27205;m<=27232;m++)M[m]=0;for(m=27258;m<=27260;m++)M[m]=0;for(m=27391;m<=27398;m++)M[m]=0;for(m=27561;m<=27564;m++)M[m]=0;for(m=27571;m<=27574;m++)M[m]=0;for(m=27581;m<=27584;m++)M[m]=0;for(m=27591;m<=27594;m++)M[m]=0;for(m=28191;m<=28193;m++)M[m]=0;for(m=28348;m<=28358;m++)M[m]=0;for(m=28402;m<=28432;m++)M[m]=0;for(m=28462;m<=28492;m++)M[m]=0;for(m=29118;m<=29122;m++)M[m]=0;for(m=29168;m<=29172;m++)M[m]=0;for(m=29177;m<=29185;m++)M[m]=0;for(m=29187;m<=29195;m++)M[m]=0;for(m=29900;m<=29903;m++)M[m]=0;for(m=30161;m<=30179;m++)M[m]=0;for(m=30491;m<=30494;m++)M[m]=0;for(m=30729;m<=30732;m++)M[m]=0;for(m=31251;m<=31259;m++)M[m]=0;for(m=31265;m<=31268;m++)M[m]=0;for(m=31275;m<=31279;m++)M[m]=0;for(m=31281;m<=31297;m++)M[m]=0;for(m=31461;m<=31469;m++)M[m]=0;for(m=31491;m<=31495;m++)M[m]=0;for(m=31917;m<=31922;m++)M[m]=0;for(m=31965;m<=32e3;m++)M[m]=0;for(m=32001;m<=32003;m++)M[m]=2;for(m=32005;m<=32031;m++)M[m]=2;for(m=32033;m<=32060;m++)M[m]=2;for(m=32064;m<=32067;m++)M[m]=2;for(m=32074;m<=32077;m++)M[m]=2;for(m=32081;m<=32086;m++)M[m]=0;for(m=32107;m<=32130;m++)M[m]=0;for(m=32133;m<=32159;m++)M[m]=0;for(m=32164;m<=32167;m++)M[m]=2;for(m=32180;m<=32199;m++)M[m]=0;for(m=32201;m<=32260;m++)M[m]=0;for(m=32301;m<=32360;m++)M[m]=0;for(m=32401;m<=32460;m++)M[m]=0;for(m=32501;m<=32560;m++)M[m]=0;for(m=32601;m<=32662;m++)M[m]=0;for(m=32664;m<=32667;m++)M[m]=2;for(m=32701;m<=32761;m++)M[m]=0;for(m=53001;m<=53004;m++)M[m]=0;for(m=53008;m<=53019;m++)M[m]=0;for(m=53021;m<=53032;m++)M[m]=0;for(m=53034;m<=53037;m++)M[m]=0;for(m=53042;m<=53046;m++)M[m]=0;for(m=53074;m<=53080;m++)M[m]=0;for(m=54001;m<=54004;m++)M[m]=0;for(m=54008;m<=54019;m++)M[m]=0;for(m=54021;m<=54032;m++)M[m]=0;for(m=54034;m<=54037;m++)M[m]=0;for(m=54042;m<=54046;m++)M[m]=0;for(m=54048;m<=54053;m++)M[m]=0;for(m=54074;m<=54080;m++)M[m]=0;for(m=54098;m<=54101;m++)M[m]=0;for(m=102001;m<=102040;m++)M[m]=0;for(m=102042;m<=102063;m++)M[m]=0;for(m=102065;m<=102067;m++)M[m]=0;for(m=102070;m<=102117;m++)M[m]=0;for(m=102122;m<=102216;m++)M[m]=0;for(m=102221;m<=102377;m++)M[m]=0;for(m=102382;m<=102388;m++)M[m]=0;for(m=102389;m<=102398;m++)M[m]=2;for(m=102399;m<=102444;m++)M[m]=0;for(m=102445;m<=102447;m++)M[m]=2;for(m=102448;m<=102458;m++)M[m]=0;for(m=102459;m<=102468;m++)M[m]=2;for(m=102469;m<=102499;m++)M[m]=0;for(m=102500;m<=102519;m++)M[m]=1;for(m=102520;m<=102524;m++)M[m]=0;for(m=102525;m<=102529;m++)M[m]=2;for(m=102530;m<=102588;m++)M[m]=0;for(m=102590;m<=102598;m++)M[m]=0;for(m=102601;m<=102603;m++)M[m]=0;for(m=102605;m<=102628;m++)M[m]=0;for(m=102629;m<=102646;m++)M[m]=2;for(m=102648;m<=102700;m++)M[m]=2;for(m=102701;m<=102703;m++)M[m]=0;for(m=102707;m<=102730;m++)M[m]=2;for(m=102733;m<=102758;m++)M[m]=2;for(m=102767;m<=102900;m++)M[m]=0;for(m=102901;m<=102933;m++)M[m]=2;for(m=102934;m<=102950;m++)M[m]=13;for(m=102951;m<=102955;m++)M[m]=0;for(m=102961;m<=102963;m++)M[m]=0;for(m=102965;m<=102969;m++)M[m]=0;for(m=102971;m<=102973;m++)M[m]=0;for(m=102975;m<=102989;m++)M[m]=0;for(m=102990;m<=102992;m++)M[m]=1;for(m=102997;m<=103002;m++)M[m]=0;for(m=103003;m<=103008;m++)M[m]=2;for(m=103009;m<=103011;m++)M[m]=0;for(m=103012;m<=103014;m++)M[m]=2;for(m=103019;m<=103021;m++)M[m]=0;for(m=103022;m<=103024;m++)M[m]=2;for(m=103029;m<=103031;m++)M[m]=0;for(m=103032;m<=103034;m++)M[m]=2;for(m=103065;m<=103068;m++)M[m]=0;for(m=103074;m<=103076;m++)M[m]=0;for(m=103077;m<=103079;m++)M[m]=1;for(m=103080;m<=103082;m++)M[m]=0;for(m=103083;m<=103085;m++)M[m]=2;for(m=103090;m<=103093;m++)M[m]=0;for(m=103097;m<=103099;m++)M[m]=0;for(m=103100;m<=103102;m++)M[m]=2;for(m=103107;m<=103109;m++)M[m]=0;for(m=103110;m<=103112;m++)M[m]=2;for(m=103113;m<=103116;m++)M[m]=0;for(m=103117;m<=103120;m++)M[m]=2;for(m=103153;m<=103157;m++)M[m]=0;for(m=103158;m<=103162;m++)M[m]=2;for(m=103163;m<=103165;m++)M[m]=0;for(m=103166;m<=103168;m++)M[m]=1;for(m=103169;m<=103171;m++)M[m]=2;for(m=103186;m<=103188;m++)M[m]=0;for(m=103189;m<=103191;m++)M[m]=2;for(m=103192;m<=103195;m++)M[m]=0;for(m=103196;m<=103199;m++)M[m]=2;for(m=103200;m<=103224;m++)M[m]=0;for(m=103225;m<=103227;m++)M[m]=1;for(m=103232;m<=103237;m++)M[m]=0;for(m=103238;m<=103243;m++)M[m]=2;for(m=103244;m<=103246;m++)M[m]=0;for(m=103247;m<=103249;m++)M[m]=2;for(m=103254;m<=103256;m++)M[m]=0;for(m=103257;m<=103259;m++)M[m]=2;for(m=103264;m<=103266;m++)M[m]=0;for(m=103267;m<=103269;m++)M[m]=2;for(m=103300;m<=103375;m++)M[m]=0;for(m=103381;m<=103383;m++)M[m]=0;for(m=103384;m<=103386;m++)M[m]=1;for(m=103387;m<=103389;m++)M[m]=0;for(m=103390;m<=103392;m++)M[m]=2;for(m=103397;m<=103399;m++)M[m]=0;for(m=103400;m<=103471;m++)M[m]=2;for(m=103476;m<=103478;m++)M[m]=0;for(m=103479;m<=103481;m++)M[m]=2;for(m=103486;m<=103488;m++)M[m]=0;for(m=103489;m<=103491;m++)M[m]=2;for(m=103492;m<=103495;m++)M[m]=0;for(m=103496;m<=103499;m++)M[m]=2;for(m=103528;m<=103543;m++)M[m]=0;for(m=103544;m<=103548;m++)M[m]=2;for(m=103549;m<=103551;m++)M[m]=0;for(m=103552;m<=103554;m++)M[m]=1;for(m=103555;m<=103557;m++)M[m]=2;for(m=103558;m<=103560;m++)M[m]=0;for(m=103571;m<=103573;m++)M[m]=0;for(m=103574;m<=103576;m++)M[m]=2;for(m=103577;m<=103580;m++)M[m]=0;for(m=103581;m<=103583;m++)M[m]=2;for(m=103595;m<=103694;m++)M[m]=0;for(m=103696;m<=103699;m++)M[m]=0;for(m=103700;m<=103793;m++)M[m]=2;for(m=103794;m<=103890;m++)M[m]=0;for(m=103891;m<=103896;m++)M[m]=2;for(m=103900;m<=103971;m++)M[m]=2;for(m=103972;m<=103977;m++)M[m]=0;for(m=112e3;m<=112101;m++)M[m]=0;const lEe={102113:!0,102100:!0,3857:!0,3785:!0},cEe={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},jq='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',AA=[-20037508342788905e-9,20037508342788905e-9],RA=[-20037508342787e-6,20037508342787e-6],hoe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:AA,origin:RA,dx:1e-5},102100:{wkTemplate:jq,valid:AA,origin:RA,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:AA,origin:RA,dx:1e-5},3857:{wkTemplate:jq,valid:AA,origin:RA,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function hs(t,e){if(t===e)return!0;if(t==null||e==null)return!1;if(t.wkid!=null||e.wkid!=null)return t.wkid===e.wkid||G1(t)&&G1(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid;const r=t.wkt2??t.wkt,i=e.wkt2??e.wkt;return!(!r||!i)&&r.toUpperCase()===i.toUpperCase()}function qh(t){return No(t)&&t.wkid&&hoe[t.wkid]||null}function E$(t){if(!t)return;if(t.wkid)return String(t.wkid);const e=t.wkt||t.wkt2;return JSON.stringify(e?{wkt:e}:{})}function h7(t){if(!No(t))return!1;if(t.wkid)return M[t.wkid]==null;const e=t.wkt2||t.wkt;return!!e&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(e)}function SC(t){return!(Wp(t)||Yp(t))}function EC(t){return No(t)&&t.wkid===4326}function Cft(t){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(t)}function doe(t){return No(t)&&t.wkid===_u.CGCS2000}function G1(t){return No(t)&&t.wkid!=null&&lEe[t.wkid]===!0}function d7(t){return No(t)&&t.wkid===32662}function p7(t){return t===_u.GCSMARS2000||t===_u.GCSMARS2000_SPHERE}function Wp(t){return No(t)&&t.wkid!=null&&p7(t.wkid)}function f7(t){return t===_u.GCSMOON2000}function Yp(t){return No(t)&&t.wkid!=null&&f7(t.wkid)}function uEe(t){return No(t)&&t.wkid!=null&&cEe[t.wkid]===!0}function No(t){return t!=null&&(t.wkid!=null&&t.wkid>=2e3||t.wkt2!=null||t.wkt!=null)}const hEe={wkid:4326,wkt:IL(hoe[4326].wkTemplate,{Central_Meridian:"0.0"})},dEe={wkid:102100,latestWkid:3857},pEe={wkid:32662};function m7(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const poe=m7(mr),HL=m7(Ep),qL=m7(gm),foe={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${mr.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function Mr(t){return t!=null&&(Wp(t)||hs(t,HL))?Ep:t!=null&&(Yp(t)||hs(t,qL))?gm:mr}function Aft(t){return p7(t)?Ep:f7(t)?gm:mr}function C$(t){return hs(t,poe)}function V0(t){return C$(t)||hs(t,HL)||hs(t,qL)}const g7=39.37,fEe=mr.radius*Math.PI/200,moe=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,S1=M,goe=/UNIT\[([^\]]+)]/i,mEe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),gEe=Ic()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),yd=t=>t*t,Xm=t=>t*t*t,CC={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:yd(.001)},"square-centimeters":{inBaseUnits:yd(.01)},"square-decimeters":{inBaseUnits:yd(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:yd(1e3)},"square-inches":{inBaseUnits:yd(.0254)},"square-feet":{inBaseUnits:yd(.3048)},"square-yards":{inBaseUnits:yd(.9144)},"square-miles":{inBaseUnits:yd(1609.344)},"square-us-feet":{inBaseUnits:yd(1200/3937)},acres:{inBaseUnits:.0015625*yd(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*Xm(.001)},"cubic-centimeters":{inBaseUnits:1e3*Xm(.01)},"cubic-decimeters":{inBaseUnits:1e3*Xm(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*Xm(1e3)},"cubic-inches":{inBaseUnits:1e3*Xm(.0254)},"cubic-feet":{inBaseUnits:1e3*Xm(.3048)},"cubic-yards":{inBaseUnits:1e3*Xm(.9144)},"cubic-miles":{inBaseUnits:1e3*Xm(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},yEe=(()=>{const t={};for(const e in CC)for(const r in CC[e].units)t[r]=e;return t})();function _Ee(t,e,r){return t*CC[r].units[e].inBaseUnits}function vEe(t,e,r){return t/CC[r].units[e].inBaseUnits}const bEe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function T8(t){const e=yEe[t];if(!e)throw new Error("unknown type");return e}function Hq(t,e=null){return e=e||T8(t),CC[e].baseUnit===t}function jn(t,e,r){if(e===r)return t;const i=T8(e);if(i!==T8(r))throw new Error("incompatible units");const s=Hq(e,i)?t:_Ee(t,e,i);return Hq(r,i)?s:vEe(s,r,i)}function Rft(t,e,r){switch(r){case"metric":return wEe(t,e);case"imperial":return TEe(t,e);default:return r}}function Oft(t,e,r){switch(r){case"metric":return xEe(t,e);case"imperial":return SEe(t,e);default:return r}}function wEe(t,e){const r=jn(t,e,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function xEe(t,e){const r=jn(t,e,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function TEe(t,e){const r=jn(t,e,"feet");return Math.abs(r)<1e3?"feet":"miles"}function SEe(t,e){const r=jn(t,e,"feet");return Math.abs(r)<1e5?"feet":"miles"}function Pft(t,e){const r=jn(t,e,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function Mft(t,e){const r=jn(t,e,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function EEe(t,e,r){return jn(t,e,"meters")/(r*Math.PI/180)}function yoe(t){return gEe.fromJSON(t.toLowerCase())||null}function A$(t){if(t!=null&&!SC(t))return 1;const e=qo(t);return e>1e5?1:e}function CEe(t){return qo(t)>=Mr(t).metersPerDegree?"meters":WL(t)}function qo(t,e=mr.metersPerDegree){return AEe(t,!0)??e}function AEe(t,e=!1){const r=(t==null?void 0:t.wkid)??null,i=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let s=null;if(r){if(p7(r))return Ep.metersPerDegree;if(f7(r))return gm.metersPerDegree;s=S1.values[S1[r]],!s&&e&&mEe.has(r)&&(s=fEe)}else i&&(boe(i)?s=qq(moe.exec(i),s):voe(i)&&(s=qq(goe.exec(i),s)));return s}function S8(t){return h7(t)?1:qo(t)}function qq(t,e){return t!=null&&t[1]?_oe(t[1]):e}function _oe(t){return parseFloat(t.split(",")[1])}function WL(t){const e=(t==null?void 0:t.wkid)??null,r=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let i=null;if(e)i=S1.units[S1[e]];else if(r){const s=boe(r)?moe:voe(r)?goe:null;if(s){const n=s.exec(r);n!=null&&n[1]&&(i=OEe(n[1]))}}return i!=null?yoe(i):null}function $ft(t){const e=WL(t);return e!=null&&bEe.includes(e)?e:null}function voe(t){return/^GEOCCS/i.test(t)}function boe(t){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(t)}const REe=1e-7;function OEe(t){const e=/[\\"']{1}([^\\"']+)/.exec(t);let r=e==null?void 0:e[1];if(!r||!S1.units.includes(r)){const i=_oe(t);r=null;const s=S1.values;for(let n=0;n<s.length;++n)if(Math.abs(i-s[n])<REe){r=S1.units[n];break}}return r}function Ift(t){const e=WL(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const PEe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},MEe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},$Ee={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},Lft=Ic()(PEe),Dft=Ic()(MEe),Nft=Ic()($Ee);var Ud;let Kr=Ud=class extends st{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return Ud.WebMercator;if(t.wkid===4326)return Ud.WGS84}const e=new Ud;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return EC(this)}get isWebMercator(){return G1(this)}get isGeographic(){return h7(this)}get isWrappable(){return uEe(this)}get metersPerUnit(){return qo(this)}get unit(){return WL(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===Ud.WGS84)return Ud.WGS84;if(this===Ud.WebMercator)return Ud.WebMercator;const t=new Ud;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(t.wkt=this.wkt),this.wkt2!=null&&(t.wkt2=this.wkt2)),this.imageCoordinateSystem&&(t.imageCoordinateSystem=ye(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:r}=t.imageCoordinateSystem,{geodataXform:i}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||i?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):r?s.id===e&&s.referenceServiceName===r:s.id===e}return hs(this,t)}toJSON(t){return this.write(void 0,t)}};Kr.GCS_NAD_1927=null,Kr.WGS84=null,Kr.WebMercator=null,Kr.PlateCarree=null,h([f({readOnly:!0})],Kr.prototype,"isWGS84",null),h([f({readOnly:!0})],Kr.prototype,"isWebMercator",null),h([f({readOnly:!0})],Kr.prototype,"isGeographic",null),h([f({readOnly:!0})],Kr.prototype,"isWrappable",null),h([f({type:Qs,json:{write:!0}})],Kr.prototype,"latestWkid",void 0),h([f({readOnly:!0})],Kr.prototype,"metersPerUnit",null),h([f({readOnly:!0})],Kr.prototype,"unit",null),h([f({type:Qs,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],Kr.prototype,"wkid",void 0),h([f({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],Kr.prototype,"wkt",void 0),h([ni("wkt"),ni("web-scene","wkt")],Kr.prototype,"writeWkt",null),h([f({type:String,json:{write:!1}})],Kr.prototype,"wkt2",void 0),h([f({type:Qs,json:{write:!0}})],Kr.prototype,"vcsWkid",void 0),h([f({type:Qs,json:{write:!0}})],Kr.prototype,"latestVcsWkid",void 0),h([f()],Kr.prototype,"imageCoordinateSystem",void 0),Kr=Ud=h([k("esri.geometry.SpatialReference")],Kr),Kr.prototype.toJSON.isDefaultToJSON=!0,Kr.GCS_NAD_1927=new Kr({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Kr.WGS84=new Kr(hEe),Kr.WebMercator=new Kr(dEe),Kr.PlateCarree=new Kr(pEe),Object.freeze&&(Object.freeze(Kr.GCS_NAD_1927),Object.freeze(Kr.WGS84),Object.freeze(Kr.WebMercator));const at=Kr;function si(t,e,r){let i,s;return e===void 0||Array.isArray(e)?(s=t,r=e,i=[void 0]):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;i.forEach(l=>{const c=wne(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}let kd=class extends st{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=at.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,r){if(e instanceof at)return e;if(e!=null){const i=new at;return i.read(e,r),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,r){this.cache[e]=r}};h([f()],kd.prototype,"type",void 0),h([f({readOnly:!0})],kd.prototype,"cache",null),h([f({readOnly:!0})],kd.prototype,"extent",null),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],kd.prototype,"hasM",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],kd.prototype,"hasZ",void 0),h([f({type:at,json:{write:!0},value:at.WGS84})],kd.prototype,"spatialReference",void 0),h([si("spatialReference")],kd.prototype,"readSpatialReference",null),kd=h([k("esri.geometry.Geometry")],kd);const uy=kd,IEe=Object.prototype.toString;function LEe(t){const e="__accessorMetadata__"in t?ya(t):t;return function(...r){if(r.push(e),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return DEe.apply(this,r)}}function DEe(t,e,r,i){DL(t,e).cast=i}function NEe(t){return(e,r)=>{DL(e,t).cast=e[r]}}function zi(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&IEe.call(t[0])==="[object Function]"?LEe(t[0]):t.length===1&&typeof t[0]=="string"?NEe(t[0]):void 0}function FEe(t,e){const r=t.x-e.x,i=t.y-e.y,s=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(r*r+i*i+s*s)}const UEe=57.29577951308232,kEe=.017453292519943;function Wq(t){return t*UEe}function Yq(t){return t*kEe}function Xq(t){return t/mr.radius}function R$(t){return Math.PI/2-2*Math.atan(Math.exp(-t/mr.radius))}function E8(t){return t.wkid!=null||t.wkt!=null}const l4=[0,0];function O$(t,e,r,i,s){const n=t,o=s;if(o.spatialReference=r,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,l4,i);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,l4,i),[o.xmax,o.ymax]=e(n.xmax,n.ymax,l4,i);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let u=0;u<a.length;u++){const d=a[u];c=[],l.push(c);for(let p=0;p<d.length;p++)c.push(e(d[p][0],d[p][1],[0,0],i)),d[p].length>2&&c[p].push(d[p][2]),d[p].length>3&&c[p].push(d[p][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function vE(t,e){const r=t&&(E8(t)?t:t.spatialReference),i=e&&(E8(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!r||!i)&&(!!hs(i,r)||G1(i)&&EC(r)||G1(r)&&EC(i))}function C3(t,e){if(t==null)return null;const r=t.spatialReference,i=e&&(E8(e)?e:e.spatialReference);return vE(r,i)?hs(r,i)?ye(t):G1(i)?O$(t,$w,at.WebMercator,!1,ye(t)):EC(i)?O$(t,bE,at.WGS84,!1,ye(t)):null:null}function $w(t,e,r=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const i=Yq(e);return r[0]=Yq(t)*mr.radius,r[1]=mr.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function bE(t,e,r=[0,0],i=!1){const s=Wq(t/mr.radius);return r[0]=i?s:s-360*Math.floor((s+180)/360),r[1]=Wq(Math.PI/2-2*Math.atan(Math.exp(-e/mr.radius))),r}function O0(t,e=!1,r=ye(t)){return O$(t,$w,at.WebMercator,e,r)}function JT(t,e=!1,r=ye(t)){return O$(t,bE,at.WGS84,e,r)}var TP;const Y2=[0,0];function Zq(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Pa=TP=class extends uy{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const r=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,r,i,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],r=n[2],i=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,r=n.z,i=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new at(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)ne.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)ne.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=$w(n.longitude,n.latitude,Y2);t=a[0],e=a[1]}}}else Zq(r)?(s=r,r=null):Zq(i)&&(s=i,i=null);const o={x:t,y:e};return o.x==null&&o.y!=null?ne.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&ne.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:r}=this;if(t){if(t.isWebMercator)return bE(e,r,Y2)[1];if(t.isGeographic)return r}return null}set latitude(t){const{spatialReference:e,x:r}=this;t!=null&&e&&(e.isWebMercator?this._set("y",$w(r,t,Y2)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:r}=this;if(r){if(r.isWebMercator)return bE(t,e,Y2)[0];if(r.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:r}=this;t!=null&&r&&(r.isWebMercator?this._set("x",$w(t,e,Y2)[0]):r.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,r){e[r]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new TP;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return TP.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:r,z:i,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:u}=t;if(!n.equals(u))if(n.isWebMercator&&u.isWGS84)[l,c]=$w(l,c),u=n;else{if(!n.isWGS84||!u.isWebMercator)return!1;[l,c]=bE(l,c),u=n}return e===l&&r===c&&i===o&&s===a&&n.wkid===u.wkid}offset(t,e,r){return this.x+=t,this.y+=e,r!=null&&(this.z=(this.z??0)+r),this}normalize(){if(!this.spatialReference)return this;const t=qh(this.spatialReference);if(!t)return this;let e=this.x;const[r,i]=t.valid,s=2*i;let n;return e>i?(n=Math.ceil(Math.abs(e-i)/s),e-=n*s):e<r&&(n=Math.ceil(Math.abs(e-r)/s),e+=n*s),this._set("x",e),this}distance(t){return FEe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],Pa.prototype,"cache",null),h([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Pa.prototype,"hasM",null),h([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Pa.prototype,"hasZ",null),h([f({type:Number})],Pa.prototype,"latitude",null),h([f({type:Number})],Pa.prototype,"longitude",null),h([f({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),zi(t=>isNaN(t)?t:Mh(t))],Pa.prototype,"x",void 0),h([ni("x")],Pa.prototype,"writeX",null),h([si("x")],Pa.prototype,"readX",null),h([f({type:Number,json:{write:!0}})],Pa.prototype,"y",void 0),h([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Pa.prototype,"z",void 0),h([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Pa.prototype,"m",void 0),Pa=TP=h([k("esri.geometry.Point")],Pa),Pa.prototype.toJSON.isDefaultToJSON=!0;const nt=Pa,c4=[0,0];function y7(t,e){return e!=null&&oa(t,e.x,e.y,e.z)}function Uft(t,e){if(!e.points||e.points.length)return!1;for(const r of e.points)if(!Ex(t,r))return!1;return!0}function BEe(t,e){const{xmin:r,ymin:i,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?oa(t,r,i,s)&&oa(t,r,o,s)&&oa(t,n,o,s)&&oa(t,n,i,s)&&oa(t,r,i,a)&&oa(t,r,o,a)&&oa(t,n,o,a)&&oa(t,n,i,a):oa(t,r,i)&&oa(t,r,o)&&oa(t,n,o)&&oa(t,n,i)}function Ex(t,e){return oa(t,e[0],e[1])}function zEe(t,e){return oa(t,e[0],e[1],e[2])}function oa(t,e,r,i){return e>=t.xmin&&e<=t.xmax&&r>=t.ymin&&r<=t.ymax&&(i==null||!t.hasZ||i>=t.zmin&&i<=t.zmax)}function VEe(t,e){return c4[1]=e.y,c4[0]=e.x,GEe(t,c4)}function GEe(t,e){return woe(t.rings,e)}function woe(t,e){if(!t)return!1;if(jEe(t))return Jq(!1,t,e);let r=!1;for(let i=0,s=t.length;i<s;i++)r=Jq(r,t[i],e);return r}function jEe(t){return!Array.isArray(t[0][0])}function Jq(t,e,r){const[i,s]=r;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,u]=e[a],[d,p]=e[o];(u<s&&p>=s||p<s&&u>=s)&&c+(s-u)/(p-u)*(d-c)<i&&(n=!n)}return n}function HEe(t,e){return y7(t,e)}function qEe(t,e){const r=t.hasZ&&e.hasZ;let i,s,n;if(t.xmin<=e.xmin){if(i=e.xmin,t.xmax<i)return!1}else if(i=t.xmin,e.xmax<i)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(r&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function WEe(t,e){const{points:r,hasZ:i}=e,s=i?zEe:Ex;for(const n of r)if(s(t,n))return!0;return!1}const j1=[0,0],H1=[0,0],q1=[0,0],W1=[0,0],YEe=[j1,H1,q1,W1],xoe=[[q1,j1],[j1,H1],[H1,W1],[W1,q1]];function XEe(t,e){return ZEe(t,e.rings)}function ZEe(t,e){j1[0]=t.xmin,j1[1]=t.ymax,H1[0]=t.xmax,H1[1]=t.ymax,q1[0]=t.xmin,q1[1]=t.ymin,W1[0]=t.xmax,W1[1]=t.ymin;for(const r of YEe)if(woe(e,r))return!0;for(const r of e){if(!r.length)continue;let i=r[0];if(Ex(t,i))return!0;for(let s=1;s<r.length;s++){const n=r[s];if(Ex(t,n)||Toe(i,n,xoe))return!0;i=n}}return!1}function JEe(t,e){j1[0]=t.xmin,j1[1]=t.ymax,H1[0]=t.xmax,H1[1]=t.ymax,q1[0]=t.xmin,q1[1]=t.ymin,W1[0]=t.xmax,W1[1]=t.ymin;const r=e.paths;for(const i of r){if(!r.length)continue;let s=i[0];if(Ex(t,s))return!0;for(let n=1;n<i.length;n++){const o=i[n];if(Ex(t,o)||Toe(s,o,xoe))return!0;s=o}}return!1}const to=[0,0];function QEe(t){for(let e=0;e<t.length;e++){const r=t[e];for(let s=0;s<r.length-1;s++){const n=r[s],o=r[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],u=t[a][l+1];if(C8(n,o,c,u,to)&&!(to[0]===n[0]&&to[1]===n[1]||to[0]===c[0]&&to[1]===c[1]||to[0]===o[0]&&to[1]===o[1]||to[0]===u[0]&&to[1]===u[1]))return!0}}const i=r.length;if(!(i<=4))for(let s=0;s<i-3;s++){let n=i-1;s===0&&(n=i-2);const o=r[s],a=r[s+1];for(let l=s+2;l<n;l++){const c=r[l],u=r[l+1];if(C8(o,a,c,u,to)&&!(to[0]===o[0]&&to[1]===o[1]||to[0]===c[0]&&to[1]===c[1]||to[0]===a[0]&&to[1]===a[1]||to[0]===u[0]&&to[1]===u[1]))return!0}}}return!1}function Toe(t,e,r){for(let i=0;i<r.length;i++)if(C8(t,e,r[i][0],r[i][1]))return!0;return!1}function C8(t,e,r,i,s){const[n,o]=t,[a,l]=e,[c,u]=r,[d,p]=i,g=d-c,y=n-c,_=a-n,v=p-u,w=o-u,x=l-o,T=v*_-g*x;if(T===0)return!1;const S=(g*w-v*y)/T,C=(_*w-x*y)/T;return S>=0&&S<=1&&C>=0&&C<=1&&(s&&(s[0]=n+S*(a-n),s[1]=o+S*(l-o)),!0)}function KEe(t){switch(t){case"esriGeometryEnvelope":case"extent":return qEe;case"esriGeometryMultipoint":case"multipoint":return WEe;case"esriGeometryPoint":case"point":return HEe;case"esriGeometryPolygon":case"polygon":return XEe;case"esriGeometryPolyline":case"polyline":return JEe}}var Wc;function eCe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function Zm(t,e,r){return e==null?r:r==null?e:t(e,r)}let Fn=Wc=class extends uy{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,r,i,s){return eCe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?at.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:r,ymax:i,spatialReference:s??at.WGS84}}static fromBounds(t,e){return new Wc({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new Wc({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new nt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new Wc;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&vE(e,r)&&(t=e.isWebMercator?O0(t):JT(t,!0)),t.type==="point"?y7(this,t):t.type==="extent"&&BEe(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&vE(e,r)&&(t=e.isWebMercator?O0(t):JT(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),r=this.width*e,i=this.height*e;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,r=t.spatialReference;return e&&r&&!hs(e,r)&&vE(e,r)&&(t=e.isWebMercator?O0(t):JT(t,!0)),KEe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,r){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=Zm(Math.min,this.zmin,t.zmin),this.zmax=Zm(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=Zm(Math.min,this.mmin,t.mmin),this.mmax=Zm(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=Zm(Math.max,this.zmin,t.zmin),this.zmax=Zm(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=Zm(Math.max,this.mmin,t.mmin),this.mmax=Zm(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=qh(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,r=this._getCM(t);if(r){const i=e.isWebMercator?JT(r):r;this.xmin-=r.x,this.xmax-=r.x,e.isWebMercator||(i.x=this._normalizeX(i.x,t).x),this.spatialReference=new at(IL((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(t){let e=null;const[r,i]=t.valid,s=this.xmin,n=this.xmax;return s>=r&&s<=i&&n>=r&&n<=i||(e=this.center),e}_normalize(t,e,r){const i=this.spatialReference;if(!i)return this;const s=r??qh(i);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const u=(l.zmax-l.zmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}if(a){const u=(l.mmax-l.mmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let u;t=t||qh(o);const[d,p]=t.valid;u=this._normalizeX(this.xmin,t);const g=u.x,y=u.frameId;u=this._normalizeX(this.xmax,t);const _=u.x,v=u.frameId,w=g===_&&a>0;if(a>2*p){const x=new Wc(l<c?g:_,s,p,n,o),T=new Wc(d,s,l<c?_:g,n,o),S=new Wc(0,s,p,n,o),C=new Wc(d,s,0,n,o),A=[],O=[];x.contains(S)&&A.push(y),x.contains(C)&&O.push(y),T.contains(S)&&A.push(v),T.contains(C)&&O.push(v);for(let $=y+1;$<v;$++)A.push($),O.push($);e.push({extent:x,frameIds:[y]},{extent:T,frameIds:[v]},{extent:S,frameIds:A},{extent:C,frameIds:O})}else g>_||w?e.push({extent:new Wc(g,s,p,n,o),frameIds:[y]},{extent:new Wc(d,s,_,n,o),frameIds:[v]}):e.push({extent:new Wc(g,s,_,n,o),frameIds:[y]});this.cache._parts=e}const r=this.hasZ,i=this.hasM;if(r||i){const s={};r&&(s.zmin=this.zmin,s.zmax=this.zmax),i&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}_normalizeX(t,e){const[r,i]=e.valid,s=2*i;let n,o=0;return t>i?(n=Math.ceil(Math.abs(t-i)/s),t-=n*s,o=n):t<r&&(n=Math.ceil(Math.abs(t-r)/s),t+=n*s,o=-n),{x:t,frameId:o}}};h([f({readOnly:!0})],Fn.prototype,"cache",null),h([f({readOnly:!0})],Fn.prototype,"center",null),h([f({readOnly:!0})],Fn.prototype,"extent",null),h([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Fn.prototype,"hasM",null),h([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Fn.prototype,"hasZ",null),h([f({readOnly:!0})],Fn.prototype,"height",null),h([f({readOnly:!0})],Fn.prototype,"width",null),h([f({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Fn.prototype,"xmin",void 0),h([f({type:Number,json:{write:!0}})],Fn.prototype,"ymin",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Fn.prototype,"mmin",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Fn.prototype,"zmin",void 0),h([f({type:Number,json:{write:!0}})],Fn.prototype,"xmax",void 0),h([f({type:Number,json:{write:!0}})],Fn.prototype,"ymax",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Fn.prototype,"mmax",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Fn.prototype,"zmax",void 0),Fn=Wc=h([k("esri.geometry.Extent")],Fn),Fn.prototype.toJSON.isDefaultToJSON=!0;const Xr=Fn;let wE;var vse,bse;const tCe=((vse=globalThis.esriConfig)==null?void 0:vse.locale)??((bse=globalThis.dojoConfig)==null?void 0:bse.locale);function Soe(){var t;return tCe??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function xc(){return wE===void 0&&(wE=Soe()),wE}function rCe(t=xc()){const e=/^([a-zA-Z]{2,3})(?:[_\-]\w+)*$/.exec(t);return e==null?void 0:e[1].toLowerCase()}const xE=[];function _7(t){return xE.push(t),Rr(()=>xE.splice(xE.indexOf(t),1))}const A8=[];function v7(t){return A8.push(t),Rr(()=>xE.splice(A8.indexOf(t),1))}function iCe(){const t=Soe();wE!==t&&(wE=t,[...A8].forEach(e=>{e.call(null,t)}),[...xE].forEach(e=>{e.call(null,t)}))}var wse;(wse=globalThis.addEventListener)==null||wse.call(globalThis,"languagechange",iCe);let OA;function sCe(t){return OA&&!OA.destroyed||(OA=t()),OA}var R8;const nCe=new Pc({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Yc=R8=class extends xe{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new R8({categories:this.categories?ye(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let r=[];this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let i="";if(this.extent){const o=C3(this.extent,at.WGS84);o!=null&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:r,bbox:i,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>nCe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};h([f()],Yc.prototype,"categories",void 0),h([f()],Yc.prototype,"disableExtraQuery",void 0),h([f({type:Xr})],Yc.prototype,"extent",void 0),h([f()],Yc.prototype,"filter",void 0),h([f()],Yc.prototype,"num",void 0),h([f()],Yc.prototype,"query",void 0),h([f()],Yc.prototype,"sortField",void 0),h([f()],Yc.prototype,"sortOrder",null),h([f()],Yc.prototype,"start",void 0),Yc=R8=h([k("esri.portal.PortalQueryParams")],Yc);const hp=Yc;var O8;let gn=O8=class extends st{constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){var r;const t=this.url,e=this.thumbnail;return t&&e&&this.portal?(r=this.portal)==null?void 0:r.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const r=e.categorySchema||[];return r.some(i=>i.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):r})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new X("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new O8;return e.sourceJSON=t,e.read(t),e}queryItems(t,e){let r=ya(hp,t);const i=this.portal;return parseFloat(i.currentVersion)>5?(r=r||new hp,i.queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",e)):(r=r?r.clone():new hp,r.query="group:"+this.id+(r.query?" "+r.query:""),i.queryItems(r,e))}_fetchCategorySchemaSet(t,e){const r=this.portal;return r.fetchSelf(r.authMode,!0,e).then(i=>{const s=i.contentCategorySetsGroupQuery;if(s){const n=new hp;return n.disableExtraQuery=!0,n.num=1,n.query=s,r.queryGroups(n,e)}throw new X("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(i=>{if(i.total){const s=i.results[0],n=new hp;return n.num=1,n.query=`typekeywords:"${t}"`,s.queryItems(n,e)}throw new X("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(i=>i.total?i.results[0].fetchData("json",e).then(s=>{const n=s==null?void 0:s.categorySchema;return n!=null&&n.length?n:[]}):[])}};h([f()],gn.prototype,"access",void 0),h([f({type:Date})],gn.prototype,"created",void 0),h([f()],gn.prototype,"description",void 0),h([f()],gn.prototype,"id",void 0),h([f()],gn.prototype,"isInvitationOnly",void 0),h([f({type:Date})],gn.prototype,"modified",void 0),h([f()],gn.prototype,"owner",void 0),h([f()],gn.prototype,"portal",void 0),h([f()],gn.prototype,"snippet",void 0),h([f()],gn.prototype,"sortField",void 0),h([f()],gn.prototype,"sortOrder",void 0),h([f()],gn.prototype,"sourceJSON",void 0),h([f()],gn.prototype,"tags",void 0),h([f()],gn.prototype,"thumbnail",void 0),h([f({readOnly:!0})],gn.prototype,"thumbnailUrl",null),h([f()],gn.prototype,"title",void 0),h([f({readOnly:!0})],gn.prototype,"url",null),gn=O8=h([k("esri.portal.PortalGroup")],gn);const P8=gn;let d_=class extends xe{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};h([f()],d_.prototype,"nextQueryParams",void 0),h([f()],d_.prototype,"queryParams",void 0),h([f()],d_.prototype,"results",void 0),h([f()],d_.prototype,"total",void 0),d_=h([k("esri.portal.PortalQueryResult")],d_);const oCe=d_;let Tf=class extends st{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){var r;const e=(r=this.portal)==null?void 0:r.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new X("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};h([f({type:Date})],Tf.prototype,"created",void 0),h([f()],Tf.prototype,"id",void 0),h([f()],Tf.prototype,"portal",void 0),h([f()],Tf.prototype,"title",void 0),h([f({readOnly:!0})],Tf.prototype,"url",null),h([f()],Tf.prototype,"username",void 0),Tf=h([k("esri.portal.PortalFolder")],Tf);const aCe=Tf;var M8;let rs=M8=class extends st{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/content/users/${this.username}`:null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,r=t==null?void 0:t.data,i=t==null?void 0:t.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),r!=null&&(typeof r=="string"?s.query.text=r:typeof r=="object"&&(s.query.text=JSON.stringify(r))));let n=this.userContentUrl;return i&&(n+="/"+(typeof i=="string"?i:i.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",r=t.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal.request(e,i).then(()=>{t.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let r;return r=e&&e.folders?e.folders.map(i=>{const s=aCe.fromJSON(i);return s.portal=this.portal,s}):[],r})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(r=>{const i=P8.fromJSON(r);return i.portal=this.portal,i}):[],e})}fetchItems(t){const e=t??{};let r,i=this.userContentUrl??"";return e.folder&&(i+="/"+e.folder.id),he(()=>Promise.resolve().then(()=>Aoe),void 0,import.meta.url).then(({default:s})=>{r=s;const n={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(i,{query:n})}).then(s=>{let n;return s!=null&&s.items?(n=s.items.map(o=>{const a=r.fromJSON(o);return a.portal=this.portal,a}),Promise.all(n.map(o=>o.load())).catch(o=>o).then(()=>({items:n,nextStart:s.nextStart,total:s.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new P8({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new X("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new X("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new M8;return e.sourceJSON=t,e.read(t),e}};h([f()],rs.prototype,"access",void 0),h([f({type:Date})],rs.prototype,"created",void 0),h([f()],rs.prototype,"culture",void 0),h([f()],rs.prototype,"description",void 0),h([f()],rs.prototype,"email",void 0),h([f()],rs.prototype,"favGroupId",void 0),h([f()],rs.prototype,"fullName",void 0),h([f({type:Date})],rs.prototype,"modified",void 0),h([f()],rs.prototype,"orgId",void 0),h([f()],rs.prototype,"portal",void 0),h([f()],rs.prototype,"preferredView",void 0),h([f()],rs.prototype,"privileges",void 0),h([f()],rs.prototype,"region",void 0),h([f()],rs.prototype,"role",void 0),h([f()],rs.prototype,"roleId",void 0),h([f()],rs.prototype,"sourceJSON",void 0),h([f()],rs.prototype,"thumbnail",void 0),h([f({readOnly:!0})],rs.prototype,"thumbnailUrl",null),h([f()],rs.prototype,"units",void 0),h([f({readOnly:!0})],rs.prototype,"userContentUrl",null),h([f({readOnly:!0})],rs.prototype,"url",null),h([f()],rs.prototype,"username",void 0),h([f()],rs.prototype,"userType",void 0),rs=M8=h([k("esri.portal.PortalUser")],rs);const Eoe=rs;var Sf;let PA;const Qq={PortalGroup:()=>Promise.resolve({default:P8}),PortalItem:()=>he(()=>Promise.resolve().then(()=>Aoe),void 0,import.meta.url),PortalUser:()=>Promise.resolve({default:Eoe})};let Me=Sf=class extends S3(z0){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=kr.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){Kq.unregister(this),this.defaultBasemap=Oe(this.defaultBasemap),this.defaultDevBasemap=Oe(this.defaultDevBasemap),this.defaultVectorBasemap=Oe(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=di(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)kr.request.trustedServers.includes(e)||kr.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){var r;const t=(r=this.user)==null?void 0:r.orgId,e=!t||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=Eoe.fromJSON(t),e.portal=this),e}load(t){const e=he(()=>Promise.resolve().then(()=>NCe),void 0,import.meta.url).then(({default:r})=>{wt(t),PA=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(r=>{var i;if(Qi){const s=Qi;this.credential=s.findCredential(this.restUrl),this.credential||this.authMode!==Sf.AUTH_MODE_AUTO||((i=this._esriIdCredentialCreateHandle)==null||i.remove(),this._esriIdCredentialCreateHandle=s.on("credential-create",lCe(new WeakRef(this))),Kq.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await he(()=>import("./ElevationLayer-5abee196.js"),["./ElevationLayer-5abee196.js","./MultiOriginJSONSupport-9addf1b7.js","./ArcGISCachedService-cf335080.js","./TileInfoTilemapCache-c2a33c86.js","./TilemapCache-5c7410bd.js","./ArcGISService-377485dc.js","./OperationalLayer-381cacc8.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./PortalLayer-806db449.js","./portalItemUtils-bd3ade0c.js"],import.meta.url)).default;return t?t.map(r=>new e({id:r.id,url:r.url})):[]}async fetchBasemaps(t,e){const r=await this._fetchBasemaps(t,e);if((e==null?void 0:e.include3d)===!0&&this.use3dBasemaps!==!1){const i=await this._fetchBasemaps3D(t,e);r.unshift(...i)}return r}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):Ys(t)?Promise.reject(ur()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,r=new hp;if(r.num=100,r.sortField="title",e&&e.length){const i=[];for(const s of e)i.push(`(title:"${s.title}" AND owner:${s.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,t).then(s=>s.results)}return Ys(t)?Promise.reject(ur()):Promise.resolve([])}fetchRegions(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||xc();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||xc();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return sCe(()=>new Sf)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,r){const i=this.restUrl+"/portals/self",s={authMode:t,query:{culture:xc().toLowerCase()},...r};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(i,s)}queryPortal(t,e,r,i){const s=ya(hp,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...i}).then(a=>{const l=s.clone();return l.start=a.nextStart,new oCe({nextQueryParams:l,queryParams:s,total:a.total,results:Sf._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(ly(l),a)));return r&&Qq[r]?Qq[r]().then(({default:o})=>(wt(i),n(o))):n()}signIn(){if(this.authMode===Sf.AUTH_MODE_ANONYMOUS)return Promise.reject(new X("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return Qi?Qi.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){var r;const e=(r=this.credential)==null?void 0:r.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,r){return this.request(t,e).then(i=>{const s=Sf._resultsToTypedArray(r,{portal:this},i);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():i)).then(()=>s,()=>s)})}request(t,e={}){const r={f:"json",...e.query},{authMode:i=this.authMode===Sf.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:i,body:s,cacheBust:n,method:o,query:r,responseType:a,timeout:0,signal:l};return Hi(this._normalizeSSL(t),c).then(u=>u.data)}toJSON(){throw new X("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Sf({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new X("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const r=new hp;r.query=t||(kr.apiKey&&Zne(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0;const i=await this.queryGroups(r,e);if(!i.total)return[];const s=i.results[0];r.num=100,r.query='type:"Web Map" -type:"Web Application"',r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc";const n=await s.queryItems(r,e);return n.total?n.results.filter(o=>o.type==="Web Map").map(o=>new PA({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const r=t||this.basemapGalleryGroupQuery3D;if(!r)return[];const i=new hp({query:r,disableExtraQuery:!0}),s=await this.queryGroups(i,e);if(!s.total)return[];const n=s.results[0];i.num=100,i.query='type:"Web Scene"',i.sortField=n.sortField||"name",i.sortOrder=n.sortOrder||"desc";const o=await n.queryItems(i,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new PA({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=PA.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,r,i){let s=[];if(r){const n=i!=null?i.signal:null;s=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};Me.AUTH_MODE_ANONYMOUS="anonymous",Me.AUTH_MODE_AUTO="auto",Me.AUTH_MODE_IMMEDIATE="immediate",h([f()],Me.prototype,"access",void 0),h([f()],Me.prototype,"allSSL",void 0),h([f()],Me.prototype,"authMode",void 0),h([f()],Me.prototype,"authorizedCrossOriginDomains",void 0),h([si("authorizedCrossOriginDomains")],Me.prototype,"readAuthorizedCrossOriginDomains",null),h([f()],Me.prototype,"basemapGalleryGroupQuery",void 0),h([f({json:{name:"3DBasemapGalleryGroupQuery"}})],Me.prototype,"basemapGalleryGroupQuery3D",void 0),h([f()],Me.prototype,"bingKey",void 0),h([f()],Me.prototype,"canListApps",void 0),h([f()],Me.prototype,"canListData",void 0),h([f()],Me.prototype,"canListPreProvisionedItems",void 0),h([f()],Me.prototype,"canProvisionDirectPurchase",void 0),h([f()],Me.prototype,"canSearchPublic",void 0),h([f()],Me.prototype,"canShareBingPublic",void 0),h([f()],Me.prototype,"canSharePublic",void 0),h([f()],Me.prototype,"canSignInArcGIS",void 0),h([f()],Me.prototype,"canSignInIDP",void 0),h([f()],Me.prototype,"colorSetsGroupQuery",void 0),h([f()],Me.prototype,"commentsEnabled",void 0),h([f({type:Date})],Me.prototype,"created",void 0),h([f()],Me.prototype,"credential",void 0),h([f()],Me.prototype,"culture",void 0),h([f()],Me.prototype,"currentVersion",void 0),h([f()],Me.prototype,"customBaseUrl",void 0),h([f()],Me.prototype,"defaultBasemap",void 0),h([si("defaultBasemap")],Me.prototype,"readDefaultBasemap",null),h([f()],Me.prototype,"defaultDevBasemap",void 0),h([si("defaultDevBasemap")],Me.prototype,"readDefaultDevBasemap",null),h([f({type:Xr})],Me.prototype,"defaultExtent",void 0),h([f()],Me.prototype,"defaultVectorBasemap",void 0),h([si("defaultVectorBasemap")],Me.prototype,"readDefaultVectorBasemap",null),h([f()],Me.prototype,"description",void 0),h([f()],Me.prototype,"devBasemapGalleryGroupQuery",void 0),h([f()],Me.prototype,"eueiEnabled",void 0),h([f({readOnly:!0})],Me.prototype,"extraQuery",null),h([f()],Me.prototype,"featuredGroups",void 0),h([f()],Me.prototype,"featuredItemsGroupQuery",void 0),h([f()],Me.prototype,"galleryTemplatesGroupQuery",void 0),h([f()],Me.prototype,"livingAtlasGroupQuery",void 0),h([f()],Me.prototype,"hasCategorySchema",void 0),h([f()],Me.prototype,"helpBase",void 0),h([f()],Me.prototype,"helperServices",void 0),h([f()],Me.prototype,"helpMap",void 0),h([f()],Me.prototype,"homePageFeaturedContent",void 0),h([f()],Me.prototype,"homePageFeaturedContentCount",void 0),h([f()],Me.prototype,"httpPort",void 0),h([f()],Me.prototype,"httpsPort",void 0),h([f()],Me.prototype,"id",void 0),h([f()],Me.prototype,"ipCntryCode",void 0),h([f({readOnly:!0})],Me.prototype,"isOrganization",null),h([f()],Me.prototype,"isPortal",void 0),h([f()],Me.prototype,"isReadOnly",void 0),h([f({readOnly:!0})],Me.prototype,"itemPageUrl",null),h([f()],Me.prototype,"layerTemplatesGroupQuery",void 0),h([f()],Me.prototype,"maxTokenExpirationMinutes",void 0),h([f({type:Date})],Me.prototype,"modified",void 0),h([f()],Me.prototype,"name",void 0),h([f()],Me.prototype,"portalHostname",void 0),h([f()],Me.prototype,"portalMode",void 0),h([f()],Me.prototype,"portalProperties",void 0),h([f()],Me.prototype,"region",void 0),h([f({readOnly:!0})],Me.prototype,"restUrl",null),h([f()],Me.prototype,"rotatorPanels",void 0),h([f()],Me.prototype,"showHomePageDescription",void 0),h([f()],Me.prototype,"sourceJSON",void 0),h([f()],Me.prototype,"staticImagesUrl",void 0),h([f({json:{name:"2DStylesGroupQuery"}})],Me.prototype,"stylesGroupQuery2d",void 0),h([f({json:{name:"stylesGroupQuery"}})],Me.prototype,"stylesGroupQuery3d",void 0),h([f()],Me.prototype,"supportsHostedServices",void 0),h([f()],Me.prototype,"symbolSetsGroupQuery",void 0),h([f()],Me.prototype,"templatesGroupQuery",void 0),h([f()],Me.prototype,"thumbnail",void 0),h([f({readOnly:!0})],Me.prototype,"thumbnailUrl",null),h([f()],Me.prototype,"units",void 0),h([f()],Me.prototype,"url",void 0),h([f()],Me.prototype,"urlKey",void 0),h([si("urlKey")],Me.prototype,"readUrlKey",null),h([f()],Me.prototype,"user",void 0),h([si("user")],Me.prototype,"readUser",null),h([f()],Me.prototype,"use3dBasemaps",void 0),h([f()],Me.prototype,"useStandardizedQuery",void 0),h([f()],Me.prototype,"useVectorBasemaps",void 0),h([f()],Me.prototype,"vectorBasemapGalleryGroupQuery",void 0),Me=Sf=h([k("esri.portal.Portal")],Me);const Au=Me,Kq=new FinalizationRegistry(t=>{t.remove()});function lCe(t){const e=Qi;return()=>{const r=t.deref();r&&e.findCredential(r.restUrl)&&r.signIn().catch(()=>{})}}let Ef=class extends xe{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e!=null&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){e!=null&&wc(e)?ne.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",r){const i=this.cdnUrl;if(i==null)throw new X("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:r==null?void 0:r.signal})}async update(e,r){const{addOrUpdateResource:i}=await he(()=>import("./resourceUtils-03345e02.js"),[],import.meta.url);return i(this,"update",e,r)}hasPath(){return this.path!=null}_normalizePath(e,r){return e==null?e:(e=e.replace(/^\/+/,""),r!=null&&wc(e)&&(e=e7(e,r.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};h([f()],Ef.prototype,"portalItem",void 0),h([f({type:String,value:null})],Ef.prototype,"path",null),h([zi("path")],Ef.prototype,"_castPath",null),h([f({type:String,readOnly:!0})],Ef.prototype,"url",null),h([f({type:String,readOnly:!0})],Ef.prototype,"cdnUrl",null),h([f({type:String,readOnly:!0})],Ef.prototype,"itemRelativeUrl",null),Ef=h([k("esri.portal.PortalItemResource")],Ef);const cCe=Ef;let QT=class extends xe{constructor(e){super(e),this.created=null,this.rating=null}};h([f()],QT.prototype,"created",void 0),h([f()],QT.prototype,"rating",void 0),QT=h([k("esri.portal.PortalRating")],QT);const u4=QT;var p_;const uCe=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),hCe=new Set(["KML","GeoJson","CSV"]);let Kt=p_=class extends S3(z0){static from(t){return Tx(p_,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let r=t;return t==="Feature Service"||t==="Feature Collection"?r=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?r=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?r="Scene Layer":t==="Video Service"?r="Video Layer":t==="Scene Package"?r="Scene Layer Package":t==="Stream Service"?r="Feature Layer":t==="Geoprocessing Service"?r=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?r="Locator":t==="Geoenrichment Service"?r="GeoEnrichment Service":t==="Microsoft Powerpoint"?r="Microsoft PowerPoint":t==="GeoJson"?r="GeoJSON":t==="Globe Service"?r="Globe Layer":t==="Vector Tile Service"?r="Tile Layer":t==="netCDF"?r="NetCDF":t==="Map Service"?r=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?r=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?r="Big Data File Share":t==="Compact Tile Package"?r="Tile Package (tpkx)":t==="OGCFeatureServer"?r="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?r="Instant App":t==="Insights Page"?r="Insights Report":t==="Excalibur Imagery Project"&&(r="Excalibur Project"),r}readExtent(t){return t&&t.length?new Xr(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){var p;const t=((p=this.type)==null?void 0:p.toLowerCase())||"",e=this.typeKeywords||[],r="esri/images/portal/",i="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,u=!1,d=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),u=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":u?"utilitynetwork":"features"):s=t==="map service"||t==="wms"||t==="wmts"?n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":t==="3dtiles service"?"3dtileslayer":"layers"):t==="web map"||t==="cityengine web scene"?s="maps":t==="web scene"?s=e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?s="instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?s="apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?s="mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?s="datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?s="appsgray":t==="360 vr experience"?s="360vr":t==="arcgis pro add in"||t==="arcgis pro configuration"?s="addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?s="datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?s="toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?s="layersgray":t==="scene package"?s="scenepackage":t==="3dtiles package"?s="3dtileslayerpackage":t==="mobile scene package"?s="mobilescenepackage":t==="tile package"||t==="compact tile package"?s="tilepackage":t==="task file"?s="taskfile":t==="report template"?s="report-template":t==="statistical data collection"?s="statisticaldatacollection":t==="insights workbook"?s="workbook":t==="insights model"?s="insightsmodel":t==="insights page"?s="insightspage":t==="insights theme"?s="insightstheme":t==="hub initiative"?s="hubinitiative":t==="hubpage"?s="hubpage":t==="hub event"?s="hubevent":t==="hub site application"?s="hubsite":t==="hub project"?s="hubproject":t==="relational database connection"?s="relationaldatabaseconnection":t==="big data file share"?s="datastorecollection":t==="image collection"?s="imagecollection":t==="style"?s="style":t==="desktop style"?s="desktopstyle":t==="dashboard"?s="dashboard":t==="raster function template"?s="rasterprocessingtemplate":t==="vector tile package"?s="vectortilepackage":t==="ortho mapping project"?s="orthomappingproject":t==="ortho mapping template"?s="orthomappingtemplate":t==="solution"?s="solutions":t==="geopackage"?s="geopackage":t==="deep learning package"?s="deeplearningpackage":t==="real time analytic"?s="realtimeanalytics":t==="big data analytic"?s="bigdataanalytics":t==="feed"?s="feed":t==="excalibur imagery project"?s="excaliburimageryproject":t==="notebook"?s="notebook":t==="storymap"?s="storymap":t==="survey123 add in"?s="survey123addin":t==="mission"?s="mission":t==="mission report"?s="missionreport":t==="mission template"?s="missiontemplate":t==="quickcapture project"?s="quickcaptureproject":t==="pro report"?s="proreport":t==="pro report template"?s="proreporttemplate":t==="urban model"?s="urbanmodel":t==="web experience"?s="experiencebuilder":t==="web experience template"?s="webexperiencetemplate":t==="experience builder widget"?s="experiencebuilderwidget":t==="experience builder widget package"?s="experiencebuilderwidgetpackage":t==="workflow"?s="workflow":t==="insights script"?s="insightsscript":t==="kernel gateway connection"?s="kernelgatewayconnection":t==="hub initiative template"?s="hubinitiativetemplate":t==="storymap theme"?s="storymaptheme":t==="knowledge graph"?s="knowledgegraph":t==="knowledge studio project"?s="knowledgestudio":t==="native application"?s="nativeapp":t==="native application installer"?s="nativeappinstaller":t==="link chart"?s="linkchart":t==="investigation"?s="investigation":t==="ogcfeatureserver"?s="features":t==="pro project"?s="proproject":t==="insights workbook package"?s="insightsworkbookpackage":t==="apache parquet"?s="apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?s="notebookcodesnippets":t==="suitability model"?s="suitabilitymodel":t==="esri classifier definition"?s="classifierdefinition":t==="esri classification schema"?s="classificationschema":t==="insights data engineering workbook"?s="dataengineeringworkbook":t==="insights data engineering model"?s="dataengineeringmodel":t==="deep learning studio project"?s="deeplearningproject":t==="discussion"?s="discussion":t==="allsource project"?s="allsourceproject":t==="api key"?s="apikey":t==="data pipeline"?s="datapipelines":t==="group layer"?(d=e.includes("Map"),s=d?"layergroup2d":"layergroup"):s=t==="media layer"?"onlinemedialayer":t==="form"?e.includes("Survey123")?"survey":"datafilesgray":"maps",s?ei(r+s+i+".png"):null}get isLayer(){return this.type!=null&&uCe.has(this.type)}get itemCdnUrl(){let t=this.itemUrl;return t&&Qi&&!Qi.findCredential(t)&&(t=Qi._normalizeAGOLorgDomain(t),t=t.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),t=t.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),t=t.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),t}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var r;const t=this.itemUrl,e=this.thumbnail;return t&&e?((r=this.portal)==null?void 0:r.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){var r,i,s;const t=(r=this.portal)==null?void 0:r.restUrl;if(!t)return null;const e=this.owner||((s=(i=this.portal)==null?void 0:i.user)==null?void 0:s.username);return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=Au.getDefault()),r=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof u4&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new u4({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:ye(this.applicationProxies),avgRating:this.avgRating,categories:ye(this.categories),created:ye(this.created),culture:this.culture,description:this.description,extent:ye(this.extent),groupCategories:ye(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ye(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ye(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ye(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ye(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new p_({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){var r;const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]=(r=t[i])==null?void 0:r.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return this.portal.request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new u4(e)):null}fetchRelatedItems(t,e){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},p_)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t==null?void 0:t.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?r.query.text=e:typeof e=="object"&&(r.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new X("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new X("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:r}=this;await e.signIn();const{copyResources:i,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:i==="all",folder:typeof s=="string"?s:s==null?void 0:s.id,includeResources:!!i,tags:n==null?void 0:n.join(","),title:o}},{itemId:l}=await e.request(`${r}/copy`,a);return new p_({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,r=t.filename,i={method:"post"};if(typeof e=="string")qp(e)?i.query={data:e}:i.query={url:dc(e)},r!=null&&(i.query.filename=r);else{const s=new FormData;r!=null?s.append("file",e,r):s.append("file",e),i.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new X("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:r}=await he(()=>import("./resourceUtils-03345e02.js"),[],import.meta.url);return r(this,t,e)}async addResource(t,e,r){const{addOrUpdateResource:i}=await he(()=>import("./resourceUtils-03345e02.js"),[],import.meta.url);return t.portalItem=this,i(t,"add",e,r)}async removeResource(t,e){const{removeResource:r}=await he(()=>import("./resourceUtils-03345e02.js"),[],import.meta.url);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new X("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await he(()=>import("./resourceUtils-03345e02.js"),[],import.meta.url);return e(this,t)}resourceFromPath(t){return new cCe({portalItem:this,path:t})}toJSON(){var r,i;const t=this.extent,e={accessInformation:this.accessInformation,categories:ye(this.categories),created:(r=this.created)==null?void 0:r.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:(i=this.modified)==null?void 0:i.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ye(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ye(this.typeKeywords),url:this.url};return $se(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new p_({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};h([f({type:["private","shared","org","public"]})],Kt.prototype,"access",void 0),h([f()],Kt.prototype,"accessInformation",void 0),h([f({type:String})],Kt.prototype,"apiKey",void 0),h([f({json:{read:{source:"appProxies"}}})],Kt.prototype,"applicationProxies",void 0),h([f()],Kt.prototype,"avgRating",void 0),h([f()],Kt.prototype,"categories",void 0),h([f({type:Date})],Kt.prototype,"created",void 0),h([f()],Kt.prototype,"culture",void 0),h([f()],Kt.prototype,"description",void 0),h([f({readOnly:!0})],Kt.prototype,"displayName",null),h([f({type:Xr})],Kt.prototype,"extent",void 0),h([si("extent")],Kt.prototype,"readExtent",null),h([f()],Kt.prototype,"groupCategories",void 0),h([f({readOnly:!0})],Kt.prototype,"iconUrl",null),h([f()],Kt.prototype,"id",void 0),h([f({readOnly:!0})],Kt.prototype,"isLayer",null),h([f({type:Boolean,readOnly:!0})],Kt.prototype,"isOrgItem",void 0),h([f()],Kt.prototype,"itemControl",void 0),h([f({readOnly:!0})],Kt.prototype,"itemPageUrl",null),h([f({readOnly:!0})],Kt.prototype,"itemUrl",null),h([f()],Kt.prototype,"licenseInfo",void 0),h([f({type:Date})],Kt.prototype,"modified",void 0),h([f()],Kt.prototype,"name",void 0),h([f()],Kt.prototype,"numComments",void 0),h([f()],Kt.prototype,"numRatings",void 0),h([f()],Kt.prototype,"numViews",void 0),h([f()],Kt.prototype,"owner",void 0),h([f()],Kt.prototype,"ownerFolder",void 0),h([f({type:Au})],Kt.prototype,"portal",void 0),h([f()],Kt.prototype,"screenshots",void 0),h([f()],Kt.prototype,"size",void 0),h([f()],Kt.prototype,"snippet",void 0),h([f()],Kt.prototype,"sourceJSON",void 0),h([f({type:String})],Kt.prototype,"sourceUrl",void 0),h([f({type:String})],Kt.prototype,"spatialReference",void 0),h([f()],Kt.prototype,"tags",void 0),h([f()],Kt.prototype,"thumbnail",void 0),h([f({readOnly:!0})],Kt.prototype,"thumbnailUrl",null),h([f()],Kt.prototype,"title",void 0),h([f()],Kt.prototype,"type",void 0),h([f()],Kt.prototype,"typeKeywords",void 0),h([f({type:String,json:{read(t,e){var r;if(hCe.has(e.type)){const i=(r=this.portal)==null?void 0:r.restUrl;t||(t=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return t}}})],Kt.prototype,"url",void 0),h([f({readOnly:!0})],Kt.prototype,"userItemUrl",null),Kt=p_=h([k("esri.portal.PortalItem")],Kt);const Coe=Kt,Aoe=Object.freeze(Object.defineProperty({__proto__:null,default:Coe},Symbol.toStringTag,{value:"Module"})),eW=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,dCe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function tW(t){return t in dCe}const KT=[],ex=new Map;function rW(t){for(const e of ex.keys())Roe(t.pattern,e)&&ex.delete(e)}function pCe(t){return KT.includes(t)||(rW(t),KT.unshift(t)),Rr(()=>{const e=KT.indexOf(t);e>-1&&(KT.splice(e,1),rW(t))})}async function b7(t){const e=xc();ex.has(t)||ex.set(t,mCe(t,e));const r=ex.get(t);return r&&await gCe.add(r),r}function fCe(t){if(!eW.test(t))return null;const e=eW.exec(t);if(e===null)return null;const[,r,i]=e,s=r+(i?"-"+i.toUpperCase():"");return tW(s)?s:tW(r)?r:null}async function mCe(t,e){const r=[];for(const i of KT)if(Roe(i.pattern,t))try{return await i.fetchMessageBundle(t,e)}catch(s){r.push(s)}throw r.length?new X("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:r}):new X("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function Roe(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}v7(()=>{ex.clear()});const gCe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=Go())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function yCe(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t.includes("-3d")?t.slice(0,t.indexOf("-3d")):t,r=await b7("esri/t9n/basemaps");return r[t]||r[e]}const $8={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return ei("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return ei("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return ei("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return ei("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return ei("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return ei("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return ei("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return ei("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return ei("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return ei("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return ei("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return ei("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return ei("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return ei("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return ei("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return ei("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return ei("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return ei("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return ei("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return ei("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return ei("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return ei("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return ei("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return ei("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},_Ce=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let Yb=class extends xe{constructor(e){super(e),this.id=null,this.language=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps"}getLanguageParamValue(){if(this.language)return this.language;const e=xc().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const r=rCe(e);return r==="pt"?"pt-BR":r&&_Ce.has(r)?r:"global"}};h([f()],Yb.prototype,"id",void 0),h([f()],Yb.prototype,"language",void 0),h([f()],Yb.prototype,"serviceUrl",void 0),Yb=h([k("esri.support.BasemapStyle")],Yb);const vCe=Yb;function jft(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function Hft(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function TE(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function Cx(t){return t!=null&&"type"in t&&t.type==="group"}const qft={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function bCe(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function iW(t){return(t==null?void 0:t.type)==="voxel"}function sW(t){return(t==null?void 0:t.type)==="imagery-tile"}function SP(t){return(t==null?void 0:t.parent)!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function YL(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function Wft(t){var e;return((t==null?void 0:t.type)==="feature"||(t==null?void 0:t.type)==="subtype-group")&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function wCe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const r=t.activeLayer.tileMatrixSets;if(r)return r}return null}async function Yft(t,e){const r=Qi==null?void 0:Qi.findServerInfo(t);if((r==null?void 0:r.currentVersion)!=null)return r.owningSystemUrl||null;const i=t.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const s=`${t.substring(0,i)}/rest/info`,n=e!=null?e.signal:null,{data:o}=await Hi(s,{query:{f:"json"},responseType:"json",signal:n});return(o==null?void 0:o.owningSystemUrl)||null}function xCe(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function TCe(t){return xCe(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function SCe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function ECe(t){return!!SCe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const CCe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),ACe=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function RCe(t){return t.layerContainerType==="basemap"?CCe:t.layerContainerType==="operational-layers"?ACe:null}function OCe(t,e){if(e.restrictedWebMapWriting){const r=RCe(e);return r==null||r.has(t.type)&&!YL(t)}return!0}function PCe(t,e){var r;if(e)if(YL(t)){const i=b3("featureCollection.layers",e),s=(r=i==null?void 0:i[0])==null?void 0:r.layerDefinition;s&&nW(t,s)}else t.type!=="group"&&nW(t,e)}function nW(t,e){"maxScale"in t&&(e.maxScale=m$(t.maxScale)??void 0),"minScale"in t&&(e.minScale=m$(t.minScale)??void 0)}function MCe(t,e){if(PCe(t,e),e&&(e.id=t.id,"blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=m$(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(YL(t)){const r=e.featureCollection;r&&(r.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function oW(t,e,r){if(!t.persistenceEnabled)return null;if(!("write"in t)||!t.write)return r!=null&&r.messages&&r.messages.push(new X("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(YL(t)&&!t.isTable)e=t.resourceInfo;else if(OCe(t,r)){const i={};return t.write(i,r)?i:null}return e!=null&&MCe(t,e=ye(e)),e}var eS;let $Ce=0;const ICe="esri.Basemap";let Yl=eS=class extends S3(z0){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+$Ce++,this.baseLayers=new St,this.referenceLayers=new St;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&ne.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.addHandles([this.baseLayers.on("after-add",i=>e(i.item)),this.referenceLayers.on("after-add",i=>e(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{ne.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.toArray();for(const r of t)r.destroy();const e=this.referenceLayers.toArray();for(const r of e)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=Oe(this.portalItem)}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",V1(t,this._get("baseLayers")))}_writeBaseLayers(t,e,r){const i=[];t&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=oW(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&i.push(n)}),this.referenceLayers.forEach(s=>{const n=oW(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&(s.type!=="scene"&&(n.isReference=!0),i.push(n))})),e.baseMapLayers=i}set referenceLayers(t){this._set("referenceLayers",V1(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return ooe(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>i$(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>i$(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new eS({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){var r;return t=t||{},e!=null&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&((r=this.resourceInfo)!=null&&r.data.baseMapLayers)&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const s=ye(i);return s.url&&Dp(s.url)&&(s.url=`https:${s.url}`),s.templateUrl&&Dp(s.templateUrl)&&(s.templateUrl=`https:${s.templateUrl}`),s})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:r,style:i}=this;wt(t);const s=[];if(e){const n=e.context?e.context.url:null;if(s.push(this._loadLayersFromJSON(e.data,n,t)),e.data.id&&!e.data.title){const o=e.data.id;s.push(yCe(o).then(a=>{a&&this.read({title:a},e.context)}))}}else r?s.push(this._loadFromItem(r,t)):i&&s.push(this._loadFromStylesService(i,t));await Promise.all(s)}async _loadLayersFromJSON(t,e,r){var l,c;const i=(l=this.resourceInfo)==null?void 0:l.context,s=((c=this.portalItem)==null?void 0:c.portal)||(i==null?void 0:i.portal)||null,n=DCe[(i==null?void 0:i.origin)||""]??"web-map",{populateOperationalLayers:o}=await he(()=>import("./layersCreator-d5e2c3a6.js"),["./layersCreator-d5e2c3a6.js","./portalLayers-7fd41ec7.js","./associatedFeatureServiceUtils-2fac8951.js","./lazyLayerLoader-aea79d16.js","./portalItemUtils-bd3ade0c.js","./styleUtils-5179403f.js"],import.meta.url),a=[];if(wt(r),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const u={context:{...i,origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},d=y=>n==="web-scene"&&y.layerType==="ArcGISSceneServiceLayer"||y.isReference,p=o(this.baseLayers,t.baseMapLayers.filter(y=>!d(y)),u);a.push(p);const g=o(this.referenceLayers,t.baseMapLayers.filter(d),u);a.push(g)}await Promise.allSettled(a)}async _loadFromItem(t,e){const r=await t.load(e),i=await r.fetchData("json",e),s=Wn(t.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:LCe[t.type||""]??"web-map",portal:t.portal||Au.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||Au.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}async _loadFromStylesService(t,e){var n;const r=`${t.serviceUrl}/${t.id}`,i=(await Hi(r,{query:{language:t.getLanguageParamValue()},signal:e==null?void 0:e.signal})).data;if(i.baseMap&&Array.isArray(i.baseMap.baseMapLayers)){for(const o of i.baseMap.baseMapLayers)if(!o.customParameters&&((n=o.styleUrl)!=null&&n.includes("?"))){const a=Wn(o.styleUrl);a.query&&(o.styleUrl=a.path,o.customParameters=a.query)}}const s=Wn(r);return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:"web-map",url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}static fromId(t){const e=$8[t];return e?e.itemId?new eS({portalItem:{id:e.itemId,portal:{url:"https://www.arcgis.com"}}}):eS.fromJSON(e,{origin:e.is3d?"web-scene":"web-map"}):null}};h([f({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,r,i){this._writeBaseLayers(t,e,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:St}},writer(t,e,r,i){this._writeBaseLayers(t,e,i)}}}}}})],Yl.prototype,"baseLayers",null),h([f({type:String,json:{origins:{"web-scene":{write:!0}}}})],Yl.prototype,"id",void 0),h([f({type:Coe})],Yl.prototype,"portalItem",void 0),h([f()],Yl.prototype,"referenceLayers",null),h([f({readOnly:!0})],Yl.prototype,"resourceInfo",void 0),h([f({type:at})],Yl.prototype,"spatialReference",void 0),h([f({type:vCe})],Yl.prototype,"style",void 0),h([f()],Yl.prototype,"thumbnailUrl",void 0),h([f({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Yl.prototype,"title",void 0),h([ni("title")],Yl.prototype,"writeTitle",null),Yl=eS=h([k(ICe)],Yl);const LCe={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},DCe={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},SE=Yl,NCe=Object.freeze(Object.defineProperty({__proto__:null,default:SE},Symbol.toStringTag,{value:"Module"})),P$={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function Ooe(t){return!!P$[t]||!!P$[t.toLowerCase()]}function w7(t){return P$[t]??P$[t.toLowerCase()]}function FCe(t){return[...w7(t)]}function h4(t,e,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?t+(e-t)*i:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function Poe(t,e,r,i=1){const s=(t%360+360)%360/360,n=r<=.5?r*(e+1):r+e-r*e,o=2*r-n;return[Math.round(255*h4(o,n,s+1/3)),Math.round(255*h4(o,n,s)),Math.round(255*h4(o,n,s-1/3)),i]}function UCe(t){const e=t.length>5,r=e?8:4,i=(1<<r)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&i,o>>=r,a[3]=s*l/255),l=o&i,o>>=r,a[2]=s*l,l=o&i,o>>=r,a[1]=s*l,l=o&i,o>>=r,a[0]=s*l,a}function E(){return[0,0,0]}function Ii(t){return[t[0],t[1],t[2]]}function Te(t,e,r){return[t,e,r]}function Oo(t,e=E()){const r=Math.min(3,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Moe(t,e){return new Float64Array(t,e,3)}function $oe(){return E()}function Ioe(){return Te(1,1,1)}function Loe(){return Te(1,0,0)}function Doe(){return Te(0,1,0)}function x7(){return Te(0,0,1)}const Mn=$oe(),Jf=Ioe(),Noe=Loe(),Foe=Doe(),T7=x7();Object.freeze(Object.defineProperty({__proto__:null,ONES:Jf,UNIT_X:Noe,UNIT_Y:Foe,UNIT_Z:T7,ZEROS:Mn,clone:Ii,create:E,createView:Moe,fromArray:Oo,fromValues:Te,ones:Ioe,unitX:Loe,unitY:Doe,unitZ:x7,zeros:$oe},Symbol.toStringTag,{value:"Module"}));let S7=1e-6;function Qn(){return S7}function kCe(t){S7=t}const A3=Math.random,BCe=Math.PI/180,zCe=180/Math.PI;function XL(t){return t*BCe}function VCe(t){return t*zCe}function GCe(t,e){return Math.abs(t-e)<=S7*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:A3,equals:GCe,getEpsilon:Qn,setEpsilon:kCe,toDegree:VCe,toRadian:XL},Symbol.toStringTag,{value:"Module"}));function _e(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function ie(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function se(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function le(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function ce(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function ZL(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function M$(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function jCe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Uoe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function Ax(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function $$(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function JL(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function koe(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function HCe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ee(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Ga(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function hi(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(r*r+i*i+s*s)}function Yn(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function co(t){const e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function ko(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function qCe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function pe(t,e){const r=e[0],i=e[1],s=e[2];let n=r*r+i*i+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function de(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function rt(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];return t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o,t}function $r(t,e,r,i){const s=e[0],n=e[1],o=e[2];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t}function WCe(t,e,r,i,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),u=o*(3-2*n);return t[0]=e[0]*a+r[0]*l+i[0]*c+s[0]*u,t[1]=e[1]*a+r[1]*l+i[1]*c+s[1]*u,t[2]=e[2]*a+r[2]*l+i[2]*c+s[2]*u,t}function YCe(t,e,r,i,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,u=3*n*a,d=3*l*o,p=l*n;return t[0]=e[0]*c+r[0]*u+i[0]*d+s[0]*p,t[1]=e[1]*c+r[1]*u+i[1]*d+s[1]*p,t[2]=e[2]*c+r[2]*u+i[2]*d+s[2]*p,t}function XCe(t,e){e=e||1;const r=A3,i=2*r()*Math.PI,s=2*r()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t[2]=s*e,t}function De(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12],t[1]=r[1]*i+r[5]*s+r[9]*n+r[13],t[2]=r[2]*i+r[6]*s+r[10]*n+r[14],t}function Sl(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=i*r[0]+s*r[3]+n*r[6],t[1]=i*r[1]+s*r[4]+n*r[7],t[2]=i*r[2]+s*r[5]+n*r[8],t}function Cp(t,e,r){const i=r[0],s=r[1],n=r[2],o=r[3],a=e[0],l=e[1],c=e[2];let u=s*c-n*l,d=n*a-i*c,p=i*l-s*a,g=s*p-n*d,y=n*u-i*p,_=i*d-s*u;const v=2*o;return u*=v,d*=v,p*=v,g*=2,y*=2,_*=2,t[0]=a+u+g,t[1]=l+d+y,t[2]=c+p+_,t}function ZCe(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0],n[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),n[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function JCe(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),n[1]=s[1],n[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function QCe(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),n[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),n[2]=s[2],t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function Boe(t,e){ie(MA,t),ie($A,e),pe(MA,MA),pe($A,$A);const r=de(MA,$A);return r>1?0:r<-1?Math.PI:Math.acos(r)}const MA=E(),$A=E();function KCe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function ho(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Y1(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=Qn();return Math.abs(r-n)<=l*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function Rm(t,e,r){const i=r[0]-e[0],s=r[1]-e[1],n=r[2]-e[2];let o=i*i+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=i*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Rn=ce,e3e=ZL,t3e=M$,R3=hi,QL=Yn,ml=_e,I8=co,aW=Object.freeze(Object.defineProperty({__proto__:null,abs:Ax,add:le,angle:Boe,bezier:YCe,ceil:jCe,copy:ie,cross:rt,direction:Rm,dist:R3,distance:hi,div:t3e,divide:M$,dot:de,equals:Y1,exactEquals:ho,floor:Uoe,hermite:WCe,inverse:qCe,len:ml,length:_e,lerp:$r,max:koe,min:JL,mul:e3e,multiply:ZL,negate:ko,normalize:pe,random:XCe,rotateX:ZCe,rotateY:JCe,rotateZ:QCe,round:HCe,scale:ee,scaleAndAdd:Ga,set:se,sign:$$,sqrDist:QL,sqrLen:I8,squaredDistance:Yn,squaredLength:co,str:KCe,sub:Rn,subtract:ce,transformMat3:Sl,transformMat4:De,transformQuat:Cp},Symbol.toStringTag,{value:"Module"}));function Fh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Si(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function E7(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function zoe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Voe(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Goe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function r3e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function i3e(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function s3e(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function n3e(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function o3e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function X1(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function a3e(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function joe(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(r*r+i*i+s*s+n*n)}function I$(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return r*r+i*i+s*s+n*n}function C7(t){const e=t[0],r=t[1],i=t[2],s=t[3];return Math.sqrt(e*e+r*r+i*i+s*s)}function A7(t){const e=t[0],r=t[1],i=t[2],s=t[3];return e*e+r*r+i*i+s*s}function l3e(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function c3e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Hoe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*r+i*i+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=i*o,t[2]=s*o,t[3]=n*o),t}function qoe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function R7(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t[3]=a+i*(r[3]-a),t}function u3e(t,e){const r=A3;let i,s,n,o,a,l;e=e||1;do i=2*r()-1,s=2*r()-1,a=i*i+s*s;while(a>=1);do n=2*r()-1,o=2*r()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*i,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function gc(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12]*o,t[1]=r[1]*i+r[5]*s+r[9]*n+r[13]*o,t[2]=r[2]*i+r[6]*s+r[10]*n+r[14]*o,t[3]=r[3]*i+r[7]*s+r[11]*n+r[15]*o,t}function h3e(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2],c=r[3],u=c*i+a*n-l*s,d=c*s+l*i-o*n,p=c*n+o*s-a*i,g=-o*i-a*s-l*n;return t[0]=u*c+g*-o+d*-l-p*-a,t[1]=d*c+g*-a+p*-o-u*-l,t[2]=p*c+g*-l+u*-a-d*-o,t[3]=e[3],t}function d3e(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function tx(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Z1(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=Qn();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}const p3e=zoe,f3e=Voe,m3e=Goe,g3e=joe,y3e=I$,_3e=C7,v3e=A7,Woe=Object.freeze(Object.defineProperty({__proto__:null,add:E7,ceil:r3e,copy:Fh,dist:g3e,distance:joe,div:m3e,divide:Goe,dot:qoe,equals:Z1,exactEquals:tx,floor:i3e,inverse:c3e,len:_3e,length:C7,lerp:R7,max:n3e,min:s3e,mul:f3e,multiply:Voe,negate:l3e,normalize:Hoe,random:u3e,round:o3e,scale:X1,scaleAndAdd:a3e,set:Si,sqrDist:y3e,sqrLen:v3e,squaredDistance:I$,squaredLength:A7,str:d3e,sub:p3e,subtract:zoe,transformMat4:gc,transformQuat:h3e},Symbol.toStringTag,{value:"Module"})),lW=new Float32Array(1);function Yoe(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function me(t,e,r){return Math.min(Math.max(t,e),r)}function J1(t){return(t&t-1)==0}function Xft(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function Zft(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function ft(t,e,r){return t+(e-t)*r}function Jft(t,e,r,i,s){return ft(i,s,(t-e)/(r-e))}function At(t){return t*Math.PI/180}function _a(t){return 180*t/Math.PI}function L8(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function un(t){return Math.acos(me(t,-1,1))}function Ru(t){return Math.asin(me(t,-1,1))}function P0(t,e,r=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=r}const L$=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function D8(t){return L$.setFloat64(0,t),L$.getBigInt64(0)}function b3e(t){return L$.setBigInt64(0,t),L$.getFloat64(0)}const EP=BigInt("1000000"),w3e=Xoe(1);function Xoe(t){const e=D8(t=Math.abs(t)),r=b3e(e<=EP?EP:e-EP);return Math.abs(t-r)}function Qft(t,e,r=w3e){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(r!=null&&Xoe(Math.min(Math.abs(t),Math.abs(e)))<r)return Math.abs(t-e)<=r;const i=D8(t),s=D8(e);return i<0!=s<0?!1:!((i<s?s-i:i-s)>EP)}function x3e(t,e,r=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const i=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(i>.01*r)return!1}else if(i/(s+n)>r)return!1;return!0}function T3e(t){return Zoe(Math.max(-N8,Math.min(t,N8)))}function Zoe(t){return lW[0]=t,lW[0]}function AC(t,e,r){const i=me((r-t)/(e-t),0,1);return i*i*(3-2*i)}function cW(t,e){const r=_e(t),i=Ru(t[2]/r),s=Math.atan2(t[1]/r,t[0]/r);return se(e,r,i,s),e}function Kft(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],i=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(P0(e,1)&&P0(r,1)&&P0(i,1))}const N8=Zoe(34028234663852886e22);function IA(t){return me(Hz(t),0,255)}function LA(t,e,r){return t=Number(t),isNaN(t)?r:t<e?e:t>r?r:t}function DA(t,e){const r=t.toString(16).padStart(2,"0");return e?r.substring(0,1):r}let CP=class Un{static blendColors(e,r,i,s=new Un){return s.r=Math.round(e.r+(r.r-e.r)*i),s.g=Math.round(e.g+(r.g-e.g)*i),s.b=Math.round(e.b+(r.b-e.b)*i),s.a=e.a+(r.a-e.a)*i,s._sanitize()}static fromRgb(e,r){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const s=i[2].split(/\s*,\s*/),n=i[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),Un.fromArray(a,r)}return Un.fromArray(s.map(a=>parseFloat(a)),r)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return Un.fromArray(Poe(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),r)}return null}static fromHex(e,r=new Un){if(e[0]!=="#"||isNaN(+`0x${e.substring(1)}`))return null;switch(e.length){case 4:case 5:{const i=parseInt(e.substring(1,2),16),s=parseInt(e.substring(2,3),16),n=parseInt(e.substring(3,4),16),o=e.length===5?15:parseInt(e.substring(4),16);return Un.fromArray([i+16*i,s+16*s,n+16*n,(o+16*o)/255],r)}case 7:case 9:{const i=parseInt(e.substring(1,3),16),s=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16),o=e.length===7?255:parseInt(e.substring(7),16);return Un.fromArray([i,s,n,o/255],r)}default:return null}}static fromArray(e,r=new Un){return r._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(e,r){const i=Ooe(e)?w7(e):null;return i&&Un.fromArray(i,r)||Un.fromRgb(e,r)||Un.fromHex(e,r)}static fromJSON(e){return e!=null?new Un([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?Un.fromString(e,this):Array.isArray(e)?Un.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof Un||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const r=(e==null?void 0:e.capitalize)??!1,i=(e==null?void 0:e.digits)??6,s=i===3||i===4,n=i===4||i===8,o=`#${DA(this.r,s)}${DA(this.g,s)}${DA(this.b,s)}${n?DA(Math.round(255*this.a),s):""}`;return r?o.toUpperCase():o}toCss(e=!1){const r=this.r+", "+this.g+", "+this.b;return e?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=Un.AlphaMode.ALWAYS){const r=IA(this.r),i=IA(this.g),s=IA(this.b);return e===Un.AlphaMode.ALWAYS||this.a!==1?[r,i,s,IA(255*this.a)]:[r,i,s]}clone(){return new Un(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(LA(this.r,0,255)),this.g=Math.round(LA(this.g,0,255)),this.b=Math.round(LA(this.b,0,255)),this.a=LA(this.a,0,1),this}_set(e,r,i,s){this.r=e,this.g=r,this.b=i,this.a=s}};CP.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(CP||(CP={}));const qe=CP;function emt(t){}function S3e(t){return()=>t}function Ht(t,e={}){const r=t instanceof Pc?t:new Pc(t,e),i={type:(e==null?void 0:e.ignoreUnknown)??1?r.apiValues:String,json:{type:r.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(i.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(i.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(i.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(i.nonNullable=e.nonNullable),f(i)}var F8;let AP=F8=class extends st{constructor(t){super(t),this.type="none"}clone(){return new F8({type:this.type})}};h([Ht({none:"none",stayAbove:"stay-above"})],AP.prototype,"type",void 0),AP=F8=h([k("esri.ground.NavigationConstraint")],AP);function Joe(t){const e=Hz(100*(1-t));return Math.max(0,Math.min(e,100))}function Qoe(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var U8;let Cf=U8=class extends S3(z0){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new St;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&ne.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.addHandles([this.layers.on("after-add",i=>e(i.item)),this.layers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{Os(t)||ne.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)Oe(e);this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",V1(t,this._get("layers")))}writeLayers(t,e,r,i){const s=[];t&&(i={...i,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};S3e(n)().write(o,i)&&s.push(o)}else i!=null&&i.messages&&i.messages.push(new X("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return ooe(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await he(()=>import("./ElevationQuery-8b4d4422.js"),[],import.meta.url);wt(e);const i=new r,s=this.layers.filter(uW).toArray();return i.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await he(()=>import("./ElevationQuery-8b4d4422.js"),[],import.meta.url);wt(e);const i=new r,s=this.layers.filter(uW).toArray();return i.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:ye(this.surfaceColor),navigationConstraint:ye(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new U8({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}async _loadLayersFromJSON(t,e,r){const i=(e==null?void 0:e.origin)||"web-scene",s=(e==null?void 0:e.portal)||null,n=(e==null?void 0:e.url)||null,{populateOperationalLayers:o}=await he(()=>import("./layersCreator-d5e2c3a6.js"),["./layersCreator-d5e2c3a6.js","./portalLayers-7fd41ec7.js","./associatedFeatureServiceUtils-2fac8951.js","./lazyLayerLoader-aea79d16.js","./portalItemUtils-bd3ade0c.js","./styleUtils-5179403f.js"],import.meta.url);wt(r);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:i,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}await Promise.allSettled(a)}};function E3e(t){return t&&"createElevationSampler"in t}function uW(t){return t.type==="elevation"||E3e(t)}h([f({json:{read:!1}})],Cf.prototype,"layers",null),h([ni("layers")],Cf.prototype,"writeLayers",null),h([f({readOnly:!0})],Cf.prototype,"resourceInfo",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Qs,read:{reader:Qoe,source:"transparency"},write:{writer:(t,e)=>{e.transparency=Joe(t)},target:"transparency"}}})],Cf.prototype,"opacity",void 0),h([f({type:qe,json:{type:[Qs],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],Cf.prototype,"surfaceColor",void 0),h([f({type:AP,json:{write:!0}})],Cf.prototype,"navigationConstraint",void 0),Cf=U8=h([k("esri.Ground")],Cf);const D$=Cf;let Xb=class extends St{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles(hne(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let r=0;for(const i of e)i!=null&&(r=this._processCollection(r,i));this.splice(r,this.length)}_createNewInstance(e){return new St(e)}_processCollection(e,r){if(!r)return e;const i=this.itemFilterFunction??(s=>!!s);for(const s of r)if(s){if(i(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};h([f()],Xb.prototype,"getCollections",void 0),h([f()],Xb.prototype,"getChildrenFunction",void 0),h([f()],Xb.prototype,"itemFilterFunction",void 0),Xb=h([k("esri.core.CollectionFlattener")],Xb);const RC=Xb,C3e=[["binary","application/octet-stream","bin",""]];function rmt(t,e){return tae(e.name,(t==null?void 0:t.supportedFormats)??[])!=null}function imt(t,e){if(!t)return!1;const r=A3e(e,t.supportedFormats??[]);return r!=null&&t.editFormats.includes(r)}function Koe(t,e){return P7(O3e(t,e))}function eae(t,e){return P7(tae(t,e))}function smt(t,e){return rae(R3e(t,e))}function A3e(t,e){return eae(t.name,e)??Koe(t.type,e)}function O7(t){return[...C3e,...t]}function R3e(t,e){return O7(e).find(r=>P7(r)===t)}function O3e(t,e){const r=t.toLowerCase();return O7(e).find(i=>rae(i)===r)}function tae(t,e){const r=t.toLowerCase();return O7(e).find(i=>P3e(i).some(s=>r.endsWith(s)))}function P7(t){return t==null?void 0:t[0]}function rae(t){return t==null?void 0:t[1].toLowerCase()}function P3e(t){return(t==null?void 0:t[2].split(",").map(e=>e.toLowerCase()))??[]}function nmt(t){var e;return(e=t.tables)==null?void 0:e.find(r=>r.role==="assetMaps")}function M3e(t){var e,r;return!(!(t&&typeof t=="object"&&"loaded"in t&&t.loaded&&((r=(e=TCe(t))==null?void 0:e.operations)!=null&&r.supportsEditing)&&"type"in t)||"editingEnabled"in t&&!ECe(t)||t.type==="scene"&&!$3e(t))}function $3e(t){const{associatedLayer:e}=t,r=e==null?void 0:e.infoFor3D;if(!r)return!0;const{supportedFormats:i,queryFormats:s}=r,n=Koe("model/gltf-binary",i)??eae("glb",i);if(!(n!=null&&s.includes(n)))return ne.getLogger("esri.layers.support.editableLayers").warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) is not editable because it does not support GLB queries.`),!1;const o=t.spatialReference,a=e.spatialReference;if(!hs(o,a))return ne.getLogger("esri.layers.support.editableLayers").warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) is not editable because its spatial reference (wkid:${o.wkid}) is different from its associated FeatureLayer's spatial reference (wkid:${a.wkid}).`),!1;const l=e.sourceJSON.sourceSpatialReference;return!(l!=null&&!hs(l,a))||(ne.getLogger("esri.layers.support.editableLayers").warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) is not editable because the spatial reference of its associated FeatureLayer's service (wkid:${a.wkid}) is different from its source spatial reference (wkid:${l.wkid}).`),!1)}const I3e=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,L3e="screenUtils.toPt: input not recognized!",iae=96;function Fo(t){return t?t/72*iae:0}function Kh(t){return t?72*t/iae:0}function Rs(t){if(typeof t=="string"){const e=t.match(I3e);if(e){const r=Number(e[1]),i=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=i==="px"?Kh(r):r;return s?-n:n}return console.warn(L3e),null}return t}function Ou(t=0,e=0){return{x:t,y:e}}function Vi(t=0,e=0){return[t,e]}function sae(t=0,e=0){return[t,e]}function po(t=0,e=0,r=0){return[t,e,r]}function omt(t){return t}function amt(t){return t}function lmt(t){return t}function Nh(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function KL(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function D3e(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function N3e(t,e,r,i,s,n,o,a,l,c,u,d,p,g,y,_){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=i,v[4]=s,v[5]=n,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=u,v[11]=d,v[12]=p,v[13]=g,v[14]=y,v[15]=_,v}function F3e(t,e){return new Float32Array(t,e,16)}const U3e=KL();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:U3e,clone:D3e,create:KL,createView:F3e,fromValues:N3e},Symbol.toStringTag,{value:"Module"}));function Ss(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Xp(t,e,r,i,s,n,o,a,l,c,u,d,p,g,y,_,v){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=d,t[11]=p,t[12]=g,t[13]=y,t[14]=_,t[15]=v,t}function Pu(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function $l(t,e){if(t===e){const r=e[1],i=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function T2(t,e){return Ls(t,e)||Pu(t),t}function Ls(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],g=e[11],y=e[12],_=e[13],v=e[14],w=e[15],x=r*a-i*o,T=r*l-s*o,S=r*c-n*o,C=i*l-s*a,A=i*c-n*a,O=s*c-n*l,$=u*_-d*y,D=u*v-p*y,N=u*w-g*y,z=d*v-p*_,U=d*w-g*_,Y=p*w-g*v;let H=x*Y-T*U+S*z+C*N-A*D+O*$;return H?(H=1/H,t[0]=(a*Y-l*U+c*z)*H,t[1]=(s*U-i*Y-n*z)*H,t[2]=(_*O-v*A+w*C)*H,t[3]=(p*A-d*O-g*C)*H,t[4]=(l*N-o*Y-c*D)*H,t[5]=(r*Y-s*N+n*D)*H,t[6]=(v*S-y*O-w*T)*H,t[7]=(u*O-p*S+g*T)*H,t[8]=(o*U-a*N+c*$)*H,t[9]=(i*N-r*U-n*$)*H,t[10]=(y*A-_*S+w*x)*H,t[11]=(d*S-u*A-g*x)*H,t[12]=(a*D-o*z-l*$)*H,t[13]=(r*z-i*D+s*$)*H,t[14]=(_*T-y*C-v*x)*H,t[15]=(u*C-d*T+p*x)*H,t):null}function k3e(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],g=e[11],y=e[12],_=e[13],v=e[14],w=e[15];return t[0]=a*(p*w-g*v)-d*(l*w-c*v)+_*(l*g-c*p),t[1]=-(i*(p*w-g*v)-d*(s*w-n*v)+_*(s*g-n*p)),t[2]=i*(l*w-c*v)-a*(s*w-n*v)+_*(s*c-n*l),t[3]=-(i*(l*g-c*p)-a*(s*g-n*p)+d*(s*c-n*l)),t[4]=-(o*(p*w-g*v)-u*(l*w-c*v)+y*(l*g-c*p)),t[5]=r*(p*w-g*v)-u*(s*w-n*v)+y*(s*g-n*p),t[6]=-(r*(l*w-c*v)-o*(s*w-n*v)+y*(s*c-n*l)),t[7]=r*(l*g-c*p)-o*(s*g-n*p)+u*(s*c-n*l),t[8]=o*(d*w-g*_)-u*(a*w-c*_)+y*(a*g-c*d),t[9]=-(r*(d*w-g*_)-u*(i*w-n*_)+y*(i*g-n*d)),t[10]=r*(a*w-c*_)-o*(i*w-n*_)+y*(i*c-n*a),t[11]=-(r*(a*g-c*d)-o*(i*g-n*d)+u*(i*c-n*a)),t[12]=-(o*(d*v-p*_)-u*(a*v-l*_)+y*(a*p-l*d)),t[13]=r*(d*v-p*_)-u*(i*v-s*_)+y*(i*p-s*d),t[14]=-(r*(a*v-l*_)-o*(i*v-s*_)+y*(i*l-s*a)),t[15]=r*(a*p-l*d)-o*(i*p-s*d)+u*(i*l-s*a),t}function B3e(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],d=t[10],p=t[11],g=t[12],y=t[13],_=t[14],v=t[15];return(e*o-r*n)*(d*v-p*_)-(e*a-i*n)*(u*v-p*y)+(e*l-s*n)*(u*_-d*y)+(r*a-i*o)*(c*v-p*g)-(r*l-s*o)*(c*_-d*g)+(i*l-s*a)*(c*y-u*g)}function Pr(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=e[9],g=e[10],y=e[11],_=e[12],v=e[13],w=e[14],x=e[15];let T=r[0],S=r[1],C=r[2],A=r[3];return t[0]=T*i+S*a+C*d+A*_,t[1]=T*s+S*l+C*p+A*v,t[2]=T*n+S*c+C*g+A*w,t[3]=T*o+S*u+C*y+A*x,T=r[4],S=r[5],C=r[6],A=r[7],t[4]=T*i+S*a+C*d+A*_,t[5]=T*s+S*l+C*p+A*v,t[6]=T*n+S*c+C*g+A*w,t[7]=T*o+S*u+C*y+A*x,T=r[8],S=r[9],C=r[10],A=r[11],t[8]=T*i+S*a+C*d+A*_,t[9]=T*s+S*l+C*p+A*v,t[10]=T*n+S*c+C*g+A*w,t[11]=T*o+S*u+C*y+A*x,T=r[12],S=r[13],C=r[14],A=r[15],t[12]=T*i+S*a+C*d+A*_,t[13]=T*s+S*l+C*p+A*v,t[14]=T*n+S*c+C*g+A*w,t[15]=T*o+S*u+C*y+A*x,t}function Ya(t,e,r){const i=r[0],s=r[1],n=r[2];if(e===t)t[12]=e[0]*i+e[4]*s+e[8]*n+e[12],t[13]=e[1]*i+e[5]*s+e[9]*n+e[13],t[14]=e[2]*i+e[6]*s+e[10]*n+e[14],t[15]=e[3]*i+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],d=e[5],p=e[6],g=e[7],y=e[8],_=e[9],v=e[10],w=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=d,t[6]=p,t[7]=g,t[8]=y,t[9]=_,t[10]=v,t[11]=w,t[12]=o*i+u*s+y*n+e[12],t[13]=a*i+d*s+_*n+e[13],t[14]=l*i+p*s+v*n+e[14],t[15]=c*i+g*s+w*n+e[15]}return t}function O3(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function El(t,e,r,i){let s,n,o,a,l,c,u,d,p,g,y,_,v,w,x,T,S,C,A,O,$,D,N,z,U=i[0],Y=i[1],H=i[2],V=Math.sqrt(U*U+Y*Y+H*H);return V<Qn()?null:(V=1/V,U*=V,Y*=V,H*=V,s=Math.sin(r),n=Math.cos(r),o=1-n,a=e[0],l=e[1],c=e[2],u=e[3],d=e[4],p=e[5],g=e[6],y=e[7],_=e[8],v=e[9],w=e[10],x=e[11],T=U*U*o+n,S=Y*U*o+H*s,C=H*U*o-Y*s,A=U*Y*o-H*s,O=Y*Y*o+n,$=H*Y*o+U*s,D=U*H*o+Y*s,N=Y*H*o-U*s,z=H*H*o+n,t[0]=a*T+d*S+_*C,t[1]=l*T+p*S+v*C,t[2]=c*T+g*S+w*C,t[3]=u*T+y*S+x*C,t[4]=a*A+d*O+_*$,t[5]=l*A+p*O+v*$,t[6]=c*A+g*O+w*$,t[7]=u*A+y*O+x*$,t[8]=a*D+d*N+_*z,t[9]=l*D+p*N+v*z,t[10]=c*D+g*N+w*z,t[11]=u*D+y*N+x*z,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Rx(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],d=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*i,t[5]=o*s+u*i,t[6]=a*s+d*i,t[7]=l*s+p*i,t[8]=c*s-n*i,t[9]=u*s-o*i,t[10]=d*s-a*i,t[11]=p*s-l*i,t}function eD(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],d=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*i,t[1]=o*s-u*i,t[2]=a*s-d*i,t[3]=l*s-p*i,t[8]=n*i+c*s,t[9]=o*i+u*s,t[10]=a*i+d*s,t[11]=l*i+p*s,t}function Ox(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],d=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*i,t[1]=o*s+u*i,t[2]=a*s+d*i,t[3]=l*s+p*i,t[4]=c*s-n*i,t[5]=u*s-o*i,t[6]=d*s-a*i,t[7]=p*s-l*i,t}function P3(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function z3e(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Mc(t,e,r){if(e===0)return Pu(t);let i,s,n,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<Qn()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(e),s=Math.cos(e),n=1-s,t[0]=o*o*n+s,t[1]=a*o*n+l*i,t[2]=l*o*n-a*i,t[3]=0,t[4]=o*a*n-l*i,t[5]=a*a*n+s,t[6]=l*a*n+o*i,t[7]=0,t[8]=o*l*n+a*i,t[9]=a*l*n-o*i,t[10]=l*l*n+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function nae(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function V3e(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function oae(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function aae(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=i+i,l=s+s,c=n+n,u=i*a,d=i*l,p=i*c,g=s*l,y=s*c,_=n*c,v=o*a,w=o*l,x=o*c;return t[0]=1-(g+_),t[1]=d+x,t[2]=p-w,t[3]=0,t[4]=d-x,t[5]=1-(u+_),t[6]=y+v,t[7]=0,t[8]=p+w,t[9]=y-v,t[10]=1-(u+g),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function G3e(t,e){const r=j3e,i=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=i*i+s*s+n*n+o*o;return d>0?(r[0]=2*(a*o+u*i+l*n-c*s)/d,r[1]=2*(l*o+u*s+c*i-a*n)/d,r[2]=2*(c*o+u*n+a*s-l*i)/d):(r[0]=2*(a*o+u*i+l*n-c*s),r[1]=2*(l*o+u*s+c*i-a*n),r[2]=2*(c*o+u*n+a*s-l*i)),aae(t,e,r),t}const j3e=E();function N$(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function lae(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.sqrt(r*r+i*i+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+u*u),t}function H3e(t,e){const r=e[0]+e[5]+e[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function cae(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,u=o+o,d=s*l,p=s*c,g=s*u,y=n*c,_=n*u,v=o*u,w=a*l,x=a*c,T=a*u,S=i[0],C=i[1],A=i[2];return t[0]=(1-(y+v))*S,t[1]=(p+T)*S,t[2]=(g-x)*S,t[3]=0,t[4]=(p-T)*C,t[5]=(1-(d+v))*C,t[6]=(_+w)*C,t[7]=0,t[8]=(g+x)*A,t[9]=(_-w)*A,t[10]=(1-(d+y))*A,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function q3e(t,e,r,i,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,u=o+o,d=a+a,p=n*c,g=n*u,y=n*d,_=o*u,v=o*d,w=a*d,x=l*c,T=l*u,S=l*d,C=i[0],A=i[1],O=i[2],$=s[0],D=s[1],N=s[2],z=(1-(_+w))*C,U=(g+S)*C,Y=(y-T)*C,H=(g-S)*A,V=(1-(p+w))*A,J=(v+x)*A,P=(y+T)*O,I=(v-x)*O,B=(1-(p+_))*O;return t[0]=z,t[1]=U,t[2]=Y,t[3]=0,t[4]=H,t[5]=V,t[6]=J,t[7]=0,t[8]=P,t[9]=I,t[10]=B,t[11]=0,t[12]=r[0]+$-(z*$+H*D+P*N),t[13]=r[1]+D-(U*$+V*D+I*N),t[14]=r[2]+N-(Y*$+J*D+B*N),t[15]=1,t}function W3e(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,u=i*o,d=i*a,p=s*o,g=s*a,y=s*l,_=n*o,v=n*a,w=n*l;return t[0]=1-d-y,t[1]=u+w,t[2]=p-v,t[3]=0,t[4]=u-w,t[5]=1-c-y,t[6]=g+_,t[7]=0,t[8]=p+v,t[9]=g-_,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function uae(t,e,r,i,s,n,o){const a=1/(r-e),l=1/(s-i),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(s+i)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function Y3e(t,e,r,i,s){const n=1/Math.tan(e/2);let o;return t[0]=n/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(i-s),t[10]=(s+i)*o,t[14]=2*s*i*o):(t[10]=-1,t[14]=-2*i),t}function X3e(t,e,r,i){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function hae(t,e,r,i,s,n,o){const a=1/(e-r),l=1/(i-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*a,t[13]=(s+i)*l,t[14]=(o+n)*c,t[15]=1,t}function tD(t,e,r,i){const s=e[0],n=e[1],o=e[2];let a=s-r[0],l=n-r[1],c=o-r[2];const u=Qn();if(Math.abs(a)<u&&Math.abs(l)<u&&Math.abs(c)<u)return void Pu(t);let d=1/Math.sqrt(a*a+l*l+c*c);a*=d,l*=d,c*=d;const p=i[0],g=i[1],y=i[2];let _=g*c-y*l,v=y*a-p*c,w=p*l-g*a;d=Math.sqrt(_*_+v*v+w*w),d?(d=1/d,_*=d,v*=d,w*=d):(_=0,v=0,w=0);let x=l*w-c*v,T=c*_-a*w,S=a*v-l*_;d=Math.sqrt(x*x+T*T+S*S),d?(d=1/d,x*=d,T*=d,S*=d):(x=0,T=0,S=0),t[0]=_,t[1]=x,t[2]=a,t[3]=0,t[4]=v,t[5]=T,t[6]=l,t[7]=0,t[8]=w,t[9]=S,t[10]=c,t[11]=0,t[12]=-(_*s+v*n+w*o),t[13]=-(x*s+T*n+S*o),t[14]=-(a*s+l*n+c*o),t[15]=1}function dae(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=i[0],l=i[1],c=i[2];let u=s-r[0],d=n-r[1],p=o-r[2],g=u*u+d*d+p*p;g>0&&(g=1/Math.sqrt(g),u*=g,d*=g,p*=g);let y=l*p-c*d,_=c*u-a*p,v=a*d-l*u;return g=y*y+_*_+v*v,g>0&&(g=1/Math.sqrt(g),y*=g,_*=g,v*=g),t[0]=y,t[1]=_,t[2]=v,t[3]=0,t[4]=d*v-p*_,t[5]=p*y-u*v,t[6]=u*_-d*y,t[7]=0,t[8]=u,t[9]=d,t[10]=p,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function Z3e(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function J3e(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function Q3e(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function pae(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function K3e(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function eAe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function M7(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function rD(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],p=t[10],g=t[11],y=t[12],_=t[13],v=t[14],w=t[15],x=e[0],T=e[1],S=e[2],C=e[3],A=e[4],O=e[5],$=e[6],D=e[7],N=e[8],z=e[9],U=e[10],Y=e[11],H=e[12],V=e[13],J=e[14],P=e[15],I=Qn();return Math.abs(r-x)<=I*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(i-T)<=I*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(s-S)<=I*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(n-C)<=I*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(o-A)<=I*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-O)<=I*Math.max(1,Math.abs(a),Math.abs(O))&&Math.abs(l-$)<=I*Math.max(1,Math.abs(l),Math.abs($))&&Math.abs(c-D)<=I*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(u-N)<=I*Math.max(1,Math.abs(u),Math.abs(N))&&Math.abs(d-z)<=I*Math.max(1,Math.abs(d),Math.abs(z))&&Math.abs(p-U)<=I*Math.max(1,Math.abs(p),Math.abs(U))&&Math.abs(g-Y)<=I*Math.max(1,Math.abs(g),Math.abs(Y))&&Math.abs(y-H)<=I*Math.max(1,Math.abs(y),Math.abs(H))&&Math.abs(_-V)<=I*Math.max(1,Math.abs(_),Math.abs(V))&&Math.abs(v-J)<=I*Math.max(1,Math.abs(v),Math.abs(J))&&Math.abs(w-P)<=I*Math.max(1,Math.abs(w),Math.abs(P))}function $7(t){const e=Qn(),r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+u*u))<=e}function iD(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const tAe=Pr,rAe=pae;Object.freeze(Object.defineProperty({__proto__:null,add:Q3e,adjoint:k3e,copy:Ss,determinant:B3e,equals:rD,exactEquals:M7,frob:J3e,fromQuat:W3e,fromQuat2:G3e,fromRotation:Mc,fromRotationTranslation:aae,fromRotationTranslationScale:cae,fromRotationTranslationScaleOrigin:q3e,fromScaling:z3e,fromTranslation:P3,fromXRotation:nae,fromYRotation:V3e,fromZRotation:oae,frustum:uae,getRotation:H3e,getScaling:lae,getTranslation:N$,hasIdentityRotation:iD,identity:Pu,invert:Ls,invertOrIdentity:T2,isOrthoNormal:$7,lookAt:tD,mul:tAe,multiply:Pr,multiplyScalar:K3e,multiplyScalarAndAdd:eAe,ortho:hae,perspective:Y3e,perspectiveFromFieldOfView:X3e,rotate:El,rotateX:Rx,rotateY:eD,rotateZ:Ox,scale:O3,set:Xp,str:Z3e,sub:rAe,subtract:pae,targetTo:dae,translate:Ya,transpose:$l},Symbol.toStringTag,{value:"Module"}));const iAe=(t,e)=>{const r=Xp(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return $l(r,r)},sAe=(t,e)=>{const r=Xp(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return $l(r,r)},nAe=(t,e)=>{const r=1-e,i=Xp(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return $l(i,i)},oAe=(t,e)=>{const r=Math.sin(e*Math.PI/180),i=Math.cos(e*Math.PI/180),s=Xp(t,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return $l(s,s)},aAe=(t,e)=>{const r=1-2*e,i=Xp(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return $l(i,i)},lAe=(t,e)=>{const r=Xp(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return $l(r,r)},cAe=(t,e)=>{const r=1-e,i=Xp(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return $l(i,i)};let fae=class mae{constructor(e,r,i){this.strength=e,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(e,r,i){this.strength=_l(e.strength,r.strength,i),this.radius=_l(e.radius,r.radius,i),this.threshold=_l(e.threshold,r.threshold,i)}clone(){return new mae(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:EE(this.radius),strength:this.strength,threshold:this.threshold}}},gae=class yae{constructor(e){this.radius=e,this.type="blur"}interpolate(e,r,i){this.radius=Math.round(_l(e.radius,r.radius,i))}clone(){return new yae(this.radius)}toJSON(){return{type:"blur",radius:EE(this.radius)}}},k8=class _ae{constructor(e,r){this.type=e,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.amount=_l(e.amount,r.amount,i),this._updateMatrix()}clone(){return new _ae(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||KL();switch(this.type){case"brightness":this._colorMatrix=iAe(e,this.amount);break;case"contrast":this._colorMatrix=sAe(e,this.amount);break;case"grayscale":this._colorMatrix=nAe(e,this.amount);break;case"invert":this._colorMatrix=aAe(e,this.amount);break;case"saturate":this._colorMatrix=lAe(e,this.amount);break;case"sepia":this._colorMatrix=cAe(e,this.amount)}}},vae=class bae{constructor(e,r,i,s){this.offsetX=e,this.offsetY=r,this.blurRadius=i,this.color=s,this.type="drop-shadow"}interpolate(e,r,i){this.offsetX=_l(e.offsetX,r.offsetX,i),this.offsetY=_l(e.offsetY,r.offsetY,i),this.blurRadius=_l(e.blurRadius,r.blurRadius,i),this.color[0]=Math.round(_l(e.color[0],r.color[0],i)),this.color[1]=Math.round(_l(e.color[1],r.color[1],i)),this.color[2]=Math.round(_l(e.color[2],r.color[2],i)),this.color[3]=_l(e.color[3],r.color[3],i)}clone(){return new bae(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:EE(this.offsetX),yoffset:EE(this.offsetY),blurRadius:EE(this.blurRadius),color:e}}},wae=class xae{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.angle=_l(e.angle,r.angle,i),this._updateMatrix()}clone(){return new xae(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||KL();this._colorMatrix=oAe(e,this.angle)}},Tae=class Sae{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,r,i){this.amount=_l(e.amount,r.amount,i)}clone(){return new Sae(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function _l(t,e,r){return t+(e-t)*r}function EE(t){return Math.round(1e3*Kh(t))/1e3}function uAe(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new k8(t.type,0);case"saturate":case"brightness":case"contrast":return new k8(t.type,1);case"opacity":return new Tae(1);case"hue-rotate":return new wae(0);case"blur":return new gae(0);case"drop-shadow":return new vae(0,0,0,[...w7("transparent")]);case"bloom":return new fae(0,0,1)}}function hAe(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every((i,s)=>i.type===r[s].type)}function dAe(t,e){const r=t.length>e.length?t:e,i=t.length>e.length?e:t;for(let s=i.length;s<r.length;s++)i.push(uAe(r[s]))}function cmt(t){const e=t[0];return!!e&&"type"in e}const hW=ne.getLogger("esri.support.basemapUtils");function pAe(){return{}}function fAe(t){for(const e in t){const r=t[e];Oe(r),delete t[e]}}function mAe(t,e){let r;if(typeof t=="string"){const i=t in $8,s=!i&&t.includes("/");if(!i&&!s){const n=Object.entries($8).filter(([o,a])=>kr.apiKey&&!a.classic||!kr.apiKey&&(a.classic||a.is3d)).map(([o])=>`"${o}"`).sort().join(", ");return hW.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${n}`),null}e&&(r=e[t]),r||(r=i?SE.fromId(t):new SE({style:{id:t}}),e&&(e[t]=r))}else r=ya(SE,t);return r!=null&&r.destroyed&&(hW.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function umt(t,e){var r,i,s,n;return((i=(r=t.basemap)==null?void 0:r.referenceLayers)==null?void 0:i.some(o=>o.uid===e))||((n=(s=t.basemap)==null?void 0:s.baseLayers)==null?void 0:n.some(o=>o.uid===e))}function gAe(t){return new RC({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const r=[];return"tables"in e&&r.push(e.tables),"layers"in e&&r.push(e.layers),r},itemFilterFunction:e=>{const r=e.parent;return!!r&&"tables"in r&&r.tables.includes(e)}})}function d4(t){for(const e of t.values())e==null||e.destroy();t.clear()}const dW={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function yAe(t){let e=null;if(typeof t=="string")if(t in dW){const r=dW[t];e=new D$({resourceInfo:{data:{layers:[r]}}})}else ne.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=ya(D$,t);return e}function Px(t,e,r=!1){let{hasM:i,hasZ:s}=t;Array.isArray(e)?e.length!==4||i||s?e.length===3&&r&&!i?(s=!0,i=!1):e.length===3&&i&&s&&(i=!1,s=!1):(i=!0,s=!0):(s=!s&&e.hasZ&&(!i||e.hasM),i=!i&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=i}var B8;function pW(t){return(e,r)=>e==null?r:r==null?e:t(e,r)}function _Ae(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Pg=B8=class extends uy{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){var s;if(!t&&!e)return{};const r={};Array.isArray(t)?(r.points=t,r.spatialReference=e):_Ae(t)?r.spatialReference=t:(t.points&&(r.points=t.points),t.spatialReference&&(r.spatialReference=t.spatialReference),t.hasZ&&(r.hasZ=t.hasZ),t.hasM&&(r.hasM=t.hasM));const i=(s=r.points)==null?void 0:s[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new Xr,r=this.hasZ,i=this.hasM,s=r?3:2,n=t[0],o=pW(Math.min),a=pW(Math.max);let l,c,u,d,[p,g]=n,[y,_]=n;for(let v=0,w=t.length;v<w;v++){const x=t[v],[T,S]=x;if(p=o(p,T),g=o(g,S),y=a(y,T),_=a(_,S),r&&x.length>2){const C=x[2];l=o(l,C),u=a(u,C)}if(i&&x.length>s){const C=x[s];c=o(c,C),d=a(d,C)}}return e.xmin=p,e.ymin=g,e.xmax=y,e.ymax=_,e.spatialReference=this.spatialReference,r?(e.zmin=l,e.zmax=u):(e.zmin=void 0,e.zmax=void 0),i?(e.mmin=c,e.mmax=d):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=ye(this.points)}addPoint(t){return Px(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:ye(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new B8(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],r={x:e[0],y:e[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=e[2],i=3),this.hasM&&(r.m=e[i]),new nt(r)}removePoint(t){if(!this._validateInputs(t))return null;const e=new nt(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(Px(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};h([f({readOnly:!0})],Pg.prototype,"cache",null),h([f()],Pg.prototype,"extent",null),h([f({type:[[Number]],json:{write:{isRequired:!0}}})],Pg.prototype,"points",void 0),h([ni("points")],Pg.prototype,"writePoints",null),Pg=B8=h([k("esri.geometry.Multipoint")],Pg),Pg.prototype.toJSON.isDefaultToJSON=!0;const S2=Pg;function hmt(t){const e=[];for(t.reset();t.nextPath();){const r=[];for(;t.nextPoint();)r.push([t.x,t.y]);e.push(r)}return t.reset(),e}function vAe(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}var ki;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(ki||(ki={}));function sD(t,e){const r=e[0]-t[0],i=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(r*r+i*i+s*s)}return Math.sqrt(r*r+i*i)}function Eae(t,e,r){const i=t[0]+r*(e[0]-t[0]),s=t[1]+r*(e[1]-t[1]);return t.length>2&&e.length>2?[i,s,t[2]+r*(e[2]-t[2])]:[i,s]}function dmt(t,e,r,i){const[s,n]=e,[o,a]=r,[l,c]=i,u=l-o,d=c-a,p=u*u+d*d,g=(s-o)*u+(n-a)*d,y=Math.min(1,Math.max(0,g/p));return t[0]=o+u*y,t[1]=a+d*y,t}function Cae(t,e){return Eae(t,e,.5)}function Aae(t){const e=t.length;let r=0;for(let i=0;i<e-1;++i)r+=sD(t[i],t[i+1]);return r}function Rae(t,e){if(e<=0)return t[0];const r=t.length;let i=0;for(let s=0;s<r-1;++s){const n=sD(t[s],t[s+1]);if(e-i<n){const o=(e-i)/n;return Eae(t[s],t[s+1],o)}i+=n}return t[r-1]}function RP(t,e=ki.X,r=ki.Y){let i=0;const s=t.length;let n=t[0];for(let o=0;o<s-1;o++){const a=t[o+1];i+=(a[e]-n[e])*(a[r]+n[r]),n=a}return i>=0}function bAe(t){const e=t.length;return e>2&&pm(t[0],t[e-1])}function pmt(t){if("rings"in t)for(const e of t.rings)bAe(e)||e.push(e[0].slice())}function fmt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function wAe(t){return t?Oae(t.rings,t.hasZ??!1):null}function Oae(t,e){if(!(t!=null&&t.length))return null;const r=[],i=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=Pae(t[n],e,s);a&&i.push(a)}if(i.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],e&&(r[2]=i[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||e&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){const n=t[0]&&t[0].length?xAe(t[0],e):null;if(!n)return null;r[0]=n[0],r[1]=n[1],e&&n.length>2&&(r[2]=n[2])}return r}function Pae(t,e,r){let i=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,u=t.length&&e?t[0][2]:0;for(let p=0;p<t.length;p++){const g=t[p],y=t[(p+1)%t.length],[_,v,w]=g,x=_-l,T=v-c,[S,C,A]=y,O=S-l,$=C-c,D=x*$-O*T;if(o+=D,i+=(x+O)*D,s+=(T+$)*D,e&&g.length>2&&y.length>2){const N=w-u,z=A-u,U=x*z-O*N;n+=(N+z)*U,a+=U}_<r[0]&&(r[0]=_),_>r[1]&&(r[1]=_),v<r[2]&&(r[2]=v),v>r[3]&&(r[3]=v),e&&(w<r[4]&&(r[4]=w),w>r[5]&&(r[5]=w))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const d=[i/(6*o)+l,s/(6*o)+c,o];return e&&(r[4]===r[5]||a===0?(d[3]=(r[4]+r[5])/2,d[4]=0):(d[3]=n/(6*a)+u,d[4]=a)),d}function mmt(t,e){let r=0,i=0,s=0;t.nextPoint();const n=t.pathSize?t.x:0,o=t.pathSize?t.y:0;for(let a=0;a<t.pathSize;a++){t.seekInPath(a);const l=[t.x,t.y];t.seekInPath((a+1)%t.pathSize);const c=[t.x,t.y],[u,d]=l,p=u-n,g=d-o,[y,_]=c,v=y-n,w=_-o,x=p*w-v*g;s+=x,r+=(p+v)*x,i+=(g+w)*x,u<e[0]&&(e[0]=u),u>e[1]&&(e[1]=u),d<e[2]&&(e[2]=d),d>e[3]&&(e[3]=d)}return s>0&&(s*=-1),s?(s*=.5,[r/(6*s)+n,i/(6*s)+o,s]):null}function xAe(t,e){const r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const u=t[l],d=t[l+1];if(u&&d){r[0]=u[0],r[1]=u[1],i[0]=d[0],i[1]=d[1],e&&u.length>2&&d.length>2&&(r[2]=u[2],i[2]=d[2]);const p=sD(r,i);if(p){s+=p;const g=Cae(u,d);n+=p*g[0],o+=p*g[1],e&&g.length>2&&(a+=p*g[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}function TAe(t){const{hasZ:e,totalSize:r}=t;if(r===0)return null;const i=[],s=[],n=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=Pae(vAe(t),t.hasZ,n);o&&s.push(o)}if(s.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),s.length&&(i[0]=s[0][0],i[1]=s[0][1],e&&(i[2]=s[0][3]),(i[0]<n[0]||i[0]>n[1]||i[1]<n[2]||i[1]>n[3]||e&&(i[2]<n[4]||i[2]>n[5]))&&(i.length=0)),!i.length){t.reset(),t.nextPath();const o=t.pathSize?SAe(t):null;if(!o)return null;i[0]=o[0],i[1]=o[1],e&&o.length>2&&(i[2]=o[2])}return i}function SAe(t){const{hasZ:e}=t,r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,u=t.z;for(;t.nextPoint();){const d=t.x,p=t.y,g=t.z;r[0]=l,r[1]=c,i[0]=d,i[1]=p,e&&(r[2]=u,i[2]=g);const y=sD(r,i);if(y){s+=y;const _=Cae(r,i);n+=y*_[0],o+=y*_[1],e&&_.length>2&&(a+=y*_[2])}l=d,c=p,u=g}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const EAe=1e-6;function gmt(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<EAe){const s=TAe(t);return s?[s[0],s[1]]:null}const r=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const i=[t.x,t.y];for(t.reset();t.nextPath();)AAe(r,i,t);return r[0]*=1/e,r[1]*=1/e,r[0]+=i[0],r[1]+=i[1],r}const CAe=1/3;function AAe(t,e,r){if(!t||!r||r.pathSize<3)return null;r.nextPoint();const i=r.x,s=r.y;r.nextPoint();let n,o=r.x-i,a=r.y-s,l=0,c=0;for(;r.nextPoint();)l=r.x-i,c=r.y-s,n=.5*CAe*(l*a-c*o),t[0]+=n*(o+l),t[1]+=n*(a+c),o=l,a=c;const u=r.getCurrentRingArea(),d=[i,s];return d[0]-=e[0],d[1]-=e[1],d[0]*=u,d[1]*=u,t[0]+=d[0],t[1]+=d[1],t}function Gt(t=MAe){return[t[0],t[1],t[2],t[3]]}function ymt(t){return[t[0],t[1],t[2],t[3]]}function ym(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function I7(t,e,r,i,s=Gt()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function Mae(t,e=Gt()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function nD(t,e){return new Xr({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function L7(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function M0(t,e,r){if(e!=null)if("length"in e)G8(e)?(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[0]),r[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":r[0]=Math.min(t[0],e.xmin),r[1]=Math.min(t[1],e.ymin),r[2]=Math.max(t[2],e.xmax),r[3]=Math.max(t[3],e.ymax);break;case"point":r[0]=Math.min(t[0],e.x),r[1]=Math.min(t[1],e.y),r[2]=Math.max(t[2],e.x),r[3]=Math.max(t[3],e.y)}else ym(r,t)}function p4(t,e,r=t){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<i;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=s,r[1]=n,r[2]=o,r[3]=a,r}function z8(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function Lo(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function ja(t){return t==null||t[1]>=t[3]?0:t[3]-t[1]}function _mt(t){return Lo(t)*ja(t)}function F$(t){return Lo(t)>0&&ja(t)>0}function D7(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function $ae(t,e){return oD(t,e[0],e[1])}function fW(t,e){const r=e[3],i=.5*(t[0]+t[2]),s=Math.abs(e[0]-i),n=.5*(t[2]-t[0]);if(s>r+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>r+a)return!1;if(s<n||l<a)return!0;const c=s-n,u=l-a;return c*c+u*u<=r*r}function vmt(t,e,r){const i=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:u}=r,d=(v,w)=>(u-l)*v+(a-c)*w+(c*l-a*u)<0,p=d(i,o),g=d(n,o),y=d(n,s),_=d(i,s);return!(p===g&&g===y&&y===_&&_===p||a<i&&c<i||a>n&&c>n||l>o&&u>o||l<s&&u<s)}function bmt(t,e){return oD(t,e.x,e.y)}function oD(t,e,r){return e>=t[0]&&r>=t[1]&&e<=t[2]&&r<=t[3]}function RAe(t,e,r){return e[0]>=t[0]-r&&e[1]>=t[1]-r&&e[0]<=t[2]+r&&e[1]<=t[3]+r}function aD(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function mW(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function V8(t,e,r){if(e==null)return ym(r,t);const i=e[0],s=e[1],n=e[2],o=e[3];return r[0]=me(t[0],i,n),r[1]=me(t[1],s,o),r[2]=me(t[2],i,n),r[3]=me(t[3],s,o),r}function OAe(t,e){const r=(t[0]+t[2])/2,i=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-r)-Lo(t)/2,0),n=Math.max(Math.abs(e[1]-i)-ja(t)/2,0);return Math.sqrt(s*s+n*n)}function U$(t,e,r,i=t){return i[0]=t[0]+e,i[1]=t[1]+r,i[2]=t[2]+e,i[3]=t[3]+r,i}function Mu(t){return t?ym(t,j8):Gt(j8)}function G8(t){return t!=null&&t.length===4}function PAe(t){return!(Lo(t)!==0&&isFinite(t[0])||ja(t)!==0&&isFinite(t[1]))}function E1(t,e){return G8(t)&&G8(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const wmt=[-1/0,-1/0,1/0,1/0],j8=[1/0,1/0,-1/0,-1/0],MAe=[0,0,0,0];function Iae(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Lae(t){return t.points!==void 0}function Dae(t){return t.x!==void 0&&t.y!==void 0}function Nae(t){return t.paths!==void 0}function Fae(t){return t.rings!==void 0}function Uae(t){function e(r,i){return r==null?i:i==null?r:t(r,i)}return e}const m0=Uae(Math.min),g0=Uae(Math.max);function xmt(t,e){return Nae(e)?Mx(t,e.paths,!1,!1):Fae(e)?Mx(t,e.rings,!1,!1):Lae(e)?N7(t,e.points,!1,!1,!1,!1):Iae(e)?kae(t,e):(Dae(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function Tmt(t){let e,r,i,s;for(t.reset(),e=i=1/0,r=s=-1/0;t.nextPath();){const n=$Ae(t);e=Math.min(n[0],e),i=Math.min(n[1],i),r=Math.max(n[2],r),s=Math.max(n[3],s)}return Gt([e,i,r,s])}function $Ae(t){let e,r,i,s;for(e=i=1/0,r=s=-1/0;t.nextPoint();)e=Math.min(t.x,e),i=Math.min(t.y,i),r=Math.max(t.x,r),s=Math.max(t.y,s);return Gt([e,i,r,s])}function Smt(t,e){return Nae(e)?Mx(t,e.paths,!0,!1):Fae(e)?Mx(t,e.rings,!0,!1):Lae(e)?N7(t,e.points,!0,!1,!0,!1):Iae(e)?kae(t,e,!0,!1,!0,!1):(Dae(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function Mx(t,e,r,i){const s=r?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,u]=e[0][0],[d,p]=e[0][0];for(let g=0;g<e.length;g++){const y=e[g];for(let _=0;_<y.length;_++){const v=y[_],[w,x]=v;if(c=m0(c,w),u=m0(u,x),d=g0(d,w),p=g0(p,x),r&&v.length>2){const T=v[2];n=m0(n,T),o=g0(o,T)}if(i&&v.length>s){const T=v[s];a=m0(n,T),l=g0(o,T)}}}return r?i?(t[0]=c,t[1]=u,t[2]=n,t[3]=a,t[4]=d,t[5]=p,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=u,t[2]=n,t[3]=d,t[4]=p,t[5]=o,t.length=6,t):i?(t[0]=c,t[1]=u,t[2]=a,t[3]=d,t[4]=p,t[5]=l,t.length=6,t):(t[0]=c,t[1]=u,t[2]=d,t[3]=p,t.length=4,t)}function kae(t,e,r,i,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let u=e.zmin,d=e.zmax,p=e.mmin,g=e.mmax;return s?(u=u||0,d=d||0,n?(p=p||0,g=g||0,t[0]=o,t[1]=l,t[2]=u,t[3]=p,t[4]=a,t[5]=c,t[6]=d,t[7]=g,t):(t[0]=o,t[1]=l,t[2]=u,t[3]=a,t[4]=c,t[5]=d,t)):n?(p=p||0,g=g||0,t[0]=o,t[1]=l,t[2]=p,t[3]=a,t[4]=c,t[5]=g,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function N7(t,e,r,i,s,n){const o=r?3:2,a=i&&n,l=r&&s;if(!e.length||!e[0].length)return null;let c,u,d,p,[g,y]=e[0],[_,v]=e[0];for(let w=0;w<e.length;w++){const x=e[w],[T,S]=x;if(g=m0(g,T),y=m0(y,S),_=g0(_,T),v=g0(v,S),l&&x.length>2){const C=x[2];c=m0(c,C),u=g0(u,C)}if(a&&x.length>o){const C=x[o];d=m0(c,C),p=g0(u,C)}}return s?(c=c||0,u=u||0,n?(d=d||0,p=p||0,t[0]=g,t[1]=y,t[2]=c,t[3]=d,t[4]=_,t[5]=v,t[6]=u,t[7]=p,t):(t[0]=g,t[1]=y,t[2]=c,t[3]=_,t[4]=v,t[5]=u,t)):n?(d=d||0,p=p||0,t[0]=g,t[1]=y,t[2]=d,t[3]=_,t[4]=v,t[5]=p,t):(t[0]=g,t[1]=y,t[2]=_,t[3]=v,t)}function IAe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function LAe(t){return t.points!==void 0}function DAe(t){return t.x!==void 0&&t.y!==void 0}function NAe(t){return t.paths!==void 0}function FAe(t){return t.rings!==void 0}const F7=[];function Bae(t,e,r,i){return{xmin:t,ymin:e,xmax:r,ymax:i}}function zae(t,e,r,i,s,n){return{xmin:t,ymin:e,zmin:r,xmax:i,ymax:s,zmax:n}}function Vae(t,e,r,i,s,n){return{xmin:t,ymin:e,mmin:r,xmax:i,ymax:s,mmax:n}}function Gae(t,e,r,i,s,n,o,a){return{xmin:t,ymin:e,zmin:r,mmin:i,xmax:s,ymax:n,zmax:o,mmax:a}}function U7(t,e=!1,r=!1){return e?r?Gae(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):zae(t[0],t[1],t[2],t[3],t[4],t[5]):r?Vae(t[0],t[1],t[2],t[3],t[4],t[5]):Bae(t[0],t[1],t[2],t[3])}function Emt(t){return t?IAe(t)?t:DAe(t)?kAe(t):FAe(t)?jae(t):NAe(t)?Hae(t):LAe(t)?UAe(t):null:null}function UAe(t){const{hasZ:e,hasM:r,points:i}=t;return U7(N7(F7,i,e??!1,r??!1),e,r)}function kAe(t){const{x:e,y:r,z:i,m:s}=t,n=s!=null;return i!=null?n?Gae(e,r,i,s,e,r,i,s):zae(e,r,i,e,r,i):n?Vae(e,r,s,e,r,s):Bae(e,r,e,r)}function jae(t){const{hasZ:e,hasM:r,rings:i}=t,s=Mx(F7,i,e??!1,r??!1);return s?U7(s,e,r):null}function Hae(t){const{hasZ:e,hasM:r,paths:i}=t,s=Mx(F7,i,e??!1,r??!1);return s?U7(s,e,r):null}var OP;function gW(t){return!Array.isArray(t[0])}let Bd=OP=class extends uy{static fromExtent(t){const e=t.clone().normalize(),r=t.spatialReference;let i=!1,s=!1;for(const o of e)o.hasZ&&(i=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(n.hasZ=!0),s&&(n.hasM=!0),new OP(n)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){var o,a;let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||at.WGS84,s.length&&((o=s[0])==null?void 0:o[0])!=null&&typeof s[0][0]=="number"&&(s=[s]),n=(a=s[0])==null?void 0:a[0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=n.length>3):r===void 0?r=i?n.length>3:n.length>2:i===void 0&&(i=r?n.length>3:n.length>2)),{rings:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=wAe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new nt;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=jae(this);if(!e)return null;const r=new Xr(e);return r.spatialReference=t,r}get isSelfIntersecting(){return QEe(this.rings)}writeRings(t,e){e.rings=ye(this.rings)}addRing(t){if(!t)return;const e=this.rings,r=e.length;if(gW(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new OP;return t.spatialReference=this.spatialReference,t.rings=ye(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;if(e!=null!=(r!=null)||e!=null&&r!=null&&!e.equals(r)||this.rings.length!==t.rings.length)return!1;const i=([s,n,o,a],[l,c,u,d])=>s===l&&n===c&&(o==null&&u==null||o===u)&&(a==null&&d==null||a===d);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!pm(n,o,i))return!1}return!0}contains(t){if(!t)return!1;const e=C3(t,this.spatialReference);return VEe(this,e??t)}isClockwise(t){let e;return e=gW(t)?t.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):t,RP(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.rings[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new nt(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new nt(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new nt(r[0],r[1],r[2],r[3],this.spatialReference):new nt(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(Px(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t].splice(e,0,r),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new nt(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new nt(s,r));return this.notifyChange("rings"),i}setPoint(t,e,r){return this._validateInputs(t,e)?(Px(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t][e]=r,this.notifyChange("rings"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const i=this.rings[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],Bd.prototype,"cache",null),h([f({readOnly:!0})],Bd.prototype,"centroid",null),h([f({readOnly:!0})],Bd.prototype,"extent",null),h([f({readOnly:!0})],Bd.prototype,"isSelfIntersecting",null),h([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],Bd.prototype,"rings",void 0),h([ni("rings")],Bd.prototype,"writeRings",null),Bd=OP=h([k("esri.geometry.Polygon")],Bd),Bd.prototype.toJSON.isDefaultToJSON=!0;const Np=Bd;var H8;function BAe(t){return!Array.isArray(t[0])}let Mg=H8=class extends uy{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){var o,a;let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||at.WGS84,s.length&&((o=s[0])==null?void 0:o[0])!=null&&typeof s[0][0]=="number"&&(s=[s]),n=(a=s[0])==null?void 0:a[0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=!1):r===void 0?r=!i&&n.length>3:i===void 0&&(i=!r&&n.length>3)),{paths:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=Hae(this);if(!e)return null;const r=new Xr(e);return r.spatialReference=t,r}writePaths(t,e){e.paths=ye(this.paths)}addPath(t){if(!t)return;const e=this.paths,r=e.length;if(BAe(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new H8;return t.spatialReference=this.spatialReference,t.paths=ye(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.paths[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new nt(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new nt(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new nt(r[0],r[1],r[2],r[3],this.spatialReference):new nt(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(Px(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t].splice(e,0,r),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new nt(s,r));return this.notifyChange("paths"),i}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new nt(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(t,e,r){return this._validateInputs(t,e)?(Px(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t][e]=r,this.notifyChange("paths"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const i=this.paths[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],Mg.prototype,"cache",null),h([f({readOnly:!0})],Mg.prototype,"extent",null),h([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],Mg.prototype,"paths",void 0),h([ni("paths")],Mg.prototype,"writePaths",null),Mg=H8=h([k("esri.geometry.Polyline")],Mg),Mg.prototype.toJSON.isDefaultToJSON=!0;const Uh=Mg,zAe=Ic()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Cmt=Ic()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function qae(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function k7(t){return t.points!==void 0}function B7(t){return t.x!==void 0&&t.y!==void 0}function z7(t){return t.paths!==void 0}function lD(t){return t.rings!==void 0}function $x(t){return t==null?null:t instanceof uy?t:B7(t)?nt.fromJSON(t):z7(t)?Uh.fromJSON(t):lD(t)?Np.fromJSON(t):k7(t)?S2.fromJSON(t):qae(t)?Xr.fromJSON(t):null}function M3(t){return t?B7(t)?"esriGeometryPoint":z7(t)?"esriGeometryPolyline":lD(t)?"esriGeometryPolygon":qae(t)?"esriGeometryEnvelope":k7(t)?"esriGeometryMultipoint":null:null}const VAe={esriGeometryPoint:nt,esriGeometryPolyline:Uh,esriGeometryPolygon:Np,esriGeometryEnvelope:Xr,esriGeometryMultipoint:S2};function GAe(t){return t&&VAe[t]||null}const V7={base:uy,key:"type",typeMap:{extent:Xr,multipoint:S2,point:nt,polyline:Uh,polygon:Np}};k0(V7);let Wae=0;const G7=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+Wae++})}};return e=h([k("esri.core.Identifiable")],e),e},Amt=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Wae++})}};return e=h([k("esri.core.NumericIdentifiable")],e),e};let yW=class extends G7(class{}){};yW=h([k("esri.core.Identifiable")],yW);async function jAe(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:r}=await he(()=>import("./portalLayers-7fd41ec7.js").then(i=>i.p),["./portalLayers-7fd41ec7.js","./associatedFeatureServiceUtils-2fac8951.js","./lazyLayerLoader-aea79d16.js","./portalItemUtils-bd3ade0c.js"],import.meta.url);try{return await r(e)}catch(i){const s=e&&e.portalItem,n=(s==null?void 0:s.id)||"unset",o=s&&s.portal&&s.portal.url||kr.portalUrl;throw ne.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",i),i}}let HAe=0,yn=class extends Ps.EventedMixin(G7(z0)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new Xr(-180,-90,180,90,at.WGS84),this.id=Date.now().toString(16)+"-layer-"+HAe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=at.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const r=typeof e=="string"?{url:e}:e;return(await he(()=>import("./arcgisLayers-9aa976ed.js"),["./arcgisLayers-9aa976ed.js","./associatedFeatureServiceUtils-2fac8951.js","./fetchService-6d00ac74.js","./lazyLayerLoader-aea79d16.js"],import.meta.url)).fromUrl(r)}static fromPortalItem(e){return jAe(e)}initialize(){this.when().catch(e=>{Os(e)||ne.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){const e=this.parent;if(e){const r=this;"layers"in e&&e.layers.includes(r)?e.layers.remove(r):"tables"in e&&e.tables.includes(r)?e.tables.remove(r):"baseLayers"in e&&e.baseLayers.includes(r)?e.baseLayers.remove(r):"referenceLayers"in e&&e.referenceLayers.includes(r)&&e.referenceLayers.remove(r),this._set("parent",null)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return Wn(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Hi(e,{query:{f:"json"},responseType:"json"})).data;throw new X("layer:no-attribution-data","Layer does not have attribution data")}};h([f({type:String})],yn.prototype,"attributionDataUrl",void 0),h([f({type:Xr})],yn.prototype,"fullExtent",void 0),h([f({readOnly:!0})],yn.prototype,"hasAttributionData",null),h([f({type:String,clonable:!1})],yn.prototype,"id",void 0),h([f({type:Boolean,nonNullable:!0})],yn.prototype,"legendEnabled",void 0),h([f({type:["show","hide","hide-children"]})],yn.prototype,"listMode",void 0),h([f({type:Number,range:{min:0,max:1},nonNullable:!0})],yn.prototype,"opacity",void 0),h([f({clonable:!1})],yn.prototype,"parent",void 0),h([f({readOnly:!0})],yn.prototype,"parsedUrl",null),h([f({type:Boolean,readOnly:!0})],yn.prototype,"persistenceEnabled",void 0),h([f({type:Boolean})],yn.prototype,"popupEnabled",void 0),h([f({type:Boolean})],yn.prototype,"attributionVisible",void 0),h([f({type:at})],yn.prototype,"spatialReference",void 0),h([f({type:String})],yn.prototype,"title",void 0),h([f({readOnly:!0,json:{read:!1}})],yn.prototype,"type",void 0),h([f()],yn.prototype,"url",void 0),h([f({type:Boolean,nonNullable:!0})],yn.prototype,"visible",void 0),yn=h([k("esri.layers.Layer")],yn);const qAe=yn;function q8(t,e,r){let i,s;if(t)for(let n=0,o=t.length;n<o;n++){if(i=t.at(n),(i==null?void 0:i[e])===r)return i;if((i==null?void 0:i.type)==="group"&&(s=q8(i.layers,e,r),s))return s}}const WAe=t=>{let e=class extends t{constructor(...r){super(...r),this.layers=new St;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||ne.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))])}destroy(){const r=this.layers.toArray();for(const i of r)i.destroy();this.layers.destroy()}set layers(r){this._set("layers",V1(r,this._get("layers")))}add(r,i){const s=this.layers;if(i=s.getNextIndex(i),r instanceof qAe){const n=r;n.parent===this?this.reorder(n,i):s.add(n,i)}else Fl(r)?r.then(n=>{this.destroyed||this.add(n,i)}):ne.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const s=this.layers;let n=s.getNextIndex(i);r.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(r){return q8(this.layers,"id",r)}findLayerByUid(r){return q8(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return h([f()],e.prototype,"layers",null),e=h([k("esri.support.LayersMixin")],e),e};function W8(t,e,r){if(t)for(let i=0,s=t.length;i<s;i++){const n=t.at(i);if(n[e]===r)return n;if((n==null?void 0:n.type)==="group"){const o=W8(n.tables,e,r);if(o)return o}}}const YAe=t=>{let e=class extends t{constructor(...r){super(...r),this.tables=new St,this.addHandles([this.tables.on("after-add",i=>{const s=i.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&ne.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})])}destroy(){const r=this.tables.toArray();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",V1(r,this._get("tables")))}findTableById(r){return W8(this.tables,"id",r)}findTableByUid(r){return W8(this.tables,"uid",r)}};return h([f()],e.prototype,"tables",null),e=h([k("esri.support.TablesMixin")],e),e};let zd=class extends YAe(WAe(Ps.EventedMixin(xe))){constructor(e){super(e),this.allLayers=new RC({getCollections:()=>{var r,i,s;return[(r=this.basemap)==null?void 0:r.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(s=this.basemap)==null?void 0:s.referenceLayers]},getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=gAe(this),this.basemap=null,this.editableLayers=new RC({getCollections:()=>[this.allLayers],itemFilterFunction:M3e}),this.ground=new D$,this._basemapCache=pAe()}destroy(){fAe(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=Oe(this.basemap),Oe(this.ground),this._set("ground",null)}castBasemap(e){return mAe(e,this._basemapCache)}castGround(e){return yAe(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(r=>r.id===e)}findTableById(e){return this.allTables.find(r=>r.id===e)}};h([f({readOnly:!0,dependsOn:[]})],zd.prototype,"allLayers",void 0),h([f({readOnly:!0})],zd.prototype,"allTables",void 0),h([f({type:SE,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],zd.prototype,"basemap",void 0),h([zi("basemap")],zd.prototype,"castBasemap",null),h([f({readOnly:!0})],zd.prototype,"editableLayers",void 0),h([f({type:D$,nonNullable:!0})],zd.prototype,"ground",void 0),h([zi("ground")],zd.prototype,"castGround",null),zd=h([k("esri.Map")],zd);const Yae=zd,Lc=t=>{let e=class extends t{clone(){var l;const r=U0(this);LL(r,"unable to clone instance of non-accessor class");const i=r.metadatas,s=r.store,n={},o=new Map;for(const c in i){const u=i[c],d=s==null?void 0:s.originOf(c),p=u.clonable;if(u.readOnly||p===!1||d!==Yr.USER&&d!==Yr.DEFAULTS&&d!==Yr.WEB_MAP&&d!==Yr.WEB_SCENE)continue;const g=this[c];let y=null;y=typeof p=="function"?p(g):p==="reference"?g:H6(g),g!=null&&y==null||(d===Yr.DEFAULTS?o.set(c,y):n[c]=y)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=U0(a))==null?void 0:l.store;if(c)for(const[u,d]of o)c.set(u,d,Yr.DEFAULTS)}return a}};return e=h([k("esri.core.Clonable")],e),e};let _W=class extends Lc(xe){};_W=h([k("esri.core.Clonable")],_W);let G0=class{constructor(e,r){this.min=e,this.max=r,this.range=r-e}ndiff(e,r=0){return Math.ceil((e-r)/this.range)*this.range+r}_normalize(e,r,i,s=0,n=!1){return(i-=s)<e?i+=this.ndiff(e-i):i>r&&(i-=this.ndiff(i-r)),n&&i===r&&(i=e),i+s}normalize(e,r=0,i=!1){return this._normalize(this.min,this.max,e,r,i)}clamp(e,r=0){return me(e-r,this.min,this.max)+r}monotonic(e,r,i){return e<r?r:r+this.ndiff(e-r,i)}minimalMonotonic(e,r,i){return this._normalize(e,e+this.range,r,i)}center(e,r,i){return r=this.monotonic(e,r,i),this.normalize((e+r)/2,i)}diff(e,r,i){return this.monotonic(e,r,i)-e}shortestSignedDiff(e,r){e=this.normalize(e);const i=(r=this.normalize(r))-e,s=r<e?this.minimalMonotonic(e,r)-e:r-this.minimalMonotonic(r,e);return Math.abs(i)<Math.abs(s)?i:s}contains(e,r,i){return r=this.minimalMonotonic(e,r),(i=this.minimalMonotonic(e,i))>e&&i<r}};function j7(t){for(const e in t){const r=t[e];r instanceof Function&&(t[e]=r.bind(t))}return t}const XAe=j7(new G0(0,2*Math.PI)),j0=j7(new G0(-Math.PI,Math.PI)),H7=j7(new G0(0,360));let Af=class extends Lc(st){constructor(...e){super(...e),this.position=new nt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,r,i,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return r!=null&&(n.heading=r),i!=null&&(n.tilt=i),s!=null&&(n.fov=s),n}return e}writePosition(e,r,i,s){const n=e.clone();n.x=Mh(e.x||0),n.y=Mh(e.y||0),n.z=e.hasZ?Mh(e.z||0):e.z,r[i]=n.write({},s)}readPosition(e,r){const i=new nt;return i.read(e,r),i.x=Mh(i.x||0),i.y=Mh(i.y||0),i.z=i.hasZ?Mh(i.z||0):i.z,i}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};h([f({type:nt,json:{write:{isRequired:!0}}})],Af.prototype,"position",void 0),h([ni("position")],Af.prototype,"writePosition",null),h([si("position")],Af.prototype,"readPosition",null),h([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),zi(t=>H7.normalize(Mh(t)))],Af.prototype,"heading",void 0),h([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),zi(t=>me(Mh(t),-180,180))],Af.prototype,"tilt",void 0),h([f({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Af.prototype,"fov",void 0),Af=h([k("esri.Camera")],Af);const Il=Af;async function Xae(t,e){const{WhereClause:r}=await he(()=>import("./WhereClause-94ad22d7.js").then(i=>i.W),["./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./UnknownTimeZone-ab7c6b01.js"],import.meta.url);return r.create(t,e)}function Lmt(t,e){return t!=null?e!=null?`(${t}) AND (${e})`:t:e}function Uv(t){return typeof t=="string"||t instanceof String}const vW=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class wv extends Error{}class ZAe extends wv{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class JAe extends wv{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class QAe extends wv{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class tS extends wv{}class Zae extends wv{constructor(e){super(`Invalid unit ${e}`)}}class hu extends wv{}class Jm extends wv{constructor(){super("Zone is an abstract class")}}const Ge="numeric",ed="short",Tc="long",k$={year:Ge,month:Ge,day:Ge},Jae={year:Ge,month:ed,day:Ge},KAe={year:Ge,month:ed,day:Ge,weekday:ed},Qae={year:Ge,month:Tc,day:Ge},Kae={year:Ge,month:Tc,day:Ge,weekday:Tc},ele={hour:Ge,minute:Ge},tle={hour:Ge,minute:Ge,second:Ge},rle={hour:Ge,minute:Ge,second:Ge,timeZoneName:ed},ile={hour:Ge,minute:Ge,second:Ge,timeZoneName:Tc},sle={hour:Ge,minute:Ge,hourCycle:"h23"},nle={hour:Ge,minute:Ge,second:Ge,hourCycle:"h23"},ole={hour:Ge,minute:Ge,second:Ge,hourCycle:"h23",timeZoneName:ed},ale={hour:Ge,minute:Ge,second:Ge,hourCycle:"h23",timeZoneName:Tc},lle={year:Ge,month:Ge,day:Ge,hour:Ge,minute:Ge},cle={year:Ge,month:Ge,day:Ge,hour:Ge,minute:Ge,second:Ge},ule={year:Ge,month:ed,day:Ge,hour:Ge,minute:Ge},hle={year:Ge,month:ed,day:Ge,hour:Ge,minute:Ge,second:Ge},eRe={year:Ge,month:ed,day:Ge,weekday:ed,hour:Ge,minute:Ge},dle={year:Ge,month:Tc,day:Ge,hour:Ge,minute:Ge,timeZoneName:ed},ple={year:Ge,month:Tc,day:Ge,hour:Ge,minute:Ge,second:Ge,timeZoneName:ed},fle={year:Ge,month:Tc,day:Ge,weekday:Tc,hour:Ge,minute:Ge,timeZoneName:Tc},mle={year:Ge,month:Tc,day:Ge,weekday:Tc,hour:Ge,minute:Ge,second:Ge,timeZoneName:Tc};class $3{get type(){throw new Jm}get name(){throw new Jm}get ianaName(){return this.name}get isUniversal(){throw new Jm}offsetName(e,r){throw new Jm}formatOffset(e,r){throw new Jm}offset(e){throw new Jm}equals(e){throw new Jm}get isValid(){throw new Jm}}let f4=null;class cD extends $3{static get instance(){return f4===null&&(f4=new cD),f4}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return yle(e,r,i)}formatOffset(e,r){return AE(this.offset(e),r)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let PP={};function tRe(t){return PP[t]||(PP[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),PP[t]}const rRe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function iRe(t,e){const r=t.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,s,n,o,a,l,c,u]=i;return[o,s,n,a,l,c,u]}function sRe(t,e){const r=t.formatToParts(e),i=[];for(let s=0;s<r.length;s++){const{type:n,value:o}=r[s],a=rRe[n];n==="era"?i[a]=o:Lr(a)||(i[a]=parseInt(o,10))}return i}let NA={};class td extends $3{static create(e){return NA[e]||(NA[e]=new td(e)),NA[e]}static resetCache(){NA={},PP={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=td.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return yle(e,r,i,this.name)}formatOffset(e,r){return AE(this.offset(e),r)}offset(e){const r=new Date(e);if(isNaN(r))return NaN;const i=tRe(this.name);let[s,n,o,a,l,c,u]=i.formatToParts?sRe(i,r):iRe(i,r);a==="BC"&&(s=-Math.abs(s)+1);const p=hD({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:u,millisecond:0});let g=+r;const y=g%1e3;return g-=y>=0?y:1e3+y,(p-g)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let bW={};function nRe(t,e={}){const r=JSON.stringify([t,e]);let i=bW[r];return i||(i=new Intl.ListFormat(t,e),bW[r]=i),i}let Y8={};function X8(t,e={}){const r=JSON.stringify([t,e]);let i=Y8[r];return i||(i=new Intl.DateTimeFormat(t,e),Y8[r]=i),i}let Z8={};function oRe(t,e={}){const r=JSON.stringify([t,e]);let i=Z8[r];return i||(i=new Intl.NumberFormat(t,e),Z8[r]=i),i}let J8={};function aRe(t,e={}){const{base:r,...i}=e,s=JSON.stringify([t,i]);let n=J8[s];return n||(n=new Intl.RelativeTimeFormat(t,e),J8[s]=n),n}let rS=null;function lRe(){return rS||(rS=new Intl.DateTimeFormat().resolvedOptions().locale,rS)}function cRe(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const r=t.indexOf("-u-");if(r===-1)return[t];{let i,s;try{i=X8(t).resolvedOptions(),s=t}catch{const l=t.substring(0,r);i=X8(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=i;return[s,n,o]}}function uRe(t,e,r){return(r||e)&&(t.includes("-u-")||(t+="-u"),r&&(t+=`-ca-${r}`),e&&(t+=`-nu-${e}`)),t}function hRe(t){const e=[];for(let r=1;r<=12;r++){const i=Xt.utc(2009,r,1);e.push(t(i))}return e}function dRe(t){const e=[];for(let r=1;r<=7;r++){const i=Xt.utc(2016,11,13+r);e.push(t(i))}return e}function FA(t,e,r,i){const s=t.listingMode();return s==="error"?null:s==="en"?r(e):i(e)}function pRe(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class fRe{constructor(e,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:s,floor:n,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=oRe(e,a)}}format(e){if(this.inf){const r=this.floor?Math.floor(e):e;return this.inf.format(r)}else{const r=this.floor?Math.floor(e):W7(e,3);return En(r,this.padTo)}}}class mRe{constructor(e,r,i){this.opts=i,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&td.create(a).valid?(s=a,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=X8(r,n)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(r=>{if(r.type==="timeZoneName"){const i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...r,value:i}}else return r}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class gRe{constructor(e,r,i){this.opts={style:"long",...i},!r&&gle()&&(this.rtf=aRe(e,i))}format(e,r){return this.rtf?this.rtf.format(e,r):IRe(r,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,r){return this.rtf?this.rtf.formatToParts(e,r):[]}}class vs{static fromOpts(e){return vs.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,r,i,s=!1){const n=e||Tn.defaultLocale,o=n||(s?"en-US":lRe()),a=r||Tn.defaultNumberingSystem,l=i||Tn.defaultOutputCalendar;return new vs(o,a,l,n)}static resetCache(){rS=null,Y8={},Z8={},J8={}}static fromObject({locale:e,numberingSystem:r,outputCalendar:i}={}){return vs.create(e,r,i)}constructor(e,r,i,s){const[n,o,a]=cRe(e);this.locale=n,this.numberingSystem=r||o||null,this.outputCalendar=i||a||null,this.intl=uRe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=pRe(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&r?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:vs.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,r=!1){return FA(this,e,ble,()=>{const i=r?{month:e,day:"numeric"}:{month:e},s=r?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=hRe(n=>this.extract(n,i,"month"))),this.monthsCache[s][e]})}weekdays(e,r=!1){return FA(this,e,Tle,()=>{const i=r?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=r?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=dRe(n=>this.extract(n,i,"weekday"))),this.weekdaysCache[s][e]})}meridiems(){return FA(this,void 0,()=>Sle,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Xt.utc(2016,11,13,9),Xt.utc(2016,11,13,19)].map(r=>this.extract(r,e,"dayperiod"))}return this.meridiemCache})}eras(e){return FA(this,e,Ele,()=>{const r={era:e};return this.eraCache[e]||(this.eraCache[e]=[Xt.utc(-40,1,1),Xt.utc(2017,1,1)].map(i=>this.extract(i,r,"era"))),this.eraCache[e]})}extract(e,r,i){const s=this.dtFormatter(e,r),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(e={}){return new fRe(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,r={}){return new mRe(e,this.intl,r)}relFormatter(e={}){return new gRe(this.intl,this.isEnglish(),e)}listFormatter(e={}){return nRe(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let m4=null;class ma extends $3{static get utcInstance(){return m4===null&&(m4=new ma(0)),m4}static instance(e){return e===0?ma.utcInstance:new ma(e)}static parseSpecifier(e){if(e){const r=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new ma(dD(r[1],r[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${AE(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${AE(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,r){return AE(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class yRe extends $3{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function a0(t,e){if(Lr(t)||t===null)return e;if(t instanceof $3)return t;if(_Re(t)){const r=t.toLowerCase();return r==="default"?e:r==="local"||r==="system"?cD.instance:r==="utc"||r==="gmt"?ma.utcInstance:ma.parseSpecifier(r)||td.create(t)}else return C1(t)?ma.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new yRe(t)}let wW=()=>Date.now(),xW="system",TW=null,SW=null,EW=null,CW=60,AW;class Tn{static get now(){return wW}static set now(e){wW=e}static set defaultZone(e){xW=e}static get defaultZone(){return a0(xW,cD.instance)}static get defaultLocale(){return TW}static set defaultLocale(e){TW=e}static get defaultNumberingSystem(){return SW}static set defaultNumberingSystem(e){SW=e}static get defaultOutputCalendar(){return EW}static set defaultOutputCalendar(e){EW=e}static get twoDigitCutoffYear(){return CW}static set twoDigitCutoffYear(e){CW=e%100}static get throwOnInvalid(){return AW}static set throwOnInvalid(e){AW=e}static resetCaches(){vs.resetCache(),td.resetCache()}}function Lr(t){return typeof t>"u"}function C1(t){return typeof t=="number"}function uD(t){return typeof t=="number"&&t%1===0}function _Re(t){return typeof t=="string"}function vRe(t){return Object.prototype.toString.call(t)==="[object Date]"}function gle(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function bRe(t){return Array.isArray(t)?t:[t]}function RW(t,e,r){if(t.length!==0)return t.reduce((i,s)=>{const n=[e(s),s];return i&&r(i[0],n[0])===i[0]?i:n},null)[1]}function wRe(t,e){return e.reduce((r,i)=>(r[i]=t[i],r),{})}function Ix(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Qf(t,e,r){return uD(t)&&t>=e&&t<=r}function xRe(t,e){return t-e*Math.floor(t/e)}function En(t,e=2){const r=t<0;let i;return r?i="-"+(""+-t).padStart(e,"0"):i=(""+t).padStart(e,"0"),i}function Kg(t){if(!(Lr(t)||t===null||t===""))return parseInt(t,10)}function Ry(t){if(!(Lr(t)||t===null||t===""))return parseFloat(t)}function q7(t){if(!(Lr(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function W7(t,e,r=!1){const i=10**e;return(r?Math.trunc:Math.round)(t*i)/i}function I3(t){return t%4===0&&(t%100!==0||t%400===0)}function CE(t){return I3(t)?366:365}function B$(t,e){const r=xRe(e-1,12)+1,i=t+(e-r)/12;return r===2?I3(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function hD(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function z$(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,r=t-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return e===4||i===3?53:52}function Q8(t){return t>99?t:t>Tn.twoDigitCutoffYear?1900+t:2e3+t}function yle(t,e,r,i=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(n.timeZone=i);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(r,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function dD(t,e){let r=parseInt(t,10);Number.isNaN(r)&&(r=0);const i=parseInt(e,10)||0,s=r<0||Object.is(r,-0)?-i:i;return r*60+s}function _le(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new hu(`Invalid unit value ${t}`);return e}function V$(t,e){const r={};for(const i in t)if(Ix(t,i)){const s=t[i];if(s==null)continue;r[e(i)]=_le(s)}return r}function AE(t,e){const r=Math.trunc(Math.abs(t/60)),i=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${En(r,2)}:${En(i,2)}`;case"narrow":return`${s}${r}${i>0?`:${i}`:""}`;case"techie":return`${s}${En(r,2)}${En(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function pD(t){return wRe(t,["hour","minute","second","millisecond"])}const TRe=["January","February","March","April","May","June","July","August","September","October","November","December"],vle=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],SRe=["J","F","M","A","M","J","J","A","S","O","N","D"];function ble(t){switch(t){case"narrow":return[...SRe];case"short":return[...vle];case"long":return[...TRe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const wle=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],xle=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],ERe=["M","T","W","T","F","S","S"];function Tle(t){switch(t){case"narrow":return[...ERe];case"short":return[...xle];case"long":return[...wle];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Sle=["AM","PM"],CRe=["Before Christ","Anno Domini"],ARe=["BC","AD"],RRe=["B","A"];function Ele(t){switch(t){case"narrow":return[...RRe];case"short":return[...ARe];case"long":return[...CRe];default:return null}}function ORe(t){return Sle[t.hour<12?0:1]}function PRe(t,e){return Tle(e)[t.weekday-1]}function MRe(t,e){return ble(e)[t.month-1]}function $Re(t,e){return Ele(e)[t.year<0?0:1]}function IRe(t,e,r="always",i=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(r==="auto"&&n){const d=t==="days";switch(e){case 1:return d?"tomorrow":`next ${s[t][0]}`;case-1:return d?"yesterday":`last ${s[t][0]}`;case 0:return d?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],u=i?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${u} ago`:`in ${a} ${u}`}function OW(t,e){let r="";for(const i of t)i.literal?r+=i.val:r+=e(i.val);return r}const LRe={D:k$,DD:Jae,DDD:Qae,DDDD:Kae,t:ele,tt:tle,ttt:rle,tttt:ile,T:sle,TT:nle,TTT:ole,TTTT:ale,f:lle,ff:ule,fff:dle,ffff:fle,F:cle,FF:hle,FFF:ple,FFFF:mle};class pa{static create(e,r={}){return new pa(e,r)}static parseFormat(e){let r=null,i="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),r=null,i="",s=!s):s||a===r?i+=a:(i.length>0&&n.push({literal:/^\s+$/.test(i),val:i}),i=a,r=a)}return i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),n}static macroTokenToFormatOpts(e){return LRe[e]}constructor(e,r){this.opts=r,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...r}).format()}dtFormatter(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r})}formatDateTime(e,r){return this.dtFormatter(e,r).format()}formatDateTimeParts(e,r){return this.dtFormatter(e,r).formatToParts()}formatInterval(e,r){return this.dtFormatter(e.start,r).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,r){return this.dtFormatter(e,r).resolvedOptions()}num(e,r=0){if(this.opts.forceSimple)return En(e,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,r){const i=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(g,y)=>this.loc.extract(e,g,y),o=g=>e.isOffsetFixed&&e.offset===0&&g.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,g.format):"",a=()=>i?ORe(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(g,y)=>i?MRe(e,g):n(y?{month:g}:{month:g,day:"numeric"},"month"),c=(g,y)=>i?PRe(e,g):n(y?{weekday:g}:{weekday:g,month:"long",day:"numeric"},"weekday"),u=g=>{const y=pa.macroTokenToFormatOpts(g);return y?this.formatWithSystemDefault(e,y):g},d=g=>i?$Re(e,g):n({era:g},"era"),p=g=>{switch(g){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return u(g)}};return OW(pa.parseFormat(r),p)}formatDurationFromString(e,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const u=i(c);return u?this.num(l.get(u),c.length):c},n=pa.parseFormat(r),o=n.reduce((l,{literal:c,val:u})=>c?l:l.concat(u),[]),a=e.shiftTo(...o.map(i).filter(l=>l));return OW(n,s(a))}}class kh{constructor(e,r){this.reason=e,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const Cle=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function E2(...t){const e=t.reduce((r,i)=>r+i.source,"");return RegExp(`^${e}$`)}function C2(...t){return e=>t.reduce(([r,i,s],n)=>{const[o,a,l]=n(e,s);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function A2(t,...e){if(t==null)return[null,null];for(const[r,i]of e){const s=r.exec(t);if(s)return i(s)}return[null,null]}function Ale(...t){return(e,r)=>{const i={};let s;for(s=0;s<t.length;s++)i[t[s]]=Kg(e[r+s]);return[i,null,r+s]}}const Rle=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,DRe=`(?:${Rle.source}?(?:\\[(${Cle.source})\\])?)?`,Y7=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Ole=RegExp(`${Y7.source}${DRe}`),X7=RegExp(`(?:T${Ole.source})?`),NRe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,FRe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,URe=/(\d{4})-?(\d{3})/,kRe=Ale("weekYear","weekNumber","weekDay"),BRe=Ale("year","ordinal"),zRe=/(\d{4})-(\d\d)-(\d\d)/,Ple=RegExp(`${Y7.source} ?(?:${Rle.source}|(${Cle.source}))?`),VRe=RegExp(`(?: ${Ple.source})?`);function rx(t,e,r){const i=t[e];return Lr(i)?r:Kg(i)}function GRe(t,e){return[{year:rx(t,e),month:rx(t,e+1,1),day:rx(t,e+2,1)},null,e+3]}function R2(t,e){return[{hours:rx(t,e,0),minutes:rx(t,e+1,0),seconds:rx(t,e+2,0),milliseconds:q7(t[e+3])},null,e+4]}function L3(t,e){const r=!t[e]&&!t[e+1],i=dD(t[e+1],t[e+2]),s=r?null:ma.instance(i);return[{},s,e+3]}function D3(t,e){const r=t[e]?td.create(t[e]):null;return[{},r,e+1]}const jRe=RegExp(`^T?${Y7.source}$`),HRe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function qRe(t){const[e,r,i,s,n,o,a,l,c]=t,u=e[0]==="-",d=l&&l[0]==="-",p=(g,y=!1)=>g!==void 0&&(y||g&&u)?-g:g;return[{years:p(Ry(r)),months:p(Ry(i)),weeks:p(Ry(s)),days:p(Ry(n)),hours:p(Ry(o)),minutes:p(Ry(a)),seconds:p(Ry(l),l==="-0"),milliseconds:p(q7(c),d)}]}const WRe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Z7(t,e,r,i,s,n,o){const a={year:e.length===2?Q8(Kg(e)):Kg(e),month:vle.indexOf(r)+1,day:Kg(i),hour:Kg(s),minute:Kg(n)};return o&&(a.second=Kg(o)),t&&(a.weekday=t.length>3?wle.indexOf(t)+1:xle.indexOf(t)+1),a}const YRe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function XRe(t){const[,e,r,i,s,n,o,a,l,c,u,d]=t,p=Z7(e,s,i,r,n,o,a);let g;return l?g=WRe[l]:c?g=0:g=dD(u,d),[p,new ma(g)]}function ZRe(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const JRe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,QRe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,KRe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function PW(t){const[,e,r,i,s,n,o,a]=t;return[Z7(e,s,i,r,n,o,a),ma.utcInstance]}function eOe(t){const[,e,r,i,s,n,o,a]=t;return[Z7(e,a,r,i,s,n,o),ma.utcInstance]}const tOe=E2(NRe,X7),rOe=E2(FRe,X7),iOe=E2(URe,X7),sOe=E2(Ole),Mle=C2(GRe,R2,L3,D3),nOe=C2(kRe,R2,L3,D3),oOe=C2(BRe,R2,L3,D3),aOe=C2(R2,L3,D3);function lOe(t){return A2(t,[tOe,Mle],[rOe,nOe],[iOe,oOe],[sOe,aOe])}function cOe(t){return A2(ZRe(t),[YRe,XRe])}function uOe(t){return A2(t,[JRe,PW],[QRe,PW],[KRe,eOe])}function hOe(t){return A2(t,[HRe,qRe])}const dOe=C2(R2);function pOe(t){return A2(t,[jRe,dOe])}const fOe=E2(zRe,VRe),mOe=E2(Ple),gOe=C2(R2,L3,D3);function yOe(t){return A2(t,[fOe,Mle],[mOe,gOe])}const MW="Invalid Duration",$le={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},_Oe={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...$le},Fc=146097/400,kv=146097/4800,vOe={years:{quarters:4,months:12,weeks:Fc/7,days:Fc,hours:Fc*24,minutes:Fc*24*60,seconds:Fc*24*60*60,milliseconds:Fc*24*60*60*1e3},quarters:{months:3,weeks:Fc/28,days:Fc/4,hours:Fc*24/4,minutes:Fc*24*60/4,seconds:Fc*24*60*60/4,milliseconds:Fc*24*60*60*1e3/4},months:{weeks:kv/7,days:kv,hours:kv*24,minutes:kv*24*60,seconds:kv*24*60*60,milliseconds:kv*24*60*60*1e3},...$le},p1=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],bOe=p1.slice(0).reverse();function Qm(t,e,r=!1){const i={values:r?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new ti(i)}function Ile(t,e){let r=e.milliseconds??0;for(const i of bOe.slice(1))e[i]&&(r+=e[i]*t[i].milliseconds);return r}function $W(t,e){const r=Ile(t,e)<0?-1:1;p1.reduceRight((i,s)=>{if(Lr(e[s]))return i;if(i){const n=e[i]*r,o=t[s][i],a=Math.floor(n/o);e[s]+=a*r,e[i]-=a*o*r}return s},null),p1.reduce((i,s)=>{if(Lr(e[s]))return i;if(i){const n=e[i]%1;e[i]-=n,e[s]+=n*t[i][s]}return s},null)}function wOe(t){const e={};for(const[r,i]of Object.entries(t))i!==0&&(e[r]=i);return e}class ti{constructor(e){const r=e.conversionAccuracy==="longterm"||!1;let i=r?vOe:_Oe;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||vs.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,r){return ti.fromObject({milliseconds:e},r)}static fromObject(e,r={}){if(e==null||typeof e!="object")throw new hu(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new ti({values:V$(e,ti.normalizeUnit),loc:vs.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(e){if(C1(e))return ti.fromMillis(e);if(ti.isDuration(e))return e;if(typeof e=="object")return ti.fromObject(e);throw new hu(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,r){const[i]=hOe(e);return i?ti.fromObject(i,r):ti.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,r){const[i]=pOe(e);return i?ti.fromObject(i,r):ti.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,r=null){if(!e)throw new hu("need to specify a reason the Duration is invalid");const i=e instanceof kh?e:new kh(e,r);if(Tn.throwOnInvalid)throw new QAe(i);return new ti({invalid:i})}static normalizeUnit(e){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!r)throw new Zae(e);return r}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?pa.create(this.loc,i).formatDurationFromString(this,e):MW}toHuman(e={}){if(!this.isValid)return MW;const r=p1.map(i=>{const s=this.values[i];return Lr(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(s)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=W7(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const r=this.toMillis();return r<0||r>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},Xt.fromMillis(r,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.isValid?Ile(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const r=ti.fromDurationLike(e),i={};for(const s of p1)(Ix(r.values,s)||Ix(this.values,s))&&(i[s]=r.get(s)+this.get(s));return Qm(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const r=ti.fromDurationLike(e);return this.plus(r.negate())}mapUnits(e){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=_le(e(this.values[i],i));return Qm(this,{values:r},!0)}get(e){return this[ti.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const r={...this.values,...V$(e,ti.normalizeUnit)};return Qm(this,{values:r})}reconfigure({locale:e,numberingSystem:r,conversionAccuracy:i,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:r}),matrix:s,conversionAccuracy:i};return Qm(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return $W(this.matrix,e),Qm(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=wOe(this.normalize().shiftToAll().toObject());return Qm(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>ti.normalizeUnit(o));const r={},i={},s=this.toObject();let n;for(const o of p1)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;C1(s[o])&&(a+=s[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3}else C1(s[o])&&(i[o]=s[o]);for(const o in i)i[o]!==0&&(r[n]+=o===n?i[o]:i[o]/this.matrix[n][o]);return $W(this.matrix,r),Qm(this,{values:r},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const r of Object.keys(this.values))e[r]=this.values[r]===0?0:-this.values[r];return Qm(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function r(i,s){return i===void 0||i===0?s===void 0||s===0:i===s}for(const i of p1)if(!r(this.values[i],e.values[i]))return!1;return!0}}const Bv="Invalid Interval";function xOe(t,e){return!t||!t.isValid?zs.invalid("missing or invalid start"):!e||!e.isValid?zs.invalid("missing or invalid end"):e<t?zs.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class zs{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,r=null){if(!e)throw new hu("need to specify a reason the Interval is invalid");const i=e instanceof kh?e:new kh(e,r);if(Tn.throwOnInvalid)throw new JAe(i);return new zs({invalid:i})}static fromDateTimes(e,r){const i=Z2(e),s=Z2(r),n=xOe(i,s);return n??new zs({start:i,end:s})}static after(e,r){const i=ti.fromDurationLike(r),s=Z2(e);return zs.fromDateTimes(s,s.plus(i))}static before(e,r){const i=ti.fromDurationLike(r),s=Z2(e);return zs.fromDateTimes(s.minus(i),s)}static fromISO(e,r){const[i,s]=(e||"").split("/",2);if(i&&s){let n,o;try{n=Xt.fromISO(i,r),o=n.isValid}catch{o=!1}let a,l;try{a=Xt.fromISO(s,r),l=a.isValid}catch{l=!1}if(o&&l)return zs.fromDateTimes(n,a);if(o){const c=ti.fromISO(s,r);if(c.isValid)return zs.after(n,c)}else if(l){const c=ti.fromISO(i,r);if(c.isValid)return zs.before(a,c)}}return zs.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(r,e).get(e))+(i.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:r}={}){return this.isValid?zs.fromDateTimes(e||this.s,r||this.e):this}splitAt(...e){if(!this.isValid)return[];const r=e.map(Z2).filter(o=>this.contains(o)).sort(),i=[];let{s}=this,n=0;for(;s<this.e;){const o=r[n]||this.e,a=+o>+this.e?this.e:o;i.push(zs.fromDateTimes(s,a)),s=a,n+=1}return i}splitBy(e){const r=ti.fromDurationLike(e);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,s=1,n;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(zs.fromDateTimes(i,n)),i=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const r=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return r>=i?null:zs.fromDateTimes(r,i)}union(e){if(!this.isValid)return this;const r=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return zs.fromDateTimes(r,i)}static merge(e){const[r,i]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return i&&r.push(i),r}static xor(e){let r=null,i=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&s.push(zs.fromDateTimes(r,l.time)),r=null);return zs.merge(s)}difference(...e){return zs.xor([this].concat(e)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} â€“ ${this.e.toISO()})`:Bv}toLocaleString(e=k$,r={}){return this.isValid?pa.create(this.s.loc.clone(r),e).formatInterval(this):Bv}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Bv}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Bv}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Bv}toFormat(e,{separator:r=" â€“ "}={}){return this.isValid?`${this.s.toFormat(e)}${r}${this.e.toFormat(e)}`:Bv}toDuration(e,r){return this.isValid?this.e.diff(this.s,e,r):ti.invalid(this.invalidReason)}mapEndpoints(e){return zs.fromDateTimes(e(this.s),e(this.e))}}class UA{static hasDST(e=Tn.defaultZone){const r=Xt.now().setZone(e).set({month:12});return!e.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(e){return td.isValidZone(e)}static normalizeZone(e){return a0(e,Tn.defaultZone)}static months(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||vs.create(r,i,n)).months(e)}static monthsFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||vs.create(r,i,n)).months(e,!0)}static weekdays(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||vs.create(r,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||vs.create(r,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return vs.create(e).meridiems()}static eras(e="short",{locale:r=null}={}){return vs.create(r,null,"gregory").eras(e)}static features(){return{relative:gle()}}}function IW(t,e){const r=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(e)-r(t);return Math.floor(ti.fromMillis(i).as("days"))}function TOe(t,e,r){const i=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const u=IW(l,c);return(u-u%7)/7}],["days",IW]],s={},n=t;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s),t>e&&(a=t,s[l]--,t=n.plus(s))):t=a);return[t,s,a,o]}function SOe(t,e,r,i){let[s,n,o,a]=TOe(t,e,r);const l=e-s,c=r.filter(d=>["hours","minutes","seconds","milliseconds"].indexOf(d)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const u=ti.fromObject(n,i);return c.length>0?ti.fromMillis(l,i).shiftTo(...c).plus(u):u}const J7={arab:"[Ù -Ù©]",arabext:"[Û°-Û¹]",bali:"[á­-á­™]",beng:"[à§¦-à§¯]",deva:"[à¥¦-à¥¯]",fullwide:"[ï¼-ï¼™]",gujr:"[à«¦-à«¯]",hanidec:"[ã€‡|ä¸€|äºŒ|ä¸‰|å››|äº”|å…­|ä¸ƒ|å…«|ä¹]",khmr:"[áŸ -áŸ©]",knda:"[à³¦-à³¯]",laoo:"[à»-à»™]",limb:"[á¥†-á¥]",mlym:"[àµ¦-àµ¯]",mong:"[á -á ™]",mymr:"[á€-á‰]",orya:"[à­¦-à­¯]",tamldec:"[à¯¦-à¯¯]",telu:"[à±¦-à±¯]",thai:"[à¹-à¹™]",tibt:"[à¼ -à¼©]",latn:"\\d"},LW={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},EOe=J7.hanidec.replace(/[\[|\]]/g,"").split("");function COe(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);if(t[r].search(J7.hanidec)!==-1)e+=EOe.indexOf(t[r]);else for(const s in LW){const[n,o]=LW[s];i>=n&&i<=o&&(e+=i-n)}}return parseInt(e,10)}else return e}function Wu({numberingSystem:t},e=""){return new RegExp(`${J7[t||"latn"]}${e}`)}const AOe="missing Intl.DateTimeFormat.formatToParts support";function mi(t,e=r=>r){return{regex:t,deser:([r])=>e(COe(r))}}const ROe=String.fromCharCode(160),Lle=`[ ${ROe}]`,Dle=new RegExp(Lle,"g");function OOe(t){return t.replace(/\./g,"\\.?").replace(Dle,Lle)}function DW(t){return t.replace(/\./g,"").replace(Dle," ").toLowerCase()}function Yu(t,e){return t===null?null:{regex:RegExp(t.map(OOe).join("|")),deser:([r])=>t.findIndex(i=>DW(r)===DW(i))+e}}function NW(t,e){return{regex:t,deser:([,r,i])=>dD(r,i),groups:e}}function kA(t){return{regex:t,deser:([e])=>e}}function POe(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function MOe(t,e){const r=Wu(e),i=Wu(e,"{2}"),s=Wu(e,"{3}"),n=Wu(e,"{4}"),o=Wu(e,"{6}"),a=Wu(e,"{1,2}"),l=Wu(e,"{1,3}"),c=Wu(e,"{1,6}"),u=Wu(e,"{1,9}"),d=Wu(e,"{2,4}"),p=Wu(e,"{4,6}"),g=v=>({regex:RegExp(POe(v.val)),deser:([w])=>w,literal:!0}),_=(v=>{if(t.literal)return g(v);switch(v.val){case"G":return Yu(e.eras("short"),0);case"GG":return Yu(e.eras("long"),0);case"y":return mi(c);case"yy":return mi(d,Q8);case"yyyy":return mi(n);case"yyyyy":return mi(p);case"yyyyyy":return mi(o);case"M":return mi(a);case"MM":return mi(i);case"MMM":return Yu(e.months("short",!0),1);case"MMMM":return Yu(e.months("long",!0),1);case"L":return mi(a);case"LL":return mi(i);case"LLL":return Yu(e.months("short",!1),1);case"LLLL":return Yu(e.months("long",!1),1);case"d":return mi(a);case"dd":return mi(i);case"o":return mi(l);case"ooo":return mi(s);case"HH":return mi(i);case"H":return mi(a);case"hh":return mi(i);case"h":return mi(a);case"mm":return mi(i);case"m":return mi(a);case"q":return mi(a);case"qq":return mi(i);case"s":return mi(a);case"ss":return mi(i);case"S":return mi(l);case"SSS":return mi(s);case"u":return kA(u);case"uu":return kA(a);case"uuu":return mi(r);case"a":return Yu(e.meridiems(),0);case"kkkk":return mi(n);case"kk":return mi(d,Q8);case"W":return mi(a);case"WW":return mi(i);case"E":case"c":return mi(r);case"EEE":return Yu(e.weekdays("short",!1),1);case"EEEE":return Yu(e.weekdays("long",!1),1);case"ccc":return Yu(e.weekdays("short",!0),1);case"cccc":return Yu(e.weekdays("long",!0),1);case"Z":case"ZZ":return NW(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return NW(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return kA(/[a-z_+-/]{1,256}?/i);case" ":return kA(/[^\S\n\r]/);default:return g(v)}})(t)||{invalidReason:AOe};return _.token=t,_}const $Oe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function IOe(t,e,r){const{type:i,value:s}=t;if(i==="literal"){const l=/^\s+$/.test(s);return{literal:!l,val:l?" ":s}}const n=e[i];let o=i;i==="hour"&&(e.hour12!=null?o=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?o="hour12":o="hour24":o=r.hour12?"hour12":"hour24");let a=$Oe[o];if(typeof a=="object"&&(a=a[n]),a)return{literal:!1,val:a}}function LOe(t){return[`^${t.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,t]}function DOe(t,e,r){const i=t.match(e);if(i){const s={};let n=1;for(const o in r)if(Ix(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(i.slice(n,n+l))),n+=l}return[i,s]}else return[i,{}]}function NOe(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return Lr(t.z)||(r=td.create(t.z)),Lr(t.Z)||(r||(r=new ma(t.Z)),i=t.Z),Lr(t.q)||(t.M=(t.q-1)*3+1),Lr(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),Lr(t.u)||(t.S=q7(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),r,i]}let g4=null;function FOe(){return g4||(g4=Xt.fromMillis(1555555555555)),g4}function UOe(t,e){if(t.literal)return t;const r=pa.macroTokenToFormatOpts(t.val),i=Ule(r,e);return i==null||i.includes(void 0)?t:i}function Nle(t,e){return Array.prototype.concat(...t.map(r=>UOe(r,e)))}function Fle(t,e,r){const i=Nle(pa.parseFormat(r),t),s=i.map(o=>MOe(o,t)),n=s.find(o=>o.invalidReason);if(n)return{input:e,tokens:i,invalidReason:n.invalidReason};{const[o,a]=LOe(s),l=RegExp(o,"i"),[c,u]=DOe(e,l,a),[d,p,g]=u?NOe(u):[null,null,void 0];if(Ix(u,"a")&&Ix(u,"H"))throw new tS("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:l,rawMatches:c,matches:u,result:d,zone:p,specificOffset:g}}}function kOe(t,e,r){const{result:i,zone:s,specificOffset:n,invalidReason:o}=Fle(t,e,r);return[i,s,n,o]}function Ule(t,e){if(!t)return null;const i=pa.create(e,t).dtFormatter(FOe()),s=i.formatToParts(),n=i.resolvedOptions();return s.map(o=>IOe(o,t,n))}const kle=[0,31,59,90,120,151,181,212,243,273,304,334],Ble=[0,31,60,91,121,152,182,213,244,274,305,335];function bu(t,e){return new kh("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function zle(t,e,r){const i=new Date(Date.UTC(t,e-1,r));t<100&&t>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const s=i.getUTCDay();return s===0?7:s}function Vle(t,e,r){return r+(I3(t)?Ble:kle)[e-1]}function Gle(t,e){const r=I3(t)?Ble:kle,i=r.findIndex(n=>n<e),s=e-r[i];return{month:i+1,day:s}}function K8(t){const{year:e,month:r,day:i}=t,s=Vle(e,r,i),n=zle(e,r,i);let o=Math.floor((s-n+10)/7),a;return o<1?(a=e-1,o=z$(a)):o>z$(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:n,...pD(t)}}function FW(t){const{weekYear:e,weekNumber:r,weekday:i}=t,s=zle(e,1,4),n=CE(e);let o=r*7+i-s-3,a;o<1?(a=e-1,o+=CE(a)):o>n?(a=e+1,o-=CE(e)):a=e;const{month:l,day:c}=Gle(a,o);return{year:a,month:l,day:c,...pD(t)}}function y4(t){const{year:e,month:r,day:i}=t,s=Vle(e,r,i);return{year:e,ordinal:s,...pD(t)}}function UW(t){const{year:e,ordinal:r}=t,{month:i,day:s}=Gle(e,r);return{year:e,month:i,day:s,...pD(t)}}function BOe(t){const e=uD(t.weekYear),r=Qf(t.weekNumber,1,z$(t.weekYear)),i=Qf(t.weekday,1,7);return e?r?i?!1:bu("weekday",t.weekday):bu("week",t.week):bu("weekYear",t.weekYear)}function zOe(t){const e=uD(t.year),r=Qf(t.ordinal,1,CE(t.year));return e?r?!1:bu("ordinal",t.ordinal):bu("year",t.year)}function jle(t){const e=uD(t.year),r=Qf(t.month,1,12),i=Qf(t.day,1,B$(t.year,t.month));return e?r?i?!1:bu("day",t.day):bu("month",t.month):bu("year",t.year)}function Hle(t){const{hour:e,minute:r,second:i,millisecond:s}=t,n=Qf(e,0,23)||e===24&&r===0&&i===0&&s===0,o=Qf(r,0,59),a=Qf(i,0,59),l=Qf(s,0,999);return n?o?a?l?!1:bu("millisecond",s):bu("second",i):bu("minute",r):bu("hour",e)}const _4="Invalid DateTime",kW=864e13;function BA(t){return new kh("unsupported zone",`the zone "${t.name}" is not supported`)}function v4(t){return t.weekData===null&&(t.weekData=K8(t.c)),t.weekData}function Oy(t,e){const r={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new Xt({...r,...e,old:r})}function qle(t,e,r){let i=t-e*60*1e3;const s=r.offset(i);if(e===s)return[i,e];i-=(s-e)*60*1e3;const n=r.offset(i);return s===n?[i,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function zA(t,e){t+=e*60*1e3;const r=new Date(t);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function MP(t,e,r){return qle(hD(t),e,r)}function BW(t,e){const r=t.o,i=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:i,month:s,day:Math.min(t.c.day,B$(i,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=ti.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=hD(n);let[l,c]=qle(a,r,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function X2(t,e,r,i,s,n){const{setZone:o,zone:a}=r;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=Xt.fromObject(t,{...r,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return Xt.invalid(new kh("unparsable",`the input "${s}" can't be parsed as ${i}`))}function VA(t,e,r=!0){return t.isValid?pa.create(vs.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(t,e):null}function b4(t,e){const r=t.c.year>9999||t.c.year<0;let i="";return r&&t.c.year>=0&&(i+="+"),i+=En(t.c.year,r?6:4),e?(i+="-",i+=En(t.c.month),i+="-",i+=En(t.c.day)):(i+=En(t.c.month),i+=En(t.c.day)),i}function zW(t,e,r,i,s,n){let o=En(t.c.hour);return e?(o+=":",o+=En(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!r)&&(o+=":")):o+=En(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!r)&&(o+=En(t.c.second),(t.c.millisecond!==0||!i)&&(o+=".",o+=En(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=En(Math.trunc(-t.o/60)),o+=":",o+=En(Math.trunc(-t.o%60))):(o+="+",o+=En(Math.trunc(t.o/60)),o+=":",o+=En(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const Wle={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},VOe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},GOe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Yle=["year","month","day","hour","minute","second","millisecond"],jOe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],HOe=["year","ordinal","hour","minute","second","millisecond"];function VW(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new Zae(t);return e}function GW(t,e){const r=a0(e.zone,Tn.defaultZone),i=vs.fromObject(e),s=Tn.now();let n,o;if(Lr(t.year))n=s;else{for(const c of Yle)Lr(t[c])&&(t[c]=Wle[c]);const a=jle(t)||Hle(t);if(a)return Xt.invalid(a);const l=r.offset(s);[n,o]=MP(t,l,r)}return new Xt({ts:n,zone:r,loc:i,o})}function jW(t,e,r){const i=Lr(r.round)?!0:r.round,s=(o,a)=>(o=W7(o,i||r.calendary?0:2,!0),e.loc.clone(r).relFormatter(r).format(o,a)),n=o=>r.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(r.unit)return s(n(r.unit),r.unit);for(const o of r.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,r.units[r.units.length-1])}function HW(t){let e={},r;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],r=Array.from(t).slice(0,t.length-1)):r=Array.from(t),[e,r]}class Xt{constructor(e){const r=e.zone||Tn.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new kh("invalid input"):null)||(r.isValid?null:BA(r));this.ts=Lr(e.ts)?Tn.now():e.ts;let s=null,n=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(r))[s,n]=[e.old.c,e.old.o];else{const a=r.offset(this.ts);s=zA(this.ts,a),i=Number.isNaN(s.year)?new kh("invalid input"):null,s=i?null:s,n=i?null:a}this._zone=r,this.loc=e.loc||vs.create(),this.invalid=i,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new Xt({})}static local(){const[e,r]=HW(arguments),[i,s,n,o,a,l,c]=r;return GW({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,r]=HW(arguments),[i,s,n,o,a,l,c]=r;return e.zone=ma.utcInstance,GW({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,r={}){const i=vRe(e)?e.valueOf():NaN;if(Number.isNaN(i))return Xt.invalid("invalid input");const s=a0(r.zone,Tn.defaultZone);return s.isValid?new Xt({ts:i,zone:s,loc:vs.fromObject(r)}):Xt.invalid(BA(s))}static fromMillis(e,r={}){if(C1(e))return e<-kW||e>kW?Xt.invalid("Timestamp out of range"):new Xt({ts:e,zone:a0(r.zone,Tn.defaultZone),loc:vs.fromObject(r)});throw new hu(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,r={}){if(C1(e))return new Xt({ts:e*1e3,zone:a0(r.zone,Tn.defaultZone),loc:vs.fromObject(r)});throw new hu("fromSeconds requires a numerical input")}static fromObject(e,r={}){e=e||{};const i=a0(r.zone,Tn.defaultZone);if(!i.isValid)return Xt.invalid(BA(i));const s=Tn.now(),n=Lr(r.specificOffset)?i.offset(s):r.specificOffset,o=V$(e,VW),a=!Lr(o.ordinal),l=!Lr(o.year),c=!Lr(o.month)||!Lr(o.day),u=l||c,d=o.weekYear||o.weekNumber,p=vs.fromObject(r);if((u||a)&&d)throw new tS("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new tS("Can't mix ordinal dates with month/day");const g=d||o.weekday&&!u;let y,_,v=zA(s,n);g?(y=jOe,_=VOe,v=K8(v)):a?(y=HOe,_=GOe,v=y4(v)):(y=Yle,_=Wle);let w=!1;for(const $ of y){const D=o[$];Lr(D)?w?o[$]=_[$]:o[$]=v[$]:w=!0}const x=g?BOe(o):a?zOe(o):jle(o),T=x||Hle(o);if(T)return Xt.invalid(T);const S=g?FW(o):a?UW(o):o,[C,A]=MP(S,n,i),O=new Xt({ts:C,zone:i,o:A,loc:p});return o.weekday&&u&&e.weekday!==O.weekday?Xt.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${O.toISO()}`):O}static fromISO(e,r={}){const[i,s]=lOe(e);return X2(i,s,r,"ISO 8601",e)}static fromRFC2822(e,r={}){const[i,s]=cOe(e);return X2(i,s,r,"RFC 2822",e)}static fromHTTP(e,r={}){const[i,s]=uOe(e);return X2(i,s,r,"HTTP",r)}static fromFormat(e,r,i={}){if(Lr(e)||Lr(r))throw new hu("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=i,o=vs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,u]=kOe(o,e,r);return u?Xt.invalid(u):X2(a,l,i,`format ${r}`,e,c)}static fromString(e,r,i={}){return Xt.fromFormat(e,r,i)}static fromSQL(e,r={}){const[i,s]=yOe(e);return X2(i,s,r,"SQL",e)}static invalid(e,r=null){if(!e)throw new hu("need to specify a reason the DateTime is invalid");const i=e instanceof kh?e:new kh(e,r);if(Tn.throwOnInvalid)throw new ZAe(i);return new Xt({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,r={}){const i=Ule(e,vs.fromObject(r));return i?i.map(s=>s?s.val:null).join(""):null}static expandFormat(e,r={}){return Nle(pa.parseFormat(e),vs.fromObject(r)).map(s=>s.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?v4(this).weekYear:NaN}get weekNumber(){return this.isValid?v4(this).weekNumber:NaN}get weekday(){return this.isValid?v4(this).weekday:NaN}get ordinal(){return this.isValid?y4(this.c).ordinal:NaN}get monthShort(){return this.isValid?UA.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?UA.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?UA.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?UA.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,r=6e4,i=hD(this.c),s=this.zone.offset(i-e),n=this.zone.offset(i+e),o=this.zone.offset(i-s*r),a=this.zone.offset(i-n*r);if(o===a)return[this];const l=i-o*r,c=i-a*r,u=zA(l,o),d=zA(c,a);return u.hour===d.hour&&u.minute===d.minute&&u.second===d.second&&u.millisecond===d.millisecond?[Oy(this,{ts:l}),Oy(this,{ts:c})]:[this]}get isInLeapYear(){return I3(this.year)}get daysInMonth(){return B$(this.year,this.month)}get daysInYear(){return this.isValid?CE(this.year):NaN}get weeksInWeekYear(){return this.isValid?z$(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:r,numberingSystem:i,calendar:s}=pa.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:s}}toUTC(e=0,r={}){return this.setZone(ma.instance(e),r)}toLocal(){return this.setZone(Tn.defaultZone)}setZone(e,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(e=a0(e,Tn.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(r||i){const n=e.offset(this.ts),o=this.toObject();[s]=MP(o,n,e)}return Oy(this,{ts:s,zone:e})}else return Xt.invalid(BA(e))}reconfigure({locale:e,numberingSystem:r,outputCalendar:i}={}){const s=this.loc.clone({locale:e,numberingSystem:r,outputCalendar:i});return Oy(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const r=V$(e,VW),i=!Lr(r.weekYear)||!Lr(r.weekNumber)||!Lr(r.weekday),s=!Lr(r.ordinal),n=!Lr(r.year),o=!Lr(r.month)||!Lr(r.day),a=n||o,l=r.weekYear||r.weekNumber;if((a||s)&&l)throw new tS("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new tS("Can't mix ordinal dates with month/day");let c;i?c=FW({...K8(this.c),...r}):Lr(r.ordinal)?(c={...this.toObject(),...r},Lr(r.day)&&(c.day=Math.min(B$(c.year,c.month),c.day))):c=UW({...y4(this.c),...r});const[u,d]=MP(c,this.o,this.zone);return Oy(this,{ts:u,o:d})}plus(e){if(!this.isValid)return this;const r=ti.fromDurationLike(e);return Oy(this,BW(this,r))}minus(e){if(!this.isValid)return this;const r=ti.fromDurationLike(e).negate();return Oy(this,BW(this,r))}startOf(e){if(!this.isValid)return this;const r={},i=ti.normalizeUnit(e);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const s=Math.ceil(this.month/3);r.month=(s-1)*3+1}return this.set(r)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,r={}){return this.isValid?pa.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,e):_4}toLocaleString(e=k$,r={}){return this.isValid?pa.create(this.loc.clone(r),e).formatDateTime(this):_4}toLocaleParts(e={}){return this.isValid?pa.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=b4(this,o);return a+="T",a+=zW(this,o,r,i,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?b4(this,e==="extended"):null}toISOWeekDate(){return VA(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+zW(this,o==="extended",r,e,i,n):null}toRFC2822(){return VA(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return VA(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?b4(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let s="HH:mm:ss.SSS";return(r||e)&&(i&&(s+=" "),r?s+="z":e&&(s+="ZZ")),VA(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():_4}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const r={...this.c};return e.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,r="milliseconds",i={}){if(!this.isValid||!e.isValid)return ti.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...i},n=bRe(r).map(ti.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=SOe(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",r={}){return this.diff(Xt.now(),e,r)}until(e){return this.isValid?zs.fromDateTimes(this,e):this}hasSame(e,r){if(!this.isValid)return!1;const i=e.valueOf(),s=this.setZone(e.zone,{keepLocalTime:!0});return s.startOf(r)<=i&&i<=s.endOf(r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const r=e.base||Xt.fromObject({},{zone:this.zone}),i=e.padding?this<r?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),jW(r,this.plus(i),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?jW(e.base||Xt.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(Xt.isDateTime))throw new hu("min requires all arguments be DateTimes");return RW(e,r=>r.valueOf(),Math.min)}static max(...e){if(!e.every(Xt.isDateTime))throw new hu("max requires all arguments be DateTimes");return RW(e,r=>r.valueOf(),Math.max)}static fromFormatExplain(e,r,i={}){const{locale:s=null,numberingSystem:n=null}=i,o=vs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return Fle(o,e,r)}static fromStringExplain(e,r,i={}){return Xt.fromFormatExplain(e,r,i)}static get DATE_SHORT(){return k$}static get DATE_MED(){return Jae}static get DATE_MED_WITH_WEEKDAY(){return KAe}static get DATE_FULL(){return Qae}static get DATE_HUGE(){return Kae}static get TIME_SIMPLE(){return ele}static get TIME_WITH_SECONDS(){return tle}static get TIME_WITH_SHORT_OFFSET(){return rle}static get TIME_WITH_LONG_OFFSET(){return ile}static get TIME_24_SIMPLE(){return sle}static get TIME_24_WITH_SECONDS(){return nle}static get TIME_24_WITH_SHORT_OFFSET(){return ole}static get TIME_24_WITH_LONG_OFFSET(){return ale}static get DATETIME_SHORT(){return lle}static get DATETIME_SHORT_WITH_SECONDS(){return cle}static get DATETIME_MED(){return ule}static get DATETIME_MED_WITH_SECONDS(){return hle}static get DATETIME_MED_WITH_WEEKDAY(){return eRe}static get DATETIME_FULL(){return dle}static get DATETIME_FULL_WITH_SECONDS(){return ple}static get DATETIME_HUGE(){return fle}static get DATETIME_HUGE_WITH_SECONDS(){return mle}}function Z2(t){if(Xt.isDateTime(t))return t;if(t&&t.valueOf&&C1(t.valueOf()))return Xt.fromJSDate(t);if(t&&typeof t=="object")return Xt.fromObject(t);throw new hu(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const Fp="system",Q7="unknown",OC="UTC",qOe=Intl.DateTimeFormat().resolvedOptions().timeZone,WOe="shortOffset";function YOe(t){return"timeZoneIANA"in t}function XOe(t){return t.startsWith("UTC")}function Dmt(t,e=!1){return{json:{read:{source:t,reader:(r,i)=>i[t]?ZOe(i[t]):null},write:!!e&&{allowNull:!0,writer(r,i){i[t]=r?JOe(r):null}}}}}function ZOe(t,e=Fp){return t?YOe(t)?t.timeZoneIANA:QOe(t,e):e}function JOe(t){return{timeZoneIANA:t}}function QOe(t,e=Fp){if(!t||!vW.has(t.timeZone))return e;const r=vW.get(t.timeZone);return XOe(t.timeZone)||t.respectsDaylightSaving?r:KOe(r)}function KOe(t){const e=Xt.local().setZone(t),r=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return r===0?"Etc/UTC":`Etc/GMT${ma.instance(-r).formatOffset(0,"narrow")}`}function Nmt(t,e,r,i,s){if(e&&s==="date")return{timeZone:OC,timeZoneName:void 0};const n=i.timeStyle||i.hour,o=r===Q7;return{timeZone:o?s==="timestamp-offset"?void 0:t??OC:r,timeZoneName:o&&n?WOe:void 0}}const ePe={year:void 0,month:void 0,day:void 0,weekday:void 0},tPe={hour:void 0,minute:void 0,second:void 0},Xle={timeZone:OC},_d={year:"numeric",month:"numeric",day:"numeric"},J2={year:"numeric",month:"long",day:"numeric"},Q2={year:"numeric",month:"short",day:"numeric"},K2={year:"numeric",month:"long",weekday:"long",day:"numeric"},e0={hour:"numeric",minute:"numeric"},f_={...e0,second:"numeric"},Zle={hourCycle:"h23"},eT={...e0,...Zle},tT={...f_,...Zle},Jle={"short-date":_d,"short-date-short-time":{..._d,...e0},"short-date-short-time-24":{..._d,...eT},"short-date-long-time":{..._d,...f_},"short-date-long-time-24":{..._d,...tT},"short-date-le":_d,"short-date-le-short-time":{..._d,...e0},"short-date-le-short-time-24":{..._d,...eT},"short-date-le-long-time":{..._d,...f_},"short-date-le-long-time-24":{..._d,...tT},"long-month-day-year":J2,"long-month-day-year-short-time":{...J2,...e0},"long-month-day-year-short-time-24":{...J2,...eT},"long-month-day-year-long-time":{...J2,...f_},"long-month-day-year-long-time-24":{...J2,...tT},"day-short-month-year":Q2,"day-short-month-year-short-time":{...Q2,...e0},"day-short-month-year-short-time-24":{...Q2,...eT},"day-short-month-year-long-time":{...Q2,...f_},"day-short-month-year-long-time-24":{...Q2,...tT},"long-date":K2,"long-date-short-time":{...K2,...e0},"long-date-short-time-24":{...K2,...eT},"long-date-long-time":{...K2,...f_},"long-date-long-time-24":{...K2,...tT},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":e0,"long-time":f_},rPe=Ic()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),Qle={ar:"ar-u-nu-latn-ca-gregory"};let eU=new WeakMap;const fD=Jle["short-date-short-time"];function iPe(t){let e=eU.get(t);if(!e){const r=xc(),i=Qle[r]||r,s=K7(t.timeZone??Fp),n={...t,timeZone:s};e=new Intl.DateTimeFormat(i,n),eU.set(t,e)}return e}function sPe(t){return Jle[t]}function H0(t,e=fD){return iPe(e).format(t)}function Fmt(t,e=fD){return H0(new Date(t),{...e,...Xle,...tPe})}function Umt(t,e=fD){return H0(new Date(`1970-01-01T${t}Z`),{...e,...Xle,...ePe})}function kmt(t,e=fD){if(e.timeZone)return H0(new Date(t),e);const r=Xt.fromISO(t,{setZone:!0}),i=xc(),s=Qle[i]??i,n=r.offset===0?OC:e.timeZone,o={...e,timeZone:n};return r.toLocaleString(o,{locale:s})}function K7(t){switch(t){case Fp:return qOe;case Q7:return OC;default:return t}}v7(()=>{eU=new WeakMap});const nPe={ar:"ar-u-nu-latn"};let $P=new WeakMap,Kle={};function oPe(t){const e=t||Kle;if(!$P.has(e)){const r=xc(),i=nPe[xc()]||r;$P.set(e,new Intl.NumberFormat(i,t))}return $P.get(e)}function Bmt(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function PC(t,e){return Object.is(t,-0)&&(t=0),oPe(e).format(t)}v7(()=>{$P=new WeakMap,Kle={}});const ece=ne.getLogger("esri.intl.substitute");function zmt(t,e,r={}){const{format:i={}}=r;return IL(t,s=>aPe(s,e,i))}function aPe(t,e,r){let i,s;const n=t.indexOf(":");if(n===-1?i=t.trim():(i=t.slice(0,n).trim(),s=t.slice(n+1).trim()),!i)return"";const o=b3(i,e);if(o==null)return"";const a=(s?r==null?void 0:r[s]:null)??(r==null?void 0:r[i]);return a?lPe(o,a):s?cPe(o,s):eV(o)}function lPe(t,e){switch(e.type){case"date":return H0(t,e.intlOptions);case"number":return PC(t,e.intlOptions);default:return ece.warn("missing format descriptor for key {key}"),eV(t)}}function cPe(t,e){switch(e.toLowerCase()){case"dateformat":return H0(t);case"numberformat":return PC(t);default:return ece.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?H0(t):/^numberformat/i.test(e)?PC(t):eV(t)}}function eV(t){switch(typeof t){case"string":return t;case"number":return PC(t);case"boolean":return""+t;default:return t instanceof Date?H0(t):""}}async function uPe(t,e,r,i){const s=e.exec(r);if(!s)throw new X("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=fCe(i),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let u;try{u=await qW(t(c))}catch(d){if(c===l)throw new X("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:d});try{u=await qW(t(l))}catch(p){throw new X("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:p})}}return u}async function qW(t){if(WW.fetchBundleAsset!=null)return WW.fetchBundleAsset(t);const e=await Hi(t,{responseType:"text"});return JSON.parse(e.data)}let hPe=class{constructor({base:e="",pattern:r,location:i=new URL(window.location.href)}){let s;s=typeof i=="string"?n=>new URL(n,new URL(i,window.location.href)).href:i instanceof URL?n=>new URL(n,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,r){return uPe(this.getAssetUrl,this.matcher,e,r)}};function dPe(t){return new hPe(t)}const WW={};pCe(dPe({pattern:"esri/",location:ei}));const pPe="yyyy-MM-dd",fPe="TT";var RE;(function(t){t.HM="HH:mm",t.HMS="HH:mm:ss",t.HMS_MS="HH:mm:ss.SSS"})(RE||(RE={}));const mPe=[RE.HMS_MS,RE.HMS,RE.HM,fPe];function YW(t){return Xt.fromFormat(t,pPe)}function XW(t){let e=null;return mPe.find(r=>(e=Xt.fromFormat(t,r),e.isValid)),e}function ZW(t){return Xt.fromISO(t)}var Lx;(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(Lx||(Lx={}));const gPe=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function yPe(t){return t!=null&&gPe.has(t.type)}function tce(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function rce(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function ice(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function _Pe(t,e){const r=t==null?void 0:t.domain;if(!r)return null;switch(r.type){case"range":{const{min:i,max:s}=sce(t);if(i!=null&&+e<i||s!=null&&+e>s)return Lx.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(r.codedValues==null||r.codedValues.every(i=>i==null||i.code!==e))return Lx.INVALID_CODED_VALUE}return null}function sce(t,e){const r=e??(t==null?void 0:t.domain);if(!r||r.type!=="range")return;const i="range"in r?r.range[0]:r.minValue,s="range"in r?r.range[1]:r.maxValue,n=yPe(t);return tce(t)||ice(t)||rce(t)?{...vPe(t,s,i),isInteger:n}:{min:i!=null&&typeof i=="number"?i:null,max:s!=null&&typeof s=="number"?s:null,rawMin:i,rawMax:s,isInteger:n}}function vPe(t,e,r){return tce(t)?{min:r!=null&&Uv(r)?YW(r).toMillis():null,max:e!=null&&Uv(e)?YW(e).toMillis():null,rawMin:r,rawMax:e}:ice(t)?{min:r!=null&&Uv(r)?XW(r).toMillis():null,max:e!=null&&Uv(e)?XW(e).toMillis():null,rawMin:r,rawMax:e}:rce(t)?{min:r!=null&&Uv(r)?ZW(r).toMillis():null,max:e!=null&&Uv(e)?ZW(e).toMillis():null,rawMin:r,rawMax:e}:{max:null,min:null}}const bPe=ne.getLogger("esri.support.arcadeOnDemand");let w4;function tV(){return w4||(w4=(async()=>{const t=await he(()=>import("./arcadeUtils-b8507782.js").then(e=>e.aD),["./arcadeUtils-b8507782.js","./TimeOnly-d19fd4d4.js","./UnknownTimeZone-ab7c6b01.js","./number-824ff93f.js","./FieldsIndex-6b49ca64.js","./hash-6f442295.js"],import.meta.url);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),w4}const wPe=(t,e,r)=>rV.create(t,e,r,null,["$feature","$view"],[]),xPe=(t,e,r)=>rV.create(t,e,r,null,["$feature","$view"],[]),Gmt=(t,e,r,i)=>rV.create(t,e,r,i,["$feature","$view"],[]);let rV=class nce{constructor(e,r,i,s,n,o,a){this.services=null,this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=i,this._arcade=r,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,r,i,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await tV(),u=at.fromJSON(r);let d;try{d=a.parseScript(e,o)}catch($){return bPe.error(new X("arcade-bad-expression","Failed to parse arcade script",{script:e,error:$})),null}const p=n.reduce(($,D)=>({...$,[D]:null}),{});let g=null;s!=null&&(g=new c(s),g.immutable=!0,p.$config=null);const y=a.scriptUsesGeometryEngine(d),_=y&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(d)&&a.enableFeatureSetSupport(),w=a.scriptIsAsync(d),x=w&&a.enableAsyncSupport(),T={vars:p,spatialReference:u,useAsync:!!x};await Promise.all([_,v,x]);const S=new Set;await a.loadDependentModules(S,d,null,w,y);const C=new c;C.immutable=!1,C.setField("scale",0);const A=a.compileScript(d,T),O=($,D)=>{var z;const N=(z=$.$view)==null?void 0:z.timeZone;return"$view"in $&&$.$view&&(C.setField("scale",typeof $.$view=="object"&&"scale"in $.$view?$.$view.scale:void 0),$.$view=C),g&&($.$config=g),A({vars:$,spatialReference:u,services:D,timeZone:N})};return new nce(e,a,d,O,new l,i,u)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const TPe=/^([0-9_])/,SPe=/[^a-z0-9_\u0080-\uffff]+/gi;function jmt(t){return t==null?null:t.trim().replaceAll(SPe,"_").replace(TPe,"F$1")||null}const EPe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],CPe=["field","normalizationField"];function Hmt(t,e){if(t!=null&&e!=null){for(const r of Array.isArray(t)?t:[t])if(JW(EPe,r,e),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)JW(CPe,i,e)}}function JW(t,e,r){if(t)for(const i of t){const s=b3(i,e),n=s&&typeof s!="function"&&r.get(s);n&&v2(i,n.name,e)}}function qmt(t,e){var r;if(t!=null&&((r=e==null?void 0:e.fields)!=null&&r.length))if("startField"in t){const i=e.get(t.startField),s=e.get(t.endField);t.startField=(i==null?void 0:i.name)??null,t.endField=(s==null?void 0:s.name)??null}else{const i=e.get(t.startTimeField),s=e.get(t.endTimeField);t.startTimeField=(i==null?void 0:i.name)??null,t.endTimeField=(s==null?void 0:s.name)??null}}const x4=new Set;function oce(t,e){return t&&e?(x4.clear(),MC(x4,t,e),Array.from(x4).sort()):[]}function MC(t,e,r){var i;if(r)if((i=e==null?void 0:e.fields)!=null&&i.length)if(r.includes("*"))for(const{name:s}of e.fields)t.add(s);else for(const s of r)mD(t,e,s);else{if(r.includes("*"))return t.clear(),void t.add("*");for(const s of r)s!=null&&t.add(s)}}function mD(t,e,r){if(typeof r=="string")if(e){const i=e.get(r);i&&t.add(i.name)}else t.add(r)}function Wmt(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(r=>r.name):e}async function Q1(t,e,r){var n;if(!r)return;const{arcadeUtils:i}=await tV(),s=i.extractFieldNames(r,(n=e==null?void 0:e.fields)==null?void 0:n.map(o=>o.name));for(const o of s)mD(t,e,o)}async function ace(t,e,r){if(r&&r!=="1=1"){const i=await Xae(r,e);if(!i.isStandardized)throw new X("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});MC(t,e,i.fieldNames)}}function Ymt({displayField:t,fields:e}){return t||(e!=null&&e.length?T4(e,"name-or-title")||T4(e,"unique-identifier")||T4(e,"type-or-category")||APe(e):null)}function APe(t){for(const e of t){if(!(e!=null&&e.name))continue;const r=e.name.toLowerCase();if(r.includes("name")||r.includes("title"))return e.name}return null}function T4(t,e){for(const r of t)if(r!=null&&r.valueType&&r.valueType===e)return r.name;return null}async function Xmt(t,e){var i;if(!e)return;const r=(i=e.elevationInfo)==null?void 0:i.featureExpressionInfo;return r?r.collectRequiredFields(t,e.fieldsIndex):void 0}function RPe(t,e,r){r.onStatisticExpression?Q1(t,e,r.onStatisticExpression.expression):t.add(r.onStatisticField)}async function Zmt(t,e,r){if(!e||!r||!("fields"in r))return;const i=[],s=r.popupTemplate;i.push(OPe(t,e,s)),r.fields&&i.push(...r.fields.map(async n=>RPe(t,e.fieldsIndex,n))),await Promise.all(i)}async function OPe(t,e,r){const i=[];r!=null&&r.expressionInfos&&i.push(...r.expressionInfos.map(n=>Q1(t,e.fieldsIndex,n.expression)));const s=r==null?void 0:r.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&i.push(Q1(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(i)}async function Jmt(t,e,r){e&&(e.timeInfo&&(r!=null&&r.timeExtent)&&MC(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&MC(t,e.fieldsIndex,[e.floorInfo.floorField]),(r==null?void 0:r.where)!=null&&await ace(t,e.fieldsIndex,r.where))}async function Qmt(t,e,r){e&&r&&await Promise.all(r.map(i=>PPe(t,e,i)))}async function PPe(t,e,r){e&&r&&(r.valueExpression?await Q1(t,e.fieldsIndex,r.valueExpression):r.field&&mD(t,e.fieldsIndex,r.field))}function Kmt(t){return t?oce(t.fieldsIndex,lce(t)):[]}function MPe(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?oce(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const $Pe=new Set(["oid","global-id","guid"]),IPe=new Set(["oid","global-id"]),LPe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i];function DPe(t){const e=new Set;cce(t).forEach(i=>e.add(i)),MPe(t).forEach(i=>e.add(i.toLowerCase()));const r=t&&"infoFor3D"in t?t.infoFor3D:void 0;return r&&(Object.values(r.assetMapFieldRoles).forEach(i=>e.add(i.toLowerCase())),Object.values(r.transformFieldRoles).forEach(i=>e.add(i.toLowerCase()))),Array.from(e)}function lce(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:r,creatorField:i,editDateField:s,editorField:n}=e;return[r,i,s,n].filter(Boolean)}function cce(t){return lce(t).map(e=>e.toLowerCase())}function egt(t,e){var r;return t.editable&&!$Pe.has(t.type)&&!cce(e).includes(((r=t.name)==null?void 0:r.toLowerCase())??"")}function tgt(t,e){var i;const r=((i=t.name)==null?void 0:i.toLowerCase())??"";return!((e==null?void 0:e.objectIdField)!=null&&r===e.objectIdField.toLowerCase()||(e==null?void 0:e.globalIdField)!=null&&r===e.globalIdField.toLowerCase()||DPe(e).includes(r)||IPe.has(t.type)||LPe.some(s=>s.test(r)))}async function rgt(t,e){const{labelingInfo:r,fieldsIndex:i}=e;r!=null&&r.length&&await Promise.all(r.map(s=>NPe(t,i,s)))}async function NPe(t,e,r){if(!r)return;const i=r.getLabelExpression(),s=r.where;if(i.type==="arcade")await Q1(t,e,i.expression);else{const n=i.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{mD(t,e,o.slice(1,-1))})}await ace(t,e,s)}function igt(t){const e=t.defaultValue;return e!==void 0&&dce(t,e)?e:t.nullable?null:void 0}function sgt(t){const e=typeof t=="string"?{type:t}:t;return YPe(e)?255:e.type==="esriFieldTypeDate"||e.type==="date"?8:void 0}function uce(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function FPe(t){return t===null||uce(t)}function UPe(t){return t===null||Number.isInteger(t)}function hce(t){return t!=null&&typeof t=="string"}function kPe(t){return t===null||hce(t)}function BPe(){return!0}function dce(t,e){let r;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":r=t.nullable?UPe:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=t.nullable?FPe:uce;break;case"string":case"esriFieldTypeString":r=t.nullable?kPe:hce;break;default:r=BPe}return arguments.length===1?r:r(e)}const zPe=["integer","small-integer","big-integer"],VPe=["single","double"],GPe=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],jPe=["esriFieldTypeSingle","esriFieldTypeDouble"],HPe=new Set([...zPe,...GPe]),qPe=new Set([...VPe,...jPe]),WPe=W2e(HPe,qPe);function pce(t){return t!=null&&WPe.has(t.type)}function YPe(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function XPe(t){return t!=null&&(t.type==="date"||t.type==="esriFieldTypeDate")}function ngt(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function ogt(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function agt(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function lgt(t){return t!=null&&(t.type==="oid"||t.type==="esriFieldTypeOID")}function cgt(t){return t!=null&&(t.type==="global-id"||t.type==="esriFieldTypeGlobalID")}function ugt(t,e){return ZPe(t,e)===null}var G$,j$;function hgt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function ZPe(t,e){return t==null||t.nullable&&e===null?null:pce(t)&&!JPe(t.type,Number(e))?G$.OUT_OF_RANGE:dce(t,e)?t.domain?_Pe(t,e):null:j$.INVALID_TYPE}function JPe(t,e){const r=typeof t=="string"?fce(t):t;if(!r)return!1;const i=r.min,s=r.max;return r.isInteger?Number.isInteger(e)&&e>=i&&e<=s:e>=i&&e<=s}function fce(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return QPe;case"esriFieldTypeInteger":case"integer":return KPe;case"esriFieldTypeBigInteger":case"big-integer":return eMe;case"esriFieldTypeSingle":case"single":return tMe;case"esriFieldTypeDouble":case"double":return rMe}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(G$||(G$={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(j$||(j$={}));const QPe={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},KPe={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},eMe={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},tMe={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},rMe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function dgt(t,e,r){switch(t){case Lx.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case Lx.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case j$.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case G$.OUT_OF_RANGE:{const{min:i,max:s}=fce(e.type);return`Value ${r} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${i} to ${s}`}}}function pgt(t,e){return!iMe(t,e,null)}function iMe(t,e,r){if(!(e!=null&&e.attributes)||!t){if(r!=null)for(const n of t??[])r.add(n);return!0}const i=new Set(Object.keys(e.attributes));let s=!1;for(const n of t)if(!i.has(n)){if(s=!0,r==null)break;r.add(n)}return s}function fgt(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let IP=class extends st{constructor(e){super(e),this.type=null}};h([f({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],IP.prototype,"type",void 0),IP=h([k("esri.popup.content.Content")],IP);const hy=IP;var tU;let m_=tU=class extends hy{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new tU({description:this.description,displayType:this.displayType,title:this.title})}};h([f({type:String,json:{write:!0}})],m_.prototype,"description",void 0),h([f({type:["auto","preview","list"],json:{write:!0}})],m_.prototype,"displayType",void 0),h([f({type:String,json:{write:!0}})],m_.prototype,"title",void 0),h([f({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],m_.prototype,"type",void 0),m_=tU=h([k("esri.popup.content.AttachmentsContent")],m_);const H$=m_;var rU;let g_=rU=class extends hy{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new rU({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ye(this.outFields):null})}};h([f()],g_.prototype,"creator",void 0),h([f()],g_.prototype,"destroyer",void 0),h([f()],g_.prototype,"outFields",void 0),h([f({type:["custom"],readOnly:!0})],g_.prototype,"type",void 0),g_=rU=h([k("esri.popup.content.CustomContent")],g_);const sMe=g_;var iU;let Zb=iU=class extends st{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new iU({title:this.title,expression:this.expression})}};h([f({type:String,json:{write:!0}})],Zb.prototype,"title",void 0),h([f({type:String,json:{write:!0}})],Zb.prototype,"expression",void 0),h([f({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],Zb.prototype,"returnType",void 0),Zb=iU=h([k("esri.popup.ElementExpressionInfo")],Zb);const nMe=Zb;var sU;let iS=sU=class extends hy{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new sU({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};h([f({type:nMe,json:{write:!0}})],iS.prototype,"expressionInfo",void 0),h([f({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],iS.prototype,"type",void 0),iS=sU=h([k("esri.popup.content.ExpressionContent")],iS);const iV=iS;let Jb=class extends Lc(st){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};h([Ht(rPe)],Jb.prototype,"dateFormat",void 0),h([f({type:Boolean,json:{write:!0}})],Jb.prototype,"digitSeparator",void 0),h([f({type:Qs,json:{write:!0}})],Jb.prototype,"places",void 0),Jb=h([k("esri.popup.support.FieldInfoFormat")],Jb);const oMe=Jb;var nU;let oh=nU=class extends st{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new nU({fieldName:this.fieldName,format:this.format?ye(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};h([f({type:String,json:{write:!0}})],oh.prototype,"fieldName",void 0),h([f({type:oMe,json:{write:!0}})],oh.prototype,"format",void 0),h([f({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],oh.prototype,"isEditable",void 0),h([f({type:String,json:{write:!0}})],oh.prototype,"label",void 0),h([Ht(new Pc({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],oh.prototype,"stringFieldOption",void 0),h([f({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],oh.prototype,"statisticType",void 0),h([f({type:String,json:{write:!0}})],oh.prototype,"tooltip",void 0),h([f({type:Boolean,json:{write:!0}})],oh.prototype,"visible",void 0),oh=nU=h([k("esri.popup.FieldInfo")],oh);const mce=oh;var oU;let Rf=oU=class extends hy{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new oU(ye({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};h([f({type:Object,json:{write:!0}})],Rf.prototype,"attributes",void 0),h([f({type:String,json:{write:!0}})],Rf.prototype,"description",void 0),h([f({type:[mce]})],Rf.prototype,"fieldInfos",void 0),h([ni("fieldInfos")],Rf.prototype,"writeFieldInfos",null),h([f({type:String,json:{write:!0}})],Rf.prototype,"title",void 0),h([f({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Rf.prototype,"type",void 0),Rf=oU=h([k("esri.popup.content.FieldsContent")],Rf);const q$=Rf;let y_=class extends st{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};h([f({type:String,json:{write:!0}})],y_.prototype,"altText",void 0),h([f({type:String,json:{write:!0}})],y_.prototype,"caption",void 0),h([f({type:String,json:{write:!0}})],y_.prototype,"title",void 0),h([f({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],y_.prototype,"type",void 0),y_=h([k("esri.popup.content.mixins.MediaInfo")],y_);const sV=y_;var aU;let __=aU=class extends xe{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new aU({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};h([f()],__.prototype,"color",void 0),h([f()],__.prototype,"fieldName",void 0),h([f()],__.prototype,"tooltip",void 0),h([f()],__.prototype,"value",void 0),__=aU=h([k("esri.popup.content.support.ChartMediaInfoValueSeries")],__);const aMe=__;var lU;let $g=lU=class extends st{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new lU({colors:ye(this.colors),fields:ye(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};h([f({type:[qe],json:{type:[[Qs]],write:!0}})],$g.prototype,"colors",void 0),h([f({type:[String],json:{write:!0}})],$g.prototype,"fields",void 0),h([f({type:String,json:{write:!0}})],$g.prototype,"normalizeField",void 0),h([f({type:[aMe],json:{read:!1}})],$g.prototype,"series",void 0),h([f({type:String,json:{write:!0}})],$g.prototype,"tooltipField",void 0),$g=lU=h([k("esri.popup.content.support.ChartMediaInfoValue")],$g);const lMe=$g;let sS=class extends sV{constructor(e){super(e),this.type=null,this.value=null}};h([f({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],sS.prototype,"type",void 0),h([f({type:lMe,json:{write:!0}})],sS.prototype,"value",void 0),sS=h([k("esri.popup.content.mixins.ChartMediaInfo")],sS);const gD=sS,yD=Ic()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var cU;let LP=cU=class extends gD{constructor(t){super(t),this.type="bar-chart"}clone(){return new cU({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:yD.write}})],LP.prototype,"type",void 0),LP=cU=h([k("esri.popup.content.BarChartMediaInfo")],LP);const gce=LP;var uU;let DP=uU=class extends gD{constructor(t){super(t),this.type="column-chart"}clone(){return new uU({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:yD.write}})],DP.prototype,"type",void 0),DP=uU=h([k("esri.popup.content.ColumnChartMediaInfo")],DP);const yce=DP;var hU;let nS=hU=class extends st{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new hU({linkURL:this.linkURL,sourceURL:this.sourceURL})}};h([f({type:String,json:{write:!0}})],nS.prototype,"linkURL",void 0),h([f({type:String,json:{write:!0}})],nS.prototype,"sourceURL",void 0),nS=hU=h([k("esri.popup.content.support.ImageMediaInfoValue")],nS);const cMe=nS;var dU;let Qb=dU=class extends sV{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new dU({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};h([f({type:Number,json:{write:!0}})],Qb.prototype,"refreshInterval",void 0),h([f({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],Qb.prototype,"type",void 0),h([f({type:cMe,json:{write:!0}})],Qb.prototype,"value",void 0),Qb=dU=h([k("esri.popup.content.ImageMediaInfo")],Qb);const _ce=Qb;var pU;let NP=pU=class extends gD{constructor(t){super(t),this.type="line-chart"}clone(){return new pU({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:yD.write}})],NP.prototype,"type",void 0),NP=pU=h([k("esri.popup.content.LineChartMediaInfo")],NP);const vce=NP;var fU;let FP=fU=class extends gD{constructor(t){super(t),this.type="pie-chart"}clone(){return new fU({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:yD.write}})],FP.prototype,"type",void 0),FP=fU=h([k("esri.popup.content.PieChartMediaInfo")],FP);const bce=FP,wce={base:sV,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":gce,"column-chart":yce,"line-chart":vce,"pie-chart":bce,image:_ce}};var mU;let ah=mU=class extends hy{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?_ce.fromJSON(e):e.type==="barchart"?gce.fromJSON(e):e.type==="columnchart"?yce.fromJSON(e):e.type==="linechart"?vce.fromJSON(e):e.type==="piechart"?bce.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new mU(ye({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};h([f()],ah.prototype,"activeMediaInfoIndex",void 0),h([f({type:Object,json:{write:!0}})],ah.prototype,"attributes",void 0),h([f({type:String,json:{write:!0}})],ah.prototype,"description",void 0),h([f({types:[wce]})],ah.prototype,"mediaInfos",void 0),h([si("mediaInfos")],ah.prototype,"readMediaInfos",null),h([ni("mediaInfos")],ah.prototype,"writeMediaInfos",null),h([f({type:String,json:{write:!0}})],ah.prototype,"title",void 0),h([f({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],ah.prototype,"type",void 0),ah=mU=h([k("esri.popup.content.MediaContent")],ah);const W$=ah;var gU;let oS=gU=class extends st{constructor(t){super(t),this.field=null,this.order=null}clone(){return new gU({field:this.field,order:this.order})}};h([f({type:String,json:{write:!0}})],oS.prototype,"field",void 0),h([f({type:["asc","desc"],json:{write:!0}})],oS.prototype,"order",void 0),oS=gU=h([k("esri.popup.support.RelatedRecordsInfoFieldOrder")],oS);const xce=oS;let Vd=class extends Lc(hy){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};h([f({type:String,json:{write:!0}})],Vd.prototype,"description",void 0),h([f({type:Number,json:{type:Qs,write:!0}})],Vd.prototype,"displayCount",void 0),h([f({type:["list"],json:{write:!0}})],Vd.prototype,"displayType",void 0),h([f({type:[xce],json:{write:!0}})],Vd.prototype,"orderByFields",void 0),h([f({type:Number,json:{type:Qs,write:!0}})],Vd.prototype,"relationshipId",void 0),h([f({type:String,json:{write:!0}})],Vd.prototype,"title",void 0),h([f({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Vd.prototype,"type",void 0),Vd=h([k("esri.popup.content.RelationshipContent")],Vd);const Y$=Vd;var yU;let aS=yU=class extends hy{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new yU({text:this.text})}};h([f({type:String,json:{write:!0}})],aS.prototype,"text",void 0),h([f({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],aS.prototype,"type",void 0),aS=yU=h([k("esri.popup.content.TextContent")],aS);const X$=aS,uMe={base:null,key:"type",typeMap:{attachment:H$,media:W$,text:X$,expression:iV,field:q$,relationship:Y$}};var _U;let v_=_U=class extends st{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new _U({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};h([f({type:String,json:{write:!0}})],v_.prototype,"name",void 0),h([f({type:String,json:{write:!0}})],v_.prototype,"title",void 0),h([f({type:String,json:{write:!0}})],v_.prototype,"expression",void 0),h([f({type:["string","number"],json:{write:!0}})],v_.prototype,"returnType",void 0),v_=_U=h([k("esri.popup.ExpressionInfo")],v_);const hMe=v_;var vU;let lS=vU=class extends st{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new vU({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};h([f({type:Boolean,json:{write:!0}})],lS.prototype,"returnTopmostRaster",void 0),h([f({type:Boolean,json:{write:!0}})],lS.prototype,"showNoDataRecords",void 0),lS=vU=h([k("esri.popup.LayerOptions")],lS);const dMe=lS;var bU;let cS=bU=class extends st{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new bU({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ye(this.orderByFields):null})}};h([f({type:Boolean,json:{write:!0}})],cS.prototype,"showRelatedRecords",void 0),h([f({type:[xce],json:{write:!0}})],cS.prototype,"orderByFields",void 0),cS=bU=h([k("esri.popup.RelatedRecordsInfo")],cS);const pMe=cS;var wU;let Xc=wU=class extends G7(xe){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new wU({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};h([f()],Xc.prototype,"active",void 0),h([f()],Xc.prototype,"className",void 0),h([f()],Xc.prototype,"disabled",void 0),h([f()],Xc.prototype,"icon",void 0),h([f()],Xc.prototype,"id",void 0),h([f()],Xc.prototype,"indicator",void 0),h([f()],Xc.prototype,"title",void 0),h([f()],Xc.prototype,"type",void 0),h([f()],Xc.prototype,"visible",void 0),Xc=wU=h([k("esri.support.actions.ActionBase")],Xc);const nV=Xc;var xU;let UP=xU=class extends nV{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new xU({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};h([f()],UP.prototype,"image",void 0),UP=xU=h([k("esri.support.Action.ActionButton")],UP);const fMe=UP;var TU;let uS=TU=class extends nV{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new TU({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};h([f()],uS.prototype,"image",void 0),h([f()],uS.prototype,"value",void 0),uS=TU=h([k("esri.support.Action.ActionToggle")],uS);const mMe=uS,gMe="esri.PopupTemplate",yMe=ne.getLogger(gMe),rT="relationships/",QW="expression/",_Me=St.ofType({key:"type",defaultKeyValue:"button",base:nV,typeMap:{button:fMe,toggle:mMe}}),vMe={base:hy,key:"type",typeMap:{media:W$,custom:sMe,text:X$,attachments:H$,fields:q$,expression:iV,relationship:Y$}},bMe=new Set(["attachments","fields","media","text","expression","relationship"]);let kn=class extends Lc(st){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>k0(vMe,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Fl(e)?e:(yMe.error("content error","unsupported content value",{value:e}),null)}readContent(e,r){const{popupElements:i}=r;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,i):this._readPopupInfo(r)}writeContent(e,r,i,s){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(n=>bMe.has(n.type)).map(n=>n==null?void 0:n.toJSON(s)),r.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(r):n.type==="media"?this._writeMediaContent(n,r):n.type==="text"?this._writeTextContent(n,r):n.type==="relationship"&&this._writeRelationshipContent(n,r)})):r.description=e}writeFieldInfos(e,r,i,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var u;return(u=c.fieldInfos)==null?void 0:u.length});r.fieldInfos=e.filter(Boolean).map(c=>{const u=c.toJSON(s);return l&&(u.visible=!1),u})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,r)}writeLayerOptions(e,r,i,s){r[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,r){r.title=e||""}async collectRequiredFields(e,r){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,r,[...i,...this._getContentExpressionInfos(this.content,i)]),MC(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const r=new Set;return await this.collectRequiredFields(r,e),[...r].sort()}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=ye(e.fieldInfos);Array.isArray(r.fieldInfos)?i.forEach(s=>{const n=r.fieldInfos.find(o=>o.fieldName.toLowerCase()===s.fieldName.toLowerCase());n?n.visible=!0:r.fieldInfos.push(s)}):r.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){var n,o;const i=((n=e.orderByFields)==null?void 0:n.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],s=[...((o=r.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...i];r.relatedRecordsInfo={showRelatedRecords:!0,...(s==null?void 0:s.length)&&{orderByFields:s}}}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=ye(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...i]:r.mediaInfos=i}_readPopupInfoElements(e,r,i){const s={description:!1,mediaInfos:!1};return i.map(n=>n.type==="media"?(n.mediaInfos||!r||s.mediaInfos||(n.mediaInfos=r,s.mediaInfos=!0),W$.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),X$.fromJSON(n)):n.type==="attachments"?H$.fromJSON(n):n.type==="fields"?q$.fromJSON(n):n.type==="expression"?iV.fromJSON(n):n.type==="relationship"?Y$.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:r,order:i}=e;if(!(r!=null&&r.startsWith(rT)))return null;const s=r.replace(rT,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return typeof n=="number"&&o?Y$.fromJSON({relationshipId:n,orderByFields:[{field:o,order:i}]}):null}_toFieldOrderJSON(e,r){const{order:i,field:s}=e;return{field:`${rT}${r}/${s}`,order:i}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:i,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new X$({text:e})):n.push(new q$),Array.isArray(r)&&r.length&&n.push(W$.fromJSON({mediaInfos:r})),i&&n.push(H$.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const r=e==null?void 0:e.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return r==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:r,title:i,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:u}=n,d=[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(c),...this._extractFieldNames(u),...o??[]];return a&&d.push(a),l&&d.push(l),d}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((i,s)=>[...i,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,i)=>[...r,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,r,i){i&&await Promise.all(i.map(s=>Q1(e,r,s.expression)))}_getFieldInfoFields(e){return e?e.filter(r=>r.visible===void 0||!!r.visible).map(r=>r.fieldName).filter(r=>!r.startsWith(rT)&&!r.startsWith(QW)):[]}_getActionsFields(e){return e?e.toArray().reduce((r,i)=>[...r,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:r,title:i,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const r=/{[^}]*}/g,i=e.match(r);if(!i)return[];const s=/\{(\w+):.+\}/,n=i.filter(o=>!(o.indexOf(`{${rT}`)===0||o.indexOf(`{${QW}`)===0)).map(o=>o.replace(s,"{$1}"));return n?n.map(o=>o.slice(1,-1)):[]}};h([f({type:_Me})],kn.prototype,"actions",void 0),h([f()],kn.prototype,"content",void 0),h([zi("content")],kn.prototype,"castContent",null),h([si("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],kn.prototype,"readContent",null),h([ni("content",{popupElements:{type:St.ofType(uMe)},showAttachments:{type:Boolean},mediaInfos:{type:St.ofType(wce)},description:{type:String},relatedRecordsInfo:{type:pMe}})],kn.prototype,"writeContent",null),h([f({type:[hMe],json:{write:!0}})],kn.prototype,"expressionInfos",void 0),h([f({type:[mce]})],kn.prototype,"fieldInfos",void 0),h([ni("fieldInfos")],kn.prototype,"writeFieldInfos",null),h([f({type:dMe})],kn.prototype,"layerOptions",void 0),h([ni("layerOptions")],kn.prototype,"writeLayerOptions",null),h([f({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],kn.prototype,"lastEditInfoEnabled",void 0),h([f()],kn.prototype,"outFields",void 0),h([f()],kn.prototype,"overwriteActions",void 0),h([f()],kn.prototype,"returnGeometry",void 0),h([f({json:{type:String}})],kn.prototype,"title",void 0),h([ni("title")],kn.prototype,"writeTitle",null),kn=h([k("esri.PopupTemplate")],kn);const wMe=kn,KW=new Pc({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let xMe=0,Kb=class extends st{constructor(e){super(e),this.id="sym"+xMe++,this.type=null,this.color=new qe([0,0,0,1])}readColor(e){return(e==null?void 0:e[0])!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,r){}hash(){return JSON.stringify(this.toJSON())}clone(){}};h([f({type:KW.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:KW.write}}})],Kb.prototype,"type",void 0),h([f({type:qe,json:{write:{allowNull:!0}}})],Kb.prototype,"color",void 0),h([si("color")],Kb.prototype,"readColor",null),Kb=h([k("esri.symbols.Symbol")],Kb);const Dc=Kb;var SU;let Ig=SU=class extends Dc{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){var r;if(((r=this.data)==null?void 0:r.type)==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const s=i.map(n=>{const o=n.valueExpressionInfo;return Q1(t,e,o.expression)});await Promise.all(s)}}}clone(){return new SU({data:ye(this.data)})}hash(){return kse(JSON.stringify(this.data)).toString()}};h([f({json:{write:!1}})],Ig.prototype,"color",void 0),h([f({json:{write:!0}})],Ig.prototype,"data",void 0),h([si("data",["symbol"])],Ig.prototype,"readData",null),h([ni("data",{})],Ig.prototype,"writeData",null),h([Ht({CIMSymbolReference:"cim"},{readOnly:!0})],Ig.prototype,"type",void 0),Ig=SU=h([k("esri.symbols.CIMSymbol")],Ig);const N3=Ig;let ew=class extends st{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,r,i){e||(r[i]=e)}};h([f({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],ew.prototype,"enabled",void 0),h([ni("enabled")],ew.prototype,"writeEnabled",null),h([f({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],ew.prototype,"type",void 0),ew=h([k("esri.symbols.Symbol3DLayer")],ew);const Zp=ew;function TMe(t,e){const r=e.transparency!=null?Qoe(e.transparency):1,i=e.color;return i&&Array.isArray(i)?new qe([i[0]||0,i[1]||0,i[2]||0,r]):null}function SMe(t,e){e.color=t.toJSON().slice(0,3);const r=Joe(t.a);r!==0&&(e.transparency=r)}const Om={type:qe,json:{type:[Qs],default:null,read:{source:["color","transparency"],reader:TMe},write:{target:{color:{type:[Qs]},transparency:{type:Qs}},writer:SMe}}},Up={type:Number,cast:Rs,json:{write:!0}};let b_=class extends st{constructor(e){super(e),this.color=new qe([0,0,0,1]),this.extensionLength=0,this.size=Kh(1)}clone(){}cloneProperties(){return{color:ye(this.color),size:this.size,extensionLength:this.extensionLength}}};h([f({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],b_.prototype,"type",void 0),h([f(Om)],b_.prototype,"color",void 0),h([f({...Up,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],b_.prototype,"extensionLength",void 0),h([f(Up)],b_.prototype,"size",void 0),b_=h([k("esri.symbols.edges.Edges3D")],b_);const oV=b_;var EU;let kP=EU=class extends oV{constructor(t){super(t),this.type="sketch"}clone(){return new EU(this.cloneProperties())}};h([Ht({sketch:"sketch"},{readOnly:!0})],kP.prototype,"type",void 0),kP=EU=h([k("esri.symbols.edges.SketchEdges3D")],kP);const EMe=kP;var CU;let BP=CU=class extends oV{constructor(t){super(t),this.type="solid"}clone(){return new CU(this.cloneProperties())}};h([Ht({solid:"solid"},{readOnly:!0})],BP.prototype,"type",void 0),BP=CU=h([k("esri.symbols.support.SolidEdges3D")],BP);const CMe=BP,Tce={types:{key:"type",base:oV,typeMap:{solid:CMe,sketch:EMe}},json:{write:!0}};var AU;let Sc=AU=class extends st{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new AU(t)}};h([f(Om)],Sc.prototype,"color",void 0),Sc=AU=h([k("esri.symbols.support.Symbol3DMaterial")],Sc);var RU;let Lg=RU=class extends Zp{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new RU({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};h([Ht({Extrude:"extrude"},{readOnly:!0})],Lg.prototype,"type",void 0),h([f({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Lg.prototype,"size",void 0),h([f({type:Sc,json:{write:!0}})],Lg.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Lg.prototype,"castShadows",void 0),h([f(Tce)],Lg.prototype,"edges",void 0),Lg=RU=h([k("esri.symbols.ExtrudeSymbol3DLayer")],Lg);const Sce=Lg;let hS=class extends Dc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};h([Ht({esriSLS:"simple-line"},{readOnly:!0})],hS.prototype,"type",void 0),h([f({type:Number,cast:Rs,json:{write:!0}})],hS.prototype,"width",void 0),hS=h([k("esri.symbols.LineSymbol")],hS);const AMe=hS,RMe=["begin","end","begin-end"],Ece=["arrow","circle","square","diamond","cross","x"];var OU;let Gd=OU=class extends st{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,r,i){e[r]=(i==null?void 0:i.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return(t==null?void 0:t[0])!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,r,i){(i==null?void 0:i.origin)==="web-map"||(e[r]=t)}clone(){return new OU({color:ye(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};h([f({type:["begin","end","begin-end"],json:{write:!0}})],Gd.prototype,"placement",void 0),h([Ht({"line-marker":"line-marker"},{readOnly:!0}),f({json:{origins:{"web-map":{write:!1}}}})],Gd.prototype,"type",void 0),h([f({type:Ece})],Gd.prototype,"style",void 0),h([ni("style")],Gd.prototype,"writeStyle",null),h([f({type:qe,value:null,json:{write:{allowNull:!0}}})],Gd.prototype,"color",null),h([si("color")],Gd.prototype,"readColor",null),h([ni("color")],Gd.prototype,"writeColor",null),Gd=OU=h([k("esri.symbols.LineSymbolMarker")],Gd);const OMe=Gd;var PU;const S4=new Pc({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Of=PU=class extends AMe{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,r,i,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),r!=null&&(o.width=Rs(r)),i!=null&&(o.cap=i),s!=null&&(o.join=s),n!=null&&(o.miterLimit=Rs(n)),o}clone(){var t;return new PU({color:ye(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};h([Ht({esriSLS:"simple-line"},{readOnly:!0})],Of.prototype,"type",void 0),h([f({type:S4.apiValues,json:{read:S4.read,write:S4.write}})],Of.prototype,"style",void 0),h([f({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null?void 0:r.origin)==null})}}})],Of.prototype,"cap",void 0),h([f({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null?void 0:r.origin)==null})}}})],Of.prototype,"join",void 0),h([f({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":OMe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Of.prototype,"marker",void 0),h([f({type:Number,json:{read:!1,write:!1}})],Of.prototype,"miterLimit",void 0),Of=PU=h([k("esri.symbols.SimpleLineSymbol")],Of);const xv=Of;let dS=class extends Dc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};h([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":xv}},json:{default:null,write:!0}})],dS.prototype,"outline",void 0),h([f({type:["simple-fill","picture-fill"],readOnly:!0})],dS.prototype,"type",void 0),dS=h([k("esri.symbols.FillSymbol")],dS);const Cce=dS;let zP=class extends st{constructor(e){super(e)}clone(){}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],zP.prototype,"type",void 0),zP=h([k("esri.symbols.patterns.LinePattern3D")],zP);const Ace=zP,PMe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var MU;const MMe=Ic()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let pS=MU=class extends Ace{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new MU(t)}};h([f({type:["style"]})],pS.prototype,"type",void 0),h([Ht(MMe),f({type:PMe})],pS.prototype,"style",void 0),pS=MU=h([k("esri.symbols.patterns.LineStylePattern3D")],pS);const aV=pS;let VP=class extends st{constructor(e){super(e)}clone(){}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],VP.prototype,"type",void 0),VP=h([k("esri.symbols.patterns.Pattern3D")],VP);const Rce=VP,$Me=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var $U;let fS=$U=class extends Rce{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new $U(t)}};h([f({type:["style"]})],fS.prototype,"type",void 0),h([f({type:$Me,json:{read:!0,write:!0}})],fS.prototype,"style",void 0),fS=$U=h([k("esri.symbols.patterns.StylePattern3D")],fS);const Oce=fS,IMe={types:{key:"type",base:Rce,typeMap:{style:Oce}},json:{write:!0}},Pce={types:{key:"type",base:Ace,typeMap:{style:aV}},json:{write:!0}},OE=new qe("white");new qe("black");const LMe=new qe([255,255,255,0]);function DMe(t){return t.r===0&&t.g===0&&t.b===0}var IU;let PE=IU=class extends Sc{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new IU(t)}};h([Ht({multiply:"multiply",replace:"replace",tint:"tint"})],PE.prototype,"colorMixMode",void 0),PE=IU=h([k("esri.symbols.support.Symbol3DFillMaterial")],PE);function tn(t=Dce){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function K1(t,e,r,i,s,n,o=tn()){return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function Rgt(t,e){const r=isFinite(t[2])||isFinite(t[5]);return new Xr(r?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function Dx(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function NMe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function rd(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function yc(t,e,r=0,i=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let u=0;u<i;u++)s=Math.min(s,e[r+3*u]),n=Math.min(n,e[r+3*u+1]),o=Math.min(o,e[r+3*u+2]),a=Math.max(a,e[r+3*u]),l=Math.max(l,e[r+3*u+1]),c=Math.max(c,e[r+3*u+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function E4(t,e,r){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(r)for(let u=0;u<i;u++){const d=e[u];s=Math.min(s,d[0]),n=Math.min(n,d[1]),o=Math.min(o,d[2]),a=Math.max(a,d[0]),l=Math.max(l,d[1]),c=Math.max(c,d[2])}else for(let u=0;u<i;u++){const d=e[u];s=Math.min(s,d[0]),n=Math.min(n,d[1]),a=Math.max(a,d[0]),l=Math.max(l,d[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function FMe(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function Tv(t){return t[0]>=t[3]?0:t[3]-t[0]}function Sv(t){return t[1]>=t[4]?0:t[4]-t[1]}function dy(t){return t[2]>=t[5]?0:t[5]-t[2]}function Mce(t){const e=Tv(t),r=dy(t),i=Sv(t);return Math.sqrt(e*e+r*r+i*i)}function Bh(t,e=[0,0,0]){return e[0]=t[0]+Tv(t)/2,e[1]=t[1]+Sv(t)/2,e[2]=t[2]+dy(t)/2,e}function GA(t,e=[0,0,0]){return e[0]=Tv(t),e[1]=Sv(t),e[2]=dy(t),e}function lV(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function Ogt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function UMe(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function zh(t,e){return e==null||UMe(t,e)}function $ce(t,e,r,i,s=t){return s[0]=t[0]+e,s[1]=t[1]+r,s[2]=t[2]+i,s[3]=t[3]+e,s[4]=t[4]+r,s[5]=t[5]+i,s}function Pgt(t,e,r=t){const i=t[0]+Tv(t)/2,s=t[1]+Sv(t)/2,n=t[2]+dy(t)/2;return r[0]=i+(t[0]-i)*e,r[1]=s+(t[1]-s)*e,r[2]=n+(t[2]-n)*e,r[3]=i+(t[3]-i)*e,r[4]=s+(t[4]-s)*e,r[5]=n+(t[5]-n)*e,r}function Ice(t,e,r=t){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r!==t&&(r[3]=t[3],r[4]=t[4],r[5]=t[5]),r}function Lce(t,e,r=t){return r[3]=e[0],r[4]=e[1],r[5]=e[2],r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),t}function _D(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function ui(t){return t?_D(t,eY):tn(eY)}function cV(t,e){return e||(e=Gt()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function Mgt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function kMe(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=Number.NEGATIVE_INFINITY,t[3]=i,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function LU(t){return t.length===6}function uV(t){return Tv(t)===0&&Sv(t)===0&&dy(t)===0}function $gt(t,e,r){if(t==null||e==null)return t===e;if(!LU(t)||!LU(e))return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function BMe(t,e,r,i,s,n){return K1(t,e,r,i,s,n,zMe)}const Igt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],eY=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Dce=[0,0,0,0,0,0],zMe=tn();function C4(t,{isPrimitive:e,width:r,depth:i,height:s}){const n=e?10:1;if(r==null&&s==null&&i==null)return[n*t[0],n*t[1],n*t[2]];const o=Te(r,i,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const VMe=K1(-.5,-.5,-.5,.5,.5,.5),GMe=K1(-.5,-.5,0,.5,.5,1),jMe=K1(-.5,-.5,0,.5,.5,.5);function HMe(t){switch(t){case"sphere":case"cube":case"diamond":return VMe;case"cylinder":case"cone":case"inverted-cone":return GMe;case"tetrahedron":return jMe;default:return}}const hV=["butt","square","round"],qMe=[...hV,"none"],Nce=["miter","bevel","round"];var DU;let w_=DU=class extends st{constructor(t){super(t),this.color=new qe([0,0,0,1]),this.size=Kh(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new DU(t)}};h([f(Om)],w_.prototype,"color",void 0),h([f(Up)],w_.prototype,"size",void 0),h([f(Pce)],w_.prototype,"pattern",void 0),h([f({type:hV,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],w_.prototype,"patternCap",void 0),w_=DU=h([k("esri.symbols.support.Symbol3DOutline")],w_);var GP;let Pf=GP=class extends Zp{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new GP(t)}static fromSimpleFillSymbol(t){var i,s,n;const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new aV({style:t.outline.style}):null,r={size:((i=t.outline)==null?void 0:i.width)??0,color:(((s=t.outline)==null?void 0:s.color)??OE).clone(),pattern:e};return e&&((n=t.outline)!=null&&n.cap)&&(r.patternCap=t.outline.cap),new GP({material:new PE({color:(t.color??LMe).clone()}),pattern:t.style&&t.style!=="solid"?new Oce({style:t.style}):null,outline:r})}};h([Ht({Fill:"fill"},{readOnly:!0})],Pf.prototype,"type",void 0),h([f({type:PE,json:{write:!0}})],Pf.prototype,"material",void 0),h([f(IMe)],Pf.prototype,"pattern",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Pf.prototype,"castShadows",void 0),h([f({type:w_,json:{write:!0}})],Pf.prototype,"outline",void 0),h([f(Tce)],Pf.prototype,"edges",void 0),Pf=GP=h([k("esri.symbols.FillSymbol3DLayer")],Pf);const F3=Pf,WMe=["none","underline","line-through"],YMe=["normal","italic","oblique"],XMe=["normal","lighter","bold","bolder"],Fce={type:Number,cast:t=>{const e=Mh(t);return e===0?1:me(e,.1,4)},nonNullable:!0},ZMe=["left","right","center"],JMe=["baseline","top","middle","bottom"],Uce={type:ZMe,nonNullable:!0},kce={type:JMe,nonNullable:!0},Lgt=8;var NU;let Mf=NU=class extends st{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return Rs(t)}clone(){return new NU({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};h([f({type:WMe,json:{default:"none",write:!0}})],Mf.prototype,"decoration",void 0),h([f({type:String,json:{write:!0}})],Mf.prototype,"family",void 0),h([f({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.textSymbol3D})}}})],Mf.prototype,"size",void 0),h([zi("size")],Mf.prototype,"castSize",null),h([f({type:YMe,json:{default:"normal",write:!0}})],Mf.prototype,"style",void 0),h([f({type:XMe,json:{default:"normal",write:!0}})],Mf.prototype,"weight",void 0),Mf=NU=h([k("esri.symbols.Font")],Mf);const vD=Mf;function ev(t,e){var i;const r=(i=e==null?void 0:e.url)==null?void 0:i.path;if(t&&r&&(t=dc(t,r,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const s=e7(t,e.portalItem.itemUrl);s!=null&&QMe.test(s)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(s).path)}return FU(t,e==null?void 0:e.portal)}function Nx(t,e,r=$C.YES){var s,n;if(t==null)return t;!wc(t)&&(e!=null&&e.blockedRelativeUrls)&&e.blockedRelativeUrls.push(t);let i=dc(t);if(e){const o=((s=e.verifyItemRelativeUrls)==null?void 0:s.rootPath)||((n=e.url)==null?void 0:n.path);if(o){const a=FU(o,e.portal),l=FU(i,e.portal);i=e7(l,a,a),i!=null&&i!==l&&i!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=zce(i,e==null?void 0:e.portal),wc(i)&&(i=rm(i)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!wc(i)&&!qp(i)&&r===$C.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(i),compress:!1}),i}function dV(t,e,r){return ev(t,r)}function tv(t,e,r,i){const s=Nx(t,i);s!==void 0&&(e[r]=s)}const Bce=/\/items\/([^\/]+)\/resources\/(.*)/,QMe=/^\.\/resources\//;function KMe(t){const e=(t==null?void 0:t.match(Bce))??null;return(e==null?void 0:e[1])??null}function e$e(t){const e=(t==null?void 0:t.match(Bce))??null;if(e==null)return null;const r=e[2],i=r.lastIndexOf("/");if(i===-1){const{path:o,extension:a}=Uq(r);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=Uq(r.slice(i+1));return{prefix:r.slice(0,i),filename:s,extension:n}}function zce(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?p8(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function FU(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const r=`${e.urlKey}.${e.customBaseUrl}`,i=Zz();return Sx(i,`${i.scheme}://${r}`)?p8(t,e.portalHostname,r):p8(t,r,e.portalHostname)}var $C;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})($C||($C={}));const Dgt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return $C},ensureMainOnlineDomain:zce,fromJSON:ev,itemIdFromResourceUrl:KMe,prefixAndFilenameFromResourceUrl:e$e,read:dV,toJSON:Nx,write:tv},Symbol.toStringTag,{value:"Module"}));var UU;const t$e=Ic()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let x_=UU=class extends st{constructor(t){super(t)}readHref(t,e,r){return t?ev(t,r):e.dataURI}writeHref(t,e,r,i){t&&(qp(t)?e.dataURI=t:(e.href=Nx(t,i),wc(e.href)&&(e.href=rm(e.href))))}clone(){return new UU({href:this.href,primitive:this.primitive})}};h([f({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],x_.prototype,"href",void 0),h([si("href")],x_.prototype,"readHref",null),h([ni("href",{href:{type:String},dataURI:{type:String}})],x_.prototype,"writeHref",null),h([Ht(t$e)],x_.prototype,"primitive",void 0),x_=UU=h([k("esri.symbols.support.IconSymbol3DLayerResource")],x_);const r$e="circle";var kU;let Iw=kU=class extends xe{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new kU({x:this.x,y:this.y})}};h([f({type:Number})],Iw.prototype,"x",void 0),h([f({type:Number})],Iw.prototype,"y",void 0),Iw=kU=h([k("esri.symbols.support.Symbol3DAnchorPosition2D")],Iw);var BU;let mS=BU=class extends st{constructor(t){super(t),this.color=new qe([0,0,0,1]),this.size=Kh(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new BU(t)}};h([f(Om)],mS.prototype,"color",void 0),h([f(Up)],mS.prototype,"size",void 0),mS=BU=h([k("esri.symbols.support.Symbol3DIconOutline")],mS);var tw;const Vce="esri.symbols.IconSymbol3DLayer";let jd=tw=class extends Zp{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new tw({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||OE,r=tY(t),i=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||OE).clone()}:null;return new tw({size:t.size,resource:{primitive:s$e(t.style)},material:{color:e},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(t){const e=!t.color||DMe(t.color)?OE:t.color,r=tY(t);return new tw({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(t){return new tw({resource:{href:Vne({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function tY(t){const e="width"in t?t.width:t.size,r="height"in t?t.height:t.size,i=rY(t.xoffset),s=rY(t.yoffset);return(i||s)&&e&&r?{x:-i/e,y:s/r}:null}function rY(t){return isFinite(t)?t:0}h([f({type:Sc,json:{write:!0}})],jd.prototype,"material",void 0),h([f({type:x_,json:{write:!0}})],jd.prototype,"resource",void 0),h([Ht({Icon:"icon"},{readOnly:!0})],jd.prototype,"type",void 0),h([f(Up)],jd.prototype,"size",void 0),h([Ht({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),f({json:{default:"center"}})],jd.prototype,"anchor",void 0),h([f({type:Iw,json:{type:[Number],read:{reader:t=>new Iw({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],jd.prototype,"anchorPosition",void 0),h([f({type:mS,json:{write:!0}})],jd.prototype,"outline",void 0),jd=tw=h([k(Vce)],jd);const i$e={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function s$e(t){return i$e[t]||(ne.getLogger(Vce).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const y0=jd;let T_=class extends Lc(st){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],T_.prototype,"type",void 0),h([f({type:RMe,json:{default:"begin-end",write:!0}})],T_.prototype,"placement",void 0),h([f({type:Ece,json:{default:"arrow",write:!0}})],T_.prototype,"style",void 0),h([f({type:qe,json:{type:[Qs],default:null,write:!0}})],T_.prototype,"color",void 0),T_=h([k("esri.symbols.LineStyleMarker3D")],T_);const zU=T_;var jP;let Hd=jP=class extends Zp{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Kh(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new jP(t)}static fromSimpleLineSymbol(t){var r;const e={enabled:!0,size:t.width??Kh(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new aV({style:t.style}):null,material:new Sc({color:(t.color||OE).clone()}),marker:t.marker?new zU({placement:t.marker.placement,style:t.marker.style,color:((r=t.marker.color)==null?void 0:r.clone())??null}):null};return new jP(e)}};h([f({type:Sc,json:{write:!0}})],Hd.prototype,"material",void 0),h([Ht({Line:"line"},{readOnly:!0})],Hd.prototype,"type",void 0),h([f({type:Nce,json:{write:!0,default:"miter"}})],Hd.prototype,"join",void 0),h([f({type:hV,json:{write:!0,default:"butt"}})],Hd.prototype,"cap",void 0),h([f(Up)],Hd.prototype,"size",void 0),h([f(Pce)],Hd.prototype,"pattern",void 0),h([f({types:{key:"type",base:zU,typeMap:{style:zU}},json:{write:!0}})],Hd.prototype,"marker",void 0),Hd=jP=h([k("esri.symbols.LineSymbol3DLayer")],Hd);const U3=Hd;var VU;const n$e=Ic()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let gS=VU=class extends st{clone(){return new VU({href:this.href,primitive:this.primitive})}};h([f({type:String,json:{read:dV,write:tv}})],gS.prototype,"href",void 0),h([Ht(n$e)],gS.prototype,"primitive",void 0),gS=VU=h([k("esri.symbols.support.ObjectSymbol3DLayerResource")],gS);const Gce="sphere";var GU;let e1=GU=class extends xe{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new GU({x:this.x,y:this.y,z:this.z})}};h([f({type:Number})],e1.prototype,"x",void 0),h([f({type:Number})],e1.prototype,"y",void 0),h([f({type:Number})],e1.prototype,"z",void 0),e1=GU=h([k("esri.symbols.support.Symbol3DAnchorPosition3D")],e1);var jU;let ta=jU=class extends Zp{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){var t,e,r;return new jU({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:(t=this.anchorPosition)==null?void 0:t.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:((e=this.material)==null?void 0:e.clone())??null,castShadows:this.castShadows,resource:(r=this.resource)==null?void 0:r.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};h([f({type:Sc,json:{write:!0}})],ta.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ta.prototype,"castShadows",void 0),h([f({type:gS,json:{write:!0}})],ta.prototype,"resource",void 0),h([Ht({Object:"object"},{readOnly:!0})],ta.prototype,"type",void 0),h([f({type:Number,json:{write:!0}})],ta.prototype,"width",void 0),h([f({type:Number,json:{write:!0}})],ta.prototype,"height",void 0),h([f({type:Number,json:{write:!0}})],ta.prototype,"depth",void 0),h([Ht({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),f({json:{default:"origin"}})],ta.prototype,"anchor",void 0),h([f({type:e1,json:{type:[Number],read:{reader:t=>new e1({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],ta.prototype,"anchorPosition",void 0),h([f({type:Number,json:{write:!0}})],ta.prototype,"heading",void 0),h([f({type:Number,json:{write:!0}})],ta.prototype,"tilt",void 0),h([f({type:Number,json:{write:!0}})],ta.prototype,"roll",void 0),h([f({readOnly:!0})],ta.prototype,"isPrimitive",null),ta=jU=h([k("esri.symbols.ObjectSymbol3DLayer")],ta);const pV=ta;var HU;let Ma=HU=class extends Zp{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new HU({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};h([f({type:Sc,json:{write:!0}})],Ma.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ma.prototype,"castShadows",void 0),h([Ht({Path:"path"},{readOnly:!0})],Ma.prototype,"type",void 0),h([f({type:["circle","quad"],json:{write:!0,default:"circle"}})],Ma.prototype,"profile",void 0),h([f({type:Nce,json:{write:!0,default:"miter"}})],Ma.prototype,"join",void 0),h([f({type:qMe,json:{write:!0,default:"butt"}})],Ma.prototype,"cap",void 0),h([f({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Ma.prototype,"width",void 0),h([si("width",["width","size","height"])],Ma.prototype,"readWidth",null),h([f({type:Number,json:{write:!0}})],Ma.prototype,"height",void 0),h([si("height",["height","size","width"])],Ma.prototype,"readHeight",null),h([f({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Ma.prototype,"anchor",void 0),h([f({type:["heading","all"],json:{write:!0,default:"all"}})],Ma.prototype,"profileRotation",void 0),Ma=HU=h([k("esri.symbols.PathSymbol3DLayer")],Ma);const fV=Ma;var qU;let Lw=qU=class extends st{constructor(){super(...arguments),this.color=new qe([0,0,0,1]),this.size=0}clone(){const t={color:ye(this.color),size:this.size};return new qU(t)}};h([f(Om)],Lw.prototype,"color",void 0),h([f(Up)],Lw.prototype,"size",void 0),Lw=qU=h([k("esri.symbols.support.Symbol3DHalo")],Lw);let ME=class extends Lc(st){constructor(e){super(e),this.color=null}};h([f(Om)],ME.prototype,"color",void 0),ME=h([k("esri.symbols.support.Symbol3DTextBackground")],ME);var HP;let ll=HP=class extends Zp{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,r,i){const s={...i,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){var t;return this._userSize!=null?this._userSize:((t=this.font)==null?void 0:t.size)!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new HP({enabled:this.enabled,font:this.font&&ye(this.font),halo:this.halo&&ye(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ye(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new HP({font:t.font!=null?t.font.clone():new vD,halo:o$e(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new Sc({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new ME({color:t.backgroundColor.clone()}):null})}};function o$e(t,e){return t&&e!=null&&e>0?new Lw({color:ye(t),size:e}):null}h([f({type:vD,json:{write:!0}})],ll.prototype,"font",null),h([ni("font")],ll.prototype,"writeFont",null),h([f({type:Lw,json:{write:!0}})],ll.prototype,"halo",void 0),h([f({...Uce,json:{default:"center",write:!0}})],ll.prototype,"horizontalAlignment",void 0),h([f({...Fce,json:{default:1,write:!0}})],ll.prototype,"lineHeight",void 0),h([f({type:Sc,json:{write:!0}})],ll.prototype,"material",void 0),h([f({type:ME,json:{write:!0}})],ll.prototype,"background",void 0),h([f(Up)],ll.prototype,"size",null),h([f({type:String,json:{write:!0}})],ll.prototype,"text",void 0),h([Ht({Text:"text"},{readOnly:!0})],ll.prototype,"type",void 0),h([f({...kce,json:{default:"baseline",write:!0}})],ll.prototype,"verticalAlignment",void 0),ll=HP=h([k("esri.symbols.TextSymbol3DLayer")],ll);const Ev=ll;var WU;let Dg=WU=class extends Zp{constructor(t){super(t),this.color=YU.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new WU({color:ye(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};h([f({type:qe,nonNullable:!0,json:{type:[Qs],write:(t,e,r)=>e[r]=t.toArray(qe.AlphaMode.UNLESS_OPAQUE),default:()=>YU.clone(),defaultEquals:t=>t.toCss(!0)===YU.toCss(!0)}})],Dg.prototype,"color",void 0),h([Ht({Water:"water"},{readOnly:!0})],Dg.prototype,"type",void 0),h([f({type:["small","medium","large"],json:{write:!0,default:"medium"}})],Dg.prototype,"waterbodySize",void 0),h([f({type:Number,json:{write:!0,default:null}})],Dg.prototype,"waveDirection",void 0),h([f({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],Dg.prototype,"waveStrength",void 0),Dg=WU=h([k("esri.symbols.WaterSymbol3DLayer")],Dg);const YU=new qe([0,119,190]),jce=Dg;var XU;let S_=XU=class extends xe{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new XU({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};h([f({type:String})],S_.prototype,"name",void 0),h([f({type:String})],S_.prototype,"styleUrl",void 0),h([f({type:String})],S_.prototype,"styleName",void 0),h([f({type:Au})],S_.prototype,"portal",void 0),S_=XU=h([k("esri.symbols.support.StyleOrigin")],S_);const IC=S_;var ZU;let A1=ZU=class extends xe{constructor(){super(...arguments),this.url=""}clone(){return new ZU({url:this.url})}};h([f({type:String})],A1.prototype,"url",void 0),A1=ZU=h([k("esri.symbols.support.Thumbnail")],A1);const Hce={icon:y0,object:pV,line:U3,path:fV,fill:F3,extrude:Sce,text:Ev,water:jce},a$e=St.ofType({base:Zp,key:"type",typeMap:Hce,errorContext:"symbol-layer"});let qd=class extends Dc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const r=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=r==null?void 0:r.type,s=i||St;this._set("symbolLayers",new s)}get color(){return null}set color(e){this.constructed&&ne.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){V1(e,this._get("symbolLayers"))}readStyleOrigin(e,r,i){if(e.styleUrl&&e.name){const s=ev(e.styleUrl,i);return new IC({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new IC({portal:(i==null?void 0:i.portal)||Au.getDefault(),styleName:e.styleName,name:e.name});i!=null&&i.messages&&i.messages.push(new z1("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,r,i,s){if(e.styleUrl&&e.name){let n=Nx(e.styleUrl,s);wc(n)&&(n=rm(n)),r.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&(s!=null&&s.portal)&&!pSe(e.portal.restUrl,s.portal.restUrl)?s!=null&&s.messages&&s.messages.push(new z1("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):r.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Zp||e&&Hce[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};h([f({json:{read:!1,write:!1}})],qd.prototype,"color",null),h([f({type:a$e,nonNullable:!0,json:{write:!0}}),zi(soe)],qd.prototype,"symbolLayers",null),h([f({type:IC})],qd.prototype,"styleOrigin",void 0),h([si("styleOrigin")],qd.prototype,"readStyleOrigin",null),h([ni("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],qd.prototype,"writeStyleOrigin",null),h([f({type:A1,json:{read:!1}})],qd.prototype,"thumbnail",void 0),h([f({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],qd.prototype,"type",void 0),qd=h([k("esri.symbols.Symbol3D")],qd);const O2=qd;let yS=class extends st{constructor(e){super(e),this.visible=!0}clone(){}};h([f({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],yS.prototype,"type",void 0),h([f({readOnly:!0})],yS.prototype,"visible",void 0),yS=h([k("esri.symbols.callouts.Callout3D")],yS);const qce=yS;var JU;let qP=JU=class extends st{constructor(t){super(t),this.color=new qe("white")}clone(){return new JU({color:ye(this.color)})}};h([f(Om)],qP.prototype,"color",void 0),qP=JU=h([k("esri.symbols.callouts.LineCallout3DBorder")],qP);const l$e=qP;var QU;let Ng=QU=class extends qce{constructor(t){super(t),this.type="line",this.color=new qe([0,0,0,1]),this.size=Kh(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new QU({color:ye(this.color),size:this.size,border:ye(this.border)})}};h([Ht({line:"line"})],Ng.prototype,"type",void 0),h([f(Om)],Ng.prototype,"color",void 0),h([f(Up)],Ng.prototype,"size",void 0),h([f({type:l$e,json:{write:!0}})],Ng.prototype,"border",void 0),h([f({readOnly:!0})],Ng.prototype,"visible",null),Ng=QU=h([k("esri.symbols.callouts.LineCallout3D")],Ng);const Wce=Ng;function mV(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function Yce(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!mV(t)}function gV(t){return t.type==="point-3d"||t.type==="label-3d"}function Xce(t){return t.horizontalAlignment==="center"}const Zce={types:{key:"type",base:qce,typeMap:{line:Wce}},json:{write:!0}};var KU;let rw=KU=class extends st{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new KU({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};h([f(Up)],rw.prototype,"screenLength",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0,default:0}})],rw.prototype,"minWorldLength",void 0),h([f({type:Number,json:{write:!0}})],rw.prototype,"maxWorldLength",void 0),rw=KU=h([k("esri.symbols.support.Symbol3DVerticalOffset")],rw);const yV=rw;var WP;const Jce=St.ofType({base:null,key:"type",typeMap:{text:Ev}});let Fg=WP=class extends O2{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new Jce,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return Yce(this)}hasVisibleVerticalOffset(){return mV(this)}clone(){return new WP({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail),callout:ye(this.callout),verticalOffset:ye(this.verticalOffset)})}static fromTextSymbol(t){return new WP({symbolLayers:new St([Ev.fromTextSymbol(t)])})}};h([f({type:yV,json:{write:!0}})],Fg.prototype,"verticalOffset",void 0),h([f(Zce)],Fg.prototype,"callout",void 0),h([f({json:{read:!1,write:!1}})],Fg.prototype,"styleOrigin",void 0),h([f({type:Jce})],Fg.prototype,"symbolLayers",void 0),h([Ht({LabelSymbol3D:"label-3d"},{readOnly:!0})],Fg.prototype,"type",void 0),Fg=WP=h([k("esri.symbols.LabelSymbol3D")],Fg);const bD=Fg;var YP;const Qce=St.ofType({base:null,key:"type",typeMap:{line:U3,path:fV}}),c$e=St.ofType({base:null,key:"type",typeMap:{line:U3,path:fV}});let _S=YP=class extends O2{constructor(t){super(t),this.symbolLayers=new Qce,this.type="line-3d"}clone(){return new YP({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromSimpleLineSymbol(t){return new YP({symbolLayers:new St([U3.fromSimpleLineSymbol(t)])})}};h([f({type:Qce,json:{type:c$e}})],_S.prototype,"symbolLayers",void 0),h([Ht({LineSymbol3D:"line-3d"},{readOnly:!0})],_S.prototype,"type",void 0),_S=YP=h([k("esri.symbols.LineSymbol3D")],_S);const wD=_S;let Ug=class extends Dc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};h([f({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Ug.prototype,"angle",void 0),h([f({type:["simple-marker","picture-marker"],readOnly:!0})],Ug.prototype,"type",void 0),h([f({type:Number,cast:Rs,json:{write:!0}})],Ug.prototype,"xoffset",void 0),h([f({type:Number,cast:Rs,json:{write:!0}})],Ug.prototype,"yoffset",void 0),h([f({type:Number,cast:t=>t==="auto"?t:Rs(t),json:{write:!0}})],Ug.prototype,"size",void 0),Ug=h([k("esri.symbols.MarkerSymbol")],Ug);const Kce=Ug;var XP;const eue=St.ofType({base:null,key:"type",typeMap:{fill:F3}});let vS=XP=class extends O2{constructor(t){super(t),this.symbolLayers=new eue,this.type="mesh-3d"}clone(){return new XP({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromSimpleFillSymbol(t){return new XP({symbolLayers:new St([F3.fromSimpleFillSymbol(t)])})}};h([f({type:eue})],vS.prototype,"symbolLayers",void 0),h([Ht({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],vS.prototype,"type",void 0),vS=XP=h([k("esri.symbols.MeshSymbol3D")],vS);const xD=vS;function u$e(t,e,r){return e.imageData?Vne({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):tue(e.url,r)}function tue(t,e){var r;return d$e(e)&&!wc(t)&&((r=e==null?void 0:e.layer)!=null&&r.parsedUrl)?GL(e.layer.parsedUrl.path,"images",t):ev(t,e)}function h$e(t,e,r,i){if(qp(t)){const s=B0(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,r&&r.imageData===e.imageData&&r.url&&tv(r.url,e,"url",i)}else tv(t,e,"url",i)}const rue={json:{read:{source:["imageData","url"],reader:u$e},write:{writer(t,e,r,i){h$e(t,e,this.source,i)}}}},iue={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,r){const i={};return e.imageData&&(i.imageData=e.imageData),e.contentType&&(i.contentType=e.contentType),e.url&&(i.url=tue(e.url,r)),i}}}};function d$e(t){var e,r;return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||((e=t.layer)==null?void 0:e.type)!=="feature"&&((r=t.layer)==null?void 0:r.type)!=="stream")}var e9;let Zc=e9=class extends Cce{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),r!=null&&(s.width=Rs(r)),i!=null&&(s.height=Rs(i)),s}clone(){const t=new e9({color:ye(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",ye(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};h([Ht({esriPFS:"picture-fill"},{readOnly:!0})],Zc.prototype,"type",void 0),h([f(rue)],Zc.prototype,"url",void 0),h([f({type:Number,json:{write:!0}})],Zc.prototype,"xscale",void 0),h([f({type:Number,json:{write:!0}})],Zc.prototype,"yscale",void 0),h([f({type:Number,cast:Rs,json:{write:!0}})],Zc.prototype,"width",void 0),h([f({type:Number,cast:Rs,json:{write:!0}})],Zc.prototype,"height",void 0),h([f({type:Number,cast:Rs,json:{write:!0}})],Zc.prototype,"xoffset",void 0),h([f({type:Number,cast:Rs,json:{write:!0}})],Zc.prototype,"yoffset",void 0),h([f(iue)],Zc.prototype,"source",void 0),Zc=e9=h([k("esri.symbols.PictureFillSymbol")],Zc);const sue=Zc;var t9;let lh=t9=class extends Kce{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const i={};return t&&(i.url=t),e!=null&&(i.width=Rs(e)),r!=null&&(i.height=Rs(r)),i}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new t9({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",ye(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};h([f({json:{write:!1}})],lh.prototype,"color",void 0),h([Ht({esriPMS:"picture-marker"},{readOnly:!0})],lh.prototype,"type",void 0),h([f(rue)],lh.prototype,"url",void 0),h([f(iue)],lh.prototype,"source",void 0),h([f({type:Number,cast:Rs,json:{write:!0}})],lh.prototype,"height",void 0),h([si("height",["height","size"])],lh.prototype,"readHeight",null),h([f({type:Number,cast:Rs,json:{write:!0}})],lh.prototype,"width",void 0),h([f({json:{write:!1}})],lh.prototype,"size",void 0),lh=t9=h([k("esri.symbols.PictureMarkerSymbol")],lh);const TD=lh;var E_;const nue=St.ofType({base:null,key:"type",typeMap:{icon:y0,object:pV,text:Ev}});let C_=E_=class extends O2{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new nue,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return Yce(this)}hasVisibleVerticalOffset(){return mV(this)}clone(){return new E_({verticalOffset:ye(this.verticalOffset),callout:ye(this.callout),styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new E_({symbolLayers:new St([y0.fromSimpleMarkerSymbol(t)])})}static fromPictureMarkerSymbol(t){return new E_({symbolLayers:new St([y0.fromPictureMarkerSymbol(t)])})}static fromCIMSymbol(t){var i,s;if(((s=(i=t.data)==null?void 0:i.symbol)==null?void 0:s.type)!=="CIMPointSymbol")return null;const r=t.data.symbol;return new E_(r!=null&&r.callout?{symbolLayers:new St([y0.fromCIMSymbol(t)]),callout:new Wce({size:.5,color:new qe([0,0,0])}),verticalOffset:new yV({screenLength:40})}:{symbolLayers:new St([y0.fromCIMSymbol(t)])})}static fromTextSymbol(t){return new E_({symbolLayers:new St([Ev.fromTextSymbol(t)])})}};h([f({type:yV,json:{write:!0}})],C_.prototype,"verticalOffset",void 0),h([f(Zce)],C_.prototype,"callout",void 0),h([f({type:nue,json:{origins:{"web-scene":{write:!0}}}})],C_.prototype,"symbolLayers",void 0),h([Ht({PointSymbol3D:"point-3d"},{readOnly:!0})],C_.prototype,"type",void 0),C_=E_=h([k("esri.symbols.PointSymbol3D")],C_);const _0=C_;function ae(t,e,r={}){return _V(t,e,r,oue)}function $u(t,e,r={}){return _V(t,e,r,aue)}function _V(t,e,r={},i){let s=null;const n=r.once?(o,a)=>{i(o)&&(di(s),e(o,a))}:(o,a)=>{i(o)&&e(o,a)};if(s=aTe(t,n,r.sync,r.equals),r.initial){const o=t();n(o,o)}return s}function Bo(t,e,r,i={}){let s=null,n=null,o=null;function a(){var u;s&&n&&(n.remove(),(u=i.onListenerRemove)==null||u.call(i,s),s=null,n=null)}function l(u){i.once&&i.once&&di(o),r(u)}const c=ae(t,(u,d)=>{var p;a(),NL(u)&&(s=u,n=b2(u,e,l),(p=i.onListenerAdd)==null||p.call(i,u))},{sync:i.sync,initial:!0});return o=Rr(()=>{c.remove(),a()}),o}function Fx(t,e){return p$e(t,aue,e)}function p$e(t,e,r){if(Ys(r))return Promise.reject(ur());const i=t();if(e!=null&&e(i))return Promise.resolve(i);let s=null;function n(){s=di(s)}return new Promise((o,a)=>{s=U1([Uo(r,()=>{n(),a(ur())}),_V(t,l=>{n(),o(l)},{sync:!1,once:!0},e??oue)])})}function oue(t){return!0}function aue(t){return!!t}function f$e(t,e){const r=new St,i=Bo(t,"after-splice",({added:s,start:n,deleteCount:o})=>{const a=r.splice(n,o);for(const l of a)l.remove();if(s!=null&&s.length){const l=s.map(e);r.addMany(l,n)}},{sync:!0,onListenerRemove:()=>r.drain(s=>s.remove()),onListenerAdd:s=>r.addMany(s.items.map(e))});return r.addHandles(i),r}function zgt(t,e){const r=new St,i=f$e(t,a=>cy(async l=>{const c=await e(a,l);if(Ys(l))throw c.remove(),ur();return c})),s=()=>null,n=async a=>{const l=await a.promise,c=i.indexOf(a);c<0||r.splice(c,1,l)};r.addMany(i.items.map(s));for(const a of i)yC(n(a));const o=i.on("after-splice",({added:a,start:l,deleteCount:c})=>{const u=r.splice(l,c);for(const d of u)d==null||d.remove();if(a!=null&&a.length){r.addMany(a.map(s),l);for(const d of a)yC(n(d))}});return r.addHandles([jse(i),o]),r}const Fr={sync:!0},zr={initial:!0},Br={sync:!0,initial:!0};var bS;const lue=St.ofType({base:null,key:"type",typeMap:{extrude:Sce,fill:F3,icon:y0,line:U3,object:pV,text:Ev,water:jce}});let wS=bS=class extends O2{constructor(t){super(t),this.symbolLayers=new lue,this.type="polygon-3d"}initialize(){const t=e=>{e.type==="line"&&wx(ne.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),e.type==="text"&&wx(ne.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const e of this.symbolLayers)t(e);this.addHandles(Bo(()=>this.symbolLayers,"after-add",({item:e})=>t(e),Fr))}clone(){return new bS({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromJSON(t){var r;const e=new bS;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const i=e.symbolLayers.at(0),s=e.symbolLayers.at(1);!s.enabled||(r=t.symbolLayers)!=null&&r[1]&&t.symbolLayers[1].enable===!1||(i.outline={size:s.size,color:s.material!=null?s.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new bS({symbolLayers:new St([F3.fromSimpleFillSymbol(t)])})}};h([f({type:lue,json:{write:!0}})],wS.prototype,"symbolLayers",void 0),h([Ht({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],wS.prototype,"type",void 0),wS=bS=h([k("esri.symbols.PolygonSymbol3D")],wS);const SD=wS;var r9;const A4=new Pc({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let A_=r9=class extends Cce{constructor(...t){super(...t),this.color=new qe([0,0,0,.25]),this.outline=new xv,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.style=t),e&&(i.outline=e),r&&(i.color=r),i}clone(){return new r9({color:ye(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};h([f()],A_.prototype,"color",void 0),h([f()],A_.prototype,"outline",void 0),h([Ht({esriSFS:"simple-fill"},{readOnly:!0})],A_.prototype,"type",void 0),h([f({type:A4.apiValues,json:{read:A4.read,write:A4.write}})],A_.prototype,"style",void 0),A_=r9=h([k("esri.symbols.SimpleFillSymbol")],A_);const vV=A_;var i9;const R4=new Pc({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Wd=i9=class extends Kce{constructor(...t){super(...t),this.color=new qe([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new xv}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=Rs(e)),r&&(s.outline=r),i&&(s.color=i),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new i9({angle:this.angle,color:ye(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};h([f()],Wd.prototype,"color",void 0),h([ni("color")],Wd.prototype,"writeColor",null),h([Ht({esriSMS:"simple-marker"},{readOnly:!0})],Wd.prototype,"type",void 0),h([f()],Wd.prototype,"size",void 0),h([f({type:R4.apiValues,json:{read:R4.read,write:R4.write}})],Wd.prototype,"style",void 0),h([f({type:String,json:{write:!0}})],Wd.prototype,"path",null),h([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":xv}},json:{default:null,write:!0}})],Wd.prototype,"outline",void 0),Wd=i9=h([k("esri.symbols.SimpleMarkerSymbol")],Wd);const ED=Wd;var s9;let ms=s9=class extends Dc{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new vD,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.text=t),e&&(i.font=e),r&&(i.color=r),i}writeLineWidth(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}castLineWidth(t){return Rs(t)}writeLineHeight(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}clone(){return new s9({angle:this.angle,backgroundColor:ye(this.backgroundColor),borderLineColor:ye(this.borderLineColor),borderLineSize:this.borderLineSize,color:ye(this.color),font:this.font&&this.font.clone(),haloColor:ye(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t,e,r;return`${(t=this.backgroundColor)==null?void 0:t.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(e=this.color)==null?void 0:e.hash()}.${this.font&&this.font.hash()}.${(r=this.haloColor)==null?void 0:r.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};h([f({type:qe,json:{write:!0}})],ms.prototype,"backgroundColor",void 0),h([f({type:qe,json:{write:!0}})],ms.prototype,"borderLineColor",void 0),h([f({type:Number,json:{write:!0},cast:Rs})],ms.prototype,"borderLineSize",void 0),h([f({type:vD,json:{write:!0}})],ms.prototype,"font",void 0),h([f({...Uce,json:{write:!0}})],ms.prototype,"horizontalAlignment",void 0),h([f({type:Boolean,json:{write:!0}})],ms.prototype,"kerning",void 0),h([f({type:qe,json:{write:!0}})],ms.prototype,"haloColor",void 0),h([f({type:Number,cast:Rs,json:{write:!0}})],ms.prototype,"haloSize",void 0),h([f({type:Boolean,json:{write:!0}})],ms.prototype,"rightToLeft",void 0),h([f({type:Boolean,json:{write:!0}})],ms.prototype,"rotated",void 0),h([f({type:String,json:{write:!0}})],ms.prototype,"text",void 0),h([Ht({esriTS:"text"},{readOnly:!0})],ms.prototype,"type",void 0),h([f({...kce,json:{write:!0}})],ms.prototype,"verticalAlignment",void 0),h([f({type:Number,cast:Rs,json:{write:!0}})],ms.prototype,"xoffset",void 0),h([f({type:Number,cast:Rs,json:{write:!0}})],ms.prototype,"yoffset",void 0),h([f({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],ms.prototype,"angle",void 0),h([f({type:Number,json:{write:!0}})],ms.prototype,"width",void 0),h([f({type:Number})],ms.prototype,"lineWidth",void 0),h([ni("lineWidth")],ms.prototype,"writeLineWidth",null),h([zi("lineWidth")],ms.prototype,"castLineWidth",null),h([f(Fce)],ms.prototype,"lineHeight",void 0),h([ni("lineHeight")],ms.prototype,"writeLineHeight",null),ms=s9=h([k("esri.symbols.TextSymbol")],ms);const k3=ms;var n9;let ch=n9=class extends Dc{constructor(t){super(t),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:Au.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new n9({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const r=e!=null?e.cache:null,i=r?this._fetchCacheKey:null;if(r!=null){const a=i&&r.get(i);if(a)return a.clone()}const{resolveWebStyleSymbol:s}=await he(()=>Promise.resolve().then(()=>IQe),void 0,import.meta.url);wt(e);const n=s(this,{portal:this.portal},t,e);n.catch(a=>{ne.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(r!=null&&r.set(i,o.clone()),o):null}};h([f({json:{write:!1}})],ch.prototype,"color",void 0),h([f({type:String,json:{write:!0}})],ch.prototype,"styleName",void 0),h([f({type:Au,json:{write:!1}})],ch.prototype,"portal",void 0),h([f({type:String,json:{read:dV,write:tv}})],ch.prototype,"styleUrl",void 0),h([f({type:A1,json:{read:!1}})],ch.prototype,"thumbnail",void 0),h([f({type:String,json:{write:!0}})],ch.prototype,"name",void 0),h([Ht({styleSymbolReference:"web-style"},{readOnly:!0})],ch.prototype,"type",void 0),h([f()],ch.prototype,"_fetchCacheKey",null),ch=n9=h([k("esri.symbols.WebStyleSymbol")],ch);const P2=ch;function CD(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function rv(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const bV={base:Dc,key:"type",typeMap:{"simple-fill":vV,"picture-fill":sue,"picture-marker":TD,"simple-line":xv,"simple-marker":ED,text:k3,"label-3d":bD,"line-3d":wD,"mesh-3d":xD,"point-3d":_0,"polygon-3d":SD,"web-style":P2,cim:N3},errorContext:"symbol"},Vgt={base:Dc,key:"type",typeMap:{"picture-marker":TD,"simple-marker":ED,text:k3,"web-style":P2,cim:N3},errorContext:"symbol"},m$e=Tne({types:bV}),Ggt={base:Dc,key:"type",typeMap:{"simple-fill":vV,"picture-fill":sue,"picture-marker":TD,"simple-line":xv,"simple-marker":ED,text:k3,"line-3d":wD,"mesh-3d":xD,"point-3d":_0,"polygon-3d":SD,"web-style":P2,cim:N3},errorContext:"symbol"},jgt={base:Dc,key:"type",typeMap:{text:k3,"label-3d":bD},errorContext:"symbol"},Hgt={base:Dc,key:"type",typeMap:{"line-3d":wD,"mesh-3d":xD,"point-3d":_0,"polygon-3d":SD,"web-style":P2,cim:N3},errorContext:"symbol"},qgt={base:Dc,key:"type",typeMap:{"label-3d":bD},errorContext:"symbol"},Wgt=k0(bV);var o9;function g$e(t){if(!t)return null;const e={};for(const r in t){const i=$x(t[r]);i&&(e[r]=i)}return Object.keys(e).length!==0?e:null}function y$e(t){if(t==null)return null;const e={};for(const r in t){const i=t[r];i&&(e[r]=i.toJSON())}return Object.keys(e).length!==0?e:null}let cl=o9=class extends Lc(st){constructor(...t){super(...t),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:bc(),configurable:!0})}normalizeCtorArgs(t,e,r,i){return t&&!t.declaredClass?t:{geometry:t,symbol:e,attributes:r,popupTemplate:i}}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new o9({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;for(const e of[this.sourceLayer,this.layer])if(e){if("popupTemplate"in e&&e.popupTemplate)return e.popupTemplate;if(t&&"defaultPopupTemplate"in e&&e.defaultPopupTemplate!=null)return e.defaultPopupTemplate}return null}getAttribute(t){var e;return(e=this.attributes)==null?void 0:e[t]}setAttribute(t,e){if(this.attributes){const r=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",r,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){var t;return{aggregateGeometries:y$e(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:h8(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:((t=this.popupTemplate)==null?void 0:t.toJSON())??null}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if((e==null?void 0:e.type)==="mesh"){const r={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",r,r,t.action)}}_notifyLayer(t,e,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:t,oldValue:e,newValue:r};t==="origin-transform"&&(s.action=i),t==="attributes"&&(s.attributeName=i),this.layer.graphicChanged(s)}};h([f({value:null,json:{read:g$e}})],cl.prototype,"aggregateGeometries",null),h([f({value:null})],cl.prototype,"attributes",null),h([f({value:null,types:V7,json:{read:$x}})],cl.prototype,"geometry",null),h([f({type:Boolean})],cl.prototype,"isAggregate",void 0),h([f({clonable:"reference"})],cl.prototype,"layer",void 0),h([f({type:wMe})],cl.prototype,"popupTemplate",void 0),h([f({clonable:"reference"})],cl.prototype,"sourceLayer",void 0),h([f({value:null,types:bV})],cl.prototype,"symbol",null),h([f({type:Boolean,value:!0})],cl.prototype,"visible",null),cl=o9=h([k("esri.Graphic")],cl),function(t){t.generateUID=bc}(cl||(cl={}));const iv=cl;var a9;let kg=a9=class extends st{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new a9({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function O4(){return{enabled:!this.camera}}h([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:O4}}}}})],kg.prototype,"rotation",void 0),h([zi("rotation")],kg.prototype,"castRotation",null),h([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:O4}}}}})],kg.prototype,"scale",void 0),h([f({types:V7,json:{read:$x,write:!0,origins:{"web-scene":{read:$x,write:{overridePolicy:O4}}}}})],kg.prototype,"targetGeometry",void 0),h([f({type:Il,json:{write:!0}})],kg.prototype,"camera",void 0),kg=a9=h([k("esri.Viewpoint")],kg);const id=kg;function AD(t){return typeof t=="string"?document.getElementById(t):t??null}function cue(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function iY(t,e){const r=e.parentNode;r&&r.insertBefore(t,e)}function sY(t,e){for(;;){const r=t.firstChild;if(!r)break;e.appendChild(r)}}let Z$=class{constructor(e=r=>r.values().next().value){this._peeker=e,this._observable=new E3,this._items=new Set}get length(){return xt(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return xt(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const r=this.length;return this._items.forEach(i=>{e(i)||this._items.delete(i)}),r!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){xt(this._observable),yield*this._items}};const uue=new FinalizationRegistry(t=>{t.close()});function _$e(t,e){uue.register(t,e,e)}function v$e(t){uue.unregister(t)}const b$e={statsWorker:()=>he(()=>import("./statsWorker-f6254fe1.js"),["./statsWorker-f6254fe1.js","./utils-886070e6.js","./heatmapUtils-2351b1fb.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js"],import.meta.url),geometryEngineWorker:()=>he(()=>import("./geometryEngineWorker-450d8455.js"),["./geometryEngineWorker-450d8455.js","./geometryEngineJSON-6db1e989.js","./geometryEngineBase-28832c3f.js","./json-48e3ea08.js"],import.meta.url),CSVSourceWorker:()=>he(()=>import("./CSVSourceWorker-5f3e3471.js"),["./CSVSourceWorker-5f3e3471.js","./date-294ce3fb.js","./json-48e3ea08.js","./FeatureStore-2c50987b.js","./BoundsStore-4bb1f6f0.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./QueryEngine-161e756d.js","./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./UnknownTimeZone-ab7c6b01.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-886070e6.js","./heatmapUtils-2351b1fb.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js","./FieldsIndex-6b49ca64.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./number-824ff93f.js","./clientSideDefaults-3df88923.js","./defaultsJSON-59981e75.js"],import.meta.url),EdgeProcessingWorker:()=>he(()=>import("./EdgeProcessingWorker-ddac393a.js"),[],import.meta.url),ElevationSamplerWorker:()=>he(()=>import("./ElevationSamplerWorker-83e68398.js"),["./ElevationSamplerWorker-83e68398.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js"],import.meta.url),FeatureServiceSnappingSourceWorker:()=>he(()=>import("./FeatureServiceSnappingSourceWorker-93e90711.js"),["./FeatureServiceSnappingSourceWorker-93e90711.js","./FeatureStore-2c50987b.js","./BoundsStore-4bb1f6f0.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./QueryEngine-161e756d.js","./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./UnknownTimeZone-ab7c6b01.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-886070e6.js","./heatmapUtils-2351b1fb.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js","./FieldsIndex-6b49ca64.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./Query-8ec96004.js","./ElevationInfo-1c41bf4e.js","./symbologySnappingCandidates-9e1875c8.js","./pbfQueryUtils-13f6e3b7.js","./pbf-16158dc0.js","./query-0260ec48.js","./queryZScale-f8e7b210.js"],import.meta.url),GeoJSONSourceWorker:()=>he(()=>import("./GeoJSONSourceWorker-706c1ca7.js"),["./GeoJSONSourceWorker-706c1ca7.js","./FeatureStore-2c50987b.js","./BoundsStore-4bb1f6f0.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./QueryEngine-161e756d.js","./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./UnknownTimeZone-ab7c6b01.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-886070e6.js","./heatmapUtils-2351b1fb.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js","./FieldsIndex-6b49ca64.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./geojson-7adc8288.js","./date-294ce3fb.js","./clientSideDefaults-3df88923.js","./defaultsJSON-59981e75.js","./sourceUtils-226e0e6c.js"],import.meta.url),LercWorker:()=>he(()=>import("./LercWorker-02f0cae2.js"),[],import.meta.url),MemorySourceWorker:()=>he(()=>import("./MemorySourceWorker-95368494.js"),["./MemorySourceWorker-95368494.js","./objectIdUtils-789e911a.js","./FeatureStore-2c50987b.js","./BoundsStore-4bb1f6f0.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./QueryEngine-161e756d.js","./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./UnknownTimeZone-ab7c6b01.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-886070e6.js","./heatmapUtils-2351b1fb.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js","./FieldsIndex-6b49ca64.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./clientSideDefaults-3df88923.js","./defaultsJSON-59981e75.js","./sourceUtils-226e0e6c.js","./date-294ce3fb.js"],import.meta.url),PBFDecoderWorker:()=>he(()=>import("./PBFDecoderWorker-db9d7be3.js"),["./PBFDecoderWorker-db9d7be3.js","./pbfQueryUtils-13f6e3b7.js","./pbf-16158dc0.js"],import.meta.url),Pipeline:()=>he(()=>import("./Pipeline-9d6cf83f.js").then(t=>t.P),["./Pipeline-9d6cf83f.js","./QueryEngine-161e756d.js","./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./UnknownTimeZone-ab7c6b01.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-886070e6.js","./heatmapUtils-2351b1fb.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js","./FieldsIndex-6b49ca64.js","./StreamFeatureManager-5d1a3f88.js","./quickselect-29477ff4.js","./diffUtils-ef6bbcbf.js","./labelPoint-773cc97e.js","./ogcFeatureUtils-1801816f.js","./geojson-7adc8288.js","./date-294ce3fb.js","./clientSideDefaults-3df88923.js","./defaultsJSON-59981e75.js","./query-0260ec48.js","./pbfQueryUtils-13f6e3b7.js","./pbf-16158dc0.js","./queryZScale-f8e7b210.js","./Query-8ec96004.js","./createConnection-f9d069f8.js","./definitions-f7ca1c70.js","./enums-9d4f5c11.js","./number-e491b09e.js","./geohashUtils-77d8429b.js"],import.meta.url),PointCloudWorker:()=>he(()=>import("./PointCloudWorker-001d90d9.js"),["./PointCloudWorker-001d90d9.js","./PointCloudWorkerUtil-86251cf0.js","./PointCloudUniqueValueRenderer-0553c837.js","./ColorStop-2602b4bf.js","./I3SBinaryReader-ee1cba0c.js"],import.meta.url),RasterWorker:()=>he(()=>import("./RasterWorker-1af216e2.js"),["./RasterWorker-1af216e2.js","./dataUtils-c372502d.js","./utils-24e81baf.js","./colorRamps-b2150d6f.js","./rasterProjectionHelper-369cade9.js"],import.meta.url),SceneLayerSnappingSourceWorker:()=>he(()=>import("./SceneLayerSnappingSourceWorker-b0df4c9d.js"),[],import.meta.url),SceneLayerWorker:()=>he(()=>import("./SceneLayerWorker-64d93102.js").then(t=>t.S),["./SceneLayerWorker-64d93102.js","./I3SNode-4775f644.js"],import.meta.url),WFSSourceWorker:()=>he(()=>import("./WFSSourceWorker-4edbd2a4.js"),["./WFSSourceWorker-4edbd2a4.js","./FeatureStore-2c50987b.js","./BoundsStore-4bb1f6f0.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./QueryEngine-161e756d.js","./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./UnknownTimeZone-ab7c6b01.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-886070e6.js","./heatmapUtils-2351b1fb.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js","./FieldsIndex-6b49ca64.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./geojson-7adc8288.js","./date-294ce3fb.js","./sourceUtils-226e0e6c.js","./wfsUtils-c810e398.js","./xmlUtils-444cb4c0.js"],import.meta.url),WorkerTileHandler:()=>he(()=>import("./WorkerTileHandler-c9da6fea.js"),["./WorkerTileHandler-c9da6fea.js","./TileClipper-ae6eca9e.js","./StyleRepository-7a215e42.js","./definitions-f7ca1c70.js","./Rect-98da58d6.js","./pbf-16158dc0.js","./TurboLine-30969663.js","./BidiEngine-9a40f2f4.js"],import.meta.url)};var lo;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(lo||(lo={}));let w$e=0;function hue(){return w$e++}function x$e(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function LC(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function wV(t,e,r,i){if(e.type===lo.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==lo.INVOKE&&e.type!==lo.RESPONSE)return void t.postMessage(e);let s;if(x$e(r)?(s=nY(r.transferList),e.data=r.result):(s=nY(i),e.data=r),s){if(te("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case lo.INVOKE:throw o;case lo.RESPONSE:return void wV(t,{type:lo.RESPONSE,jobId:e.jobId,error:LC(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function DC(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function nY(t){if(!(t!=null&&t.length))return null;if(te("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(r=>!T$e(r));return e.length?e:null}function T$e(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="ArrayBuffer"}const{CLOSE:oY,ABORT:aY,INVOKE:lY,RESPONSE:iT,OPEN_PORT:cY,ON:S$e}=lo,E$e=2;let C$e=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===lo.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},q0=class iw{static connect(e){const r=new MessageChannel;let i;i=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const s=new iw(r.port1,{channel:r,client:i});return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=s),iw.clients.set(s,i),r.port2}static loadWorker(e){const r=b$e[e];return r?r():Promise.resolve(null)}constructor(e,r,i){this._port=e,this._jobQueue=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new C$e(s=>this._onInvokeMessage(s)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:oY}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,r,i){const s=i==null?void 0:i.signal,n=i==null?void 0:i.transferList;if(!this._port)return Promise.reject(new X("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:r}));const o=hue();return new Promise((a,l)=>{if(Ys(s))return this._processWork(),void l(ur());const c=Uo(s,()=>{const d=this._outJobs.get(o);d&&(this._outJobs.delete(o),this._processWork(),di(d.abortHandle),this._post({type:aY,jobId:o}),l(ur()))}),u={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:lY,jobId:o,methodName:e,abortable:s!=null},r,n)})}on(e,r){const i=new MessageChannel;function s(n){r(n.data)}return this._port.postMessage({type:lo.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",s),i.port1.start(),Rr(()=>{i.port1.postMessage({type:lo.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",s)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:cY,port:e.port2}),e.port1}_processWork(){var o;if(this._outJobs.size>=E$e)return;const e=(o=this._jobQueue)==null?void 0:o.pop();if(!e)return;const{methodName:r,data:i,invokeOptions:s,resolver:n}=e;this.invoke(r,i,s).then(a=>n.resolve(a)).catch(a=>n.reject(a))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{di(e.abortHandle),e.reject(ur(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const r=DC(e);if(r)switch(r.type){case iT:this._onResponseMessage(r);break;case lY:this._invokeQueue.push(r);break;case aY:this._onAbortMessage(r);break;case oY:this._onCloseMessage();break;case cY:this._onOpenPortMessage(r);break;case S$e:this._onOnMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),r.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&iw.clients.get(this)===e&&e.destroy(),iw.clients.delete(this),e!=null&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,u=c[r];try{if(!u&&r&&r.includes(".")){const d=r.split(".");for(let p=0;p<d.length-1;p++)c=c[d[p]],u=c[d[p+1]]}if(typeof u!="function")throw new TypeError(`${r} is not a function`);l=u.call(c,s,{client:this,signal:o?o.signal:null})}catch(d){return void this._post({type:iT,jobId:i,error:LC(d)})}Fl(l)?(a.set(i,{controller:o,promise:l}),l.then(d=>{a.has(i)&&(a.delete(i),this._post({type:iT,jobId:i},d))},d=>{a.has(i)&&(a.delete(i),Os(d)||this._post({type:iT,jobId:i,error:LC(d||{message:`Error encountered at method ${r}`})}))})):this._post({type:iT,jobId:i},l)}_onOpenPortMessage(e){new iw(e.port,{client:this._client})}_onOnMessage(e){const{port:r}=e,i=this._client.on(e.eventType,n=>{r.postMessage(n)}),s=b2(e.port,"message",n=>{const o=DC(n);(o==null?void 0:o.type)===lo.CLOSE&&(s.remove(),i.remove(),r.close())})}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs;if(!n.has(r))return;const o=n.get(r);n.delete(r),this._processWork(),di(o.abortHandle),i?o.reject(X.fromJSON(JSON.parse(i))):o.resolve(s)}_post(e,r,i){return wV(this._port,e,r,i)}};q0.kernelInfo={buildDate:Yne,fullVersion:n7,revision:Xne},q0.clients=new Map;let A$e=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new Z$}destroy(){this.close()}get closed(){var e;return!((e=this._clients)!=null&&e.length)}open(e,r){return new Promise((i,s)=>{let n=!0;const o=a=>{wt(r.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];Fl(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new q0(c,r,this._ongoingJobsQueue),o(i),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new q0(l,r,this._ongoingJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(e,r,i){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a==null?void 0:a.invoke(e,r,i))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(ur(`Worker closing, aborting job calling '${e.methodName}'`));for(const r of this._clientPromises)r.then(i=>i==null?void 0:i.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,v$e(this)}invoke(e,r,i){let s;Array.isArray(i)?(ne.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:i}):s=i;const n=Go();this._ongoingJobsQueue.push({methodName:e,data:r,invokeOptions:s,resolver:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l==null?void 0:l.jobAdded())}return n.promise}on(e,r){return Promise.all(this._clientPromises).then(()=>U1(this._clients.map(i=>i.on(e,r))))}openPorts(){return new Promise(e=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(r[s]=n.openPort()),--i==0&&e(r)})})}get test(){return{numClients:this._clients.length}}};const R$e={async request(t,e){var o,a;const r=t.options,i=r.responseType;r.signal=e==null?void 0:e.signal,r.responseType=i==="native"||i==="native-request-init"?"native-request-init":i&&["blob","json","text"].includes(i)&&((o=zne(t.url))!=null&&o.after)?i:"array-buffer";const s=await Hi(t.url,r),n={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch((a=s.requestOptions)==null?void 0:a.responseType){case"native-request-init":return delete n.data.signal,n;case"blob":n.data=await n.data.arrayBuffer();break;case"json":n.data=new TextEncoder().encode(JSON.stringify(n.data)).buffer;break;case"text":n.data=new TextEncoder().encode(n.data).buffer}return{result:n,transferList:[n.data]}}},O$e={};function P$e(t){var r;const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:((r=t.packages)==null?void 0:r.concat())||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=O$e.baseUrl),e}let M$e=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>e[r](...i)})}},ZP=class{constructor(){this._dispatcher=new M$e,this._workerPostMessage({type:lo.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){xx(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,r,i){this._dispatcher.addEventListener(e,r,i)}removeEventListener(e,r,i){this._dispatcher.removeEventListener(e,r,i)}_workerPostMessage(e){xx(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const r=DC(e);if(r&&r.type===lo.OPEN){const{modulePath:i,jobId:s}=r;let n=await q0.loadWorker(i);n||(n=await he(()=>import(i),[],import.meta.url));const o=q0.connect(n);this._workerPostMessage({type:lo.OPENED,jobId:s,data:o})}}};const l9=ne.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:$$e}=lo,I$e='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let jA,HA;const uY="Failed to create Worker. Fallback to execute module in main thread";async function L$e(){if(!te("esri-workers"))return hY(new ZP);if(!jA&&!HA)try{const e=I$e.split('"{CONFIGURATION}"').join(`'${D$e()}'`);jA=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){HA=e||{}}let t;if(jA)try{t=new Worker(jA,{name:"esri-worker-"+N$e++})}catch{l9.warn(uY,HA),t=new ZP}else l9.warn(uY,HA),t=new ZP;return hY(t)}async function hY(t){return new Promise(e=>{function r(s){const n=DC(s);n&&n.type===$$e&&(t.removeEventListener("message",r),t.removeEventListener("error",i),e(t))}function i(s){s.preventDefault(),t.removeEventListener("message",r),t.removeEventListener("error",i),l9.warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new ZP).addEventListener("message",r),t.addEventListener("error",i)}t.addEventListener("message",r),t.addEventListener("error",i)})}function D$e(){let t;if(kr.default!=null){const s={...kr};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(kr));t.assetsPath=dc(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?dc(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=xc(),t.has={"esri-csp-restrictions":te("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":te("esri-2d-update-debug"),"esri-2d-log-updating":te("esri-2d-log-updating"),"featurelayer-pbf":te("featurelayer-pbf"),"featurelayer-simplify-thresholds":te("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":te("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":te("featurelayer-simplify-mobile-factor"),"esri-atomics":te("esri-atomics"),"esri-shared-array-buffer":te("esri-shared-array-buffer"),"esri-tiles-debug":te("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":te("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":te("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=dc(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=dc(t.workers.workerPath):t.workers.workerPath=dc(ei("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=kr.workers.loaderConfig,r=P$e({baseUrl:e==null?void 0:e.baseUrl,locale:xc(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:r,kernelInfo:{buildDate:Yne,fullVersion:n7,revision:Xne}})}let N$e=0;const{ABORT:dY,INVOKE:F$e,OPEN:U$e,OPENED:k$e,RESPONSE:sT}=lo;let B$e=class due{static async create(e){const r=await L$e();return new due(r,e)}constructor(e,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=r,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",i=>{i.preventDefault(),ne.getLogger("esri.core.workers.WorkerOwner").error(i)})}terminate(){this.worker.terminate()}async open(e,r={}){const{signal:i}=r,s=hue();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:UL(i,()=>{this._outJobs.delete(s),this._post({type:dY,jobId:s})})};this._outJobs.set(s,a),this._post({type:U$e,jobId:s,modulePath:e})})}_onMessage(e){const r=DC(e);if(r)switch(r.type){case k$e:this._onOpenedMessage(r);break;case sT:this._onResponseMessage(r);break;case dY:this._onAbortMessage(r);break;case F$e:this._onInvokeMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);s&&(s.controller&&s.controller.abort(),r.delete(i))}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=R$e[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(u){return void this._post({type:sT,jobId:i,error:LC(u)})}Fl(c)?(a.set(i,{controller:o,promise:c}),c.then(u=>{a.has(i)&&(a.delete(i),this._post({type:sT,jobId:i},u))},u=>{a.has(i)&&(a.delete(i),u||(u={message:"Error encountered at method"+r}),Os(u)||this._post({type:sT,jobId:i,error:LC(u||{message:`Error encountered at method ${r}`})}))})):this._post({type:sT,jobId:i},c)}_onOpenedMessage(e){const{jobId:r,data:i}=e,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),di(s.abortHandle),s.resolve(i))}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),di(n.abortHandle),i?n.reject(X.fromJSON(JSON.parse(i))):n.resolve(s))}_post(e,r,i){return wV(this.worker,e,r,i)}};const pY=te("host-browser")?Math.min(navigator.hardwareConcurrency-1,te("workers-pool-size")):0;let f1=te("esri-mobile")?Math.min(pY,3):pY;f1||(f1=te("safari")&&te("mac")?7:2);let fY=0;const JP=[];function z$e(){pue()}async function qA(t,e){const r=new A$e,{registryTarget:i,...s}=e;return await r.open(t,s),i&&_$e(i,r),r}async function V$e(t,e={}){if(typeof t!="string")throw new X("workers:undefined-module","modulePath is missing");let r=e.strategy||"distributed";if(te("host-webworker")&&!te("esri-workers")&&(r="local"),r==="local"){let i=await q0.loadWorker(t);i||(i=await he(()=>import(t),[],import.meta.url)),wt(e.signal);const s=e.client||i;return qA([q0.connect(i)],{...e,client:s})}if(await pue(),wt(e.signal),r==="dedicated"){const i=fY++%f1;return qA([await JP[i].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const i=Math.min(e.maxNumWorkers,f1);if(i<f1){const s=new Array(i);for(let n=0;n<i;++n){const o=fY++%f1;s[n]=JP[o].open(t,e)}return qA(s,e)}}return qA(JP.map(i=>i.open(t,e)),e)}let WA=null;async function pue(){if(WA)return WA;new AbortController;const t=[];for(let e=0;e<f1;e++){const r=B$e.create(e).then(i=>(JP[e]=i,i));t.push(r)}return WA=Promise.all(t),WA}let $E=class extends St{constructor(e){super(e),this.addHandles([this.on("before-add",r=>{r.item==null&&r.preventDefault()}),this.on("after-add",r=>this._own(r.item)),this.on("after-remove",r=>this._release(r.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(St.ofType(this.itemType.Type))(e):new St(e)}};function c9(t,e){return{type:t,cast:soe,set(r){const i=V1(r,this._get(e),t);i.owner=this,this._set(e,i)}}}h([f()],$E.prototype,"owner",null),$E=h([k("esri.core.support.OwningCollection")],$E);var xS;const J$=Ic()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),fue=J$.jsonValues.slice();gC(fue,"orthometric");const IE=Ic()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let uh=xS=class extends st{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,r){return J$.write(t,e,r)}readHeightModel(t,e,r){return J$.read(t)||(r!=null&&r.messages&&r.messages.push(G$e(t,{context:r})),null)}readHeightUnit(t,e,r){return IE.read(t)||(r!=null&&r.messages&&r.messages.push(mY(t,{context:r})),null)}readHeightUnitService(t,e,r){return yoe(t)||IE.read(t)||(r!=null&&r.messages&&r.messages.push(mY(t,{context:r})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new xS({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const r=CEe(e);return new xS({heightModel:t.heightModel,heightUnit:r,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new xS;return e.read(t,{origin:"web-scene"}),e}};function mY(t,e){return new z1("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function G$e(t,e){return new z1("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}h([f({type:J$.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:fue,default:"ellipsoidal"}}}})],uh.prototype,"heightModel",void 0),h([ni("web-scene","heightModel")],uh.prototype,"writeHeightModel",null),h([si(["web-scene","service"],"heightModel")],uh.prototype,"readHeightModel",null),h([f({type:IE.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:IE.jsonValues,write:IE.write}}}})],uh.prototype,"heightUnit",void 0),h([si("web-scene","heightUnit")],uh.prototype,"readHeightUnit",null),h([si("service","heightUnit")],uh.prototype,"readHeightUnitService",null),h([f({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],uh.prototype,"vertCRS",void 0),h([si("service","vertCRS",["vertCRS","ellipsoid","geoid"])],uh.prototype,"readVertCRS",null),uh=xS=h([k("esri.geometry.HeightModelInfo")],uh);const B3=uh,e0t=Math.PI/180,t0t=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,Km=mr.radius,Xu=mr.eccentricitySquared,j$e={a1:Km*Xu,a2:Km*Xu*Km*Xu,a3:Km*Xu*Xu/2,a4:Km*Xu*Km*Xu*2.5,a5:Km*Xu+Km*Xu*Xu/2,a6:1-Xu},r0t={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:mr.radius,f:mr.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:gm.radius,f:gm.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Ep.radius,f:Ep.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Ep.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};var W;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(W||(W={}));const Dw={[W.WGS84]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:wi,[W.WGS84_COMPARABLE_LON_LAT]:wi,[W.SPHERICAL_ECEF]:b0,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:Ux,[W.PLATE_CARREE]:v0,[W.WGS84]:wi,[W.WGS84_ECEF]:x0},[W.CGCS2000]:{[W.CGCS2000]:wi,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:wi,[W.WGS84_COMPARABLE_LON_LAT]:wi,[W.SPHERICAL_ECEF]:b0,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:v0,[W.WGS84]:null,[W.WGS84_ECEF]:x0},[W.GCSMARS2000]:{[W.CGCS2000]:null,[W.GCSMARS2000]:wi,[W.GCSMOON2000]:null,[W.LON_LAT]:wi,[W.WGS84_COMPARABLE_LON_LAT]:null,[W.SPHERICAL_ECEF]:null,[W.SPHERICAL_MARS_PCPF]:h9,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:null,[W.WGS84]:null,[W.WGS84_ECEF]:null},[W.GCSMOON2000]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:wi,[W.LON_LAT]:wi,[W.WGS84_COMPARABLE_LON_LAT]:null,[W.SPHERICAL_ECEF]:null,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:u9,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:null,[W.WGS84]:null,[W.WGS84_ECEF]:null},[W.WEB_MERCATOR]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:R1,[W.WGS84_COMPARABLE_LON_LAT]:R1,[W.SPHERICAL_ECEF]:gue,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:wi,[W.PLATE_CARREE]:_ue,[W.WGS84]:R1,[W.WGS84_ECEF]:yue},[W.WGS84_ECEF]:{[W.CGCS2000]:T0,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:T0,[W.WGS84_COMPARABLE_LON_LAT]:T0,[W.SPHERICAL_ECEF]:wue,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:xue,[W.PLATE_CARREE]:H$e,[W.WGS84]:T0,[W.WGS84_ECEF]:wi},[W.SPHERICAL_ECEF]:{[W.CGCS2000]:w0,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:w0,[W.WGS84_COMPARABLE_LON_LAT]:w0,[W.SPHERICAL_ECEF]:wi,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:vue,[W.PLATE_CARREE]:q$e,[W.WGS84]:w0,[W.WGS84_ECEF]:bue},[W.SPHERICAL_MARS_PCPF]:{[W.CGCS2000]:null,[W.GCSMARS2000]:p9,[W.GCSMOON2000]:null,[W.LON_LAT]:p9,[W.WGS84_COMPARABLE_LON_LAT]:null,[W.SPHERICAL_ECEF]:null,[W.SPHERICAL_MARS_PCPF]:wi,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:null,[W.WGS84]:null,[W.WGS84_ECEF]:null},[W.SPHERICAL_MOON_PCPF]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:d9,[W.LON_LAT]:d9,[W.WGS84_COMPARABLE_LON_LAT]:null,[W.SPHERICAL_ECEF]:null,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:wi,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:null,[W.WGS84]:null,[W.WGS84_ECEF]:null},[W.UNKNOWN]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:null,[W.WGS84_COMPARABLE_LON_LAT]:null,[W.SPHERICAL_ECEF]:null,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:wi,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:null,[W.WGS84]:null,[W.WGS84_ECEF]:null},[W.LON_LAT]:{[W.CGCS2000]:wi,[W.GCSMARS2000]:wi,[W.GCSMOON2000]:wi,[W.LON_LAT]:wi,[W.WGS84_COMPARABLE_LON_LAT]:wi,[W.SPHERICAL_ECEF]:b0,[W.SPHERICAL_MARS_PCPF]:h9,[W.SPHERICAL_MOON_PCPF]:u9,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:Ux,[W.PLATE_CARREE]:v0,[W.WGS84]:wi,[W.WGS84_ECEF]:x0},[W.WGS84_COMPARABLE_LON_LAT]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:wi,[W.WGS84_COMPARABLE_LON_LAT]:wi,[W.SPHERICAL_ECEF]:b0,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:v0,[W.WGS84]:wi,[W.WGS84_ECEF]:x0},[W.PLATE_CARREE]:{[W.CGCS2000]:m1,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:m1,[W.WGS84_COMPARABLE_LON_LAT]:m1,[W.SPHERICAL_ECEF]:W$e,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:Y$e,[W.PLATE_CARREE]:wi,[W.WGS84]:m1,[W.WGS84_ECEF]:X$e}};function mue(t){const e=NC(t,Sue);return Dw[e][W.WGS84_COMPARABLE_LON_LAT]}function xV(t,e,r=Tue()){return t==null||e==null?null:J$e(t,e,r).projector}function i0t(t,e){switch(xV(t,e,CV)){case wi:return"copy3";case b0:return"wgs84ToSphericalECEF";case Ux:return"wgs84ToWebMercator";case v0:return"wgs84ToPlateCarree";case x0:return"wgs84ToWGS84ECEF";case R1:return"webMercatorToWGS84";case gue:return"webMercatorToSphericalECEF";case yue:return"webMercatorToWGS84ECEF";case _ue:return"webMercatorToPlateCarree";case T0:return"wgs84ECEFToWGS84";case wue:return"wgs84ECEFToSphericalECEF";case xue:return"wgs84ECEFToWebMercator";case w0:return"sphericalECEFToWGS84";case vue:return"sphericalECEFToWebMercator";case p9:return"sphericalMarsPCPFToMars2000";case d9:return"sphericalMoonPCPFToMoon2000";case bue:return"sphericalECEFToWGS84ECEF";case h9:return"mars2000ToSphericalPCPF";case u9:return"moon2000ToSphericalPCPF";default:return null}}function NC(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=qo(t,1)),C$(t)?e.spatialReferenceId=W.SPHERICAL_ECEF:EC(t)?e.spatialReferenceId=W.WGS84:G1(t)?e.spatialReferenceId=W.WEB_MERCATOR:d7(t)?e.spatialReferenceId=W.PLATE_CARREE:t.wkt===foe.wkt?e.spatialReferenceId=W.WGS84_ECEF:t.wkid===_u.CGCS2000?e.spatialReferenceId=W.CGCS2000:t.wkt===HL.wkt?e.spatialReferenceId=W.SPHERICAL_MARS_PCPF:t.wkt===qL.wkt?e.spatialReferenceId=W.SPHERICAL_MOON_PCPF:Wp(t)?e.spatialReferenceId=W.GCSMARS2000:Yp(t)?e.spatialReferenceId=W.GCSMOON2000:e.spatialReferenceId=W.UNKNOWN):W.UNKNOWN}function wi(t,e,r,i){t!==r&&(r[i++]=t[e++],r[i++]=t[e++],r[i]=t[e])}function R1(t,e,r,i){r[i++]=Bx*(t[e++]/mr.radius),r[i++]=Bx*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/mr.radius))),r[i]=t[e]}function gue(t,e,r,i){R1(t,e,r,i),b0(r,i,r,i)}function yue(t,e,r,i){R1(t,e,r,i),x0(r,i,r,i)}function TV(t,e,r,i,s){const n=.4999999*Math.PI,o=me(kx*t[e+1],-n,n),a=Math.sin(o);r[i++]=kx*t[e]*s.radius,r[i++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=t[e+2]}function Ux(t,e,r,i){TV(t,e,r,i,mr)}const gY=mr.radius*Math.PI/180,yY=180/(mr.radius*Math.PI);function v0(t,e,r,i){r[i]=t[e]*gY,r[i+1]=t[e+1]*gY,r[i+2]=t[e+2]}function m1(t,e,r,i){r[i]=t[e]*yY,r[i+1]=t[e+1]*yY,r[i+2]=t[e+2]}function _ue(t,e,r,i){R1(t,e,r,i),v0(r,i,r,i)}function H$e(t,e,r,i){T0(t,e,r,i),v0(r,i,r,i)}function q$e(t,e,r,i){w0(t,e,r,i),v0(r,i,r,i)}function W$e(t,e,r,i){m1(t,e,r,i),b0(r,i,r,i)}function Y$e(t,e,r,i){m1(t,e,r,i),Ux(r,i,r,i)}function X$e(t,e,r,i){m1(t,e,r,i),x0(r,i,r,i)}function SV(t,e,r,i,s){const n=s+t[e+2],o=kx*t[e+1],a=kx*t[e],l=Math.cos(o);r[i++]=Math.cos(a)*l*n,r[i++]=Math.sin(a)*l*n,r[i]=Math.sin(o)*n}function u9(t,e,r,i){SV(t,e,r,i,gm.radius)}function h9(t,e,r,i){SV(t,e,r,i,Ep.radius)}function b0(t,e,r,i){SV(t,e,r,i,mr.radius)}function EV(t,e,r,i,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=Ru(a/(l===0?1:l)),u=Math.atan2(o,n);r[i++]=Bx*u,r[i++]=Bx*c,r[i]=l-s}function d9(t,e,r,i){EV(t,e,r,i,gm.radius)}function p9(t,e,r,i){EV(t,e,r,i,Ep.radius)}function w0(t,e,r,i){EV(t,e,r,i,mr.radius)}function vue(t,e,r,i){w0(t,e,r,i),Ux(r,i,r,i)}function bue(t,e,r,i){w0(t,e,r,i),x0(r,i,r,i)}function Z$e(t,e,r,i,s){const n=kx*t[e],o=kx*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),u=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);r[i++]=(u+a)*c*Math.cos(n),r[i++]=(u+a)*c*Math.sin(n),r[i++]=(u*(1-s.eccentricitySquared)+a)*l}function x0(t,e,r,i){Z$e(t,e,r,i,mr)}function T0(t,e,r,i){const s=j$e,n=t[e],o=t[e+1],a=t[e+2];let l,c,u,d,p,g,y,_,v,w,x,T,S,C,A,O,$,D,N,z,U;l=Math.abs(a),c=n*n+o*o,u=Math.sqrt(c),d=c+a*a,p=Math.sqrt(d),z=Math.atan2(o,n),g=a*a/d,y=c/d,C=s.a2/p,A=s.a3-s.a4/p,y>.3?(_=l/p*(1+y*(s.a1+C+g*A)/p),N=Math.asin(_),w=_*_,v=Math.sqrt(1-w)):(v=u/p*(1-g*(s.a5-C-y*A)/p),N=Math.acos(v),w=1-v*v,_=Math.sqrt(w)),x=1-mr.eccentricitySquared*w,T=mr.radius/Math.sqrt(x),S=s.a6*T,C=u-T*v,A=l-S*_,$=v*C+_*A,O=v*A-_*C,D=O/(S/x+$),N+=D,U=$+O*D/2,a<0&&(N=-N),r[i++]=Bx*z,r[i++]=Bx*N,r[i]=U}function wue(t,e,r,i){T0(t,e,r,i),b0(r,i,r,i)}function xue(t,e,r,i){T0(t,e,r,i),Ux(r,i,r,i)}function J$e(t,e,r){if(t==null||e==null||r.source.spatialReference===t&&r.dest.spatialReference===e)return r;const i=NC(t,r.source),s=NC(e,r.dest);return i===W.UNKNOWN&&s===W.UNKNOWN?hs(t,e)?r.projector=wi:r.projector=null:r.projector=Dw[i][s],r}function Tue(){return{source:{spatialReference:null,spatialReferenceId:W.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:W.UNKNOWN,metersPerUnit:1},projector:wi}}const Sue={spatialReference:null,spatialReferenceId:W.UNKNOWN},Q$e={spatialReference:null,spatialReferenceId:W.UNKNOWN},CV=Tue(),kx=At(1),Bx=_a(1);function Ni(t,e,r,i,s,n,o=1){const a=xV(e,s,CV);if(a==null)return!1;if(a===wi){if(t===i&&r===n)return!0;const c=r+3*o;for(let u=r,d=n;u<c;u++,d++)i[d]=t[u];return!0}const l=r+3*o;for(let c=r,u=n;c<l;c+=3,u+=3)a(t,c,i,u);return!0}const s0t=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:Ni},Symbol.toStringTag,{value:"Module"}));function _Y(t,e,r,i,s,n){return YA[0]=t,YA[1]=e,YA[2]=r,Ni(YA,i,0,s,n,0,1)}const YA=E();let XA=0,P4=class f9{static fromGE(e){const r=new f9;return r._wkt=e.wkt,r._wkid=e.wkid,r._isInverse=e.isInverse,r}constructor(e){this.uid=XA++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=XA++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=XA++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=XA++}getInverse(){const e=new f9;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},Q$=class TS{static cacheKey(e,r){var i,s,n,o,a,l;return[((i=e.wkid)==null?void 0:i.toString())??"-1",((s=e.wkt)==null?void 0:s.toString())??"",((n=e.wkt2)==null?void 0:n.toString())??"",((o=r.wkid)==null?void 0:o.toString())??"-1",((a=r.wkt)==null?void 0:a.toString())??"",((l=r.wkt2)==null?void 0:l.toString())??""].join()}static fromGE(e){const r=new TS;let i="";for(const s of e.steps){const n=P4.fromGE(s);r.steps.push(n),i+=n.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e==null?void 0:e.steps)for(const r of e.steps)r instanceof P4?this.steps.push(r):this.steps.push(new P4({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}getInverse(){const e=new TS;e.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const r of this.steps)e+=r.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,r,i){this._cachedProjection[TS.cacheKey(e,r)]=i}getCachedGeTransformation(e,r){let i="";for(const n of this.steps)i+=n.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const s=this._cachedProjection[TS.cacheKey(e,r)];return s===void 0?null:s}};function K$e(t,e,r){if(e==null||r==null||r.vcsWkid||hs(e,r)||V0(e)||V0(r))return null;const i=A$(e)/A$(r);if(i===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>eIe(s,i);case"polyline":case"esriGeometryPolyline":return s=>rIe(s,i);case"polygon":case"esriGeometryPolygon":return s=>tIe(s,i);case"multipoint":case"esriGeometryMultipoint":return s=>iIe(s,i);case"extent":case"esriGeometryEnvelope":return s=>sIe(s,i);default:return null}}function eIe(t,e){(t==null?void 0:t.z)!=null&&(t.z*=e)}function tIe(t,e){if(t)for(const r of t.rings)for(const i of r)i.length>2&&(i[2]*=e)}function rIe(t,e){if(t)for(const r of t.paths)for(const i of r)i.length>2&&(i[2]*=e)}function iIe(t,e){if(t)for(const r of t.points)r.length>2&&(r[2]*=e)}function sIe(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let Wh=null,W0=null,LE=null,QP={};const AV=new E3;function z3(){return!!Wh&&aoe()}function nIe(){return!!z3()||(xt(AV),zx(),!1)}function zx(t){return LE==null&&(LE=Promise.all([loe(),he(()=>import("./geometryEngineBase-28832c3f.js"),[],import.meta.url).then(e=>e.g),he(()=>import("./hydrated-3cade69c.js"),[],import.meta.url)])),LE.then(([,e,{hydratedAdapter:r}])=>{wt(t),W0=r,Wh=e.default,Wh._enableProjection(aEe),AV.notify()})}function Pm(t,e,r=null,i=null){return Array.isArray(t)?t.length===0?[]:m9(W0,t,t[0].spatialReference,e,r,i):m9(W0,[t],t.spatialReference,e,r,i)[0]}function m9(t,e,r,i,s=null,n=null){if(r==null||i==null)return e;if(Bp(r,i,s))return e.map(o=>DE(o,r,i));if(s==null&&C$(r))return e.map(o=>DE(o,r,at.WGS84)).map(o=>FC(o,i));if(s==null&&C$(i))return e.map(o=>FC(o,at.WGS84)).map(o=>DE(o,at.WGS84,i));if(s==null){const o=Q$.cacheKey(r,i);QP[o]!==void 0?s=QP[o]:((s=Cue(r,i,void 0))==null&&(s=new Q$),QP[o]=s)}if(Wh==null||t==null)throw new RD;return n!=null?Wh._project(t,e,r,i,s,n):Wh._project(t,e,r,i,s)}function oIe(t,e){const r=Eue([t],e);return r.pending!=null?{pending:r.pending,geometry:null}:r.geometries!=null?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function Eue(t,e){if(!z3()){for(const r of t)if(r!=null&&!hs(r.spatialReference,e)&&No(r.spatialReference)&&No(e)&&!Bp(r.spatialReference,e))return xt(AV),{pending:zx(),geometries:null}}return{pending:null,geometries:t.map(r=>r==null?null:hs(r.spatialReference,e)?r:No(r.spatialReference)&&No(e)?FC(r,e):null)}}function Cue(t,e,r=null){if(t==null||e==null)return null;if(Wh==null||W0==null)throw new RD;const i=Wh._getTransformation(W0,t,e,r,r==null?void 0:r.spatialReference);return i!==null?Q$.fromGE(i):null}function aIe(t,e,r=null){if(Wh==null||W0==null)throw new RD;const i=Wh._getTransformationBySuitability(W0,t,e,r,r==null?void 0:r.spatialReference);if(i!==null){const s=[];for(const n of i)s.push(Q$.fromGE(n));return s}return[]}let RD=class extends X{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function lIe(){Wh=null,W0=null,LE=null,QP={}}const cIe={get loadPromise(){return LE}};function FC(t,e){try{const r=Pm(t,e);if(r==null)return null;"xmin"in t&&"xmin"in r&&(r.zmin=t.zmin,r.zmax=t.zmax);const i=K$e(r.type,t.spatialReference,e);return i!=null&&i(r),r}catch(r){if(!(r instanceof RD))throw r;return null}}async function kp(t,e,r){const i=t.spatialReference;return i!=null&&e!=null&&await Aue(i,e,null,r),FC(t,e)}function Bp(t,e,r){return!r&&(!!hs(t,e)||No(t)&&No(e)&&!!xV(t,e,CV))}async function Aue(t,e,r,i){if(z3())return Eq(i);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(!Bp(s,n,o))return zx(i)}else if(!Bp(t,e,r))return zx(i);return Eq(i)}function DE(t,e,r){return t?"x"in t?Oue(t,e,new nt,r,0):"xmin"in t?Iue(t,e,new Xr,r,0):"rings"in t?$ue(t,e,new Np,r,0):"paths"in t?Mue(t,e,new Uh,r,0):"points"in t?Pue(t,e,new S2,r,0):null:null}function Rue(t,e,r=e.spatialReference,i=0){return r!=null&&t.spatialReference!=null&&Oue(t,t.spatialReference,e,r,i)!=null}function Oue(t,e,r,i,s){la[0]=t.x,la[1]=t.y;const n=t.z;return la[2]=n!==void 0?n:s,Ni(la,e,0,la,i,0,1)?(r.x=la[0],r.y=la[1],r.spatialReference=i,n!==void 0||V0(i)?(r.z=la[2],r.hasZ=!0):(r.z=void 0,r.hasZ=!1),t.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=t.m,r.hasM=!0),r):null}function uIe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&Pue(t,t.spatialReference,e,r,i)!=null}function Pue(t,e,r,i,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,u=[];for(const p of n)u.push(p[0],p[1],o?p[2]:s);if(!Ni(u,e,0,u,i,0,c))return null;const d=o||V0(i);for(let p=0;p<c;++p){const g=3*p,y=u[g],_=u[g+1];d&&a?l.push([y,_,u[g+2],n[p][3]]):d?l.push([y,_,u[g+2]]):a?l.push([y,_,n[p][2]]):l.push([y,_])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function hIe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&Mue(t,t.spatialReference,e,r,i)!=null}function Mue(t,e,r,i,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];if(!Lue(n,o??!1,a??!1,e,l,i,s))return null;const c=o||V0(i);return r.paths=l,r.spatialReference=i,r.hasZ=c,r.hasM=a,r}function dIe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&$ue(t,t.spatialReference,e,r,i)!=null}function $ue(t,e,r,i,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];if(!Lue(n,o??!1,a??!1,e,l,i,s))return null;const c=o||V0(i);return r.rings=l,r.spatialReference=i,r.hasZ=c,r.hasM=a,r}function pIe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&Iue(t,t.spatialReference,e,r,i)!=null}function Iue(t,e,r,i,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:u}=t,d=c?t.zmin:s;if(!_Y(n,o,d,e,la,i))return null;const p=c||V0(i);r.xmin=la[0],r.ymin=la[1],p&&(r.zmin=la[2]);const g=c?t.zmax:s;return _Y(a,l,g,e,la,i)?(r.xmax=la[0],r.ymax=la[1],p&&(r.zmax=la[2]),u&&(r.mmin=t.mmin,r.mmax=t.mmax),r.spatialReference=i,r):null}function Lue(t,e,r,i,s,n,o=0){const a=new Array;for(const u of t)for(const d of u)a.push(d[0],d[1],e?d[2]:o);if(!Ni(a,i,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;const c=e||V0(n);for(const u of t){const d=new Array;for(const p of u)c&&r?d.push([a[l++],a[l++],a[l++],p[3]]):c?d.push([a[l++],a[l++],a[l++]]):r?(d.push([a[l++],a[l++],p[2]]),l++):(d.push([a[l++],a[l++]]),l++);s.push(d)}return!0}function Y0(t){return t!=null&&mue(t)!=null}const la=E(),o0t=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:Y0,canProjectWithoutEngine:Bp,getTransformation:Cue,getTransformations:aIe,initializeProjection:Aue,isLoaded:z3,isLoadedOrLoad:nIe,load:zx,project:Pm,projectExtent:pIe,projectMany:m9,projectMultipoint:uIe,projectOrLoad:oIe,projectOrLoadMany:Eue,projectPoint:Rue,projectPolygon:dIe,projectPolyline:hIe,projectWithZConversion:kp,projectWithoutEngine:DE,test:cIe,tryProjectWithZConversion:FC,unload:lIe},Symbol.toStringTag,{value:"Module"}));function OD(t,e,r,i){return t!=null&&(hs(e,i)?(ym(r,t),!0):(Ka[0]=t[0],Ka[1]=t[1],Ka[2]=0,!!Ni(Ka,e,0,Ka,i,0,1)&&(r[0]=Ka[0],r[1]=Ka[1],Ka[0]=t[2],Ka[1]=t[3],Ka[2]=0,!!Ni(Ka,e,0,Ka,i,0,1)&&(r[2]=Ka[0],r[3]=Ka[1],!0))))}const Ka=E();function Ll(t,e,r,i=0){ZA[0]=t.x,ZA[1]=t.y;const s=t.z;return ZA[2]=s!==void 0?s:i,Ni(ZA,t.spatialReference,0,e,r,0,1)}const ZA=E();function mo(t,e,r,i){return!(e==null||i==null||t.length<2)&&(t.length===2&&(JA[0]=t[0],JA[1]=t[1],JA[2]=0,t=JA),Ni(t,e,0,r,i,0,1))}const JA=E();let Mm=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&xx(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*vY);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,vY));e++)this._items.push(this._allocator())}};const vY=1024;function ge(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Vx(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function RV(t,e,r,i,s,n,o,a,l,c,u,d,p,g,y,_){return[t,e,r,i,s,n,o,a,l,c,u,d,p,g,y,_]}function Due(t,e){return new Float64Array(t,e,16)}const $i=ge();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:$i,clone:Vx,create:ge,createView:Due,fromValues:RV},Symbol.toStringTag,{value:"Module"}));var K$;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(K$||(K$={}));function Fi(){return[1,0,0,0,1,0,0,0,1]}function Nue(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function fIe(t,e,r,i,s,n,o,a,l){return[t,e,r,i,s,n,o,a,l]}function Fue(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:Nue,create:Fi,createView:Fue,fromValues:fIe},Symbol.toStringTag,{value:"Module"}));function Bu(){return[0,0,0,1]}function Uue(t){return[t[0],t[1],t[2],t[3]]}function mIe(t,e,r,i){return[t,e,r,i]}function kue(t,e){return new Float64Array(t,e,4)}const gIe=Bu();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:gIe,clone:Uue,create:Bu,createView:kue,fromValues:mIe},Symbol.toStringTag,{value:"Module"}));function ke(){return[0,0]}function SS(t){return[t[0],t[1]]}function tr(t,e){return[t,e]}function Bue(t,e=ke()){const r=Math.min(2,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function zue(t,e){return new Float64Array(t,e,2)}function Vue(){return ke()}function Gue(){return tr(1,1)}function jue(){return tr(1,0)}function Hue(){return tr(0,1)}const _m=Vue(),yIe=Gue(),que=jue(),_Ie=Hue();Object.freeze(Object.defineProperty({__proto__:null,ONES:yIe,UNIT_X:que,UNIT_Y:_Ie,ZEROS:_m,clone:SS,create:ke,createView:zue,fromArray:Bue,fromValues:tr,ones:Gue,unitX:jue,unitY:Hue,zeros:Vue},Symbol.toStringTag,{value:"Module"}));function Jt(){return[0,0,0,0]}function V3(t){return[t[0],t[1],t[2],t[3]]}function Ot(t,e,r,i){return[t,e,r,i]}function OV(t,e=Jt()){const r=Math.min(4,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Wue(t,e){return new Float64Array(t,e,4)}function Yue(){return Jt()}function Xue(){return Ot(1,1,1,1)}function Zue(){return Ot(1,0,0,0)}function Jue(){return Ot(0,1,0,0)}function Que(){return Ot(0,0,1,0)}function Kue(){return Ot(0,0,0,1)}const Ec=Yue(),vu=Xue(),vIe=Zue(),bIe=Jue(),wIe=Que(),xIe=Kue();Object.freeze(Object.defineProperty({__proto__:null,ONES:vu,UNIT_W:xIe,UNIT_X:vIe,UNIT_Y:bIe,UNIT_Z:wIe,ZEROS:Ec,clone:V3,create:Jt,createView:Wue,fromArray:OV,fromValues:Ot,ones:Xue,unitW:Kue,unitX:Zue,unitY:Jue,unitZ:Que,zeros:Yue},Symbol.toStringTag,{value:"Module"}));let M2=class R_{constructor(e,r,i){this._itemByteSize=e,this._itemCreate=r,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){this._itemsPtr===0&&xx(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const r=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let i=0;i<this._itemsPerBuffer;++i)this._items.push(this._itemCreate(r,i*this._itemByteSize));this._buffers.push(r)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=zv){return new R_(16,zue,e)}static createVec3f64(e=zv){return new R_(24,Moe,e)}static createVec4f64(e=zv){return new R_(32,Wue,e)}static createMat3f64(e=zv){return new R_(72,Fue,e)}static createMat4f64(e=zv){return new R_(128,Due,e)}static createQuatf64(e=zv){return new R_(32,kue,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const zv=4*K$.KILOBYTES,l0t=M2.createVec2f64(),Le=M2.createVec3f64(),PV=M2.createVec4f64();M2.createMat3f64();const MV=M2.createMat4f64(),c0t=M2.createQuatf64();function ud(t){return t?{origin:Ii(t.origin),vector:Ii(t.vector)}:{origin:E(),vector:E()}}function TIe(t,e){const r=EIe.get();return r.origin=t,r.vector=e,r}function u0t(t,e=ud()){return SIe(t.origin,t.vector,e)}function SIe(t,e,r=ud()){return ie(r.origin,t),ie(r.vector,e),r}function O1(t,e,r=ud()){return ie(r.origin,t),ce(r.vector,e,t),r}function $V(t,e){const r=ce(Le.get(),e,t.origin),i=de(t.vector,r),s=de(t.vector,t.vector),n=me(i/s,0,1),o=ce(Le.get(),ee(Le.get(),t.vector,n),r);return de(o,o)}function h0t(t,e,r){return g9(t,e,0,1,r)}function d0t(t,e,r){return le(r,t.origin,ee(r,t.vector,e))}function g9(t,e,r,i,s){const{vector:n,origin:o}=t,a=ce(Le.get(),e,o),l=de(n,a)/co(n);return ee(s,n,me(l,r,i)),le(s,s,t.origin)}function p0t(t,e){if(the(t,TIe(e.origin,e.direction),!1,eI)){const{tA:r,pB:i,distance2:s}=eI;if(r>=0&&r<=1)return s;if(r<0)return Yn(t.origin,i);if(r>1)return Yn(le(Le.get(),t.origin,t.vector),i)}return null}function ehe(t,e,r){return!!the(t,e,!0,eI)&&(ie(r,eI.pA),!0)}function the(t,e,r,i){const n=t.origin,o=le(Le.get(),n,t.vector),a=e.origin,l=le(Le.get(),a,e.vector),c=Le.get(),u=Le.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],u[0]=l[0]-a[0],u[1]=l[1]-a[1],u[2]=l[2]-a[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const d=Le.get();if(d[0]=o[0]-n[0],d[1]=o[1]-n[1],d[2]=o[2]-n[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;const p=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],g=u[0]*d[0]+u[1]*d[1]+u[2]*d[2],y=c[0]*d[0]+c[1]*d[1]+c[2]*d[2],_=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],v=(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])*_-g*g;if(Math.abs(v)<1e-6)return!1;let w=(p*g-y*_)/v,x=(p+g*w)/_;r&&(w=me(w,0,1),x=me(x,0,1));const T=Le.get(),S=Le.get();return T[0]=n[0]+w*d[0],T[1]=n[1]+w*d[1],T[2]=n[2]+w*d[2],S[0]=a[0]+x*u[0],S[1]=a[1]+x*u[1],S[2]=a[2]+x*u[2],i.tA=w,i.tB=x,i.pA=T,i.pB=S,i.distance2=Yn(T,S),!0}const eI={tA:0,tB:0,pA:E(),pB:E(),distance2:0},EIe=new Mm(()=>ud());function ln(t){return t?bY(Ii(t.origin),Ii(t.direction)):bY(E(),E())}function bY(t,e){return{origin:t,direction:e}}function f0t(t,e){return pm(t.origin,e.origin)&&pm(t.direction,e.direction)}function $c(t,e){const r=RIe.get();return r.origin=t,r.direction=e,r}function tI(t,e=ln()){return ihe(t.origin,t.direction,e)}function rhe(t,e,r=ln()){return ie(r.origin,t),ce(r.direction,e,t),r}function ihe(t,e,r=ln()){return ie(r.origin,t),ie(r.direction,e),r}function CIe(t,e){const r=rt(Le.get(),pe(Le.get(),t.direction),ce(Le.get(),e,t.origin));return de(r,r)}function AIe(t,e,r){const i=de(t.direction,ce(r,e,t.origin));return le(r,t.origin,ee(r,t.direction,i)),r}const RIe=new Mm(()=>ln());function NE(t,e){return de(t,e)/_e(t)}function PD(t,e){const r=de(t,e)/(_e(t)*_e(e));return-un(r)}function she(t,e,r){pe(QA,t),pe(M4,e);const i=de(QA,M4),s=un(i),n=rt(QA,QA,M4);return de(n,r)<0?2*Math.PI-s:s}const QA=E(),M4=E(),nhe=ds();function ds(){return Jt()}const OIe=Z1,PIe=Z1;function Gx(t,e=ds()){return Fh(e,t)}function ohe(t,e){return Ot(t[0],t[1],t[2],e)}function MIe(t){return t}function $Ie(t){t[0]=t[1]=t[2]=t[3]=0}function MD(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function im(t){return t[3]}function IIe(t){return t}function ahe(t,e,r,i){return Ot(t,e,r,i)}function LIe(t,e,r){return t!==r&&ie(r,t),r[3]=t[3]+e,r}function DIe(t,e,r){return ne.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===r?r:Gx(t,r)}function py(t,e,r){if(e==null||!lhe(t,e,rI))return!1;let{t0:i,t1:s}=rI;if((i<0||s<i&&s>0)&&(i=s),i<0)return!1;if(r){const{origin:n,direction:o}=e;r[0]=n[0]+o[0]*i,r[1]=n[1]+o[1]*i,r[2]=n[2]+o[2]*i}return!0}function NIe(t,e,r){const i=rhe(e,r);if(!lhe(t,i,rI))return[];const{origin:s,direction:n}=i,{t0:o,t1:a}=rI,l=c=>{const u=E();return Ga(u,s,n,c),IV(t,u,u)};return Math.abs(o-a)<Qn()?[l(o)]:[l(o),l(a)]}const rI={t0:0,t1:0};function lhe(t,e,r){const{origin:i,direction:s}=e,n=FIe;n[0]=i[0]-t[0],n[1]=i[1]-t[1],n[2]=i[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);return r.t0=(-a-c)/(2*o),r.t1=(-a+c)/(2*o),!0}const FIe=E();function y9(t,e){return py(t,e,null)}function UIe(t,e,r){if(py(t,e,r))return r;const i=$2(t,e,Le.get());return le(r,e.origin,ee(Le.get(),e.direction,hi(e.origin,i)/_e(e.direction))),r}function $2(t,e,r){const i=Le.get(),s=MV.get();rt(i,e.origin,e.direction);const n=im(t);rt(r,i,e.origin),ee(r,r,1/_e(r)*n);const o=uhe(t,e.origin),a=PD(e.origin,r);return Mc(s,a+o,i),De(r,r,s),r}function kIe(t,e,r){return py(t,e,r)?r:(AIe(e,t,r),IV(t,r,r))}function IV(t,e,r){const i=ce(Le.get(),e,t),s=ee(Le.get(),i,t[3]/_e(i));return le(r,s,t)}function che(t,e){const r=ce(Le.get(),e,t),i=co(r),s=t[3]*t[3];return Math.sqrt(Math.abs(i-s))}function uhe(t,e){const r=ce(Le.get(),e,t),i=_e(r),s=im(t),n=s+Math.abs(s-i);return un(s/n)}const $4=E();function hhe(t,e,r,i){const s=ce($4,e,t);switch(r){case ki.X:{const n=cW(s,$4)[2];return se(i,-Math.sin(n),Math.cos(n),0)}case ki.Y:{const n=cW(s,$4),o=n[1],a=n[2],l=Math.sin(o);return se(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case ki.Z:return pe(i,s);default:return}}function dhe(t,e){const r=ce(_9,e,t);return _e(r)-t[3]}function BIe(t,e,r,i){const s=dhe(t,e),n=hhe(t,e,ki.Z,_9),o=ee(_9,n,r-s);return le(i,e,o)}function zIe(t,e){const r=Yn(t,e),i=im(t);return r<=i*i}function VIe(t,e,r=ds()){const i=hi(t,e),s=t[3],n=e[3];return i+n<s?(Fh(r,t),r):i+s<n?(Fh(r,e),r):($r(r,t,e,(i+n-s)/(2*i)),r[3]=(i+s+n)/2,r)}const _9=E(),$D=ds(),GIe=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:nhe,altitudeAt:dhe,angleToSilhouette:uhe,axisAt:hhe,clear:$Ie,closestPoint:kIe,closestPointOnSilhouette:$2,containsPoint:zIe,copy:Gx,create:ds,distanceToSilhouette:che,elevate:LIe,equals:PIe,exactEquals:OIe,fromCenterAndRadius:ohe,fromRadius:MD,fromValues:ahe,getCenter:IIe,getRadius:im,intersectLine:NIe,intersectRay:py,intersectRayClosestSilhouette:UIe,intersectsRay:y9,projectPoint:IV,setAltitudeAt:BIe,setExtent:DIe,tmpSphere:$D,union:VIe,wrap:MIe},Symbol.toStringTag,{value:"Module"}));function jx(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],r=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],i=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}function jIe(t,e){const r=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),i=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return se(t,r,i,s),t}function m0t(t,e,r){r=r||t;const i=de(t,e);se(r,t[0]-i*e[0],t[1]-i*e[1],t[2]-i*e[2]),pe(r,r)}function g0t(t,e,r){Math.abs(t[0])>Math.abs(t[1])?se(e,0,1,0):se(e,1,0,0),rt(r,t,e),pe(e,e),rt(e,r,t),pe(r,r)}function KA(t,e,r,i,s,n){const o=t+(e-t)*s;return o+(r+(i-r)*s-o)*n}function HIe(t,e,r,i=E()){const s=_e(t),n=_e(e),o=de(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*s+r*n)/Math.sin(a),c=l/s*Math.sin((1-r)*a),u=l/n*Math.sin(r*a);return ee(g1,t,c),ee(y1,e,u),le(i,g1,y1)}return $r(i,t,e,r)}function y0t(t,e,r,i=E(),s=E()){const n=_e(t),o=_e(e),a=de(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),u=Math.sin(r*l),d=Math.sin((1-r)*l),p=(1-r)*n+r*o;{const g=p/c,y=g/o*u;ee(g1,t,g/n*d),ee(y1,e,y),le(i,g1,y1)}{const g=1/n*(-Math.cos((1-r)*l)*l*p+d*(-n+o));ee(g1,t,g);const y=1/o*(Math.cos(r*l)*l*p+u*(-n+o));ee(y1,e,y),le(s,g1,y1),ee(s,s,1/c)}return s}return $r(i,t,e,r),ce(s,e,t),pe(s,s),s}function KP(t,e,r){t=pe(g1,t),e=pe(y1,e);const i=un(de(t,e));if(r){const s=rt(qIe,t,e);if(de(s,r)<0)return-i}return i}function eM(t){const e=t.length;return r=>{if(r<=t[0][0])return t[0][1];if(r>=t[e-1][0])return t[e-1][1];let i=1;for(;r>t[i][0];)i++;const s=t[i-1][0],n=t[i][0],o=(n-r)/(n-s);return o*t[i-1][1]+(1-o)*t[i][1]}}function _0t(t,e,r,i){ce(wY,e,t),ce(xY,r,t),rt(i,wY,xY),pe(i,i),i[3]=-de(t,i)}const wY=E(),xY=E(),qIe=E(),g1=E(),y1=E();function wr(t=ES){return[t[0],t[1],t[2],t[3]]}function WIe(t=ES[0],e=ES[1],r=ES[2],i=ES[3]){return LV(t,e,r,i,PV.get())}function ID(t,e){return LV(e[0],e[1],e[2],e[3],t)}function LV(t,e,r,i,s=wr()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function phe(t,e,r){return ie(r,t),r[3]=e,r}function G3(t,e,r){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function $o(t,e,r,i=wr()){const s=r[0]-e[0],n=r[1]-e[1],o=r[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],u=n*c-o*l,d=o*a-s*c,p=s*l-n*a,g=u*u+d*d+p*p,y=Math.abs(g-1)>1e-5&&g>1e-12?1/Math.sqrt(g):1;return i[0]=u*y,i[1]=d*y,i[2]=p*y,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function DV(t,e,r,i=0,s=Math.floor(r*(1/3)),n=Math.floor(r*(2/3))){if(r<3)return!1;e(nT,i);let o=s,a=!1;for(;o<r-1&&!a;)e(Vv,o),o++,a=!ho(nT,Vv);if(!a)return!1;for(o=Math.max(o,n),a=!1;o<r&&!a;)e(t1,o),o++,ce(eR,nT,Vv),pe(eR,eR),ce(tR,Vv,t1),pe(tR,tR),a=!ho(nT,t1)&&!ho(Vv,t1)&&Math.abs(de(eR,tR))<XIe;return a?($o(nT,Vv,t1,t),!0):(i!==0||s!==1||n!==2)&&DV(t,e,r,0,1,2)}function YIe(t,e,r=!0){const i=e.length/3;return DV(t,(s,n)=>se(s,e[3*n+0],e[3*n+1],e[3*n+2]),r?i-1:i)}const XIe=.99619469809,nT=E(),Vv=E(),t1=E(),eR=E(),tR=E();function v9(t,e,r){return e!==t&&ID(t,e),t[3]=-de(t,r),t}function b9(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function UC(t,e,r,i){return rt(t1,e,t),G3(r,t1,i)}function v0t(t,e,r,i){return LD(t,e,ce(Le.get(),r,e),tLe,i)}function Cv(t,e,r){return e!=null&&LD(t,e.origin,e.direction,rLe,r)}function ZIe(t,e,r){return LD(t,e.origin,e.vector,Ap.NONE,r)}function JIe(t,e,r){return LD(t,e.origin,e.vector,Ap.CLAMP,r)}const b0t=(()=>{const t=E();return(e,r,i)=>{const s=e,n=r;if(rt(t,s,n),co(t)<Qn())return!1;pe(t,t);const[o,a,l]=t,c=i.origin,u=Math.abs(o),d=Math.abs(a),p=Math.abs(l),[g,y,_]=s,[v,w,x]=n,T=e[3],S=r[3];return u>d&&u>p?(c[1]=(S*_-T*x)/o,c[2]=(T*w-S*y)/o):d>p?(c[0]=(T*x-S*_)/a,c[2]=(S*g-T*v)/a):(c[0]=(S*y-T*w)/l,c[1]=(T*v-S*g)/l),ie(i.direction,t),!0}})();function fhe(t,e){return Wr(t,e)>=0}function QIe(t,e){const r=de(t,e.ray.direction),i=-Wr(t,e.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function KIe(t,e){const r=de(t,e.ray.direction),i=-Wr(t,e.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function eLe(t,e,r){const i=ee(Le.get(),t,-t[3]),s=w9(t,ce(Le.get(),e,i),Le.get());return le(r,s,i),r}function w9(t,e,r){const i=ee(Le.get(),t,de(t,e));return ce(r,e,i),r}function w0t(t,e){return Math.abs(Wr(t,e))}function Wr(t,e){return de(t,e)+t[3]}function LD(t,e,r,i,s){const n=de(t,r);if(n===0)return!1;let o=-(de(t,e)+t[3])/n;return i&Ap.CLAMP&&(o=me(o,0,1)),!(!(i&Ap.INFINITE_MIN)&&o<0||!(i&Ap.INFINITE_MAX)&&o>1)&&(le(s,e,ee(s,r,o)),!0)}function x0t(t){return t}function T0t(t){return Math.abs(t[2])<Qn()}const ES=[0,0,1,0];var Ap;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(Ap||(Ap={}));const tLe=Ap.INFINITE_MIN|Ap.INFINITE_MAX,rLe=Ap.INFINITE_MAX,I4=ne.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let iLe=class{constructor(){this.plane=wr(),this.origin=E(),this.basis1=E(),this.basis2=E()}};const mhe=iLe;function $m(t=Che){return{plane:wr(t.plane),origin:Ii(t.origin),basis1:Ii(t.basis1),basis2:Ii(t.basis2)}}function sLe(t,e,r){const i=gLe.get();return i.origin=t,i.basis1=e,i.basis2=r,i.plane=WIe(0,0,0,0),DD(i),i}function Av(t,e=$m()){return NV(t.origin,t.basis1,t.basis2,e)}function nLe(t,e){ie(e.origin,t.origin),ie(e.basis1,t.basis1),ie(e.basis2,t.basis2),ID(e.plane,t.plane)}function NV(t,e,r,i=$m()){return ie(i.origin,t),ie(i.basis1,e),ie(i.basis2,r),DD(i),fLe(i,"fromValues()"),i}function DD(t){UC(t.basis2,t.basis1,t.origin,t.plane)}function ghe(t,e,r){t!==r&&Av(t,r);const i=ee(Le.get(),vm(t),e);return le(r.origin,r.origin,i),r.plane[3]-=e,r}function oLe(t,e,r){return yhe(e,r),ghe(r,BV(t,t.origin),r),r}function yhe(t,e=$m()){const r=(t[2]-t[0])/2,i=(t[3]-t[1])/2;return se(e.origin,t[0]+r,t[1]+i,0),se(e.basis1,r,0,0),se(e.basis2,0,i,0),LV(0,0,1,0,e.plane),e}function FV(t,e,r){return!!Cv(t.plane,e,r)&&She(t,r)}function aLe(t,e,r){if(FV(t,e,r))return r;const i=_he(t,e,Le.get());return le(r,e.origin,ee(Le.get(),e.direction,hi(e.origin,i)/_e(e.direction))),r}function _he(t,e,r){const i=iI.get();Ehe(t,e,i,iI.get());let s=Number.POSITIVE_INFINITY;for(const n of VV){const o=zV(t,n,ND.get()),a=Le.get();if(ZIe(i,o,a)){const l=Rm(Le.get(),e.origin,a),c=Math.abs(un(de(e.direction,l)));c<s&&(s=c,ie(r,a))}}return s===Number.POSITIVE_INFINITY?vhe(t,e,r):r}function vhe(t,e,r){if(FV(t,e,r))return r;const i=iI.get(),s=iI.get();Ehe(t,e,i,s);let n=Number.POSITIVE_INFINITY;for(const o of VV){const a=zV(t,o,ND.get()),l=Le.get();if(JIe(i,a,l)){const c=CIe(e,l);if(!fhe(s,l))continue;c<n&&(n=c,ie(r,l))}}return UV(t,e.origin)<n&&bhe(t,e.origin,r),r}function bhe(t,e,r){const i=eLe(t.plane,e,Le.get()),s=g9(TY(t,t.basis1),i,-1,1,Le.get()),n=g9(TY(t,t.basis2),i,-1,1,Le.get());return ce(r,le(Le.get(),s,n),t.origin),r}function whe(t,e,r){const{origin:i,basis1:s,basis2:n}=t,o=ce(Le.get(),e,i),a=NE(s,o),l=NE(n,o),c=NE(vm(t),o);return se(r,a,l,c)}function UV(t,e){const r=whe(t,e,Le.get()),{basis1:i,basis2:s}=t,n=_e(i),o=_e(s),a=Math.max(Math.abs(r[0])-n,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function lLe(t,e){return Math.sqrt(UV(t,e))}function cLe(t,e){let r=Number.NEGATIVE_INFINITY;for(const i of VV){const s=zV(t,i,ND.get()),n=$V(s,e);n>r&&(r=n)}return Math.sqrt(r)}function kV(t,e){return fhe(t.plane,e)&&She(t,e)}function uLe(t,e,r,i){return pLe(t,r,i)}function BV(t,e){const r=-t.plane[3];return NE(vm(t),e)-r}function hLe(t,e,r,i){const s=BV(t,e),n=ee(mLe,vm(t),r-s);return le(i,e,n),i}function xhe(t,e){return ho(t.basis1,e.basis1)&&ho(t.basis2,e.basis2)&&ho(t.origin,e.origin)}function The(t,e,r){return t!==r&&Av(t,r),Ls(Gv,e),$l(Gv,Gv),De(r.basis1,t.basis1,Gv),De(r.basis2,t.basis2,Gv),De(r.plane,t.plane,Gv),De(r.origin,t.origin,e),v9(r.plane,r.plane,r.origin),r}function dLe(t,e,r,i){return t!==i&&Av(t,i),Mc(L4,e,r),De(i.basis1,t.basis1,L4),De(i.basis2,t.basis2,L4),DD(i),i}function vm(t){return t.plane}function pLe(t,e,r){switch(e){case ki.X:ie(r,t.basis1),pe(r,r);break;case ki.Y:ie(r,t.basis2),pe(r,r);break;case ki.Z:ie(r,vm(t))}return r}function She(t,e){const r=ce(Le.get(),e,t.origin),i=co(t.basis1),s=co(t.basis2),n=de(t.basis1,r),o=de(t.basis2,r);return-n-i<0&&n-i<0&&-o-s<0&&o-s<0}function TY(t,e){const r=ND.get();return ie(r.origin,t.origin),ie(r.vector,e),r}function zV(t,e,r){const{basis1:i,basis2:s,origin:n}=t,o=ee(Le.get(),i,e.origin[0]),a=ee(Le.get(),s,e.origin[1]);le(r.origin,o,a),le(r.origin,r.origin,n);const l=ee(Le.get(),i,e.direction[0]),c=ee(Le.get(),s,e.direction[1]);return ee(r.vector,le(l,l,c),2),r}function fLe(t,e){Math.abs(de(t.basis1,t.basis2)/(_e(t.basis1)*_e(t.basis2)))>1e-6&&I4.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(de(t.basis1,vm(t)))>1e-6&&I4.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-de(vm(t),t.origin)-t.plane[3])>1e-6&&I4.warn(e,"Plane offset is not consistent with plane origin")}function Ehe(t,e,r,i){const s=vm(t);UC(s,e.direction,e.origin,r),UC(r,s,e.origin,i)}const Che={plane:wr(),origin:Te(0,0,0),basis1:Te(1,0,0),basis2:Te(0,1,0)},iI=new Mm(wr),ND=new Mm(ud),mLe=E(),gLe=new Mm(()=>$m()),VV=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Gv=ge(),L4=ge(),yLe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:mhe,altitudeAt:BV,axisAt:uLe,closestPoint:vhe,closestPointOnSilhouette:_he,copy:Av,copyWithoutVerify:nLe,create:$m,distance:lLe,distance2:UV,distanceToSilhouette:cLe,elevate:ghe,equals:xhe,extrusionContainsPoint:kV,fromAABoundingRect:yhe,fromValues:NV,intersectRay:FV,intersectRayClosestSilhouette:aLe,normal:vm,projectPoint:bhe,projectPointLocal:whe,rotate:dLe,setAltitudeAt:hLe,setExtent:oLe,transform:The,up:Che,updateUnboundedPlane:DD,wrap:sLe},Symbol.toStringTag,{value:"Module"})),_Le=new at(poe),SY=new at(HL),EY=new at(qL),E0t=new at(foe);function I2(t){return t&&(Wp(t)||hs(t,SY))?SY:t&&(Yp(t)||hs(t,EY))?EY:_Le}function vLe(t){const{value:e,operations:r}=t;return{operations:r,value:r.create(e)}}function bLe(t,e,r){return t.operations.setExtent(t.value,e,r.value),r}function wLe(t){return{operations:t,value:t.create()}}function Ahe(t,e,r=wLe(t)){return r.operations=t,t.copy(e,r.value),r}function xLe(t){return Ahe(GIe,ahe(0,0,0,Mr(t).radius))}const CY=2**50;function TLe(){return Ahe(yLe,NV([0,0,0],[CY,0,0],[0,CY,0]))}function SLe(t,e,r){return t.operations.axisAt(t.value,e,ki.Z,r)}function ELe(t,e,r,i){return t.operations.axisAt(t.value,e,r,i)}function CLe(t,e,r){return t.operations.intersectRay(t.value,e,r)}function ALe(t,e,r){return t.operations.intersectRayClosestSilhouette(t.value,e,r)}function RLe(t,e){return t.operations.altitudeAt(t.value,e)}function Rhe(t,e,r,i){return t.operations.setAltitudeAt(t.value,e,r,i)}function OLe(t,e,r,i){return e!==i&&Ss(i,e),se(jv,i[12],i[13],i[14]),Rhe(t,jv,r,jv),i[12]=jv[0],i[13]=jv[1],i[14]=jv[2],i}function D4(t,e,r){return t.operations.elevate(t.value,e,r.value)}const jv=E();function AY(t,e,r,i,s){return s[0]=de(t,e),s[1]=de(t,r),s[2]=de(t,i),s}function x9(t,e,r,i,s){ie(r,t),ie(rR,e),pe(rR,rR),rt(i,rR,r),rt(s,i,r)}function PLe(t,e){return t?I2(e):e.isGeographic?at.PlateCarree:e}const rR=E(),GV=96;function C0t(t,e){const r=e||t.extent,i=t.width,s=qo(r==null?void 0:r.spatialReference);return r&&i?r.width/i*s*g7*GV:0}function MLe(t,e){return t/(qo(e)*g7*GV)}function $Le(t){return t/(g7*GV)}function A0t(t,e,r){return ILe(t,e)&&LLe(t,r)}function ILe(t,e){return e===0||P0(t,e)||t<e}function LLe(t,e){return e===0||P0(t,e)||t>e}const DLe="OBJECTID";let Hx=class extends $E{constructor(e){super(e),this.addHandles(this.on("before-add",r=>{r.item!=null&&r.item.parent===this.owner&&(ne.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),r.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};Hx=h([k("esri.support.AnalysesCollection")],Hx);const tM={widthBreakpoint:{getValue(t){const e=t.viewSize[0],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,r=e[0],i=e[1],s=this.values;return i>=r?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},N4={xsmall:544,small:768,medium:992,large:1200};function NLe(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function F4(t,e){return e?tM[t].valueToClassName[e].split(" "):[]}const FLe=t=>{let e=class extends t{constructor(...r){super(...r),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=N4}initialize(){this.addHandles(ae(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),zr))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=NLe(r);if(!i){const s=JSON.stringify(N4,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}r=i?r:N4,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=bl.acquire(),i=bl.acquire();let s,n=!1;for(s in tM){const o=this[s],a=tM[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,F4(s,o).forEach(l=>i.push(l)),F4(s,a).forEach(l=>r.push(l)))}n&&(this._applyClassNameChanges(r,i),bl.release(r),bl.release(i))}_applyClassNameChanges(r,i){const s=this.container;s&&(i.forEach(n=>s.classList.remove(n)),r.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in tM)F4(i,this[i]).forEach(s=>r.classList.remove(s))}};return h([f()],e.prototype,"breakpoints",null),h([f()],e.prototype,"orientation",void 0),h([f()],e.prototype,"widthBreakpoint",void 0),h([f()],e.prototype,"heightBreakpoint",void 0),e=h([k("esri.views.BreakpointsOwner")],e),e};let Yh=class extends xe{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,r,i={}){return this._installWatch(e,r,i,ae)}addWhen(e,r,i={}){return this._installWatch(e,r,i,$u)}addOnCollectionChange(e,r,{initial:i=!1,final:s=!1}={}){const n=++this._handleId;return this.addHandles([Bo(e,"after-changes",this._createSyncUpdatingCallback(),Fr),Bo(e,"change",r,{onListenerAdd:i?o=>r({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>r({added:[],removed:o.toArray()}):void 0})],n),Rr(()=>this.removeHandles(n))}addPromise(e){if(e==null)return e;const r=++this._handleId;this.addHandles(Rr(()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this.hasHandles(iR)||this._set("updating",!1))}),r),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this.removeHandles(r);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,r,i={},s){const n=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,r,i);return this.addHandles(o,n),Rr(()=>this.removeHandles(n))}_installSyncUpdatingWatch(e,r){const i=this._createSyncUpdatingCallback(),s=ae(e,i,{sync:!0,equals:()=>!1});return this.addHandles(s,r),s}_createSyncUpdatingCallback(){return()=>{this.removeHandles(iR),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(w2(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(iR))}),iR)}}};h([f({readOnly:!0})],Yh.prototype,"updating",void 0),Yh=h([k("esri.core.support.UpdatingHandles")],Yh);const iR=-42;/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(é›·å®—æ°‘) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var ULe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},r1={exports:{}},Fs={},kC={exports:{}},Rv={};function Ohe(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function kLe(t,e,r){}function BLe(t,e,r){}var zLe=/javascript\s*\:/img;function VLe(t,e){return zLe.test(e)?"":e}Rv.whiteList=Ohe();Rv.getDefaultWhiteList=Ohe;Rv.onAttr=kLe;Rv.onIgnoreAttr=BLe;Rv.safeAttrValue=VLe;var GLe={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},oT=GLe;function jLe(t,e){t=oT.trimRight(t),t[t.length-1]!==";"&&(t+=";");var r=t.length,i=!1,s=0,n=0,o="";function a(){if(!i){var u=oT.trim(t.slice(s,n)),d=u.indexOf(":");if(d!==-1){var p=oT.trim(u.slice(0,d)),g=oT.trim(u.slice(d+1));if(p){var y=e(s,o.length,p,g,u);y&&(o+=y+"; ")}}}s=n+1}for(;n<r;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return oT.trim(o)}var HLe=jLe,sR=Rv,qLe=HLe;function RY(t){return t==null}function WLe(t){var e={};for(var r in t)e[r]=t[r];return e}function Phe(t){t=WLe(t||{}),t.whiteList=t.whiteList||sR.whiteList,t.onAttr=t.onAttr||sR.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||sR.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||sR.safeAttrValue,this.options=t}Phe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onAttr,n=r.onIgnoreAttr,o=r.safeAttrValue,a=qLe(t,function(l,c,u,d,p){var g=i[u],y=!1;if(g===!0?y=g:typeof g=="function"?y=g(d):g instanceof RegExp&&(y=g.test(d)),y!==!0&&(y=!1),d=o(u,d),!!d){var _={position:c,sourcePosition:l,source:p,isWhite:y};if(y){var v=s(u,d,_);return RY(v)?u+":"+d:v}else{var v=n(u,d,_);if(!RY(v))return v}}});return a};var YLe=Phe;(function(t,e){var r=Rv,i=YLe;function s(o,a){var l=new i(a);return l.process(o)}e=t.exports=s,e.FilterCSS=i;for(var n in r)e[n]=r[n]})(kC,kC.exports);var jV={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,r=e.exec(t);return r?r.index:-1}},XLe=kC.exports.FilterCSS,ZLe=kC.exports.getDefaultWhiteList,sI=jV;function Mhe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var $he=new XLe;function JLe(t,e,r){}function QLe(t,e,r){}function KLe(t,e,r){}function eDe(t,e,r){}function Ihe(t){return t.replace(rDe,"&lt;").replace(iDe,"&gt;")}function tDe(t,e,r,i){if(r=khe(r),e==="href"||e==="src"){if(r=sI.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(e==="background"){if(nR.lastIndex=0,nR.test(r))return""}else if(e==="style"){if(OY.lastIndex=0,OY.test(r)||(PY.lastIndex=0,PY.test(r)&&(nR.lastIndex=0,nR.test(r))))return"";i!==!1&&(i=i||$he,r=i.process(r))}return r=Bhe(r),r}var rDe=/</g,iDe=/>/g,sDe=/"/g,nDe=/&quot;/g,oDe=/&#([a-zA-Z0-9]*);?/gim,aDe=/&colon;?/gim,lDe=/&newline;?/gim,nR=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,OY=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,PY=/u\s*r\s*l\s*\(.*/gi;function Lhe(t){return t.replace(sDe,"&quot;")}function Dhe(t){return t.replace(nDe,'"')}function Nhe(t){return t.replace(oDe,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function Fhe(t){return t.replace(aDe,":").replace(lDe," ")}function Uhe(t){for(var e="",r=0,i=t.length;r<i;r++)e+=t.charCodeAt(r)<32?" ":t.charAt(r);return sI.trim(e)}function khe(t){return t=Dhe(t),t=Nhe(t),t=Fhe(t),t=Uhe(t),t}function Bhe(t){return t=Lhe(t),t=Ihe(t),t}function cDe(){return""}function uDe(t,e){typeof e!="function"&&(e=function(){});var r=!Array.isArray(t);function i(o){return r?!0:sI.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",u=l.position+c.length;return s.push([n!==!1?n:l.position,u]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return sI.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function hDe(t){for(var e="",r=0;r<t.length;){var i=t.indexOf("<!--",r);if(i===-1){e+=t.slice(r);break}e+=t.slice(r,i);var s=t.indexOf("-->",i);if(s===-1)break;r=s+3}return e}function dDe(t){var e=t.split("");return e=e.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),e.join("")}Fs.whiteList=Mhe();Fs.getDefaultWhiteList=Mhe;Fs.onTag=JLe;Fs.onIgnoreTag=QLe;Fs.onTagAttr=KLe;Fs.onIgnoreTagAttr=eDe;Fs.safeAttrValue=tDe;Fs.escapeHtml=Ihe;Fs.escapeQuote=Lhe;Fs.unescapeQuote=Dhe;Fs.escapeHtmlEntities=Nhe;Fs.escapeDangerHtml5Entities=Fhe;Fs.clearNonPrintableCharacter=Uhe;Fs.friendlyAttrValue=khe;Fs.escapeAttrValue=Bhe;Fs.onIgnoreTagStripAll=cDe;Fs.StripTagBody=uDe;Fs.stripCommentTag=hDe;Fs.stripBlankChar=dDe;Fs.cssFilter=$he;Fs.getDefaultCSSWhiteList=ZLe;var FD={},t0=jV;function pDe(t){var e=t0.spaceIndex(t),r;return e===-1?r=t.slice(1,-1):r=t.slice(1,e+1),r=t0.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function fDe(t){return t.slice(0,2)==="</"}function mDe(t,e,r){var i="",s=0,n=!1,o=!1,a=0,l=t.length,c="",u="";e:for(a=0;a<l;a++){var d=t.charAt(a);if(n===!1){if(d==="<"){n=a;continue}}else if(o===!1){if(d==="<"){i+=r(t.slice(s,a)),n=a,s=a;continue}if(d===">"){i+=r(t.slice(s,n)),u=t.slice(n,a+1),c=pDe(u),i+=e(n,i.length,c,u,fDe(u)),s=a+1,n=!1;continue}if(d==='"'||d==="'")for(var p=1,g=t.charAt(a-p);g.trim()===""||g==="=";){if(g==="="){o=d;continue e}g=t.charAt(a-++p)}}else if(d===o){o=!1;continue}}return s<t.length&&(i+=r(t.substr(s))),i}var gDe=/[^a-zA-Z0-9\\_:.-]/gim;function yDe(t,e){var r=0,i=0,s=[],n=!1,o=t.length;function a(p,g){if(p=t0.trim(p),p=p.replace(gDe,"").toLowerCase(),!(p.length<1)){var y=e(p,g||"");y&&s.push(y)}}for(var l=0;l<o;l++){var c=t.charAt(l),u,d;if(n===!1&&c==="="){n=t.slice(r,l),r=l+1,i=t.charAt(r)==='"'||t.charAt(r)==="'"?r:vDe(t,l+1);continue}if(n!==!1&&l===i){if(d=t.indexOf(c,l+1),d===-1)break;u=t0.trim(t.slice(i+1,d)),a(n,u),n=!1,l=d,r=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(d=_De(t,l),d===-1){u=t0.trim(t.slice(r,l)),a(u),n=!1,r=l+1;continue}else{l=d-1;continue}else if(d=bDe(t,l-1),d===-1){u=t0.trim(t.slice(r,l)),u=MY(u),a(n,u),n=!1,r=l+1;continue}else continue}return r<t.length&&(n===!1?a(t.slice(r)):a(n,MY(t0.trim(t.slice(r))))),t0.trim(s.join(" "))}function _De(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="="?e:-1}}function vDe(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="'"||r==='"'?e:-1}}function bDe(t,e){for(;e>0;e--){var r=t[e];if(r!==" ")return r==="="?e:-1}}function wDe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function MY(t){return wDe(t)?t.substr(1,t.length-2):t}FD.parseTag=mDe;FD.parseAttr=yDe;var xDe=kC.exports.FilterCSS,Sh=Fs,zhe=FD,TDe=zhe.parseTag,SDe=zhe.parseAttr,rM=jV;function oR(t){return t==null}function EDe(t){var e=rM.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=rM.trim(t.slice(e+1,-1));var r=t[t.length-1]==="/";return r&&(t=rM.trim(t.slice(0,-1))),{html:t,closing:r}}function CDe(t){var e={};for(var r in t)e[r]=t[r];return e}function ADe(t){var e={};for(var r in t)Array.isArray(t[r])?e[r.toLowerCase()]=t[r].map(function(i){return i.toLowerCase()}):e[r.toLowerCase()]=t[r];return e}function Vhe(t){t=CDe(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=Sh.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=ADe(t.whiteList||t.allowList):t.whiteList=Sh.whiteList,t.onTag=t.onTag||Sh.onTag,t.onTagAttr=t.onTagAttr||Sh.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||Sh.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||Sh.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||Sh.safeAttrValue,t.escapeHtml=t.escapeHtml||Sh.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new xDe(t.css))}Vhe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onTag,n=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,u=e.cssFilter;r.stripBlankChar&&(t=Sh.stripBlankChar(t)),r.allowCommentTag||(t=Sh.stripCommentTag(t));var d=!1;r.stripIgnoreTagBody&&(d=Sh.StripTagBody(r.stripIgnoreTagBody,n),n=d.onIgnoreTag);var p=TDe(t,function(g,y,_,v,w){var x={sourcePosition:g,position:y,isClosing:w,isWhite:Object.prototype.hasOwnProperty.call(i,_)},T=s(_,v,x);if(!oR(T))return T;if(x.isWhite){if(x.isClosing)return"</"+_+">";var S=EDe(v),C=i[_],A=SDe(S.html,function(O,$){var D=rM.indexOf(C,O)!==-1,N=o(_,O,$,D);return oR(N)?D?($=l(_,O,$,u),$?O+'="'+$+'"':O):(N=a(_,O,$,D),oR(N)?void 0:N):N});return v="<"+_,A&&(v+=" "+A),S.closing&&(v+=" /"),v+=">",v}else return T=n(_,v,x),oR(T)?c(v):T},c);return d&&(p=d.remove(p)),p};var RDe=Vhe;(function(t,e){var r=Fs,i=FD,s=RDe;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in r)e[a]=r[a];for(var l in i)e[l]=i[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(r1,r1.exports);var ODe=function(){function t(e,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?i.sanitizeUrl(a):r1.exports.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!r?s=e:e&&r?(s=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(n){n==="whiteList"?s.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,e.whiteList||{}]):s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new r1.exports.FilterXSS(s)}return t.prototype.sanitize=function(e,r){switch(r===void 0&&(r={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,r);default:return r.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,r){var i=(r??{}).isProtocolRequired,s=i===void 0?!0:i,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?r1.exports.escapeAttrValue(e):!n&&!s?r1.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,r,i,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,r,i,s):r1.exports.safeAttrValue(e,r,i,s)},t.prototype.validate=function(e,r){r===void 0&&(r={});var i=this.sanitize(e,r);return{isValid:e===i,sanitized:i}},t.prototype.encodeHTML=function(e){var r=this;return String(e).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},t.prototype.encodeAttrValue=function(e){var r=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(i,s){return r.test(i)?i:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var r={};return e.forEach(function(i){Object.keys(i).forEach(function(s){Array.isArray(i[s])&&Array.isArray(r[s])?r[s]=r[s].concat(i[s]):r[s]=i[s]})}),r},t.prototype._iterateOverObject=function(e,r){var i=this;r===void 0&&(r={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(ULe(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],u=i.validate(c,r);return u.isValid?a[l]=c:(s=!0,a[l]=u.sanitized),a},{})}else return r.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const UD=new Map;function Ghe(){UD.clear()}function PDe(t){return UD.get(t)}function MDe(t,e){UD.set(t,e)}function U4(t){UD.delete(t)}const $De=ne.getLogger("esri.widgets.support.widgetUtils");function IDe(t){const e=bl.acquire();for(let i=0;i<arguments.length;i++){const s=arguments[i],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const r=e.join(" ");return bl.release(e),r}(()=>{const t=new Map,e=new ResizeObserver(i=>{var s;Ghe();for(const n of i)(s=t.get(n.target))==null||s(n)}),r=(i,s,n)=>(t.has(i)&&$De.error("Already observing element",i),t.set(i,s),e.observe(i,n),Rr(()=>{e.unobserve(i),t.delete(i)}));return(i,s,n)=>{let o=null;return U1([ae(()=>typeof i=="function"?i():i,a=>{o==null||o.remove(),a&&(o=r(a,s,n))},Br),Rr(()=>o==null?void 0:o.remove())])}})();function LDe(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function P0t(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function M0t(t){const e="data-node-ref";this[t.getAttribute(e)]=t}const DDe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],NDe=DDe.reduce((t,e)=>(t[e]=[],t),{}),FDe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],jhe=new ODe({whiteList:NDe,onTagAttr:(t,e,r)=>{const i=`${e}="${r}"`;if(FDe.includes(e))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function UDe(t){return t==="Enter"||t===" "}const Hhe="http://www.w3.org/",kD=`${Hhe}2000/svg`,qhe=`${Hhe}1999/xlink`;let $Y=[],HV=(t,e)=>{let r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),e&&Object.keys(e).forEach(i=>{r[i]=e[i]}),r},qV=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),Whe=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},kDe=(t,e,r)=>{if(e.vnodeSelector!==""){for(let i=r;i<t.length;i++)if(qV(t[i],e))return i}return-1},k4=(t,e,r,i)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(qV(a,s))throw new Error(`${r.vnodeSelector} had a ${s.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},BDe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},T9=[],S9=!1,Yhe=t=>{(t.children||[]).forEach(Yhe),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},IY=()=>{S9=!1,T9.forEach(Yhe),T9.length=0},LY=t=>{T9.push(t),S9||(S9=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(IY,{timeout:16}):setTimeout(IY,16))},DY=t=>{let e=t.domNode;if(t.properties){let r=t.properties.exitAnimation;if(r)return e.style.pointerEvents="none",void r(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),LY(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),LY(t))},zDe=(t,e,r)=>{if(!e)return;let i=r.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")C9(t,l,!0);else if(a==="classes"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let p=c[d];l[p]&&t.classList.add(p)}}else if(a==="styles"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let p=c[d],g=l[p];g&&(Whe(g),r.styleApplyer(t,p,g))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,t,e)),a==="oninput"&&function(){let u=l;l=function(d){u.apply(this,[d]),d.target["oninput-value"]=d.target.value}}()),t[a]=l):r.namespace===kD?a==="href"?t.setAttributeNS(qhe,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=jhe.sanitize(l):E9(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function E9(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let nI,VDe=(t,e,r)=>{if(e)for(let i of e)Nw(i,t,void 0,r)},Xhe=(t,e,r)=>{VDe(t,e.children,r),e.text&&(t.textContent=e.text),zDe(t,e.properties,r),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,r,e.vnodeSelector,e.properties,e.children])},Nw=(t,e,r,i)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),r!==void 0?e.insertBefore(s,r):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let u=o.charAt(n-1),d=o.slice(n,l);u==="."?s.classList.add(d):u==="#"?s.id=d:(d==="svg"&&(i=HV(i,{namespace:kD})),i.namespace!==void 0?s=t.domNode=a.createElementNS(i.namespace,d):(s=t.domNode=t.domNode||a.createElement(d),d==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),r!==void 0?e.insertBefore(s,r):s.parentNode!==e&&e.appendChild(s)),n=l+1}}Xhe(s,t,i)}},C9=(t,e,r)=>{e&&e.split(" ").forEach(i=>{i&&t.classList.toggle(i,r)})},GDe=(t,e,r,i)=>{if(!r)return;let s=!1,n=Object.keys(r),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=r[l],u=e[l];if(l==="class")u!==c&&(C9(t,u,!1),C9(t,c,!0));else if(l==="classes"){let d=t.classList,p=Object.keys(c),g=p.length;for(let y=0;y<g;y++){let _=p[y],v=!!c[_];v!==!!u[_]&&(s=!0,v?d.add(_):d.remove(_))}}else if(l==="styles"){let d=Object.keys(c),p=d.length;for(let g=0;g<p;g++){let y=d[g],_=c[y];_!==u[y]&&(s=!0,_?(Whe(_),i.styleApplyer(t,y,_)):i.styleApplyer(t,y,""))}}else if(c||typeof u!="string"||(c=""),l!=="value"||E9(t)){if(c!==u){let d=typeof c;d==="function"&&i.eventHandlerInterceptor||(i.namespace===kD?l==="href"?t.setAttributeNS(qhe,l,c):t.setAttribute(l,c):d==="string"?l==="innerHTML"?t[l]=jhe.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):E9(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}else{let d=t[l];d!==c&&(t["oninput-value"]?d===t["oninput-value"]:c!==u)&&(t[l]=c,t["oninput-value"]=void 0),c!==u&&(s=!0)}}return s},jDe=(t,e,r,i,s)=>{if(r===i)return!1;i=i||$Y;let n,o=(r=r||$Y).length,a=i.length,l=0,c=0,u=!1;for(;c<a;){let d=l<o?r[l]:void 0,p=i[c];if(d!==void 0&&qV(d,p))u=nI(d,p,s)||u,l++;else{let g=kDe(r,p,l+1);if(g>=0){for(n=l;n<g;n++)DY(r[n]),k4(r,n,t,"removed");u=nI(r[g],p,s)||u,l=g+1}else Nw(p,e,l<o?r[l].domNode:void 0,s),BDe(p),k4(i,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)DY(r[n]),k4(r,n,t,"removed");return u};nI=(t,e,r)=>{let i=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=i.ownerDocument.createTextNode(e.text);return i.parentNode.replaceChild(o,i),e.domNode=o,s=!0,s}e.domNode=i}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(r=HV(r,{namespace:kD})),t.text!==e.text&&(n=!0,e.text===void 0?i.removeChild(i.firstChild):i.textContent=e.text),e.domNode=i,n=jDe(e,i,t.children,e.children,r)||n,n=GDe(i,t.properties,e.properties,r)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[i,r,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(i,e.properties,t.properties),s};let aT=(t,e)=>({getLastRender:()=>t,update:r=>{if(t.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=t;t=r,nI(i,r,e)},domNode:t.domNode});const HDe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}};let sw=t=>HV(HDe,t),S0={create:(t,e)=>(e=sw(e),Nw(t,document.createElement("div"),void 0,e),aT(t,e)),append:(t,e,r)=>(r=sw(r),Nw(e,t,void 0,r),aT(e,r)),insertBefore:(t,e,r)=>(r=sw(r),Nw(e,t.parentNode,t,r),aT(e,r)),merge:(t,e,r)=>(r=sw(r),e.domNode=t,Xhe(t,e,r),aT(e,r)),replace:(t,e,r)=>(r=sw(r),Nw(e,t.parentNode,t,r),t.parentNode.removeChild(t),aT(e,r))},Zhe,qDe=(t,e)=>{let r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r};Zhe=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let WDe=(t,e)=>{let r=t;return e.forEach(i=>{r=r&&r.children?Zhe(r.children,s=>s.domNode===i):void 0}),r},YDe=(t,e,r)=>{let i=function(s){r("domEvent",s);let n=e(),o=qDe(s.currentTarget,n.domNode);o.reverse();let a,l=WDe(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",s),a};return(s,n,o,a)=>i},NY=t=>{let e,r,i=sw(t),s=i.performanceLogger,n=!0,o=!1,a=[],l=[],c=(d,p,g)=>{let y,_=()=>y;i.eventHandlerInterceptor=YDe(e,_,s),y=d(p,g(),i),a.push(y),l.push(g)},u=()=>{if(r=void 0,n){n=!1,s("renderStart",void 0);for(let d=0;d<a.length;d++){let p=l[d]();s("rendered",void 0),a[d].update(p),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:u,scheduleRender:()=>{r||o||(r=requestAnimationFrame(u))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(d,p)=>{c(S0.append,d,p)},insertBefore:(d,p)=>{c(S0.insertBefore,d,p)},merge:(d,p)=>{c(S0.merge,d,p)},replace:(d,p)=>{c(S0.replace,d,p)},detach:d=>{for(let p=0;p<l.length;p++)if(l[p]===d)return l.splice(p,1),a.splice(p,1)[0];throw new Error("renderFunction was not found")}},e},Bg=class extends xe{constructor(){super(...arguments),this.items=new St,this._watchUpdatingTracking=new Yh,this._callbacks=new Map,this._projector=NY(),this._hiddenProjector=NY()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const i of r.added){const s=()=>i.render();this._callbacks.set(i,s),this._projector.append(this.surface,s)}for(const i of r.removed){const s=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(s.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const r=this._hiddenSurface,i=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);i.append(r,n),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s!=null&&s.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(i.detach(n);r.firstChild;)r.removeChild(r.firstChild);return o}overlaps(e,r){const i=this.computeBoundingRect(e),s=this.computeBoundingRect(r);return Math.max(i.left,s.left)<=Math.min(i.right,s.right)&&Math.max(i.top,s.top)<=Math.min(i.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,r){const i=!!(r!=null&&r.disableDecorations);if(!this.items.some(n=>n.visible&&!(i&&n.isDecoration)))return;const s=e.getContext("2d");s.save(),s.font=this._fontString(),this.items.forEach(n=>{i&&n.isDecoration||(s.save(),n.renderCanvas(s),s.restore())}),s.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};h([f({readOnly:!0})],Bg.prototype,"surface",void 0),h([f({readOnly:!0})],Bg.prototype,"items",void 0),h([f({readOnly:!0})],Bg.prototype,"needsRender",null),h([f({readOnly:!0})],Bg.prototype,"_watchUpdatingTracking",void 0),h([f({readOnly:!0})],Bg.prototype,"updating",null),Bg=h([k("esri.views.overlay.ViewOverlay")],Bg);const FY=Bg,B4=[0,0];function XDe(t){const e=(t.ownerDocument||window.document).defaultView,r=t.getBoundingClientRect();return B4[0]=r.left+((e==null?void 0:e.pageXOffset)??0),B4[1]=r.top+((e==null?void 0:e.pageYOffset)??0),B4}function UY(t){t&&(cue(t),t.parentNode&&t.parentNode.removeChild(t))}function ZDe(t){const e=document.createElement("div");return t.appendChild(e),e}const lT=16,aR=750,JDe=512,QDe=2,KDe=t=>{let e=class extends t{constructor(...r){super(...r),this._freqInfo={freq:lT,time:aR},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([ae(()=>this.cursor,i=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",i)}),ae(()=>this.navigating,i=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",i.toString())})])}initialize(){const r=te("mac"),i=async()=>{r&&(await Fx(()=>this.ready),this.messagesCommon=await b7("esri/t9n/common").catch(()=>{}))};i(),this.addHandles([ae(()=>this.ui,(s,n)=>this._handleUIChange(s,n),zr),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused")),_7(i)])}destroy(){this.destroyed||(this.ui=Oe(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(r){const i=this._get("container"),s=AD(r);if(s||typeof r!="string"||ne.getLogger(this).error("#container",`element with id '${r}' not found`),i===s)return;if(this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(UY(this.root),this._set("root",null)),this.userContent&&(sY(this.userContent,i),UY(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",sY(s,n),s.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",s.insertBefore(o,s.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new FY;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(ae(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=B1({render:()=>{var u;return(u=this.overlay)==null?void 0:u.render()}}):this._overlayRenderTaskHandle=di(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get size(){return[this.width,this.height]}blur(){var r;(r=this.surface)==null||r.blur()}focus(){var r;(r=this.surface)==null||r.focus()}pageToContainer(r,i,s){const n=this.position;return r-=n?n[0]:0,i-=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}containerToPage(r,i,s){const n=this.position;return r+=n?n[0]:0,i+=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}_handleUIChange(r,i){this.removeHandles("ui"),i&&i!==r&&i.destroy(),r&&(r.view=this,this.addHandles(ae(()=>this.root,s=>{r.container=s?ZDe(s):null},zr),"ui")),this._set("ui",r)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=lT,r.time=aR,this.addHandles([b2(window,"resize",()=>{r.freq=lT,r.time=aR}),B1({prepare:i=>{const s=this._measure(),n=this._freqInfo;if(n.time+=i.deltaTime,s&&(n.freq=lT,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?lT:Math.min(aR,n.freq*QDe),!s&&n.freq>=JDe&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,s=r?r.clientHeight:0;if(i===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return i===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:i,height:s}),!0)}_position(){const r=this.container,i=this.position,s=r&&XDe(r);return!!s&&(!i||s[0]!==i[0]||s[1]!==i[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return h([f()],e.prototype,"container",null),h([f({readOnly:!0})],e.prototype,"focused",null),h([f({readOnly:!0})],e.prototype,"height",void 0),h([f()],e.prototype,"messagesCommon",void 0),h([f({type:FY})],e.prototype,"overlay",void 0),h([f({readOnly:!0})],e.prototype,"position",void 0),h([f({readOnly:!0})],e.prototype,"resizing",void 0),h([f({readOnly:!0})],e.prototype,"root",void 0),h([f({value:null,readOnly:!0})],e.prototype,"size",null),h([f({readOnly:!0})],e.prototype,"surface",void 0),h([f({readOnly:!0})],e.prototype,"suspended",void 0),h([f()],e.prototype,"ui",void 0),h([f({readOnly:!0})],e.prototype,"userContent",void 0),h([f({readOnly:!0})],e.prototype,"width",void 0),h([f()],e.prototype,"widthBreakpoint",void 0),e=h([k("esri.views.DOMContainer")],e),e};function fy(t,e,r,i){return{x:t,y:e,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}async function oI(t,e,r,i,s){i??(i=0);const n=t.spatialReference;if(Bp(n,r)||n==null||r==null||hs(n,r))return lR[0]=t.x,lR[1]=t.y,lR[2]=t.z??i,void Ni(lR,t.spatialReference,0,e,r,0,1);const o=fy(t.x,t.y,t.z??i,n),a=await kp(o,r,s);e[0]=a.x,e[1]=a.y,e[2]=a.z??0}const lR=E();function bm(t,e,r){if(e==null||r==null)return null;const i=new nt({spatialReference:r});return Ni(t,e,0,cR,r,0,1)?(i.x=cR[0],i.y=cR[1],i.z=cR[2],i):null}const cR=E();async function Jhe(t,e,r,i){const s=bm(t,e,r);if(s!=null)return s;const n=new nt({x:t[0],y:t[1],z:t[2],spatialReference:e,hasZ:!0});return kp(n,r,i)}var $e;function kY(t){return t==="global"?$e.Global:$e.Local}function z4(t){return t===$e.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})($e||($e={}));var Mi,Xn;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(Mi||(Mi={}));let eNe=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Xn.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(Xn||(Xn={}));let tNe=class{constructor(e,r,i){this.object=e,this.geometryId=r,this.triangleNr=i}},rNe=class extends tNe{constructor(e,r,i,s){super(e,r,i),this.center=s!=null?Ii(s):null}},Qhe=class{constructor(e){this.layerUid=e}},BD=class extends Qhe{constructor(e,r){super(e),this.graphicUid=r}};function hd(t){return(t==null?void 0:t.dist)!=null}function BY(t){return(e,r,i)=>($r(zY,e,r,i),!kV(t,zY))}function zD(t){return hd(t)&&t.intersector===Mi.OBJECT&&!!t.target}function VD(t){return hd(t)&&t.intersector===Mi.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const zY=E();function Iu(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function iNe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function WV(t,e,r,i,s,n,o,a,l,c){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function YV(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Lu(t,e){if(t===e){const r=e[1],i=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Ov(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*o-a*c,p=-u*n+a*l,g=c*n-o*l;let y=r*d+i*p+s*g;return y?(y=1/y,t[0]=d*y,t[1]=(-u*i+s*c)*y,t[2]=(a*i-s*o)*y,t[3]=p*y,t[4]=(u*r-s*l)*y,t[5]=(-a*r+s*n)*y,t[6]=g*y,t[7]=(-c*r+i*l)*y,t[8]=(o*r-i*n)*y,t):null}function sNe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=o*u-a*c,t[1]=s*c-i*u,t[2]=i*a-s*o,t[3]=a*l-n*u,t[4]=r*u-s*l,t[5]=s*n-r*a,t[6]=n*c-o*l,t[7]=i*l-r*c,t[8]=r*o-i*n,t}function nNe(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+r*(-c*s+o*a)+i*(l*s-n*a)}function qx(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=r[0],g=r[1],y=r[2],_=r[3],v=r[4],w=r[5],x=r[6],T=r[7],S=r[8];return t[0]=p*i+g*o+y*c,t[1]=p*s+g*a+y*u,t[2]=p*n+g*l+y*d,t[3]=_*i+v*o+w*c,t[4]=_*s+v*a+w*u,t[5]=_*n+v*l+w*d,t[6]=x*i+T*o+S*c,t[7]=x*s+T*a+S*u,t[8]=x*n+T*l+S*d,t}function aI(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=r[0],g=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=p*i+g*o+c,t[7]=p*s+g*a+u,t[8]=p*n+g*l+d,t}function XV(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=Math.sin(r),g=Math.cos(r);return t[0]=g*i+p*o,t[1]=g*s+p*a,t[2]=g*n+p*l,t[3]=g*o-p*i,t[4]=g*a-p*s,t[5]=g*l-p*n,t[6]=c,t[7]=u,t[8]=d,t}function ZV(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function oNe(t,e,r){const i=r[0],s=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function aNe(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function lNe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function cNe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function uNe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function JV(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,u=i*o,d=i*a,p=s*o,g=s*a,y=s*l,_=n*o,v=n*a,w=n*l;return t[0]=1-d-y,t[3]=u-w,t[6]=p+v,t[1]=u+w,t[4]=1-c-y,t[7]=g-_,t[2]=p-v,t[5]=g+_,t[8]=1-c-d,t}function Khe(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10],d=u*o-a*c,p=-u*n+a*l,g=c*n-o*l,y=r*d+i*p+s*g;if(!y)return null;const _=1/y;return t[0]=d*_,t[1]=(-u*i+s*c)*_,t[2]=(a*i-s*o)*_,t[3]=p*_,t[4]=(u*r-s*l)*_,t[5]=(-a*r+s*n)*_,t[6]=g*_,t[7]=(-c*r+i*l)*_,t[8]=(o*r-i*n)*_,t}function wm(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],g=e[11],y=e[12],_=e[13],v=e[14],w=e[15],x=r*a-i*o,T=r*l-s*o,S=r*c-n*o,C=i*l-s*a,A=i*c-n*a,O=s*c-n*l,$=u*_-d*y,D=u*v-p*y,N=u*w-g*y,z=d*v-p*_,U=d*w-g*_,Y=p*w-g*v;let H=x*Y-T*U+S*z+C*N-A*D+O*$;return H?(H=1/H,t[0]=(a*Y-l*U+c*z)*H,t[1]=(l*N-o*Y-c*D)*H,t[2]=(o*U-a*N+c*$)*H,t[3]=(s*U-i*Y-n*z)*H,t[4]=(r*Y-s*N+n*D)*H,t[5]=(i*N-r*U-n*$)*H,t[6]=(_*O-v*A+w*C)*H,t[7]=(v*S-y*O-w*T)*H,t[8]=(y*A-_*S+w*x)*H,t):null}function hNe(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function dNe(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function pNe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function fNe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function ede(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function mNe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function gNe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t}function yNe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function _Ne(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=e[0],p=e[1],g=e[2],y=e[3],_=e[4],v=e[5],w=e[6],x=e[7],T=e[8],S=Qn();return Math.abs(r-d)<=S*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-p)<=S*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(s-g)<=S*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(n-y)<=S*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-_)<=S*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-v)<=S*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-w)<=S*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-x)<=S*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(u-T)<=S*Math.max(1,Math.abs(u),Math.abs(T))}function QV(t){const e=Qn(),r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+u*u))<=e}const vNe=qx,bNe=ede;Object.freeze(Object.defineProperty({__proto__:null,add:fNe,adjoint:sNe,copy:iNe,determinant:nNe,equals:_Ne,exactEquals:yNe,frob:pNe,fromMat2d:uNe,fromMat4:Iu,fromQuat:JV,fromRotation:lNe,fromScaling:cNe,fromTranslation:aNe,identity:YV,invert:Ov,isOrthoNormal:QV,mul:vNe,multiply:qx,multiplyScalar:mNe,multiplyScalarAndAdd:gNe,normalFromMat4:wm,normalFromMat4Legacy:Khe,projection:hNe,rotate:XV,scale:ZV,scaleByVec2:oNe,set:WV,str:dNe,sub:bNe,subtract:ede,translate:aI,transpose:Lu},Symbol.toStringTag,{value:"Module"}));function wNe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function BC(t,e,r){r*=.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function KV(t,e){const r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>Qn()?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function eG(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*u+o*a+s*c-n*l,t[1]=s*u+o*l+n*a-i*c,t[2]=n*u+o*c+i*l-s*a,t[3]=o*u-i*a-s*l-n*c,t}function xNe(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-i*a,t}function TNe(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l-n*a,t[1]=s*l+o*a,t[2]=n*l+i*a,t[3]=o*l-s*a,t}function SNe(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+s*a,t[1]=s*l-i*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function ENe(t,e){const r=e[0],i=e[1],s=e[2];return t[0]=r,t[1]=i,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-s*s)),t}function iM(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,u,d,p,g=r[0],y=r[1],_=r[2],v=r[3];return c=s*g+n*y+o*_+a*v,c<0&&(c=-c,g=-g,y=-y,_=-_,v=-v),1-c>Qn()?(l=Math.acos(c),u=Math.sin(l),d=Math.sin((1-i)*l)/u,p=Math.sin(i*l)/u):(d=1-i,p=i),t[0]=d*s+p*g,t[1]=d*n+p*y,t[2]=d*o+p*_,t[3]=d*a+p*v,t}function CNe(t){const e=A3,r=e(),i=e(),s=e(),n=Math.sqrt(1-r),o=Math.sqrt(r);return t[0]=n*Math.sin(2*Math.PI*i),t[1]=n*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function ANe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r*r+i*i+s*s+n*n,a=o?1/o:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-s*a,t[3]=n*a,t}function sv(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function tde(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;i=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*i,i=.5/i,t[3]=(e[3*n+o]-e[3*o+n])*i,t[n]=(e[3*n+s]+e[3*s+n])*i,t[o]=(e[3*o+s]+e[3*s+o])*i}return t}function RNe(t,e,r,i){const s=.5*Math.PI/180;e*=s,r*=s,i*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return t[0]=n*l*u-o*a*c,t[1]=o*a*u+n*l*c,t[2]=o*l*c-n*a*u,t[3]=o*l*u+n*a*c,t}function ONe(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const tG=Fh,PNe=Si,MNe=E7,$Ne=eG,INe=X1,LNe=qoe,DNe=R7,rde=C7,NNe=rde,ide=A7,FNe=ide,rG=Hoe,UNe=tx,kNe=Z1;function BNe(t,e,r){const i=de(e,r);return i<-.999999?(rt(vd,zNe,e),ml(vd)<1e-6&&rt(vd,VNe,e),pe(vd,vd),BC(t,vd,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(rt(vd,e,r),t[0]=vd[0],t[1]=vd[1],t[2]=vd[2],t[3]=1+i,rG(t,t))}const vd=E(),zNe=Te(1,0,0),VNe=Te(0,1,0);function GNe(t,e,r,i,s,n){return iM(VY,e,s,n),iM(GY,r,i,n),iM(t,VY,GY,2*n*(1-n)),t}const VY=Bu(),GY=Bu();function jNe(t,e,r,i){const s=HNe;return s[0]=r[0],s[3]=r[1],s[6]=r[2],s[1]=i[0],s[4]=i[1],s[7]=i[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],rG(t,tde(t,s))}const HNe=Fi();Object.freeze(Object.defineProperty({__proto__:null,add:MNe,calculateW:ENe,conjugate:sv,copy:tG,dot:LNe,equals:kNe,exactEquals:UNe,fromEuler:RNe,fromMat3:tde,getAxisAngle:KV,identity:wNe,invert:ANe,len:NNe,length:rde,lerp:DNe,mul:$Ne,multiply:eG,normalize:rG,random:CNe,rotateX:xNe,rotateY:TNe,rotateZ:SNe,rotationTo:BNe,scale:INe,set:PNe,setAxes:jNe,setAxisAngle:BC,slerp:iM,sqlerp:GNe,sqrLen:FNe,squaredLength:ide,str:ONe},Symbol.toStringTag,{value:"Module"}));let j3=class{constructor(e,r,i=r){this.data=e,this.size=r,this.stride=i}},Ue=class extends j3{constructor(e,r,i,s=!1,n=i){super(e,i,n),this.indices=r,this.exclusive=s}};const Wx=1e-6,cT=[0,0,0],uR=[0,0,0];function qNe(t,e){const{data:r,size:i}=t,s=r.length/i;if(s<=0)return;const n=new t4e(t);sM(cT,n.minProj,n.maxProj),i1(cT,cT,.5),du(uR,n.maxProj,n.minProj);const o=A9(uR),a=new r4e;a.quality=o,s<14&&(t=new j3(new Float64Array(n.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],u=[0,0,0],d=[0,0,0],p=[0,0,0],g=[0,0,0],y=[0,0,0];switch(WNe(n,t,y,l,c,u,d,p,g,a)){case 1:return void WY(cT,uR,e);case 2:return void e4e(t,d,e)}YNe(t,y,l,c,u,d,p,g,a),sde(t,a.b0,a.b1,a.b2,sx,nx);const _=[0,0,0];du(_,nx,sx),a.quality=A9(_),a.quality<o?nde(a.b0,a.b1,a.b2,sx,nx,_,e):WY(cT,uR,e)}function WNe(t,e,r,i,s,n,o,a,l,c){return XNe(t,i,s),R9(i,s)<Wx?1:(du(o,i,s),no(o,o),ZNe(e,i,o,n)<Wx?2:(du(a,s,n),no(a,a),du(l,n,i),no(l,l),pu(r,a,o),no(r,r),O_(e,r,o,a,l,c),0))}const uT=[0,0,0],hT=[0,0,0],Uc=[0,0,0],kc=[0,0,0],Bc=[0,0,0],eg=[0,0,0],tg=[0,0,0],rg=[0,0,0];function YNe(t,e,r,i,s,n,o,a,l){JNe(t,e,r,uT,hT),uT[0]!==void 0&&(du(Uc,uT,r),no(Uc,Uc),du(kc,uT,i),no(kc,kc),du(Bc,uT,s),no(Bc,Bc),pu(eg,kc,n),no(eg,eg),pu(tg,Bc,o),no(tg,tg),pu(rg,Uc,a),no(rg,rg),O_(t,eg,n,kc,Uc,l),O_(t,tg,o,Bc,kc,l),O_(t,rg,a,Uc,Bc,l)),hT[0]!==void 0&&(du(Uc,hT,r),no(Uc,Uc),du(kc,hT,i),no(kc,kc),du(Bc,hT,s),no(Bc,Bc),pu(eg,kc,n),no(eg,eg),pu(tg,Bc,o),no(tg,tg),pu(rg,Uc,a),no(rg,rg),O_(t,eg,n,kc,Uc,l),O_(t,tg,o,Bc,kc,l),O_(t,rg,a,Uc,Bc,l))}function XNe(t,e,r){let i=R9(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=R9(t.maxVert[n],t.minVert[n]);o>i&&(i=o,s=n)}Cl(e,t.minVert[s]),Cl(r,t.maxVert[s])}const zc=[0,0,0];function ZNe(t,e,r,i){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){zc[0]=s[l]-e[0],zc[1]=s[l+1]-e[1],zc[2]=s[l+2]-e[2];const c=r[0]*zc[0]+r[1]*zc[1]+r[2]*zc[2],u=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],d=zc[0]*zc[0]+zc[1]*zc[1]+zc[2]*zc[2]-c*c/u;d>o&&(o=d,a=l)}return Cl(i,s,a),o}const on=[0,0];function JNe(t,e,r,i,s){KNe(t,e,on,s,i);const n=ade(r,e);on[1]-Wx<=n&&(i[0]=void 0),on[0]+Wx>=n&&(s[0]=void 0)}const jY=[0,0,0],HY=[0,0,0],qY=[0,0,0],Hv=[0,0,0],qv=[0,0,0],hR=[0,0,0];function O_(t,e,r,i,s,n){if(ode(e)<Wx)return;pu(jY,r,e),pu(HY,i,e),pu(qY,s,e),ix(t,e,on),qv[1]=on[0],Hv[1]=on[1],hR[1]=Hv[1]-qv[1];const o=[r,i,s],a=[jY,HY,qY];for(let l=0;l<3;++l){ix(t,o[l],on),qv[0]=on[0],Hv[0]=on[1],ix(t,a[l],on),qv[2]=on[0],Hv[2]=on[1],hR[0]=Hv[0]-qv[0],hR[2]=Hv[2]-qv[2];const c=A9(hR);c<n.quality&&(Cl(n.b0,o[l]),Cl(n.b1,e),Cl(n.b2,a[l]),n.quality=c)}}const QNe=[0,0,0];function ix(t,e,r){const{data:i,size:s}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<i.length;n+=s){const o=i[n]*e[0]+i[n+1]*e[1]+i[n+2]*e[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function KNe(t,e,r,i,s){const{data:n,size:o}=t;Cl(i,n),Cl(s,i),r[0]=ade(QNe,e),r[1]=r[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<r[0]&&(r[0]=l,Cl(i,n,a)),l>r[1]&&(r[1]=l,Cl(s,n,a))}}function WY(t,e,r){Cl(r.center,t),i1(r.halfSize,e,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const lf=[0,0,0],Wv=[0,0,0],dT=[0,0,0],sx=[0,0,0],nx=[0,0,0],YY=[0,0,0];function e4e(t,e,r){Cl(lf,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?lf[0]=0:Math.abs(e[1])>Math.abs(e[2])?lf[1]=0:lf[2]=0,ode(lf)<Wx&&(lf[0]=lf[1]=lf[2]=1),pu(Wv,e,lf),no(Wv,Wv),pu(dT,e,Wv),no(dT,dT),sde(t,e,Wv,dT,sx,nx),du(YY,nx,sx),nde(e,Wv,dT,sx,nx,YY,r)}function sde(t,e,r,i,s,n){ix(t,e,on),s[0]=on[0],n[0]=on[1],ix(t,r,on),s[1]=on[0],n[1]=on[1],ix(t,i,on),s[2]=on[0],n[2]=on[1]}const dR=[0,0,0],bd=[1,0,0,0,1,0,0,0,1],Yv=[0,0,0];function nde(t,e,r,i,s,n,o){bd[0]=t[0],bd[1]=t[1],bd[2]=t[2],bd[3]=e[0],bd[4]=e[1],bd[5]=e[2],bd[6]=r[0],bd[7]=r[1],bd[8]=r[2],i4e(o.quaternion,bd),sM(Yv,i,s),i1(Yv,Yv,.5),i1(o.center,t,Yv[0]),i1(dR,e,Yv[1]),sM(o.center,o.center,dR),i1(dR,r,Yv[2]),sM(o.center,o.center,dR),i1(o.halfSize,n,.5)}const kl=7;let t4e=class{constructor(e){this.minVert=new Array(kl),this.maxVert=new Array(kl);const r=64*kl;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,kl),i+=8*kl,this.maxProj=new Float64Array(this.buffer,i,kl),i+=8*kl;for(let l=0;l<kl;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<kl;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<kl;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(kl),n=new Array(kl),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<kl;++l){let c=s[l];Cl(this.minVert[l],o,c),c=n[l],Cl(this.maxVert[l],o,c)}}},r4e=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function A9(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function sM(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2]}function du(t,e,r){t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2]}function i1(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}function Cl(t,e,r=0){t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2]}function pu(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o}function no(t,e){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){const i=1/Math.sqrt(r);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}}function ode(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function R9(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function ade(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function i4e(t,e){const r=e[0]+e[4]+e[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i}else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);const s=(i+1)%3,n=(i+2)%3;let o=Math.sqrt(e[3*i+i]-e[3*s+s]-e[3*n+n]+1);t[i]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+i]+e[3*i+s])*o,t[n]=(e[3*n+i]+e[3*i+n])*o}}const P1=Bu(),aa=E(),O9=E(),s4e=Fi();function iG(t=[0,0,0],e=[-1,-1,-1],r=Bu()){return{center:Ii(t),halfSize:Ii(e),quaternion:Uue(r)}}function XY(t){return iG(t.center,t.halfSize,t.quaternion)}function V0t(t,e){ie(e.center,t.center),ie(e.halfSize,t.halfSize),tG(e.quaternion,t.quaternion)}function G0t(t,e){return e=e||iG(),qNe(t,e),e}function P_(t,e){const r=Wr(e,t.center),i=GD(t,e);return r>i?1:r<-i?-1:0}function j0t(t,e){return aa[0]=t.center[0]-e[0],aa[1]=t.center[1]-e[1],aa[2]=t.center[2]-e[2],sv(P1,t.quaternion),Cp(aa,aa,P1),Ax(aa,aa),JL(O9,aa,t.halfSize),QL(O9,aa)<e[3]*e[3]}function H0t(t,e){e||(e=tn());const r=JV(s4e,t.quaternion),i=t.halfSize[0]*Math.abs(r[0])+t.halfSize[1]*Math.abs(r[3])+t.halfSize[2]*Math.abs(r[6]),s=t.halfSize[0]*Math.abs(r[1])+t.halfSize[1]*Math.abs(r[4])+t.halfSize[2]*Math.abs(r[7]),n=t.halfSize[0]*Math.abs(r[2])+t.halfSize[1]*Math.abs(r[5])+t.halfSize[2]*Math.abs(r[8]);return e[0]=t.center[0]-i,e[1]=t.center[1]-s,e[2]=t.center[2]-n,e[3]=t.center[0]+i,e[4]=t.center[1]+s,e[5]=t.center[2]+n,e}function q0t(t,e){return Wr(e,t.center)-GD(t,e)}function W0t(t,e){return Wr(e,t.center)+GD(t,e)}function Y0t(t,e){return P_(t,e[0])<=0&&P_(t,e[1])<=0&&P_(t,e[2])<=0&&P_(t,e[3])<=0&&P_(t,e[4])<=0&&P_(t,e[5])<=0}function X0t(t,e,r,i=0){sv(P1,t.quaternion),ce(aa,e,t.center);const s=Cp(aa,aa,P1),n=Cp(O9,r,P1);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(i+t.halfSize[l]-s[l])/n[l],u=(-i-t.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,u)),a=Math.min(a,Math.max(c,u))}else if(s[l]>t.halfSize[l]+i||s[l]<-t.halfSize[l]-i)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),t})();function GD(t,e){sv(P1,t.quaternion),Cp(aa,e,P1);const r=t.halfSize;return Math.abs(aa[0]*r[0])+Math.abs(aa[1]*r[1])+Math.abs(aa[2]*r[2])}function Z0t(t,e){for(let r=0;r<8;++r){const i=e[r];i[0]=1&r?-t.halfSize[0]:t.halfSize[0],i[1]=2&r?-t.halfSize[1]:t.halfSize[1],i[2]=4&r?-t.halfSize[2]:t.halfSize[2],Cp(i,i,t.quaternion),le(i,i,t.center)}}function n4e(t){return ml(t.halfSize)}function lde(t,e,r,i,s){if(tG(s.quaternion,t.quaternion),i===$e.Global){sv(pR,t.quaternion),Cp(ig,t.center,pR),Ax(Xv,ig),JL(Zv,Xv,t.halfSize),Rn(Zv,Xv,Zv);const n=_e(Zv);le(Zv,Xv,t.halfSize);const o=_e(Zv);if(n<r)ie(s.center,t.center),se(ig,r,r,r),le(s.halfSize,t.halfSize,ig);else{const a=o>0?1+e/o:1,l=n>0?1+r/n:1,c=(l+a)/2,u=(l-a)/2;ee(s.halfSize,Xv,u),Ga(s.halfSize,s.halfSize,t.halfSize,c),ee(s.center,Xv,c),Ga(s.center,s.center,t.halfSize,u),$$(ig,ig),ZL(s.center,s.center,ig),Cp(s.center,s.center,s.quaternion)}}else{const n=se(ig,0,0,1);Ga(s.center,t.center,n,(r+e)/2),sv(pR,t.quaternion),Cp(n,n,pR),Ax(n,n),Ga(s.halfSize,t.halfSize,n,(r-e)/2)}return s}const ig=E(),Xv=E(),Zv=E(),pR=Bu();let o4e=class{constructor(){this._transform=ge(),this._transformInverse=new fR({value:this._transform},Ls,ge),this._transformInverseTranspose=new fR(this._transformInverse,$l,ge),this._transformTranspose=new fR({value:this._transform},$l,ge),this._transformInverseRotation=new fR({value:this._transform},Khe,Fi)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Ss(this._transform,e)}multiplyTransform(e){Pr(this._transform,this._transform,e)}set(e){Ss(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,r){this.setTransformMatrix(e),this.multiplyTransform(r),this._invalidateLazyTransforms()}},fR=class{constructor(e,r,i){this._original=e,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},a4e=class{constructor(e=0){this.offset=e,this.tmpVertex=E()}applyToVertex(e,r,i){const s=se(lI,e,r,i),n=le(M9,s,this.localOrigin),o=this.offset/_e(n);return Ga(this.tmpVertex,s,n,o),this.tmpVertex}applyToAabb(e){const r=cde,i=ude,s=hde;for(let l=0;l<3;++l)r[l]=e[0+l]+this.localOrigin[l],i[l]=e[3+l]+this.localOrigin[l],s[l]=r[l];const n=this.applyToVertex(r[0],r[1],r[2]);for(let l=0;l<3;++l)e[l]=n[l],e[l+3]=n[l];const o=l=>{const c=this.applyToVertex(l[0],l[1],l[2]);for(let u=0;u<3;++u)e[u]=Math.min(e[u],c[u]),e[u+3]=Math.max(e[u+3],c[u])};for(let l=1;l<8;++l){for(let c=0;c<3;++c)s[c]=l&1<<c?i[c]:r[c];o(s)}let a=0;for(let l=0;l<3;++l)r[l]*i[l]<0&&(a|=1<<l);if(a!==0&&a!==7){for(let l=0;l<8;++l)if(!(a&l)){for(let c=0;c<3;++c)s[c]=a&1<<c?0:l&1<<c?r[c]:i[c];o(s)}}for(let l=0;l<3;++l)e[l]-=this.localOrigin[l],e[l+3]-=this.localOrigin[l];return e}},l4e=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=E(),this._mbs=ds(),this._obb=iG(),this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=_e(e)}applyToVertex(e,r,i){const s=se(lI,e,r,i),n=se(M9,e,r,i+this.componentLocalOriginLength),o=this._totalOffset/_e(n);return Ga(this._tmpVertex,s,n,o),this._tmpVertex}applyToAabb(e){const r=se(lI,e[0],e[1],e[2]+this.componentLocalOriginLength),i=se(M9,e[3],e[4],e[5]+this.componentLocalOriginLength),s=$$(cde,r),n=$$(ude,i),o=Ax(hde,r),a=Ax(d4e,i),l=JL(KY,o,a);l[0]=s[0]*n[0]<0?0:l[0],l[1]=s[1]*n[1]<0?0:l[1],l[2]=s[2]*n[2]<0?0:l[2];const c=_e(l);if(c<this._totalOffset)return e[0]-=r[0]<0?this._totalOffset:0,e[1]-=r[1]<0?this._totalOffset:0,e[2]-=r[2]<0?this._totalOffset:0,e[3]+=i[0]>0?this._totalOffset:0,e[4]+=i[1]>0?this._totalOffset:0,e[5]+=i[2]>0?this._totalOffset:0,e;const u=koe(KY,o,a),d=_e(u),p=this._totalOffset/d,g=this._totalOffset/c;return e[0]+=r[0]*(r[0]>0?p:g),e[1]+=r[1]*(r[1]>0?p:g),e[2]+=r[2]*(r[2]>0?p:g),e[3]+=i[0]*(i[0]<0?p:g),e[4]+=i[1]*(i[1]<0?p:g),e[5]+=i[2]*(i[2]<0?p:g),e}applyToMbs(e){const r=_e(e),i=this._totalOffset/r;return Ga(this._mbs,e,e,i),this._mbs[3]=e[3]+e[3]*this._totalOffset/r,this._mbs}applyToObb(e){return lde(e,this._totalOffset,this._totalOffset,$e.Global,this._obb),this._obb}},c4e=class{constructor(e=0){this.offset=e,this.sphere=ds(),this.tmpVertex=E()}applyToVertex(e,r,i){const s=this.objectTransform.transform,n=se(lI,e,r,i),o=De(n,n,s),a=this.offset/_e(o);Ga(o,o,o,a);const l=this.objectTransform.inverse;return De(this.tmpVertex,o,l),this.tmpVertex}applyToMinMax(e,r){const i=this.offset/_e(e);Ga(e,e,e,i);const s=this.offset/_e(r);Ga(r,r,r,s)}applyToAabb(e){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const r=_e(e),i=this.offset/r;return Ga(this.sphere,e,e,i),this.sphere[3]=e[3]+e[3]*this.offset/r,this.sphere}};const ZY=new c4e;function P9(t){return t!=null?(ZY.offset=t,ZY):null}const JY=new l4e;function u4e(t){return t!=null?(JY.offset=t,JY):null}const QY=new a4e;function h4e(t){return t!=null?(QY.offset=t,QY):null}const l0="terrain",lI=E(),M9=E(),cde=E(),ude=E(),hde=E(),d4e=E(),KY=E(),Yx=1e-5;let p4e=class{constructor(e){this.options=new eNe,this._results=new f4e,this.transform=new o4e,this.tolerance=Yx,this.verticalOffset=null,this._ray=ln(),this._rayEnd=E(),this._rayBeginTransformed=E(),this._rayEndTransformed=E(),this.viewingMode=e??$e.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,r,i){this.resetWithRay(rhe(e,r,this._ray),i)}resetWithRay(e,r){this.camera=r,e!==this._ray&&tI(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===$e.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,le(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,r,i,s,n){var a;this.point=r,this.filterPredicate=s,this.tolerance=i??Yx;const o=P9(this.verticalOffset);if(e&&e.length>0){const l=n?c=>{n(c)&&this.intersectObject(c)}:c=>{this.intersectObject(c)};for(const c of e){const u=(a=c.getSpatialQueryAccelerator)==null?void 0:a.call(c);u!=null?(o!=null?u.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,l,o):u.forEachAlongRay(this._ray.origin,this._ray.direction,l),this.options.selectionMode&&this.options.hud&&u.forEachDegenerateObject(l)):c.objects.forAll(d=>l(d))}}this.sortResults()}intersectObject(e){const r=e.geometries;if(!r)return;const i=e.effectiveTransformation,s=P9(this.verticalOffset);for(const n of r){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(i,n.transformation),De(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),De(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,u,d,p,g,y)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=p?this._results.hud:this._results,v=p?w=>{const x=new rNe(e,a,d,y);w.set(Mi.HUD,x,c,u,$i,g)}:w=>w.set(Mi.OBJECT,{object:e,geometryId:a,triangleNr:d},c,u,l,g);if((_.min.drapedLayerOrder==null||g>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&v(_.min),this.options.store!==Xn.MIN&&(_.max.drapedLayerOrder==null||g<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&v(_.max),this.options.store===Xn.ALL)if(p){const w=new $9(this._ray);v(w),this._results.hud.all.push(w)}else{const w=new ox(this._ray);v(w),this._results.all.push(w)}}})}}sortResults(e=this._results.all){e.sort((r,i)=>r.dist!==i.dist?(r.dist??0)-(i.dist??0):r.drapedLayerOrder!==i.drapedLayerOrder?(r.drapedLayerOrder??Number.MAX_VALUE)-(i.drapedLayerOrder??Number.MAX_VALUE):(i.drapedLayerGraphicOrder??Number.MIN_VALUE)-(r.drapedLayerGraphicOrder??Number.MIN_VALUE))}};function Du(t){return new p4e(t)}let f4e=class{constructor(){this.min=new ox(ln()),this.max=new ox(ln()),this.hud={min:new $9(ln()),max:new $9(ln()),all:new Array},this.ground=new ox(ln()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},ox=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(ee(mR,this.ray.direction,this.dist),_e(mR)):null}getIntersectionPoint(e){return!!hd(this)&&(ee(mR,this.ray.direction,this.dist),le(e,this.ray.origin,mR),!0)}getTransformedNormal(e){return ie(pT,this.normal),pT[3]=0,gc(pT,pT,this.transformation),ie(e,pT),pe(e,e)}constructor(e){this.intersector=Mi.OBJECT,this.normal=E(),this.transformation=ge(),this._ray=ln(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Mi.OBJECT,tI(e,this._ray)}set(e,r,i,s,n,o,a){this.intersector=e,this.dist=i,ie(this.normal,s??T7),Ss(this.transformation,n??$i),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){tI(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,ie(this.normal,e.normal),Ss(this.transformation,e.transformation)}},$9=class extends ox{constructor(){super(...arguments),this.intersector=Mi.HUD}};function sG(t){return new ox(t)}const mR=E(),pT=Jt();function dde(t,e,r,i){return t.renderCoordsHelper.fromRenderCoords(e.eye,cI,i)!=null&&$ae(r,cI)}function jD(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function Pv(t,e,r,i){const s=t.state.camera.clone();e&&r&&i&&(s.eye=e,s.center=r,s.up=i),m4e(t,s.ray,sg)||ie(sg,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(Yn(s.eye,sg)<o){const a=n.collision.enabled;ie(Py,s.viewForward),ee(Py,Py,o),a?s.eye=ce(cI,sg,Py):le(sg,s.eye,Py);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),u=n.collision.elevationMargin;a&&c<u&&(ce(Py,sg,s.eye),s.eye=l.setAltitude(cI,u,s.eye),le(sg,s.eye,Py))}return s.center=sg,s}function eX(t,e,r){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const i=jD(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,r,t.renderDataExtent,i,y4e),o=n*n;return Yn(e,r)>o}function m4e(t,e,r){let i=tX[t.viewingMode];i||(i=Du(t.state.viewingMode),i.options.backfacesTerrain=!t.state.isGlobal,i.options.invisibleTerrain=!0,tX[t.viewingMode]=i);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,i,r)||eX(t,e.origin,r))||!(!t.renderCoordsHelper.intersectManifold(e,0,r)||eX(t,e.origin,r))||!!s&&g4e(e,r,Mr(t.spatialReference).radius)}function g4e(t,e,r){const i=de(t.origin,t.origin)-r*r,s=i>0?Math.sqrt(i)/3:1;return ee(e,t.direction,s/_e(t.direction)),le(e,e,t.origin),!0}const tX={},cI=E(),sg=E(),Py=E(),y4e={near:0,far:0},_4e=E(),gR=E();function nG(){return{direction:E(),up:E()}}function pde(t,e,r,i,s){let n=pe(_4e,t),o=de(n,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(de(e,i)),o<.99?(ie(n,e),a&&ee(n,n,-1)):n=null);let l=0;if(n){ee(gR,i,de(i,n)),ce(n,n,gR);const u=de(n,s)/(_e(n)*_e(s));rt(gR,n,s),l=(de(gR,i)>0?1:-1)*_a(un(u))}const c=_a(un(-de(i,t)/_e(t)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const fde=Te(0,1,0),mde=Te(0,0,1),fT=ge(),cf=E(),uf=E();function gde(t,e,r,i=nG()){const{direction:s,up:n}=i;return oae(fT,-At(e)),Rx(fT,fT,At(r)),De(s,mde,fT),ee(s,s,-1),De(n,fde,fT),i}function v4e(t,e,r,i){return pde(e,r,i,mde,fde)}function b4e(t,e,r,i){const s=gde(t,r,i),n=E();return ee(n,s.direction,-e),le(n,n,t),{up:s.up,eye:n,heading:r,tilt:i}}function w4e(t){return _a(t)}function x4e(t){return At(t)}function yde(t,e,r,i,s){const n=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return Ll(e,cf,n),Ll(e,uf,n),cf[0]-=r/2,uf[0]+=r/2,cf[1]-=i/2,uf[1]+=i/2,mo(cf,n,cf,o),mo(uf,n,uf,o),s?(s.xmin=cf[0],s.ymin=cf[1],s.xmax=uf[0],s.ymax=uf[1],s.spatialReference=o):s=new Xr(cf[0],cf[1],uf[0],uf[1],o),s}const T4e=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:v4e,eyeForCenterWithHeadingTilt:b4e,eyeTiltToLookAtTilt:x4e,headingTiltToDirectionUp:gde,lookAtTiltToEyeTilt:w4e,toExtent:yde},Symbol.toStringTag,{value:"Module"}));function rX(t,e,r){if(e.longitude==null||e.latitude==null||r.longitude==null||r.latitude==null)throw new Error("Invalid points: no lon/lat");return S4e(t,e.longitude,e.latitude,r.longitude,r.latitude)}function S4e(t,e,r,i,s){const n=At(r),o=At(s),a=n-o,l=At(e)-At(i),c=Math.sin(a/2),u=Math.sin(l/2),d=2*Ru(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*u*u))*t;return Math.round(1e4*d)/1e4}function E4e(t,e,r){const i=e.spatialReference,s=Mr(i),n=new nt(e.x,t.y,i),o=new nt(r.x,t.y,i),a=new nt(t.x,e.y,i),l=new nt(t.x,r.y,i);return{lon:rX(s.radius,n,o),lat:rX(s.radius,a,l)}}function C4e(t,e,r){const i=e/r,s=At(t),n=Math.sin(i/2),o=Math.cos(s),a=2*Ru(Math.sqrt(n*n/(o*o)));return _a(a)}function A4e(t,e){let r=t/15;return e||(r=Math.round(r)),r}function iX(t,e){const r=t==null?void 0:t[0];if(r==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=A4e(r,!0);const i=e.hours%1;e.hours-=i,e.minutes=60*i;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}const _de=Te(0,0,1),vde=pe(E(),Te(1,1,1)),R4e=new G0(-180,180),mT=ge(),r0=E(),Jv=E();function bde(t,e,r,i=nG()){rt(r0,t,_de),de(r0,r0)===0&&rt(r0,t,vde),Mc(mT,-At(e),t),El(mT,mT,-At(r),r0);const{up:s,direction:n}=i;return rt(s,r0,t),pe(s,s),De(s,s,mT),pe(n,t),ko(n,n),De(n,n,mT),i}function O4e(t,e,r,i){const s=r0,n=Jv;return pe(s,t),rt(Jv,s,_de),de(Jv,Jv)===0&&rt(Jv,s,vde),rt(n,Jv,s),pde(e,r,i,s,n)}function P4e(t,e,r,i){const s={eye:E(),up:null,tilt:i,heading:r},n=r0;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=At(r),l=At(i),c=Math.sin(a),u=Math.cos(a),d=Math.sin(l),p=Math.cos(l),g=_e(n);let y;if(Math.abs(l)<1e-8)y=o+g;else{const J=g/d,P=Ru(o/J),I=Math.PI-l-P;y=J*Math.sin(I)}const _=p*o,v=o*o*(d*d),w=u*u*v,x=y-_,T=x*x,S=w*(w+T-n[1]*n[1]);if(S<0)return ee(s.eye,n,y/g),s.tilt=0,yR(s,t);const C=Math.sqrt(S),A=n[1]*x,O=w+T;let $;if($=u>0?-C+A:C+A,Math.abs(O)<1e-8)return g<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):ee(s.eye,n,y/g),s.tilt=0,V4(s.eye),yR(s,t);s.eye[1]=$/O;const D=c*c*v,N=d*o,z=u*N*s.eye[1],U=s.eye[1]*s.eye[1],Y=1-U,H=Math.sqrt(Y),V=w*U+D-2*z*H*x+Y*T;return Math.abs(V)<1e-8?(ee(s.eye,n,y/g),s.tilt=0,V4(s.eye),yR(s,t)):(s.eye[0]=(Y*(y*n[0]-_*n[0])-N*H*(n[0]*s.eye[1]*u+n[2]*c))/V,s.eye[2]=(Y*(y*n[2]-_*n[2])-N*H*(n[2]*s.eye[1]*u-n[0]*c))/V,ee(s.eye,s.eye,y),V4(s.eye),yR(s,t))}function V4(t){const e=t[1];t[1]=-t[2],t[2]=e}function yR(t,e){const r=bde(e,t.heading,t.tilt);return t.up=r.up,t}function M4e(t,e,r){const i=_e(e),s=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-t)),n=Ru(r/(s/Math.sin(t)));return _a(t-n)}function $4e(t,e,r){const i=At(t),s=_e(e);return Ru(r/(s/Math.sin(i)))+i}function wde(t,e,r,i,s){let n,o,a,l;const c=e.latitude,u=Mr(t.spatialReference).radius,d=e.longitude,p=C4e(c,r,u)/2;n=d-p,o=d+p;const g=At(c),y=(1+Math.sin(g))/(1-Math.sin(g)),_=(y+1)*Math.tan(i/u/2),v=_*_;function w(T){const S=Math.PI/2;return(T=XAe.normalize(T,-S))>S&&(T=Math.PI-T),T}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*y+v))),l=a+i/u,a=w(a),l=w(l),l<a){const T=l;l=a,a=T}if(a=Math.max(_a(a),-90),l=Math.min(_a(l),90),o=R4e.monotonic(n,o),o-n>180){const T=(o-n-180)/2;n+=T,o-=T}const x=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:at.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=x):s=new Xr(n,a,o,l,x),t.spatialReference&&t.spatialReference.isWebMercator&&O0(s,!1,s),s}const I4e=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:O4e,eyeForCenterWithHeadingTilt:P4e,eyeTiltToLookAtTilt:$4e,headingTiltToDirectionUp:bde,lookAtTiltToEyeTilt:M4e,toExtent:wde},Symbol.toStringTag,{value:"Module"}));function uI(t){return t.type==="point"}let oG=class{constructor(e,r=null,i=0){this.array=e,this.spatialReference=r,this.offset=i}};function xde(t){return"array"in t}function _p(t,e,r="ground"){if(uI(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,r);if(xde(e)){let i=e.offset;return t.getElevation(e.array[i++],e.array[i++],e.array[i]||0,e.spatialReference??t.spatialReference,r)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,r)}function I9(t,e){return t!=null&&(e==null||(e===$e.Local?!t.isGeographic||t.isWGS84||t.wkid===_u.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===_u.CGCS2000||t.wkid===_u.GCSMARS2000||t.wkid===_u.GCSMARS2000_SPHERE||t.wkid===_u.GCSMOON2000))}const Tde=ne.getLogger("esri.views.3d.support.cameraUtils"),Sde=39.37,Ede=96,L9=1,L4e=8,D4e=5,Cde=1,sX=E(),N4e={heading:0,tilt:0},FE=E(),F4e=new G0(-20037508342788905e-9,20037508342788905e-9),U4e=new G0(-180,180);var fo;function Im(t){return t.spatialReference??at.WGS84}function L2(t){return t.viewingMode==="global"?I4e:T4e}function k4e(t,e,r,i,s){return L2(t).headingTiltToDirectionUp(e,r,i,s)}function Bf(t,e){if(e==null)return null;const r=t.renderSpatialReference,i=L2(t).headingTiltToDirectionUp,s=E();if(!Ll(e.position,s,r))return null;const n=i(s,e.heading,e.tilt);ee(n.direction,n.direction,t.state.camera.distance),le(n.direction,n.direction,s);const o=Pv(t,s,n.direction,n.up);return o.fov=At(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(fo||(fo={}));const Qv=E();function Xx(t,e,r){const i=t.renderSpatialReference,s=qD(t,e.eye,e.viewForward,e.up,N4e);let n=Im(t);return mo(e.eye,i,Qv,n)||(n=at.WGS84,mo(e.eye,i,Qv,n)),r==null?new Il(new nt(Qv,n),s.heading,s.tilt,_a(e.fov)):(r.position.x=Qv[0],r.position.y=Qv[1],r.position.z=Qv[2],r.position.spatialReference=n,r.heading=s.heading,r.tilt=s.tilt,r.fov=_a(e.fov),r)}function HD(t,e,r){const i=t.state.camera,s=i.width/2/i.pixelRatio;return t.renderCoordsHelper.viewingMode===$e.Global&&r!=null&&(e*=Math.cos(At(r))),e/=t.renderCoordsHelper.unitInMeters,s/(Ede*Sde/e)/Math.tan(i.fovX/2)}function nv(t,e,r){const i=t.state.camera,s=e*Math.tan(i.fovX/2),n=i.width/2/i.pixelRatio;let o=Ede*Sde/(n/s);return t.renderCoordsHelper.viewingMode===$e.Global&&r!=null&&(o/=Math.cos(At(r))),o*t.renderCoordsHelper.unitInMeters}async function Ade(t,e,r,i,s,n){return Rde(t,e,HD(t,r,e.latitude),i,s,n)}function B4e(t,e,r,i,s,n){return Vde(t,aG(t,i.heading,i.tilt,e,r,s),i.fov,n)}async function Rde(t,e,r,i,s,n){const o=await Pde(t,i.heading,i.tilt,e,r,s,n);return wt(n),Gde(t,o,i.fov,n)}function qD(t,e,r,i,s){return L2(t).directionToHeadingTilt(e,r,i,s)}function Ode(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,FE,t.spatialReference)&&t.elevationProvider&&(_p(t.elevationProvider,FE)??0)>FE[2]-Cde)}async function z4e(t,e,r){if(Ode(t,e))return!0;const{elevationProvider:i,spatialReference:s,renderCoordsHelper:n}=t;if(i==null||!n.fromRenderCoords(e,FE,s))return!1;const[o,a,l]=FE,c=await i.queryElevation(o,a,l,s,"ground",r)??0;return wt(r),c>l-Cde}async function V4e(t,e,r){const i=E();if(e==null)return ie(i,t.state.camera.center);if(e instanceof nt){const{renderSpatialReference:s,basemapTerrain:n,elevationProvider:o}=t,a=e.spatialReference;if(await oI(e,i,s,0,{signal:r}),wt(r),e.z==null&&n!=null&&o!=null){const l=await o.queryElevation(e.x,e.y,e.z??0,a,"ground",r);wt(r),l!=null&&t.renderCoordsHelper.setAltitude(i,l)}return i}return ie(i,e)}function G4e(t,e){const r=E();if(e==null)return ie(r,t.state.camera.center);if(e instanceof nt){if(!Ll(e,r,t.renderSpatialReference))return null;const{basemapTerrain:i,elevationProvider:s}=t;if(e.z==null&&i!=null&&s!=null){const n=_p(s,e);n!=null&&t.renderCoordsHelper.setAltitude(r,n)}return r}return ie(r,e)}function aG(t,e,r,i,s,n){return Mde(t,e,r,i instanceof nt?i:null,G4e(t,i),s,n)}async function Pde(t,e,r,i,s,n,o){const a=i instanceof nt?i:null,l=await V4e(t,i,o);return wt(o),$de(t,e,r,a,l,s,n,o)}function Mde(t,e,r,i,s,n,o){if(s==null||(i??(i=bm(s,t.renderSpatialReference,Im(t))),i==null))return null;const a=Ide(t,e,r,s,n,o);if(Lde(t,r,o)&&Ode(t,a.eye)){const{tilt:l,mode:c}=Dde(t,r,s,n);return Mde(t,e,l,i,s,n,c)}return Nde(a,s)}async function $de(t,e,r,i,s,n,o,a){i??(i=await Jhe(s,t.renderSpatialReference,Im(t),{signal:a})),wt(a);const l=Ide(t,e,r,s,n,o);if(Lde(t,r,o)&&await z4e(t,l.eye,a)){wt(a);const{tilt:c,mode:u}=Dde(t,r,s,n);return $de(t,e,c,i,s,n,u,a)}return Nde(l,s)}function Ide(t,e,r,i,s,n){const o=H4e(t,e,r,i,s=Math.max(s,t.state.constraints.minimumPoiDistance),n);return(0,L2(t).eyeForCenterWithHeadingTilt)(i,s,o.heading,o.tilt)}function Lde(t,e,r){const i=t.map.ground.navigationConstraint;return r===fo.ADJUST&&t.viewingMode==="global"&&e>0&&(i==null||i.type==="stay-above")}function Dde(t,e,r,i){const s=zde(t,r,i,W4e(t,i,e,r));return{tilt:s,mode:e-s<1?fo.LOCKED:fo.ADJUST}}function Nde(t,e){return{...t,center:Ii(e)}}function Fde(t,e){const{state:r,spatialReference:i}=t,s=e.spatialReference;return r.isGlobal&&I9(s,$e.Global)||r.isLocal&&i.equals(s)}function Ude(t,e){let r,i,s;if(t.state.isGlobal){const u=new nt(e.xmin,e.ymin,e.spatialReference),d=new nt(e.xmax,e.ymax,e.spatialReference),p=e.spatialReference.isGeographic?U4e:F4e;r=new nt({x:p.center(u.x,d.x),y:(d.y+u.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const g=Mr(e.spatialReference),y=E4e(r,u,d);i=y.lon,s=y.lat,p.diff(u.x,d.x)>p.range/2&&(i+=g.halfCircumference),i=Math.min(i,g.halfCircumference),s=Math.min(s,g.halfCircumference)}else{const u=t.renderSpatialReference??e.spatialReference;u.equals(e.spatialReference)||(e=Pm(e,u)),i=e.xmax-e.xmin,s=e.ymax-e.ymin;const d=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;r=new nt({x:e.xmin+.5*i,y:e.ymin+.5*s,z:d,spatialReference:u})}const n=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,o=t.state.camera,a=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:r,distance:Math.max(.5*i*a,.5*s*l,.5*n*c)/L9}}async function kde(t,e,r,i,s,n){const o=Fde(t,e)?e:await kp(e,t.spatialReference,{signal:n});wt(n);const{center:a,distance:l}=Ude(t,o),c=await Pde(t,r,i,a,l,s,n);return wt(n),Gde(t,c,t.camera.fov,n)}function nM(t,e,r,i,s,n){let o;try{o=Fde(t,e)?e:Pm(e,t.spatialReference)}catch{return null}const{center:a,distance:l}=Ude(t,o),c=aG(t,r,i,a,l,s);return c==null?null:Vde(t,c,t.camera.fov,n)}function Bde(t,e,r){const i=t.renderSpatialReference,s=bm(r,i,Im(t));if(s==null)return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=R3(e.eye,r),l=2*a*n*L9,c=2*a*o*L9;return t.viewingMode==="global"?wde(t,s,l,c):yde(t,s,l,c)}function j4e(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>L4e)return!0;const s=t.renderSpatialReference,n=Im(t),o=bm(e,s,n),a=bm(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(o==null||a==null)return!1;const l=Math.tan(.5*t.state.camera.fov)*i;return a.distance(o)/l>D4e}function H4e(t,e,r,i,s,n){let o=0;return n===fo.ADJUST&&j4e(t,i,s)?(e=0,o=q4e(t,s,r,i)):o=lG(t,i,s,r),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:r=zde(t,i,s,o)}}const hI=.7;function q4e(t,e,r,i){const s=lG(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-hI)+n.max*hI;return Math.min(s,o)}function W4e(t,e,r,i){let s=lG(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-hI)+s*hI}function zde(t,e,r,i){return L2(t).lookAtTiltToEyeTilt(i,e,r)}function lG(t,e,r,i){return L2(t).eyeTiltToLookAtTilt(i,e,r)}function Vde(t,e,r,i){if(e==null)return null;const s=t.renderSpatialReference,n=bm(e.eye,s,Im(t));return n==null?null:(i??(i=new Il),i.position=n,i.heading=e.heading,i.tilt=e.tilt,i.fov=r,i)}async function Gde(t,e,r,i){const s=t.renderSpatialReference,n=await Jhe(e.eye,s,Im(t),{signal:i});return wt(i),new Il(n,e.heading,e.tilt,r)}function Y4e(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(e);Tde.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function jde(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(e);Tde.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function Hde(t,e){return mo(e.center,t.renderSpatialReference,sX,at.WGS84),nv(t,e.distance,sX[1])}const cG=ne.getLogger("esri.layers.support.ElevationSampler");let qde=class{queryElevation(e){return Wde(e.clone(),this)}on(){return Rr()}projectIfRequired(e,r){return Yde(e,r)}},X4e=class extends qde{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){super(),this.tile=e,this.noDataValue=i;const s=e.tile.extent;this.extent=nD(s,r.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=qo(r.spatialReference),o=r.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const r=this.projectIfRequired(e,this.spatialReference);return r!=null&&this.containsAt(r.x,r.y)}containsAt(e,r){return oD(this._aaExtent,e,r)}elevationAt(e,r){if(!this.containsAt(e,r)){const i=this.extent,s=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return cG.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return this.tile.sample(e,r)??this.noDataValue}},cyt=class extends qde{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){let s;super(),typeof r=="number"?(this.noDataValue=r,s=null):(s=r,this.noDataValue=i),this.samplers=s?e.map(o=>new X4e(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=nD(Gt(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,r){for(const i of this.samplers)if(i.containsAt(e,r))return i.elevationAt(e,r);return cG.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler`),this.noDataValue}};function Wde(t,e){const r=Yde(t,e.spatialReference);if(!r)return null;switch(t.type){case"point":Z4e(t,r,e);break;case"polyline":J4e(t,r,e);break;case"multipoint":Q4e(t,r,e)}return t}function Yde(t,e){if(t==null)return null;const r=t.spatialReference;if(r.equals(e))return t;const i=C3(t,e);return i||cG.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),i}function Z4e(t,e,r){t.z=r.elevationAt(e.x,e.y)}function J4e(t,e,r){dp.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];dp.x=c[0],dp.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(dp.x,dp.y)}}t.hasZ=!0}function Q4e(t,e,r){dp.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];dp.x=o[0],dp.y=o[1],i&&(n[3]=n[2]),n[2]=r.elevationAt(dp.x,dp.y)}t.hasZ=!0}const dp=new nt;var D9;let Yd=D9=class extends st{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new D9({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Yd.prototype,"cols",void 0),h([f({type:Qs,json:{write:!0}})],Yd.prototype,"level",void 0),h([f({type:String,json:{write:!0}})],Yd.prototype,"levelValue",void 0),h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Yd.prototype,"origin",void 0),h([f({type:Number,json:{write:!0}})],Yd.prototype,"resolution",void 0),h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Yd.prototype,"rows",void 0),h([f({type:Number,json:{write:!0}})],Yd.prototype,"scale",void 0),Yd=D9=h([k("esri.layers.support.LOD")],Yd);const $h=Yd;let K4e=class{constructor(e,r,i,s,n=void 0){this.id=e,this.level=r,this.row=i,this.col=s,this.extent=n}};var zg;const nX=new Pc({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let So=zg=class extends st{static create(t={}){const{resolutionFactor:e=1,scales:r,size:i=256,spatialReference:s=at.WebMercator,numLODs:n=24}=t;if(!No(s)){const d=[];if(r)for(let p=0;p<r.length;p++){const g=r[p];d.push(new $h({level:p,scale:g,resolution:g}))}else{let p=5e-4;for(let g=n-1;g>=0;g--)d.unshift(new $h({level:g,scale:p,resolution:p})),p*=2}return new zg({dpi:96,lods:d,origin:new nt(0,0,s),size:[i,i],spatialReference:s})}const o=qh(s),a=t.origin?new nt({x:t.origin.x,y:t.origin.y,spatialReference:s}):new nt(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(qo(s)*39.37*l),u=[];if(r)for(let d=0;d<r.length;d++){const p=r[d],g=p*c;u.push(new $h({level:d,scale:p,resolution:g}))}else{let d=h7(s)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const p=Math.ceil(n/e);u.push(new $h({level:0,scale:d,resolution:d*c}));for(let g=1;g<p;g++){const y=d/2**e,_=y*c;u.push(new $h({level:g,scale:y,resolution:_})),d=y}}return new zg({dpi:l,lods:u,origin:a,size:[i,i],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const r=qh(t);return t.isWrappable&&!!r&&Math.abs(r.origin[0]-e.x)<=r.dx}return!1}readOrigin(t,e){return nt.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,r=0;const i=[],s=this._levelToLOD={};t&&(e=-1/0,r=1/0,t.forEach(n=>{i.push(n.scale),e=n.scale>e?n.scale:e,r=n.scale<r?n.scale:r,s[n.level]=n})),this._set("scales",i),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const r=Math.floor(t),i=r+1;return e[r]/(e[r]/e[i])**(t-r)}scaleToZoom(t){const e=this.scales,r=e.length-1;let i=0;for(;i<r;i++){const s=e[i],n=e[i+1];if(s<=t)return i;if(n===t)return i+1;if(s>t&&n<t)return i+Math.log(s/t)/Math.log(s/n)}return i}snapScale(t,e=.95){const r=this.scaleToZoom(t);return r%Math.floor(r)>=e?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(t,e,r,i){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=r;else if(hs(e.spatialReference,this.spatialReference))n=e.x,o=e.y,i=r;else{const c=C3(e,this.spatialReference);if(c==null)return null;n=c.x,o=c.y,i=r}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return i||(i=new K4e(null,0,0,0,Gt())),i.level=t,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(t,e=zg.ExtrapolateOptions.NONE){let r=this.lodAt(t.level);if(!r&&e===zg.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(r=o)}if(!r)return;const i=t.level-r.level,s=r.resolution*this.size[0]/2**i,n=r.resolution*this.size[1]/2**i;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=Gt()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const r=this.lodAt(e.level);if(r==null)return null;const{resolution:i}=r,s=i*this.size[0],n=i*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return zg.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const r=[],i=this.lods.length;for(let s=0;s<i;s++){const n=this.lods[s],o=n.resolution*e;r.push(new $h({level:n.level,scale:n.scale,resolution:o}))}return new zg({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let r=0;r<t.length;r++){const i=t[r];this._upsampleLevels[i.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/i.resolution:0},e=i}}};h([f({type:Number,json:{write:!0}})],So.prototype,"compressionQuality",void 0),h([f({type:Number,json:{write:!0}})],So.prototype,"dpi",void 0),h([f({type:String,json:{read:nX.read,write:nX.write,origins:{"web-scene":{read:!1,write:!1}}}})],So.prototype,"format",void 0),h([f({readOnly:!0})],So.prototype,"isWrappable",null),h([f({type:nt,json:{write:!0}})],So.prototype,"origin",void 0),h([si("origin")],So.prototype,"readOrigin",null),h([f({type:[$h],value:null,json:{write:!0}})],So.prototype,"lods",null),h([f({readOnly:!0})],So.prototype,"scales",void 0),h([f({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],So.prototype,"size",void 0),h([si("size",["rows","cols"])],So.prototype,"readSize",null),h([ni("size",{cols:{type:Qs},rows:{type:Qs}})],So.prototype,"writeSize",null),h([f({type:at,json:{write:!0}})],So.prototype,"spatialReference",void 0),So=zg=h([k("esri.layers.support.TileInfo")],So),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(So||(So={}));const oM=So,e5e=12;let wl=class $a{constructor(e){const r=$a.checkUnsupported(e);if(r!=null)throw r;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=Y0(this.spatialReference)||Wp(this.spatialReference)||Yp(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const s=i.lods.reduce((c,u,d)=>(u.level<c.min&&(c.min=u.level,c.minIndex=d),c.max=Math.max(c.max,u.level),c),{min:1/0,minIndex:0,max:-1/0}),n=i.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new $a(this.toTileInfo())}toTileInfo(){return new oM({dpi:this.dpi,origin:new nt({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,r)=>new $h({level:r,scale:e.scale,resolution:e.resolution}))})}getExtent(e,r,i,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+i*o,s[2]=this.origin[0]+(i+1)*o,s[3]=this.origin[1]-r*a,s[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(e,r){this._isWebMercator?(r[0]=Xq(e[0]),r[1]=R$(e[1]),r[2]=Xq(e[2]),r[3]=R$(e[3])):this._isGCS&&(r[0]=At(e[0]),r[1]=At(e[1]),r[2]=At(e[2]),r[3]=At(e[3]))}getExtentGeometry(e,r,i,s=new Xr){return this.getExtent(e,r,i,wd),s.spatialReference=this.spatialReference,s.xmin=wd[0],s.ymin=wd[1],s.xmax=wd[2],s.ymax=wd[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let r=!1;for(;this.levels.length<=e;){const i=this.levels[this.levels.length-1],s=i.resolution/2;this.levels.push({resolution:s,scale:i.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),r=!0}return r}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const r=this.levels[0].scale;return e>=r?0:Math.log(r/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof $a)){if($a.checkUnsupported(e))return!1;e=new $a(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[r].resolution;let s=.5*i;return!P0(e.origin[0],this.origin[0],s)||!P0(e.origin[1],this.origin[1],s)?!1:(s=.5*i/2**r/this.pixelSize*e5e,P0(i,e.levels[r].resolution,s))}rootTilesInExtent(e,r=null,i=1/0){const s=new Array,n=this.levels[0].tileSize;if(e==null||n[0]===0||n[1]===0)return s;$a.computeRowColExtent(e,n,this.origin,wd);let o=wd[1],a=wd[3],l=wd[0],c=wd[2];const u=c-l,d=a-o;if(u*d>i){const p=Math.floor(Math.sqrt(i));d>p&&(o=o+Math.floor(.5*d)-Math.floor(.5*p),a=o+p),u>p&&(l=l+Math.floor(.5*u)-Math.floor(.5*p),c=l+p)}for(let p=o;p<a;p++)for(let g=l;g<c;g++)s.push([0,p,g]);return r!=null&&(r[0]=this.origin[0]+l*n[0],r[1]=this.origin[1]-a*n[1],r[2]=this.origin[0]+c*n[0],r[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,r,i,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-i[0])/r[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-i[0])/r[0])),s[1]=Math.max(0,Math.floor((i[1]-e[3]+n)/r[1])),s[3]=Math.max(0,Math.ceil((i[1]-e[1]-n)/r[1]))}static isPowerOfTwo(e){const r=e.lods,i=r[0].resolution*2**r[0].level;return!r.some(s=>!x3e(s.resolution,i/2**s.level))}static hasGapInLevels(e){const r=e.lods.map(i=>i.level);r.sort((i,s)=>i-s);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(e){const r=e.size[1];return r===e.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(e){const r=e.origin;return e.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new X("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?uG():e.lods.length<1?new X("tilingscheme:generic","Tiling scheme must have at least one level"):$a.isPowerOfTwo(e)?$a.hasGapInLevels(e)?new X("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):$a.tileSizeSupported(e)?$a.hasOriginPerLODs(e)?new X("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new X("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new X("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,r){const i=e[2]-e[0],s=e[3]-e[1],n=qo(r),o=1.2*Math.max(i,s),a=256,l=96,c=.0254,u=new $a(new oM({size:[a,a],origin:new nt({x:e[0]-.5*(o-i),y:e[3]+.5*(o-s)}),lods:[new $h({level:0,resolution:o/a,scale:1/(a/l*c/(o*n))})],spatialReference:r}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(e){const r=new $a($a.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(e),r}static makeGCSWithTileSize(e,r=256,i=16){const s=256/r,n=new $a(new oM({size:[r,r],origin:new nt({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new $h({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(i),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function uG(){return new X("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}wl.WebMercatorAuxiliarySphereTileInfo=new oM({size:[256,256],origin:new nt({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:at.WebMercator}),spatialReference:at.WebMercator,lods:[new $h({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),wl.WebMercatorAuxiliarySphere=wl.makeWebMercatorAuxiliarySphere(19);const wd=Gt(),Fw=64,CS=512,t5e=2.5,zC=T3e(N8/10),Xde=2,Zde=Gt();wl.WebMercatorAuxiliarySphere.getExtent(0,0,0,Zde);const r5e=Gt([-180,-90,180,90]),i5e="Cannot extend surface to encompass all layers because it would result in too many root tiles.",s5e="Surface extent is too large for tile resolution at level 0.",n5e=3;let o5e=n5e;function N9(t){return t<4?3:o5e}let Vg=class extends Ps.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=zC}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if((e==null?void 0:e.extent)==null||e.spatialReference==null)return null;const r=nD(e.extent,e.spatialReference);return r.zmin=e.visibleElevationBounds.min,r.zmax=e.visibleElevationBounds.max,r}get spatialReference(){var e;return((e=this.view.basemapTerrain)==null?void 0:e.spatialReference)??at.WGS84}elevationAt(e,r){var i;if(this.extent==null||!oa(this.extent,e,r)){const s=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return ne.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return((i=this.view.elevationProvider)==null?void 0:i.getElevation(e,r,0,this.spatialReference,"ground"))??this.noDataValue}queryElevation(e){return Wde(e.clone(),this)}};h([f({readOnly:!0})],Vg.prototype,"demResolution",void 0),h([f({readOnly:!0})],Vg.prototype,"extent",null),h([f({readOnly:!0})],Vg.prototype,"noDataValue",void 0),h([f()],Vg.prototype,"spatialReference",null),h([f({constructOnly:!0})],Vg.prototype,"view",void 0),Vg=h([k("esri.views.support.GroundViewElevationSampler")],Vg);const a5e=Vg;let $f=class extends xe{constructor(e){super(e),this.view=null,this.layerViews=new St}initialize(){this.addHandles($u(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground},e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new a5e({view:this.view}):null:null}get extent(){const e=this.view;return e&&e.type!=="2d"&&e.ready?Bde(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>ae(()=>e.updating,()=>this._updateUpdating(),Fr)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};h([f({readOnly:!0})],$f.prototype,"elevationSampler",null),h([f({readOnly:!0})],$f.prototype,"extent",null),h([f({type:Boolean,readOnly:!0})],$f.prototype,"updating",null),h([f({constructOnly:!0})],$f.prototype,"view",void 0),h([f({type:St,readOnly:!0})],$f.prototype,"layerViews",void 0),h([f({readOnly:!0})],$f.prototype,"suspended",null),$f=h([k("esri.views.GroundView")],$f);const l5e=$f;let xm=class{constructor(e,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in e){const s=e[i],n=new rne(s,void 0,void 0,2,2);this._properties[i]={pool:n,acquired:[]}}this._afterDispatchHandle=fne(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const r=this._properties[e];for(const i of r.acquired)Rq(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(e){const r=this._owner._get(e),i=this._properties[e];let s=i.pool.acquire();for(i.acquired.push(s);s===r;)i.acquired.push(s),s=i.pool.acquire();return s}_release(){for(const e in this._properties){const r=this._properties[e];let i=0;for(const s of r.acquired)Rq(s)?r.acquired[i++]=s:r.pool.release(s);r.acquired.length=i}}};const c5e=te("mac")?"Meta":"Ctrl",WD={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)WD[t]=String.fromCharCode(t);for(let t=1;t<25;t++)WD[111+t]=`F${t}`;for(let t=65;t<91;t++)WD[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function u5e(t){if(t.key!==void 0)return N2e(t);const e=WD[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function h5e(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let d5e=class{constructor(e,r=[]){this.eventType=e,this.keyModifiers=r}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=e.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}};const oX=ne.getLogger("esri.views.input.InputHandler");let Kn=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const r=this._incoming[e];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?oX.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(r=>this._handleEvent(r)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,r,i){let s;typeof r=="function"?(i=r,s=[]):s=r||[];const n=typeof e=="string"?new d5e(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=u=>{const d=this._incoming[u.match.eventType];if(d){const p=d.indexOf(u);d.splice(p,1),o(),this._manager&&this._manager.updateDependencies()}},l=new p5e(n,i,{onPause:a,onRemove:a,onResume:u=>{const d=this._incoming[u.match.eventType];d&&!d.includes(u)&&(d.push(u),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const r=new f5e(e,{onEmit:(i,s,n,o)=>{var a;(a=this._manager)==null||a.emit(i.eventType,s,n,o)},onRemove:i=>{var s;delete this._outgoing[i.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[e]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!0)}stopCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):oX.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var i;const r=this._incoming[e.type];if(r){for(const s of r)if(s.match.matches(e)&&((i=s.callback)==null||i.call(s,e),e.shouldStopPropagation()))break}}},p5e=class{constructor(e,r,i){this.match=e,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},f5e=class{constructor(e,r){this.eventType=e,this._removed=!1,this._handler=r}emit(e,r,i){this._removed||this._handler.onEmit(this,e,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},m5e=class extends Kn{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(e){const r=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:s}=e;r===this._value&&this._x===i&&this._y===s||(this._value=r,this._x=i,this._y=s,this._onChange(r,i,s))}},g5e=class{constructor(e,r){this._observable=new E3,this._value=e,this._equalityFunction=r}get value(){return xt(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function Zx(t,e=Nse){return new g5e(t,e)}let y5e=class extends Kn{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=Zx(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},Jc=class extends xe{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=c5e,this._latestPointerType="mouse",this._propertiesPool=new xm({latestPointerLocation:b5e},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const r of e)this.uninstallHandlers(r);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,r,i=$0.INTERNAL){if(this._nameToGroup[e])return void ne.getLogger(this).error("There is already an InputHandler group registered under the name `"+e+"`");if(r.length===0)return void ne.getLogger(this).error("Can't register a group of zero handlers");const s={name:e,handlers:r.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,u,d)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,d,u)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const r=this._nameToGroup[e];r?(r.handlers.forEach(i=>{var s;i.removed=!0,(s=i.uninstallCallback)==null||s.call(i)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):ne.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,r=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const s=this._handlers[i];s.priorityIndex=i,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const s=this._handlersPriority[i];s.priorityIndex=i;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)h5e(a)||r.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=r,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,r,i){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(s==null||s.x!==r||s.y!==i){const n=this._propertiesPool.get("latestPointerLocation");n.x=r,n.y=i,this._set("latestPointerLocation",n)}}_onEventReceived(e,r){if(e==="pointer-capture-lost"){const n=r;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,r);const i=this.test.timestamp!=null?this.test.timestamp:r.native?r.native.timestamp:void 0,s=r.native?r.native.cancelable:void 0;this._emitInputEventFromSource(e,r,i,s)}_updateKeyModifiers(e,r){if(!r)return;let i=!1;const s=()=>{if(!i){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,i=!0}},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=r.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=r.native;n("Alt",!(!o||!o.altKey)),n("Ctrl",!(!o||!o.ctrlKey)),n("Shift",!(!o||!o.shiftKey)),n("Meta",!(!o||!o.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new m5e((e,r,i)=>this._setLatestPointer(e,r,i)),this._multiTouchHandler=new y5e,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],$0.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,$0.INTERNAL)}_setPointerCapture(e,r,i,s){const n=e.name+"-"+r.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,r,i,s){this._emitInputEvent(0,e,r,i,s)}_emitInputEvent(e,r,i,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new _5e(r,i,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new Z$,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var r,i,s;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:n,priorityIndex:o}=e.events.pop(),a=(r=n.data)==null?void 0:r.eventId;if(!(a!=null&&this._stoppedPropagationEventIds.has(a)))for(e.currentHandler=this._handlersPriority[o];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!n.shouldStopPropagation()&&((s=(i=e.currentHandler).eventCallback)==null||s.call(i,n)),n.shouldStopPropagation()){a!=null&&this._stoppedPropagationEventIds.add(a);break}if(n.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:n,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const r=new Z$;r.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)r.push(i.events.pop());i.events=r,i.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,r){if(e.handler.hasSideEffects!==r.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==r.groupPriority)return e.groupPriority>r.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const s of r.handler.incomingEventMatches){if(i.eventType!==s.eventType)continue;const n=i.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===i.keyModifiers.length!=(n.length===s.keyModifiers.length))return i.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>r.priorityIndex?-1:1}_sortHandlersPriority(e){const r=[];for(const i of e){let s=0;for(;s<r.length&&this._compareHandlerPriority(i,r[s])>=0;)s++;r.splice(s,0,i)}return r}get debug(){const e=r=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},r(),this._setPointerCapture=i};return{injectEvent:(r,i)=>{e(()=>{this._onEventReceived(r,i)})},disablePointerCapture:e}}};h([f({readOnly:!0})],Jc.prototype,"hasPendingInputs",null),h([f({constructOnly:!0})],Jc.prototype,"eventSource",void 0),h([f({constructOnly:!0})],Jc.prototype,"recognizers",void 0),h([f()],Jc.prototype,"_latestPointerType",void 0),h([f()],Jc.prototype,"latestPointerType",null),h([f()],Jc.prototype,"multiTouchActive",null),h([f({readOnly:!0})],Jc.prototype,"latestPointerLocation",void 0),h([f()],Jc.prototype,"_paused",void 0),h([f({readOnly:!0})],Jc.prototype,"updating",null),Jc=h([k("esri.views.input.InputManager")],Jc);let _5e=class{constructor(e,r,i,s,n){this.type=e,this.data=r,this.timestamp=i,this.modifiers=s,this.cancelable=n,this._propagationState=i0.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=i0.STOPPED}shouldStopPropagation(){return(this._propagationState&i0.STOPPED)!=0}async(e){this._propagationState|=i0.PAUSED;const r=(i,s)=>{this._propagationState&=~i0.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw i;return i};return(typeof e=="function"?e():e).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(e){return!!(this._propagationState&i0.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var i0;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(i0||(i0={}));const $0={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let v5e=class{};const b5e=v5e;function xd(t){return t!=null&&"open"in t&&"declaredClass"in t}function aX(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const w5e=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([ae(()=>[this.ui,this.popup],([r,i],s)=>{const n="popup",o="manual";if(s){const[a,l]=s;a&&xd(l)&&(l.view=null,aX(l)&&a.remove(l,n))}r&&xd(i)&&(i.view=this,aX(i)&&r.add(i,{key:n,position:o,internal:!0}))},zr),this.on("click",r=>{this.popup&&this.popupEnabled&&(r.pointerType!=="mouse"||r.button===0)&&(!xd(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(xd(this.popup)?this.popup.viewModel.handleViewClick(r):r.async(async()=>{await this.setupPopup(),xd(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(r)})))},$0.WIDGET)]),Fx(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{he(()=>import("./Popup-80941f4a.js"),["./Popup-80941f4a.js","./unitFormatUtils-503fe940.js","./AttachmentInfo-3b227de1.js","./AttachmentQuery-c73fbbfb.js","./utils-5dc09d08.js","./widget-f26105cd.js","./ColorStop-2602b4bf.js","./jsonUtils-46c07947.js","./UniqueValueRenderer-3d9243c5.js","./diffUtils-ef6bbcbf.js","./colorRamps-b2150d6f.js","./DictionaryLoader-4dd3c670.js","./FieldsIndex-6b49ca64.js","./UnknownTimeZone-ab7c6b01.js","./heatmapUtils-2351b1fb.js","./Query-8ec96004.js","./executeQueryJSON-f5d40ce3.js","./query-0260ec48.js","./pbfQueryUtils-13f6e3b7.js","./pbf-16158dc0.js","./queryZScale-f8e7b210.js","./FeatureSet-444cbc0f.js","./RelationshipQuery-25c3c532.js","./TopFeaturesQuery-61f4fc16.js","./FeatureLayer-0e0c57d1.js","./MultiOriginJSONSupport-9addf1b7.js","./FeatureLayerBase-8013eb8f.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./featureLayerUtils-9cc96c71.js","./featureQueryAll-ec4a11be.js","./LayerFloorInfo-039148db.js","./serviceCapabilitiesUtils-91567898.js","./editsZScale-d6a84b25.js","./APIKeyMixin-fb65fce7.js","./ArcGISService-377485dc.js","./BlendLayer-d14012f0.js","./jsonUtils-9ebed520.js","./CustomParametersMixin-50d5a4c8.js","./EditBusLayer-525e2b98.js","./FeatureEffectLayer-b5512874.js","./FeatureEffect-01234d29.js","./FeatureFilter-22854955.js","./FeatureReductionLayer-a16eba95.js","./FeatureReductionSelection-02d3f160.js","./LabelClass-f01c9855.js","./defaults-06f3d090.js","./defaultsJSON-59981e75.js","./MD5-715f37cd.js","./OperationalLayer-381cacc8.js","./OrderedLayer-2db1a879.js","./PortalLayer-806db449.js","./portalItemUtils-bd3ade0c.js","./ScaleRangeLayer-47bc8cb3.js","./TemporalLayer-a67ca634.js","./FeatureTemplate-40f36ca2.js","./FeatureType-baed6dd6.js","./fieldProperties-8bc1b40a.js","./labelingInfo-c32eb8fe.js","./versionUtils-abea1fa8.js","./styleUtils-5179403f.js","./popupUtils-87764fa9.js","./interfaces-f1f22245.js","./ReactiveSet-96dea6cb.js"],import.meta.url)})}destroy(){this.destroyed||this.closePopup()}async openPopup(r){if(xd(this.popup))return this.popup.open(r);try{if(await this.setupPopup(),!this.popup)return void ne.getLogger(this).error(new X("view:null-popup","Popup is null and can't be opened"));this.popup.open(r)}catch{}}closePopup(){var r;(r=this._popupSetupTask)==null||r.abort(),xd(this.popup)&&this.popup.close()}async fetchPopupFeatures(r,i){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(r,i),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,i),u=c.map(d=>d.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:U2e([l,...u]).then(d=>Array.from(new Set(d.flat()))),promisesPerLayerView:c}}async setupPopup(){var r;if((r=this._popupSetupTask)==null||r.abort(),this.popup&&!xd(this.popup))return this._popupSetupTask=cy(async i=>{const{default:s}=await he(()=>import("./Popup-80941f4a.js"),["./Popup-80941f4a.js","./unitFormatUtils-503fe940.js","./AttachmentInfo-3b227de1.js","./AttachmentQuery-c73fbbfb.js","./utils-5dc09d08.js","./widget-f26105cd.js","./ColorStop-2602b4bf.js","./jsonUtils-46c07947.js","./UniqueValueRenderer-3d9243c5.js","./diffUtils-ef6bbcbf.js","./colorRamps-b2150d6f.js","./DictionaryLoader-4dd3c670.js","./FieldsIndex-6b49ca64.js","./UnknownTimeZone-ab7c6b01.js","./heatmapUtils-2351b1fb.js","./Query-8ec96004.js","./executeQueryJSON-f5d40ce3.js","./query-0260ec48.js","./pbfQueryUtils-13f6e3b7.js","./pbf-16158dc0.js","./queryZScale-f8e7b210.js","./FeatureSet-444cbc0f.js","./RelationshipQuery-25c3c532.js","./TopFeaturesQuery-61f4fc16.js","./FeatureLayer-0e0c57d1.js","./MultiOriginJSONSupport-9addf1b7.js","./FeatureLayerBase-8013eb8f.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./featureLayerUtils-9cc96c71.js","./featureQueryAll-ec4a11be.js","./LayerFloorInfo-039148db.js","./serviceCapabilitiesUtils-91567898.js","./editsZScale-d6a84b25.js","./APIKeyMixin-fb65fce7.js","./ArcGISService-377485dc.js","./BlendLayer-d14012f0.js","./jsonUtils-9ebed520.js","./CustomParametersMixin-50d5a4c8.js","./EditBusLayer-525e2b98.js","./FeatureEffectLayer-b5512874.js","./FeatureEffect-01234d29.js","./FeatureFilter-22854955.js","./FeatureReductionLayer-a16eba95.js","./FeatureReductionSelection-02d3f160.js","./LabelClass-f01c9855.js","./defaults-06f3d090.js","./defaultsJSON-59981e75.js","./MD5-715f37cd.js","./OperationalLayer-381cacc8.js","./OrderedLayer-2db1a879.js","./PortalLayer-806db449.js","./portalItemUtils-bd3ade0c.js","./ScaleRangeLayer-47bc8cb3.js","./TemporalLayer-a67ca634.js","./FeatureTemplate-40f36ca2.js","./FeatureType-baed6dd6.js","./fieldProperties-8bc1b40a.js","./labelingInfo-c32eb8fe.js","./versionUtils-abea1fa8.js","./styleUtils-5179403f.js","./popupUtils-87764fa9.js","./interfaces-f1f22245.js","./ReactiveSet-96dea6cb.js"],import.meta.url);if(wt(i),!this.popup||xd(this.popup))return;const n=this.popup;delete n.open,delete n.close,this.popup=new s(n)}),this._popupSetupTask.promise}_queryLayerPopupFeatures(r,i,s){return i.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:s!=null?s.event:void 0,signal:s!=null?s.signal:void 0,defaultPopupTemplateEnabled:s!=null&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(r,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(i!=null&&i.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,i){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(r,i),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(r,i){const s=await this.popupHitTest(r),n=s.results,o=s.mapPoint,a=n.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,i)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const r=[];return this.allLayerViews.forEach(i=>{this._isValidPopupLayerView(i)&&r.push(i)}),this.graphicsView!=null&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView),r.reverse()}_isValidPopupLayerView(r){return r!=null&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,i){const s=[],n=new Map,o=i.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of r){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return h([f({cast(r){return!r||xd(r)||typeof r=="object"&&(r.open=i=>(wx(ne.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(i)),r.close=()=>(wx(ne.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),r}})],e.prototype,"popup",void 0),h([f()],e.prototype,"popupEnabled",void 0),e=h([k("esri.views.PopupView")],e),e},lX={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function G4(t,e,r,i=Fp){const s=new td(K7(i)),n=Xt.fromJSDate(t,{zone:s}),o=r==="decades"||r==="centuries"?"year":Jde(r);return r==="decades"&&(e*=10),r==="centuries"&&(e*=100),n.plus({[o]:e}).toJSDate()}function cX(t,e,r=Fp){const i=new td(K7(r)),s=Xt.fromJSDate(t,{zone:i});if(e==="decades"||e==="centuries"){const o=s.startOf("year"),{year:a}=o,l=a-a%(e==="decades"?10:100);return o.set({year:l}).toJSDate()}const n=Jde(e);return s.startOf(n).toJSDate()}function Eyt(t,e,r){return t===0?0:t*lX[e]/lX[r]}function Cyt(t,e){return t&&e?t.intersection(e):t||e}function Jde(t){switch(t){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var hh;let rc=hh=class extends st{static get allTime(){return uX}static get empty(){return x5e}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=(t==null?void 0:t.getTime())??null}get isAllTime(){return this.equals(hh.allTime)}get isEmpty(){return this.equals(hh.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=(t==null?void 0:t.getTime())??null}clone(){return new hh({end:this.end,start:this.start})}equals(t){var n,o,a,l;if(!t)return!1;const e=((n=this.start)==null?void 0:n.getTime())??this.start,r=((o=this.end)==null?void 0:o.getTime())??this.end,i=((a=t.start)==null?void 0:a.getTime())??t.start,s=((l=t.end)==null?void 0:l.getTime())??t.end;return e===i&&r===s}expandTo(t,e=Fp){if(this.isEmpty||this.isAllTime)return this.clone();let r=this.start;r&&(r=cX(r,t,e));let i=this.end;if(i){const s=cX(i,t,e);i=i.getTime()===s.getTime()?s:G4(s,1,t,e)}return new hh({start:r,end:i})}intersection(t){var a,l,c,u;if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return hh.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=((a=this.start)==null?void 0:a.getTime())??-1/0,r=((l=this.end)==null?void 0:l.getTime())??1/0,i=((c=t.start)==null?void 0:c.getTime())??-1/0,s=((u=t.end)==null?void 0:u.getTime())??1/0;let n,o;if(i>=e&&i<=r?n=i:e>=i&&e<=s&&(n=e),r>=i&&r<=s?o=r:s>=e&&s<=r&&(o=s),n!=null&&o!=null&&!isNaN(n)&&!isNaN(o)){const d=new hh;return d.start=n===-1/0?null:new Date(n),d.end=o===1/0?null:new Date(o),d}return hh.empty}offset(t,e,r=Fp){if(this.isEmpty||this.isAllTime)return this.clone();const i=new hh,{start:s,end:n}=this;return s!=null&&(i.start=G4(s,t,e,r)),n!=null&&(i.end=G4(n,t,e,r)),i}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return uX.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,r=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new hh({start:e,end:r})}};h([f({type:Date,json:{write:{allowNull:!0}}})],rc.prototype,"end",void 0),h([si("end")],rc.prototype,"readEnd",null),h([ni("end")],rc.prototype,"writeEnd",null),h([f({readOnly:!0,json:{read:!1}})],rc.prototype,"isAllTime",null),h([f({readOnly:!0,json:{read:!1}})],rc.prototype,"isEmpty",null),h([f({type:Date,json:{write:{allowNull:!0}}})],rc.prototype,"start",void 0),h([si("start")],rc.prototype,"readStart",null),h([ni("start")],rc.prototype,"writeStart",null),rc=hh=h([k("esri.TimeExtent")],rc);const uX=new rc,x5e=new rc({start:void 0,end:void 0}),T5e=rc;let UE=class extends $E{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};h([roe({Type:iv,ensureType:ya(iv)})],UE.prototype,"itemType",void 0),UE=h([k("esri.support.GraphicsCollection")],UE);let Gg=class extends xe{constructor(e){super(e),this.view=null,this.baseLayerViews=new St,this.referenceLayerViews=new St,this._loadingHandle=ae(()=>{var r,i;return(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap},r=>{r&&r.load().catch(()=>{})},zr)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var r,i;if(this.view&&this.view.suspended)return!1;const e=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(s=>s.updating)||this.referenceLayerViews.some(s=>s.updating))}};h([f({constructOnly:!0})],Gg.prototype,"view",void 0),h([f({readOnly:!0})],Gg.prototype,"baseLayerViews",void 0),h([f({readOnly:!0})],Gg.prototype,"referenceLayerViews",void 0),h([f({readOnly:!0})],Gg.prototype,"suspended",null),h([f({type:Boolean,readOnly:!0})],Gg.prototype,"updating",null),Gg=h([k("esri.views.BasemapView")],Gg);function S5e(t){return"tryRecycleWith"in t}let E5e=class{constructor(e,r,i){this.layer=e,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=Go(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,Uo(this._controller.signal,()=>{const s=new X("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!S5e(this.layerView))return null;const r=this.layer.type,i=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==r)continue;const o=this.layerView.tryRecycleWith(n,{signal:i});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(wt(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,u)=>Uo(this._controller.signal,()=>u(ur())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:r,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var s,n;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:r,view:i}=this;this._map=i.map;try{let o,a;if(await r.load({signal:e}),r.prefetchResources&&await r.prefetchResources({signal:e}),A5e(r))o=await r.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new X("layer:view-not-supported","No layerview implementation was found");const u=await this.layerViewImporter.importLayerView(r);wt(e),o="default"in u?new u.default({layer:r,view:i}):new u({layer:r,view:i})}const l=()=>{a=di(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=Uo(e,l),wt(e);try{await o.when()}catch(u){throw l(),u}if(!((n=(s=this._map)==null?void 0:s.allLayers)==null?void 0:n.includes(r)))return l(),void this._deferred.reject(new X("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=o,r.emit("layerview-create",{view:i,layerView:o}),i.emit("layerview-create",{layer:r,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){r.emit("layerview-create-error",{view:i,error:o}),i.emit("layerview-create-error",{layer:r,error:o}),this.done=!0,this._deferred.reject(new X("layerview:create-error","layerview creation failed",{layer:r,error:o}))}}},Qc=class extends xe{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Yh,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const r=(i=this.view.map)==null?void 0:i.allLayers;if(r)for(const s of r)this.layerViewImporter.hasLayerViewModule(s)&&this.layerViewImporter.importLayerView(s)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=Go(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(w2(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,u;if(this.destroyed)return;const r=this.view.map;if(this._map!==r&&(this.clear(),this._map=r),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const i=new Set,s=[],n=this.view.ready,o=d=>{if(d!=null){for(const p of d)if(p){i.add(p);const g=this._layerLayerViewInfoMap.get(p);g&&n?g.start():g||this._recyclingInfoMap.has(p)||s.push(p),"layers"in p&&p.layers&&o(p.layers)}}};for(const d of this._rootCollectionNames)o(Tp(this,d));for(const[d,p]of this._layerLayerViewInfoMap)if(!i.has(d)){this._layerLayerViewInfoMap.delete(p.layer);const g=p.tryRecycle(s);g?(this.notifyChange("updating"),this._recyclingInfoMap.set(p.layer,p),g.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),this._layerLayerViewInfoMap.set(p.layer,p),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),p.destroy(),this._reschedule()})):p.destroy()}for(const[d,p]of this._recyclingInfoMap)i.has(d)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),p.destroy());for(const d of s)this._createLayerView(d);this._refreshCollections();const a=[(l=r==null?void 0:r.ground)==null?void 0:l.layers,(c=r==null?void 0:r.basemap)==null?void 0:c.baseLayers,(u=r==null?void 0:r.basemap)==null?void 0:u.referenceLayers,r==null?void 0:r.layers].filter(d=>!!d);i.forEach(d=>"layers"in d&&a.push(d.layers)),this.addHandles(a.map(d=>this._watchUpdatingTracking.addOnCollectionChange(()=>d,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([Bo(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),ae(()=>{const e=this.view,r=e==null?void 0:e.map;return[r==null?void 0:r.basemap,r==null?void 0:r.ground,r==null?void 0:r.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Br)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),d4(this._recyclingInfoMap),d4(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(ur()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||hc(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const r of this._layerLayerViewInfoMap.values())r.done||++e;return e}clear(){this.destroyed||(d4(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new X("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,r]of this._layersToLayerViews)this._populateLayerViewsOwners(Tp(this,e),Tp(this,r),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,r,i){if(!e||!r)return void(r&&r.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!(o!=null&&o.layerView))continue;const a=o.layerView;a.layer=n,a.parent=i,r.at(s)!==a&&r.splice(s,0,a),n.layers&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<r.length&&r.splice(s,r.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const r=new E5e(e,this.view,this.layerViewImporter);r.promise.then(()=>this._refreshCollections(),i=>{i&&(Os(i)||i.name==="cancelled:layerview-create")||ne.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,r),this.view.ready&&r.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};h([f()],Qc.prototype,"_workPromise",void 0),h([f({readOnly:!0})],Qc.prototype,"_watchUpdatingTracking",void 0),h([f({readOnly:!0})],Qc.prototype,"_layersToLayerViews",null),h([f({readOnly:!0})],Qc.prototype,"_rootCollectionNames",null),h([f()],Qc.prototype,"layerViewImporter",void 0),h([f()],Qc.prototype,"supportsGround",void 0),h([f({readOnly:!0})],Qc.prototype,"updating",null),h([f({readOnly:!0})],Qc.prototype,"updatingRemaining",null),h([f({constructOnly:!0})],Qc.prototype,"view",void 0),Qc=h([k("esri.views.LayerViewManager")],Qc);const C5e=Qc;function A5e(t){return"createLayerView"in t&&t.createLayerView!=null}let Xl=class extends xe{constructor(e){super(e),this.factor=1.5,this.offset=Ou(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};h([f({type:Number})],Xl.prototype,"factor",void 0),h([f({nonNullable:!0})],Xl.prototype,"offset",void 0),h([f()],Xl.prototype,"position",void 0),h([f({type:Number,range:{min:0}})],Xl.prototype,"size",void 0),h([f()],Xl.prototype,"maskUrl",void 0),h([f()],Xl.prototype,"maskEnabled",void 0),h([f()],Xl.prototype,"overlayUrl",void 0),h([f()],Xl.prototype,"overlayEnabled",void 0),h([f({readOnly:!0})],Xl.prototype,"version",null),h([f({type:Boolean})],Xl.prototype,"visible",void 0),Xl=h([k("esri.views.Magnifier")],Xl);const Qde=Xl;let AS=class extends Lc(xe){constructor(e){super(e),this.accentColor=new qe([255,127,0]),this.textColor=new qe([255,255,255])}};h([f({type:qe,nonNullable:!0})],AS.prototype,"accentColor",void 0),h([f({type:qe,nonNullable:!0})],AS.prototype,"textColor",void 0),AS=h([k("esri.views.Theme")],AS);const F9=AS;var hX;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(hX||(hX={}));const Kde=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],epe={};function tpe(t){return!!epe[t]}function R5e(t){for(const e of t)if(!tpe(e))return!1;return!0}Kde.forEach(t=>{epe[t]=!0});let O5e=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:r,priority:i},s)=>{var n;return(n=this.inputManager)==null?void 0:n.installHandlers(s,[r],i)})}disconnect(){this.inputManager&&this._handlers.forEach((e,r)=>{var i;return(i=this.inputManager)==null?void 0:i.uninstallHandlers(r)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,r,i,s){const n=Array.isArray(e)?e:e.split(",");if(!R5e(n))return n.some(tpe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:s=i,s=s??$0.DEFAULT;const l=this._createUniqueGroupName(),c=new P5e(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const u of n){const d=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,d+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),Rr(()=>this._removeHandler(l,n))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,r){if(this._handlers.has(e)){this._handlers.delete(e);for(const i of r){const s=this._handlerCounts.get(i);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):s===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},P5e=class extends Kn{constructor(e,r,i,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of r)switch(n){case"click":this.registerIncoming("click",i,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{s(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:u,screenPoint:Ou(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"double-click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:u,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,r){return this.view.toMap(Ou(e,r),{exclude:[]})}_wrapDrag(e){const r=e.data,{x:i,y:s}=r.center,{action:n,pointerType:o,button:a}=r;if(n==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:u,timestamp:d}=e,p={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:i,y:s,origin:p,pointerType:o,button:a,buttons:c,radius:r.radius,angle:_a(r.angle),native:l,timestamp:d,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:r,repeat:i,native:s}=e.data,{cancelable:n,timestamp:o}=e;return{type:"key-down",key:r,repeat:i,native:s,timestamp:o,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:r,native:i}=e.data,{cancelable:s,timestamp:n}=e;return{type:"key-up",key:r,native:i,timestamp:n,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,r){const{x:i,y:s,button:n,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,u=a.pointerType,{cancelable:d,timestamp:p}=e;return{type:r,x:i,y:s,pointerId:c,pointerType:u,button:n,buttons:o,native:a,timestamp:p,eventId:l,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:r,y:i,buttons:s,native:n,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,u=e.data.action,d={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:p,timestamp:g}=e;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:s,action:u,origin:d,native:n,timestamp:g,eventId:o,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:r,data:i,timestamp:s}=e,{x:n,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:r,state:i,device:s}=e.data,{cancelable:n,timestamp:o}=e,{buttons:a,axes:l}=i;return{type:"gamepad",device:s,timestamp:o,action:r,buttons:a,axes:l,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var VC,dX,pX;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(VC||(VC={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(dX||(dX={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(pX||(pX={}));function M5e(t){return[t.on("before-add",e=>{const r=e.item;if(r==null||t.includes(r))return ne.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();r.onAdd()}),t.on("after-remove",e=>{const r=e.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function U9(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(VC.USER)&&t.getEditableFlag(VC.MANAGER)}function Xd(t){return Ou(t.x,t.y)}function Dyt(t){return Vi(t.x,t.y)}function rpe(t,e){var i;const r=(i=t instanceof HTMLElement?t:t.surface)==null?void 0:i.getBoundingClientRect();return r?Ou(e.clientX-r.left,e.clientY-r.top):Ou(0,0)}function fX(t,e){return e instanceof Event?rpe(t,e):Xd(e)}function mX(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let $5e=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,r){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":gX(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!yX(e))break;const s=Xd(e),n=this._intersect(s,e.pointerType,r.forEachTool);if(n==null)break;const o=n.manipulator,a=n.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,r),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&r.activeTool==null&&(this._revertToNullActiveTool=!0,r.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,r);break;case"pointer-drag":{if(!yX(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=s==null?void 0:s.manipulator,o=s==null?void 0:s.tool;if(n==null||o==null)break;const a=Xd(e);a.x=me(a.x,0,r.view.width),a.y=me(a.y,0,r.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,r)}i();break}case"immediate-click":{const s=Xd(e),n=this._intersect(s,e.pointerType,r.forEachTool);if(I5e(e)||r.forEachTool(c=>{if((n==null||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let u=!1;c.manipulators.forEach(({manipulator:d})=>{d.selected&&(d.selected=!1,u=!0)}),u&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),n==null)break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i}),j4(o,i);break}case"click":{const s=Xd(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n==null?void 0:n.manipulator;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const s=Xd(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i}),j4(o,i);break}case"immediate-double-click":{const s=Xd(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i}),j4(o,i);break}}this._onFocusChange(r.forEachTool)}_ungrabManipulatorBeforeDragging(e,r,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:Xd(r)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorUngrab(i.setActiveTool)}_handlePointerEnd(e,r){var s;const i=(s=this._grabbedManipulators.get(e.pointerId))==null?void 0:s.manipulator;i!=null&&i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:Xd(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(r.setActiveTool))}_cursorFromMap(e){let r=null;return hc(e,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:s})=>{r.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{i.add(s)}),e(s=>{s.hasGrabbedManipulators=r.has(s),s.hasHoveredManipulators=i.has(s);const n=this._grabbedManipulators.values(),o=a2e(n,({tool:a})=>a===s);s.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:r,setActiveTool:i},s=!0,n){const o=(a,l)=>a===e&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},u)=>{o(a,l)&&(this._grabbedManipulators.delete(u),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(i),this._onFocusChange(r)}_intersect(e,r,i){let s=null;return i(n=>{if(n.manipulators==null||!U9(n))return!1;const o=n.manipulators.intersect(e,r);return o!=null&&(s={tool:n,manipulator:o},!0)}),s}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(Ou(r.x,r.y),i,r.pointerType,e)})}handleHoverEvent(e,r){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!gX(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Xd(e),e.pointerId,e.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(e,r,i,s){var a;let n=this._intersect(e,i,s);const o=(a=this._hoveredManipulators.get(r))==null?void 0:a.manipulator;n==null||n.manipulator.interactive||(n=null),n!=null&&o===n.manipulator||(o!=null&&(o.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(r,n)):this._hoveredManipulators.delete(r),this._onFocusChange(s))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function gX(t){return t==="mouse"}function yX(t){return t.pointerType!=="mouse"||t.button===0}function I5e(t){return!!t.native.shiftKey}function j4(t,e){t!=null&&t.consumesClicks&&e()}const _X="attached",H4="tools",vX=1e3;let Zd=class extends xe{constructor(e){super(e),this._updatingHandles=new Yh,this._clock=T3,this._manipulatorState=new $5e,this.tools=new St,this.cursor=null,this._interacting=!1,this._interactingTimeout=vX,this._interactingTimeoutHandle=null,this._forEachTool=r=>{for(const i of this.tools.items)if(r(i))return}}initialize(){this.addHandles([this.view.on(Kde,e=>{this._handleInputEvent(e)},$0.TOOL),...M5e(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void ne.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const r=this.activeTool;this._set("activeTool",e),r!=null&&r.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const i of this.tools){this._updateToolEditableFlag(i);const s=U9(i);this.activeTool!=null&&s||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=di(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){var e;this.view.type==="3d"?this.addHandles([ae(()=>{const{state:r}=this.view;return"camera"in r&&r.camera},()=>this._forEachManipulator(r=>r.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",r=>this._forEachManipulator(i=>i.onElevationChange(r)))],_X):this.addHandles(ae(()=>this.view.extent,()=>this._forEachManipulator(r=>r.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(_X),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(r=>{r.manipulators&&r.manipulators.forEach(({manipulator:i})=>e(i,r))})}_handleInputEvent(e){let r=!1;const i={...e,stopPropagation:()=>{r=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(s=>{!r&&s.visible&&s.handleInputEvent(i)}),!r&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),r||this.activeTool==null||this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(H4),this._forEachTool(e=>{if(e instanceof xe){const r=ae(()=>[e.cursor,e.visible,e.editable],()=>{U9(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(r,H4)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",r=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,r.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],H4)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var r;(r=e.setEditableFlag)==null||r.call(e,VC.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(r=>!(r.cursor==null||!r.visible)&&(e=r.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(r=>(e==null||r!==e)&&!r.created&&r.removeIncompleteOnCancel).forEach(r=>{this.tools.remove(r)})}get test(){const e=this;return{setClock:r=>this._clock=r,set interactingTimeoutEnabled(r){e._interactingTimeout=r?vX:0},get interactingTimeoutEnabled(){return e._interactingTimeout!==0}}}};h([f({constructOnly:!0,nonNullable:!0})],Zd.prototype,"view",void 0),h([f({value:null})],Zd.prototype,"activeTool",null),h([f({readOnly:!0,type:St})],Zd.prototype,"tools",void 0),h([f({readOnly:!0})],Zd.prototype,"cursor",void 0),h([f({readOnly:!0})],Zd.prototype,"updating",null),h([f()],Zd.prototype,"_interacting",void 0),h([f({readOnly:!0})],Zd.prototype,"interacting",null),Zd=h([k("esri.views.ToolViewManager")],Zd);let nw=class extends xe{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":L5e.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return D5e[this.deviceType]}};h([f({nonNullable:!0,readOnly:!0})],nw.prototype,"nativeIndex",void 0),h([f({type:String,readOnly:!0})],nw.prototype,"deviceType",null),h([f({type:Number,readOnly:!0})],nw.prototype,"axisThreshold",null),nw=h([k("esri.views.input.gamepad.GamepadInputDevice")],nw);const L5e=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),D5e={standard:.15,spacemouse:.025,unknown:0},hG=nw;let RS=class extends xe{constructor(...e){super(...e),this.devices=new St,this.enabledFocusMode="document"}};h([f({type:St.ofType(hG),readOnly:!0})],RS.prototype,"devices",void 0),h([f({type:["document","view","none"]})],RS.prototype,"enabledFocusMode",void 0),RS=h([k("esri.views.input.gamepad.GamepadSettings")],RS);const N5e=RS;let aM=class extends xe{constructor(){super(...arguments),this.gamepad=new N5e}};h([f({readOnly:!0})],aM.prototype,"gamepad",void 0),aM=h([k("esri.views.input.Input")],aM);const F5e=aM;let jg=class extends xe{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};h([f({type:Boolean,nonNullable:!0})],jg.prototype,"enabled",void 0),h([f({type:hG})],jg.prototype,"device",void 0),h([f({type:["pan","zoom"],nonNullable:!0})],jg.prototype,"mode",void 0),h([f({type:["forward-down","forward-up"],nonNullable:!0})],jg.prototype,"tiltDirection",void 0),h([f({type:Number,nonNullable:!0})],jg.prototype,"velocityFactor",void 0),jg=h([k("esri.views.navigation.gamepad.GamepadSettings")],jg);const ipe=jg;let M_=class extends xe{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new ipe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};h([f({type:Boolean})],M_.prototype,"browserTouchPanEnabled",void 0),h([f({type:ipe,nonNullable:!0})],M_.prototype,"gamepad",void 0),h([f({type:Boolean})],M_.prototype,"momentumEnabled",void 0),h([f({type:Boolean})],M_.prototype,"mouseWheelZoomEnabled",void 0),M_=h([k("esri.views.navigation.Navigation")],M_);const spe=M_,npe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},ope=Object.values(npe),ape=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${ope.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),U5e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${ope.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),k5e=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function Gyt(t){return!!ape.test(t)}function dG(t){if(t==null)return null;const e=Wn(t),r=(e==null?void 0:e.path.match(ape))||(e==null?void 0:e.path.match(U5e));if(!r)return null;const[,i,s,n,o]=r,a=s.indexOf("/");return{title:lpe(a!==-1?s.slice(a+1):s),serverType:npe[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function B5e(t){const e=Wn(t).path.match(k5e);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function lpe(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function jyt(t,e){const r=[];if(t){const i=dG(t);i!=null&&i.title&&r.push(i.title)}if(e){const i=lpe(e);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function Hyt(t){if(!t)return!1;const e=".arcgis.com/",r="//services",i="//tiles",s="//features",n=(t=t.toLowerCase()).includes(e),o=t.includes(r)||t.includes(i)||t.includes(s);return n&&o}function qyt(t,e){return t&&Gne(Hne(t,e))}function Wyt(t){let{url:e}=t;if(!e)return{url:e};e=Hne(e,t.logger);const r=Wn(e),i=dG(r.path);let s;if(i!=null)i.sublayer!=null&&t.layer.layerId==null&&(s=i.sublayer),e=i.url.path;else if(t.nonStandardUrlAllowed){const n=B5e(r.path);n!=null&&(e=n.serviceUrl,s=n.sublayerId)}return{url:Gne(e),layerId:s}}function Yyt(t,e,r,i,s){tv(e,i,"url",s),i.url&&t.layerId!=null&&(i.url=GL(i.url,r,t.layerId.toString()))}function Xyt(t){if(!t)return!1;const e=t.toLowerCase(),r=e.includes("/services/"),i=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return r&&(i||s||n)}function Zyt(t,e,r){const i=cpe(t),s=e,n=z5e(i,s,r);if(i){const o=B3.deriveUnitFromSR(i,t.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new X("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new X("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!V5e(t)||n===gl.Unsupported)return new X("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(n){case gl.Units:{const o=(i==null?void 0:i.heightUnit)||"unknown",a=(s==null?void 0:s.heightUnit)||"unknown",l=new X("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new X("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case gl.HeightModel:{const o=(i==null?void 0:i.heightModel)||"unknown",a=(s==null?void 0:s.heightModel)||"unknown",l=new X("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new X("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case gl.CRS:{const o=(i==null?void 0:i.vertCRS)||"unknown",a=(s==null?void 0:s.vertCRS)||"unknown",l=new X("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new X("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}}return null}function z5e(t,e,r){if(!bX(t)||!bX(e))return gl.Unsupported;if(t==null||e==null)return gl.Ok;if(!r&&t.heightUnit!==e.heightUnit)return gl.Units;if(t.heightModel!==e.heightModel)return gl.HeightModel;switch(t.heightModel){case"gravity-related-height":return gl.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?gl.Ok:gl.CRS;default:return gl.Unsupported}}var gl;function bX(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function V5e(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!dpe(t)}function cpe(t){var i;const e=t.url?dG(t.url):void 0;return!(((i=t.spatialReference)==null?void 0:i.vcsWkid)==null&&e!=null&&e.serverType==="ImageServer")&&upe(t)&&t.heightModelInfo?t.heightModelInfo:dpe(t)?B3.deriveUnitFromSR(j5e,t.spatialReference):null}function upe(t){return"heightModelInfo"in t}function hpe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function dpe(t){return hpe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):ppe(t)}function G5e(t){return t.layers!=null||ppe(t)||hpe(t)||upe(t)}function ppe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(gl||(gl={}));const j5e=new B3({heightModel:"gravity-related-height"});let k9,q4=null;async function H5e(t){q4||(q4=he(()=>Promise.resolve().then(()=>Ltt),void 0,import.meta.url).then(e=>k9=e)),await q4,wt(t)}async function fpe(t,e,r,i){if(!t)return null;const s=t.spatialReference;return z3()||Bp(s,e)?Pm(t,e):k9?k9.projectGeometry(t,e,r,i):(await Promise.race([H5e(i),zx(i)]),fpe(t,e,r,i))}let Oi=class extends xe{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Ml(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,s,n,o;const e=(i=this.map)==null?void 0:i.call(this),r=[];return this.priorityCollection!=null&&r.push(this.priorityCollection),r.push({parent:e==null?void 0:e.basemap,layers:(s=e==null?void 0:e.basemap)==null?void 0:s.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(n=e==null?void 0:e.ground)==null?void 0:n.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),r}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;let i=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);a!=null&&(i=a)}if(i!=null&&i.length===1)break}if(r&&(i==null||i.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(i);return{spatialReference:s!=null?s.spatialReference:null,viewingMode:s!=null?s.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,s,n,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:r}=this._collectLayers([{parent:(s=(i=this.map)==null?void 0:i.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const u=e[0].tileInfo;return{tileInfo:u&&u.spatialReference.equals(this.spatialReference)?u:null,updating:!1}}return{updating:r}}get _heightModelInfoTask(){var i,s,n;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))!=null&&i.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;for(const o of e)if(G5e(o)){const a=cpe(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:r}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,r=e.updating,i=[];for(const s of e.layers){const n="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:n[0],a=n.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const l of n)i.push({extent:l,layer:s})}return{candidates:i,updating:r}}get _extentTask(){const{candidates:e,updating:r}=this._extentCandidatesTask;if(r)return{updating:r};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),s=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=Ml(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:s.clone(),task:cy(async n=>{try{const o=await fpe(i.extent,s,"portalItem"in i.layer?i.layer.portalItem:void 0,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(Ys(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,r){if(e==null)return r;const i=[],s=(n,o)=>n!=null?o!=null?n===o&&n:n:o;for(const n of e)for(const o of r){if(!n.spatialReference.equals(o.spatialReference))continue;const a=s(n.viewingMode,o.viewingMode);if(a!==!1){i.push({spatialReference:n.spatialReference,viewingMode:a});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const r=this.defaultSpatialReference;return e==null||e.length<1?r!=null?{spatialReference:r,viewingMode:null}:null:(r!=null&&e.length>1&&e.some(({spatialReference:i})=>i.equals(r))&&(e=e.filter(({spatialReference:i})=>i.equals(r))),e.length>1&&e.some(({viewingMode:i})=>i!==$e.Local)&&(e=e.filter(({viewingMode:i})=>i!==$e.Local)),e[0])}_getSupportedSpatialReferences(e){const r="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(r.length===0)return[];const i=[];for(const s of r){const n=this.getSpatialReferenceSupport({spatialReference:s,layer:e});if(n!=null){const o=n.constraints!=null?n.constraints:[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||i.push({spatialReference:a,viewingMode:l})}}return i}_pickExtentCandidate(e){const r=this.spatialReference;return e.find(({extent:i})=>r.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const r=new q5e;for(const s of e)if(this._collectCollection(s,r),r.preloading===this.sourcePreloadCount)break;return{layers:r.layers,updating:r.updating}}_collectCollection(e,r){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return r.updating=!0,void++r.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":r.updating=!0,++r.preloading;break;case"loaded":r.updating||r.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},r)}if(r.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(r=>{Os(r)||console.log(r)}),"loading"):e.loadStatus:"loaded"}};h([f()],Oi.prototype,"required",void 0),h([f({constructOnly:!0})],Oi.prototype,"map",void 0),h([f({constructOnly:!0})],Oi.prototype,"getSpatialReferenceSupport",void 0),h([f()],Oi.prototype,"defaultSpatialReference",void 0),h([f()],Oi.prototype,"userSpatialReference",void 0),h([f()],Oi.prototype,"sourcePreloadCount",void 0),h([f()],Oi.prototype,"priorityCollection",void 0),h([f()],Oi.prototype,"requiresExtentInSpatialReference",void 0),h([f()],Oi.prototype,"suspended",void 0),h([f({readOnly:!0})],Oi.prototype,"ready",null),h([f({readOnly:!0})],Oi.prototype,"heightModelInfoReady",null),h([f({readOnly:!0})],Oi.prototype,"spatialReference",null),h([f({readOnly:!0})],Oi.prototype,"extent",null),h([f({readOnly:!0})],Oi.prototype,"heightModelInfo",null),h([f({readOnly:!0})],Oi.prototype,"vcsWkid",null),h([f({readOnly:!0})],Oi.prototype,"latestVcsWkid",null),h([f({readOnly:!0})],Oi.prototype,"viewingMode",null),h([f({readOnly:!0})],Oi.prototype,"tileInfo",null),h([f({readOnly:!0})],Oi.prototype,"mapCollections",null),h([f({readOnly:!0})],Oi.prototype,"_allLayers",null),h([f({readOnly:!0})],Oi.prototype,"_spatialReferenceTask",null),h([f({readOnly:!0})],Oi.prototype,"_tileInfoTask",null),h([f({readOnly:!0})],Oi.prototype,"_heightModelInfoTask",null),h([f({readOnly:!0})],Oi.prototype,"_extentCandidatesTask",null),h([f()],Oi.prototype,"_extentTask",null),h([f()],Oi.prototype,"_projectExtentTask",void 0),Oi=h([k("esri.views.support.DefaultsFromMap")],Oi);let q5e=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var OS;let vt=OS=class extends Ps.EventedMixin(a7(xe)){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.handles=new Am,this.updatingHandles=new Yh,this.allLayerViews=new RC({getCollections:()=>{var e,r,i;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(r=this.groundView)==null?void 0:r.layerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:Y5e}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new UE,this.analyses=new Hx,this.typeSpecificPreconditionsReady=!0,this.layerViews=new St,this.magnifier=new Qde,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new F5e,this.navigation=new spe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new O5e(this),this.persistableViewModels=new St,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(ae(()=>this.preconditionsReady,e=>{var r,i;e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,OS.views.add(this)):(this._lockedSpatialReference=null,OS.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?((r=this.toolViewManager)==null||r.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(i=this.layerViewManager)==null||i.clear(),this._teardown()):e&&!this.ready&&(this._startup(),this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Fr))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,Fx(()=>this.ready)))),this.basemapView=new Gg({view:this}),this.layerViewManager=new C5e({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new Zd({view:this}),this._setupSpatialReferenceLogger(),this.addHandles([ae(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),ae(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),ae(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.addHandles([ae(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(e&&!this.spatialReference&&r){if(t!=null)return;const s=Rr(()=>t=Ml(t));t=cy(async n=>{try{await _C(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{t=null}ne.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(s,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){var t,e;this.destroyed||(OS.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Oe(this.graphics),this.analyses=Oe(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Oe(this.analysisViewManager),this.toolViewManager=Oe(this.toolViewManager),this.layerViewManager=Oe(this.layerViewManager),this.basemapView=Oe(this.basemapView),(t=this.groundView)==null||t.destroy(),(e=this.layerViews)==null||e.forEach(r=>r.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=Oe(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return ne.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Oi({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||z0.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(ne.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),z0.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",t))}get spatialReference(){var e,r;let t=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;return t&&((r=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&r.heightModelInfo)&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!hs(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??Fp}set timeZone(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),r=new Set(Intl.supportedValuesOf("timeZone").map(i=>i.toLowerCase()));this._userTimeZone=t,t===Fp||t===Q7||e.has(t.toLowerCase())||r.has(t.toLowerCase())||ne.getLogger(this).warn("#timeZone",`the parsed value '${t}' may not be a valid IANA time zone`)}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){var t;return((t=this.toolViewManager)==null?void 0:t.cursor)??this._cursor??"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new F9}whenLayerView(t){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(t))??Promise.reject()}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}getDefaultTimeZone(){return null}importLayerView(t){throw new X("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport({spatialReference:t})!=null}when(t,e){return this.isResolved()&&!this.ready&&ne.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&($u(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};vt.views=new St,h([f()],vt.prototype,"_userSpatialReference",void 0),h([f()],vt.prototype,"activeTool",null),h([f({readOnly:!0})],vt.prototype,"allLayerViews",void 0),h([f()],vt.prototype,"groundView",void 0),h([f()],vt.prototype,"animation",null),h([f()],vt.prototype,"basemapView",void 0),h([f()],vt.prototype,"center",null),h([f({readOnly:!0})],vt.prototype,"_defaultsFromMapSettings",null),h([f()],vt.prototype,"defaultsFromMap",null),h([f()],vt.prototype,"fatalError",void 0),h([f({type:Xr})],vt.prototype,"extent",null),h([f(c9(UE,"graphics"))],vt.prototype,"graphics",void 0),h([f(c9(Hx,"analyses"))],vt.prototype,"analyses",void 0),h([f({readOnly:!0,type:B3})],vt.prototype,"heightModelInfo",null),h([f({readOnly:!0})],vt.prototype,"interacting",null),h([f({readOnly:!0})],vt.prototype,"navigating",null),h([f({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],vt.prototype,"preconditionsReady",null),h([f({readOnly:!0})],vt.prototype,"typeSpecificPreconditionsReady",void 0),h([f({type:St,readOnly:!0})],vt.prototype,"layerViews",void 0),h([f()],vt.prototype,"resolution",null),h([f({type:Qde})],vt.prototype,"magnifier",void 0),h([f({value:null,type:Yae})],vt.prototype,"map",null),h([f()],vt.prototype,"padding",void 0),h([f({readOnly:!0})],vt.prototype,"ready",void 0),h([f({type:at})],vt.prototype,"spatialReference",null),h([f()],vt.prototype,"spatialReferenceWarningDelay",void 0),h([f()],vt.prototype,"stationary",null),h([f({readOnly:!0})],vt.prototype,"supportsGround",void 0),h([f({type:T5e})],vt.prototype,"timeExtent",void 0),h([f({type:String,nonNullable:!0})],vt.prototype,"timeZone",null),h([f()],vt.prototype,"tools",null),h([f()],vt.prototype,"toolViewManager",void 0),h([f({readOnly:!0})],vt.prototype,"type",void 0),h([f({type:Number})],vt.prototype,"scale",void 0),h([f({readOnly:!0})],vt.prototype,"updating",void 0),h([f({readOnly:!0})],vt.prototype,"initialExtentRequired",void 0),h([f({readOnly:!0})],vt.prototype,"initialExtent",null),h([f()],vt.prototype,"cursor",null),h([f({readOnly:!0})],vt.prototype,"input",void 0),h([f({type:spe,nonNullable:!0})],vt.prototype,"navigation",void 0),h([f()],vt.prototype,"layerViewManager",void 0),h([f()],vt.prototype,"analysisViewManager",void 0),h([f()],vt.prototype,"width",void 0),h([f()],vt.prototype,"height",void 0),h([f({readOnly:!0})],vt.prototype,"resizing",void 0),h([f({value:null,readOnly:!0})],vt.prototype,"size",null),h([f({readOnly:!0})],vt.prototype,"suspended",void 0),h([f({readOnly:!0})],vt.prototype,"viewEvents",void 0),h([f({readOnly:!0})],vt.prototype,"persistableViewModels",void 0),h([f()],vt.prototype,"_isValid",void 0),h([f()],vt.prototype,"_readyCycleForced",void 0),h([f()],vt.prototype,"_lockedSpatialReference",void 0),h([f()],vt.prototype,"_userTimeZone",void 0),h([f()],vt.prototype,"_lockedTimeZone",void 0),h([f({type:F9})],vt.prototype,"theme",void 0),h([f({readOnly:!0,type:F9})],vt.prototype,"effectiveTheme",null),vt=OS=h([k("esri.views.View")],vt);const W5e=vt;function Y5e(t){return t.layerViews}let Hg=class extends b${constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=Go(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new X("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,r){r||(r=Fl(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",r)}};h([f({readOnly:!0})],Hg.prototype,"done",null),h([f({readOnly:!0,type:String})],Hg.prototype,"state",void 0),h([f()],Hg.prototype,"target",void 0),Hg=h([k("esri.views.ViewAnimation")],Hg),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(Hg||(Hg={}));const Jx=Hg,gT=()=>he(()=>import("./TileLayerView3D-55c05411.js"),["./TileLayerView3D-55c05411.js","./LayerView3D-3cbda063.js","./TiledLayerView3D-dab5de9d.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js","./MapServiceLayerViewHelper-d2a85004.js","./floorFilterUtils-080a7cd2.js","./sublayerUtils-28c1d0d3.js","./popupUtils-ef16fd02.js","./drapedUtils-a5c237e8.js"],import.meta.url),wX=()=>he(()=>import("./ElevationLayerView3D-245a6559.js"),["./ElevationLayerView3D-245a6559.js","./LayerView3D-3cbda063.js","./TiledLayerView3D-dab5de9d.js","./LayerView-8ac51c6c.js"],import.meta.url),xX={"base-dynamic":()=>he(()=>import("./BaseDynamicLayerView3D-614674a7.js"),["./BaseDynamicLayerView3D-614674a7.js","./DynamicLayerView3D-1ff752ab.js","./LayerView3D-3cbda063.js","./projectExtentUtils-b0efc861.js","./ImageMaterial-27f6b83d.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js"],import.meta.url),"base-elevation":wX,"base-tile":gT,"bing-maps":gT,"building-scene":()=>he(()=>import("./BuildingSceneLayerView3D-535ae000.js"),["./BuildingSceneLayerView3D-535ae000.js","./BuildingGroupSublayer-538b8490.js","./BuildingComponentSublayer-f76e8f2e.js","./UniqueValueRenderer-3d9243c5.js","./ColorStop-2602b4bf.js","./diffUtils-ef6bbcbf.js","./colorRamps-b2150d6f.js","./jsonUtils-46c07947.js","./DictionaryLoader-4dd3c670.js","./FieldsIndex-6b49ca64.js","./UnknownTimeZone-ab7c6b01.js","./heatmapUtils-2351b1fb.js","./FeatureLayer-0e0c57d1.js","./MultiOriginJSONSupport-9addf1b7.js","./FeatureLayerBase-8013eb8f.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./featureLayerUtils-9cc96c71.js","./featureQueryAll-ec4a11be.js","./Query-8ec96004.js","./AttachmentQuery-c73fbbfb.js","./RelationshipQuery-25c3c532.js","./LayerFloorInfo-039148db.js","./serviceCapabilitiesUtils-91567898.js","./editsZScale-d6a84b25.js","./queryZScale-f8e7b210.js","./FeatureSet-444cbc0f.js","./APIKeyMixin-fb65fce7.js","./ArcGISService-377485dc.js","./BlendLayer-d14012f0.js","./jsonUtils-9ebed520.js","./CustomParametersMixin-50d5a4c8.js","./EditBusLayer-525e2b98.js","./FeatureEffectLayer-b5512874.js","./FeatureEffect-01234d29.js","./FeatureFilter-22854955.js","./FeatureReductionLayer-a16eba95.js","./FeatureReductionSelection-02d3f160.js","./LabelClass-f01c9855.js","./defaults-06f3d090.js","./defaultsJSON-59981e75.js","./MD5-715f37cd.js","./OperationalLayer-381cacc8.js","./OrderedLayer-2db1a879.js","./PortalLayer-806db449.js","./portalItemUtils-bd3ade0c.js","./ScaleRangeLayer-47bc8cb3.js","./TemporalLayer-a67ca634.js","./FeatureTemplate-40f36ca2.js","./FeatureType-baed6dd6.js","./fieldProperties-8bc1b40a.js","./labelingInfo-c32eb8fe.js","./versionUtils-abea1fa8.js","./styleUtils-5179403f.js","./TopFeaturesQuery-61f4fc16.js","./popupUtils-87764fa9.js","./interfaces-f1f22245.js","./capabilities-c607cf72.js","./I3SIndexInfo-6a2ec503.js","./I3SLayerDefinitions-525a9cd0.js","./I3SUtil-e0c4dc89.js","./I3SBinaryReader-ee1cba0c.js","./popupUtils-ef16fd02.js","./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./I3SMeshView3D-18b89726.js","./I3SOverrides-0b4e6900.js","./I3SNode-4775f644.js","./ReactiveSet-96dea6cb.js","./meshFeatureSet-28134c47.js","./External-48e3c7c0.js","./FeatureLayerView3D-95b77eed.js","./FeatureLayerViewBase3D-0ef83067.js","./FeatureLikeLayerView3D-1bce699c.js","./dehydratedFeatureComparison-0d28d135.js","./queryForSymbologySnapping-4bf445c2.js","./elevationInfoUtils-38658fef.js","./hash-6f442295.js","./Graphics3DObjectStates-7c6ad957.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-161e756d.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-886070e6.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js","./FeatureStore-2c50987b.js","./BoundsStore-4bb1f6f0.js","./projectExtentUtils-b0efc861.js","./LayerView3D-3cbda063.js","./query-0260ec48.js","./pbfQueryUtils-13f6e3b7.js","./pbf-16158dc0.js","./EventedSet-a40b05a3.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js","./SceneModification-f81076cb.js","./persistable-bc783712.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-c6ac8ad3.js","./SceneLayerWorker-64d93102.js","./I3SQueryFeatureStore-03e370e4.js","./DefinitionExpressionSceneLayerView-ef830d30.js"],import.meta.url),csv:()=>he(()=>import("./CSVLayerView3D-bdb5d336.js"),["./CSVLayerView3D-bdb5d336.js","./FeatureLayerViewBase3D-0ef83067.js","./FeatureLikeLayerView3D-1bce699c.js","./Query-8ec96004.js","./dehydratedFeatureComparison-0d28d135.js","./queryForSymbologySnapping-4bf445c2.js","./elevationInfoUtils-38658fef.js","./hash-6f442295.js","./diffUtils-ef6bbcbf.js","./UniqueValueRenderer-3d9243c5.js","./ColorStop-2602b4bf.js","./colorRamps-b2150d6f.js","./Graphics3DObjectStates-7c6ad957.js","./jsonUtils-46c07947.js","./DictionaryLoader-4dd3c670.js","./FieldsIndex-6b49ca64.js","./UnknownTimeZone-ab7c6b01.js","./heatmapUtils-2351b1fb.js","./defaults-06f3d090.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./popupUtils-ef16fd02.js","./FeatureFilter-22854955.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-161e756d.js","./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-886070e6.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js","./FeatureSet-444cbc0f.js","./FeatureStore-2c50987b.js","./BoundsStore-4bb1f6f0.js","./projectExtentUtils-b0efc861.js","./LayerView3D-3cbda063.js","./query-0260ec48.js","./pbfQueryUtils-13f6e3b7.js","./pbf-16158dc0.js","./queryZScale-f8e7b210.js","./EventedSet-a40b05a3.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./FeatureEffect-01234d29.js","./jsonUtils-9ebed520.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js"],import.meta.url),dimension:()=>he(()=>import("./DimensionLayerView3D-c3a3b668.js"),["./DimensionLayerView3D-c3a3b668.js","./LayerView3D-3cbda063.js","./LayerView-8ac51c6c.js"],import.meta.url),elevation:wX,feature:()=>he(()=>import("./FeatureLayerView3D-95b77eed.js"),["./FeatureLayerView3D-95b77eed.js","./FeatureLayerViewBase3D-0ef83067.js","./FeatureLikeLayerView3D-1bce699c.js","./Query-8ec96004.js","./dehydratedFeatureComparison-0d28d135.js","./queryForSymbologySnapping-4bf445c2.js","./elevationInfoUtils-38658fef.js","./hash-6f442295.js","./diffUtils-ef6bbcbf.js","./UniqueValueRenderer-3d9243c5.js","./ColorStop-2602b4bf.js","./colorRamps-b2150d6f.js","./Graphics3DObjectStates-7c6ad957.js","./jsonUtils-46c07947.js","./DictionaryLoader-4dd3c670.js","./FieldsIndex-6b49ca64.js","./UnknownTimeZone-ab7c6b01.js","./heatmapUtils-2351b1fb.js","./defaults-06f3d090.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./popupUtils-ef16fd02.js","./FeatureFilter-22854955.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-161e756d.js","./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-886070e6.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js","./FeatureSet-444cbc0f.js","./FeatureStore-2c50987b.js","./BoundsStore-4bb1f6f0.js","./projectExtentUtils-b0efc861.js","./LayerView3D-3cbda063.js","./query-0260ec48.js","./pbfQueryUtils-13f6e3b7.js","./pbf-16158dc0.js","./queryZScale-f8e7b210.js","./EventedSet-a40b05a3.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./FeatureEffect-01234d29.js","./jsonUtils-9ebed520.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js"],import.meta.url),geojson:()=>he(()=>import("./GeoJSONLayerView3D-100f3add.js"),["./GeoJSONLayerView3D-100f3add.js","./FeatureLayerViewBase3D-0ef83067.js","./FeatureLikeLayerView3D-1bce699c.js","./Query-8ec96004.js","./dehydratedFeatureComparison-0d28d135.js","./queryForSymbologySnapping-4bf445c2.js","./elevationInfoUtils-38658fef.js","./hash-6f442295.js","./diffUtils-ef6bbcbf.js","./UniqueValueRenderer-3d9243c5.js","./ColorStop-2602b4bf.js","./colorRamps-b2150d6f.js","./Graphics3DObjectStates-7c6ad957.js","./jsonUtils-46c07947.js","./DictionaryLoader-4dd3c670.js","./FieldsIndex-6b49ca64.js","./UnknownTimeZone-ab7c6b01.js","./heatmapUtils-2351b1fb.js","./defaults-06f3d090.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./popupUtils-ef16fd02.js","./FeatureFilter-22854955.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-161e756d.js","./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-886070e6.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js","./FeatureSet-444cbc0f.js","./FeatureStore-2c50987b.js","./BoundsStore-4bb1f6f0.js","./projectExtentUtils-b0efc861.js","./LayerView3D-3cbda063.js","./query-0260ec48.js","./pbfQueryUtils-13f6e3b7.js","./pbf-16158dc0.js","./queryZScale-f8e7b210.js","./EventedSet-a40b05a3.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./FeatureEffect-01234d29.js","./jsonUtils-9ebed520.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js"],import.meta.url),graphics:()=>he(()=>import("./GraphicsLayerView3D-7599cd92.js"),["./GraphicsLayerView3D-7599cd92.js","./LayerView3D-3cbda063.js","./queryForSymbologySnapping-4bf445c2.js","./elevationInfoUtils-38658fef.js","./GraphicsProcessor-4211cdcd.js","./diffUtils-ef6bbcbf.js","./Query-8ec96004.js","./Graphics3DObjectStates-7c6ad957.js","./UniqueValueRenderer-3d9243c5.js","./ColorStop-2602b4bf.js","./colorRamps-b2150d6f.js","./jsonUtils-46c07947.js","./DictionaryLoader-4dd3c670.js","./FieldsIndex-6b49ca64.js","./UnknownTimeZone-ab7c6b01.js","./heatmapUtils-2351b1fb.js","./defaults-06f3d090.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./popupUtils-ef16fd02.js","./projectExtentUtils-b0efc861.js","./LayerView-8ac51c6c.js"],import.meta.url),group:()=>he(()=>import("./GroupLayerView-96242bff.js"),["./GroupLayerView-96242bff.js","./LayerView-8ac51c6c.js"],import.meta.url),imagery:()=>he(()=>import("./ImageryLayerView3D-5591a474.js"),["./ImageryLayerView3D-5591a474.js","./DynamicLayerView3D-1ff752ab.js","./LayerView3D-3cbda063.js","./projectExtentUtils-b0efc861.js","./ImageMaterial-27f6b83d.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./Query-8ec96004.js","./popupUtils-ef16fd02.js"],import.meta.url),"integrated-mesh":()=>he(()=>import("./IntegratedMeshLayerView3D-a143a233.js"),["./IntegratedMeshLayerView3D-a143a233.js","./I3SMeshView3D-18b89726.js","./I3SOverrides-0b4e6900.js","./I3SNode-4775f644.js","./I3SUtil-e0c4dc89.js","./Query-8ec96004.js","./I3SBinaryReader-ee1cba0c.js","./ReactiveSet-96dea6cb.js","./featureQueryAll-ec4a11be.js","./meshFeatureSet-28134c47.js","./External-48e3c7c0.js","./FeatureSet-444cbc0f.js","./FeatureLayerView3D-95b77eed.js","./FeatureLayerViewBase3D-0ef83067.js","./FeatureLikeLayerView3D-1bce699c.js","./dehydratedFeatureComparison-0d28d135.js","./queryForSymbologySnapping-4bf445c2.js","./elevationInfoUtils-38658fef.js","./hash-6f442295.js","./diffUtils-ef6bbcbf.js","./UniqueValueRenderer-3d9243c5.js","./ColorStop-2602b4bf.js","./colorRamps-b2150d6f.js","./Graphics3DObjectStates-7c6ad957.js","./jsonUtils-46c07947.js","./DictionaryLoader-4dd3c670.js","./FieldsIndex-6b49ca64.js","./UnknownTimeZone-ab7c6b01.js","./heatmapUtils-2351b1fb.js","./defaults-06f3d090.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./popupUtils-ef16fd02.js","./FeatureFilter-22854955.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-161e756d.js","./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-886070e6.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js","./FeatureStore-2c50987b.js","./BoundsStore-4bb1f6f0.js","./projectExtentUtils-b0efc861.js","./LayerView3D-3cbda063.js","./query-0260ec48.js","./pbfQueryUtils-13f6e3b7.js","./pbf-16158dc0.js","./queryZScale-f8e7b210.js","./EventedSet-a40b05a3.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./FeatureEffect-01234d29.js","./jsonUtils-9ebed520.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js","./SceneModification-f81076cb.js","./persistable-bc783712.js","./MD5-715f37cd.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-c6ac8ad3.js","./SceneLayerWorker-64d93102.js"],import.meta.url),"line-of-sight":()=>he(()=>import("./LineOfSightLayerView3D-4a73634e.js"),["./LineOfSightLayerView3D-4a73634e.js","./LayerView3D-3cbda063.js","./LayerView-8ac51c6c.js"],import.meta.url),"map-image":()=>he(()=>import("./MapImageLayerView3D-9b3b14cb.js"),["./MapImageLayerView3D-9b3b14cb.js","./DynamicLayerView3D-1ff752ab.js","./LayerView3D-3cbda063.js","./projectExtentUtils-b0efc861.js","./ImageMaterial-27f6b83d.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./ExportImageParameters-03ee7e4f.js","./floorFilterUtils-080a7cd2.js","./sublayerUtils-28c1d0d3.js","./MapServiceLayerViewHelper-d2a85004.js","./popupUtils-ef16fd02.js","./drapedUtils-a5c237e8.js"],import.meta.url),media:()=>he(()=>import("./MediaLayerView3D-4b74dbef.js"),["./MediaLayerView3D-4b74dbef.js","./MediaElementView-b6a47bc0.js","./normalizeUtilsSync-0fdddca0.js","./LayerView3D-3cbda063.js","./ImageMaterial-27f6b83d.js","./LayerView-8ac51c6c.js"],import.meta.url),"ogc-feature":()=>he(()=>import("./OGCFeatureLayerView3D-5929eb20.js"),["./OGCFeatureLayerView3D-5929eb20.js","./FeatureLayerViewBase3D-0ef83067.js","./FeatureLikeLayerView3D-1bce699c.js","./Query-8ec96004.js","./dehydratedFeatureComparison-0d28d135.js","./queryForSymbologySnapping-4bf445c2.js","./elevationInfoUtils-38658fef.js","./hash-6f442295.js","./diffUtils-ef6bbcbf.js","./UniqueValueRenderer-3d9243c5.js","./ColorStop-2602b4bf.js","./colorRamps-b2150d6f.js","./Graphics3DObjectStates-7c6ad957.js","./jsonUtils-46c07947.js","./DictionaryLoader-4dd3c670.js","./FieldsIndex-6b49ca64.js","./UnknownTimeZone-ab7c6b01.js","./heatmapUtils-2351b1fb.js","./defaults-06f3d090.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./popupUtils-ef16fd02.js","./FeatureFilter-22854955.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-161e756d.js","./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-886070e6.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js","./FeatureSet-444cbc0f.js","./FeatureStore-2c50987b.js","./BoundsStore-4bb1f6f0.js","./projectExtentUtils-b0efc861.js","./LayerView3D-3cbda063.js","./query-0260ec48.js","./pbfQueryUtils-13f6e3b7.js","./pbf-16158dc0.js","./queryZScale-f8e7b210.js","./EventedSet-a40b05a3.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./FeatureEffect-01234d29.js","./jsonUtils-9ebed520.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js"],import.meta.url),"open-street-map":gT,"oriented-imagery":()=>he(()=>import("./FeatureLayerView3D-95b77eed.js"),["./FeatureLayerView3D-95b77eed.js","./FeatureLayerViewBase3D-0ef83067.js","./FeatureLikeLayerView3D-1bce699c.js","./Query-8ec96004.js","./dehydratedFeatureComparison-0d28d135.js","./queryForSymbologySnapping-4bf445c2.js","./elevationInfoUtils-38658fef.js","./hash-6f442295.js","./diffUtils-ef6bbcbf.js","./UniqueValueRenderer-3d9243c5.js","./ColorStop-2602b4bf.js","./colorRamps-b2150d6f.js","./Graphics3DObjectStates-7c6ad957.js","./jsonUtils-46c07947.js","./DictionaryLoader-4dd3c670.js","./FieldsIndex-6b49ca64.js","./UnknownTimeZone-ab7c6b01.js","./heatmapUtils-2351b1fb.js","./defaults-06f3d090.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./popupUtils-ef16fd02.js","./FeatureFilter-22854955.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-161e756d.js","./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-886070e6.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js","./FeatureSet-444cbc0f.js","./FeatureStore-2c50987b.js","./BoundsStore-4bb1f6f0.js","./projectExtentUtils-b0efc861.js","./LayerView3D-3cbda063.js","./query-0260ec48.js","./pbfQueryUtils-13f6e3b7.js","./pbf-16158dc0.js","./queryZScale-f8e7b210.js","./EventedSet-a40b05a3.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./FeatureEffect-01234d29.js","./jsonUtils-9ebed520.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js"],import.meta.url),"point-cloud":()=>he(()=>import("./PointCloudLayerView3D-fce7e237.js").then(t=>t.P),["./PointCloudLayerView3D-fce7e237.js","./LayerView3D-3cbda063.js","./I3SUtil-e0c4dc89.js","./Query-8ec96004.js","./I3SBinaryReader-ee1cba0c.js","./PointCloudWorkerUtil-86251cf0.js","./PointCloudUniqueValueRenderer-0553c837.js","./ColorStop-2602b4bf.js","./PopupSceneLayerView-2a3d1587.js","./popupUtils-ef16fd02.js","./LayerView-8ac51c6c.js"],import.meta.url),voxel:()=>he(()=>import("./VoxelLayerView3D-b2077ebf.js"),["./VoxelLayerView3D-b2077ebf.js","./LayerView3D-3cbda063.js","./PopupSceneLayerView-2a3d1587.js","./popupUtils-ef16fd02.js","./LayerView-8ac51c6c.js"],import.meta.url),route:()=>he(()=>import("./RouteLayerView3D-d3ee95d4.js"),["./RouteLayerView3D-d3ee95d4.js","./Stop-8cff6fdb.js","./LayerView3D-3cbda063.js","./GraphicsProcessor-4211cdcd.js","./diffUtils-ef6bbcbf.js","./Query-8ec96004.js","./Graphics3DObjectStates-7c6ad957.js","./UniqueValueRenderer-3d9243c5.js","./ColorStop-2602b4bf.js","./colorRamps-b2150d6f.js","./jsonUtils-46c07947.js","./DictionaryLoader-4dd3c670.js","./FieldsIndex-6b49ca64.js","./UnknownTimeZone-ab7c6b01.js","./heatmapUtils-2351b1fb.js","./defaults-06f3d090.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./popupUtils-ef16fd02.js","./projectExtentUtils-b0efc861.js","./EventedSet-a40b05a3.js","./LayerView-8ac51c6c.js"],import.meta.url),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?he(()=>import("./SceneLayerView3D-f1f72466.js"),["./SceneLayerView3D-f1f72466.js","./ReactiveSet-96dea6cb.js","./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./UnknownTimeZone-ab7c6b01.js","./FeatureFilter-22854955.js","./Query-8ec96004.js","./floorFilterUtils-080a7cd2.js","./I3SMeshView3D-18b89726.js","./I3SOverrides-0b4e6900.js","./I3SNode-4775f644.js","./I3SUtil-e0c4dc89.js","./I3SBinaryReader-ee1cba0c.js","./featureQueryAll-ec4a11be.js","./meshFeatureSet-28134c47.js","./External-48e3c7c0.js","./FeatureSet-444cbc0f.js","./FeatureLayerView3D-95b77eed.js","./FeatureLayerViewBase3D-0ef83067.js","./FeatureLikeLayerView3D-1bce699c.js","./dehydratedFeatureComparison-0d28d135.js","./queryForSymbologySnapping-4bf445c2.js","./elevationInfoUtils-38658fef.js","./hash-6f442295.js","./diffUtils-ef6bbcbf.js","./UniqueValueRenderer-3d9243c5.js","./ColorStop-2602b4bf.js","./colorRamps-b2150d6f.js","./Graphics3DObjectStates-7c6ad957.js","./jsonUtils-46c07947.js","./DictionaryLoader-4dd3c670.js","./FieldsIndex-6b49ca64.js","./heatmapUtils-2351b1fb.js","./defaults-06f3d090.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./popupUtils-ef16fd02.js","./QueryEngine-161e756d.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-886070e6.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js","./FeatureStore-2c50987b.js","./BoundsStore-4bb1f6f0.js","./projectExtentUtils-b0efc861.js","./LayerView3D-3cbda063.js","./query-0260ec48.js","./pbfQueryUtils-13f6e3b7.js","./pbf-16158dc0.js","./queryZScale-f8e7b210.js","./EventedSet-a40b05a3.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./FeatureEffect-01234d29.js","./jsonUtils-9ebed520.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js","./SceneModification-f81076cb.js","./persistable-bc783712.js","./MD5-715f37cd.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-c6ac8ad3.js","./SceneLayerWorker-64d93102.js","./SceneLayerView-12e7f58c.js","./DefinitionExpressionSceneLayerView-ef830d30.js","./I3SQueryFeatureStore-03e370e4.js","./PopupSceneLayerView-2a3d1587.js"],import.meta.url):he(()=>import("./SceneLayerGraphicsView3D-f13f9fd8.js"),["./SceneLayerGraphicsView3D-f13f9fd8.js","./I3SOverrides-0b4e6900.js","./I3SNode-4775f644.js","./I3SUtil-e0c4dc89.js","./Query-8ec96004.js","./I3SBinaryReader-ee1cba0c.js","./ReactiveSet-96dea6cb.js","./featureQueryAll-ec4a11be.js","./meshFeatureSet-28134c47.js","./External-48e3c7c0.js","./FeatureSet-444cbc0f.js","./FeatureLayerView3D-95b77eed.js","./FeatureLayerViewBase3D-0ef83067.js","./FeatureLikeLayerView3D-1bce699c.js","./dehydratedFeatureComparison-0d28d135.js","./queryForSymbologySnapping-4bf445c2.js","./elevationInfoUtils-38658fef.js","./hash-6f442295.js","./diffUtils-ef6bbcbf.js","./UniqueValueRenderer-3d9243c5.js","./ColorStop-2602b4bf.js","./colorRamps-b2150d6f.js","./Graphics3DObjectStates-7c6ad957.js","./jsonUtils-46c07947.js","./DictionaryLoader-4dd3c670.js","./FieldsIndex-6b49ca64.js","./UnknownTimeZone-ab7c6b01.js","./heatmapUtils-2351b1fb.js","./defaults-06f3d090.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./popupUtils-ef16fd02.js","./FeatureFilter-22854955.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-161e756d.js","./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-886070e6.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js","./FeatureStore-2c50987b.js","./BoundsStore-4bb1f6f0.js","./projectExtentUtils-b0efc861.js","./LayerView3D-3cbda063.js","./query-0260ec48.js","./pbfQueryUtils-13f6e3b7.js","./pbf-16158dc0.js","./queryZScale-f8e7b210.js","./EventedSet-a40b05a3.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./FeatureEffect-01234d29.js","./jsonUtils-9ebed520.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js","./SceneLayerView-12e7f58c.js","./DefinitionExpressionSceneLayerView-ef830d30.js","./PopupSceneLayerView-2a3d1587.js"],import.meta.url),stream:()=>he(()=>import("./StreamLayerView3D-c11c8810.js"),["./StreamLayerView3D-c11c8810.js","./StreamFeatureManager-5d1a3f88.js","./createConnection-f9d069f8.js","./query-0260ec48.js","./pbfQueryUtils-13f6e3b7.js","./pbf-16158dc0.js","./queryZScale-f8e7b210.js","./Query-8ec96004.js","./EventedSet-a40b05a3.js","./FeatureLikeLayerView3D-1bce699c.js","./dehydratedFeatureComparison-0d28d135.js","./queryForSymbologySnapping-4bf445c2.js","./elevationInfoUtils-38658fef.js","./hash-6f442295.js","./diffUtils-ef6bbcbf.js","./UniqueValueRenderer-3d9243c5.js","./ColorStop-2602b4bf.js","./colorRamps-b2150d6f.js","./Graphics3DObjectStates-7c6ad957.js","./jsonUtils-46c07947.js","./DictionaryLoader-4dd3c670.js","./FieldsIndex-6b49ca64.js","./UnknownTimeZone-ab7c6b01.js","./heatmapUtils-2351b1fb.js","./defaults-06f3d090.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./popupUtils-ef16fd02.js","./FeatureFilter-22854955.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-161e756d.js","./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-886070e6.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js","./FeatureSet-444cbc0f.js","./FeatureStore-2c50987b.js","./BoundsStore-4bb1f6f0.js","./projectExtentUtils-b0efc861.js","./LayerView3D-3cbda063.js","./LayerView-8ac51c6c.js"],import.meta.url),tile:gT,"imagery-tile":()=>he(()=>import("./ImageryTileLayerView3D-d47b6582.js"),["./ImageryTileLayerView3D-d47b6582.js","./rasterProjectionHelper-369cade9.js","./LayerView3D-3cbda063.js","./TiledLayerView3D-dab5de9d.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./popupUtils-ef16fd02.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js","./drapedUtils-a5c237e8.js"],import.meta.url),"vector-tile":()=>he(()=>import("./VectorTileLayerView3D-ca88f6d4.js"),["./VectorTileLayerView3D-ca88f6d4.js","./Rect-98da58d6.js","./pbf-16158dc0.js","./rasterizingUtils-640ee782.js","./vec4f32-0d1b2306.js","./definitions-f7ca1c70.js","./enums-9d4f5c11.js","./number-e491b09e.js","./GeometryUtils-0258f920.js","./StyleRepository-7a215e42.js","./TileClipper-ae6eca9e.js","./LayerView3D-3cbda063.js","./TiledLayerView3D-dab5de9d.js","./LayerView-8ac51c6c.js"],import.meta.url),wcs:()=>he(()=>import("./ImageryTileLayerView3D-d47b6582.js"),["./ImageryTileLayerView3D-d47b6582.js","./rasterProjectionHelper-369cade9.js","./LayerView3D-3cbda063.js","./TiledLayerView3D-dab5de9d.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./popupUtils-ef16fd02.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js","./drapedUtils-a5c237e8.js"],import.meta.url),"web-tile":gT,wfs:()=>he(()=>import("./WFSLayerView3D-97d18819.js"),["./WFSLayerView3D-97d18819.js","./FeatureLayerViewBase3D-0ef83067.js","./FeatureLikeLayerView3D-1bce699c.js","./Query-8ec96004.js","./dehydratedFeatureComparison-0d28d135.js","./queryForSymbologySnapping-4bf445c2.js","./elevationInfoUtils-38658fef.js","./hash-6f442295.js","./diffUtils-ef6bbcbf.js","./UniqueValueRenderer-3d9243c5.js","./ColorStop-2602b4bf.js","./colorRamps-b2150d6f.js","./Graphics3DObjectStates-7c6ad957.js","./jsonUtils-46c07947.js","./DictionaryLoader-4dd3c670.js","./FieldsIndex-6b49ca64.js","./UnknownTimeZone-ab7c6b01.js","./heatmapUtils-2351b1fb.js","./defaults-06f3d090.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./popupUtils-ef16fd02.js","./FeatureFilter-22854955.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-161e756d.js","./WhereClause-94ad22d7.js","./TimeOnly-d19fd4d4.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-886070e6.js","./utils-5dc09d08.js","./generateRendererUtils-d73d141f.js","./FeatureSet-444cbc0f.js","./FeatureStore-2c50987b.js","./BoundsStore-4bb1f6f0.js","./projectExtentUtils-b0efc861.js","./LayerView3D-3cbda063.js","./query-0260ec48.js","./pbfQueryUtils-13f6e3b7.js","./pbf-16158dc0.js","./queryZScale-f8e7b210.js","./EventedSet-a40b05a3.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./FeatureEffect-01234d29.js","./jsonUtils-9ebed520.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js"],import.meta.url),wms:()=>he(()=>import("./WMSLayerView3D-c52e0e64.js"),["./WMSLayerView3D-c52e0e64.js","./DynamicLayerView3D-1ff752ab.js","./LayerView3D-3cbda063.js","./projectExtentUtils-b0efc861.js","./ImageMaterial-27f6b83d.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./ExportWMSImageParameters-e0d93099.js"],import.meta.url),wmts:()=>he(()=>import("./WMTSLayerView3D-8b8b566a.js"),["./WMTSLayerView3D-8b8b566a.js","./LayerView3D-3cbda063.js","./TiledLayerView3D-dab5de9d.js","./LayerView-8ac51c6c.js","./RefreshableLayerView-75b1f5f5.js"],import.meta.url),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function X5e(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",r=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new X(`${r}:view-not-supported`,`${e} is not supported in 3D`)}const TX={hasLayerViewModule:t=>xX[t.type]!=null,importLayerView:t=>{const e=xX[t.type];if(e==null)throw X5e(t);return e(t)}},SX="analyses-owner-handles";var Uw,s1;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(Uw||(Uw={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(s1||(s1={}));let $_=class extends xe{constructor(e){super(e),this._allAnalysisViews=new St,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=EX(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(ur("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(ur()),this._attachedToViewResolver=EX()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const r=this._items.get(e);if(r==null||r.state.list===s1.REMOVED)throw new X("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return r.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),SX)}_disconnectOwners(){this.removeHandles(SX),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const r=e.on("after-add",s=>this._addAnalysis(s.item)),i=e.on("after-remove",s=>this._removeAnalysis(s.item));return Rr(()=>{r.remove(),i.remove();for(const s of e)this._removeAnalysis(s)})}_addAnalysis(e){const r=this._items.get(e);if(r==null){const i={state:{view:Uw.PENDING,list:s1.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=cy(s=>this._createAnalysisViewPromise(i,s))}else r.state.list=s1.ADDED}_removeAnalysis(e){const r=this._items.get(e);r!=null?(r.state.list=s1.REMOVED,this._scheduleUpdate()):ne.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=w2(()=>this._update()))}_update(){this._scheduledUpdateHandle=di(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===s1.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case Uw.PENDING:e.createAnalysisViewTask=Ml(e.createAnalysisViewTask);break;case Uw.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Oe(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,r){const i=e.analysis,s=i.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,n.module==null)try{n.module=await this._loadAnalysisModule(s)}catch(a){throw this._creatingViewCount-=1,a}if(Ys(r))throw this._creatingViewCount-=1,ur("AnalysisView creation aborted");const o=new n.module.default({analysis:i,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(Ys(r))throw this._creatingViewCount-=1,o.destroy(),ur("AnalysisView creation aborted");return e.view=o,e.state.view=Uw.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return he(()=>import("./AreaMeasurementAnalysisView3D-144915c2.js").then(r=>r.A),["./AreaMeasurementAnalysisView3D-144915c2.js","./UnitNormalizer-5ea544ed.js","./Segment-924afad1.js","./unitFormatUtils-503fe940.js","./LineVisualElement-95b7ae27.js","./elevationInfoUtils-38658fef.js","./geometryEngine-a87c4ee7.js","./geometryEngineBase-28832c3f.js","./hydrated-3cade69c.js","./EditGeometryOperations-c99bbfd7.js"],import.meta.url);case"dimension":return he(()=>import("./DimensionAnalysisView3D-17c6dddf.js").then(r=>r.D),["./DimensionAnalysisView3D-17c6dddf.js","./LineVisualElement-95b7ae27.js","./LengthDimension-c70dfa9a.js","./Segment-924afad1.js","./unitFormatUtils-503fe940.js","./elevationInfoUtils-38658fef.js","./analysisViewUtils-ba4dc63c.js","./Factory-8b5a38d2.js","./ImageMaterial-27f6b83d.js","./vec4f32-0d1b2306.js","./RightAngleQuadVisualElement-139c3851.js","./PointVisualElement-e6db4584.js","./Query-8ec96004.js","./EditGeometryOperations-c99bbfd7.js","./FeatureFilter-22854955.js","./floorFilterUtils-080a7cd2.js","./dehydratedFeatureComparison-0d28d135.js"],import.meta.url);case"direct-line-measurement":return he(()=>import("./DirectLineMeasurementAnalysisView3D-4022deae.js").then(r=>r.D),["./DirectLineMeasurementAnalysisView3D-4022deae.js","./UnitNormalizer-5ea544ed.js","./Segment-924afad1.js","./unitFormatUtils-503fe940.js","./LineVisualElement-95b7ae27.js","./elevationInfoUtils-38658fef.js","./geometryEngine-a87c4ee7.js","./geometryEngineBase-28832c3f.js","./hydrated-3cade69c.js","./RightAngleQuadVisualElement-139c3851.js"],import.meta.url);case"line-of-sight":return he(()=>import("./LineOfSightAnalysisView3D-2a8582f5.js"),["./LineOfSightAnalysisView3D-2a8582f5.js","./LineVisualElement-95b7ae27.js","./LineOfSightAnalysisTarget-20ecfb8f.js","./persistable-bc783712.js","./MD5-715f37cd.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-c6ac8ad3.js","./ElevationInfo-1c41bf4e.js","./elevationInfoUtils-38658fef.js","./analysisViewUtils-ba4dc63c.js","./PointVisualElement-e6db4584.js"],import.meta.url);case"slice":return he(()=>import("./SliceAnalysisView3D-6dc1541d.js").then(r=>r.S),["./SliceAnalysisView3D-6dc1541d.js","./LineVisualElement-95b7ae27.js","./persistable-bc783712.js","./MD5-715f37cd.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-c6ac8ad3.js","./BuildingComponentSublayer-f76e8f2e.js","./UniqueValueRenderer-3d9243c5.js","./ColorStop-2602b4bf.js","./diffUtils-ef6bbcbf.js","./colorRamps-b2150d6f.js","./jsonUtils-46c07947.js","./DictionaryLoader-4dd3c670.js","./FieldsIndex-6b49ca64.js","./UnknownTimeZone-ab7c6b01.js","./heatmapUtils-2351b1fb.js","./FeatureLayer-0e0c57d1.js","./MultiOriginJSONSupport-9addf1b7.js","./FeatureLayerBase-8013eb8f.js","./commonProperties-7ade9483.js","./ElevationInfo-1c41bf4e.js","./featureLayerUtils-9cc96c71.js","./featureQueryAll-ec4a11be.js","./Query-8ec96004.js","./AttachmentQuery-c73fbbfb.js","./RelationshipQuery-25c3c532.js","./LayerFloorInfo-039148db.js","./serviceCapabilitiesUtils-91567898.js","./editsZScale-d6a84b25.js","./queryZScale-f8e7b210.js","./FeatureSet-444cbc0f.js","./APIKeyMixin-fb65fce7.js","./ArcGISService-377485dc.js","./BlendLayer-d14012f0.js","./jsonUtils-9ebed520.js","./CustomParametersMixin-50d5a4c8.js","./EditBusLayer-525e2b98.js","./FeatureEffectLayer-b5512874.js","./FeatureEffect-01234d29.js","./FeatureFilter-22854955.js","./FeatureReductionLayer-a16eba95.js","./FeatureReductionSelection-02d3f160.js","./LabelClass-f01c9855.js","./defaults-06f3d090.js","./defaultsJSON-59981e75.js","./OperationalLayer-381cacc8.js","./OrderedLayer-2db1a879.js","./PortalLayer-806db449.js","./portalItemUtils-bd3ade0c.js","./ScaleRangeLayer-47bc8cb3.js","./TemporalLayer-a67ca634.js","./FeatureTemplate-40f36ca2.js","./FeatureType-baed6dd6.js","./fieldProperties-8bc1b40a.js","./labelingInfo-c32eb8fe.js","./versionUtils-abea1fa8.js","./styleUtils-5179403f.js","./TopFeaturesQuery-61f4fc16.js","./popupUtils-87764fa9.js","./interfaces-f1f22245.js","./capabilities-c607cf72.js","./I3SIndexInfo-6a2ec503.js","./I3SLayerDefinitions-525a9cd0.js","./I3SUtil-e0c4dc89.js","./I3SBinaryReader-ee1cba0c.js","./popupUtils-ef16fd02.js","./analysisViewUtils-ba4dc63c.js","./Factory-8b5a38d2.js","./ImageMaterial-27f6b83d.js"],import.meta.url)}}};function EX(){const t=Go();return t.promise.catch(()=>{}),t}h([f()],$_.prototype,"updating",null),h([f({constructOnly:!0})],$_.prototype,"view",void 0),h([f()],$_.prototype,"_allAnalysisViews",void 0),h([f()],$_.prototype,"_creatingViewCount",void 0),$_=h([k("esri.views.3d.analysis.AnalysisViewManager3D")],$_);const Z5e=$_;let If=class extends xe{constructor(e){super(e),this.collision=new PS,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===$e.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==$e.Local?this._set("altitude",e):ne.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?me(e,this.altitude.min,this.altitude.max):e}clampTilt(e,r){if(!this.tilt)return r;const i=this.tilt(e);return me(r,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===$e.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(r,i=W4)=>(i.min=ao.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?eM([[4e3,ao.max],[1e4,At(88)],[6e6,At(88)]]):()=>ao.max;return(r,i=W4)=>(i.min=ao.min,i.max=e(r),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?eM([[4e3,ao.max],[5e4,At(88)],[6e6,At(88)],[2e7,ao.min]]):eM([[3e5,ao.max],[3e6,At(88)],[6e6,At(88)],[2e7,ao.min]]);return(r,i=W4)=>(i.min=ao.min,i.max=e(r),i)}};function J5e(t){return{min:-2e5,max:4*t.radius}}h([f()],If.prototype,"altitude",null),h([f({readOnly:!0})],If.prototype,"collision",void 0),h([f()],If.prototype,"distance",void 0),h([f({readOnly:!0})],If.prototype,"minimumPoiDistance",void 0),h([f()],If.prototype,"tilt",void 0),h([f({constructOnly:!0})],If.prototype,"mode",void 0),If=h([k("esri.views.3d.state.Constraints")],If);const CX=J5e(mr),ao={min:At(.5),max:At(179.5)},W4={min:0,max:0};let PS=class extends xe{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};h([f({type:Boolean})],PS.prototype,"enabled",void 0),h([f({type:Number})],PS.prototype,"elevationMargin",void 0),PS=h([k("esri.views.3d.state.Constraints.CollisionConstraint")],PS);let kw=class extends xe{constructor(){super(...arguments),this.min=CX.min,this.max=CX.max}};h([f({type:Number})],kw.prototype,"min",void 0),h([f({type:Number})],kw.prototype,"max",void 0),kw=h([k("esri.views.3d.constraints.AltitudeConstraint")],kw);let zf=class extends xe{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,r){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==r&&this._set("far",r))}};h([f({type:Number,value:1e-8})],zf.prototype,"near",null),h([zi("near")],zf.prototype,"castNear",null),h([f({type:Number,value:1e-8})],zf.prototype,"far",null),h([zi("far")],zf.prototype,"castFar",null),h([f({type:["auto","manual"]})],zf.prototype,"mode",void 0),zf=h([k("esri.views.3d.constraints.ClipDistanceConstraint")],zf);const B9={min:_a(ao.min),max:_a(ao.max)};let n1=class extends xe{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return me(e,B9.min,B9.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};h([f({type:["auto","manual"]})],n1.prototype,"mode",void 0),h([f({type:Number,value:B9.max})],n1.prototype,"max",null),h([zi("max")],n1.prototype,"castMax",null),n1=h([k("esri.views.3d.constraints.TiltConstraint")],n1);let o1=class extends xe{constructor(){super(...arguments),this.tilt=new n1,this.altitude=new kw,this.clipDistance=new zf}};h([f({type:n1})],o1.prototype,"tilt",void 0),h([f({type:kw})],o1.prototype,"altitude",void 0),h([f({type:zf})],o1.prototype,"clipDistance",void 0),o1=h([k("esri.views.3d.constraints.Constraints")],o1);var z9;let Kc=z9=class extends st{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,r){e[r]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,r){t&&(e[r]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new z9(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};h([f({readOnly:!0,type:["sun"],json:{write:!0}})],Kc.prototype,"type",void 0),h([f({type:Date,json:{type:Number,write:{target:"datetime"}}})],Kc.prototype,"date",void 0),h([si("date",["datetime"])],Kc.prototype,"readDate",null),h([ni("date")],Kc.prototype,"writeDate",null),h([f({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Kc.prototype,"directShadowsEnabled",void 0),h([si("directShadowsEnabled",["directShadows"])],Kc.prototype,"readDirectShadowsEnabled",null),h([ni("directShadowsEnabled")],Kc.prototype,"writedirectShadowsEnabled",null),h([f({type:Number,json:{write:!0}})],Kc.prototype,"displayUTCOffset",void 0),h([ni("displayUTCOffset")],Kc.prototype,"writeDisplayUTCOffset",null),Kc=z9=h([k("esri.webscene.SunLighting")],Kc);const GC=Kc;var ow;const mpe="esri.views.3d.environment.SunLighting",_R=ne.getLogger(mpe);let Jd=ow=class extends Ps.EventedMixin(GC){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),r=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get ambientOcclusionEnabled(){return f0(_R,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){f0(_R,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return f0(_R,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){f0(_R,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new ow(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const r=ow.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let i=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=ow.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==s&&(vR.target=this,vR.timezoneOffset=s,this.emit("timezone-will-change",vR),vR.target=null),t!=null)return isNaN(t.getTime())||i!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new ow({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([f({type:Boolean})],Jd.prototype,"cameraTrackingEnabled",void 0),h([f({type:Boolean})],Jd.prototype,"ambientOcclusionEnabled",null),h([f({type:Boolean})],Jd.prototype,"waterReflectionEnabled",null),h([f({type:Date})],Jd.prototype,"defaultDate",null),h([f({type:Date})],Jd.prototype,"date",null),Jd=ow=h([k(mpe)],Jd),function(t){function e({hours:r,minutes:i,seconds:s}){return Math.round(r+i/60+s/3600)}t.calculateTimezoneOffset=e}(Jd||(Jd={}));const vR={target:null,timezoneOffset:0},I_=Jd;var V9;let MS=V9=class extends st{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new V9(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};h([f({readOnly:!0,type:["virtual"],json:{write:!0}})],MS.prototype,"type",void 0),h([f({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],MS.prototype,"directShadowsEnabled",void 0),MS=V9=h([k("esri.webscene.VirtualLighting")],MS);const YD=MS;var lM;const gpe="esri.views.3d.environment.VirtualLighting",bR=ne.getLogger(gpe);let aw=lM=class extends Ps.EventedMixin(YD){constructor(t){super(t),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return f0(bR,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){f0(bR,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return f0(bR,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){f0(bR,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}clone(){return new lM({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new lM(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([f({type:Boolean})],aw.prototype,"ambientOcclusionEnabled",null),h([f({type:Boolean})],aw.prototype,"waterReflectionEnabled",null),h([f({type:Boolean})],aw.prototype,"cameraTrackingEnabled",void 0),aw=lM=h([k(gpe)],aw);const $S=aw,Q5e={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:I_,virtual:$S}};var G9;let kE=G9=class extends xe{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new G9({quality:this.quality})}};h([f({type:["low","high"],value:"low"})],kE.prototype,"quality",null),kE=G9=h([k("esri.views.3d.environment.SceneViewAtmosphere")],kE);var j9;let IS=j9=class extends st{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new j9({cloudCover:this.cloudCover})}};h([Ht({sunny:"sunny"})],IS.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],IS.prototype,"cloudCover",void 0),IS=j9=h([k("esri.views.3d.environment.SunnyWeather")],IS);const H9=IS;var q9;let LS=q9=class extends st{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new q9({cloudCover:this.cloudCover})}};h([Ht({cloudy:"cloudy"})],LS.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],LS.prototype,"cloudCover",void 0),LS=q9=h([k("esri.views.3d.environment.CloudyWeather")],LS);const K5e=LS;var W9;let DS=W9=class extends st{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new W9({fogStrength:this.fogStrength})}};h([Ht({foggy:"foggy"})],DS.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],DS.prototype,"fogStrength",void 0),DS=W9=h([k("esri.views.3d.environment.FoggyWeather")],DS);const eFe=DS;var Y9;let lw=Y9=class extends st{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Y9({cloudCover:this.cloudCover,precipitation:this.precipitation})}};h([Ht({rainy:"rainy"})],lw.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],lw.prototype,"cloudCover",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],lw.prototype,"precipitation",void 0),lw=Y9=h([k("esri.views.3d.environment.RainyWeather")],lw);const tFe=lw;var X9;let L_=X9=class extends st{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new X9({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};h([Ht({snowy:"snowy"})],L_.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],L_.prototype,"cloudCover",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],L_.prototype,"precipitation",void 0),h([f({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],L_.prototype,"snowCover",void 0),L_=X9=h([k("esri.views.3d.environment.SnowyWeather")],L_);const rFe=L_,ype={key:"type",base:H9,typeMap:{sunny:H9,cloudy:K5e,rainy:tFe,snowy:rFe,foggy:eFe}},iFe=Object.keys(ype.typeMap);function sFe(t,e){return!!iFe.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const Hf=1e4,nFe=1e5,oFe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:GC,virtual:YD}};let cM=class extends st{constructor(e){super(e)}clone(){}};h([f({readOnly:!0,json:{read:!1}})],cM.prototype,"type",void 0),cM=h([k("esri.webscene.background.Background")],cM);const _pe=cM;var Z9;const aFe={...Om,nonNullable:!0};let NS=Z9=class extends _pe{constructor(t){super(t),this.type="color",this.color=new qe([0,0,0,1])}clone(){return new Z9(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};h([Ht({color:"color"},{readOnly:!0})],NS.prototype,"type",void 0),h([f(aFe)],NS.prototype,"color",void 0),NS=Z9=h([k("esri.webscene.background.ColorBackground")],NS);const vpe=NS,AX={base:_pe,key:"type",typeMap:{color:vpe}};function lFe(t){return(e,r,i)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,i),n}}}const cFe={types:AX,json:{read:lFe(AX),write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.isPresentation})}}};var J9;const bpe="esri.webscene.Environment",uFe=ne.getLogger(bpe),RX=(t,e,r)=>({enabled:!r||!r.isPresentation});let qg=J9=class extends st{constructor(t){super(t),this.lighting=new GC,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){sFe(t==null?void 0:t.type,uFe)&&this._set("weather",t)}clone(){return new J9(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?YD.prototype.clone.call(this.lighting):GC.prototype.clone.call(this.lighting),background:ye(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};h([f({types:oFe,nonNullable:!0,json:{write:!0}})],qg.prototype,"lighting",void 0),h([f(cFe)],qg.prototype,"background",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:RX}}})],qg.prototype,"atmosphereEnabled",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:RX}}})],qg.prototype,"starsEnabled",void 0),h([f({types:ype,nonNullable:!0,json:{write:!0},value:new H9})],qg.prototype,"weather",null),qg=J9=h([k(bpe)],qg);const wpe=qg;var FS;let cw=FS=class extends wpe{constructor(t){super(t),this.atmosphere=new kE,this.lighting=this.castLighting(),this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new FS({...e,lighting:e.lighting?e.lighting.type==="virtual"?$S.fromWebsceneLighting(e.lighting):I_.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLightingWithDestroy(t)}applyLighting(t){this.lighting=this._convertLightingWithDestroy(t)}_convertLightingWithDestroy(t){const e=this._convertLighting(t);return e!==t&&this.addHandles(jse(e)),e}_convertLighting(t){var e,r;return t?t instanceof I_||t instanceof $S?t:t instanceof GC?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new I_({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof YD?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new $S({...t.cloneConstructProperties(),...(r=this.lighting)==null?void 0:r.cloneNonPersistentConstructProperties()}):k0(Q5e,t):new I_}clone(){return new FS({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ye(this.background)})}cloneWithWebsceneEnvironment(t){return new FS({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ye(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):I_.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):$S.fromWebsceneLighting(t.lighting);default:return t.lighting,I_.fromWebsceneLighting(t.lighting)}}};h([f({type:kE,json:{read:!1},nonNullable:!0})],cw.prototype,"atmosphere",void 0),h([f({nonNullable:!0})],cw.prototype,"lighting",void 0),h([zi("lighting")],cw.prototype,"castLighting",null),cw=FS=h([k("esri.views.3d.environment.SceneViewEnvironment")],cw);const uw=cw;function hFe(t,e,r){if(e==null)return!1;const i=mue(e);return i!=null&&(i(t,0,yT,0),r!==yT&&(r[0]=yT[0],r[1]=yT[1],r.length>2&&(r[2]=yT[2])),!0)}const yT=E();function dFe(t,e){wR[0]=t.x,wR[1]=t.y;const r=t.z;return wR[2]=r!==void 0?r:0,hFe(wR,t.spatialReference,e)}const wR=E();var Co;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(Co||(Co={}));function pFe(t){return"r"in t&&"g"in t&&"b"in t}function xpe(t){return"h"in t&&"s"in t&&"v"in t}function Tpe(t){return"l"in t&&"a"in t&&"b"in t}function Spe(t){return"l"in t&&"c"in t&&"h"in t}function fFe(t){return"x"in t&&"y"in t&&"z"in t}const mFe=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],gFe=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function Epe(t,e){const r=[];let i,s;if(t[0].length!==e.length)throw new Error("dimensions do not match");const n=t.length,o=t[0].length;let a=0;for(i=0;i<n;i++){for(a=0,s=0;s<o;s++)a+=t[i][s]*e[s];r.push(a)}return r}function Cpe(t){const e=[t.r/255,t.g/255,t.b/255].map(i=>i<=.04045?i/12.92:((i+.055)/1.055)**2.4),r=Epe(mFe,e);return{x:100*r[0],y:100*r[1],z:100*r[2]}}function pG(t){const e=Epe(gFe,[t.x/100,t.y/100,t.z/100]).map(r=>{const i=r<=.0031308?12.92*r:1.055*r**.4166666666666667-.055;return Math.min(1,Math.max(i,0))});return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function Ape(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map(r=>r>.008856451679035631?r**.3333333333333333:7.787037037037035*r+.13793103448275862);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function Rpe(t){const e=t.l,r=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map(i=>i>6/29?i**3:3*(6/29)**2*(i-4/29));return{x:95.047*r[0],y:100*r[1],z:108.883*r[2]}}function yFe(t){const e=t.l,r=t.a,i=t.b,s=Math.sqrt(r*r+i*i);let n=Math.atan2(i,r);return n=n>0?n:n+2*Math.PI,{l:e,c:s,h:n}}function _Fe(t){const e=t.l,r=t.c,i=t.h;return{l:e,a:r*Math.cos(i),b:r*Math.sin(i)}}function vFe(t){return Ape(Cpe(t))}function bFe(t){return pG(Rpe(t))}function wFe(t){return yFe(Ape(Cpe(t)))}function xFe(t){return pG(Rpe(_Fe(t)))}function TFe(t){const e=t.r,r=t.g,i=t.b,s=Math.max(e,r,i),n=s-Math.min(e,r,i);let o=s,a=n===0?0:s===e?(r-i)/n%6:s===r?(i-e)/n+2:(e-r)/n+4,l=n===0?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function SFe(t){const e=(t.h+360)%360/60,r=t.s/100,i=t.v/100*255,s=i*r,n=s*(1-Math.abs(e%2-1));let o;switch(Math.floor(e)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+i-s),o.g=Math.round(o.g+i-s),o.b=Math.round(o.b+i-s),o}function fG(t){return pFe(t)?t:Spe(t)?xFe(t):Tpe(t)?bFe(t):fFe(t)?pG(t):xpe(t)?SFe(t):t}function l_t(t){return xpe(t)?t:TFe(fG(t))}function c_t(t){return Tpe(t)?t:vFe(fG(t))}function u_t(t){return Spe(t)?t:wFe(fG(t))}function EFe(t){let{r:e,g:r,b:i,a:s}=t;return s<1&&(e=Math.round(s*e+255*(1-s)),r=Math.round(s*r+255*(1-s)),i=Math.round(s*i+255*(1-s))),new qe({r:e,g:r,b:i})}function CFe(t,e){const{r,g:i,b:s}=e!=null&&e.ignoreAlpha?t:EFe(t);return .2126*r+.7152*i+.0722*s}var Q9;function h_t(t,e=Q9.High){return CFe(t,{ignoreAlpha:!0})>e?new qe([0,0,0,t.a]):new qe([255,255,255,t.a])}function d_t(t,e){const r=t.clone();return r.a*=e,r}function jC(t){return qe.toUnitRGBA(t)}function p_t(t,e){return t===e||t!=null&&e!=null&&Z1(t,e)}function f_t(t){return Ot(t[0],t[1],t[2],t.length>3?t[3]:1)}function m_t(t,e){const r=qe.toUnitRGBA(t);return r[3]*=e,r}(function(t){t[t.Low=160]="Low",t[t.High=225]="High"})(Q9||(Q9={}));function Ns(t,e){return t[0]=e[0],t[1]=e[1],t}function ir(t,e,r){return t[0]=e,t[1]=r,t}function Ch(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function pp(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Ope(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function Ppe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function AFe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function RFe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function OFe(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function PFe(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function MFe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function xl(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function $Fe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function X0(t,e){const r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function dI(t,e){const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function mG(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function Mpe(t){const e=t[0],r=t[1];return e*e+r*r}function gG(t,e){return t[0]=-e[0],t[1]=-e[1],t}function IFe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function HC(t,e){const r=e[0],i=e[1];let s=r*r+i*i;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function Vs(t,e){return t[0]*e[0]+t[1]*e[1]}function LFe(t,e,r){const i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function fu(t,e,r,i){const s=e[0],n=e[1];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t}function DFe(t,e){e=e||1;const r=2*A3()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function $pe(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s,t[1]=r[1]*i+r[3]*s,t}function Wg(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s+r[4],t[1]=r[1]*i+r[3]*s+r[5],t}function NFe(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[3]*s+r[6],t[1]=r[1]*i+r[4]*s+r[7],t}function FFe(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[4]*s+r[12],t[1]=r[1]*i+r[5]*s+r[13],t}function UFe(t,e,r,i){const s=e[0]-r[0],n=e[1]-r[1],o=Math.sin(i),a=Math.cos(i);return t[0]=s*a-n*o+r[0],t[1]=s*o+n*a+r[1],t}function kFe(t,e){const r=t[0],i=t[1],s=e[0],n=e[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(r*s+i*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function BFe(t){return"vec2("+t[0]+", "+t[1]+")"}function Ipe(t,e){return t[0]===e[0]&&t[1]===e[1]}function Lpe(t,e){const r=t[0],i=t[1],s=e[0],n=e[1],o=Qn();return Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-n)<=o*Math.max(1,Math.abs(i),Math.abs(n))}function zFe(t,e,r,i,s){let n=e[0]-r[0],o=e[1]-r[1];const a=(i[0]*n+i[1]*o)*(s-1);return n=i[0]*a,o=i[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const VFe=mG,GFe=pp,jFe=Ope,HFe=Ppe,Dpe=X0,qFe=dI,WFe=Mpe;Object.freeze(Object.defineProperty({__proto__:null,add:Ch,angle:kFe,ceil:AFe,copy:Ns,cross:LFe,dist:Dpe,distance:X0,div:HFe,divide:Ppe,dot:Vs,equals:Lpe,exactEquals:Ipe,floor:RFe,inverse:IFe,len:VFe,length:mG,lerp:fu,max:PFe,min:OFe,mul:jFe,multiply:Ope,negate:gG,normalize:HC,projectAndScale:zFe,random:DFe,rotate:UFe,round:MFe,scale:xl,scaleAndAdd:$Fe,set:ir,sqrDist:qFe,sqrLen:WFe,squaredDistance:dI,squaredLength:Mpe,str:BFe,sub:GFe,subtract:pp,transformMat2:$pe,transformMat2d:Wg,transformMat3:NFe,transformMat4:FFe},Symbol.toStringTag,{value:"Module"}));function yG(t){return me((t-1e5)/(1e6-1e5),0,1)}const K9=1e4,YFe=.085,s0=1e5;let XFe=class{};const Vr=XFe;function b(t,...e){let r="";for(let i=0;i<e.length;i++)r+=t[i]+e[i];return r+=t[t.length-1],r}(function(t){function e(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}t.int=e,t.float=r})(b||(b={}));var R;function ZFe(t){return t===R.POSITION}(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.PERSPECTIVEDIVIDE="perspectiveDivide",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.INSTANCEMODELORIGINHI="instanceModelOriginHi",t.INSTANCEMODELORIGINLO="instanceModelOriginLo",t.INSTANCEMODEL="instanceModel",t.INSTANCEMODELNORMAL="instanceModelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(R||(R={}));var xs;function Rp(t,e){switch(e.textureCoordinateType){case xs.Default:return t.attributes.add(R.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(b`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case xs.Compressed:return t.attributes.add(R.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(b`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case xs.Atlas:return t.attributes.add(R.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(R.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(b`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case xs.None:return void t.vertex.code.add(b`void forwardTextureCoordinates() {}`);case xs.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(xs||(xs={}));function zu(t){t.code.add(b`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Nu(t){t.include(zu),t.code.add(b`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTex, 0)));
return linearDepthFromRGBA(texelFetch(depthTex, iuv, 0), nearFar);
}`)}function XD(t){t.fragment.code.add(b`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var gr;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(gr||(gr={}));let qi=class{constructor(e,r,i,s,n=null){if(this.name=e,this.type=r,this.arraySize=n,this.bind={[gr.Pass]:null,[gr.Draw]:null},s)switch(i){case gr.Pass:this.bind[gr.Pass]=s;break;case gr.Draw:this.bind[gr.Draw]=s}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},Pt=class extends qi{constructor(e,r){super(e,"vec3",gr.Pass,(i,s,n)=>i.setUniform3fv(e,r(s,n)))}};function Lm(t){t.uniforms.add(new Pt("mainLightDirection",(e,r)=>r.lighting.mainLight.direction))}function Jp(t){t.uniforms.add(new Pt("mainLightIntensity",(e,r)=>r.lighting.mainLight.intensity))}function pI(t){Lm(t.fragment),Jp(t.fragment),t.fragment.code.add(b`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let Ir=class extends qi{constructor(e,r){super(e,"vec2",gr.Pass,(i,s,n)=>i.setUniform2fv(e,r(s,n)))}},nr=class extends qi{constructor(e,r){super(e,"vec4",gr.Pass,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}},Ee=class extends qi{constructor(e,r){super(e,"float",gr.Pass,(i,s,n)=>i.setUniform1f(e,r(s,n)))}},Li=class extends qi{constructor(e,r){super(e,"mat4",gr.Pass,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};const Jo=Jt();let JFe=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function Je(t,e){if(!t){e=e||"Assertion";const r=new Error(e).stack;throw new JFe(`${e} at ${r}`)}}function Kv(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function OX(t,e,r,i){let s,n=(r[0]-t[0])/e[0],o=(i[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(r[1]-t[1])/e[1],l=(i[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(r[2]-t[2])/e[2],u=(i[2]-t[2])/e[2];return c>u&&(s=c,c=u,u=s),!(n>u||c>o)&&(u<o&&(o=u),!(o<0))}function xR(t,e,r,i,s,n=ke()){const o=(i[s]-r[s])*(e[0]-t[0])-(i[0]-r[0])*(e[s]-t[s]),a=(i[0]-r[0])*(t[s]-r[s])-(i[s]-r[s])*(t[0]-r[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function PX(t,e,r,i,s){Jo[0]=t[0],Jo[1]=t[1],Jo[2]=t[2],Jo[3]=1,gc(Jo,Jo,e),s.length>2&&(s[2]=-Jo[2]),gc(Jo,Jo,r),Je(Jo[3]!==0),s[0]=Jo[0]/Jo[3],s[1]=Jo[1]/Jo[3],s[2]=Jo[2]/Jo[3],s[0]=(.5*s[0]+.5)*i[2]+i[0],s[1]=(.5*s[1]+.5)*i[3]+i[1]}function QFe(t,e){return Math.log(t)/Math.log(e)}function KFe(t,e,r,i){t[12]=e,t[13]=r,t[14]=i}function Npe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const Fpe=ne.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let Upe=class{constructor(){this._includedModules=new Map}include(e,r){if(this._includedModules.has(e)){const i=this._includedModules.get(e);if(i!==r){Fpe.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(i))i[n]!==e[n]&&s.add(n);for(const n of Object.keys(e))i[n]!==e[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${i[n]} new ${e[n]}`))}}else this._includedModules.set(e,r),e(this.builder,r)}},dr=class extends Upe{constructor(){super(...arguments),this.vertex=new MX,this.fragment=new MX,this.attributes=new r6e,this.varyings=new i6e,this.extensions=new ek,this.constants=new kpe,this.outputs=new rk}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),s=this.varyings.generateSource(e),n=e==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=e==="vertex"?n6e:s6e,c=this.constants.generateSource().concat(n.constants.generateSource()),u=this.outputs.generateSource(e);return`#version 300 es
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${s.join(`
`)}

${u.join(`
`)}

${a.join(`
`)}`}generateBindPass(e){const r=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[gr.Pass];o&&r.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[gr.Pass];o&&r.set(n.name,o)});const i=Array.from(r.values()),s=i.length;return(n,o)=>{for(let a=0;a<s;++a)i[a](e,n,o)}}generateBindDraw(e){const r=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[gr.Draw];o&&r.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[gr.Draw];o&&r.set(n.name,o)});const i=Array.from(r.values()),s=i.length;return(n,o,a)=>{for(let l=0;l<s;++l)i[l](e,n,o,a)}}},e6e=class{constructor(){this._entries=new Map}add(...e){for(const r of e)this._add(r)}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new X(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else Fpe.error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},t6e=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},MX=class extends Upe{constructor(){super(...arguments),this.uniforms=new e6e,this.code=new t6e,this.constants=new kpe}get builder(){return this}},r6e=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(e){return e==="fragment"?[]:this._entries.map(r=>`in ${r[1]} ${r[0]};`)}},i6e=class{constructor(){this._entries=new Map}add(e,r){this._entries.has(e)&&Je(this._entries.get(e)===r),this._entries.set(e,r)}generateSource(e){const r=new Array;return this._entries.forEach((i,s)=>r.push(e==="vertex"?`out ${i} ${s};`:`in ${i} ${s};`)),r}},ek=class tk{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const r=e==="vertex"?tk.ALLOWLIST_VERTEX:tk.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}};ek.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],ek.ALLOWLIST_VERTEX=[];let rk=class ik{constructor(){this._entries=new Map}add(e,r,i=0){const s=this._entries.get(i);s?Je(s.name===e&&s.type===r,`Fragment shader output location ${i} occupied`):this._entries.set(i,{name:e,type:r})}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:ik.DEFAULT_NAME,type:ik.DEFAULT_TYPE});const r=new Array;return this._entries.forEach((i,s)=>r.push(`layout(location = ${s}) out ${i.type} ${i.name};`)),r}};rk.DEFAULT_TYPE="vec4",rk.DEFAULT_NAME="fragColor";let kpe=class Us{constructor(){this._entries=new Set}add(e,r,i){let s="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":s=Us._numberToFloatStr(i);break;case"int":s=Us._numberToIntStr(i);break;case"bool":s=i.toString();break;case"vec2":s=`vec2(${Us._numberToFloatStr(i[0])},                            ${Us._numberToFloatStr(i[1])})`;break;case"vec3":s=`vec3(${Us._numberToFloatStr(i[0])},                            ${Us._numberToFloatStr(i[1])},                            ${Us._numberToFloatStr(i[2])})`;break;case"vec4":s=`vec4(${Us._numberToFloatStr(i[0])},                            ${Us._numberToFloatStr(i[1])},                            ${Us._numberToFloatStr(i[2])},                            ${Us._numberToFloatStr(i[3])})`;break;case"ivec2":s=`ivec2(${Us._numberToIntStr(i[0])},                             ${Us._numberToIntStr(i[1])})`;break;case"ivec3":s=`ivec3(${Us._numberToIntStr(i[0])},                             ${Us._numberToIntStr(i[1])},                             ${Us._numberToIntStr(i[2])})`;break;case"ivec4":s=`ivec4(${Us._numberToIntStr(i[0])},                             ${Us._numberToIntStr(i[1])},                             ${Us._numberToIntStr(i[2])},                             ${Us._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${r}(${Array.prototype.map.call(i,n=>Us._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${r} ${e} = ${s};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const s6e=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,n6e=`precision highp float;
precision highp sampler2D;`;let Ze=class extends qi{constructor(e,r){super(e,"sampler2D",gr.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};const BE=Te(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),Y4=3,X4=Te(Y4*parseFloat(65e-8.toFixed(6)),Y4*parseFloat(1881e-9.toFixed(6)),Y4*parseFloat(85e-9.toFixed(6))),o6e=3996e-9,a6e=Te(parseFloat(Number(BE[0]+X4[0]).toFixed(6)),parseFloat(Number(BE[1]+X4[1]).toFixed(6)),parseFloat(Number(BE[2]+X4[2]).toFixed(6)));function l6e(t){const e=new dr;e.attributes.add(R.POSITION,"vec2"),e.include(Rp,{textureCoordinateType:xs.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add(new Li("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Li("inverseViewMatrix",(s,n)=>T2(c6e,n.camera.viewMatrix))),r.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new Pt("backgroundColor",s=>s.backgroundColor),new Ir("radii",s=>s.radii),new Pt("cameraPosition",(s,n)=>n.camera.eye),new nr("heightParameters",s=>s.heightParameters),new Ee("innerFadeDistance",s=>s.innerFadeDistance),new Ee("altitudeFade",s=>s.altitudeFade),new Ze("depthTexture",s=>s.depthTexture),new Ee("hazeStrength",s=>s.hazeStrength)),i.constants.add("betaRayleigh","vec3",BE),i.constants.add("betaCombined","vec3",a6e),i.constants.add("betaMie","float",o6e),i.constants.add("scaleHeight","float",YFe*s0),Lm(i),e.include(XD),t.haze&&(i.include(Nu),i.uniforms.add(new Ir("nearFar",(s,n)=>n.camera.nearFar))),i.code.add(b`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(b`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(b`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(b`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?b`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":b`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":b`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?b`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:b`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":b`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?b`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?b`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?b`cameraSpaceRay *= -textureBilinear(vuv0);`:b`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:b`${t.reduced?"":b`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?b`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:b`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":b`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const c6e=ge(),u6e=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:BE,build:l6e},Symbol.toStringTag,{value:"Module"}));let _r=class{constructor(e,r){this._module=e,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var ii,Qt,ve,zp,yt,Vh,Qx,Xe,Ar,Di,Dt,Ft,Ji,ut,Ve,en,Cn,yr,cc,oo;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(ii||(ii={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Qt||(Qt={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(ve||(ve={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(zp||(zp={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(yt||(yt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Vh||(Vh={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(Qx||(Qx={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(Xe||(Xe={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Ar||(Ar={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(Di||(Di={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Dt||(Dt={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Ft||(Ft={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(Ji||(Ji={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(ut||(ut={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(Ve||(Ve={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(en||(en={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Cn||(Cn={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(yr||(yr={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(cc||(cc={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(oo||(oo={}));const Z4=33984;var bs,ka,sk;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.UNCOUNTED=8]="UNCOUNTED",t[t.LinesOfCode=8]="LinesOfCode",t[t.Uniform=9]="Uniform",t[t.COUNT=10]="COUNT"})(bs||(bs={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(ka||(ka={})),function(t){t[t.NONE=0]="NONE",t[t.BACK=1029]="BACK"}(sk||(sk={}));const $X=33306;var ns,IX,LX,DX,fI,nk,NX;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(ns||(ns={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(IX||(IX={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(LX||(LX={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(DX||(DX={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(fI||(fI={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(nk||(nk={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(NX||(NX={}));let Sr=class{constructor(e,r,i){this.release=i,this.initializeConfiguration(e,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=Ke(this._program),this._pipeline=this._configuration=null}reload(e){Ke(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return Qt.TRIANGLES}getPipeline(e,r,i){return this._pipeline}initializeConfiguration(e,r){}};const hr=new Map([[R.POSITION,0],[R.NORMAL,1],[R.NORMALCOMPRESSED,1],[R.UV0,2],[R.COLOR,3],[R.COLORFEATUREATTRIBUTE,3],[R.SIZE,4],[R.TANGENT,4],[R.AUXPOS1,5],[R.SYMBOLCOLOR,5],[R.AUXPOS2,6],[R.FEATUREATTRIBUTE,6],[R.INSTANCEFEATUREATTRIBUTE,6],[R.INSTANCECOLOR,7],[R.OBJECTANDLAYERIDCOLOR,7],[R.INSTANCEOBJECTANDLAYERIDCOLOR,7],[R.INSTANCEMODEL,8],[R.INSTANCEMODELNORMAL,12],[R.INSTANCEMODELORIGINHI,11],[R.INSTANCEMODELORIGINLO,15]]),h6e=ne.getLogger("esri.views.webgl.checkWebGLError");function d6e(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const Bpe=!!te("enable-feature:webgl-debug");function Ah(){return Bpe}function ok(){return Bpe}function fp(t){if(Ah()){const e=t.getError();if(e){const r=d6e(t,e),i=new Error().stack;h6e.error(new X("webgl-error","WebGL error occurred",{message:r,stack:i}))}}}let vr=class{constructor(e,r,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new It({deallocator:null}),this._glProgram=e.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBindPass(this),this.bindDraw=r.generateBindDraw(this),this._fragmentUniforms=Ah()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,r){this._glProgram.setUniform1i(e,r?1:0)}setUniform1i(e,r){this._glProgram.setUniform1i(e,r)}setUniform1f(e,r){this._glProgram.setUniform1f(e,r)}setUniform2fv(e,r){this._glProgram.setUniform2fv(e,r)}setUniform3fv(e,r){this._glProgram.setUniform3fv(e,r)}setUniform4fv(e,r){this._glProgram.setUniform4fv(e,r)}setUniformMatrix3fv(e,r){this._glProgram.setUniformMatrix3fv(e,r)}setUniformMatrix4fv(e,r){this._glProgram.setUniformMatrix4fv(e,r)}setUniform1fv(e,r){this._glProgram.setUniform1fv(e,r)}setUniform1iv(e,r){this._glProgram.setUniform1iv(e,r)}setUniform2iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform3iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform4iv(e,r){this._glProgram.setUniform4iv(e,r)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,r){if((r==null?void 0:r.glName)==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let i=this._textures.get(e);return i==null?(i=this._allocTextureUnit(r),this._textures.set(e,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,r)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(r,e.unit)}),this._fragmentUniforms!=null&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var oi,ov,cs,Z0,Wa,Tm,Ur,Al,sm;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(oi||(oi={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(ov||(ov={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(cs||(cs={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(Z0||(Z0={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Wa||(Wa={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(Tm||(Tm={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Ur||(Ur={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(Al||(Al={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(sm||(sm={}));function Dl(t,e,r=zp.ADD,i=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function Jn(t,e,r,i,s=zp.ADD,n=zp.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:r,dstAlpha:i,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const _G={face:Vh.BACK,mode:Qx.CCW},zpe={face:Vh.FRONT,mode:Qx.CCW},ZD=t=>t===oi.Back?_G:t===oi.Front?zpe:null,Xa={zNear:0,zFar:1},Ut={r:!0,g:!0,b:!0,a:!0};function p6e(t){return x6e.intern(t)}function f6e(t){return T6e.intern(t)}function m6e(t){return S6e.intern(t)}function g6e(t){return E6e.intern(t)}function y6e(t){return C6e.intern(t)}function _6e(t){return A6e.intern(t)}function v6e(t){return R6e.intern(t)}function b6e(t){return O6e.intern(t)}function w6e(t){return P6e.intern(t)}function Et(t){return M6e.intern(t)}let Qp=class{constructor(e,r){this._makeKey=e,this._makeRef=r,this._interns=new Map}intern(e){if(!e)return null;const r=this._makeKey(e),i=this._interns;return i.has(r)||i.set(r,this._makeRef(e)),i.get(r)??null}};function Kp(t){return"["+t.join(",")+"]"}const x6e=new Qp(Vpe,t=>({__tag:"Blending",...t}));function Vpe(t){return t?Kp([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const T6e=new Qp(Gpe,t=>({__tag:"Culling",...t}));function Gpe(t){return t?Kp([t.face,t.mode]):null}const S6e=new Qp(jpe,t=>({__tag:"PolygonOffset",...t}));function jpe(t){return t?Kp([t.factor,t.units]):null}const E6e=new Qp(Hpe,t=>({__tag:"DepthTest",...t}));function Hpe(t){return t?Kp([t.func]):null}const C6e=new Qp(qpe,t=>({__tag:"StencilTest",...t}));function qpe(t){return t?Kp([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const A6e=new Qp(Wpe,t=>({__tag:"DepthWrite",...t}));function Wpe(t){return t?Kp([t.zNear,t.zFar]):null}const R6e=new Qp(Ype,t=>({__tag:"ColorWrite",...t}));function Ype(t){return t?Kp([t.r,t.g,t.b,t.a]):null}const O6e=new Qp(Xpe,t=>({__tag:"StencilWrite",...t}));function Xpe(t){return t?Kp([t.mask]):null}const P6e=new Qp(Zpe,t=>({__tag:"DrawBuffers",...t}));function Zpe(t){return t?Kp(t.buffers):null}const M6e=new Qp($6e,t=>({blending:p6e(t.blending),culling:f6e(t.culling),polygonOffset:m6e(t.polygonOffset),depthTest:g6e(t.depthTest),stencilTest:y6e(t.stencilTest),depthWrite:_6e(t.depthWrite),colorWrite:v6e(t.colorWrite),stencilWrite:b6e(t.stencilWrite),drawBuffers:w6e(t.drawBuffers)}));function $6e(t){return t?Kp([Vpe(t.blending),Gpe(t.culling),jpe(t.polygonOffset),Hpe(t.depthTest),qpe(t.stencilTest),Wpe(t.depthWrite),Ype(t.colorWrite),Xpe(t.stencilWrite),Zpe(t.drawBuffers)]):null}let I6e=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,r,i,s){return(i||e!==r)&&(s(e),this._pipelineInvalid=!0),e}},L6e=class extends Vr{constructor(){super(...arguments),this.heightParameters=Jt(),this.radii=ke(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=ke(),this.backgroundColor=E()}},US=class Jpe extends Sr{initializeProgram(e){return new vr(e.rctx,Jpe.shader.get().build(this.configuration),hr)}initializePipeline(){return this.configuration.reduced?Et({blending:Dl(ve.ONE,ve.ZERO),depthTest:{func:Ar.ALWAYS},colorWrite:Ut}):this.configuration.haze?Et({blending:Jn(ve.ONE,ve.ZERO,ve.ONE_MINUS_SRC_COLOR,ve.ONE),colorWrite:Ut}):Et({blending:Dl(ve.SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ar.LEQUAL},colorWrite:Ut})}};US.shader=new _r(u6e,()=>he(()=>import("./ChapmanAtmosphere.glsl-bd740324.js"),[],import.meta.url));let Za=class extends Vr{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,r={key:this.key};for(const i of e)r[i]=this[i];return r}};function F(t={}){return(e,r)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(r),t.constValue!=null)Object.defineProperty(e,r,{get:()=>t.constValue});else{const i=e._parameterNames.length-1,s=t.count||2,n=Math.ceil(Math.log2(s)),o=e._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(e,r,{get(){return this[i]},set(u){if(this[i]!==u&&(this[i]=u,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+u<<l&c,typeof u!="number"&&typeof u!="boolean"))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof u)}})}}}let mI=class extends Za{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}};h([F()],mI.prototype,"haze",void 0),h([F()],mI.prototype,"reduced",void 0);const zE=-3;var Rh;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(Rh||(Rh={}));let D6e=class{constructor(e,r,i){this.name=e,this._storage=r,this.id=N6e+++":",this.size=0,this.maxSize=0,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get sizeAll(){return this._storage.size}resetHitRate(){this._hit=this._miss=0}put(e,r,i,s=0){this._storage.put(this,e,r,i,s)}get(e){const r=this._storage.get(this,e);return r===void 0?++this._miss:++this._hit,r}peek(e){return this._storage.peek(this,e)}pop(e){const r=this._storage.pop(this,e);return r===void 0?++this._miss:++this._hit,r}updateSize(e,r,i){this._storage.updateSize(this,e,r,i)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},Qpe=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new It,this._users=new It}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,r){this._removeFuncs.push([e,r])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(r=>r[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimits()}put(e,r,i,s,n){r=e.id+r;const o=this._db.get(r);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(r),o.entry!==i&&this._notifyRemove(r,o.entry,Rh.ALL)),s>this._maxSize)return void this._notifyRemove(r,i,Rh.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return console.warn(`Refusing to cache entry with size ${s} for key ${r}`),void this._notifyRemove(r,i,Rh.ALL);const a=1+Math.max(n,zE)-zE;this._db.set(r,{entry:i,size:s,lifetime:a,lives:a}),this._size+=s,e.size+=s,this._checkSizeLimits()}updateSize(e,r,i,s){r=e.id+r;const n=this._db.get(r);if(n&&n.entry===i){for(this._size-=n.size,e.size-=n.size;s>this._maxSize;){const o=this._notifyRemove(r,i,Rh.SOME);if(!(o!=null&&o>0))return void this._db.delete(r);s=o}n.size=s,this._size+=s,e.size+=s,this._checkSizeLimits()}}pop(e,r){r=e.id+r;const i=this._db.get(r);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(r),++this._hit,i.entry;++this._miss}get(e,r){r=e.id+r;const i=this._db.get(r);if(i!==void 0)return this._db.delete(r),i.lives=i.lifetime,this._db.set(r,i),++this._hit,i.entry;++this._miss}peek(e,r){const i=this._db.get(e.id+r);return i?++this._hit:++this._miss,i==null?void 0:i.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const{id:u,name:d}=c;if(a.startsWith(u)){const p=r[d]||0;r[d]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(r);n.sort((o,a)=>r[a]-r[o]),n.forEach(o=>e[o]=Math.round(r[o]/2**20)+"MB / "+s[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(e["Priority "+(o+zE-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const r=e.id;this._db.forEach((i,s)=>{s.startsWith(r)&&(this._size-=i.size,this._db.delete(s),this._notifyRemove(s,i.entry,Rh.ALL))}),e.size=0}clearAll(){this._db.forEach((e,r)=>this._notifyRemove(r,e.entry,Rh.ALL)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,r,i){let s;return this._removeFuncs.some(n=>{if(e.startsWith(n[0])){const o=n[1](r,i);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimits(){if(this._size>this._maxSize){for(const[e,r]of this._db)if(this._purgeItem(e,r),this._size<=.9*this.maxSize)return}this._users.forEach(e=>{if(e.maxSize>0&&e.size>e.maxSize){for(const[r,i]of this._db)if(r.startsWith(e.id)&&(this._purgeItem(r,i,e),e.size<=.9*e.maxSize))return}})}_purgeItem(e,r,i=this._users.find(s=>e.startsWith(s.id))){if(this._db.delete(e),r.lives<=1){this._size-=r.size,i&&(i.size-=r.size);const s=this._notifyRemove(e,r.entry,Rh.SOME);s!=null&&s>0&&(this._size+=s,i&&(i.size+=s),r.lives=r.lifetime,r.size=s,this._db.set(e,r))}else--r.lives,this._db.set(e,r)}},N6e=0,H3=class{constructor(e,r){this._cache=e(r,(i,s)=>this._remove(i,s))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}pop(e){const r=this._cache.peek(e);if(!r)return;const i=r.pop();if(r.length>0){const s=r.reduce((n,o)=>n+o.usedMemory,0);this._cache.updateSize(e,r,s)}else this._cache.pop(e);return i}put(e,r,i=zE){const s=this._cache.peek(e);if(!s)return void this._cache.put(e,[r],r.usedMemory,i);s.push(r);const n=s.reduce((o,a)=>o+a.usedMemory,0);this._cache.updateSize(e,s,n)}_remove(e,r){var i;switch(r){case Rh.ALL:return e.forEach(s=>s.dispose()),0;case Rh.SOME:return(i=e.shift())==null||i.dispose(),e.reduce((s,n)=>s+n.usedMemory,0)}}},J4=class{constructor(e,r){this._last=new It,this._incarnation=0,this._cache=new H3(e,r)}destroy(){var e;(e=this._last)==null||e.forAll(r=>r.dispose()),this._last=null,this._cache.destroy()}set interactive(e){var r;e&&!this._last?this._last=new It:e||((r=this._last)==null||r.forAll(i=>i.dispose()),this._last=null)}clean(){var e;(e=this._last)==null||e.filterInPlace(r=>!(r.incarnation<this._incarnation)||(this._cache.put(r.key,r),!1))}frame(){++this._incarnation}pop(e){if(this._last){const r=this._last.find(i=>i.key===e);if(r)return this._last.removeUnordered(r),r}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){var e;return((e=this._last)==null?void 0:e.reduce((r,i)=>r+i.usedMemory,0))??0}};var rr;function ak(t,e,r={}){const i=e===rr.WEBGL1?"webgl":"webgl2";return t.getContext(i,r)||null}function F6e(t,e,r={}){const i=Kpe(t);for(const s of i){const n=ak(e,s,r);if(n)return n}return null}function Kpe(t){if(t==="3d")return[rr.WEBGL2];const e=te("esri-force-webgl");return e===rr.WEBGL1||e===rr.WEBGL2?[e]:te("mac")&&te("chrome")?[rr.WEBGL1,rr.WEBGL2]:[rr.WEBGL2,rr.WEBGL1]}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(rr||(rr={}));const Td=ne.getLogger("esri.views.webgl.BufferObject");let Cr=class hw{static createIndex(e,r,i){return new hw(e,yt.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(e,r,i){return new hw(e,yt.ARRAY_BUFFER,r,i)}static createUniform(e,r,i){if(e.type!==rr.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new hw(e,yt.UNIFORM_BUFFER,r,i)}static createPixelPack(e,r=yr.STREAM_READ,i){if(e.type!==rr.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new hw(e,yt.PIXEL_PACK_BUFFER,r);return i&&s.setSize(i),s}static createPixelUnpack(e,r=yr.STREAM_DRAW,i){if(e.type!==rr.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new hw(e,yt.PIXEL_UNPACK_BUFFER,r,i)}constructor(e,r,i,s){this._context=e,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(bs.BufferObject,this),this._glName=this._context.gl.createBuffer(),fp(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteLength(){return this.bufferType===yt.ELEMENT_ARRAY_BUFFER?this._indexType===Xe.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===yt.ELEMENT_ARRAY_BUFFER||this.bufferType===yt.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(bs.BufferObject,this),this._context=null):this._glName&&Td.warn("Leaked WebGL buffer object")}setSize(e,r=null){if(e<=0&&Td.error("Buffer size needs to be positive!"),this.bufferType===yt.ELEMENT_ARRAY_BUFFER&&r!=null)switch(this._indexType=r,r){case Xe.UNSIGNED_SHORT:e*=2;break;case Xe.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let r=e.byteLength;this.bufferType===yt.ELEMENT_ARRAY_BUFFER&&(ML(e)&&(r/=2,this._indexType=Xe.UNSIGNED_SHORT),$L(e)&&(r/=4,this._indexType=Xe.UNSIGNED_INT)),this._setBufferData(r,e)}_setBufferData(e,r=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;r!=null?s.bufferData(this.bufferType,r,this.usage):s.bufferData(this.bufferType,e,this.usage),fp(s),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,r,i,s){if(!e)return;(r<0||r*e.BYTES_PER_ELEMENT>=this.byteLength)&&Td.error("offset is out of range!"),i>=s&&Td.error("end must be bigger than start!"),(r+(s-i))*e.BYTES_PER_ELEMENT>this.byteLength&&Td.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===rr.WEBGL2)o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,e,i,s-i);else{const a=i===0&&s===e.length?e:e.subarray(i,s);o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,a)}fp(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,r=0,i,s){if(this._context.type!==rr.WEBGL2)return void Td.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||s<0)return void Td.error("Problem getting subdata: offset and length were less than zero!");const n=U6e(e)?e.BYTES_PER_ELEMENT:1;if(n*((i??0)+(s??0))>e.byteLength)return void Td.error("Problem getting subdata: offset and length exceeded destination size!");r+n*(s??0)>this.byteLength&&Td.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,yt.COPY_READ_BUFFER),o.getBufferSubData(yt.COPY_READ_BUFFER,r,e,i,s),this._context.unbindBuffer(yt.COPY_READ_BUFFER)}async getSubDataAsync(e,r=0,i,s){this._context.type===rr.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,r,i,s)):Td.error("Get buffer subdata is supported in WebGL2 only!")}};function U6e(t){return zxe(t)}var J0;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(J0||(J0={}));function k6e(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function nm(t,e){return t.vertexBuffers[e].byteLength/B6e(t.layout[e])}function B6e(t){return t[0].stride}function vG(t,e,r,i,s=0){var o,a,l;const n=t.gl;t.bindBuffer(r);for(const c of i){const u=e.get(c.name);u===void 0&&console.error(`There is no location for vertex attribute '${c.name}' defined.`);const d=s*c.stride;if(c.count<=4)n.vertexAttribPointer(u,c.count,c.type,c.normalized,c.stride,c.offset+d),n.enableVertexAttribArray(u),c.divisor>0&&((o=t.gl2)==null||o.vertexAttribDivisor(u,c.divisor));else if(c.count===9)for(let p=0;p<3;p++)n.vertexAttribPointer(u+p,3,c.type,c.normalized,c.stride,c.offset+12*p+d),n.enableVertexAttribArray(u+p),c.divisor>0&&((a=t.gl2)==null||a.vertexAttribDivisor(u+p,c.divisor));else if(c.count===16)for(let p=0;p<4;p++)n.vertexAttribPointer(u+p,4,c.type,c.normalized,c.stride,c.offset+16*p+d),n.enableVertexAttribArray(u+p),c.divisor>0&&((l=t.gl2)==null||l.vertexAttribDivisor(u+p,c.divisor));else console.error("Unsupported vertex attribute element count: "+c.count)}}function bG(t,e,r,i){var n,o,a;const s=t.gl;t.bindBuffer(r);for(const l of i){const c=e.get(l.name);if(l.count<=4)s.disableVertexAttribArray(c),l.divisor&&l.divisor>0&&((n=t.gl2)==null||n.vertexAttribDivisor(c,0));else if(l.count===9)for(let u=0;u<3;u++)s.disableVertexAttribArray(c+u),l.divisor&&l.divisor>0&&((o=t.gl2)==null||o.vertexAttribDivisor(c+u,0));else if(l.count===16)for(let u=0;u<4;u++)s.disableVertexAttribArray(c+u),l.divisor&&l.divisor>0&&((a=t.gl2)==null||a.vertexAttribDivisor(c+u,0));else console.error("Unsupported vertex attribute element count: "+l.count)}t.unbindBuffer(yt.ARRAY_BUFFER)}function wG(t){switch(t){case ut.ALPHA:case ut.LUMINANCE:case ut.RED:case ut.RED_INTEGER:case Ve.R8:case Ve.R8I:case Ve.R8UI:case Ve.R8_SNORM:case Cn.STENCIL_INDEX8:return 1;case ut.LUMINANCE_ALPHA:case ut.RG:case ut.RG_INTEGER:case Ve.RGBA4:case Ve.R16F:case Ve.R16I:case Ve.R16UI:case Ve.RG8:case Ve.RG8I:case Ve.RG8UI:case Ve.RG8_SNORM:case Ve.RGB565:case Ve.RGB5_A1:case Cn.DEPTH_COMPONENT16:return 2;case ut.DEPTH_COMPONENT:case ut.RGB:case ut.RGB_INTEGER:case Ve.RGB8:case Ve.RGB8I:case Ve.RGB8UI:case Ve.RGB8_SNORM:case Ve.SRGB8:case Cn.DEPTH_COMPONENT24:return 3;case ut.DEPTH_STENCIL:case ut.DEPTH24_STENCIL8:case ut.RGBA:case ut.RGBA_INTEGER:case Ve.RGBA8:case Ve.R32F:case Ve.R11F_G11F_B10F:case Ve.RG16F:case Ve.R32I:case Ve.R32UI:case Ve.RG16I:case Ve.RG16UI:case Ve.RGBA8I:case Ve.RGBA8UI:case Ve.RGBA8_SNORM:case Ve.SRGB8_ALPHA8:case Ve.RGB9_E5:case Ve.RGB10_A2UI:case Ve.RGB10_A2:case Cn.DEPTH_STENCIL:case Cn.DEPTH_COMPONENT32F:case Cn.DEPTH24_STENCIL8:return 4;case Cn.DEPTH32F_STENCIL8:return 5;case Ve.RGB16F:case Ve.RGB16I:case Ve.RGB16UI:return 6;case Ve.RG32F:case Ve.RG32I:case Ve.RG32UI:case Ve.RGBA16F:case Ve.RGBA16I:case Ve.RGBA16UI:return 8;case Ve.RGB32F:case Ve.RGB32I:case Ve.RGB32UI:return 12;case Ve.RGBA32F:case Ve.RGBA32I:case Ve.RGBA32UI:return 16;case ns.COMPRESSED_RGB_S3TC_DXT1_EXT:case ns.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case ns.COMPRESSED_RGBA_S3TC_DXT3_EXT:case ns.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case ns.COMPRESSED_R11_EAC:case ns.COMPRESSED_SIGNED_R11_EAC:case ns.COMPRESSED_RGB8_ETC2:case ns.COMPRESSED_SRGB8_ETC2:case ns.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case ns.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case ns.COMPRESSED_RG11_EAC:case ns.COMPRESSED_SIGNED_RG11_EAC:case ns.COMPRESSED_RGBA8_ETC2_EAC:case ns.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}let uM=class{constructor(e,r,i=r){this.internalFormat=e,this.width=r,this.height=i,this.multisampled=!1,this.samples=1}};function z6e(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*wG(t.internalFormat)}let efe=class{constructor(e,r){this._context=e,this._descriptor=r,this.type=J0.RenderBuffer,this._context.instanceCounter.increment(bs.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=r;if(a){if(this._context.type!==rr.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,s,n)}else i.renderbufferStorage(i.RENDERBUFFER,o,s,n)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,r=this._context.parameters.maxSamples;return e?Math.min(e,r):r}get gpuMemoryUsage(){return z6e(this._descriptor)}resize(e,r){const i=this._descriptor;if(i.width===e&&i.height===r)return;i.width=e,i.height=r;const s=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):s.renderbufferStorage(s.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(bs.Renderbuffer,this),this._context=null)}},Or=class{constructor(e=0,r=e){this.width=e,this.height=r,this.target=Ji.TEXTURE_2D,this.pixelFormat=ut.RGBA,this.dataType=en.UNSIGNED_BYTE,this.samplingMode=Dt.LINEAR,this.wrapMode=Ft.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function V6e(t){return t.width<=0||t.height<=0?0:t.width*t.height*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:wG(t.internalFormat))}let G6e=class tfe extends Or{constructor(e,r){switch(super(),this.context=e,Object.assign(this,r),this.internalFormat){case Ve.R16F:case Ve.R16I:case Ve.R16UI:case Ve.R32F:case Ve.R32I:case Ve.R32UI:case Ve.R8_SNORM:case Ve.R8:case Ve.R8I:case Ve.R8UI:this.pixelFormat=ut.RED}}static validate(e,r){return new tfe(e,r)}};const FX=4;let Rt=class{constructor(e,r=null,i=null){if(this.type=J0.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=r;else{const s=G6e.validate(e,r);if(!s)throw new X("Texture descriptor invalid");this._descriptor=s}if(this._descriptor.context.type!==rr.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),D_(this._descriptor.target)))throw new X("3D and array textures are not supported in WebGL1");this._descriptor.target===Ji.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get gpuMemoryUsage(){return Y6e.delete(this),V6e(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(bs.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new X("Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===Ji.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let r=Ji.TEXTURE_CUBE_MAP_POSITIVE_X;r<=Ji.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(e,r)}setData(e){this._setData(e)}_setData(e,r){var c;if(!((c=this._descriptor.context)!=null&&c.gl))return;const i=this._descriptor.context.gl;fp(i),this._glName||(this._glName=i.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(bs.Texture,this)),e===void 0&&(e=null);const s=this._descriptor,n=r??s.target,o=D_(n);e===null&&(s.width=s.width||FX,s.height=s.height||FX,o&&(s.depth=s.depth??1));const a=this._descriptor.context.bindTexture(this,Rt.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Rt.TEXTURE_UNIT_FOR_UPDATES),Q4(this._descriptor.context,s),this._configurePixelStorage(),fp(i);const l=this._deriveInternalFormat();if(K4(e)){let u="width"in e?e.width:e.codedWidth,d="height"in e?e.height:e.codedHeight;const p=1;e instanceof HTMLVideoElement&&(u=e.videoWidth,d=e.videoHeight),s.width&&s.height,o&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,u,d,p),this._texImage(n,0,l,u,d,p,e),fp(i),s.hasMipmap&&this.generateMipmap(),s.width||(s.width=u),s.height||(s.height=d),o&&!s.depth&&(s.depth=p)}else{const{width:u,height:d,depth:p}=s;if(u==null||d==null)throw new X("Width and height must be specified!");if(o&&p==null)throw new X("Depth must be specified!");if(s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,u,d,p),hM(e)){const g=e.levels,y=BX(n,u,d,p),_=Math.min(y-1,g.length-1);this._descriptor.context.gl2!=null?i.texParameteri(s.target,this._descriptor.context.gl2.TEXTURE_MAX_LEVEL,_):s.hasMipmap=s.hasMipmap&&y===g.length;const v=l;if(!q6e(v))throw new X("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((w,x,T,S)=>{const C=g[Math.min(w,g.length-1)];this._compressedTexImage(n,w,v,x,T,S,C)},_)}else this._texImage(n,0,l,u,d,p,e),fp(i),s.hasMipmap&&this.generateMipmap()}UX(i,this._descriptor),kX(i,this._descriptor),j6e(this._descriptor.context,this._descriptor),fp(i),this._descriptor.context.bindTexture(a,Rt.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,r,i,s,n,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor.context.gl,c=this._descriptor.context.gl2,u=this._descriptor,d=this._deriveInternalFormat(),{pixelFormat:p,dataType:g,target:y,isImmutable:_}=u;if(_&&!this._wasImmutablyAllocated)throw new X("Cannot update immutable texture before allocation!");const v=this._descriptor.context.bindTexture(this,Rt.TEXTURE_UNIT_FOR_UPDATES,!0);if((r<0||i<0||s>u.width||n>u.height||r+s>u.width||i+n>u.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,a)}if(K4(o)?c?c.texSubImage2D(y,e,r,i,s,n,p,g,o):l.texSubImage2D(y,e,r,i,p,g,o):hM(o)?l.compressedTexSubImage2D(y,e,r,i,s,n,d,o.levels[e]):l.texSubImage2D(y,e,r,i,s,n,p,g,o),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,0)}this._descriptor.context.bindTexture(v,Rt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,r,i,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor.context.gl2;if(c==null)throw new X("3D textures are not supported in WebGL1");const u=this._descriptor,d=this._deriveInternalFormat(),{pixelFormat:p,dataType:g,isImmutable:y,target:_}=u;if(y&&!this._wasImmutablyAllocated)throw new X("Cannot update immutable texture before allocation!");D_(_)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=this._descriptor.context.bindTexture(this,Rt.TEXTURE_UNIT_FOR_UPDATES);if(this._descriptor.context.setActiveTexture(Rt.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||s<0||n>u.width||o>u.height||a>u.depth||r+n>u.width||i+o>u.height||s+a>u.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),hM(l))l=l.levels[e],c.compressedTexSubImage3D(_,e,r,i,s,n,o,a,d,l);else{const w=l;c.texSubImage3D(_,e,r,i,s,n,o,a,p,g,w)}this._descriptor.context.bindTexture(v,Rt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new X("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,Q4(this._descriptor.context,e)}e.samplingMode===Dt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=Dt.LINEAR_MIPMAP_NEAREST):e.samplingMode===Dt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=Dt.NEAREST_MIPMAP_NEAREST);const r=this._descriptor.context.bindTexture(this,Rt.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Rt.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(r,Rt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,Q4(this._descriptor.context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor.context.gl,r=this._descriptor;this._samplingModeDirty&&(UX(e,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(kX(e,r),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.context.type===rr.WEBGL1)return this._descriptor.internalFormat=this._descriptor.pixelFormat;if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===ut.DEPTH_STENCIL&&(this._descriptor.internalFormat=ut.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case en.FLOAT:switch(this._descriptor.pixelFormat){case ut.RGBA:return this._descriptor.internalFormat=Ve.RGBA32F;case ut.RGB:return this._descriptor.internalFormat=Ve.RGB32F;default:throw new X("Unable to derive format")}case en.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case ut.RGBA:return this._descriptor.internalFormat=Ve.RGBA8;case ut.RGB:return this._descriptor.internalFormat=Ve.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===ut.DEPTH_STENCIL?ut.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(e,r,i,s,n,o){const a=this._descriptor.context.gl2;if(a==null)throw new X("Immutable textures are not supported in WebGL1");if(!H6e(r))throw new X("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?BX(e,s,n,o):1;if(D_(e)){if(o==null)throw new X("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,r,s,n,o)}else a.texStorage2D(e,l,r,s,n);this._wasImmutablyAllocated=!0}_texImage(e,r,i,s,n,o,a){const l=this._descriptor.context.gl,c=D_(e),{isImmutable:u,pixelFormat:d,dataType:p}=this._descriptor,g=this._descriptor.context.type===rr.WEBGL2,y=g?l:null;if(g||!K4(a))if(u){if(a!=null){const _=a;if(c){if(o==null)throw new X("Missing depth dimension for 3D texture upload");y.texSubImage3D(e,r,0,0,0,s,n,o,d,p,_)}else l.texSubImage2D(e,r,0,0,s,n,d,p,_)}}else{const _=a;if(c){if(o==null)throw new X("Missing depth dimension for 3D texture upload");y.texImage3D(e,r,i,s,n,o,0,d,p,_)}else l.texImage2D(e,r,i,s,n,0,d,p,_)}else l.texImage2D(e,0,i,d,p,a)}_compressedTexImage(e,r,i,s,n,o,a){const l=this._descriptor.context.gl;let c=null;const u=D_(e),d=this._descriptor.isImmutable;if(u){if(this._descriptor.context.type!==rr.WEBGL2)throw new X("3D textures are not supported in WebGL1");c=l}if(d){if(a!=null)if(u){if(o==null)throw new X("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,r,0,0,0,s,n,o,i,a)}else l.compressedTexSubImage2D(e,r,0,0,s,n,i,a)}else if(u){if(o==null)throw new X("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,r,i,s,n,o,0,a)}else l.compressedTexImage2D(e,r,i,s,n,0,a)}_forEachMipmapLevel(e,r=1/0){let{width:i,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===Ji.TEXTURE_3D;if(i==null||s==null||l&&n==null)throw new X("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,i,s,n),o&&(i!==1||s!==1||l&&n!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}};function Q4(t,e){(e.width!=null&&e.width<0||e.height!=null&&e.height<0||e.depth!=null&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=t.type===rr.WEBGL2;r||!e.isImmutable&&!D_(e.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),!r&&(e.width!=null&&J1(e.width)&&e.height!=null&&J1(e.height)||(typeof e.wrapMode=="number"?e.wrapMode!==Ft.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):e.wrapMode.s===Ft.CLAMP_TO_EDGE&&e.wrapMode.t===Ft.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!")))}function UX(t,e){let r=e.samplingMode,i=e.samplingMode;r===Dt.LINEAR_MIPMAP_NEAREST||r===Dt.LINEAR_MIPMAP_LINEAR?(r=Dt.LINEAR,e.hasMipmap||(i=Dt.LINEAR)):r!==Dt.NEAREST_MIPMAP_NEAREST&&r!==Dt.NEAREST_MIPMAP_LINEAR||(r=Dt.NEAREST,e.hasMipmap||(i=Dt.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}function kX(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function j6e(t,e){const r=t.capabilities.textureFilterAnisotropic;r&&t.gl.texParameterf(e.target,r.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function H6e(t){return t in Ve}function q6e(t){return t in ns}function hM(t){return t!=null&&"type"in t&&t.type==="compressed"}function W6e(t){return t!=null&&"byteLength"in t}function K4(t){return t!=null&&!hM(t)&&!W6e(t)}function D_(t){return t===Ji.TEXTURE_3D||t===Ji.TEXTURE_2D_ARRAY}function BX(t,e,r,i=1){let s=Math.max(e,r);return t===Ji.TEXTURE_3D&&(s=Math.max(s,i)),Math.round(Math.log(s)/Math.LN2)+1}Rt.TEXTURE_UNIT_FOR_UPDATES=0;const Y6e=new Map,X6e=ne.getLogger("esri.views.webgl.FramebufferObject");let dd=class dw{constructor(e,r,i=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(bs.FramebufferObject,this);const s=dM(r)?r:new Rt(this._context,r);if(this._colorAttachments.set(ka.COLOR_ATTACHMENT0,s),this._validateTextureDescriptor(s.descriptor),this._validateColorAttachmentPoint(ka.COLOR_ATTACHMENT0),i!=null)if(J6e(i))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=dM(i)?i:new Rt(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const n=Z6e(i)?i:new efe(this._context,i);this._depthStencilBuffer=n,this._validateRenderBufferDescriptor(n.descriptor)}}dispose(){var r,i;if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((s,n)=>{var o;return(o=this.detachColorTexture(n))==null?void 0:o.dispose()}),(r=this.detachDepthStencilBuffer())==null||r.dispose(),(i=this.detachDepthStencilTexture())==null||i.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(bs.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(ka.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){var r;const e=this._colorAttachments.get(ka.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.width)??0}get height(){var r;const e=this._colorAttachments.get(ka.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.height)??0}get gpuMemoryUsage(){var e;return[...this._colorAttachments].reduce((r,[i,s])=>r+s.gpuMemoryUsage,((e=this.depthStencil)==null?void 0:e.gpuMemoryUsage)??0)}getColorTexture(e){const r=this._colorAttachments.get(e);return r&&dM(r)?r:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,r=ka.COLOR_ATTACHMENT0){var s;if(!e)return;this._validateColorAttachmentPoint(r);const i=e.descriptor;this._validateTextureDescriptor(i),(s=this.detachColorTexture(r))==null||s.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,r)),this._colorAttachments.set(r,e)}detachColorTexture(e=ka.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(e);if(r){if(this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e),this._context.bindFramebuffer(i)}return this._colorAttachments.delete(e),r}}setColorTextureTarget(e,r=ka.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);i&&this._framebufferTexture2D(i.glName,r,e)}attachDepthStencil(e){if(e)switch(e.type){case J0.Texture:return this._attachDepthStencilTexture(e);case J0.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){var i;if(e==null)return;const r=e.descriptor;r.pixelFormat!==ut.DEPTH_STENCIL&&r.pixelFormat!==ut.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==en.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,$X)),(i=this._depthStencilTexture)==null||i.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,$X)),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const r=e.descriptor;if(this._validateRenderBufferDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,s=this._getGLAttachmentPoint(r);i.framebufferRenderbuffer(oo.FRAMEBUFFER,s,i.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,i=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(oo.FRAMEBUFFER,i,r.RENDERBUFFER,null)}return this._depthStencilBuffer=null,e}copyToTexture(e,r,i,s,n,o,a){(e<0||r<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==Ji.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||e+i>this.width||r+s>this.height||n+i>l.width||o+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,u=c.bindTexture(a,Rt.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Rt.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(Ji.TEXTURE_2D,0,n,o,e,r,i,s),c.bindTexture(u,Rt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,r,i,s,n,o,a){(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,r,i,s,n,o,a)}async readPixelsAsync(e,r,i,s,n,o,a){if(this._context.type!==rr.WEBGL2)return Ah()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,r,i,s,n,o,a);const l=this._context.gl,c=Cr.createPixelPack(this._context,yr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,r,i,s,n,o,0),this._context.unbindBuffer(yt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,r){var s,n;if(this.width===e&&this.height===r)return;const i={width:e,height:r};_1(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(o=>o.resize(i.width,i.height)),(s=this._depthStencilTexture)==null||s.resize(i.width,i.height),this._initialized&&(_1(i,this._context.parameters.maxRenderbufferSize),(n=this._depthStencilBuffer)==null||n.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=oo.FRAMEBUFFER){const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(e,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=r.createFramebuffer();if(r.bindFramebuffer(e,i),this._colorAttachments.forEach((s,n)=>this._framebufferTexture2D(s.glName,n,zX(s),e)),this._depthStencilBuffer){const s=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);r.framebufferRenderbuffer(e,s,r.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,zX(this._depthStencilTexture),e);Ah()&&r.checkFramebufferStatus(e)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(e,r=ka.COLOR_ATTACHMENT0,i=Ji.TEXTURE_2D,s=oo.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,r,i,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const r=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(oo.FRAMEBUFFER,r,e.RENDERBUFFER,null)}this._depthStencilBuffer=Ke(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=Ke(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==Ji.TEXTURE_2D&&e.target!==Ji.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),_1(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){_1(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case Cn.DEPTH_COMPONENT16:case Cn.DEPTH_COMPONENT24:case Cn.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case Cn.DEPTH24_STENCIL8:case Cn.DEPTH32F_STENCIL8:case Cn.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case Cn.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(dw._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const s=this._context.gl;dw._MAX_COLOR_ATTACHMENTS=s.getParameter(i.MAX_COLOR_ATTACHMENTS)}else dw._MAX_COLOR_ATTACHMENTS=1}const r=e-ka.COLOR_ATTACHMENT0;r+1>dw._MAX_COLOR_ATTACHMENTS&&ne.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${dw._MAX_COLOR_ATTACHMENTS} color attachments`)}};function dM(t){return t!=null&&"type"in t&&t.type===J0.Texture}function Z6e(t){return t!=null&&"type"in t&&t.type===J0.RenderBuffer}function J6e(t){return dM(t)||t!=null&&"pixelFormat"in t}function _1(t,e){const r=Math.max(t.width,t.height);if(r>e){X6e.warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const i=e/r;return t.width=Math.round(t.width*i),t.height=Math.round(t.height*i),!1}return!0}function zX(t){return t.descriptor.target===Ji.TEXTURE_CUBE_MAP?Ji.TEXTURE_CUBE_MAP_POSITIVE_X:Ji.TEXTURE_2D}dd._MAX_COLOR_ATTACHMENTS=-1;let Q6e=class{constructor(e){this.rctx=e,this._acquired=new Set,this._cache=new J4(e.newCache,"FBOCache"),this._depthCache=new J4(e.newCache,"DepthAttachmentCache"),this._colorCache=new J4(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frame(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame()}get usedMemory(){return Array.from(this._acquired.values()).reduce((e,r)=>{var i;return e+("colorTexture"in r?((i=r.colorTexture)==null?void 0:i.gpuMemoryUsage)??0:r.usedMemory)},this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e}acquire(e,r,i){const s=e5(e,r,i),n=this._cache.pop(s)||new K6e(s,new dd(this.rctx,{...GX[e],width:r,height:i}),o=>(n.releaseDepth(),n.depth=this._acquireDepth(o,n.fbo.width,n.fbo.height),n.fbo.attachDepthStencil(n.depth.attachment),n),(o,a)=>{const l=this._acquireColor(o,r,i);return n.colors??(n.colors=new Map),n.colors.set(a,l),n.fbo.attachColorTexture(l.attachment,a),n});return n.release=()=>{this._acquired.delete(n),n.releaseDepth(),this._cache.put(n),n.release=()=>console.log(`Double FBO release in ${new Error().stack}`)},this.rctx.unbindTexture(n.fbo.colorTexture),this._trackHandle(n)}acquireDepth(e,r,i){return this._acquireDepth(e,r,i)}_acquireDepth(e,r,i){const s=e5(e,r,i),n=this._depthCache.pop(s);if(n)return this._trackHandle(n);const o=e===Hs.DEPTH_STENCIL_TEXTURE?new VX(s,new Rt(this.rctx,{...jX[e],width:r,height:i}),()=>{this._acquired.delete(o),this._depthCache.put(o)}):new VX(s,new efe(this.rctx,{...jX[e],width:r,height:i}),()=>{this._acquired.delete(o),this._depthCache.put(o)});return this._trackHandle(o)}_acquireColor(e,r,i){const s=e5(e,r,i),n=this._colorCache.pop(s);if(n)return this._trackHandle(n);const o=new e8e(s,new Rt(this.rctx,{...GX[e],width:r,height:i}),()=>{this._acquired.delete(o),this._colorCache.put(o)});return this._trackHandle(o)}_trackHandle(e){return this._acquired.add(e),e}},K6e=class{constructor(e,r,i,s){this.key=e,this.fbo=r,this.acquireDepth=i,this.acquireColor=s,this.release=()=>{},this.incarnation=0}dispose(){this.fbo.dispose()}releaseDepth(){this.fbo.detachDepthStencilTexture(),this.fbo.detachDepthStencilBuffer(),this.depth=Zt(this.depth)}detachDepth(){const e=this.depth;return this.depth=void 0,this.fbo.detachDepthStencilTexture(),this.fbo.detachDepthStencilBuffer(),e}attachDepth(e){return this.releaseDepth(),e&&(this.fbo.attachDepthStencil(e.attachment),this.depth=e),this}releaseColor(e){var i,s;this.fbo.detachColorTexture(e);const r=(i=this.colors)==null?void 0:i.get(e);(s=this.colors)==null||s.delete(e),Zt(r)}get colorTexture(){var e;return(e=this.fbo)==null?void 0:e.colorTexture}getColorTexture(e=ka.COLOR_ATTACHMENT0){var r;return(r=this.fbo)==null?void 0:r.getColorTexture(e)}get usedMemory(){return this.fbo.gpuMemoryUsage}},rfe=class{constructor(e,r,i){this.key=e,this.attachment=r,this.release=i,this.incarnation=0}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.gpuMemoryUsage}},VX=class extends rfe{},e8e=class extends rfe{constructor(e,r,i){super(e,r,i),this.attachment=r,this.release=i}};function e5(t,e,r){return`${t}x${e}x${r}`}var cr;(function(t){t[t.RED=0]="RED",t[t.RG=1]="RG",t[t.RGBA4=2]="RGBA4",t[t.RGBA=3]="RGBA",t[t.RGBA_MIPMAP=4]="RGBA_MIPMAP",t[t.R16F=5]="R16F",t[t.RGBA16F=6]="RGBA16F"})(cr||(cr={}));const pM=new Or;pM.pixelFormat=ut.RED,pM.internalFormat=Ve.R8,pM.wrapMode=Ft.CLAMP_TO_EDGE;const fM=new Or;fM.pixelFormat=ut.RG,fM.internalFormat=Ve.RG8,fM.wrapMode=Ft.CLAMP_TO_EDGE;const mM=new Or;mM.internalFormat=Ve.RGBA4,mM.dataType=en.UNSIGNED_SHORT_4_4_4_4,mM.wrapMode=Ft.CLAMP_TO_EDGE;const ife=new Or;ife.wrapMode=Ft.CLAMP_TO_EDGE;const kS=new Or;kS.wrapMode=Ft.CLAMP_TO_EDGE,kS.samplingMode=Dt.LINEAR_MIPMAP_LINEAR,kS.hasMipmap=!0,kS.maxAnisotropy=8;const BS=new Or;BS.pixelFormat=ut.RED,BS.dataType=en.HALF_FLOAT,BS.internalFormat=Ve.R16F,BS.samplingMode=Dt.NEAREST;const gM=new Or;gM.dataType=en.HALF_FLOAT,gM.internalFormat=Ve.RGBA16F,gM.samplingMode=Dt.NEAREST;const GX={[cr.RED]:pM,[cr.RG]:fM,[cr.RGBA4]:mM,[cr.RGBA]:ife,[cr.RGBA_MIPMAP]:kS,[cr.R16F]:BS,[cr.RGBA16F]:gM};var Hs;(function(t){t[t.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",t[t.DEPTH_STENCIL_BUFFER=1]="DEPTH_STENCIL_BUFFER",t[t.DEPTH24_BUFFER=2]="DEPTH24_BUFFER",t[t.DEPTH16_BUFFER=3]="DEPTH16_BUFFER"})(Hs||(Hs={}));const zS=new Or;zS.pixelFormat=ut.DEPTH_STENCIL,zS.dataType=en.UNSIGNED_INT_24_8,zS.samplingMode=Dt.NEAREST,zS.wrapMode=Ft.CLAMP_TO_EDGE;const jX={[Hs.DEPTH_STENCIL_TEXTURE]:zS,[Hs.DEPTH_STENCIL_BUFFER]:new uM(Cn.DEPTH24_STENCIL8,4),[Hs.DEPTH24_BUFFER]:new uM(Cn.DEPTH_COMPONENT24,4),[Hs.DEPTH16_BUFFER]:new uM(Cn.DEPTH_COMPONENT16,4)};let Zn=class{constructor(e,r,i,s,n,o=!1,a=0){this.name=e,this.count=r,this.type=i,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};new Zn(R.POSITION,3,Xe.FLOAT,0,12);new Zn(R.POSITION,3,Xe.FLOAT,0,20),new Zn(R.UV0,2,Xe.FLOAT,12,20);new Zn(R.POSITION,3,Xe.FLOAT,0,32),new Zn(R.NORMAL,3,Xe.FLOAT,12,32),new Zn(R.UV0,2,Xe.FLOAT,24,32);new Zn(R.POSITION,3,Xe.FLOAT,0,16),new Zn(R.COLOR,4,Xe.UNSIGNED_BYTE,12,16);const xG=[new Zn(R.POSITION,2,Xe.FLOAT,0,8)],q3=[new Zn(R.POSITION,2,Xe.FLOAT,0,16),new Zn(R.UV0,2,Xe.FLOAT,8,16)],eb=ne.getLogger("esri.views.webgl.VertexArrayObject");let Fu=class{constructor(e,r,i,s,n=null){this._context=e,this._locations=r,this._layout=i,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,r)=>e+this._buffers[r].byteLength,this._indexBuffer!=null?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*Mse}dispose(){var e;if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const r in this._buffers)(e=this._buffers[r])==null||e.dispose(),delete this._buffers[r];this._indexBuffer=Ke(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&eb.warn("Leaked WebGL VAO")}disposeVAOOnly(){var e,r;this._glName&&(((r=(e=this._context)==null?void 0:e.capabilities)==null?void 0:r.vao).deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(bs.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const r=e.createVertexArray();e.bindVertexArray(r),this._bindLayout(),e.bindVertexArray(null),this._glName=r,this._context.instanceCounter.increment(bs.VertexArrayObject,this)}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:r,_indexBuffer:i}=this;e||eb.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in e){const o=e[n];o||eb.error("Vertex buffer is uninitialized!");const a=r[n];a||eb.error("Vertex element descriptor is empty!"),vG(this._context,this._locations,o,a)}i!=null&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:r}=this;e||eb.error("Vertex buffer dictionary is empty!");for(const i in e){const s=e[i];s||eb.error("Vertex buffer is uninitialized!");const n=r[i];bG(this._context,this._locations,s,n)}this._indexBuffer!=null&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},pd=class extends Fu{};function ef(t,e=xG,r=hr,i=-1,s=1){let n=null;return e===q3?n=new Float32Array([i,i,0,0,s,i,1,0,i,s,0,1,s,s,1,1]):n=new Float32Array([i,i,s,i,i,s,s,s]),new pd(t,r,{geometry:e},{geometry:Cr.createVertex(t,yr.STATIC_DRAW,n)})}function t8e(t,e=xG,r=hr){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new pd(t,r,{geometry:e},{geometry:Cr.createVertex(t,yr.STATIC_DRAW,i)})}const r8e=4;function sfe(t){const e=new Or(r8e);return e.samplingMode=Dt.NEAREST,new Rt(t,e)}function i8e(t){const e=new Or(1);return e.samplingMode=Dt.NEAREST,new Rt(t,e,new Uint8Array([255,255,255,255]))}const HX=16;function M1(t){return Math.ceil(t/HX)*HX}function s8e(t,e){let n=t.width*t.height;if(n<4096)return t instanceof ImageData?nfe(t):t;let o=t.width,a=t.height;do o=Math.ceil(o/2),a=Math.ceil(a/2),n=o*a;while(n>1048576||e!=null&&(o>e||a>e));return TG(t,o,a)}function n8e(t,e){const r=Math.max(t.width,t.height);if(r<=e)return t;const i=e/r;return TG(t,Math.round(t.width*i),Math.round(t.height*i))}function TG(t,e,r){if(t instanceof ImageData)return TG(nfe(t),e,r);const i=document.createElement("canvas");return i.width=e,i.height=r,i.getContext("2d").drawImage(t,0,0,i.width,i.height),i}function nfe(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const r=e.getContext("2d");if(r==null)throw new X("Failed to create 2d context from HTMLCanvasElement");return r.putImageData(t,0,0),e}function Wo(t,e=!0){t.attributes.add(R.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(b`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?b`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let ofe=class extends Vr{};function o8e(t){const e=new dr;e.include(Wo),e.fragment.uniforms.add(new Ze("colorTexture",i=>i.color),new Ze("depthTexture",i=>i.depth));const r=t.haze;return e.fragment.code.add(b`
    void main() {
      ${r?b`vec4`:b`float`} depthSample = texture(depthTexture, uv) ${r?"":b`.r`};
      if (depthSample ${r?b`== vec4(0)`:b`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `),e}const a8e=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:ofe,build:o8e},Symbol.toStringTag,{value:"Module"}));let afe=class lfe extends Sr{initializeProgram(e){return new vr(e.rctx,lfe.shader.get().build(this.configuration),hr)}initializePipeline(){return this.configuration.haze?Et({blending:Jn(ve.ONE,ve.ZERO,ve.ONE_MINUS_SRC_COLOR,ve.ONE),depthTest:{func:Ar.ALWAYS},colorWrite:Ut}):Et({blending:Dl(ve.SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ar.ALWAYS},colorWrite:Ut})}};afe.shader=new _r(a8e,()=>he(()=>import("./AtmosphereCompositing.glsl-5a0a3df6.js"),[],import.meta.url));let qX=class{constructor(e,r){this._view=e,this._context=r,this.type=Co.Realistic,this._handles=new Am,this._atmosphereCompositionParameters=new ofe,this._atmosphereConfiguration=new mI,this._passParameters=new L6e,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=mr.radius,this._fadeHaze=0,this._updateRadius(mr.radius);const i=this._context.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([ae(()=>{var n,o;return(o=(n=this._view)==null?void 0:n.basemapTerrain)==null?void 0:o.rootTileElevationBounds},()=>{var n;return(n=this._view)!=null&&n.basemapTerrain?this._updateRootTileElevationBounds():null}),ae(()=>{var n,o;return(o=(n=this._view)==null?void 0:n.basemapTerrain)==null?void 0:o.visibleElevationBounds},()=>{var n;return(n=this._view)!=null&&n.basemapTerrain?this._updateVisibleElevationBounds():null}),ae(()=>{var n;return(n=this._view)==null?void 0:n.environment.background},n=>{const o=n instanceof vpe?jC(n.color):Ec;se(this._passParameters.backgroundColor,o[0]*o[3],o[1]*o[3],o[2]*o[3])},Br)]);const s=new mI;s.haze=!1,this._atmosphereTechnique=this._context.techniqueRepository.acquire(US,s),s.haze=!0,this._atmosphereHazeTechnique=this._context.techniqueRepository.acquire(US,s),s.reduced=!0,s.haze=!1,this._atmosphereReducedTechnique=this._context.techniqueRepository.acquire(US,s),s.haze=!0,this._atmosphereHazeReducedTechnique=this._context.techniqueRepository.acquire(US,s),this._vao=ef(i,q3)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,r){this._render(e,r?this._atmosphereTechnique:this._atmosphereReducedTechnique,e.offscreenRenderingHelper.depthTexture,r,!1)}renderHaze(e,r,i){var s;this._fadeHaze=r,this._render(e,i?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,(s=e.bindParameters.linearDepth)==null?void 0:s.colorTexture,i,!0)}_render(e,r,i,s,n){if(i==null)return;const o=e.offscreenRenderingHelper;this._update(e.bindParameters.camera),this._passParameters.depthTexture=i;const a=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);if(s)o.renderDepthDetached(()=>this._renderCommon(a,e));else{const l=e.rctx.getViewport(),c=_e(e.bindParameters.camera.eye)-mr.radius;let u;if(c<s0){const _=Math.min(1,Math.max(0,c/s0));u=n?ft(.4,.5,_):ft(.2,.3,_)}else{const _=Math.min(1,Math.max(0,(c-s0)/(15*s0)));u=n?ft(.5,1,_):ft(.3,.6,_)}const d=M1(Math.round(u*e.bindParameters.camera.fullViewport[2])),p=M1(Math.round(u*e.bindParameters.camera.fullViewport[3]));e.rctx.setViewport(0,0,d,p);const g=o.renderToCachedFBO(null,()=>this._renderCommon(a,e),[0,0,0,1],cr.RGBA,null,d,p);e.rctx.setViewport(l.x,l.y,l.width,l.height),this._atmosphereCompositionParameters.color=g.colorTexture,this._atmosphereCompositionParameters.depth=i,this._atmosphereConfiguration.haze=n;const y=this._context.techniqueRepository.acquire(afe,this._atmosphereConfiguration);e.rctx.bindTechnique(y,this._atmosphereCompositionParameters,e.bindParameters),o.renderDepthDetached(()=>e.rctx.screen.draw()),y.release(),g.release()}}_renderCommon(e,r){this._vao!=null&&(r.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(Qt.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=mr.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(mr.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,ir(this._passParameters.radii,e,e+s0),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-K9)*K9)}_update(e){if(!e)return;const r=co(e.eye),i=Math.sqrt(r),s=r-this._passParameters.radii[1]*this._passParameters.radii[1],n=me((i-this._passParameters.radii[0])/s0,0,1);Si(this._passParameters.heightParameters,i,r,s,n),this._passParameters.altitudeFade=yG(i-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=ft(ft(.6,1,AC(9500,10500,i-mr.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function cfe(t){t.fragment.code.add(b`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function SG(t,e){switch(t.include(Rp,e),e.textureCoordinateType){case xs.Default:case xs.Compressed:return void t.fragment.code.add(b`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case xs.Atlas:return t.include(cfe),void t.fragment.code.add(b`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case xs.None:case xs.COUNT:return}}let Cc=class extends qi{constructor(e,r){super(e,"vec3",gr.Draw,(i,s,n,o)=>i.setUniform3fv(e,r(s,n,o)))}},xu=class extends qi{constructor(e,r){super(e,"sampler2D",gr.Draw,(i,s,n)=>i.bindTexture(e,r(s,n)))}},my=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(e,r){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,r),this._technique),this._technique}ensureResources(e){return Z0.LOADED}},EG=class extends my{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRepository,this._textureId=e.textureId,this._acquire(e.textureId,r=>this._texture=r),this._acquire(e.normalTextureId,r=>this._textureNormal=r),this._acquire(e.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(e.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(e.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=Zt(this._texture),this._textureNormal=Zt(this._textureNormal),this._textureEmissive=Zt(this._textureEmissive),this._textureOcclusion=Zt(this._textureOcclusion),this._textureMetallicRoughness=Zt(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?Z0.LOADED:Z0.LOADING}get textureBindParameters(){return new ufe(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=Zt(this._texture),this._textureId=e,this._acquire(this._textureId,r=>this._texture=r))}_acquire(e,r){if(e==null)return void r(null);const i=this._textureRepository.acquire(e);if(Fl(i))return++this._numLoading,void i.then(s=>{if(this._disposed)return Zt(s),void r(null);r(s)}).finally(()=>--this._numLoading);r(i)}},ufe=class extends Vr{constructor(e=null,r=null,i=null,s=null,n=null){super(),this.texture=e,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=s,this.textureMetallicRoughness=n}};var et;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(et||(et={}));function CG(t,e){const r=t.fragment,i=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===et.Normal&&i&&t.include(SG,e),e.pbrMode!==et.Schematic)if(e.pbrMode!==et.Disabled){if(e.pbrMode===et.Normal){r.code.add(b`vec3 mrr;
vec3 emission;
float occlusion;`);const s=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(r.uniforms.add(s===gr.Pass?new Ze("texMetallicRoughness",n=>n.textureMetallicRoughness):new xu("texMetallicRoughness",n=>n.textureMetallicRoughness)),r.code.add(b`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(r.uniforms.add(s===gr.Pass?new Ze("texEmission",n=>n.textureEmissive):new xu("texEmission",n=>n.textureEmissive)),r.code.add(b`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(r.uniforms.add(s===gr.Pass?new Ze("texOcclusion",n=>n.textureOcclusion):new xu("texOcclusion",n=>n.textureOcclusion)),r.code.add(b`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(b`float getBakedOcclusion() { return 1.0; }`),s===gr.Pass?r.uniforms.add(new Pt("emissionFactor",n=>n.emissiveFactor),new Pt("mrrFactors",n=>n.mrrFactors)):r.uniforms.add(new Cc("emissionFactor",n=>n.emissiveFactor),new Cc("mrrFactors",n=>n.mrrFactors)),r.code.add(b`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?b`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?b`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?b`applyEmission(${e.hasEmissiveTextureTransform?b`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?b`applyOcclusion(${e.hasOcclusionTextureTransform?b`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else r.code.add(b`float getBakedOcclusion() { return 1.0; }`);else r.code.add(b`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function AG(t,e){const r=t.fragment,i=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new Pt("lightingAmbientSH0",(s,n)=>se(WX,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add(new nr("lightingAmbientSH_R",(s,n)=>Si(hf,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new nr("lightingAmbientSH_G",(s,n)=>Si(hf,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new nr("lightingAmbientSH_B",(s,n)=>Si(hf,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add(new Pt("lightingAmbientSH0",(s,n)=>se(WX,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new nr("lightingAmbientSH_R1",(s,n)=>Si(hf,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new nr("lightingAmbientSH_G1",(s,n)=>Si(hf,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new nr("lightingAmbientSH_B1",(s,n)=>Si(hf,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new nr("lightingAmbientSH_R2",(s,n)=>Si(hf,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new nr("lightingAmbientSH_G2",(s,n)=>Si(hf,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new nr("lightingAmbientSH_B2",(s,n)=>Si(hf,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==et.Normal&&e.pbrMode!==et.Schematic||r.code.add(b`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const WX=E(),hf=Jt();function W3(t){t.vertex.code.add(b`const float PI = 3.141592653589793;`),t.fragment.code.add(b`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var vp,av;function l8e(t){return(t==null?void 0:t.cubeMap)!=null}function c8e(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FADING=1]="FADING",t[t.FINISHED=2]="FINISHED"})(vp||(vp={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(av||(av={}));function Dm(t=hfe){return[t[0],t[1],t[2],t[3]]}function yM(t,e,r=Dm()){return ie(r,t),r[3]=e,r}function YX(t,e,r=Dm()){return rt(r,t,e),pe(r,r),r[3]=-Boe(t,e),r}function XX(t,e,r=Dm()){return BC(TR,t,lk(t)),BC(ZX,e,lk(e)),eG(TR,ZX,TR),h8e(r,_a(KV(r,TR)))}function c1t(t,e,r,i=Dm()){return yM(Noe,t,SR),yM(Foe,e,JX),yM(T7,r,QX),XX(SR,JX,SR),XX(SR,QX,i),i}function u1t(t){return t}function u8e(t){return t[3]}function lk(t){return At(t[3])}function h8e(t,e){return t[3]=e,t}const hfe=[0,0,1,0],TR=Bu(),ZX=Bu();Dm();const SR=Dm(),JX=Dm(),QX=Dm();var xr;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(xr||(xr={}));let d8e=class{constructor(){this.readChannels=av.RG,this.renderingStage=vp.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=E(),this.parallax=new KX,this.parallaxNew=new KX,this.pointOnGround=E(),this.fadeMode=ci.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const r=this.parallax,i=_e(e.eye);if(r.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(i*i-mr.radius*mr.radius,0))/i,YX(eZ,r.anchorPointClouds,tb),El(r.transform,$i,tb[3],tb),this.fadeMode===ci.CROSS_FADE){const s=this.parallaxNew;YX(eZ,s.anchorPointClouds,tb),El(s.transform,$i,tb[3],tb)}}updateFading(e,r,i,s){this.isFading&&this._advanceFading(i,s),this._evaluateFading(e,r,i)}_evaluateFading(e,r,i){const s=e.relativeElevation,n=this._calculateDistanceToAnchorPoint(e);if((s>1.7*Hf||s<-Hf||n>y8e)&&this.opacity>0)this._setFade(ci.HIDE,i);else if(!this.isFading){if((s>Hf||s<-.35*Hf||n>g8e)&&this.opacity>0)this._setFade(ci.FADE_OUT,i);else if(s<=Hf&&s>=-.35*Hf&&r===xr.IDLE&&c8e(this.data)){if(this.opacity===0)return void this._setFade(ci.FADE_IN,i);(n>m8e||this.renderingStage===vp.FADING)&&this._setFade(ci.CROSS_FADE,i)}}}_advanceFading(e,r){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,r)}_advanceFadingFactorAndOpacity(e,r){if(this.fadeFactor<1)return this.fadeFactor=r?me((e-this.startTime)/(f8e*r),0,1):1,this.fadeMode===ci.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===ci.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===ci.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===ci.FADE_OUT&&(this.opacity=0),this.fadeMode===ci.FADE_IN&&(this.opacity=1),this.fadeMode===ci.CROSS_FADE&&(this.opacity=1),this.fadeMode=ci.NONE}_switchReadChannels(){const e=this.fadeMode===ci.CROSS_FADE&&this.fadeFactor===1,r=this.fadeMode===ci.FADE_IN&&this.fadeFactor===0;this.renderingStage===vp.FADING&&(e||r)&&(this.readChannels=1-this.readChannels,this.renderingStage=vp.FINISHED)}_calculateDistanceToAnchorPoint(e){return pe(this.pointOnGround,e.eye),ee(this.pointOnGround,this.pointOnGround,mr.radius),_e(ce(p8e,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===ci.CROSS_FADE&&(this.fadeFactor===0&&ie(this.parallaxNew.anchorPointClouds,this.pointOnGround),this.fadeFactor===1&&ie(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===ci.FADE_IN&&this.fadeFactor===0&&ie(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,r){switch(e){case ci.HIDE:this.opacity=0;break;case ci.FADE_OUT:this.opacity=1;break;case ci.FADE_IN:this.opacity=0;break;case ci.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=r}get isFading(){return this.fadeMode===ci.FADE_OUT||this.fadeMode===ci.FADE_IN||this.fadeMode===ci.CROSS_FADE}};var ci;(function(t){t[t.NONE=0]="NONE",t[t.HIDE=1]="HIDE",t[t.FADE_OUT=2]="FADE_OUT",t[t.FADE_IN=3]="FADE_IN",t[t.CROSS_FADE=4]="CROSS_FADE"})(ci||(ci={}));let KX=class{constructor(){this.anchorPointClouds=E(),this.radiusCurvatureCorrectionFactor=0,this.transform=ge()}};const eZ=Te(0,0,1),tb=Dm(),p8e=E(),f8e=1.25,m8e=34e3,g8e=64e3,y8e=2e5;let Op=class extends qi{constructor(e,r){super(e,"bool",gr.Pass,(i,s,n)=>i.setUniform1b(e,r(s,n)))}},_8e=class extends qi{constructor(e,r){super(e,"samplerCube",gr.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};function dfe(t){const e=t.fragment;e.uniforms.add(new Li("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new Li("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new Pt("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new Pt("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new Ee("cloudsHeight",()=>nFe),new Ee("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Ee("totalFadeInOut",(r,i)=>1-i.cloudsFade.opacity),new Ee("crossFadeAnchorFactor",(r,i)=>me(i.cloudsFade.fadeFactor,0,1)),new _8e("cubeMap",(r,i)=>{var s,n;return((n=(s=i.cloudsFade.data)==null?void 0:s.cubeMap)==null?void 0:n.colorTexture)??null}),new Op("crossFade",(r,i)=>i.cloudsFade.fadeMode===ci.CROSS_FADE),new Op("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===av.RG),new Op("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===vp.FADING)),e.constants.add("planetRadius","float",mr.radius),e.code.add(b`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(b`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(b`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),Lm(e),Jp(e),e.code.add(b`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(b`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(b`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(b`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(b`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function tf(t){t.code.add(b`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function v8e(){const t=new dr,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(R.POSITION,"vec2"),r.add("worldRay","vec3"),i.uniforms.add(new Li("inverseProjectionMatrix",(n,o)=>o.camera.inverseProjectionMatrix),new Li("inverseViewMatrix",(n,o)=>T2(b8e,o.camera.viewMatrix))),i.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),s.include(tf),s.include(zu),t.include(AG,{pbrMode:et.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(W3),t.include(XD),t.include(pI),t.include(dfe),s.uniforms.add(new Pt("cameraPosition",(n,o)=>o.camera.eye)),s.code.add(b`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const b8e=ge(),w8e=Object.freeze(Object.defineProperty({__proto__:null,build:v8e},Symbol.toStringTag,{value:"Module"}));let pfe=class ffe extends Sr{constructor(e){super(e,new Za,()=>this.destroy())}initializeProgram(e){return new vr(e.rctx,ffe.shader.get().build(),hr)}initializePipeline(){return Et({blending:Jn(ve.ONE,ve.ZERO,ve.SRC_ALPHA,ve.ONE),depthTest:{func:Ar.LEQUAL},colorWrite:Ut})}};pfe.shader=new _r(w8e,()=>he(()=>import("./CloudsComposition.glsl-4ffb1b29.js"),[],import.meta.url));let N_=class extends xe{constructor(e){super(e),this._technique=new pfe(e),this._vao=ef(e.rctx)}destroy(){this._technique=Zt(this._technique),this._vao=Ke(this._vao)}render(e){if(!this._technique.compiled)return void this.requestRender();const r=e.bindParameters.cloudsFade;if(this._vao==null||r.data==null)return;const i=e.rctx.bindTechnique(this._technique,x8e,e.bindParameters);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Qt.TRIANGLE_STRIP,0,4)}};h([f({constructOnly:!0})],N_.prototype,"rctx",void 0),h([f({constructOnly:!0})],N_.prototype,"viewingMode",void 0),h([f({constructOnly:!0})],N_.prototype,"planetRadius",void 0),h([f({constructOnly:!0})],N_.prototype,"requestRender",void 0),N_=h([k("esri.views.3d.environment.CloudsComposition")],N_);const x8e=new Vr;function os(){return new Float32Array(3)}function ck(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Nr(t,e,r){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i}function T8e(t,e){return new Float32Array(t,e,3)}function RG(){return os()}function mfe(){return Nr(1,1,1)}function gfe(){return Nr(1,0,0)}function yfe(){return Nr(0,1,0)}function _fe(){return Nr(0,0,1)}const S8e=RG(),E8e=mfe(),C8e=gfe(),A8e=yfe(),R8e=_fe();Object.freeze(Object.defineProperty({__proto__:null,ONES:E8e,UNIT_X:C8e,UNIT_Y:A8e,UNIT_Z:R8e,ZEROS:S8e,clone:ck,create:os,createView:T8e,fromValues:Nr,ones:mfe,unitX:gfe,unitY:yfe,unitZ:_fe,zeros:RG},Symbol.toStringTag,{value:"Module"}));var Ha;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(Ha||(Ha={}));let _M=class extends Za{constructor(){super(...arguments),this.steps=Ha.SIXTEEN,this.writeTextureChannels=av.RG}};h([F({count:Ha.COUNT})],_M.prototype,"steps",void 0),h([F({constValue:te("esri-mobile")?1024:2048})],_M.prototype,"cubeMapSize",void 0),h([F()],_M.prototype,"writeTextureChannels",void 0);let VS=class{constructor(e,r,i,s,n,o,a,l,c=.5){this.coverage=e,this.density=r,this.absorption=i,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const tZ=new VS([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Ha.SIXTEEN),Eo={sunny:tZ,cloudy:new VS([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Ha.TWOHUNDRED,.6),rainy:new VS([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Ha.TWOHUNDRED,.4),snowy:new VS([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Ha.HUNDRED,.65),foggy:new VS([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Ha.SIXTEEN),default:tZ},cu=te("esri-mobile")?64:128,O8e=cu/128,Th=Math.ceil(Math.sqrt(cu)),I0=(cu+2)*Th,P8e=1e5,t5=128,M8e=I0/1560;let qC=class extends qi{constructor(e,r){super(e,"mat3",gr.Draw,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}},vfe=class extends Vr{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=Eo.default.raymarchingSteps,this.weatherTile=ke()}},bfe=class extends Vr{constructor(){super(...arguments),this.viewMatrix=Fi()}};function $8e(t){const e=new dr;e.include(Wo,!1);const r=e.fragment;return r.uniforms.add(new Ee("cloudRadius",i=>i.cloudRadius),new Ee("power",i=>ft(35,120,i.absorption)),new Ee("sigmaE",i=>1+i.absorption),new Ee("density",i=>ft(0,.3,i.density)),new Ee("cloudSize",i=>ft(0,.02,Math.max(.01,1-i.cloudSize))),new Ee("detailSize",i=>ft(0,.2,Math.max(.01,1-i.detailSize))),new Ee("smoothness",i=>ft(0,.5,1-i.smoothness)),new Ee("cloudHeight",i=>ft(0,1500,i.cloudHeight)),new Ee("coverage",i=>i.coverage),new qC("view",i=>i.viewMatrix),new Ze("cloudShapeTexture",i=>i.noiseTexture!=null?i.noiseTexture.textureAtlas:null),new Ir("cloudVariables",i=>ir(I8e,i.coverage,i.absorption))),r.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),r.code.add(b`
    const int STEPS = ${t.steps===Ha.SIXTEEN?b`16`:t.steps===Ha.HUNDRED?b`100`:b`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(b`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${b.float(I0)};
      const float dataWidth = ${b.float(I0)};
      const float tileRows = ${b.float(Th)};
      const vec3 atlasDimensions = vec3(${b.float(cu)}, ${b.float(cu)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${b.float(O8e)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${b.float(M8e)} * p) / ${b.float(I0)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),r.code.add(b`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(b`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(b`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(b`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(b`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const I8e=ke(),L8e=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:bfe,CloudsPassParameters:vfe,build:$8e},Symbol.toStringTag,{value:"Module"}));let wfe=class xfe extends Sr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new vr(e.rctx,xfe.shader.get().build(this.configuration),hr)}initializePipeline(){return Et({blending:Dl(ve.CONSTANT_COLOR,ve.ONE_MINUS_CONSTANT_COLOR,zp.ADD,this.configuration.writeTextureChannels===av.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Ar.LEQUAL},colorWrite:Ut})}};wfe.shader=new _r(L8e,()=>he(()=>import("./Clouds.glsl-1d524425.js"),[],import.meta.url));var pc;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(pc||(pc={}));let uk=class extends Za{constructor(){super(...arguments),this.mode=pc.Full}};h([F({count:pc.COUNT})],uk.prototype,"mode",void 0);let Tfe=class extends Vr{constructor(){super(...arguments),this.weatherTile=tr(0,0)}};function D8e(t){const e=new dr;return e.include(Wo,!1),e.fragment.code.add(b`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===pc.Full&&e.fragment.code.add(b`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${b.float(Th)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${b.float(8)});

      float worley0 = worley(p, ${b.float(2)} * 2.0);
      float worley1 = worley(p, ${b.float(2)} * 8.0);
      float worley2 = worley(p, ${b.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${b.float(2)});
      float worley1 = worley(p, ${b.float(2)} * 2.0);
      float worley2 = worley(p, ${b.float(2)} * 4.0);
      float worley3 = worley(p, ${b.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new Ir("weatherTile",r=>r.weatherTile)),e.fragment.code.add(b`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${b.float(t5)});

      // Get global coordinates of p
      p += weatherTile * ${b.float(t5)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${b.float(P8e)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(b`void main() {`),t.mode===pc.Full&&e.fragment.code.add(b`
        float padWidth = 1.0;
        float paddedSize = ${b.float(cu)} + 2.0 * padWidth;
        float tileCount = ${b.float(Th)} * ${b.float(Th)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${b.float(cu)};
          }

          if (startPadY) {
            pixel.y += ${b.float(cu)};
          }

          if (endPadX) {
            pixel.x -= ${b.float(cu)};
          }

          if (endPadY) {
            pixel.y -= ${b.float(cu)};
          }

          uv = vec2(pixel.xy / ${b.float(cu)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${b.float(cu)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${b.float(Th)} * ${b.float(Th)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${b.float(Th)} * ${b.float(Th)});
        p = p_;
        p.z /= (${b.float(Th)} * ${b.float(Th)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(b`
      vec2 mapUV = ${b.float(t5)} * (gl_FragCoord.xy / ${b.float(I0)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===pc.Full?b`fragColor.ba = vec2(0.0, map);`:b`fragColor = vec4(map);`};
    }
  `),e}const N8e=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:Tfe,build:D8e},Symbol.toStringTag,{value:"Module"}));let hk=class Sfe extends Sr{initializeProgram(e){return new vr(e.rctx,Sfe.shader.get().build(this.configuration),hr)}initializePipeline(){return Et({blending:this.configuration.mode===pc.Full?Dl(ve.ONE,ve.ZERO):Jn(ve.ZERO,ve.ONE,ve.ONE,ve.ZERO),depthTest:{func:Ar.ALWAYS},colorWrite:Ut})}};hk.shader=new _r(N8e,()=>he(()=>import("./NoiseTextureAtlas.glsl-0f84bcdb.js"),[],import.meta.url));let GS=class extends xe{constructor(e){super(e),this._needsRender=!0,this._passParameters=new Tfe,this._frameBuffer=new dd(e.context.renderContext.rctx,new Or(I0)),this._vao=ef(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(pc.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(pc.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(Ns(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=Zt(this._fullTechniqueCached),this._weatherMapTechniqueCached=Zt(this._weatherMapTechniqueCached),this._frameBuffer=Ke(this._frameBuffer),this._vao=Ke(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new uk;e.mode=pc.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(hk,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new uk;e.mode=pc.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(hk,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._frameBuffer==null)return null;const r=e===pc.Full?this._fullTechnique:this._weatherMapTechnique,i=this.context.renderContext.rctx,s=i.getViewport();i.setViewport(0,0,I0,I0),i.bindFramebuffer(this._frameBuffer);const n=i.bindTechnique(r,this._passParameters,null);return i.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}};h([f({constructOnly:!0})],GS.prototype,"context",void 0),h([f({readOnly:!0})],GS.prototype,"_techniqueRepository",null),GS=h([k("esri.views.3d.environment.NoiseTextureAtlas")],GS);var fl;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(fl||(fl={}));function Efe(t){t.include(Nu),t.uniforms.add(new Ze("geometryDepthTexture",(e,r)=>{var i;return(i=r.multipassGeometry.linearDepth)==null?void 0:i.colorTexture}),new Ir("nearFar",(e,r)=>r.camera.nearFar)),t.code.add(b`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let F8e=class{};function Nl(t,e){if(!e.multipassEnabled)return;t.fragment.include(Nu),t.fragment.uniforms.add(new Ze("terrainDepthTexture",(i,s)=>{var n;return(n=s.multipassTerrain.linearDepth)==null?void 0:n.colorTexture})),t.fragment.uniforms.add(new Ir("nearFar",(i,s)=>s.camera.nearFar));const r=e.occlusionPass;t.fragment.code.add(b`
   ${r?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      vec4 data = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);
      float linearDepth = linearDepthFromRGBA(data, nearFar);
      ${r?b`return fragmentDepth < linearDepth && data != vec4(0.0, 0.0, 0.0, 1.0);`:b`
          if(fragmentDepth ${e.cullAboveGround?">":"<="} linearDepth){
            discard;
          }`}
    }`)}let U8e=class{constructor(){this.cullAboveGround=!1}};function JD(t){return t?{ray:ln(t.ray),c0:t.c0,c1:t.c1}:{ray:ln(),c0:0,c1:Number.MAX_VALUE}}function k8e(t,e=JD()){return tI(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function B8e(t,e,r=JD()){const i=_e(t.vector);return ihe(t.origin,e,r.ray),r.c0=0,r.c1=i,r}function C1t(t,e){return Cfe(t,t.c0,e)}function A1t(t,e){return Cfe(t,t.c1,e)}function Cfe(t,e,r){return le(r,t.ray.origin,ee(r,t.ray.direction,e))}new Mm(()=>JD());function WC(t){return t?[wr(t[0]),wr(t[1]),wr(t[2]),wr(t[3]),wr(t[4]),wr(t[5])]:[wr(),wr(),wr(),wr(),wr(),wr()]}function Afe(){return[E(),E(),E(),E(),E(),E(),E(),E()]}function gI(t,e){for(let r=0;r<D2;r++)ID(t[r],e[r]);return t}function Rfe(t,e,r,i=q8e){const s=Pr(MV.get(),e,t);Ls(s,s);for(let n=0;n<j8e;++n){const o=gc(PV.get(),H8e[n],s);se(i[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}Ofe(r,i)}function Ofe(t,e){$o(e[He.FAR_BOTTOM_LEFT],e[He.NEAR_BOTTOM_LEFT],e[He.NEAR_TOP_LEFT],t[ri.LEFT]),$o(e[He.NEAR_BOTTOM_RIGHT],e[He.FAR_BOTTOM_RIGHT],e[He.FAR_TOP_RIGHT],t[ri.RIGHT]),$o(e[He.FAR_BOTTOM_LEFT],e[He.FAR_BOTTOM_RIGHT],e[He.NEAR_BOTTOM_RIGHT],t[ri.BOTTOM]),$o(e[He.NEAR_TOP_LEFT],e[He.NEAR_TOP_RIGHT],e[He.FAR_TOP_RIGHT],t[ri.TOP]),$o(e[He.NEAR_BOTTOM_LEFT],e[He.NEAR_BOTTOM_RIGHT],e[He.NEAR_TOP_RIGHT],t[ri.NEAR]),$o(e[He.FAR_BOTTOM_RIGHT],e[He.FAR_BOTTOM_LEFT],e[He.FAR_TOP_LEFT],t[ri.FAR])}function E0(t,e){for(let r=0;r<D2;r++){const i=t[r];if(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=e[3])return!1}return!0}function z8e(t,e){return Mfe(t,k8e(e,$fe.get()))}function R1t(t,e){for(let r=0;r<D2;r++){const i=t[r];if(!KIe(i,e))return!1}return!0}function V8e(t,e,r){return Mfe(t,B8e(e,r,$fe.get()))}function Pfe(t,e){for(let r=0;r<D2;r++)if(Wr(t[r],e)>0)return!1;return!0}function Mfe(t,e){for(let r=0;r<D2;r++)if(!QIe(t[r],e))return!1;return!0}var ri,He;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(ri||(ri={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(He||(He={}));const G8e={bottom:[He.FAR_BOTTOM_RIGHT,He.NEAR_BOTTOM_RIGHT,He.NEAR_BOTTOM_LEFT,He.FAR_BOTTOM_LEFT],near:[He.NEAR_BOTTOM_LEFT,He.NEAR_BOTTOM_RIGHT,He.NEAR_TOP_RIGHT,He.NEAR_TOP_LEFT],far:[He.FAR_BOTTOM_RIGHT,He.FAR_BOTTOM_LEFT,He.FAR_TOP_LEFT,He.FAR_TOP_RIGHT],right:[He.NEAR_BOTTOM_RIGHT,He.FAR_BOTTOM_RIGHT,He.FAR_TOP_RIGHT,He.NEAR_TOP_RIGHT],left:[He.FAR_BOTTOM_LEFT,He.NEAR_BOTTOM_LEFT,He.NEAR_TOP_LEFT,He.FAR_TOP_LEFT],top:[He.FAR_TOP_LEFT,He.NEAR_TOP_LEFT,He.NEAR_TOP_RIGHT,He.FAR_TOP_RIGHT]},D2=6,j8e=8,H8e=[Ot(-1,-1,-1,1),Ot(1,-1,-1,1),Ot(1,1,-1,1),Ot(-1,1,-1,1),Ot(-1,-1,1,1),Ot(1,-1,1,1),Ot(1,1,1,1),Ot(-1,1,1,1)],$fe=new Mm(JD),q8e=Afe();function W8e(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function Y8e(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function X8e(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function Z8e(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}var dk;let ot=dk=class extends xe{constructor(t={}){super(t),this._center=E(),this._up=E(),this._viewUp=E(),this._viewForward=E(),this._viewRight=E(),this._ray=ln(),this._viewport=Ot(0,0,1,1),this._padding=Ot(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=tr(1,1e3),this._viewDirty=!0,this._viewMatrix=ge(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=ge(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=ge(),this._frustumDirty=!0,this._frustum=WC(),this._fullViewport=Jt(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return ce(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Ss(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=X1(Jt(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&Z1(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=X1(Jt(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&Z1(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[Yt.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[Yt.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[Yt.RIGHT]+this._padding[Yt.LEFT]}set fullWidth(t){this.width=t-(this._padding[Yt.RIGHT]+this._padding[Yt.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[Yt.TOP]+this._padding[Yt.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[Yt.TOP]+this._padding[Yt.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[Yt.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[Yt.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){tx(this._padding,t)||(this._viewport[0]+=t[Yt.LEFT]-this._padding[Yt.LEFT],this._viewport[1]+=t[Yt.BOTTOM]-this._padding[Yt.BOTTOM],this._viewport[2]-=t[Yt.RIGHT]+t[Yt.LEFT]-(this._padding[Yt.RIGHT]+this._padding[Yt.LEFT]),this._viewport[3]-=t[Yt.TOP]+t[Yt.BOTTOM]-(this._padding[Yt.TOP]+this._padding[Yt.BOTTOM]),Fh(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Pr(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this._aspect,s=uae(ge(),-i*(1+2*this._padding[Yt.LEFT]/t),i*(1+2*this._padding[Yt.RIGHT]/t),-r*(1+2*this._padding[Yt.BOTTOM]/e),r*(1+2*this._padding[Yt.TOP]/e),this.near,this.far),n=this._get("projectionMatrix");return n&&rD(n,s)?n:s}get inverseProjectionMatrix(){return Ls(ge(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||ge()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return X8e(this._fov,this.width,this.height)}set fovX(t){this._fov=W8e(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Z8e(this._fov,this.width,this.height)}set fovY(t){this._fov=Y8e(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return hi(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Ls(this._viewInverseTransposeMatrix,this.viewMatrix),$l(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){ie(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,Fh(this._viewport,t.viewport),this.notifyChange("_viewport"),Fh(this._padding,t.padding),this.notifyChange("_padding"),Ns(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(Ss(this._viewMatrix,t.viewMatrix),ie(this._viewRight,t.viewRight),ie(this._viewUp,t.viewUp),ie(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(gI(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Ss(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Fh(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new dk().copyFrom(this)}equals(t){return ho(this.eye,t.eye)&&ho(this.center,t.center)&&ho(this.up,t.up)&&tx(this._viewport,t.viewport)&&tx(this._padding,t.padding)&&Ipe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||I$(t.screenPadding,this.screenPadding)>=e||I$(this.screenViewport,t.screenViewport)>=e)return!1;Rn(vo,t.eye,t.center),Rn(r5,this.eye,this.center);const r=de(vo,r5),i=I8(vo),s=I8(r5),n=5e-4;return r*r>=(1-1e-10)*i*s&&QL(t.eye,this.eye)<Math.max(i,s)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(NE(this.viewForward,ce(vo,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Vi()){return t[0]=(this.padding[Yt.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[Yt.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,r=.5){return t[0]=this.padding[Yt.LEFT]+this.width*e,t[1]=this.padding[Yt.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const e=this.viewport,r=this.padding;t.setViewport(e[0]-r[3],e[1]-r[2],e[2]+r[1]+r[3],e[3]+r[0]+r[2])}applyProjection(t,e){t!==Wt&&ie(Wt,t),Wt[3]=1,gc(Wt,Wt,this.projectionMatrix);const r=Math.abs(Wt[3]);ee(Wt,Wt,1/r);const i=this.fullViewport;e[0]=ft(0,i[0]+i[2],.5+.5*Wt[0]),e[1]=ft(0,i[1]+i[3],.5+.5*Wt[1]),e[2]=.5*(Wt[2]+1),e[3]=r}unapplyProjection(t,e){const r=this.fullViewport;Wt[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],Wt[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],Wt[2]=(2*t[2]-1)*t[3],Wt[3]=t[3],this.inverseProjectionMatrix!=null&&(gc(Wt,Wt,this.inverseProjectionMatrix),e[0]=Wt[0],e[1]=Wt[1],e[2]=Wt[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,i5),this.renderToScreen(i5,e),e}projectToRenderScreen(t,e){if(Wt[0]=t[0],Wt[1]=t[1],Wt[2]=t[2],Wt[3]=1,gc(Wt,Wt,this.viewProjectionMatrix),Wt[3]===0)return null;ee(Wt,Wt,1/Math.abs(Wt[3]));const r=this.fullViewport;return"x"in e?(e.x=ft(0,r[0]+r[2],.5+.5*Wt[0]),e.y=ft(0,r[1]+r[3],.5+.5*Wt[1])):(e[0]=ft(0,r[0]+r[2],.5+.5*Wt[0]),e[1]=ft(0,r[1]+r[3],.5+.5*Wt[1]),e.length>2&&(e[2]=.5*(Wt[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,i5),e)}unprojectFromRenderScreen(t,e){if(Pr(ER,this.projectionMatrix,this.viewMatrix),!Ls(ER,ER))return null;const r=this.fullViewport;return Wt[0]=2*(t[0]-r[0])/r[2]-1,Wt[1]=2*(t[1]-r[1])/r[3]-1,Wt[2]=2*t[2]-1,Wt[3]=1,gc(Wt,Wt,ER),Wt[3]===0?null:(e[0]=Wt[0]/Wt[3],e[1]=Wt[1]/Wt[3],e[2]=Wt[2]/Wt[3],e)}constrainWindowSize(t,e,r,i){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-r/2,0),a=Math.max(this.fullHeight-n-i/2,0),l=-Math.min(s-r/2,0),c=-Math.min(this.fullHeight-n-i/2,0),u=r-l- -Math.min(this.fullWidth-s-r/2,0),d=i-c- -Math.min(n-i/2,0);return[Math.round(o),Math.round(a),Math.round(u),Math.round(d)]}computeUp(t){t===$e.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const r=t[0]*this.pixelRatio,i=this.fullHeight-t[1]*this.pixelRatio;return e[0]=r,e[1]=i,e}renderToScreen(t,e){const r=t[0]/this.pixelRatio,i=(this.fullHeight-t[1])/this.pixelRatio;e[0]=r,e[1]=i}_computeUpGlobal(){ce(vo,this.center,this.eye);const t=_e(this.center);t<1?(se(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(de(vo,this.center))>.9999*_e(vo)*t||(rt(this._up,vo,this.center),rt(this._up,this._up,vo),pe(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){Rm(vo,this.eye,this.center),Math.abs(vo[2])<=.9999&&(ee(vo,vo,vo[2]),se(this._up,-vo[0],-vo[1],1-vo[2]),pe(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,r=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?ho(t,e)||(ie(e,t),this._markViewDirty(),r.length&&this.notifyChange(r)):ne.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Rfe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(tD(this._viewMatrix,this.eye,this.center,this.up),se(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),se(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),se(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};h([f()],ot.prototype,"_center",void 0),h([f()],ot.prototype,"_up",void 0),h([f()],ot.prototype,"_viewport",void 0),h([f()],ot.prototype,"_padding",void 0),h([f()],ot.prototype,"_fov",void 0),h([f()],ot.prototype,"_nearFar",void 0),h([f()],ot.prototype,"_pixelRatio",void 0),h([f()],ot.prototype,"pixelRatio",null),h([f()],ot.prototype,"eye",null),h([f()],ot.prototype,"center",null),h([f()],ot.prototype,"up",null),h([f({readOnly:!0})],ot.prototype,"nearFar",null),h([f()],ot.prototype,"near",null),h([f()],ot.prototype,"far",null),h([f()],ot.prototype,"viewport",null),h([f({readOnly:!0})],ot.prototype,"screenViewport",null),h([f({readOnly:!0})],ot.prototype,"screenPadding",null),h([f()],ot.prototype,"x",null),h([f()],ot.prototype,"y",null),h([f()],ot.prototype,"width",null),h([f()],ot.prototype,"height",null),h([f()],ot.prototype,"fullWidth",null),h([f()],ot.prototype,"fullHeight",null),h([f({readOnly:!0})],ot.prototype,"_aspect",null),h([f()],ot.prototype,"padding",null),h([f({readOnly:!0})],ot.prototype,"projectionMatrix",null),h([f({readOnly:!0})],ot.prototype,"inverseProjectionMatrix",null),h([f()],ot.prototype,"fov",null),h([f()],ot.prototype,"fovX",null),h([f()],ot.prototype,"fovY",null),ot=dk=h([k("esri.views.3d.webgl-engine.lib.Camera")],ot);const Wt=Jt(),ER=ge(),vo=E(),r5=E(),i5=po();var Yt;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(Yt||(Yt={}));var oe;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.ANTIALIASING=10]="ANTIALIASING",t[t.COMPOSITE=11]="COMPOSITE",t[t.BLIT=12]="BLIT",t[t.SSAO=13]="SSAO",t[t.HIGHLIGHT=14]="HIGHLIGHT",t[t.SHADOW_HIGHLIGHT=15]="SHADOW_HIGHLIGHT",t[t.ENVIRONMENT_OPAQUE=16]="ENVIRONMENT_OPAQUE",t[t.ENVIRONMENT_TRANSPARENT=17]="ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=18]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=19]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=20]="HUD_MATERIAL",t[t.LABEL_MATERIAL=21]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=22]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=23]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=24]="DRAPED_MATERIAL",t[t.DRAPED_WATER=25]="DRAPED_WATER",t[t.VOXEL=26]="VOXEL",t[t.MAX_SLOTS=27]="MAX_SLOTS"})(oe||(oe={}));var Qe;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(Qe||(Qe={}));let OG=class{constructor(e=E()){this.intensity=e}},Ife=class{constructor(e=E(),r=Te(.57735,.57735,.57735)){this.intensity=e,this.direction=r}},yI=class{constructor(e=E(),r=Te(.57735,.57735,.57735),i=!0,s=1,n=1){this.intensity=e,this.direction=r,this.castShadows=i,this.specularStrength=s,this.environmentStrength=n}},Lfe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function J8e(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e[i];return r}function s5(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e;return r}function ax(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]+e[i];return r}function Dfe(t){return(t+1)*(t+1)}function Q8e(t){return me(Math.floor(Math.sqrt(t)-1),0,2)}function Nfe(t,e,r){const i=t[0],s=t[1],n=t[2],o=r||[];return o.length=Dfe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*i*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*i*n,o[8]=.54627421529*(i*i-s*s)),o}function K8e(t,e){const r=Dfe(t),i=e||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let s=0;s<r;s++)i.r[s]=i.g[s]=i.b[s]=0;return i}function eUe(t,e){const r=Q8e(e.r.length);for(const i of t)ko(pk,i.direction),Nfe(pk,r,Yf),J8e(Yf,vM),s5(Yf,i.intensity[0],rb),ax(e.r,rb),s5(Yf,i.intensity[1],rb),ax(e.g,rb),s5(Yf,i.intensity[2],rb),ax(e.b,rb);return e}function tUe(t,e){Nfe(pk,0,Yf);for(const r of t)e.r[0]+=Yf[0]*vM[0]*r.intensity[0]*4*Math.PI,e.g[0]+=Yf[0]*vM[0]*r.intensity[1]*4*Math.PI,e.b[0]+=Yf[0]*vM[0]*r.intensity[2]*4*Math.PI;return e}function rUe(t,e,r,i){K8e(e,i),se(r.intensity,0,0,0);let s=!1;const n=iUe,o=sUe,a=nUe;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof yI&&!s?(ie(r.direction,l.direction),ie(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,s=!0):l instanceof yI||l instanceof Ife?n.push(l):l instanceof OG?o.push(l):l instanceof Lfe&&a.push(l);eUe(n,i),tUe(o,i);for(const l of a)ax(i.r,l.r),ax(i.g,l.g),ax(i.b,l.b)}const iUe=[],sUe=[],nUe=[],Yf=[0],rb=[0],pk=E(),vM=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let rZ=class{constructor(){this.color=E(),this.intensity=1}},oUe=class{constructor(){this.direction=E(),this.ambient=new rZ,this.diffuse=new rZ}};const Ffe=.4;let n5=class{constructor(){this._shOrder=2,this._legacy=new oUe,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new Lfe,this._mainLight=new yI(E(),Te(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){rUe(e,this._shOrder,this._mainLight,this._sphericalHarmonics),ie(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,ee(this._legacy.diffuse.color,this._mainLight.intensity,r),ie(CR,this._legacy.diffuse.color),ee(CR,CR,Ffe*this.globalFactor),le(this._legacy.ambient.color,this._legacy.ambient.color,CR)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),ie(this._mainLight.direction,e.mainLight.direction),ie(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,r,i){if($r(this._mainLight.intensity,e.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=ft(e.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=ft(e.mainLight.specularStrength,r.mainLight.specularStrength,i),ie(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=ft(e.globalFactor,r.globalFactor,i),this.noonFactor=ft(e.noonFactor,r.noonFactor,i),e.sh.r.length===r.sh.r.length)for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=ft(e.sh.r[s],r.sh.r[s],i),this._sphericalHarmonics.g[s]=ft(e.sh.g[s],r.sh.g[s],i),this._sphericalHarmonics.b[s]=ft(e.sh.b[s],r.sh.b[s],i);else for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=r.sh.r[s],this._sphericalHarmonics.g[s]=r.sh.g[s],this._sphericalHarmonics.b[s]=r.sh.b[s]}};const CR=E();let QD=class{constructor(e,r){this.shadowMap=e,this.slicePlane=r,this.slot=oe.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=Qe.NONE,this.alignPixelEnabled=!1,this.decorations=Al.ON,this.overlayStretch=1,this._camera=new ot,this._inverseViewport=ke(),this.oldLighting=new n5,this.newLighting=new n5,this._fadedLighting=new n5,this._lighting=this.newLighting,this.ssr=new aUe,this.multipassEnabled=!1,this.multipassTerrain=new U8e,this.multipassGeometry=new F8e,this.hudRenderStyle=fl.Occluded,this.cloudsFade=new d8e}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:r,newLighting:i}=this;e>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,e),this._lighting=this._fadedLighting)}},aUe=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=ge()}},lUe=class{constructor(){this._tasks=new Array,this._running=Zx(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,r,i){return this._running.value=!0,new Promise((s,n)=>this._tasks.push(new iZ(s,n,e,r,i)))}unshift(e,r,i){return this._running.value=!0,new Promise((s,n)=>this._tasks.unshift(new iZ(s,n,e,r,i)))}_process(e){var i;if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const s=Ys(r.signal);if(s&&!r.abortCallback)r.reject(ur());else{const n=s?(i=r.abortCallback)==null?void 0:i.call(r,ur()):r.callback(e);Fl(n)?n.then(r.resolve,r.reject):r.resolve(n)}}catch(s){r.reject(s)}return this._running.value=this._tasks.length>0,!0}cancelAll(){const e=ur();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(e);r.resolve(i)}else r.reject(e);this._tasks.length=0,this._running.value=!1}},iZ=class{constructor(e,r,i,s=void 0,n=void 0){this.resolve=e,this.reject=r,this.callback=i,this.signal=s,this.abortCallback=n}},jS=class extends xe{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};h([f()],jS.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),h([f()],jS.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),jS=h([k("esri.views.support.DebugFlags")],jS);const cUe=new jS;function uUe(){return new _I.Scheduler}var go,ct;(function(t){t[t.YIELD=1]="YIELD"})(go||(go={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"}(ct||(ct={}));const cp=0,sZ=new Map([[ct.RESOURCE_CONTROLLER_IMMEDIATE,cp],[ct.RESOURCE_CONTROLLER,4],[ct.SLIDE,cp],[ct.STREAM_DATA_LOADER,cp],[ct.ELEVATION_QUERY,cp],[ct.TERRAIN_SURFACE,1],[ct.SURFACE_GEOMETRY_UPDATES,1],[ct.LOD_RENDERER,2],[ct.GRAPHICS_CORE,2],[ct.I3S_CONTROLLER,2],[ct.POINT_CLOUD_LAYER,2],[ct.FEATURE_TILE_FETCHER,2],[ct.OVERLAY,4],[ct.STAGE,4],[ct.GRAPHICS_DECONFLICTOR,4],[ct.FILTER_VISIBILITY,4],[ct.SCALE_VISIBILITY,4],[ct.FRUSTUM_VISIBILITY,4],[ct.CLOUDS_GENERATOR,4],[ct.POINT_OF_INTEREST_FREQUENT,6],[ct.POINT_OF_INTEREST_INFREQUENT,30],[ct.LABELER,8],[ct.FEATURE_QUERY_ENGINE,8],[ct.FEATURE_TILE_TREE,16],[ct.FEATURE_TILE_TREE_ACTIVE,cp],[ct.ELEVATION_ALIGNMENT,12],[ct.TEXT_TEXTURE_ATLAS,12],[ct.TEXTURE_UNLOAD,12],[ct.LINE_OF_SIGHT_TOOL,16],[ct.LINE_OF_SIGHT_TOOL_INTERACTIVE,cp],[ct.SNAPPING,cp],[ct.SHADOW_ACCUMULATOR,30]]);function nZ(t){return sZ.has(t)?sZ.get(t):typeof t=="number"?t:1}const oZ=6.5,aZ=1,hUe=30,lZ=1e3/30,cZ=100,uZ=.9;var _I,My;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=Zx(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new Zf("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=xr.INTERACTING,this._tasks=new It,this._runQueue=new It,this._load=0,this._idleStateCallbacks=new It,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=ae(()=>cUe.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,zr);for(const o of Object.keys(ct))this.performanceInfo.tasks.set(ct[o],new Zf(ct[o]));const n=this;this._test={FRAME_SAFETY_BUDGET:oZ,INTERACTING_BUDGET:lZ,IDLE_BUDGET:cZ,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),di(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=nZ(n),l=new r(this,n,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new Zf(n)),l}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===xr.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===xr.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==xr.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){this._test.usedBudget=0,++this._frameNumber;let o=oZ,a=n.frameDuration,l=aZ;switch(this.state){case xr.IDLE:o=0,a=Math.max(cZ,n.frameDuration),l=hUe;break;case xr.INTERACTING:a=Math.max(lZ,n.frameDuration);case xr.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==xr.IDLE&&a<aZ&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case xr.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case xr.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return My.SCHEDULED;let o=My.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=My.READY:o!==My.READY&&(o=My.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*uZ+n*(1-uZ)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===cp&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==cp&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===go.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){ne.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c),a.blockFrame=this._frameNumber}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,ct.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(ct))this._frameTaskTimes.set(ct[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){return this._test}}t.Scheduler=e;class r{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,o,a,l){this._scheduler=n,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new lUe,this._handles=new Am,this.schedulePriority=this._basePriority,this._task=Zx(a??this._queue),this._handles.add($u(()=>this.task.running,c=>n.taskRunningChanged(c)))}remove(){this.processQueue(fa),this._scheduler.removeTask(this),this.schedule=Kx.schedule,this.reschedule=Kx.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){this.name=n;const o=nZ(n);this._basePriority!==cp&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){this._queue.runTask(n)}}class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=xr.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=i})(_I||(_I={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(My||(My={}));const fa=(()=>{const t=new _I.Budget;return t.enabled=!1,t})();let dUe=class{remove(){}processQueue(){}schedule(e,r,i){try{if(Ys(r)){const s=ur();return i?Promise.resolve(i(s)):Promise.reject(s)}return J6(e(fa))}catch(s){return Promise.reject(s)}}reschedule(e,r,i){return this.schedule(e,r,i)}};const Kx=new dUe;let Ia=class extends xe{constructor(e){super(e),this._techniques=new Array,this._techniqueConfiguration=new _M,this._bindParameters=new QD(null,null),this._passParameters=new vfe,this._drawParameters=new bfe,this._weatherTile=ke(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=ft(Eo.default.coverage[0],Eo.default.coverage[1],.5),this.density=ft(Eo.default.density[0],Eo.default.density[1],.5),this.absorption=ft(Eo.default.absorption[0],Eo.default.absorption[1],.5),this.cloudSize=ft(Eo.default.cloudSize[0],Eo.default.cloudSize[1],.5),this.detailSize=ft(Eo.default.detailSize[0],Eo.default.detailSize[1],.5),this.smoothness=ft(Eo.default.smoothness[0],Eo.default.smoothness[1],.5),this.cloudHeight=ft(Eo.default.cloudHeight[0],Eo.default.cloudHeight[1],.5),this.raymarchingSteps=Eo.default.raymarchingSteps,this._viewMatrix=ge(),this._dirty=!1,this.running=!1,this._vao=ef(e.context.renderContext.rctx)}_getTechnique(e){const r=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,i=r===av.RG?2*e:2*e+1;return this._techniques[i]||(this._techniqueConfiguration.writeTextureChannels=r,this._techniqueConfiguration.steps=e,this._techniques[i]=new wfe({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[i])}updateWeatherTile(){const e=this.view.camera.position.latitude,r=this.view.camera.position.longitude;if(e==null||r==null)return;ir(this._weatherTile,(e+90)/180,(r+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-i)*this._weatherTile[1]);let s=0,n=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),Lpe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=Mr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this.addHandles([this.view.resourceController.scheduler.registerTask(ct.CLOUDS_GENERATOR,this),ae(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),zr)])}destroy(){this._techniques.forEach(e=>Zt(e)),this._frameBufferCube=Ke(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=Oe(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case Ha.SIXTEEN:return 1;case Ha.HUNDRED:return 4;case Ha.COUNT:case Ha.TWOHUNDRED:return 8}}get usedMemory(){var e,r,i;return(((e=this._frameBufferCube)==null?void 0:e.gpuMemoryUsage)??0)+(((i=(r=this._passParameters.noiseTexture)==null?void 0:r.textureAtlas)==null?void 0:i.gpuMemoryUsage)??0)}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new GS({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const r=new Or(e);r.target=Ji.TEXTURE_CUBE_MAP,r.wrapMode=Ft.CLAMP_TO_EDGE,this._frameBufferCube=new dd(this.context.renderContext.rctx,r)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=Ke(this._frameBufferCube)}applyPreset(e,r){const i=e.median,s=n=>{const o=ft(n[0],n[1],i);return r<.5?ft(n[0],o,2*r):ft(o,n[1],2*(r-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),Ns(this._passParameters.weatherTile,this._weatherTile));const r=this._getTechnique(this._passParameters.raymarchingSteps);if(!r.compiled||this.context.renderContext.bindParameters.cloudsFade.fadeMode===ci.CROSS_FADE||!this._ensureNoiseTexture())return go.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=vp.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const i=this.context.renderContext.rctx,s=i.bindTechnique(r,this._passParameters,this._bindParameters);i.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const n=i.getViewport(),o=r.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;i.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);i.bindFramebuffer(c);const u=pUe[this._faceIndex],d=fUe[this._faceIndex];dae(this._viewMatrix,mUe,u,d),Iu(this._drawParameters.viewMatrix,this._viewMatrix);const p=Ji.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(p),s.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.gl.flush(),i.setViewport(n.x,n.y,n.width,n.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=vp.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),go.YIELD}};h([f({constructOnly:!0})],Ia.prototype,"context",void 0),h([f({constructOnly:!0})],Ia.prototype,"view",void 0),h([f({constructOnly:!0})],Ia.prototype,"requestRender",void 0),h([f()],Ia.prototype,"coverage",void 0),h([f()],Ia.prototype,"density",void 0),h([f()],Ia.prototype,"absorption",void 0),h([f()],Ia.prototype,"cloudSize",void 0),h([f()],Ia.prototype,"detailSize",void 0),h([f()],Ia.prototype,"smoothness",void 0),h([f()],Ia.prototype,"cloudHeight",void 0),h([f()],Ia.prototype,"raymarchingSteps",void 0),h([f()],Ia.prototype,"running",void 0),Ia=h([k("esri.views.3d.environment.CloudsGenerator")],Ia);const pUe=[Nr(1,0,0),Nr(-1,0,0),Nr(0,1,0),Nr(0,-1,0),Nr(0,0,1)],fUe=[Nr(0,1,0),Nr(0,1,0),Nr(0,0,-1),Nr(0,0,1),Nr(0,1,0)],mUe=RG();let Ufe=class extends Vr{constructor(){super(...arguments),this.fogColor=E(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function gUe(){const t=new dr;t.attributes.add(R.POSITION,"vec2"),t.include(Rp,{textureCoordinateType:xs.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new Li("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new Li("inverseViewMatrix",(i,s)=>T2(yUe,s.camera.viewMatrix))),e.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Ee("atmosphereC",i=>i.atmosphereC),new Pt("cameraPosition",(i,s)=>s.camera.eye),new Ir("nearFar",(i,s)=>s.camera.nearFar),new Ze("depthTexture",i=>i.depthTexture),new Ee("fogStrength",i=>i.fogStrength),new Ee("fogAmount",i=>i.fogAmount),new Pt("fogColor",i=>i.fogColor)),t.include(XD),r.include(Nu),r.code.add(b`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(b`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(b`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const yUe=ge(),_Ue=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:Ufe,build:gUe},Symbol.toStringTag,{value:"Module"}));let kfe=class Bfe extends Sr{constructor(e){super(e,new Za,()=>this.destroy())}initializeProgram(e){return new vr(e.rctx,Bfe.shader.get().build(),hr)}initializePipeline(){return Et({blending:Jn(ve.SRC_ALPHA,ve.ZERO,ve.ONE_MINUS_SRC_ALPHA,ve.ONE),colorWrite:Ut})}};kfe.shader=new _r(_Ue,()=>he(()=>import("./Fog.glsl-655505a5.js"),[],import.meta.url));const vUe=.95,bUe=1;let F_=class extends xe{constructor(e){super(e),this._passParameters=new Ufe;const r=e.context.renderContext.rctx;this._vao=ef(r,q3),this._technique=new kfe(e);const i=Mr(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+s0}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,r){if(this._update(e,r),this._passParameters.fogAmount<=0)return;const i=this._technique;if(!i.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);this._renderFog(n,e)})}_renderFog(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Qt.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;pe(hZ,i.eye);const s=Math.max(0,de(hZ,e.bindParameters.lighting.mainLight.direction)),n=r.color;ee(dZ,n,.1),$r(this._passParameters.fogColor,dZ,n,s);const o=_e(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-AC(vUe*Hf,bUe*Hf,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};h([f({constructOnly:!0})],F_.prototype,"context",void 0),h([f({constructOnly:!0})],F_.prototype,"view",void 0),h([f({constructOnly:!0})],F_.prototype,"rctx",void 0),h([f({constructOnly:!0})],F_.prototype,"viewingMode",void 0),F_=h([k("esri.views.3d.environment.Fog")],F_);let wUe=class{constructor(){this.color=E(),this.strength=0,this.amount=0}};const hZ=E(),dZ=E();var L;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.CompositeColor=9]="CompositeColor",t[t.COUNT=10]="COUNT"})(L||(L={}));function PG({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(b`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(b`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let zfe=class extends qi{constructor(e,r){super(e,"mat4",gr.Draw,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};function sd(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",Mn):t.uniforms.add(new Cc("cameraPosition",(r,i)=>se(Vfe,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function Rl(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new Li("proj",(i,s)=>s.camera.projectionMatrix),new zfe("view",(i,s)=>Ya(pZ,s.camera.viewMatrix,i.origin)),new Cc("localOrigin",i=>i.origin));const r=i=>se(Vfe,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new Li("proj",(i,s)=>s.camera.projectionMatrix),new Li("view",(i,s)=>Ya(pZ,s.camera.viewMatrix,r(s))),new Pt("localOrigin",(i,s)=>r(s)))}const pZ=ge(),Vfe=E();function e2(t){t.uniforms.add(new Li("viewNormal",(e,r)=>r.camera.viewInverseTransposeMatrix))}function N2(t){t.uniforms.add(new Ee("pixelRatio",(e,r)=>r.camera.pixelRatio/r.overlayStretch))}let fd=class extends qi{constructor(e,r){super(e,"mat3",gr.Pass,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}};function fk(t,e,r){for(let i=0;i<r;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function xUe(t,e){const r=t.length;for(let i=0;i<r;++i)Bw[0]=t[i],e[i]=Bw[0];return e}function TUe(t,e){const r=t.length;for(let i=0;i<r;++i)Bw[0]=t[i],Bw[1]=t[i]-Bw[0],e[i]=Bw[1];return e}const Bw=new Float32Array(2);let mk=class extends Za{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}};h([F()],mk.prototype,"instancedDoublePrecision",void 0),h([F()],mk.prototype,"hasModelTransformation",void 0);const fZ=Fi();function Gfe(t,e){const r=e.hasModelTransformation,i=e.instancedDoublePrecision;r&&(t.vertex.uniforms.add(new Li("model",n=>n.modelTransformation??$i)),t.vertex.uniforms.add(new fd("normalLocalOriginFromModel",n=>(wm(fZ,n.modelTransformation??$i),fZ)))),e.instanced&&i&&(t.attributes.add(R.INSTANCEMODELORIGINHI,"vec3"),t.attributes.add(R.INSTANCEMODELORIGINLO,"vec3"),t.attributes.add(R.INSTANCEMODEL,"mat3"),t.attributes.add(R.INSTANCEMODELNORMAL,"mat3"));const s=t.vertex;i&&(s.include(PG,e),s.uniforms.add(new Cc("viewOriginHi",(n,o)=>xUe(se(AR,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),AR)),new Cc("viewOriginLo",(n,o)=>TUe(se(AR,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),AR)))),s.code.add(b`
    vec3 getVertexInLocalOriginSpace() {
      return ${r?i?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":i?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${i?b`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),s.code.add(b`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${r?i?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":i?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),e.output===L.Normal&&(e2(s),s.code.add(b`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${r?i?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":i?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),e.hasVertexTangents&&s.code.add(b`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${r?i?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":i?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const AR=E();let ga=class extends mk{};h([F({constValue:!0})],ga.prototype,"hasSliceHighlight",void 0),h([F({constValue:!1})],ga.prototype,"hasSliceInVertexProgram",void 0),h([F({constValue:gr.Pass})],ga.prototype,"pbrTextureBindType",void 0);var Vp;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(Vp||(Vp={}));let MG=class extends ga{constructor(){super(...arguments),this.geometry=Vp.Cone}};h([F({count:Vp.COUNT})],MG.prototype,"geometry",void 0);function Y3(t){t.attributes.add(R.POSITION,"vec3"),t.vertex.code.add(b`vec3 positionModel() { return position; }`)}function lx(t,e){t.include(Y3);const r=t.vertex;r.include(PG,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),r.uniforms.add(new Pt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new Pt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new fd("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new Li("transformProjFromView",i=>i.transformProjFromView),new qC("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Cc("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Cc("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)),r.code.add(b`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(b`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?b`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:b`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new Pt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(b`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(b`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let jfe=class extends Vr{constructor(){super(...arguments),this.transformWorldFromViewTH=E(),this.transformWorldFromViewTL=E(),this.transformViewFromCameraRelativeRS=Fi(),this.transformProjFromView=ge()}},Hfe=class extends Vr{constructor(){super(...arguments),this.transformWorldFromModelRS=Fi(),this.transformWorldFromModelTH=E(),this.transformWorldFromModelTL=E()}};function Q0(t){t.varyings.add("linearDepth","float")}function lv(t){t.vertex.uniforms.add(new Ir("nearFar",(e,r)=>r.camera.nearFar))}function KD(t){t.vertex.code.add(b`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function F2(t,e){const{vertex:r}=t;switch(e.output){case L.Color:if(e.receiveShadows)return Q0(t),void r.code.add(b`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case L.Depth:case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:return t.include(lx,e),Q0(t),lv(t),KD(t),void r.code.add(b`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(b`void forwardLinearDepth() {}`)}function qa(t){KD(t),t.vertex.code.add(b`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(b`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let $G=class extends Vr{constructor(){super(...arguments),this.texV=ke(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new qfe}},qfe=class{constructor(){this.center=E(),this.v1=E(),this.v2=E()}};function SUe(t){const e=new dr,{vertex:r,fragment:i}=e;if(Lm(r),t.geometry===Vp.Underground)e.attributes.add(R.POSITION,"vec2"),e.varyings.add("color","vec4"),r.uniforms.add(new Pt("cameraPosition",(s,n)=>n.camera.eye),new Ee("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),r.code.add(b`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(b`void main() {
fragColor = color;
}`);else{e.include(qa,t),e.attributes.add(R.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===Vp.Cylinder;r.uniforms.add(new Li("proj",(a,l)=>l.camera.projectionMatrix),new Li("view",(a,l)=>l.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),r.uniforms.add(new Pt("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new Pt("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new Pt("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new Ir("texV",a=>a.texV)),r.uniforms.add(new Ee("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;r.code.add(b`
		void main(void) {
      ${s?b`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:b`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${b.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${b.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new Ze("tex",a=>a.texture)),s||i.uniforms.add(new Ee("altitudeFade",a=>a.altitudeFade)),i.code.add(b`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?b`fragColor = atmosphereColor;`:b`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const EUe=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:qfe,SimpleAtmospherePassParameters:$G,build:SUe},Symbol.toStringTag,{value:"Module"}));let vI=class Wfe extends Sr{initializeProgram(e){return new vr(e.rctx,Wfe.shader.get().build(this.configuration),hr)}initializePipeline(){return this.configuration.geometry===Vp.Cylinder?Et({blending:Jn(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),culling:_G,depthTest:{func:Ar.LEQUAL},colorWrite:Ut}):Et({blending:Jn(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ar.LEQUAL},colorWrite:Ut})}};vI.shader=new _r(EUe,()=>he(()=>import("./SimpleAtmosphere.glsl-ad51a6b3.js"),[],import.meta.url));const CUe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Ul(t,e=0){const r=t.stride;return Array.from(t.fields.keys()).map(i=>{const s=t.fields.get(i),n=s.constructor.ElementCount,o=AUe(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new Zn(i,n,o,a,r,l,e)})}function AUe(t){const e=RUe[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const RUe={u8:Xe.UNSIGNED_BYTE,u16:Xe.UNSIGNED_SHORT,u32:Xe.UNSIGNED_INT,i8:Xe.BYTE,i16:Xe.SHORT,i32:Xe.INT,f32:Xe.FLOAT};let IG=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};IG.ElementCount=9;let LG=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};LG.ElementCount=16;let Nm=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,r){this.typedBuffer[e*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}};Nm.ElementCount=1;let Fm=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,ir(r,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e]=r[1]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Fm.ElementCount=2;let Um=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,se(r,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e]=r[2]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=s}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Um.ElementCount=3;let km=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,Si(r,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e++]=r[2],this.typedBuffer[e]=r[3]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};km.ElementCount=4;let eN=class Yfe extends Nm{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}static fromTypedArray(e,r){return new Yfe(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};eN.ElementType="f32";let Mv=class gk extends Fm{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(gk,e,r)}static fromTypedArray(e,r){return new gk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Mv.ElementType="f32";let cn=class yk extends Um{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(yk,e,r)}static fromTypedArray(e,r){return new yk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};cn.ElementType="f32";let nd=class _k extends km{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(_k,e,r)}static fromTypedArray(e,r){return new _k(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};nd.ElementType="f32";let K0=class vk extends IG{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(vk,e,r)}static fromTypedArray(e,r){return new vk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};K0.ElementType="f32";let DG=class bk extends IG{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(bk,e,r)}static fromTypedArray(e,r){return new bk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};DG.ElementType="f64";let NG=class wk extends LG{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(wk,e,r)}static fromTypedArray(e,r){return new wk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};NG.ElementType="f32";let YC=class xk extends LG{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(xk,e,r)}static fromTypedArray(e,r){return new xk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};YC.ElementType="f64";let FG=class Tk extends Nm{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Tk,e,r)}static fromTypedArray(e,r){return new Tk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};FG.ElementType="f64";let UG=class Sk extends Fm{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Sk,e,r)}static fromTypedArray(e,r){return new Sk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};UG.ElementType="f64";let Uu=class Ek extends Um{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Ek,e,r)}static fromTypedArray(e,r){return new Ek(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Uu.ElementType="f64";let tN=class Ck extends km{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Ck,e,r)}static fromTypedArray(e,r){return new Ck(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};tN.ElementType="f64";let t2=class Ak extends Nm{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(Ak,e,r)}static fromTypedArray(e,r){return new Ak(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};t2.ElementType="u8";let rN=class Rk extends Fm{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(Rk,e,r)}static fromTypedArray(e,r){return new Rk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};rN.ElementType="u8";let iN=class Ok extends Um{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(Ok,e,r)}static fromTypedArray(e,r){return new Ok(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};iN.ElementType="u8";let jo=class Pk extends km{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(Pk,e,r)}static fromTypedArray(e,r){return new Pk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};jo.ElementType="u8";let sN=class Mk extends Nm{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(Mk,e,r)}static fromTypedArray(e,r){return new Mk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};sN.ElementType="u16";let kG=class $k extends Fm{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer($k,e,r)}static fromTypedArray(e,r){return new $k(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};kG.ElementType="u16";let nN=class Ik extends Um{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(Ik,e,r)}static fromTypedArray(e,r){return new Ik(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};nN.ElementType="u16";let X3=class Lk extends km{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(Lk,e,r)}static fromTypedArray(e,r){return new Lk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};X3.ElementType="u16";let oN=class Dk extends Nm{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(Dk,e,r)}static fromTypedArray(e,r){return new Dk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};oN.ElementType="u32";let BG=class Nk extends Fm{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(Nk,e,r)}static fromTypedArray(e,r){return new Nk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};BG.ElementType="u32";let Xfe=class Fk extends Um{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(Fk,e,r)}static fromTypedArray(e,r){return new Fk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Xfe.ElementType="u32";let Zfe=class Uk extends km{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(Uk,e,r)}static fromTypedArray(e,r){return new Uk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Zfe.ElementType="u32";let zG=class kk extends Nm{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(kk,e,r)}static fromTypedArray(e,r){return new kk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};zG.ElementType="i8";let aN=class Bk extends Fm{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(Bk,e,r)}static fromTypedArray(e,r){return new Bk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};aN.ElementType="i8";let Jfe=class zk extends Um{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(zk,e,r)}static fromTypedArray(e,r){return new zk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Jfe.ElementType="i8";let Qfe=class Vk extends km{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(Vk,e,r)}static fromTypedArray(e,r){return new Vk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Qfe.ElementType="i8";let Kfe=class Gk extends Nm{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(Gk,e,r)}static fromTypedArray(e,r){return new Gk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Kfe.ElementType="i16";let Z3=class jk extends Fm{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(jk,e,r)}static fromTypedArray(e,r){return new jk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Z3.ElementType="i16";let eme=class Hk extends Um{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(Hk,e,r)}static fromTypedArray(e,r){return new Hk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};eme.ElementType="i16";let tme=class qk extends km{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(qk,e,r)}static fromTypedArray(e,r){return new qk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};tme.ElementType="i16";let rme=class Wk extends Nm{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(Wk,e,r)}static fromTypedArray(e,r){return new Wk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};rme.ElementType="i32";let ime=class Yk extends Fm{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(Yk,e,r)}static fromTypedArray(e,r){return new Yk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ime.ElementType="i32";let sme=class Xk extends Um{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(Xk,e,r)}static fromTypedArray(e,r){return new Xk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};sme.ElementType="i32";let nme=class Zk extends km{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(Zk,e,r)}static fromTypedArray(e,r){return new Zk(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};nme.ElementType="i32";function mZ(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let gZ=class ome{constructor(e,r){this.layout=e,this.buffer=typeof r=="number"?new ArrayBuffer(r*e.stride):r;for(const i of e.fields.keys()){const s=e.fields.get(i);this[i]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,r){const i=this[e];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(e,r){return new ome(this.layout,this.buffer.slice(e*this.stride,r*this.stride))}copyFrom(e,r=0,i=0,s=e.count){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,r*n,s*n/4);new Uint32Array(this.buffer,i*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,r*n,s*n);new Uint8Array(this.buffer,i*n,s*n).set(o)}return this}get usedMemory(){return this.byteLength}dispose(){}},ame=class lme{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(r=>this._fields.set(r[0],{...r[1],constructor:MUe(r[1].constructor)})))}vec2f(e,r){return this._appendField(e,Mv,r),this}vec2f64(e,r){return this._appendField(e,UG,r),this}vec3f(e,r){return this._appendField(e,cn,r),this}vec3f64(e,r){return this._appendField(e,Uu,r),this}vec4f(e,r){return this._appendField(e,nd,r),this}vec4f64(e,r){return this._appendField(e,tN,r),this}mat3f(e,r){return this._appendField(e,K0,r),this}mat3f64(e,r){return this._appendField(e,DG,r),this}mat4f(e,r){return this._appendField(e,NG,r),this}mat4f64(e,r){return this._appendField(e,YC,r),this}vec4u8(e,r){return this._appendField(e,jo,r),this}f32(e,r){return this._appendField(e,eN,r),this}f64(e,r){return this._appendField(e,FG,r),this}u8(e,r){return this._appendField(e,t2,r),this}u16(e,r){return this._appendField(e,sN,r),this}i8(e,r){return this._appendField(e,zG,r),this}vec2i8(e,r){return this._appendField(e,aN,r),this}vec2i16(e,r){return this._appendField(e,Z3,r),this}vec2u8(e,r){return this._appendField(e,rN,r),this}vec4u16(e,r){return this._appendField(e,X3,r),this}u32(e,r){return this._appendField(e,oN,r),this}_appendField(e,r,i){if(this._fields.has(e))return void Je(!1,`${e} already added to vertex buffer layout`);const s=r.ElementCount*mZ(r.ElementType),n=this._stride;this._stride+=s,this._fields.set(e,{size:s,constructor:r,offset:n,optional:i})}createBuffer(e){return new gZ(this,e)}createView(e){return new gZ(this,e)}clone(){const e=new lme;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((r,i)=>e._fields.set(i,r)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(r=>e=Math.max(e,mZ(r.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function Ci(){return new ame}let OUe=class{constructor(e){this.fields=new Array,e.fields.forEach((r,i)=>{const s={...r,constructor:cme(r.constructor)};this.fields.push([i,s])}),this.stride=e.stride}};const PUe=[eN,Mv,cn,nd,K0,NG,FG,UG,Uu,tN,DG,YC,t2,rN,iN,jo,sN,kG,nN,X3,oN,BG,Xfe,Zfe,zG,aN,Jfe,Qfe,Kfe,Z3,eme,tme,rme,ime,sme,nme];function cme(t){return`${t.ElementType}_${t.ElementCount}`}function MUe(t){return ume.get(t)}const ume=new Map;PUe.forEach(t=>ume.set(cme(t),t));function Pn(t,e=!1){return t<=Oc?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function hme(t){return(Cu(t)?t.length:t.byteLength/8)<=Oc?Array.from(t):new Float64Array(t)}function Tu(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function $Ue(t,e){for(let r=0;r<e.length;++r)t[r]=e[r];return t}function lvt(t){return Array.isArray(t)?new Float64Array(t):t}function Gi(t,e=!1){return t<=Oc?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function cvt(t){return Cu(t)?t.length<Oc?t:new Float32Array(t):t.length<Oc?Array.from(t):t}function yZ(t){return(Cu(t)?t.length:t.byteLength/8)<=Oc?Array.from(t):new Float32Array(t)}function bI(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function Pp(t){if(Cu(t)){if(t.length<Oc)return t}else if(t.length<Oc)return Array.from(t);let e=!0,r=!0;return t.some((i,s)=>(e=e&&i===0,r=r&&i===s,!e&&!r)),e?gy(t.length):r?$v(t.length):Cu(t)||t.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?IUe(t):t}function IUe(t){let e=!0;for(const r of t){if(r>=65536)return Cu(t)?new Uint32Array(t):t;r>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function wI(t){return t<=Oc?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function LUe(t){return t<=Oc?new Array(t):new Uint32Array(t)}let ib=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const dme=[0],o5=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function $v(t){if(t===1)return dme;if(t<Oc)return Array.from(new Uint16Array(o5.buffer,0,t));if(t<o5.length)return new Uint16Array(o5.buffer,0,t);if(t>ib.length){const e=Math.max(2*ib.length,t);ib=new Uint32Array(e);for(let r=0;r<ib.length;r++)ib[r]=r}return new Uint32Array(ib.buffer,0,t)}let RR=new Uint8Array(65536);function gy(t){if(t===1)return dme;if(t<Oc)return new Array(t).fill(0);if(t>RR.length){const e=Math.max(2*RR.length,t);RR=new Uint8Array(e)}return new Uint8Array(RR.buffer,0,t)}var Jk;(function(t){function e(o,a){const l=o[a],c=o[a+1],u=o[a+2];return Math.sqrt(l*l+c*c+u*u)}function r(o,a){const l=o[a],c=o[a+1],u=o[a+2],d=1/Math.sqrt(l*l+c*c+u*u);o[a]*=d,o[a+1]*=d,o[a+2]*=d}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]+l[c],u[d+1]=o[a+1]+l[c+1],u[d+2]=o[a+2]+l[c+2]}function n(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]-l[c],u[d+1]=o[a+1]-l[c+1],u[d+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=r,t.scale=i,t.add=s,t.subtract=n})(Jk||(Jk={}));var Ki;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(Ki||(Ki={}));function DUe(t){if(t.length<Oc)return Array.from(t);if(Cu(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return ML(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let pme=class fme{constructor(e,r,i){this.primitiveIndices=e,this._numIndexPerPrimitive=r,this.position=i,this._children=void 0,Je(e.length>=1),Je(i.size===3||i.size===4);const{data:s,size:n,indices:o}=i;Je(o.length%this._numIndexPerPrimitive==0),Je(o.length>=e.length*this._numIndexPerPrimitive);const a=e.length;let l=n*o[this._numIndexPerPrimitive*e[0]];$y.clear(),$y.push(l);const c=Te(s[l],s[l+1],s[l+2]),u=Ii(c);for(let g=0;g<a;++g){const y=this._numIndexPerPrimitive*e[g];for(let _=0;_<this._numIndexPerPrimitive;++_){l=n*o[y+_],$y.push(l);let v=s[l];c[0]=Math.min(v,c[0]),u[0]=Math.max(v,u[0]),v=s[l+1],c[1]=Math.min(v,c[1]),u[1]=Math.max(v,u[1]),v=s[l+2],c[2]=Math.min(v,c[2]),u[2]=Math.max(v,u[2])}}this.bbMin=c,this.bbMax=u;const d=$r(E(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(u[0]-c[0],u[1]-c[1]),u[2]-c[2]);let p=this.radius*this.radius;for(let g=0;g<$y.length;++g){l=$y.at(g);const y=s[l]-d[0],_=s[l+1]-d[1],v=s[l+2]-d[2],w=y*y+_*_+v*v;if(w<=p)continue;const x=Math.sqrt(w),T=.5*(x-this.radius);this.radius=this.radius+T,p=this.radius*this.radius;const S=T/x;d[0]+=y*S,d[1]+=_*S,d[2]+=v*S}this.center=d,$y.clear()}getChildren(){if(this._children||Yn(this.bbMin,this.bbMax)<=1)return this._children;const e=$r(E(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),s=new Array(8);for(let u=0;u<8;++u)s[u]=0;const{data:n,size:o,indices:a}=this.position;for(let u=0;u<r;++u){let d=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[u];let g=o*a[p],y=n[g],_=n[g+1],v=n[g+2];for(let w=1;w<this._numIndexPerPrimitive;++w){g=o*a[p+w];const x=n[g],T=n[g+1],S=n[g+2];x<y&&(y=x),T<_&&(_=T),S<v&&(v=S)}y<e[0]&&(d|=1),_<e[1]&&(d|=2),v<e[2]&&(d|=4),i[u]=d,++s[d]}let l=0;for(let u=0;u<8;++u)s[u]>0&&++l;if(l<2)return;const c=new Array(8);for(let u=0;u<8;++u)c[u]=s[u]>0?new Uint32Array(s[u]):void 0;for(let u=0;u<8;++u)s[u]=0;for(let u=0;u<r;++u){const d=i[u];c[d][s[d]++]=this.primitiveIndices[u]}this._children=new Array;for(let u=0;u<8;++u)c[u]!==void 0&&this._children.push(new fme(c[u],this._numIndexPerPrimitive,this.position));return this._children}static prune(){$y.prune()}};const $y=new It({deallocator:null});let J3=class{constructor(){this.id=bc()}};function NUe(t){return t?{p0:Ii(t.p0),p1:Ii(t.p1),p2:Ii(t.p2)}:{p0:E(),p1:E(),p2:E()}}function _Z(t,e,r){const i=e[0]-t[0],s=e[1]-t[1],n=r[0]-t[0],o=r[1]-t[1];return .5*Math.abs(i*o-s*n)}function FUe(t,e,r){return ce(a5,e,t),ce(vZ,r,t),_e(rt(a5,a5,vZ))/2}new Mm(ud);new Mm(()=>NUe());const a5=E(),vZ=E();function UUe(t,e){if(!t)return!1;const{size:r,data:i,indices:s}=t;se(e,0,0,0),se(ou,0,0,0);let n=0,o=0;for(let a=0;a<s.length-2;a+=3){const l=s[a]*r,c=s[a+1]*r,u=s[a+2]*r;se(Sn,i[l],i[l+1],i[l+2]),se(Xf,i[c],i[c+1],i[c+2]),se(OR,i[u],i[u+1],i[u+2]);const d=FUe(Sn,Xf,OR);d?(le(Sn,Sn,Xf),le(Sn,Sn,OR),ee(Sn,Sn,1/3*d),le(e,e,Sn),n+=d):(le(ou,ou,Sn),le(ou,ou,Xf),le(ou,ou,OR),o+=3)}return(o!==0||n!==0)&&(n!==0?(ee(e,e,1/n),!0):o!==0&&(ee(e,ou,1/o),!0))}function kUe(t,e){if(!t)return!1;const{size:r,data:i,indices:s}=t;se(e,0,0,0);let n=-1,o=0;for(let a=0;a<s.length;a++){const l=s[a]*r;n!==l&&(e[0]+=i[l],e[1]+=i[l+1],e[2]+=i[l+2],o++),n=l}return o>1&&ee(e,e,1/o),o>0}function BUe(t,e,r){if(!t)return!1;se(r,0,0,0),se(ou,0,0,0);let i=0,s=0;const{size:n,data:o,indices:a}=t,l=a.length-1,c=l+(e?2:0);for(let u=0;u<c;u+=2){const d=u<l?u+1:0,p=a[u<l?u:l]*n,g=a[d]*n;Sn[0]=o[p],Sn[1]=o[p+1],Sn[2]=o[p+2],Xf[0]=o[g],Xf[1]=o[g+1],Xf[2]=o[g+2],ee(Sn,le(Sn,Sn,Xf),.5);const y=R3(Sn,Xf);y>0?(le(r,r,ee(Sn,Sn,y)),i+=y):i===0&&(le(ou,ou,Sn),s++)}return i!==0?(ee(r,r,1/i),!0):s!==0&&(ee(r,ou,1/s),!0)}const Sn=E(),Xf=E(),OR=E(),ou=E();let xI=class{constructor(e){this.channel=e,this.id=bc()}};function Qk(t,e){return t==null&&(t=[]),t.push(e),t}function Kk(t,e){if(t==null)return null;const r=t.filter(i=>i!==e);return r.length===0?null:r}function zUe(t,e,r,i,s){PR[0]=t.get(e,0),PR[1]=t.get(e,1),PR[2]=t.get(e,2),fk(PR,Iy,3),r.set(s,0,Iy[0]),i.set(s,0,Iy[1]),r.set(s,1,Iy[2]),i.set(s,1,Iy[3]),r.set(s,2,Iy[4]),i.set(s,2,Iy[5])}const PR=E(),Iy=new Float32Array(6);let Ds=class mme extends J3{constructor(e,r,i=null,s=Ki.Mesh,n=null,o=-1){super(),this.material=e,this.mapPositions=i,this.type=s,this.objectAndLayerIdColor=n,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,l]of r)this._attributes.set(a,{...l,indices:Pp(l.indices)}),a===R.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(e={}){const r=new mme(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((i,s)=>{i.exclusive=!1,r._attributes.set(s,i)}),r._boundingInfo=this._boundingInfo,r.transformation=e.transformation||this.transformation,r}get attributes(){return this._attributes}getMutableAttribute(e){let r=this._attributes.get(e);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:DUe(r.data)},this._attributes.set(e,r)),r}setAttributeData(e,r){const i=this._attributes.get(e);i&&this._attributes.set(e,{...i,exclusive:!0,data:r})}get indexCount(){const e=this._attributes.values().next().value.indices;return(e==null?void 0:e.length)??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===Ki.Mesh?this._computeAttachmentOriginTriangles(e):this.type===Ki.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&De(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const r=this.attributes.get(R.POSITION);return UUe(r,e)}_computeAttachmentOriginLines(e){const r=this.attributes.get(R.POSITION);return BUe(r,VUe(this.material.parameters,r),e)}_computeAttachmentOriginPoints(e){const r=this.attributes.get(R.POSITION);return kUe(r,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(R.POSITION);if(!e||e.indices.length===0)return null;const r=this.type===Ki.Mesh?3:1;Je(e.indices.length%r==0,"Indexing error: "+e.indices.length+" not divisible by "+r);const i=$v(e.indices.length/r);return new pme(i,r,e)}get transformation(){return this._transformation??$i}set transformation(e){this._transformation=e&&e!==$i?Vx(e):null}addHighlight(){const e=new xI(Tm.Highlight);return this.highlights=Qk(this.highlights,e),e}removeHighlight(e){this.highlights=Kk(this.highlights,e)}};function VUe(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}const sb=Jk,l5=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],GUe=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],jUe=[0,0,1,0,1,1,0,1],HUe=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],gme=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)gme[6*t+e]=t;const U_=new Array(36);for(let t=0;t<6;t++)U_[6*t]=0,U_[6*t+1]=1,U_[6*t+2]=2,U_[6*t+3]=2,U_[6*t+4]=3,U_[6*t+5]=0;function qUe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=l5[i][0]*e[0],r[3*i+1]=l5[i][1]*e[1],r[3*i+2]=l5[i][2]*e[2];return new Ds(t,[[R.POSITION,new Ue(r,HUe,3,!0)],[R.NORMAL,new Ue(GUe,gme,3)],[R.UV0,new Ue(jUe,U_,2)]])}const c5=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],WUe=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],YUe=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],XUe=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function ZUe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=c5[i][0]*e[0],r[3*i+1]=c5[i][1]*e[1],r[3*i+2]=c5[i][2]*e[2];return new Ds(t,[[R.POSITION,new Ue(r,YUe,3,!0)],[R.NORMAL,new Ue(WUe,XUe,3)]])}const bM=Nr(-.5,0,-.5),wM=Nr(.5,0,-.5),xM=Nr(0,0,.5),TM=Nr(0,.5,0),nb=os(),ob=os(),cx=os(),ux=os(),hx=os();ce(nb,bM,TM),ce(ob,bM,wM),rt(cx,nb,ob),pe(cx,cx),ce(nb,wM,TM),ce(ob,wM,xM),rt(ux,nb,ob),pe(ux,ux),ce(nb,xM,TM),ce(ob,xM,bM),rt(hx,nb,ob),pe(hx,hx);const u5=[bM,wM,xM,TM],JUe=[0,-1,0,cx[0],cx[1],cx[2],ux[0],ux[1],ux[2],hx[0],hx[1],hx[2]],QUe=[0,1,2,3,1,0,3,2,1,3,0,2],KUe=[0,0,0,1,1,1,2,2,2,3,3,3];function e9e(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=u5[i][0]*e[0],r[3*i+1]=u5[i][1]*e[1],r[3*i+2]=u5[i][2]*e[2];return new Ds(t,[[R.POSITION,new Ue(r,QUe,3,!0)],[R.NORMAL,new Ue(JUe,KUe,3)]])}function dvt(t,e,r,i,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),u=Math.max(2,Math.floor(i)),d=(c+1)*(u+1),p=Gi(3*d),g=Gi(3*d),y=Gi(2*d),_=[];let v=0;for(let T=0;T<=u;T++){const S=[],C=T/u,A=a+C*l,O=Math.cos(A);for(let $=0;$<=c;$++){const D=$/c,N=n+D*o,z=Math.cos(N)*O,U=Math.sin(A),Y=-Math.sin(N)*O;p[3*v]=z*e,p[3*v+1]=U*e,p[3*v+2]=Y*e,g[3*v]=z,g[3*v+1]=U,g[3*v+2]=Y,y[2*v]=D,y[2*v+1]=C,S.push(v),++v}_.push(S)}const w=new Array;for(let T=0;T<u;T++)for(let S=0;S<c;S++){const C=_[T][S],A=_[T][S+1],O=_[T+1][S+1],$=_[T+1][S];T===0?(w.push(C),w.push(O),w.push($)):T===u-1?(w.push(C),w.push(A),w.push(O)):(w.push(C),w.push(A),w.push(O),w.push(O),w.push($),w.push(C))}const x=[[R.POSITION,new Ue(p,w,3,!0)],[R.NORMAL,new Ue(g,w,3,!0)]];return s.uv&&x.push([R.UV0,new Ue(y,w,2,!0)]),s.offset&&(x[0][0]=R.OFFSET,x.push([R.POSITION,new Ue(Float64Array.from(s.offset),gy(w.length),3,!0)])),new Ds(t,x)}function t9e(t,e,r,i){const s=yme(e,r,i);return new Ds(t,s)}function yme(t,e,r){const i=t;let s,n;if(r)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const c=i*(1+Math.sqrt(5))/2;s=[-i,c,0,i,c,0,-i,-c,0,i,-c,0,0,-i,c,0,i,c,0,-i,-c,0,i,-c,c,0,-i,c,0,i,-c,0,-i,-c,0,i],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<s.length;c+=3)sb.scale(s,c,t/sb.length(s,c));let o={};function a(c,u){c>u&&([c,u]=[u,c]);const d=c.toString()+"."+u.toString();if(o[d])return o[d];let p=s.length;return s.length+=3,sb.add(s,3*c,s,3*u,s,p),sb.scale(s,p,t/sb.length(s,p)),p/=3,o[d]=p,p}for(let c=0;c<e;c++){const u=n.length,d=new Array(4*u);for(let p=0;p<u;p+=3){const g=n[p],y=n[p+1],_=n[p+2],v=a(g,y),w=a(y,_),x=a(_,g),T=4*p;d[T]=g,d[T+1]=v,d[T+2]=x,d[T+3]=y,d[T+4]=w,d[T+5]=v,d[T+6]=_,d[T+7]=x,d[T+8]=w,d[T+9]=v,d[T+10]=w,d[T+11]=x}n=d,o={}}const l=yZ(s);for(let c=0;c<l.length;c+=3)sb.normalize(l,c);return[[R.POSITION,new Ue(yZ(s),n,3,!0)],[R.NORMAL,new Ue(l,n,3,!0)]]}function eB(t,e,r,i,s,n,o,a,l=null){const c=r?[r[0],r[1],r[2]]:[0,0,0],u=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const d=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],p=s!=null&&s.length===2?s:[1,1],g=gy(1),y=[[R.POSITION,new Ue(c,g,3,!0)],[R.NORMAL,new Ue(u,g,3,!0)],[R.UV0,new Ue(o,g,o.length)],[R.COLOR,new Ue(d,g,4,!0)],[R.SIZE,new Ue(p,g,2)]];if(n!=null){const _=[n[0],n[1],n[2],n[3]];y.push([R.AUXPOS1,new Ue(_,g,4)])}if(a!=null){const _=[a[0],a[1],a[2],a[3]];y.push([R.FEATUREATTRIBUTE,new Ue(_,g,4)])}return new Ds(t,y,null,Ki.Point,l)}const r9e=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function pvt(t,e=r9e){const r=new Array(12);for(let c=0;c<4;c++)for(let u=0;u<3;u++)r[3*c+u]=e[c][u];const i=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[R.POSITION,new Ue(r,i,3,!0)],[R.NORMAL,new Ue(s,n,3,!0)],[R.UV0,new Ue(o,i,2,!0)],[R.COLOR,new Ue(a,n,4,!0)]];return new Ds(t,l)}function bZ(t,e,r,i,s,n=!0,o=!0){let a=0;const l=r,c=e;let u=Nr(0,a,0),d=Nr(0,a+c,0),p=Nr(0,-1,0),g=Nr(0,1,0);s&&(a=c,d=Nr(0,0,0),u=Nr(0,a,0),p=Nr(0,1,0),g=Nr(0,-1,0));const y=[d,u],_=[p,g],v=i+2,w=Math.sqrt(c*c+l*l);if(s)for(let O=i-1;O>=0;O--){const $=O*(2*Math.PI/i),D=Nr(Math.cos($)*l,a,Math.sin($)*l);y.push(D);const N=Nr(c*Math.cos($)/w,-l/w,c*Math.sin($)/w);_.push(N)}else for(let O=0;O<i;O++){const $=O*(2*Math.PI/i),D=Nr(Math.cos($)*l,a,Math.sin($)*l);y.push(D);const N=Nr(c*Math.cos($)/w,l/w,c*Math.sin($)/w);_.push(N)}const x=new Array,T=new Array;if(n){for(let O=3;O<y.length;O++)x.push(1),x.push(O-1),x.push(O),T.push(0),T.push(0),T.push(0);x.push(y.length-1),x.push(2),x.push(1),T.push(0),T.push(0),T.push(0)}if(o){for(let O=3;O<y.length;O++)x.push(O),x.push(O-1),x.push(0),T.push(O),T.push(O-1),T.push(1);x.push(0),x.push(2),x.push(y.length-1),T.push(1),T.push(2),T.push(_.length-1)}const S=Gi(3*v);for(let O=0;O<v;O++)S[3*O]=y[O][0],S[3*O+1]=y[O][1],S[3*O+2]=y[O][2];const C=Gi(3*v);for(let O=0;O<v;O++)C[3*O]=_[O][0],C[3*O+1]=_[O][1],C[3*O+2]=_[O][2];const A=[[R.POSITION,new Ue(S,x,3,!0)],[R.NORMAL,new Ue(C,T,3,!0)]];return new Ds(t,A)}function i9e(t,e,r,i,s,n,o){const a=s?ck(s):Nr(1,0,0),l=n?ck(n):Nr(0,0,0);o??(o=!0);const c=os();pe(c,a);const u=os();ee(u,c,Math.abs(e));const d=os();ee(d,u,-.5),le(d,d,l);const p=Nr(0,1,0);Math.abs(1-de(c,p))<.2&&se(p,0,0,1);const g=os();rt(g,c,p),pe(g,g),rt(p,g,c);const y=2*i+(o?2:0),_=i+(o?2:0),v=Gi(3*y),w=Gi(3*_),x=Gi(2*y),T=new Array(3*i*(o?4:2)),S=new Array(3*i*(o?4:2));o&&(v[3*(y-2)]=d[0],v[3*(y-2)+1]=d[1],v[3*(y-2)+2]=d[2],x[2*(y-2)]=0,x[2*(y-2)+1]=0,v[3*(y-1)]=v[3*(y-2)]+u[0],v[3*(y-1)+1]=v[3*(y-2)+1]+u[1],v[3*(y-1)+2]=v[3*(y-2)+2]+u[2],x[2*(y-1)]=1,x[2*(y-1)+1]=1,w[3*(_-2)]=-c[0],w[3*(_-2)+1]=-c[1],w[3*(_-2)+2]=-c[2],w[3*(_-1)]=c[0],w[3*(_-1)+1]=c[1],w[3*(_-1)+2]=c[2]);const C=(N,z,U)=>{T[N]=z,S[N]=U};let A=0;const O=os(),$=os();for(let N=0;N<i;N++){const z=N*(2*Math.PI/i);ee(O,p,Math.sin(z)),ee($,g,Math.cos(z)),le(O,O,$),w[3*N]=O[0],w[3*N+1]=O[1],w[3*N+2]=O[2],ee(O,O,r),le(O,O,d),v[3*N]=O[0],v[3*N+1]=O[1],v[3*N+2]=O[2],x[2*N]=N/i,x[2*N+1]=0,v[3*(N+i)]=v[3*N]+u[0],v[3*(N+i)+1]=v[3*N+1]+u[1],v[3*(N+i)+2]=v[3*N+2]+u[2],x[2*(N+i)]=N/i,x[2*N+1]=1;const U=(N+1)%i;C(A++,N,N),C(A++,N+i,N),C(A++,U,U),C(A++,U,U),C(A++,N+i,N),C(A++,U+i,U)}if(o){for(let N=0;N<i;N++){const z=(N+1)%i;C(A++,y-2,_-2),C(A++,N,_-2),C(A++,z,_-2)}for(let N=0;N<i;N++){const z=(N+1)%i;C(A++,N+i,_-1),C(A++,y-1,_-1),C(A++,z+i,_-1)}}const D=[[R.POSITION,new Ue(v,T,3,!0)],[R.NORMAL,new Ue(w,S,3,!0)],[R.UV0,new Ue(x,T,2,!0)]];return new Ds(t,D)}function fvt(t,e,r,i,s,n,o=Nr(0,0,0)){const a=e.length,l=Gi(r.length*a*3+(6*i.length||0)),c=Gi(r.length*a*3+(i?6:0)),u=new Array,d=new Array;let p=0,g=0;const y=os(),_=os(),v=os(),w=os(),x=os(),T=os(),S=os(),C=E(),A=os(),O=os(),$=os(),D=os(),N=os(),z=wr();se(A,0,1,0),ce(_,r[1],r[0]),pe(_,_),n?(le(C,r[0],o),pe(v,C)):se(v,0,0,1),TI(_,v,A,A,x,v,wZ),ie(w,v),ie(D,x);for(let I=0;I<i.length;I++)ee(T,x,i[I][0]),ee(C,v,i[I][2]),le(T,T,C),le(T,T,r[0]),l[p++]=T[0],l[p++]=T[1],l[p++]=T[2];c[g++]=-_[0],c[g++]=-_[1],c[g++]=-_[2];for(let I=0;I<s.length;I++)u.push(s[I][0]>0?s[I][0]:-s[I][0]-1+i.length),u.push(s[I][1]>0?s[I][1]:-s[I][1]-1+i.length),u.push(s[I][2]>0?s[I][2]:-s[I][2]-1+i.length),d.push(0),d.push(0),d.push(0);let U=i.length;const Y=i.length-1;for(let I=0;I<r.length;I++){let B=!1;I>0&&(ie(y,_),I<r.length-1?(ce(_,r[I+1],r[I]),pe(_,_)):B=!0,le(O,y,_),pe(O,O),le($,r[I-1],w),G3(r[I],O,z),Cv(z,$c($,y),C)?(ce(C,C,r[I]),pe(v,C),rt(x,O,v),pe(x,x)):TI(O,w,D,A,x,v,wZ),ie(w,v),ie(D,x)),n&&(le(C,r[I],o),pe(N,C));for(let G=0;G<a;G++)if(ee(T,x,e[G][0]),ee(C,v,e[G][1]),le(T,T,C),pe(S,T),c[g++]=S[0],c[g++]=S[1],c[g++]=S[2],le(T,T,r[I]),l[p++]=T[0],l[p++]=T[1],l[p++]=T[2],!B){const q=(G+1)%a;u.push(U+G),u.push(U+a+G),u.push(U+q),u.push(U+q),u.push(U+a+G),u.push(U+a+q);for(let Z=0;Z<6;Z++){const K=u.length-6;d.push(u[K+Z]-Y)}}U+=a}const H=r[r.length-1];for(let I=0;I<i.length;I++)ee(T,x,i[I][0]),ee(C,v,i[I][1]),le(T,T,C),le(T,T,H),l[p++]=T[0],l[p++]=T[1],l[p++]=T[2];const V=g/3;c[g++]=_[0],c[g++]=_[1],c[g++]=_[2];const J=U-a;for(let I=0;I<s.length;I++)u.push(s[I][0]>=0?U+s[I][0]:-s[I][0]-1+J),u.push(s[I][2]>=0?U+s[I][2]:-s[I][2]-1+J),u.push(s[I][1]>=0?U+s[I][1]:-s[I][1]-1+J),d.push(V),d.push(V),d.push(V);const P=[[R.POSITION,new Ue(l,u,3,!0)],[R.NORMAL,new Ue(c,d,3,!0)]];return new Ds(t,P)}function mvt(t,e,r,i){Je(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Je(e[0].length===3,"createPolylineGeometry(): malformed vertex"),Je(r==null||r.length===e.length,"createPolylineGeometry: need same number of points and normals"),Je(r==null||r[0].length===3,"createPolylineGeometry(): malformed normal");const s=Pn(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let c=0;c<e.length;c++){for(let u=0;u<3;u++)s[o++]=e[c][u];c>0&&(n[a++]=c-1,n[a++]=c)}const l=[[R.POSITION,new Ue(s,n,3,!0)]];if(r){const c=Gi(3*r.length);let u=0;for(let d=0;d<e.length;d++)for(let p=0;p<3;p++)c[u++]=r[d][p];l.push([R.NORMAL,new Ue(c,n,3,!0)])}return i&&l.push([R.COLOR,new Ue(i,$v(i.length/4),4)]),new Ds(t,l,null,Ki.Line)}function s9e(t,e=t){const r=t.attributes,i=r.get(R.POSITION).data,s=r.get(R.NORMAL).data;if(s){const n=e.getMutableAttribute(R.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(i){const n=e.getMutableAttribute(R.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];n[o+1]=-i[o+2],n[o+2]=a}}}function h5(t,e,r,i,s){return!(Math.abs(de(e,t))>s)&&(rt(r,t,e),pe(r,r),rt(i,r,t),pe(i,i),!0)}function TI(t,e,r,i,s,n,o){return h5(t,e,s,n,o)||h5(t,r,s,n,o)||h5(t,i,s,n,o)}const wZ=.99619469809;let n9e=class{constructor(e,r){this.type=Co.Local,this._configuration=new MG,this._passParameters=new $G,this._configuration.geometry=Vp.Cylinder,this._technique=r.techniqueRepository.acquire(vI,this._configuration);const i=r.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=nm(this._vao,"geometry");const s=new Or;s.wrapMode=Ft.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Rt(i,s,CUe)}destroy(){this._passParameters.texture=Ke(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const r=e.rctx,i=r.bindTechnique(this._technique,this._passParameters,e.bindParameters);o9e(xZ,e.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",xZ),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Qt.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const r=yme(1,2,!1),{data:i,indices:s}=r[0][1],n=TZ.createBuffer(s.length),o=n.position;for(let a=0;a<s.length;++a){const l=3*s[a%3==0?a+2:a%3==2?a-2:a];o.set(a,0,i[l]),o.set(a,1,i[l+1]),o.set(a,2,i[l+2])}return new pd(e,hr,{geometry:Ul(TZ)},{geometry:Cr.createVertex(e,yr.STATIC_DRAW,n.buffer)})}};function o9e(t,e){Ss(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const xZ=ge(),TZ=Ci().vec3f(R.POSITION),a9e=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),MR=128,SZ=-K9,EZ=0,d5=50,l9e=()=>1-511/512,c9e=eM([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let u9e=class{constructor(e,r){this.view=e,this.type=Co.Mars,this._passParameters=new $G,this._vaoCount=0,this._texV1=1;const i=Mr(e.spatialReference);this._planetRadius=i.radius,this._outerRimWidth=i.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+SZ)/this._planetRadius,this._middleRimFactor=(this._planetRadius+EZ)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=EZ/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=r.techniqueRepository;const s=r.renderContext.rctx;this._cameraChangeHandle=ae(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>r.requestRender(),Br),this._vao=this._createRibbon(s),this._vaoCount=nm(this._vao,"geometry"),this._fadeVao=ef(s),this._fadeVaoCount=nm(this._fadeVao,"geometry");const n=new Or;n.wrapMode=Ft.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Rt(s,n,a9e);const o=new MG;o.geometry=Vp.Cone,this._coneTechnique=this._techniqueRepository.acquire(vI,o),o.geometry=Vp.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(vI,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=Ke(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const r=e.bindParameters.camera;this._update(r);const i=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._vao),i.drawArrays(Qt.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._fadeVao),i.drawArrays(Qt.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const r=E(),i=this._planetRadius,s=_e(e.eye),n=s-i;if(n<0){const g=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=g}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(d5,n),a=i+SZ;this._passParameters.innerScale=h9e(i+o,i,a)-1,this._passParameters.altitudeFade=yG(n),ee(r,e.eye,(i+d5)/s),CZ(r,e.center,e.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,r,e.up,this._passParameters.silhouette),c=l9e(),u=c9e(n);let d=this._texV0+c*this._texVScale,p=this._texV0+l*u*this._texVScale;if(n>d5){CZ(e.eye,e.center,e.up,i,this._passParameters.silhouette);const g=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),y=me((g-1.5)/(l-1.5),0,1);d=this._texV0+y*c*this._texVScale,p=this._texV0+ft(this._texV1,l*u,y)*this._texVScale}ir(this._passParameters.texV,d,p)}_createRibbon(e){const r=Gi(3+3*MR*3),i=new Uint32Array(3*MR*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<MR;o++){const a=9*o+3;r[a]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===MR-1?1:l+3,u=15*o;i[u]=l,i[u+1]=l+1,i[u+2]=c+1,i[u+3]=c+1,i[u+4]=c,i[u+5]=l,i[u+6]=l+1,i[u+7]=l+2,i[u+8]=c+2,i[u+9]=c+2,i[u+10]=c+1,i[u+11]=l+1,i[u+12]=l,i[u+13]=c,i[u+14]=0}const s=AZ.createBuffer(i.length),n=s.position;for(let o=0;o<i.length;++o){const a=3*i[o];n.set(o,0,r[a]),n.set(o,1,r[a+1]),n.set(o,2,r[a+2])}return new pd(e,hr,{geometry:Ul(AZ)},{geometry:Cr.createVertex(e,yr.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,r,i,s){return le(ab,s.center,s.v2),ee($R,ab,this._outerRimFactor),tD(p5,r,ab,i),PX(ab,p5,e.projectionMatrix,e.viewport,ab),PX($R,p5,e.projectionMatrix,e.viewport,$R),hi(ab,$R)/e.height}};function CZ(t,e,r,i,s){const n=_e(t),o=i*Math.sqrt(n*n-i*i)/n,a=Math.sqrt(i*i-o*o),l=s.v1,c=s.v2;return ee(s.center,t,a/n),rt(l,t,e),co(l)<1&&rt(l,t,r),ee(l,l,o/_e(l)),rt(c,l,t),ee(c,c,o/_e(c)),o}const p5=ge(),ab=E(),$R=E();function h9e(t,e,r){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-r*r)+e*r)}const AZ=Ci().vec3f(R.POSITION);var Sm;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(Sm||(Sm={}));let tB=class extends Za{constructor(){super(...arguments),this.type=Sm.Rain}};h([F({count:Sm.COUNT})],tB.prototype,"type",void 0);function d9e(t){const e=new dr;return e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Pt("cameraPosition",(r,i)=>i.camera.eye)),e.vertex.uniforms.add(new Pt("offset",(r,i)=>p9e(r,i))),e.vertex.uniforms.add(new Ee("width",r=>r.width)),e.vertex.uniforms.add(new Li("proj",(r,i)=>i.camera.projectionMatrix)),e.vertex.uniforms.add(new Li("view",(r,i)=>i.camera.viewMatrix)),e.vertex.uniforms.add(new Ee("time",r=>r.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(b`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===Sm.Rain?b`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:b`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new Ee("opacity",r=>r.opacity),new Pt("particleColor",(r,i)=>f9e(i,t))),e.fragment.code.add(b`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===Sm.Rain?b`d = 0.35 * smoothstep(0.5, 0.0, d);`:b`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function p9e(t,e){const r=e.camera.eye,i=.5*t.width,s=1/t.width,n=Uoe(rB,se(rB,(r[0]+i)*s,(r[1]+i)*s,(r[2]+i)*s));return Rn(n,r,ee(n,n,t.width))}function f9e(t,e){const r=e.type===Sm.Rain?g9e:m9e,i=ee(rB,r,y9e),s=t.camera.eye;pe(RZ,s);const n=Math.max(0,de(RZ,t.lighting.mainLight.direction));return $r(i,i,r,n)}const rB=E(),RZ=E(),m9e=Te(1,1,1),g9e=Te(.85,.85,.85),y9e=.7,_9e=Object.freeze(Object.defineProperty({__proto__:null,build:d9e},Symbol.toStringTag,{value:"Module"}));let v9e=class extends Vr{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},iB=class _me extends Sr{initializeProgram(e){return new vr(e.rctx,_me.shader.get().build(this.configuration),SM)}initializePipeline(){return Et({blending:Jn(ve.ONE,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ar.LEQUAL},colorWrite:Ut})}};iB.shader=new _r(_9e,()=>he(()=>import("./Precipitation.glsl-2a75e9bc.js"),[],import.meta.url));const SM=new Map([[R.POSITION,0],[R.INSTANCEFEATUREATTRIBUTE,1]]);let vme=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:r}){return r!=null?this._time!==r&&(this._time=r,!0):(this._time=this._time+e,e!==0)}},b9e=class{constructor(e,r){this.deltaTime=e,this.fixedTime=r}},k_=class extends xe{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new v9e,this._animation=new vme,this._updatingTracking=new Yh,this._passParameters.time=0,this._passParameters.radius=Mr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=Zt(this._snowTechniqueCached),this._rainTechniqueCached=Zt(this._rainTechniqueCached),this._vao=Ke(this._vao),this._instanceIdBuffer=Ke(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new tB;e.type=Sm.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(iB,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new tB;e.type=Sm.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(iB,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,r,i){const s=i==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),s==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=e.bindParameters.cloudsFade.opacity),this._passParameters.opacity<=0))return;const o=.35;r=r<.5?ft(0,o,2*r):ft(o,1,2*(r-.5)),this._passParameters.time=(i==="rainy"?this._rainSpeed:this._snowSpeed)*jz(this._animation.time)%1e5;const a=n.bindTechnique(s,this._passParameters,e.bindParameters);n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),vG(n,SM,this._instanceIdBuffer,OZ,0),n.drawArraysInstanced(Qt.TRIANGLES,0,3,this._numParticles*r),bG(n,SM,this._instanceIdBuffer,OZ)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const r=[];for(let i=0;i<this._numParticles;i++)r.push(i);return Cr.createVertex(e,yr.STATIC_DRAW,new Float32Array(r))}_createVertexArrayObject(e){const r=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new pd(e,SM,{geometry:Ul(w9e)},{geometry:Cr.createVertex(e,yr.STATIC_DRAW,r)})}};h([f({constructOnly:!0})],k_.prototype,"context",void 0),h([f({constructOnly:!0})],k_.prototype,"view",void 0),h([f({readOnly:!0})],k_.prototype,"updating",null),h([f()],k_.prototype,"_updatingTracking",void 0),k_=h([k("esri.views.3d.environment.Precipitation")],k_);const w9e=Ci().vec3f(R.POSITION),OZ=Ul(Ci().f32(R.INSTANCEFEATUREATTRIBUTE),1);function x9e(){const t=new dr;return t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.COLOR,"vec4"),t.attributes.add(R.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new Li("transform",(e,r)=>T9e(e,r)),new nr("viewport",(e,r)=>r.camera.fullViewport),new Ee("pixelRatio",(e,r)=>r.camera.pixelRatio)),t.vertex.code.add(b`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(b`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function T9e(t,e){return Ss(ng,e.camera.projectionMatrix),ng[10]=24e-8-1,ng[11]=-1,ng[14]=(24e-8-2)*e.camera.near,Pr(ng,ng,e.camera.viewMatrix),Pr(ng,ng,t.modelMatrix)}const ng=ge(),S9e=Object.freeze(Object.defineProperty({__proto__:null,build:x9e},Symbol.toStringTag,{value:"Module"}));let E9e=class extends Vr{constructor(){super(...arguments),this.modelMatrix=ge()}},bme=class wme extends Sr{constructor(e){super(e,new Za,()=>this.destroy())}initializeProgram(e){return new vr(e.rctx,wme.shader.get().build(),hr)}initializePipeline(){return Et({blending:Jn(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ar.LEQUAL},colorWrite:Ut})}};bme.shader=new _r(S9e,()=>he(()=>import("./Stars.glsl-f8ff876a.js"),[],import.meta.url));let Yg=class extends xe{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new E9e,this._updatingTracking=new Yh}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Ml(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Zt(this._technique),this._vao=Ke(this._vao),Ly=null}render(e){const{rctx:r}=e;if(this._ensureResources(r),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const i=r.bindTechnique(this._technique,this._renderParameter,e.bindParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Qt.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||Ly==null)return;this._technique=new bme({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=Ly.byteLength/PZ;const r=new Float32Array(Ly,0,2*this._numPoints),i=new Uint8Array(Ly,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,r,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),zr)}_computeDayDuration(e){const r=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+r-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const r=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),s=Ss(this._renderParameter.modelMatrix,R9e);Ox(s,s,-i*Math.PI),Pr(s,A9e,s),Ox(s,s,-r*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,r,i,s){const n=MZ.createBuffer(s),o=n.position,a=n.color,l=n.size;for(let c=0;c<s;c++){const u=r[2*c],d=r[2*c+1];o.set(c,0,-Math.cos(u)*Math.sin(d)),o.set(c,1,-Math.sin(u)*Math.sin(d)),o.set(c,2,-Math.cos(d));const p=this._unpackUint8Attributes(i[c]),g=this._hexToRGB(C9e[p[1]]);a.set(c,0,255*g[0]),a.set(c,1,255*g[1]),a.set(c,2,255*g[2]),a.set(c,3,255),l.set(c,p[0])}return new pd(e,hr,{geometry:Ul(MZ)},{geometry:Cr.createVertex(e,yr.STATIC_DRAW,n.buffer)})}_createLoadDataTask(){if(Ly!=null)return null;const e=cy(async r=>{const{data:i}=await nEe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:r});this._verifyStarData(i),Ly=i});return e.promise.catch(r=>{Os(r)||ne.getLogger(this).error(r)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new X("stars:no-data-received","Failed to create stars because star catalogue is missing");const r=e.byteLength/PZ;if(r%1!=0||r>5e4||r<5e3)throw new X("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};h([f({constructOnly:!0})],Yg.prototype,"view",void 0),h([f({constructOnly:!0})],Yg.prototype,"requestRender",void 0),h([f({readOnly:!0})],Yg.prototype,"updating",null),h([f()],Yg.prototype,"_loadDataTask",void 0),h([f()],Yg.prototype,"_updatingTracking",void 0),Yg=h([k("esri.views.3d.environment.Stars")],Yg);const C9e=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],A9e=RV(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),R9e=RV(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),PZ=9,MZ=Ci().vec3f(R.POSITION).vec4u8(R.COLOR).f32(R.SIZE);let Ly=null;const lN={required:[]},xme={required:[L.Depth]},Tme={required:[L.CompositeColor]},Sme={required:[L.Highlight]},O9e={required:[L.Depth,L.Normal]};let cN=class extends xe{consumes(){return lN}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}},Iv=class extends cN{},Eme=class extends cN{},P9e=class extends cN{},M9e=class extends cN{};var dx;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(dx||(dx={}));var HS;let io=HS=class extends Iv{constructor(t){super(t),this.produces=new Map([[oe.ENVIRONMENT_OPAQUE,()=>!(this._atmosphere===null&&this._stars===null)],[oe.ENVIRONMENT_TRANSPARENT,()=>this._atmosphere!==null]]),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new f5,this._newWeatherParameters=new f5,this._fadedWeatherParameters=new f5,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){var t;this.removeHandles(),this.uninitializeRenderContext(),((t=this.view)==null?void 0:t._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:Co.None}consumes(){return this._atmosphereType===Co.Realistic?xme:lN}updateAnimation(t){return this._precipitation!=null&&this._precipitation.update(t)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return _e(this.view.state.camera.eye)-Mr(this.view.spatialReference).radius<=Hf}get usedMemory(){var t;return((t=this._clouds)==null?void 0:t.usedMemory)??0}get _stars(){var i;const t=this.view,e=((i=t.environment)==null?void 0:i.starsEnabled)??!1,r=this._get("_stars");return e&&this._context!=null?r??new Yg({view:t,requestRender:()=>this._setNeedsRender()}):(Oe(r),null)}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return Oe(t),null;const e=this.view,r=this._context;return t!=null&&t.context===r?t:(Oe(t),new k_({context:r,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return Oe(t),null;if(t!=null)return t;const e=this.view,r=this._context;return Oe(t),new Ia({context:r,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return Oe(t),null;const e=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=Mr(this.view.spatialReference).radius;return t!=null&&t.viewingMode===e&&t.planetRadius===i?t:(Oe(t),new N_({rctx:r,viewingMode:e,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||this._context==null)return Oe(t),null;if(t!=null)return t;const e=this.view,r=this._context,i=this._context.renderContext.rctx,s=this.view.state.viewingMode;return new F_({context:r,view:e,rctx:i,viewingMode:s})}get weatherEnabled(){var t,e;return!!((e=(t=this.view)==null?void 0:t.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([ae(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),r=>this._updateAtmosphere(r),Br),ae(()=>this._stars,e),ae(()=>this._precipitation,e),ae(()=>this._clouds,()=>this._updateWeather(),zr),ae(()=>this._fog,()=>this._updateFogHaze(),zr),ae(()=>this.view.state.mode,()=>{this._setNeedsRender()},Fr),ae(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Br)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Oe(this._atmosphere),this._set("_stars",Oe(this._stars)),this._set("_precipitation",Oe(this._precipitation)),this._set("_clouds",Oe(this._clouds)),this._set("_cloudsComposition",Oe(this._cloudsComposition)),this._set("_fog",Oe(this._fog))}prepareRender(t){var e;t.bindParameters.cloudsFade.data=l8e(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&((e=t.bindParameters.cloudsFade.data)==null?void 0:e.cubeMap)!=null&&(this._updateWeatherFading(t.bindParameters,t.time),t.bindParameters.cloudsFade.renderingStage===vp.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}renderNode(t){var e,r,i,s,n,o,a;switch(t.bindParameters.slot){case oe.ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(t),this.atmosphere!=null&&(this.atmosphere.render(t,(i=(r=(e=this.view)==null?void 0:e._stage)==null?void 0:r.renderer)==null?void 0:i.fullResolutionAtmosphere),this._cloudsComposition!=null&&t.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),t.bindParameters.cloudsFade.isFading&&this._context!=null&&((s=t.bindParameters.cloudsFade.data)==null?void 0:s.cubeMap)!=null&&this._context.requestRender());break;case oe.ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(t,this._weatherParameters.hazeAmount,(a=(o=(n=this.view)==null?void 0:n._stage)==null?void 0:o.renderer)==null?void 0:a.fullResolutionAtmosphere),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(t,this._weatherParameters.fog),this._precipitation!=null)){const l=this.view.environment.weather;l.type!=="rainy"&&l.type!=="snowy"||this._precipitation.render(t,l.precipitation,l.type)}}}updateLightSources(t,e,r,i){if(this._context!=null){const s=this._context.renderContext;s.bindParameters.oldLighting.copyFrom(s.bindParameters.lighting),s.bindParameters.newLighting.noonFactor=e,s.bindParameters.newLighting.globalFactor=r,s.bindParameters.newLighting.set(t),i===dx.Faded||s.bindParameters.weatherFading?s.bindParameters.fadeLighting(0):s.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return t==null?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t,e){t.cloudsFade.updateFading(t.camera,this.view.state.mode,e,this.view.qualitySettings.fadeDuration),t.cloudsFade.updateParallax(t.camera),t.weatherFading&&(this._updateLighting(t),this._updateFogAtmoshpere(t))}_updateLighting(t){t.cloudsFade.fadeMode!==ci.CROSS_FADE&&t.cloudsFade.fadeMode!==ci.FADE_IN?t.fadeLighting(0):t.fadeLighting(t.cloudsFade.fadeFactor)}_updateFogAtmoshpere(t){t.cloudsFade.fadeMode!==ci.CROSS_FADE&&t.cloudsFade.fadeMode!==ci.FADE_IN?this._fadeWeather(0):this._fadeWeather(t.cloudsFade.fadeFactor)}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:r}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(r,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;t!=null&&this._clouds!=null&&(this._clouds.applyPreset(Eo[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(this._fog==null||t==null||this._context==null)return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=ft(3e-5,.005,t.weatherAdjustment**3),ie(this._newWeatherParameters.fog.color,$Z),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=ft(4e-6,2e-4,(t.effect??0)**3),ie(this._newWeatherParameters.fog.color,$9e),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=ft(4e-6,2e-4,(t.effect??0)**3),ie(this._newWeatherParameters.fog.color,$Z),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(e!==Co.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==e){this._atmosphere=Oe(this._atmosphere);const r=this._getAtmosphereClass(e);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=Oe(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(t){switch(t){case Co.Realistic:return qX;case Co.Local:return n9e;case Co.Mars:return u9e;default:case Co.None:return null}}_selectAtmosphereType(t){const{enabled:e,viewingMode:r}=t;return!e||Yp(this.view.spatialReference)?Co.None:r===$e.Local?Co.Local:this._context!=null&&qX.isSupported(this._context)&&SC(this.view.spatialReference)?Co.Realistic:Wp(this.view.spatialReference)?Co.Mars:Co.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:t=>{IZ=HS.prototype._getAtmosphereClass,HS.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{HS.prototype._getAtmosphereClass=IZ}}}};h([f({constructOnly:!0})],io.prototype,"view",void 0),h([f({readOnly:!0})],io.prototype,"atmosphere",null),h([f({readOnly:!0})],io.prototype,"_atmosphereType",null),h([f({type:Boolean,readOnly:!0})],io.prototype,"updating",null),h([f({readOnly:!0})],io.prototype,"weatherVisible",null),h([f()],io.prototype,"_context",void 0),h([f()],io.prototype,"_atmosphere",void 0),h([f({readOnly:!0})],io.prototype,"_stars",null),h([f({readOnly:!0})],io.prototype,"_precipitation",null),h([f({readOnly:!0})],io.prototype,"_clouds",null),h([f({readOnly:!0})],io.prototype,"_cloudsComposition",null),h([f({readOnly:!0})],io.prototype,"_fog",null),h([f({readOnly:!0})],io.prototype,"weatherEnabled",null),h([f({readOnly:!0})],io.prototype,"_precipitationEnabled",null),h([f({readOnly:!0})],io.prototype,"_weatherUpdateParameters",null),io=HS=h([k("esri.views.3d.environment.EnvironmentRenderer")],io);let f5=class{constructor(){this.fog=new wUe,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,ie(this.fog.color,e.fog.color)}lerp(e,r,i){this.fog.amount=ft(e.fog.amount,r.fog.amount,i),this.hazeAmount=ft(e.hazeAmount,r.hazeAmount,i),this.fog.strength=ft(e.fog.strength,r.fog.strength,i),$r(this.fog.color,e.fog.color,r.fog.color,i)}};const $9e=Te(.5,.5,.5),$Z=Te(1.5,1.5,1.5);let IZ;var Mvt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Q3(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var LZ,DZ,NZ,sB={exports:{}};sB.exports,LZ=sB,DZ=function(){var t=Math.PI,e=Math.sin,r=Math.cos,i=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,u=2451545,d={dec:0,ra:0};function p(P){return P.valueOf()/l-.5+c}function g(P){return new Date((P+.5-c)*l)}function y(P){return p(P)-u}var _=23.4397*a;function v(P,I){return n(e(P)*r(_)-i(I)*e(_),r(P))}function w(P,I){return s(e(I)*r(_)+r(I)*e(_)*e(P))}function x(P,I,B){return n(e(P),r(P)*e(I)-i(B)*r(I))}function T(P,I,B){return s(e(I)*e(B)+r(I)*r(B)*r(P))}function S(P,I){return a*(280.16+360.9856235*P)-I}function C(P){return a*(357.5291+.98560028*P)}function A(P){return a*(1.9148*e(P)+.02*e(2*P)+3e-4*e(3*P))}function O(P,I){return P+I+102.9372*a+t}function $(P,I){var B=C(P),G=O(B,A(B));return I||(I={dec:0,ra:0}),I.dec=w(G,0),I.ra=v(G,0),I}var D={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(P,I,B,G){var q=a*-B,Z=a*I,K=y(P),fe=$(K,d),Pe=S(K,q)-fe.ra;return G||(G={azimuth:0,altitude:0}),G.azimuth=x(Pe,Z,fe.dec),G.altitude=T(Pe,Z,fe.dec),G}},N=[[-.83,"sunrise","sunset"]];D.addTime=function(P,I,B){N.push([P,I,B])};var z=9e-4;function U(P,I){return Math.round(P-z-I/(2*t))}function Y(P,I,B){return z+(P+I)/(2*t)+B}function H(P,I,B){return u+P+.0053*e(I)-.0069*e(2*B)}function V(P,I,B){return o((e(P)-e(I)*e(B))/(r(I)*r(B)))}function J(P){var I=a*(134.963+13.064993*P),B=a*(93.272+13.22935*P),G=a*(218.316+13.176396*P)+6.289*a*e(I),q=5.128*a*e(B),Z=385001-20905*r(I);return{ra:v(G,q),dec:w(G,q),dist:Z}}return D.getTimes=function(P,I,B){var G=a*-B,q=a*I,Z=U(y(P),G),K=Y(0,G,Z),fe=C(K),Pe=A(fe),lt=O(fe,Pe),Tt=w(lt,0),it=H(K,fe,lt);function dt(ht){return H(Y(V(ht,q,Tt),G,Z),fe,lt)}function Be(ht){var bt=(e(ht)-e(q)*e(Tt))/(r(q)*r(Tt));return bt<-1?D.PolarException.MIDNIGHT_SUN:bt>1?D.PolarException.POLAR_NIGHT:D.PolarException.NORMAL}var Re,Ce,_t,Se,Ne,We={solarNoon:g(it),nadir:g(it-.5),polarException:D.PolarException.NORMAL};for(Re=0,Ce=N.length;Re<Ce;Re+=1)Ne=it-((Se=dt((_t=N[Re])[0]*a))-it),We[_t[1]]=g(Ne),We[_t[2]]=g(Se);return We.polarException=Be(N[0][0]*a),We},D.getMoonPosition=function(P,I,B){var G=a*-B,q=a*I,Z=y(P),K=J(Z),fe=S(Z,G)-K.ra,Pe=T(fe,q,K.dec);return Pe+=.017*a/i(Pe+10.26*a/(Pe+5.1*a)),{azimuth:x(fe,q,K.dec),altitude:Pe,distance:K.dist}},D.getMoonFraction=function(P){var I=y(P),B=$(I),G=J(I),q=149598e3,Z=o(e(B.dec)*e(G.dec)+r(B.dec)*r(G.dec)*r(B.ra-G.ra)),K=n(q*e(Z),G.dist-q*r(Z));return(1+r(K))/2},D},(NZ=DZ())!==void 0&&(LZ.exports=NZ);const cv=Q3(sB.exports),ua={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let IR=class{constructor(e,r){this.direct=e,this.ambient=r}};function I9e(t,e,r,i,s,n){se(n.ambient.color,1,1,1),n.ambient.intensity=ua.global.ambient,se(n.direct.color,1,1,1),n.direct.intensity=ua.global.direct;const o=e[2],a=me((Math.abs(o)-ua.local.altitude)/(ua.global.altitude-ua.local.altitude),0,1);let l;if(n.globalFactor=a,t!=null&&(l=cv.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=B9e(t,l,i);else{const u=Rme(i);c={direct:{intensity:ua.local.directAtNoon*u.direct,color:Te(1,1,1)},ambient:{intensity:ua.local.ambientAtNoon*u.ambient,color:Te(1,1,1)},timeOfDay:"early afternoon"}}$r(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=ft(c.ambient.intensity,n.ambient.intensity,a),$r(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=ft(c.direct.intensity,n.direct.intensity,a),n.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,n.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}n.noonFactor=t!=null?k9e(t,l):1,t!=null?L9e(t,e,r,n.direct.directionToLightSource):Cme(s,r,n.direct.directionToLightSource)}function Cme(t,e,r){e===$e.Global?pe(_5,t.eye):se(_5,0,0,1),ee(v5,t.viewForward,-1);const i=KP(v5,_5),s=Math.max(i-2*b5,0),n=.85*s/(s+1),o=Math.max(b5,i-b5-n);Mc(WZ,-o,t.viewRight),De(r,v5,WZ),le(r,r,ee(z9e,t.viewRight,V9e)),pe(r,r)}function L9e(t,e,r,i){const s=U9e,n=Pu(F9e);if(r===$e.Global)cv.getPosition(t,0,0,s),se(i,0,0,-1),Rx(n,n,-s.azimuth),eD(n,n,-s.altitude),De(i,i,n);else{const o=ua.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=me(c,0,1),c<1?(cv.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),se(i,0,-1,0),Ox(n,n,-s.azimuth),Rx(n,n,-s.altitude),De(i,i,n)}}function D9e(t,e){if(e===$e.Global)return!0;const r=ua.planarDirection;return Math.abs(t)<r.localAltitude}const N9e=Te(.5773502691896258,-.5773502691896258,.5773502691896258);let Ame=class{constructor(){this.ambient={color:Te(1,1,1),intensity:.55},this.direct={color:Te(1,1,1),intensity:.55,directionToLightSource:Ii(N9e)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const F9e=ge(),U9e={azimuth:0,altitude:0};function k9e(t,e){const r=t.valueOf();let i,s;e.polarException===cv.PolarException.MIDNIGHT_SUN?(i=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=i+432e6):e.polarException===cv.PolarException.POLAR_NIGHT?(i=r-2,s=r-1):(i=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=i+(s-i)/2;return 1-me(Math.abs(r-n)/432e5,0,1)}function Rme(t){switch(t){case"disabled":case"sunny":case"cloudy":return new IR(1,1);case"rainy":return new IR(.4,1.2);case"snowy":return new IR(.5,1.3);case"foggy":return new IR(.2,1.6)}}function FZ(t,e){const r=(t[0]+t[1]+t[2])/3;t[0]+=(r-t[0])*e,t[1]+=(r-t[1])*e,t[2]+=(r-t[2])*e}const m5=Te(.01,.01,.01),nB=Te(1,.6,.5),oB=Te(1,.98,.98),UZ=Te(1,1,1),g5=Te(.8,.8,1),aB=Te(.8,.8,1),lB=Te(.98,.98,1),kZ=Te(1,1,1),y5=tr(.01,ua.local.ambientAtNight),cB=tr(ua.local.directAtTwilight,ua.local.ambientAtTwilight),uB=tr(.9*ua.local.directAtNoon,ua.local.ambientAtNoon),BZ=tr(ua.local.directAtNoon,ua.local.ambientAtNoon),zZ=uB,VZ=oB,GZ=lB,jZ=cB,HZ=nB,qZ=aB;function B9e(t,e,r){const i=t.valueOf();let s,n;e.polarException===cv.PolarException.MIDNIGHT_SUN?(s=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===cv.PolarException.POLAR_NIGHT?(s=i-2,n=i-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,u=a+l,d=.06*o,p=s-d/2,g=s+d/2,y=n-d/2,_=n+d/2,v=ke(),w=E(),x=E();let T="";if(i<p||i>_)Ns(v,y5),ie(w,m5),ie(x,g5),T="night";else if(i<g){const A=(i-p)/(g-p);fu(v,y5,cB,A),$r(w,m5,nB,A),$r(x,g5,aB,A),T="sun rising"}else if(i<c){const A=(i-g)/(c-g);fu(v,cB,uB,A),$r(w,nB,oB,A),$r(x,aB,lB,A),T="early morning"}else if(i<a){const A=(i-c)/(a-c);fu(v,uB,BZ,A),$r(w,oB,UZ,A),$r(x,lB,kZ,A),T="late morning"}else if(i<u){const A=(i-a)/(u-a);fu(v,BZ,zZ,A),$r(w,UZ,VZ,A),$r(x,kZ,GZ,A),T="early afternoon"}else if(i<y){const A=(i-u)/(y-u);fu(v,zZ,jZ,A),$r(w,VZ,HZ,A),$r(x,GZ,qZ,A),T="late afternoon"}else if(i<_){const A=(i-y)/(_-y);fu(v,jZ,y5,A),$r(w,HZ,m5,A),$r(x,qZ,g5,A),T="sun setting"}let S=0;switch(r){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(FZ(w,S),FZ(x,S));const C=Rme(r);return{direct:{intensity:v[0]*C.direct,color:w},ambient:{intensity:v[1]*C.ambient,color:x},timeOfDay:T}}const WZ=ge(),_5=E(),v5=E(),z9e=E(),b5=.25,V9e=.2;let dh=class extends Ps.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandlesKey="viewHandles",this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new yI,this._ambientLight=new OG,this._moonLight=new Ife,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,r,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(r=this._view)==null?void 0:r.state)==null?void 0:i.viewingMode)===$e.Global&&SC(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new io({view:e});const r=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this.addHandles([ae(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Fr),ae(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),Fr),ae(()=>e.stationary,()=>this._interactingStationaryHandler()),ae(()=>e.environment.lighting.directShadowsEnabled,r,Fr),ae(()=>e.qualitySettings.ambientOcclusion,r,Fr),ae(()=>e.qualitySettings.reflections,r,Fr),ae(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Fr),ae(()=>e.environment.weather.type,()=>this._updateLighting(null,dx.Faded),Fr),ae(()=>this.weatherEnabled,()=>this._updateLighting(null,dx.Faded),Fr),ae(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Br),ae(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),Br),ae(()=>e.state.camera,i,Br),ae(()=>this.disableQueries,i)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=Oe(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const r=this._view.environment.lighting;(r==null?void 0:r.type)!=="virtual"&&(r.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const r=this._view.environment.lighting;if((r==null?void 0:r.type)!=="virtual"){if(e){if(!r.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!Y0(i)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const s=iX(this._referencePosWGS84Comparable,YZ);s!=null&&(r.autoUpdate(null,s),this._trackingEnabled&&(r.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const r=this._view;if(!r.ready)return;const i=r.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,r){const i=SC(this._view.spatialReference);if(i&&!Y0(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=E()),i?dFe(s,this._referencePosWGS84Comparable):se(this._referencePosWGS84Comparable,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,r)||this._updateLighting(r),!0}_cameraHandlerServerSide(e){const r=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(r))&&this._requestReferencePositionUpdate(r,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(r.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,r=dx.Immediate){const i=this._view;e=e||(i.environment.lighting.type==="virtual"?null:i.environment.lighting.date);const s=this._referencePosWGS84Comparable,n=s!=null?G9e:j9e,o=this.weatherVisible?i.environment.weather.type:"disabled";s!=null?I9e(e,s,i.state.viewingMode,o,i.state.camera,n):i.environment.lighting.type==="virtual"&&Cme(i.state.camera,i.state.viewingMode,n.direct.directionToLightSource);const a=this._mainLight,l=n.direct;ee(a.intensity,l.color,l.intensity*Math.PI),ie(a.direction,l.directionToLightSource),a.specularStrength=n.specularStrength,a.environmentStrength=n.environmentStrength;const c=this._ambientLight;ee(c.intensity,n.ambient.color,n.ambient.intensity);const u=this._moonLight;$r(u.intensity,q9e,W9e,n.globalFactor);const d=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));ee(u.intensity,u.intensity,d),ie(u.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,u],n.noonFactor,n.globalFactor,r),this._updateRenderParameters()}_autoUpdateTimezone(e,r=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const i=H9e;i.setTime((r||this._view.environment.lighting.date).getTime());const s=iX(e,YZ);if(s==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=i.getUTCHours()-(s.hours-n.hours),a=i.getUTCMinutes()-(s.minutes-n.minutes),l=i.getUTCSeconds()-(s.seconds-n.seconds);return i.setUTCHours(o),i.setUTCMinutes(a),i.setUTCSeconds(l),!r&&this._view.environment.lighting.autoUpdate(i,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const r=this._referencePosWGS84Comparable==null||D9e(this._referencePosWGS84Comparable[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&r,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,r=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!r,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=_C(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const n=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=_C(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const r=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(r[0])&&!isNaN(r[1])){const i=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=r[0],this._referencePosWGS84Comparable[1]=r[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[r[0],r[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let r=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(r*=this._view.mapCoordsHelper.unitInMeters),r>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(r){e._referencePointUpdateInterval=r},set referencePointUpdateDistThreshold(r){e._referencePointUpdateDistThreshold=r},set referencePosUpdateTimer(r){e._referencePosUpdateTimer=r},set referencePointUpdateDelay(r){e._referencePointUpdateDelay=r},set disableWeather(r){e._disableWeather=r}}}};h([f({type:Boolean,readOnly:!0})],dh.prototype,"updating",null),h([f()],dh.prototype,"disableQueries",void 0),h([f()],dh.prototype,"_disableWeather",void 0),h([f()],dh.prototype,"weatherEnabled",null),h([f()],dh.prototype,"weatherVisible",null),h([f()],dh.prototype,"referencePositionWGS84Comparable",null),h([f()],dh.prototype,"_renderer",void 0),h([f()],dh.prototype,"_referencePosWGS84Comparable",void 0),dh=h([k("esri.views.3d.environment.SceneViewEnvironmentManager")],dh);const G9e=new Ame,j9e=new Ame,H9e=new Date,YZ={hours:0,minutes:0,seconds:0},q9e=Te(.22,.22,.33),W9e=Te(.22,.22,.22);var _i;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(_i||(_i={}));var jt;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(jt||(jt={}));var $n;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})($n||($n={}));function XC(t,e){return(t&e)!=0}function SI(t,e,r,i,s,n){t!==0&&(r?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):i!=null?(n.min-=Math.max(0,(e-n.min)*(1-i)),n.max+=Math.max(0,(e-n.max)*(1-i))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const ey={selection:_i.NONE,interactionType:jt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:$n.TUMBLE};function Ome(t,e,r,i){return e=e||t.viewForward,ie(i,e),ee(i,i,Math.sign(de(e,r))),i}function Y9e(t,e,r,i){return K9e(t,e,r,J9e(i,e,r,!0))}function X9e(t,e,r,i){const s=de(r,ce(t,i,e));return le(t,e,ee(t,r,s))}const Z9e={dir:E(),len:0,clip:ke()};function J9e(t,e,r,i){const s=Z9e;return t?(r&&i&&(s.len=hi(e,r)),ie(s.dir,t)):i?(s.len=hi(e,r),ce(s.dir,r,e),ee(s.dir,s.dir,1/s.len)):(ce(s.dir,r,e),pe(s.dir,s.dir)),s}function Q9e(t,e,r){const i=de(t,r.dir),s=-Wr(t,e);if(s<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return s>0;if((s<0||i<0)&&!(s<0&&i<0))return!0;const n=s/i;return i>0?n<r.clip[1]&&(r.clip[1]=n):n>r.clip[0]&&(r.clip[0]=n),r.clip[0]<=r.clip[1]}function K9e(t,e,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!Q9e(t[s],e,i))return!1;return!0}function eke(t,e,r=ey){const i=VG(t,e,r);if(i===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+i,o=Ome(e,r.interactionDirection,ike(t,e,Math.sign(i),ake),oke),a=ie(lke,e.viewForward),l=s.intersectInfiniteManifold($c(e.eye,o),n,w5);return e.eye=l??s.setAltitude(w5,n,e.eye),e.center=X9e(w5,e.eye,a,e.center),!0}function VG(t,e,r=ey){if(!tke(t,r)||!t.state.constraints.altitude)return 0;const i=ske(t.state.constraints.altitude,nke);rke(t,r,i);const s=t.renderCoordsHelper.getAltitude(e.eye),n=me(s,i.min,i.max)-s;return Math.abs(n)<=1e-6?0:n}function tke(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(e.interactionType!==jt.TUMBLE||!XC(e.selection,_i.TILT))}function rke(t,e,r){const i=e.interactionType;if(i===jt.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===jt.TUMBLE||i===jt.ZOOM,c=VG(t,o),u=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);r.min=s,r.max=n,SI(c,u,l,a,.05*u,r)}function ike(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),ee(i,i,r),i}function ske(t,e){return e.min=t.min,e.max=t.max,e}const nke={min:0,max:0},oke=E(),ake=E(),lke=E(),w5=E();function GG(t,e,r=ey){if(!t.state.isLocal)return 0;const i=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;LR.min=0,LR.max=i,uke(t,r,LR);const s=jG(t,e),n=LR.max-s;return n>=-1e-6?0:n}function cke(t,e,r=ey){const i=GG(t,e,r);if(i===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=jG(t,e)+i,o=ie(dke,e.eye),a=Ome(e,r.interactionDirection,hke(e,s.renderLocation,mke),fke);if(!py(ohe(s.renderLocation,n),$c(e.eye,a),DR))return!1;e.eye=DR;const l=ce(pke,e.eye,o);e.center=le(DR,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),u=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,DR);return u!=null&&(e.center=u),!0}function uke(t,e,r){const i=e.interactionType;if(i===jt.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===jt.ZOOM||i===jt.PAN,c=GG(t,o),u=c===0?0:jG(t,o);r.min=s,r.max=n,SI(c,u,l,a,.05*u,r)}function jG(t,e){const r=t.pointsOfInterest.surfaceOrigin;return r.renderLocation?hi(e.eye,r.renderLocation):0}function hke(t,e,r){return Rm(r,t.eye,e)}const LR={min:0,max:0},dke=E(),pke=E(),fke=E(),mke=E(),DR=E();function U2(t,e,r=wu.EYE){const i=t.state.constraints;if(!i.collision.enabled)return!1;const s=jD(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+i.collision.elevationMargin;if(n>=o)return!1;const a=_e(e.eye);if(ce(NR,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(gke,o,e.eye),r===wu.EYE_AND_CENTER)e.center=le(NR,e.eye,NR);else if(r===wu.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=ee(NR,e.center,l)}return!0}var wu;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(wu||(wu={}));const NR=E(),gke=E();function ty(t,e,r){t.worldUpAtPosition(e,XZ),ce(x5,r,e);const i=_e(x5);return i===0?0:un(de(x5,XZ)/i)}const XZ=E(),x5=E();function Pme(t,e,r=ey,i=!0){_T.eyeCenterDistance=0,_T.requiresTwoSteps=!1;const s=HG(t,e,r,void 0,_T);if(s===0)return!1;switch(Mc(FR,-s,e.viewRight),r.tiltMode){case $n.LOOK_AROUND:De(og,e.viewForward,FR),ee(og,og,_T.eyeCenterDistance),e.center=le(c0,e.eye,og);break;case $n.TUMBLE:ce(og,e.center,e.eye),De(og,og,FR),e.eye=ce(c0,e.center,og);break;default:r.tiltMode}return e.up=De(c0,e.up,FR),!_T.requiresTwoSteps||!i||Pme(t,e,r,!1)}function HG(t,e,r=ey,i=ey,s){if(!t.state.constraints.tilt)return 0;const n=e.distance,o=t.state.constraints.tilt(n,Cke);return Eke(t,r,o),i.interactionType===jt.TUMBLE&&XC(i.selection,_i.ALTITUDE)&&Mme(t,i.interactionStartCamera,o),r.tiltMode===$n.LOOK_AROUND||i.tiltMode===$n.LOOK_AROUND?_ke(t,e,o,s):yke(t,e,o)}function yke(t,e,r){const i=ty(t.renderCoordsHelper,e.center,e.eye),s=i-me(i,r.min,r.max);return ZC(s)?s:0}function _ke(t,e,r,i){switch(i&&(i.requiresTwoSteps=!1),t.viewingMode){case"global":return bke(t,e,r,i);case"local":return vke(t,e,r,i)}}function vke(t,e,r,i){const s=ty(t.renderCoordsHelper,e.center,e.eye),n=me(s,r.min,r.max),o=s-n;if(!ZC(o))return 0;if(i){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=e.distance}return o}function bke(t,e,r,i){const s=wke(t,e,Ake),n=me(s.tiltAtCenter,r.min,r.max);if(!ZC(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=xke(s),a=Tke(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=Ske(s,o)),i&&(i.eyeCenterDistance=hB(s,o)),a}function wke(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=i+Mr(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,i,c0);return r.eyeCenterDistance=e.distance,r.centerIsOnSurface=!1,n!=null?(r.eyeCenterDistance=hi(e.eye,n),r.tiltAtCenter=ty(t.renderCoordsHelper,n,e.eye),r.centerIsOnSurface=!0):t.state.isLocal?r.tiltAtCenter=ty(t.renderCoordsHelper,e.center,e.eye):($2(MD($D,s),e.ray,c0),r.eyeCenterDistance=hi(e.eye,c0),r.tiltAtCenter=un(-de(e.viewForward,pe(c0,c0)))),r.radius=s,r.eyeRadius=_e(e.eye),r.constraints=t.state.constraints,r}function ZC(t){return Math.abs(t)>1e-9}function xke(t){const{constraints:e,eyeCenterDistance:r,tiltAtCenter:i}=t;let s=i,n=e.clampTilt(r,i);const o=hB(t,n);if(e.clampTilt(o,i)===n)return n;let a=0;for(;a<10&&ZC(n-s);){const l=(s+n)/2,c=hB(t,l);ZC(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function hB(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const r=Math.PI-me(e,0,Math.PI),i=Ru(t.radius/t.eyeRadius*Math.sin(r)),s=Math.PI-r-i,n=Math.sin(s)/Math.sin(r);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*t.eyeRadius}return n*t.eyeRadius}function Tke(t,e){const r=Ru(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),i=Ru(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?r-i:i-r}function Ske(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function Eke(t,e,r){if(e.interactionType===jt.NONE)return;const{interactionStartCamera:i,interactionFactor:s}=e;if(!i)return;const{min:n,max:o}=r,a=HG(t,i,ey,e),l=a===0?0:ty(t.renderCoordsHelper,i.center,i.eye);r.min=n,r.max=o,e.interactionType===jt.TUMBLE?(XC(e.selection,_i.ALTITUDE)&&Mme(t,i,r),SI(a,l,!0,s,ZZ,r)):SI(a,l,!1,s,ZZ,r)}function Mme(t,e,r){const i=t.state.constraints;if(t.state.isLocal||!i.altitude||!e)return;const s=co(e.center),n=Math.sqrt(s),o=e.distance,a=Mr(t.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,u=(l*l-o*o-s)/(-2*n*o),d=(c*c-o*o-s)/(-2*n*o);r.min=Math.max(r.min,Math.min(Math.PI-un(d),r.max)),r.max=Math.min(r.max,Math.PI-un(u))}const og=E(),FR=ge(),c0=E(),ZZ=At(5),Cke={min:0,max:0},Ake={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},_T={eyeCenterDistance:0,requiresTwoSteps:!1},Rke=t=>t,uN=t=>t*t,qG=t=>1-uN(1-t),Oke=t=>t<.5?uN(2*t)/2:(qG(2*(t-.5))+1)/2,WG=t=>t*t*t,$me=t=>1-WG(1-t),Ime=t=>t<.5?WG(2*t)/2:($me(2*(t-.5))+1)/2,YG=t=>t*t*t*t,Lme=t=>1-YG(1-t),Pke=t=>t<.5?YG(2*t)/2:(Lme(2*(t-.5))+1)/2,XG=t=>t*t*t*t*t,Dme=t=>1-XG(1-t),Mke=t=>t<.5?XG(2*t)/2:(Dme(2*(t-.5))+1)/2,ZG=t=>1-Math.cos(t*Math.PI/2),Nme=t=>1-ZG(1-t),$ke=t=>t<.5?ZG(2*t)/2:(Nme(2*(t-.5))+1)/2,JG=t=>2**(10*(t-1)),K3=t=>1-JG(1-t),Ike=t=>t<.5?JG(2*t)/2:(K3(2*(t-.5))+1)/2,QG=t=>-(Math.sqrt(1-t*t)-1),Fme=t=>1-QG(1-t),Lke=t=>t<.5?QG(2*t)/2:(Fme(2*(t-.5))+1)/2;function Vu(t){const e=2*(t-Math.sqrt((t-1)*t)),r=e/2/t;return i=>i<r?t*i*i:e*i-e+1}function Gu(t,e){return(r,i)=>r<e?e*t(r/e,i):1-t((1-r)/(1-e),i)*(1-e)}const Dke=Gu(Vu(1),1),Nke=Gu(Vu(1),0),Ume=Gu(Vu(1),.5),Fke=Gu(Vu(2),1),Uke=Gu(Vu(2),0),kke=Gu(Vu(2),.5),Bke=Gu(Vu(3),1),zke=Gu(Vu(3),0),Vke=Gu(Vu(3),.5),Gke=Gu(Vu(4),1),jke=Gu(Vu(4),0),Hke=Gu(Vu(4),.5),qke={linear:Rke,"in-quad":uN,"out-quad":qG,"in-out-quad":Oke,"in-coast-quad":Dke,"out-coast-quad":Nke,"in-out-coast-quad":Ume,"in-cubic":WG,"out-cubic":$me,"in-out-cubic":Ime,"in-coast-cubic":Fke,"out-coast-cubic":Uke,"in-out-coast-cubic":kke,"in-quart":YG,"out-quart":Lme,"in-out-quart":Pke,"in-coast-quart":Bke,"out-coast-quart":zke,"in-out-coast-quart":Vke,"in-quint":XG,"out-quint":Dme,"in-out-quint":Mke,"in-coast-quint":Gke,"out-coast-quint":jke,"in-out-coast-quint":Hke,"in-sine":ZG,"out-sine":Nme,"in-out-sine":$ke,"in-expo":JG,"out-expo":K3,"in-out-expo":Ike,"in-circ":QG,"out-circ":Fme,"in-out-circ":Lke};function ws(t,e,r=Zke,i=e){i!==e&&i.copyFrom(e),i.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<Jke;a++){let l=0;for(const c of Xke)if(XC(r.selection,c.type)){const u=Math.abs(c.error(t,i,r));c.apply(t,i,r)&&(s=!0,l+=u)}if(l===0)break}const n=XC(r.selection,_i.COLLISION),o=Wke(r.interactionType,t);return n&&U2(t,i,o)&&(s=!0),s&&i.computeUp(t.state.viewingMode),s}function Wke(t,e){switch(t){case jt.PAN:return wu.EYE_AND_CENTER;case jt.ASCEND:return e.state.isGlobal?wu.EYE_AND_CENTER_SCALE:wu.EYE_AND_CENTER;default:return wu.EYE}}function Ih(t){const e=Math.min(1,t/150);return Ime(e)}function Yke(t,e,r){return HG(t,e,r)*e.distance}const Xke=[{type:_i.TILT,error:Yke,apply:Pme},{type:_i.ALTITUDE,error:VG,apply:eke},{type:_i.DISTANCE,error:GG,apply:cke}],Zke={selection:_i.ALL,interactionType:jt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:$n.TUMBLE},Jke=5,Bl=E(),el=E(),ag=E(),bo=E(),Dy=E(),Qke=E(),zl={upward:Te(0,0,1),forward:Te(0,1,0),sideway:Te(1,0,0)},JZ=Fi();let QZ=class{constructor(e=$e.Global){this.viewingMode=e,this.center=E(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=Ii(zl.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===$e.Global){const n=(_e(this.center)+_e(e.center))/2;r.pan=KP(this.center,e.center)*n}else r.pan=hi(this.center,e.center);let i=Math.abs(e.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const s=Math.abs(e.pitch-this.pitch);return r.rotate=Math.max(i,s),r.sourceZoom=this.distance,r.targetZoom=e.distance,r}interpolate(e,r,i){this.viewingMode===$e.Global?HIe(e.center,r.center,i.pan,this.center):$r(this.center,e.center,r.center,i.pan),this.distance=isFinite(r.distance)?ft(e.distance,r.distance,i.zoom):e.distance,this.pitch=ft(e.pitch,r.pitch,i.rotate);let s=e.yaw;const n=r.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=ft(s,n,i.rotate)}copyFrom(e){ie(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,ie(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const r=this._lookAtOrientation(e.center,JZ);ie(this.center,e.center),ce(bo,e.center,e.eye),Sl(bo,bo,r),Sl(Dy,e.up,r),this.distance=_e(bo),this.distance!==0&&(bo[0]/=this.distance,bo[1]/=this.distance,bo[2]/=this.distance),this.pitch=this._eyeUpToPitch(bo),this.yaw=this._eyeUpToYaw(bo,Dy),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const r=this._lookAtOrientation(this.center,JZ);Lu(r,r),this._axisAngleVec3(zl.sideway,this.pitch-Math.PI/2,zl.forward,bo),this._axisAngleVec3(zl.upward,this.yaw,bo),this._axisAngleVec3(zl.sideway,this.pitch-Math.PI/2,zl.upward,Dy),this._axisAngleVec3(zl.upward,this.yaw,Dy),ee(bo,bo,this.distance),Sl(bo,bo,r),Sl(Dy,Dy,r),e.center=this.center,e.eye=ce(bo,this.center,bo),e.up=Dy}_axisAngleVec3(e,r,i,s=i){const n=Math.cos(r),o=Math.sin(r);return ee(Bl,i,n),rt(el,e,i),ee(el,el,o),ee(ag,e,(1-n)*de(e,i)),le(s,le(s,Bl,el),ag)}_lookAtOrientation(e,r=Fi()){return this._upAtLookAt(e,ag),rt(Bl,this.lookAtDirection,ag),pe(Bl,Bl),Bl[0]===0&&Bl[1]===0&&Bl[2]===0&&ie(Bl,zl.sideway),rt(el,ag,Bl),pe(el,el),r[0]=Bl[0],r[1]=el[0],r[2]=ag[0],r[3]=Bl[1],r[4]=el[1],r[5]=ag[1],r[6]=Bl[2],r[7]=el[2],r[8]=ag[2],r}_upAtLookAt(e,r){return this.viewingMode===$e.Local?ie(r,zl.upward):pe(r,e)}_eyeUpToPitch(e){return Math.PI-KP(zl.upward,e)}_eyeUpToYaw(e,r){const i=Qke;return Math.abs(r[2])<.5?(ie(i,r),e[2]>0&&ee(i,i,-1)):ie(i,e),rt(el,i,zl.upward),pe(el,el),KP(zl.sideway,el,zl.upward)}};const EI={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let Kke=class kme{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:EI.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new kme(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,r,i){this.source!==e&&this.source.copyFrom(e),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:EI.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const r=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},eBe=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,r)=>e+r.time,0)}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(r=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,r),n.hasPan&&!isNaN(r.pan)&&isFinite(n.compared.pan)?r.pan=(i+l.compared.pan*r.pan)/n.compared.pan:r.pan=1,n.hasRotate&&!isNaN(r.rotate)&&isFinite(n.compared.rotate)?r.rotate=(s+l.compared.rotate*r.rotate)/n.compared.rotate:r.rotate=1,n.hasZoom&&!isNaN(r.zoom)&&isFinite(l.compared.targetZoom)){const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,u=this.segments[0].definition.compared.sourceZoom,d=this.segments[this.segments.length-1].definition.compared.targetZoom;r.zoom=(c-u)/(d-u)}else r.zoom=1;return r}e-=a.time,i+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(e,r,i){return e.interpolateComponentsAt(r,i)}},T5=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,r=e.compared,i=r.sourceZoom,s=r.targetZoom;this._zoomSign=i>s?1:-1,this._panPixelsAtSource=r.pan*e.source.pixelsPerPanAtZoom(i);const n=(e.source.pixelsPerRotateAtZoom(i)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=r.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;i&&(s&&(o=(r/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,u=1+c;this._panPixelFlow=c/u*l,this._rotatePixelFlow=1/u*l}else s?this._panPixelFlow=l:i?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:i?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=e*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-e-r)/(i-r)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*e*this._time)-1))/(r*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1);const i=this._interpolateComponentsZoom(e),s=this._interpolateComponentsPan(e),n=this._interpolateComponentsRotate(e);return r?(r.zoom=i,r.pan=s,r.rotate=n):r={zoom:i,pan:s,rotate:n},r}};function tBe(t,e,r){const i=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(i);return-t.halfWindowSize*(r.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function rBe(t,e,r){const i=1/e,s=Math.log(t.compared.sourceZoom*i),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*i*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function iBe(t,e,r){const i=e-t.compared.sourceZoom,s=1/i,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(i))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function sBe(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function nBe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function oBe(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function aBe(t,e,r){return-t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function lBe(t,e,r){return t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function cBe(t,e,r){return-2*t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function uBe(t,e,r){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function hBe(t,e,r){const i=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*i*s*n*a+t.halfWindowSize*i*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function dBe(t,e,r){const i=e-t.compared.targetZoom,s=1/i,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+r.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function pBe(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function fBe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function mBe(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function gBe(t){const e=Math.LN2*t.compared.pan,r=t.compared.sourceZoom-t.compared.targetZoom,i=t.halfWindowPanAtZoom(r),s=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*i);return t.compared.sourceZoom<=t.compared.targetZoom?s*(e-i):s*(e+i)}function yBe(t,e){let r=_Be(t,e);const i={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=i.ascensionFactor===0,n=i.descensionFactor===0,o=s?sBe:tBe,a=s?nBe:rBe,l=s?oBe:iBe,c=n?pBe:uBe,u=n?fBe:hBe,d=n?mBe:dBe,p=S=>o(t,S,i)+aBe(t,S,i)+c(t,S,i),g=S=>a(t,S,i)+lBe(t,S,i)+u(t,S,i),y=S=>l(t,S,i)+cBe(t,S,i)+d(t,S,i);let _=p(r);const v=gBe(t);let w;const x=e.maximumIterations||20,T=e.maximumDistance!=null?e.maximumDistance:1/0;for(w=0;w<x;w++){const C=(g(r)+1e-6)/y(r);if(isNaN(C)||r>=T&&C<0){if(!isFinite(T))return null;r=T,_=p(r);break}if(r-=C,r<t.compared.sourceZoom||r<t.compared.targetZoom)return null;const A=p(r);if(Math.abs(A-_)/_<=.005)break;_=A}return _>v*(1-.3)||r<t.compared.sourceZoom||r<t.compared.targetZoom?null:r}function _Be(t,e){const r=Math.max(t.compared.sourceZoom,t.compared.targetZoom),i=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return i<r?e.maximumDistance!=null?r+(e.maximumDistance-r)/2:1.5*r:e.maximumDistance?Math.min(e.maximumDistance,i):i}let vBe=class extends eBe{constructor(e,r){super(),this._preallocSegments=[new T5,new T5,new T5],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,r)}update(e,r){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let i=null;r!=null&&r.apex&&(i=yBe(e,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r==null?void 0:r.apex)}segmentInterpolateComponentsAt(e,r,i){return i=e.interpolateComponentsAt(r,i),e===this._ascensionSegment?i.zoom=qG(i.zoom):e===this._descensionSegment&&(i.zoom=uN(i.zoom)),i}_updateWithApex(e,r){const[i,s,n]=this._preallocSegments,o=(r==null?void 0:r.ascensionFactor)??.5,a=Math.min(1-o,(r==null?void 0:r.ascensionFactor)!=null&&r.descensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const bBe={zoom:0,pan:0,rotate:0};let wBe=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new Kke(e),this.path=new vBe}update(e,r,i){this.definition.update(e,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(nne(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing??(this._time>=1e3?Ume:K3)}cameraAt(e,r){r=r||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,bBe);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(e){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-r)/(i-r)}_applyTimeSettings(e,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?e=r.duration:r.speedFactor!=null&&(e=e/i);const s=r.minDuration!=null?r.minDuration:EI.minDuration/i,n=r.maxDuration!=null?r.maxDuration:EI.maxDuration/i;return Math.min(Math.max(s,e),n)}};const xBe=E();let TBe=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new wBe(()=>new QZ(e)),this._current=new QZ(e)}update(e,r,i){const s=this._animation.definition.source,n=this._animation.definition.target,o=ce(xBe,r.center,e.center),a=_e(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ie(s.lookAtDirection,o),ie(n.lookAtDirection,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(r),this._current.copyFrom(s),this._animation.update(s,n,i),this.currentTime=0,e.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(e,r){return this._animation.cameraAt(e,this._current),r=r||new ot,this._current.copyToRenderCamera(r),r}step(e,r){return this.finished||(this.currentTime=this.currentTime+nne(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}};var Ui;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(Ui||(Ui={}));let qf=class extends xe{constructor(e){super(e),this.state=Ui.Ready}get active(){return this.state===Ui.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Ui.Stopped,!0)}finishController(){this.state=Ui.Finished}get steppingFinished(){return!1}};h([f({constructOnly:!0})],qf.prototype,"view",void 0),h([f({readOnly:!0})],qf.prototype,"active",null),h([f()],qf.prototype,"state",void 0),h([f({readOnly:!0})],qf.prototype,"isInteractive",null),qf=h([k("esri.views.3d.state.controllers.CameraController")],qf);let JC=class extends qf{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(ur()),this._asyncResult=null),this.state===Ui.Finished||this.state===Ui.Stopped?(LL(e),this.state===Ui.Finished?e.resolve():e.reject(ur())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Ui.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==Ui.Ready&&this.state!==Ui.Running||(this.viewAnimation.state===Jx.State.FINISHED?this.finish():this.viewAnimation.state===Jx.State.STOPPED&&(this.state=Ui.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===Ui.Finished?this.viewAnimation.finish():this.state===Ui.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Ui.Finished?this._asyncResult.resolve():this._asyncResult.reject(ur()))}finish(){this.finishController()}};JC=h([k("esri.views.3d.state.controllers.AnimationController")],JC);let Kf=class extends JC{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new TBe(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new Jx}get isInteractive(){return this.mode==="interaction"}begin(e,r){this._hasTarget=!0;const i=this.animationSettings(r);UR.copyFrom(this.view.state.camera);const s=Du(this.view.state.viewingMode);this.intersectionHelper.intersectRay(UR.ray,s,KZ)&&(UR.center=KZ),this.animation.update(UR,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,r){this._hasTarget&&this.animation.step(e,r)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?qke[e.easing]:e.easing}}};h([f({constructOnly:!0})],Kf.prototype,"mode",void 0),h([f({readOnly:!0})],Kf.prototype,"isInteractive",null),Kf=h([k("esri.views.3d.state.controllers.PointToPointAnimationController")],Kf);const UR=new ot,KZ=E();function hN(t=EBe){return[t[0],t[1],t[2],t[3]]}function QC(t,e){return SBe(t[0],t[1],t[2],e,PV.get())}function SBe(t,e,r,i,s=hN()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function KG(t,e,r){return rt(r,t,e),pe(r,r),r[3]=PD(t,e),r}const EBe=[0,0,1,0];function jvt(t,e,r=ln()){return ej(t,Nh(e),r),pe(r.direction,r.direction),r}function ej(t,e,r){return CBe(t,t.screenToRender(e,Le.get()),r)}function CBe(t,e,r){const i=Ns(Le.get(),e);if(i[2]=0,!t.unprojectFromRenderScreen(i,r.origin))return null;const s=Ns(Le.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,Le.get());return n==null?null:(ce(r.direction,n,r.origin),r)}function k2(t,e,r){return tj(t,t.screenToRender(e,Le.get()),r)}function tj(t,e,r){ie(r.origin,t.eye);const i=se(Le.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(i,Le.get());return s==null?null:(ce(r.direction,s,r.origin),r)}function rj(t,e,r,i){const s=k2(e,r,ABe);return py(t,s,i)}const ABe=ln();var r2;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(r2||(r2={}));const Bme=30,CI=[1,3e8],dN=80,zme=8,Vme=200,Gme=1508e5,jme=5,Hme=50,RBe=5,OBe=10,S5=90,Lv={exclude:new Set([l0])};function $1(t,e,r){return r[0]=e[0]/(t.fullWidth/t.pixelRatio),r[1]=e[1]/(t.fullHeight/t.pixelRatio),r}function dB(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function ry(t,e,r){const i=Mc(MV.get(),r[3],r);i==null||M7(i,$i)||(ce(Dr,t.eye,e),De(Dr,Dr,i),t.eye=le(Dr,Dr,e),ce(Dr,t.center,e),De(Dr,Dr,i),t.center=le(Dr,Dr,e),t.up=De(Dr,t.up,i))}function PBe(t,e,r,i){return Cv(t,ej(e,r,nj),i)}function pB(t,e,r,i){return Cv(t,k2(e,r,nj),i)}function ij(t,e,r,i){const s=Le.get();let n=1-r;ce(s,e,t.eye);const o=_e(s);let a=o*(1-n);n>=0&&a<i&&(a=i,n=-(a-o)/o),Math.abs(o-a)<1e-6||(ee(s,s,n),t.eye=le(Dr,t.eye,s),t.center=$r(Dr,t.center,e,n))}function qme(t,e,r){e.getScreenCenter(eJ),rj(t,e,eJ,Dr)&&(e.center=Dr);const i=e.distance,s=i*r;if(Math.abs(i-s)<1e-6)return;const n=ee(Le.get(),e.viewForward,s);e.eye=ce(Dr,e.center,n)}const eJ=Vi();function E5(t,e){se(e,0,0,0);for(const r of t)le(e,e,r);ee(e,e,1/t.length)}function EM(t,e,r,i){return Math.sin(t/_e(e))*(r+i.radius)}function tJ(t,e,r,i){return EM(Math.PI/2,e,r,i)+(t-Math.PI/2)}var On;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(On||(On={}));const rJ={Elevation:3e4,Angle:At(16)},kR={Pole:.95,Angle:At(18),Tilt:45},Wme=At(80);function Yme(t,e,r,i,s,n){const o=E(),a=ds();let l=!0,c=!0;return t.intersectScreen(r,o,n)?a[3]=_e(o):(c=!1,e.aboveGround&&s!==r2.Ellipsoid?a[3]=Math.max(_e(e.center),.9*i.radius):a[3]=_e(e.eye)-e.relativeElevation,s===r2.Silhouette?KC(a,e,r,o):l=rj(a,e,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function pN(t,e,r){return _e(t.eye)-r.radius>rJ.Elevation?On.Horizontal:(k2(t,e,uJ),-Math.sign(t.relativeElevation)*(.5*Math.PI+PD(t.eye,uJ.direction))<rJ.Angle?On.Vertical:On.Horizontal)}function Xme(t,e,r){ce(C5,r,e),t.eye=ce(Dr,t.eye,C5),t.center=ce(Dr,t.center,C5)}const C5=E();function KC(t,e,r,i){const s=k2(e,r,nj);return s!=null&&($2(t,s,BR),py(t,s,i)?!(Yn(BR,s.origin)<Yn(i,s.origin))||(ie(i,BR),!1):(ce(lb,e.eye,e.center),pe(lb,lb),phe(lb,-de(pe(lb,lb),BR),iJ),Cv(iJ,s,i),!1))}const BR=E(),lb=E(),iJ=wr();function Zme(t,e,r,i,s,n){let o=0;if(rt(OI,t,e),ce(jR,t,e),_e(t)<=s||!i.aboveGround){rt(r,jR,i.eye);const a=de(t,e)/(_e(t)*_e(e));if(a<.9999)o=un(a);else{const c=_e(rt(E(),t,e))/(_e(t)*_e(e));o=Ru(c)}const l=Math.cos(me(j0.normalize(At(n)),0,Wme));o=-o-Math.max(0,_e(e)-s)/(l*s)}else ce(sJ,i.eye,i.center),rt(r,jR,sJ),o=-_e(jR)/s;return pe(r,r),ee(r,r,_e(OI)),o}const sJ=E();function nJ(t,e,r,i){let s,n;const o=Math.cos(me(j0.normalize(At(i)),0,Wme));return s=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):un(e/r),n=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):un(t/r),(n-s)*r}function MBe(t,e,r,i,s,n,o,a,l,c){const u=nJ(t[2],e[2],n[3],a),d=l?nJ(t[0],e[0],n[3],180):e[0]-t[0],p=Math.sin(o)*d-Math.cos(o)*u,g=Math.cos(o)*d+Math.sin(o)*u;pe(Dr,s);const y=l?p/Math.sqrt(Math.abs(n[3]**2-de(r,Dr)**2)):p/n[3],_=g/Math.sqrt(Math.abs(n[3]**2-de(r,i)**2));ir(c,y,_)}function Jme(t,e,r,i,s,n,o,a,l,c){rt(OI,t,e),x9(n.up,n.eye,zR,VR,GR),x9([0,0,1],n.eye,om,L0,tge),ie(r,L0),ie(i,om),pe(r,r),ee(r,r,_e(OI)),AY(t,pe(VR,VR),pe(GR,GR),pe(zR,zR),oJ),AY(e,VR,GR,zR,aJ),MBe(oJ,aJ,t,om,L0,o,a,l,c,s)}function $Be(t,e,r,i,s,n,o){Mc(AI,s,i),Mc(RI,o,n),Pr(zw,AI,RI),ce(e,t,r),De(e,e,zw),le(e,e,r)}function Qme(t,e,r,i,s,n){Mc(AI,i,r),Mc(RI,n,s),Pr(zw,AI,RI),ce(Dr,t.eye,e),De(Dr,Dr,zw),t.eye=le(Dr,Dr,e),ce(Dr,t.center,e),De(Dr,Dr,zw),t.center=le(Dr,Dr,e),ce(Dr,t.up,e),De(Dr,Dr,zw),t.up=le(Dr,Dr,e)}function sj(t,e,r,i,s,n){return(Math.abs(i)>Math.PI-kR.Angle||Math.abs(i)<kR.Angle)&&(Math.abs(t[2])<r*kR.Pole||Math.abs(e)>r)&&n.aboveGround&&s<kR.Tilt}function Kme(t,e,r,i,s,n){if(n)KG(r,i,lJ),ry(e,t,lJ);else{const o=Zme(r,i,cJ,e,t[3],s);ry(e,t,QC(cJ,o))}}function ege(t,e,r,i,s,n,o){const a=o?20:1,l=1e-12;let c,u;ie(Ny,i),HR.copyFrom(e);for(let d=0;d<a&&Yn(r,Ny)>l&&(c=Yn(r,Ny),Jme(r,Ny,L0,om,vT,HR,t,s,n,o),Qme(HR,t,om,vT[1],L0,vT[0]),$Be(Ny,Ny,t,om,vT[1],L0,vT[0]),u=Yn(r,Ny),u<c||d===0);d++)e.copyFrom(HR)}function IBe(t,e,r,i,s,n,o){sj(r,de(e.up,r),t[3],-j0.normalize(At(s)),n,e)?ege(t,e,r,i,-j0.normalize(At(s)),n,o):Kme(t,e,r,i,n,o)}function LBe(t,e,r,i,s,n){const{eye:o}=t;x9([0,0,1],o,om,L0,tge);const a=e.translation[0]*r.pan,l=s.mode==="zoom"?0:e.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-de(t.center,om)**2/_e(t.center)**2)),.5),u=(Math.sin(n)*l+Math.cos(n)*a)/c,d=-Math.cos(n)*l+Math.sin(n)*a;switch(El(i.pan.matrix,i.pan.matrix,u,om),i.pan.enabled=!0,s.mode){case"pan":El(i.pan.matrix,i.pan.matrix,d,L0),i.pan.enabled=!0;break;case"zoom":i.zoom=-e.translation[1]*r.zoom}}function DBe(t,e,r,i,s){const{eye:n,viewRight:o}=t,a=rt(Le.get(),o,n),l=e.translation[0]*r.pan;switch(l!==0&&(El(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*r.pan;c!==0&&(El(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-e.translation[1]*r.zoom}}function NBe(t,e,r,i,s,n,o,a,l){sj(t.center,de(t.up,t.center),_e(t.center),-j0.normalize(At(n)),o,e)?LBe(e,r,i,a,l,-j0.normalize(At(s))):DBe(e,r,i,a,l)}const om=E(),L0=E(),tge=E(),zR=E(),VR=E(),GR=E(),oJ=E(),aJ=E(),vT=ke(),lJ=hN(),AI=ge(),RI=ge(),zw=ge(),Ny=E(),Dr=E(),jR=E(),HR=new ot,OI=E(),cJ=E(),nj={origin:E(),direction:E()},uJ={origin:E(),direction:E()},hJ=.6,A5=4,FBe=60;let PI=class extends Kf{constructor(){super(...arguments),this._zoomLocation=E(),this._tmpCamera=new ot,this._tmpViewDir=E(),this._tmpRayDir={origin:E(),direction:E()},this._targetOnSphere=E(),this._tmpCenter=E(),this._constraintOptions={selection:_i.ALL_EXCEPT_COLLISION,interactionType:jt.ZOOM,interactionFactor:null,interactionStartCamera:new ot,interactionDirection:null,tiltMode:$n.TUMBLE},this._sphere=ds()}initialize(){this._intersector=Du(this.view.state.viewingMode)}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(i.camera):this.animation.cameraAt(1,s));let n=!1,o=!1;this.intersectionHelper.intersectScreen(r,this._zoomLocation,this.view.map.ground.opacity===0?Lv:{})&&(n=e>0,o=!0),this._tmpCamera.copyFrom(i.camera),n?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ie(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,r,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:K3}}_updateCamera(e,r,i,s,n){const o=Mr(this.view.spatialReference),a=pN(e,s,o),l=Math.abs(this.view.camera.position.z);pe(WR,e.eye),ee(WR,WR,-1),k2(e,s,this._tmpRayDir),pe(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=me(Math.min(zme,1/Math.abs(de(WR,this._tmpRayDir.direction)))*l,Vme,Gme);if(a===On.Horizontal){let u=hJ**r;this._sphere[3]=_e(i),ce(this._tmpViewDir,e.center,e.eye);const d=Math.min(_e(this._tmpViewDir),c);let p=d*u;if(u<=1&&p<A5&&(p=A5,u=p/d),Math.abs(d-p)<1e-6)return;const g=_e(e.center);if(this._sphere[3]!==g){const y=this._sphere[3]+u*(g-this._sphere[3]);e.center=ee(qR,e.center,y/g)}ee(this._tmpViewDir,this._tmpViewDir,-u),e.eye=le(qR,e.center,this._tmpViewDir),ws(this.view,e,this._constraintOptions),Yn(i,e.center)>1e-12&&rj(this._sphere,e,s,this._targetOnSphere)&&IBe(this._sphere,e,i,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let u=hJ**Math.abs(r);const d=r>0?1:-1;ce(this._tmpViewDir,i,e.eye);const p=_e(this._tmpViewDir),g=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,FBe);let y=g??c;y=n&&r>0?Math.min(y,p):y,ee(this._tmpRayDir.direction,this._tmpRayDir.direction,y),le(i,this._tmpRayDir.origin,this._tmpRayDir.direction);let _=y*u;const v=Math.max(A5,1.01*e.nearFar[0]);if(r>0&&_<v&&(_=v,u=_/y),Math.abs(y-_)<1e-6)return;ee(this._tmpRayDir.direction,this._tmpRayDir.direction,d*(1-u)),e.eye=le(qR,e.eye,this._tmpRayDir.direction),e.center=le(qR,e.center,this._tmpRayDir.direction)}U2(this.view,e)}};PI=h([k("esri.views.3d.state.controllers.global.ZoomStepController")],PI);const qR=E(),WR=E();let CM;const px=new Map;async function qvt(t){CM==null&&(CM=he(()=>import("./VoxelWasmPerSceneView-2630b0f2.js"),[],import.meta.url));const e=t.view,r=px.get(e);return r?r.addVoxelLayer(t):(await CM.then(i=>{const s=new i.default({view:e});return px.set(e,s),s})).addVoxelLayer(t)}function e3(t){return px.get(t)}function Wvt(t){const e=t.view,r=px.get(e);r&&r.removeVoxelLayer(t)<1&&(px.delete(e),px.size===0&&(CM=null))}const UBe=.6,kBe=4,BBe=60;let MI=class extends Kf{constructor(){super(...arguments),this._zoomLocation=E(),this._tmpCamera=new ot,this._tmpRayDir=E(),this._tmpCenter=E(),this._constraintOptions={selection:_i.ALL,interactionType:jt.ZOOM,interactionFactor:null,interactionStartCamera:new ot,interactionDirection:null,tiltMode:$n.TUMBLE}}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(i.camera):this.animation.cameraAt(1,s)),this._tmpCamera.copyFrom(i.camera);const n=Du(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(r,this._zoomLocation,this.view.map.ground.opacity===0?Lv:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ie(this._zoomLocation,this._tmpCamera.center);const a=UBe**e;let l=this.view._stage.renderView.getMinimalDepthForArea(e3(this.view),r[0],r[1],this.view.state.camera,BBe);ce(YR,this._tmpCamera.eye,this._zoomLocation),pe(YR,YR);const c=me(Math.min(zme,1/Math.abs(de(zBe,YR)))*Math.abs(this.view.camera.position.z),Vme,Gme);if(l=l??c,l){const u=E();ce(u,this._zoomLocation,this._tmpCamera.eye),(l<_e(u)||!o)&&(pe(u,u),le(this._zoomLocation,this._tmpCamera.eye,ee(u,u,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:K3}}_updateCamera(e,r,i){ce(this._tmpRayDir,i,e.eye);const s=_e(this._tmpRayDir);let n=s*r;const o=r<=1,a=Math.max(kBe,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,r=n/s),Math.abs(s-n)<1e-6||(ee(this._tmpRayDir,this._tmpRayDir,r),e.eye=ce(dJ,i,this._tmpRayDir),e.center=$r(dJ,e.center,i,1-r),ws(this.view,e,this._constraintOptions)))}};MI=h([k("esri.views.3d.state.controllers.local.ZoomStepController")],MI);const dJ=E(),zBe=Te(0,0,1),YR=E();function VBe(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function oj(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let GBe=class extends Kn{constructor(e,r){super(!0),this._view=e,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(e){const r=e.data;if(VBe(r,"primary")){const i=this._view.state.isGlobal?new PI({view:this._view,mode:"animation"}):new MI({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),Vi(r.x,r.y)),e.stopPropagation()}}};function jBe(t,e,r){return t===$e.Global?new qBe(r):new HBe(e,r)}let HBe=class{constructor(e,r){this._elevationProvider=e,this._referenceEllipsoid=Mr(r),this._unitInMeters=qo(r,this._referenceEllipsoid.metersPerDegree)}compute(e,r,i,s,n){var T;n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=(T=this._elevationProvider)==null?void 0:T.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const u={x:(i=i??new Xr({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},d=Math.max(u.x,u.y,u.z);ce(Fy,r,e),cb[0]=Fy[0]>0?i.xmax:i.xmin,cb[1]=Fy[1]>0?i.ymax:i.ymin,cb[2]=Fy[2]>0?d/2:-d/2,ce(cb,cb,e),pe(Fy,Fy);const p=1.1*de(cb,Fy)*this._unitInMeters,g=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),_=y*XBe*this._unitInMeters,v=y*ZBe*this._unitInMeters,w=me((o-v)/(_-v),0,1)**3,x=Math.min(ft(g,p,w),g)*Math.max(Math.log(Math.abs(l)),1);return rge(Math.min(x,Math.max(34064e4,d))/this._unitInMeters,WBe,this._unitInMeters,n)}},qBe=class{constructor(e){this._referenceEllipsoid=Mr(e)}compute(e,r,i,s,n){n||(n={near:0,far:0});const o=_e(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),u=Math.max(c,Math.abs(a)),d=Math.sqrt(u*(u+2*l)),p=o+this._referenceEllipsoid.radius;return rge(1.2*ft(d,p,yG(u)),me(2e4-(Math.log(u)-7.983)/9.011*19e3,1e3,2e4),1,n)}};function rge(t,e,r,i){const s=YBe/r;return t/e>s?(i.far=t,i.near=i.far/e):(i.near=s,i.far=i.near*e),i}const WBe=2e4,YBe=2,XBe=.001,ZBe=1e-4,cb=E(),Fy=E();let AM=class extends xe{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const r=this.view.state.camera;e.spatialReference!=null&&dde(this.view,r,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>U2(this.view,e,wu.EYE_AND_CENTER))}};h([f({constructOnly:!0})],AM.prototype,"view",void 0),AM=h([k("esri.views.3d.state.ElevationCollisionConstraint")],AM);let qS=class extends xe{constructor(e){super(e),this.nearFarHeuristic=jBe(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([ae(()=>{var e,r,i,s;return[(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.near,(s=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:s.far]},()=>this._clipDistanceNearFarChanged()),ae(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),ae(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Fr),ae(()=>{var e,r,i,s;return[(r=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:r.min,(s=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:s.max]},()=>this._updateAltitude(),Fr),ae(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.max},()=>this._updateTiltMax(),Fr),ae(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.mode},()=>this._updateTilt(),Fr),ae(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),Fr),ae(()=>{var e,r,i,s,n,o;return[(i=(r=(e=this.view.map)==null?void 0:e.ground)==null?void 0:r.navigationConstraint)==null?void 0:i.type,(o=(n=(s=this.view.state)==null?void 0:s.constraints)==null?void 0:n.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),Fr)]),this.view.state.isLocal&&this.addHandles(ae(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),zr)),this._updateNearFar(),this.view.state.viewingMode!==$e.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new AM({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var r;const e=(r=this.view.constraints)==null?void 0:r.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>this._updateCameraNearFarManual(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const r=this.view.constraints&&this.view.constraints.clipDistance;(r?r.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,r):this._updateCameraNearFarAuto(e,r)}_updateCameraNearFarAuto(e,r){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,jD(this.view,e.eye),e),r&&r.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,r){r&&(e.near=r.near,e.far=r.far)}_updateCollision(){var s,n,o;const e=(o=(n=(s=this.view.map)==null?void 0:s.ground)==null?void 0:n.navigationConstraint)==null?void 0:o.type,r=!e||e==="stay-above",i=this.view.state.constraints.collision;if(r!==i.enabled){i.enabled=r,r&&this._reapplyConstraints(_i.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==$e.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const r=this.view.state.constraints;r.tilt=r.createConstantMaxTilt(At(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const r=this.view.state.constraints;if(r.tilt){const i=r.tilt(this.view.state.camera.distance).max;e.autoUpdate(_a(i))}}_updateLocalSurfaceDistance(e){if(e==null)return;let r=Math.max(e.width,e.height);if(r<=0)return;e.zmax!=null&&e.zmin!=null&&(r=Math.max(r,e.zmax-e.zmin));const i=this.view.state,s=3*r/Math.atan(i.camera.fov/2);s!==i.constraints.distance&&(i.constraints.distance=s)}_reapplyConstraints(e=_i.ALL){this.view.state.updateCamera(r=>ws(this.view,r,{selection:e,interactionType:jt.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:$n.TUMBLE}))}};h([f({constructOnly:!0})],qS.prototype,"view",void 0),h([f({readOnly:!0})],qS.prototype,"surfaceCollisionConstraint",void 0),qS=h([k("esri.views.3d.state.ConstraintsManager")],qS);let u0=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=WC(),this._points=Afe(),this.lines=new Array(12),this._origin=E(),this._direction=E(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:E(),endpoint:null}}update(e){Rfe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),ie(this._origin,e.eye),ie(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let r=0;r<this._points.length;r++)ie(this._points[r],e[r]);Ofe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return E0(this.frustum,e)}intersectsRay(e){return z8e(this.frustum,e)}intersectsLineSegment(e,r){return V8e(this.frustum,e,r)}intersectsPoint(e){return Pfe(this.frustum,e)}_updateLines(){const e=this._points;for(let r=0;r<4;r++){const i=r+4;R5(this.lines[r],e[r],e[i]),R5(this.lines[r+4],e[r],r===3?e[0]:e[r+1]),R5(this.lines[r+8],e[i],r===3?e[4]:e[i+1])}}};function R5(t,e,r){t.origin=e,t.endpoint=r,Rm(t.direction,e,r)}u0.planePointIndices=G8e,u0.nearFarLineIndices=[[He.NEAR_BOTTOM_LEFT,He.FAR_BOTTOM_LEFT],[He.NEAR_BOTTOM_RIGHT,He.FAR_BOTTOM_RIGHT],[He.NEAR_TOP_RIGHT,He.FAR_TOP_RIGHT],[He.NEAR_TOP_LEFT,He.FAR_TOP_LEFT]];let VE=class extends qf{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Ui.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||dde(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),U2(this.view,e,wu.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Ui.Stopped)})}};h([f({constructOnly:!0})],VE.prototype,"desiredCamera",null),VE=h([k("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],VE);function ige(t,e,r){const i=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=r;return a[0]=-i,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function JBe(t,e,r){return ige(t,e,r),$l(r,r),r}function Ol(t,e,r,i){if(t==null||i==null)return!1;const s=NC(t,Sue),n=NC(i,Q$e);if(s===n&&!pJ(n)&&(s!==W.UNKNOWN||hs(t,i)))return P3(r,e),!0;if(pJ(n)){const o=Dw[s][W.LON_LAT],a=Dw[W.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,lg,0),a(lg,0,cg,0),ige(XR*lg[0],XR*lg[1],r),r[12]=cg[0],r[13]=cg[1],r[14]=cg[2],!0)}if((n===W.WEB_MERCATOR||n===W.PLATE_CARREE)&&(s===W.WGS84||s===W.CGCS2000&&n===W.PLATE_CARREE||s===W.SPHERICAL_ECEF||s===W.WEB_MERCATOR)){const o=Dw[s][W.LON_LAT],a=Dw[W.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,lg,0),a(lg,0,cg,0),s===W.SPHERICAL_ECEF?JBe(XR*lg[0],XR*lg[1],r):Pu(r),r[12]=cg[0],r[13]=cg[1],r[14]=cg[2],!0)}return!1}function pJ(t){return t===W.SPHERICAL_ECEF||t===W.SPHERICAL_MARS_PCPF||t===W.SPHERICAL_MOON_PCPF}const XR=At(1),lg=E(),cg=E(),QBe=.66;function sge(t){return 360-H7.normalize(t)}function fN(t){return H7.normalize(360-t)}function KBe(t,e,r){const i=e.camera;if(i!=null)return tze(i,Im(t));const{targetGeometry:s}=e;if(s==null)return null;const{camera:n,mode:o}=nge(t,e.rotation,r);if(s.type==="point")return ize(t,e,s,n,o);const a=s.extent;return a==null?null:nM(t,a,n.heading,n.tilt,o)}async function eze(t,e,r,i){const s=e.camera;if(s!=null)return rze(s,Im(t),i);const{targetGeometry:n}=e;if(n==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:a}=nge(t,e.rotation,r);if(n.type==="point")return sze(t,e,n,o,a,i);const l=n.extent;if(l==null)throw new Error("Target geometry has no extent!");return kde(t,l,o.heading,o.tilt,a,i)}function tze(t,e){const r=t.position;let i;try{i=Pm(r,e)}catch{return null}const s=t.clone();return s.position=i.clone(),s}async function rze(t,e,r){const i=t.position,s=await kp(i,e,{signal:r});wt(r);const n=t.clone();return n.position=s.clone(),n}function nge(t,e,r){const i=Xx(t,t.state.camera);let s=fo.ADJUST;return e!=null&&(i.heading=sge(e),s=fo.LOCKED),r!=null&&(i.tilt=r),{camera:i,mode:s}}function ize(t,e,r,i,s){const n=t.spatialReference;let o;try{o=Pm(r.clone(),n)}catch{return null}const a=e.scale!=null?HD(t,e.scale,o.latitude):t.state.camera.distance;return B4e(t,o,a,i,s)}async function sze(t,e,r,i,s,n){const o=t.spatialReference,a=await kp(r.clone(),o,{signal:n});wt(n);const l=e.scale!=null?HD(t,e.scale,a.latitude):t.state.camera.distance;return Rde(t,a,l,i,s,n)}function nze(t,e,r=null){return r==null&&(r=new id),cj(t,null,e.clone(),r)}async function oze(t,e,r){const i=gze(t,e);if(!i)throw new X("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new Il({fov:t.camera.fov}),n=new id({camera:s});if(i.target instanceof id)return Uy(await cze(t,i.target,i,r,n));if(i.target instanceof Il)return Uy(await age(t,i.target,r,n));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof Xr){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return Uy(o||c?await fB(t,i,i.target.center,s,r,n):await pze(t,i,i.target,s,r,n))}const a={boundingBox:ui(),hasZ:!1,screenSpaceObjects:[]},l=o?aze(t,i):void 0;if(await oge(t,i.target,l,a,r),isFinite(a.boundingBox[0])){let c;if(Bh(a.boundingBox,ls),ic.x=ls[0],ic.y=ls[1],ic.z=ls[2],ic.spatialReference=t.spatialReference,isFinite(ic.z)&&a.hasZ?c=uV(a.boundingBox):(ic.z=void 0,c=PAe(cV(a.boundingBox,_ze))),o||c)return Uy(await fB(t,i,ic,s,r,n));const u=yze(t,a.screenSpaceObjects);return Uy(await mze(t,i,ic,a.boundingBox,u,s,r,n))}return i.position?Uy(await hze(t,i,s,n,r)):Uy(await dze(t,i,s,r,n))}function aj(t,e){return e.scale==null&&e.zoom!=null?jde(t,e.zoom):e.scale}function aze(t,e){const r=aj(t,e);return r?$Le(r):void 0}function lj(t,e){let r=!1;return e.heading!=null?(t.heading=e.heading,r=!0):e.rotation!=null&&(t.heading=sge(e.rotation),r=!0),e.tilt!=null&&(t.tilt=e.tilt,r=!0),e.fov!=null&&(t.fov=e.fov),r}function cj(t,e,r,i){const s=t.spatialReference||at.WGS84;return(e=e??Bf(t,r))==null||(i.targetGeometry=bm(e.center,t.renderSpatialReference,s),i.scale=Hde(t,e),i.rotation=fN(r.heading),i.camera=r),i}async function $I(t,e,r,i){var d;const s=()=>new X("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw s();e.type==="mesh"&&(e=e.extent);const n=e.spatialReference,o=t.spatialReference,a=t.basemapTerrain.spatialReference;if(!e.hasZ&&t.basemapTerrain){let p;switch(e.type){case"point":p=e;break;case"multipoint":case"polyline":p=(d=e.extent)==null?void 0:d.center;break;case"extent":p=e.center;break;case"polygon":p=e.centroid}p!=null&&a!=null&&t.elevationProvider!=null?(p=await kp(p,a,{signal:i}),ls[2]=_p(t.elevationProvider,p)??0):ls[2]=0}const l=vze[e.type],c=new Array;if(l(e,e.hasZ?p=>{c.push([p[0],p[1],p[2]])}:p=>{c.push([p[0],p[1]])},ls),c.length===0)throw s();const u=await kp(new S2({spatialReference:n,hasZ:e.hasZ,hasM:!1,points:c}),o,{signal:i});if(e.hasZ&&(r.hasZ=!0),e.hasZ)for(const[p,g,y]of u.points)ls[0]=p,ls[1]=g,ls[2]=y,rd(r.boundingBox,ls);else for(const[p,g]of u.points)ls[0]=p,ls[1]=g,rd(r.boundingBox,ls)}async function lze(t,e,r,i,s){const n=await mm(t.whenViewForGraphic(e));if(n.ok===!1||n.value==null||!("whenGraphicBounds"in n.value))return void await $I(t,e.geometry,i,s);const o=n.value,a=await mm(o.whenGraphicBounds(e,{minDemResolution:r}));if(a.ok===!1||!a.value)return void await $I(t,e.geometry,i,s);const{screenSpaceObjects:l,boundingBox:c}=a.value;Dx(i.boundingBox,c),l&&l.forEach(u=>{i.screenSpaceObjects.push(u)}),isFinite(c[2])&&(i.hasZ=!0)}async function oge(t,e,r,i,s){var n;if(Array.isArray(e)&&e.length===2){const o=e[0],a=e[1];if(typeof o=="number"&&typeof a=="number")return ic.x=o,ic.y=a,ic.z=void 0,ic.spatialReference=(n=t.spatialReference)!=null&&n.isGeographic?t.spatialReference:at.WGS84,void await $I(t,ic,i,s)}e&&"map"in e&&typeof e.map=="function"?await Promise.allSettled(e.map(o=>oge(t,o,r,i,s))):e instanceof uy?await $I(t,e,i,s):e instanceof iv&&await lze(t,e,r,i,s)}async function cze(t,e,r,i,s){if(e.camera!=null)return age(t,e.camera,i,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,s.camera=null,r.heading!=null?s.rotation=fN(r.heading):r.rotation!=null&&(s.rotation=r.rotation);const n=aj(t,r);return n!=null&&(s.scale=n),s.camera=await eze(t,s,r.tilt,i),s}async function age(t,e,r,i){const s=t.spatialReference,n=await kp(e.position,s,{signal:r});return(e=e.clone()).fov=t.camera.fov,e.position=n,cj(t,null,e,i)}async function uze(t,e,r,i,s,n,o){const a=t.renderSpatialReference;return await oI(e,O5,a,0,{signal:o}),await oI(r,JR,a,0,{signal:o}),n.targetGeometry=new nt(e),s.position=new nt(r),ce(II,O5,JR),qD(t,JR,II,i.up,s),n.scale=nv(t,hi(JR,O5),n.targetGeometry.latitude),n.rotation=fN(s.heading),n.camera=s,n}async function fB(t,e,r,i,s,n){if(r==null)throw new X("createfromcenter","invalid point");n.targetGeometry=r.clone();const o=Pv(t);if(e.position)return uze(t,n.targetGeometry,e.position,o,i,n,s);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=ee(ls,o.viewForward,-l);o.eye=le(ls,o.center,c),n.scale=nv(t,l,r.latitude)}Xx(t,o,i);const a=lj(i,e)?fo.LOCKED:fo.ADJUST;if(!e.zoomFactor){const l=aj(t,e);if(l==null){const{renderSpatialReference:c}=t;await oI(r,ls,c,0,{signal:s}),Pfe(o.frustum,ls)?n.scale=nv(t,hi(o.eye,ls),r.latitude):n.scale=Hde(t,o)}else n.scale=l;n.camera=await Ade(t,n.targetGeometry,n.scale,i,a,s)}return n}async function hze(t,e,r,i,s){const n=Pv(t);ie(II,n.viewForward),qD(t,n.eye,II,n.up,P5);const o=t.spatialReference,{position:a}=e;if(a){const l=await kp(a,o,{signal:s});r.position=l}else r.position=new nt;return r.heading=e.heading!=null?e.heading:P5.heading,r.tilt=e.tilt!=null?e.tilt:P5.tilt,cj(t,null,r,i)}async function dze(t,e,r,i,s){const n=Pv(t),{spatialReference:o,renderSpatialReference:a}=t;return fB(t,e,bm(n.center,a,o),r,i,s)}async function pze(t,e,r,i,s,n){n.targetGeometry=r.clone();const o=Pv(t);Xx(t,o,i);const a=lj(i,e)?fo.LOCKED:fo.ADJUST;return n.camera=await kde(t,r,i.heading,i.tilt,a,s),n}function fze(t,e,r,i,s){let n=0;r.z!=null?n=r.z:t.basemapTerrain&&t.elevationProvider&&(n=_p(t.elevationProvider,r)),se(ls,r.x,r.y,n),Ol(t.spatialReference,ls,fJ,t.renderSpatialReference),Iu(ZR,fJ),Lu(ZR,ZR),ui(bT);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const _=o[y];let v=i[_[2]];isFinite(v)||(v=n),se(ls,i[_[0]],i[_[1]],v),mo(ls,t.spatialReference,ls,t.renderSpatialReference),rd(bT,Sl(ls,ls,ZR))}const a=Tv(bT),l=dy(bT),c=Sv(bT),u=1/Math.tan(e.fovX/2),d=1/Math.tan(e.fovY/2),p=.5*Math.sqrt(a*a+c*c)*Math.max(d,u)+.5*l,g=.5*l*d+.5*Math.max(a,c);return Math.max(p,g)/s}async function mze(t,e,r,i,s,n,o,a){a.targetGeometry=r.clone();const l=Pv(t),c=fze(t,l,r,i,s);Xx(t,l,n);const u=lj(n,e)?fo.LOCKED:fo.ADJUST;return a.scale=nv(t,c,a.targetGeometry.latitude),a.camera=await Ade(t,a.targetGeometry,a.scale,n,u,o),a}function gze(t,e){if(!e||!t.spatialReference)return null;const r={target:void 0};return"declaredClass"in e||Array.isArray(e)?r.target=e:(Object.assign(r,e),e.center&&!r.target&&(r.target=e.center)),r}function Uy(t){return(t==null?void 0:t.camera)!=null&&(t.rotation=fN(t.camera.heading)),t}function yze(t,e){const r=QBe;if(!e.length)return r;let i=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;i=Math.max(i,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return r-i/Math.min(t.width,t.height)*2}const ls=E(),fJ=ge(),ZR=Fi(),bT=tn(),_ze=Gt(),II=E(),JR=E(),O5=E(),P5={heading:0,tilt:0},ic=new nt,vze={point(t,e,r){r[0]=t.x,r[1]=t.y,t.z!=null&&(r[2]=t.z),e(r)},polygon(t,e,r){const i=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},polyline(t,e,r){const i=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},multipoint(t,e,r){const i=t.points,s=t.hasZ;for(let n=0;n<i.length;n++)r[0]=i[n][0],r[1]=i[n][1],s&&(r[2]=i[n][2]),e(r)},extent(t,e,r){t.zmin!=null&&t.zmax!=null?(e(se(r,t.xmin,t.ymin,t.zmin)),e(se(r,t.xmax,t.ymin,t.zmin)),e(se(r,t.xmin,t.ymax,t.zmin)),e(se(r,t.xmax,t.ymax,t.zmin)),e(se(r,t.xmin,t.ymin,t.zmax)),e(se(r,t.xmax,t.ymin,t.zmax)),e(se(r,t.xmin,t.ymax,t.zmax)),e(se(r,t.xmax,t.ymax,t.zmax))):(e(se(r,t.xmin,t.ymin,r[2])),e(se(r,t.xmax,t.ymin,r[2])),e(se(r,t.xmin,t.ymax,r[2])),e(se(r,t.xmax,t.ymax,r[2])))}};let bze=class{constructor(e,r,i){this.target=e,this.options=r,this.view=i,this.state="pending",this._animationController=null,this.promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;this.options.signal!=null&&Uo(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(ur())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await Fx(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}async createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null;try{const e=await oze(this.view,this.target,this._abortController.signal);if(this.state==="finished")return;const r=e?this._getCameraFromViewpoint(e):null;if(r==null)return;if(this.options.animate){if(this._animationController==null)return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()}catch(e){this.reject(e)}}}_getCameraFromViewpoint(e){var n;const r=!!(this.target instanceof id&&this.target.camera||this.target instanceof Il),i=e.camera;if(i==null)return null;if(!this.view.stateManager.isCompatible(i)){const o=i.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(n=this.view.spatialReference)==null?void 0:n.wkid;return this.reject(new X("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:i})),null}const s=Bf(this.view,i);return s==null?(this.reject(new X("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:r}}startAnimation(e,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(i==null)return void this.reject(new X("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!r.active||r.viewAnimation==null||r.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==r)return this.abort();let s;e.isFullySpecified?(s=new VE({view:this.view,desiredCamera:e.camera}),U2(this.view,e.camera,wu.EYE_AND_CENTER)):ws(this.view,e.camera),r.begin(e.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof Kf&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):r.viewAnimation!=null&&r.viewAnimation.target===e.viewpoint&&r.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(this.view.state!=null)switch(r.state){case Ui.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Ui.Ready:case Ui.Rejected:case Ui.Running:case Ui.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(n,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,r=null;const i=this.view.state.cameraController;return i instanceof Kf&&(i.updateStateFromViewAnimation(),i.active&&(e=i,r=e.viewAnimation)),e!=null||(e=new Kf({view:this.view,mode:"animation"}),r=e.viewAnimation,this.view.state.switchCameraController(e))?e:(r!=null&&r.stop(),this.reject(new X("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},B2=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,r){var i;return(i=this._outer.get(e))==null?void 0:i.get(r)}set(e,r,i){const s=this._outer.get(e);s?s.set(r,i):this._outer.set(e,new Map([[r,i]]))}delete(e,r){const i=this._outer.get(e);i&&(i.delete(r),i.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((r,i)=>e(r,i))}};var $s;function M5(t=!te("disable-feature:high-quality-idle"),e=null){const r=new B2;return t?(r.set(xr.IDLE,$s.Antialiasing,e!=="low"),r.set(xr.IDLE,$s.HighResolutionAtmosphere,e!=="low"),r.set(xr.IDLE,$s.HighQualityTransparency,!0),r.set(xr.IDLE,$s.SSAO,!0),r.set(xr.IDLE,$s.WaterReflection,!0),r.set(xr.IDLE,$s.PhysicalPixelRendering,!0)):(r.set(xr.ANIMATING,$s.HighResolutionShadows,!0),r.set(xr.INTERACTING,$s.HighResolutionShadows,!0)),r.set(xr.IDLE,$s.HighResolutionShadows,!0),r.set(xr.IDLE,$s.HighResolutionVoxel,!0),r}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})($s||($s={}));let ks=class extends xe{get camera(){const e=this._get("camera");if(!this.ready)return e;const r=Xx(this.view,this.view.state.camera,$5);return r&&e&&r.equals(e)?e:r.clone()}set camera(e){var r,i;this._updatePropertyBeforeReady("camera",e)||((r=this.view.elevationProvider)==null||r.enableElevationCache(!0),this.setStateCamera(Bf(this.view,e),{applyConstraints:!1})||ne.getLogger(this).error("#camera=","Invalid camera",e),(i=this.view.elevationProvider)==null||i.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const r=Xx(this.view,this.view.state.contentCamera,$5);return r&&e&&r.equals(e)?e:r.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const r=Bf(this.view,e);r!=null?(this._updateElevation(r),this.view.state.contentCamera=r):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(I5),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const r=this.zoom,i=this.view.state.camera.distance**2,s=Oo(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([ae(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(I5),this.test.contentCameraResetState.clear())}),ae(()=>this.zoom,o=>{o!==void 0&&r!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-r)/2),Math.abs(o-r)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),ae(()=>this.view.state.camera,o=>{const a=Yn(s,o.center);this.test.contentCameraResetState.set("camera.center",a/i),a>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],I5),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var r;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():ne.getLogger(this).error("#center=","Invalid center",e):ne.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):ne.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,r=Bde(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return r??this._get("extent")}set extent(e){var r;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||ne.getLogger(this).error("#extent=","Invalid extent",e):ne.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):ne.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get _initialViewpoint(){var r;const e=this.view.map;return e&&"initialViewProperties"in e?(r=e.initialViewProperties)==null?void 0:r.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return nv(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||ne.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,r=e.padding,i=e.pixelRatio,s=this._get("padding"),n=Math.round(r[Yt.TOP]/i),o=Math.round(r[Yt.RIGHT]/i),a=Math.round(r[Yt.BOTTOM]/i),l=Math.round(r[Yt.LEFT]/i);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,QR),this.view.state.updateCamera(r=>r.padding=QR))}_paddingToArray(e,r,i){e?Si(i,e.top||0,e.right||0,e.bottom||0,e.left||0):Si(i,0,0,0,0);for(let s=0;s<4;s++)i[s]=Math.round(i[s]*r)}get screenCenter(){const e=this.padding;return Ou((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?nze(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var r;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||ne.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const i=e.camera!=null?e.camera.position:e.targetGeometry,s=i!=null&&i.spatialReference;ne.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(s?s.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e)}else ne.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?Y4e(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||ne.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),r=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*r),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*r);const i=this.view._stage.renderView.renderingContext.parameters.maxTextureSize;return _1(this._tmpCanvasSize,i),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:r,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,r;return((r=(e=this.view)==null?void 0:e._stage)==null?void 0:r.renderer.isFeatureEnabled($s.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var r,i;const e=(i=(r=this.view)==null?void 0:r._stage)==null?void 0:i.renderer;return e&&(e.isFeatureEnabled($s.PhysicalPixelRendering,xr.IDLE)||e.isFeatureEnabled($s.PhysicalPixelRendering,xr.INTERACTING)||e.isFeatureEnabled($s.PhysicalPixelRendering,xr.ANIMATING))}constructor(e){super(e),this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=mJ,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:r=>this._devicePixelRatioOverride=r,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(r){this.viewStateManager._idleTimeout=r?mJ:0}},this._propertiesPool=new xm({frustum:u0},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new wze}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Bo(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),ae(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,r)=>this._cameraChangedHandler(e,r),Fr)]),$u(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([B1({prepare:()=>this._prepareFrame()}),ae(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(KR)}),Bo(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Oe(this._propertiesPool)}init(){this.constraintsManager=new qS({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const r of e)this.set(r.name,r.value);if(!this._cameraSetByUser){const r=this._initialViewpoint||this.view.initialExtent;r&&this.isCompatible(r)?this._setInitialView(r):this.view.state.viewingMode===$e.Local&&this.addHandles($u(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(KR),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),KR)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(KR),this.constraintsManager=Oe(this.constraintsManager))}async goTo(e,r){const i={animate:!0,...r};return this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new bze(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(Pv(this.view),{applyConstraints:!1})}step(e){const r=this.view.state,i=r==null?void 0:r.cameraController;i&&(r.updateCamera(s=>i.stepController(e,s)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,r=[];for(const{propertyName:i,overrides:s}of Tze){const n=e.has(i),o=this._isOverridden(i);!n&&o&&r.push({name:i,value:this._get(i)}),this._clearOverride(i),(n||o)&&s.forEach(a=>e.add(a))}return r}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof Il)return void this.setStateCamera(Bf(this.view,e),{applyConstraints:!1});if(e instanceof id){if(e.targetGeometry instanceof Xr){const n=nM(this.view,e.targetGeometry,0,.5,fo.LOCKED);return void(n!=null&&this.setStateCamera(Bf(this.view,n),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,i)}const r=nM(this.view,e,0,.5,fo.LOCKED);r!=null&&this.setStateCamera(Bf(this.view,r),{applyConstraints:!0})}_updatePropertyBeforeReady(e,r){return!this.ready&&(this._override(e,r),r&&xze.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof id?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Il?this.isCompatible(e.position):e.spatialReference&&vE(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=Sze){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,r,i=ug){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=aG(this.view,s,n,e,r,fo.ADJUST);return o==null?null:(i.copyFrom(this.view.state.camera),i.eye=o.eye,i.center=o.center,i.up=o.up,i)}_centerToCamera(e){const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:r,tilt:i}=this._getPreservingHeadingTilt(),s=nM(this.view,e,r,i,fo.ADJUST,$5);return s?Bf(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.renderLocation,s=r.location.latitude;if(s==null)return null;const n=HD(this.view,e,s);return this._centerPointAtDistanceToCamera(i,n)}_zoomToCamera(e){return this._scaleToCamera(jde(this.view,e))}_viewpointToCamera(e){return Bf(this.view,KBe(this.view,e))}setStateCamera(e,r){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,r.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{r.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),r.applyConstraints&&ws(this.view,i)}),r.applyConstraints||(this.view.state.cameraController=new VE({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:r}=this.view;if(!e||!r)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._computeCanvasSize();if(i.width!==0&&i.height!==0&&(r.width===i.width&&r.height===i.height||(r.width=i.width,r.height=i.height),this.view.state)){const s=this.view.state.camera;s.fullWidth===i.width&&s.fullHeight===i.height&&s.pixelRatio===i.pixelRatio||(ug.copyFrom(s),ug.pixelRatio!==i.pixelRatio&&(this._paddingToArray(this.padding,i.pixelRatio,QR),ug.padding=QR),ug.fullWidth=i.width,ug.fullHeight=i.height,ug.pixelRatio=i.pixelRatio,this.view.state.camera=ug),this._updateViewState()}}_updateElevation(e){var n,o;const r=(n=this.view.basemapTerrain)==null?void 0:n.spatialReference,i=((o=this.view.renderCoordsHelper)==null?void 0:o.getAltitude(e.eye))??0,s=r?jD(this.view,e.eye):0;e.relativeElevation=i-s}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=xr.ANIMATING:this.view.interacting?this.view.state.mode=xr.INTERACTING:(this.view.state.mode===xr.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=xr.INTERACTING:this.view.state.mode=xr.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,r){e&&r&&e.almostEquals(r)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};h([f({type:Il,dependsOn:["view.state.camera","ready"]})],ks.prototype,"camera",null),h([f({type:Il,dependsOn:["view.state.contentCamera","ready"]})],ks.prototype,"contentCamera",null),h([f({type:nt})],ks.prototype,"center",null),h([f({type:Xr})],ks.prototype,"extent",null),h([f({readOnly:!0})],ks.prototype,"frustum",null),h([f()],ks.prototype,"_initialViewpoint",null),h([f({readOnly:!0})],ks.prototype,"hasInitialView",null),h([f({readOnly:!0,type:Boolean})],ks.prototype,"ready",void 0),h([f({type:Number})],ks.prototype,"scale",null),h([f()],ks.prototype,"padding",null),h([f({readOnly:!0})],ks.prototype,"screenCenter",null),h([f({constructOnly:!0})],ks.prototype,"view",void 0),h([f({type:id})],ks.prototype,"viewpoint",null),h([f({type:Number})],ks.prototype,"zoom",null),h([f({readOnly:!0})],ks.prototype,"_rasterPixelRatio",null),h([f({readOnly:!0})],ks.prototype,"_usePhysicalPixelRendering",null),h([f({readOnly:!0})],ks.prototype,"_usePhysicalPixelRenderingAny",null),h([f()],ks.prototype,"_windowDevicePixelRatio",void 0),h([f()],ks.prototype,"_devicePixelRatioOverride",void 0),ks=h([k("esri.views.3d.state.ViewStateManager")],ks);let wze=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const xze=new Set(["camera","viewpoint","extent","scale","center","zoom"]),Tze=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Sze={heading:0,tilt:0},$5=new Il,ug=new ot,QR=Jt(),KR="pending-initial-view",I5="content-camera-reset",mJ=300,gJ=100;let bp=class extends qf{constructor(){super(...arguments),this.startCamera=new ot,this.currentCamera=new ot,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<gJ}stepController(e,r){r.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(r)}onControllerStart(e){this.state=Ui.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),gJ),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};h([f({readOnly:!0})],bp.prototype,"isInteractive",null),h([f()],bp.prototype,"_lastInteraction",void 0),bp=h([k("esri.views.3d.state.controllers.InteractiveController")],bp);var yl;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(yl||(yl={}));let GE=class extends bp{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=yl.CENTER,this._rotScale=0,this._lastPoint=ke(),this._tmpWorldUp=E(),this._tmpViewDir=E(),this._tmpRotCurPoint=ke(),this._tmpTransf=ge(),this._tmpAxis=E(),this._tmpPivotPoint=E(),this._pivotPos=E(),this._constraintOptions={selection:_i.ALL,interactionType:jt.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:$n.TUMBLE}}initialize(){this._rotScale=this.pivot===yl.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case yl.EYE:ie(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=jt.LOOK_AROUND,this._constraintOptions.tiltMode=$n.LOOK_AROUND,this._constraintOptions.selection=_i.NONE;break;case yl.CENTER:{const r=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?Lv:{});r||ie(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,r),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=jt.TUMBLE,this._constraintOptions.tiltMode=$n.TUMBLE,this._constraintOptions.selection=_i.ALL&~_i.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,$1(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,r){const i=this.startCamera,s=E();ce(s,this._pivotPos,i.eye);const n=_e(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,yJ);let a=Math.max(Math.min(RBe,1/Math.abs(de(yJ,i.viewForward)))*o,OBe);r&&(a=Math.min(n,a));const l=Mr(this.view.spatialReference),c=Vi(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),u=pN(this.startCamera,c,l);let d=this.view._stage.renderView.getMinimalDepthForArea(e3(this.view),i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*S5,S5),p=this.view._stage.renderView.getMinimalDepthForArea(e3(this.view),e[0],e[1],i,S5);d==null&&p==null||(d=d??p??0,p=p==null||u===On.Horizontal?d:p,a=d>p?p:d,a=r?Math.min(a,n):a),pe(s,s),ie(this._pivotPos,le(this._tmpPivotPoint,i.eye,ee(this._tmpPivotPoint,s,a)))}update(e){if(this.active){switch(this.pivot){case yl.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case yl.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}ws(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,r,i,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),$1(e,r,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;ce(this._tmpViewDir,i,s);const a=_e(this._tmpViewDir),l=un(de(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===yl.EYE){n*=-.5;const c=.5*Math.PI-l,u=.5*Math.PI*.99;n=c-Math.max(-u,Math.min(u,c+n))}return n=me(n+l,ao.min,ao.max)-l,rt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===yl.CENTER&&(o=-o),Mc(this._tmpTransf,o,this._tmpWorldUp),El(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),De(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=De(L5,e.up,this._tmpTransf),le(L5,s,this._tmpViewDir),Ns(this._lastPoint,this._tmpRotCurPoint),L5}};h([f()],GE.prototype,"pivot",void 0),GE=h([k("esri.views.3d.state.controllers.RotateController")],GE);const L5=E(),yJ=E();let D5=class extends Kn{constructor(e,r,i,s){super(!0),this._view=e,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!oj(e.data,this.pointerAction))return;const i=Vi(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new GE({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},mB=class extends bp{constructor(){super(...arguments),this._pickPoint=E(),this._tmpP0=ke(),this._panAxisAngle=hN(),this._tmpRayDir=E(),this._tmpRayDirPick=E(),this._targetOnSphere=E(),this._navMode=On.Horizontal,this._tmpRay={origin:E(),direction:E()},this.dragBeginPoint=Vi(),this._normalizedAnchorPoint=ke(),this._constraintOptions={selection:_i.ALL_EXCEPT_COLLISION,interactionType:jt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:$n.TUMBLE},this._sphere=ds(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Ns(this.dragBeginPoint,e),$1(this.startCamera,e,this._normalizedAnchorPoint);const r=Mr(this.view.spatialReference),i=Yme(this._intersectionHelper,this.startCamera,e,r,r2.Ellipsoid,this.view.map.ground.opacity===0?Lv:{});if(this._navMode=pN(this.startCamera,e,r),this._navMode===On.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=i.scenePickPoint??this._pickPoint,this._sphere=i.sphere;else{let s;k2(this.startCamera,e,this._tmpRay),pe(this._tmpRay.direction,this._tmpRay.direction),i.scenePickPoint!=null&&(ce(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),s=_e(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,_J);let o=me(Math.min(Bme,1/Math.abs(de(_J,this._tmpRay.direction)))*n,CI[0],CI[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,dN);o=a??o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,ee(this._tmpRay.direction,this._tmpRay.direction,o),le(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===On.Horizontal){ce(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const r=_e(this._tmpRayDir);$1(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;if(this._hasPickPoint&&s<r){const o=1-(1-s/r)*(1-this._sphere[3]/_e(this.currentCamera.center));this.currentCamera.center=ee(eO,this.currentCamera.center,o)}ee(this._tmpRayDir,this._tmpRayDir,-s/r),this.currentCamera.eye=le(eO,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Ih(X0(this.dragBeginPoint,e)),ws(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(KC(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),KG(this._pickPoint,this._targetOnSphere,this._panAxisAngle),ry(this.currentCamera,this._sphere,this._panAxisAngle))}else{const r=_e(this._tmpRay.direction);$1(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;ee(this._tmpRayDir,this._tmpRay.direction,1-s/r),this.currentCamera.eye=le(eO,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=le(eO,this.currentCamera.center,this._tmpRayDir)}U2(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};mB=h([k("esri.views.3d.state.controllers.global.ZoomController")],mB);const eO=E(),_J=E();let gB=class extends bp{constructor(){super(...arguments),this._tmpP=E(),this._tmpDir=E(),this._tmpN=E(),this._tmpP0=ke(),this._tmpPoi=E(),this._tmpRayDir=E(),this.dragBeginPoint=Vi(),this._normalizedAnchorPoint=ke(),this._constraintOptions={selection:_i.ALL,interactionType:jt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:E(),tiltMode:$n.TUMBLE},this._plane=wr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Ns(this.dragBeginPoint,e),$1(this.startCamera,e,this._normalizedAnchorPoint);const r=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?Lv:{});ce(this._tmpDir,this._tmpP,this.startCamera.eye);const i=_e(this._tmpDir);pe(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=me(Math.min(Bme,1/Math.abs(de(Eze,this._tmpDir)))*s,CI[0],CI[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(e3(this.view),e[0],e[1],this.view.state.camera,dN);n=o??n,n=r?Math.min(n,i):n,ee(this._tmpDir,this._tmpDir,n),le(this._tmpP,this.startCamera.eye,this._tmpDir),ce(this._tmpN,this.startCamera.eye,this.startCamera.center),pe(this._tmpN,this._tmpN),this._tmpN[1]<0&&ko(this._tmpN,this._tmpN),G3(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;PBe(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ie(this._tmpPoi,this.currentCamera.center),$1(this.currentCamera,e,this._tmpP0);let r=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Ns(this._normalizedAnchorPoint,this._tmpP0),ce(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=_e(this._tmpRayDir);let s=i*(1-r);this._constraintOptions.interactionDirection&&(ie(this._constraintOptions.interactionDirection,this._tmpRayDir),ee(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(r)/i));const n=this.view.state.constraints.minimumPoiDistance;r>=0&&s<n&&(s=n,r=-(s-i)/i),Math.abs(i-s)<1e-6||(ee(this._tmpRayDir,this._tmpRayDir,r),this.currentCamera.eye=le(ky,this.currentCamera.eye,this._tmpRayDir),$r(ky,this.currentCamera.center,this._tmpPoi,r),this._tmpPoi[2]>this.startCamera.center[2]?ky[2]=Math.max(this.startCamera.center[2],ky[2]):ky[2]=Math.min(this.startCamera.center[2],ky[2]),this.currentCamera.center=ky,this._constraintOptions.interactionFactor=Ih(X0(this.dragBeginPoint,e)),ws(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};gB=h([k("esri.views.3d.state.controllers.local.ZoomController")],gB);const ky=E(),Eze=Te(0,0,1);let Cze=class extends Kn{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!oj(e.data,this.pointerAction))return;const i=Vi(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new mB({view:this._view}):this._cameraController=new gB({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function Zu(t){let e=t*t;return t<0&&(e*=-1),e}function vJ(t,e,r){const i=r,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(i.translation[0]=Zu(s.axes[0]),i.translation[1]=Zu(s.axes[1]),i.translation[2]=Zu(s.buttons[7])-Zu(s.buttons[6]),i.heading=Zu(s.axes[2]),i.tilt=Zu(s.axes[3])):n.deviceType==="spacemouse"&&(i.translation[0]=1.2*Zu(s.axes[0]),i.translation[1]=1.2*Zu(s.axes[1]),i.translation[2]=2*-Zu(s.axes[2]),i.heading=1.2*Zu(s.axes[5]),i.tilt=1.2*Zu(s.axes[3])),i.tilt*=o,ee(i.translation,i.translation,a),i}function bJ(t,e){const r=e;return r.translation[0]=t[1]-t[0],r.translation[1]=t[3]-t[2],r.translation[2]=t[4]-t[5],r.heading=t[7]-t[6],r.tilt=t[8]-t[9],r.zoom=t[10]-t[11],r}function N5(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let v1=class extends bp{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new ot,this._headingStart=0,this._constraintOptions={selection:_i.ALL,interactionType:jt.NONE,interactionStartCamera:new ot,interactionFactor:0,interactionDirection:null,tiltMode:$n.LOOK_AROUND}}handleEventGamepad(e){const r=vJ(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||N5(r))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,bJ(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const r=bJ(this._keysButtonState,this._transformation);N5(r)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const r=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(r-this._filteredSurfaceElevation)*e}stepController(e,r){var i;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(r),this._updateCameraCenter(),(i=this._constraintOptions.interactionStartCamera)==null||i.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,By),this._applyDisabledMovementTypes(By),this._applyPan(By.pan),this._applyRotate(By.rotate),this._applyZoom(By.zoom),this._applyAscend(By.ascend),this._constraintOptions.interactionType=jt.NONE,this._constraintOptions.selection=_i.COLLISION,ws(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,r)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const r=this.currentCamera;ce(wa,r.center,r.eye),De(wa,wa,e.matrix),r.center=le(wa,wa,r.eye),r.up=De(wa,r.up,e.matrix),this._constraintOptions.interactionType=jt.LOOK_AROUND,this._constraintOptions.selection=_i.ALL_EXCEPT_COLLISION,ws(this.view,r,this._constraintOptions)}_applyPan(e,r=this.currentCamera){e.enabled&&(r.eye=De(wa,r.eye,e.matrix),r.center=De(wa,r.center,e.matrix),this.view.state.isGlobal&&(r.up=De(wa,r.up,e.matrix)),this._constraintOptions.interactionType=jt.PAN,this._constraintOptions.selection=_i.ALL,ws(this.view,r,this._constraintOptions))}_applyZoom(e){if(!e)return;const r=this.currentCamera.viewForward;this.currentCamera.eye=le(wa,this.currentCamera.eye,ee(Le.get(),r,e)),ie(wT,r),ko(wT,wT),this._constraintOptions.interactionDirection=wT,this._constraintOptions.interactionType=jt.ZOOM,this._constraintOptions.selection=_i.ALL_EXCEPT_COLLISION,ws(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const r=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Le.get());if(this._constraintOptions.interactionDirection=ie(wT,r),this.view.state.isGlobal){const i=_e(this.currentCamera.eye),s=(i+e)/i;this.currentCamera.eye=ee(wa,this.currentCamera.eye,s),this.currentCamera.center=ee(wa,this.currentCamera.center,s)}else{const i=ee(Le.get(),r,e);this.currentCamera.eye=le(wa,this.currentCamera.eye,i),this.currentCamera.center=le(wa,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=jt.ASCEND,this._constraintOptions.selection=_i.COLLISION,ws(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=_i.ALL_EXCEPT_COLLISION,ws(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,r,i){Ize(i);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,r,i):this._calculateControlTransformationGlobal(s,r,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,r=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=r.intersectManifoldClosestSilhouette(i,e,wa)}_calculateControlTransformationLocal(e,r,i){const{viewRight:s,viewForward:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=se(Le.get(),n[0],n[1],0);pe(l,l);const c=o.translation[0]*e.pan;if(c!==0){const _=ee(Le.get(),s,c);Ya(i.pan.matrix,i.pan.matrix,_),i.pan.enabled=!0}switch(a.mode){case"pan":{const _=-o.translation[1]*e.pan;if(_!==0){const v=ee(Le.get(),l,_);Ya(i.pan.matrix,i.pan.matrix,v),i.pan.enabled=!0}i.zoom=o.zoom*e.zoom;break}case"zoom":i.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const u=o.translation[2]*e.ascend;i.ascend=u;const d=-o.heading*e.rotate;d!==0&&(El(i.rotate.matrix,i.rotate.matrix,d,this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Le.get())),i.rotate.enabled=!0);const p=o.tilt*e.rotate,g=ty(this.view.renderCoordsHelper,r.center,r.eye),y=me(g+p,ao.min,ao.max)-g;y&&(El(i.rotate.matrix,i.rotate.matrix,y,s),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,r,i){const{eye:s,viewRight:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=rt(Le.get(),n,s);pe(l,l),ko(l,l),NBe(this.startCamera,r,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(By.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,u=o.translation[2]*e.ascend;i.ascend=u;const d=-o.heading*e.rotate;d!==0&&(El(i.rotate.matrix,i.rotate.matrix,d,this._tmpCamera.eye),i.rotate.enabled=!0);const p=o.tilt*e.rotate,g=this._clampTiltDeltaGlobalToValidRange(p,r.ray,c);g!==0&&(El(i.rotate.matrix,i.rotate.matrix,g,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,r,i){const s=Mr(this.view.spatialReference),n=EM(ao.min,r.origin,i,s);let o=0,a=0;const l=Le.get();if(this.view.renderCoordsHelper.intersectManifold(r,i,l)){const c=ty(this.view.renderCoordsHelper,l,r.origin);o=EM(c,r.origin,i,s),a=EM(ao.max,r.origin,i,s)}else{$2(MD($D,i+s.radius),r,l);const c=Math.PI+PD(r.direction,l);o=tJ(c,r.origin,i,s),a=tJ(ao.max,r.origin,i,s)}return me(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,r,i){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=r+Math.abs(n-r);return s.setAltitude(i,o,e),o}_clampedDistanceToSurface(e,r){const{renderCoordsHelper:i}=this.view,{camera:s}=this.view.state,{direction:n}=k4e(this.view,r,0,lge,$ze),o=i.intersectManifoldClosestSilhouette($c(r,n),e,Le.get()),a=hi(r,o),l=i.intersectManifoldClosestSilhouette($c(r,Rm(Le.get(),r,s.center)),e,Le.get()),c=hi(r,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:r,state:i}=this.view,{camera:s,isGlobal:n}=i,o=r.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,Le.get());if(n){const a=ce(Le.get(),e,o),l=_e(a);ee(a,a,1/l);const c=pe(Le.get(),e),u=un(de(c,a));return l*Math.sin(Math.min(Rze,u))}{const a=ie(Le.get(),e);return r.setAltitude(a,this._filteredSurfaceElevation),hi(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:Oze}_computeVelocities(e){const r=this._filteredSurfaceElevation,i=r+Mr(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=Le.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,r,o),l=this._clampedDistanceToSurface(r,o),c=s.width/2,u=wJ*s.width,d=wJ*s.width,p=l*Math.tan(.5*s.fovX)/c,g=p/i,y=p/this._computeHeadingRotateRadius(o),_=a-r;return{pan:(n?g:p)*u*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(u*e/c)*_-_),zoom:2**(u*e/c)*l-l,rotate:me(y*d,Pze,Mze)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Pu(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Pu(e.rotate.matrix))}static activatesFor(e,r){const i=vJ(r,e.navigation.gamepad,Aze);return!(r.action==="end"||N5(i))}};h([f({constructOnly:!0})],v1.prototype,"gamepadDevice",void 0),h([f({constructOnly:!0})],v1.prototype,"disableMovements",void 0),v1=h([k("esri.views.3d.state.controllers.GamepadKeyboardController")],v1);const Aze={translation:[0,0,0],heading:0,tilt:0,zoom:0},lge=80,Rze=At(lge),wJ=.75,Oze=5,Pze=At(30),Mze=At(80),By={zoom:0,ascend:0,pan:{enabled:!1,matrix:ge()},rotate:{enabled:!1,matrix:ge()}},wa=E(),wT=E(),$ze=nG();function Ize(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,Pu(t.pan.matrix),t.rotate.enabled=!1,Pu(t.rotate.matrix)}let Lze=class extends Kn{constructor(e){super(!0),this._view=e,this._watchHandles=new Am,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([ae(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},zr),ae(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const r=this._view.navigation.gamepad.device;if(r&&e.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||v1.activatesFor(this._view,e.data)){if(!i){const s=new v1({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};function Dze(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),{remove:()=>document.addEventListener("visibilitychange",e)}}var ul;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(ul||(ul={}));let Nze=class extends Kn{constructor(e,r){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:$e.Local},this._keyToNumber={[r.left]:ul.LEFT,[r.right]:ul.RIGHT,[r.forward]:ul.FORWARD,[r.backward]:ul.BACKWARD,[r.up]:ul.UP,[r.down]:ul.DOWN,[r.headingLeft]:ul.HEADINGLEFT,[r.headingRight]:ul.HEADINGRIGHT,[r.tiltUp]:ul.TILTUP,[r.tiltDown]:ul.TILTDOWN,[r.zoomIn]:ul.ZOOMIN,[r.zoomOut]:ul.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=Dze(i=>i?null:this._handleStop())}onUninstall(){var e;(e=this._visibilityHandle)==null||e.remove(),this._handleStop()}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new v1({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),e.stopPropagation()))}_handleStop(){var e;(e=this._cameraControllerKeyboard)!=null&&e.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),e.stopPropagation())}},Fze=class extends Kn{constructor(e,r){super(!0),this._view=e,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new PI({view:this._view,mode:"interaction"}):new MI({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,Vi(r.x,r.y)),e.preventDefault(),e.stopPropagation()}},LI=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},uv=class extends JC{constructor(){super(...arguments),this._beginCamera=new ot,this._elapsedTimeSec=0,this.constraintOptions={selection:_i.ALL,interactionType:jt.PAN,interactionFactor:0,interactionStartCamera:new ot,interactionDirection:null,tiltMode:$n.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new Jx}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,r){r.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,r),ws(this.view,r,this.constraintOptions)}};uv=h([k("esri.views.3d.state.controllers.momentum.MomentumController")],uv);let jE=class extends uv{constructor(e){super(e),this.interactionType=jt.PAN,this._tmpPan=E()}momentumStep(e,r){const i=this.momentum.value(e);ee(this._tmpPan,this.momentum.direction,i),r.eye=ce(xJ,r.eye,this._tmpPan),r.center=ce(xJ,r.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};h([f({constructOnly:!0})],jE.prototype,"momentum",void 0),jE=h([k("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],jE);const xJ=E(),Uze=E(),tO=E();let RM=class extends uv{constructor(e){super(e),this.interactionType=jt.PAN}momentumStep(e,r){const i=this.momentum.value1(e),s=this.momentum.value2(e);ie(tO,r.eye),pe(tO,tO),rt(this.momentum.axis2,tO,this.momentum.axis1),Qme(r,Uze,this.momentum.axis1,i,this.momentum.axis2,s)}};h([f({constructOnly:!0})],RM.prototype,"momentum",void 0),RM=h([k("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],RM);let a1=class extends uv{set center(e){this._set("center",Ii(e))}set axis(e){this._set("axis",Ii(e))}constructor(e){super(e),this.interactionType=jt.TUMBLE}momentumStep(e,r){const i=this.momentum.value(e);ry(r,this.center,QC(this.axis,i))}};h([f({constructOnly:!0})],a1.prototype,"momentum",void 0),h([f({constructOnly:!0})],a1.prototype,"center",null),h([f({constructOnly:!0})],a1.prototype,"axis",null),a1=h([k("esri.views.3d.state.controllers.momentum.MomentumController")],a1);let Vw=class extends uv{set zoomCenter(e){this._set("zoomCenter",Ii(e))}constructor(e){super(e),this.interactionType=jt.ZOOM,this.constraintOptions.interactionDirection=E()}momentumStep(e,r){const{interactionDirection:i}=this.constraintOptions;if(!i)return;ie(i,r.eye);const s=this.momentum.valueDelta(0,e);ij(r,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),Rm(i,r.eye,i)}};h([f({constructOnly:!0})],Vw.prototype,"momentum",void 0),h([f({constructOnly:!0})],Vw.prototype,"zoomCenter",null),Vw=h([k("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],Vw);let B_=class extends uv{set screenCenter(e){this._set("screenCenter",Vi(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Ii(e))}constructor(e){super(e),this.interactionType=jt.ZOOM,this.radius=0,this._tmpSceneCenter=E(),this._tmpZoomAxisAngle=hN(),this._sphere=ds()}initialize(){this._sphere[3]=this.radius}momentumStep(e,r){const i=this.momentum.valueDelta(0,e);qme(this._sphere,r,i),this.constraintOptions.interactionType=jt.ZOOM,ws(this.view,r,this.constraintOptions),KC(this._sphere,r,this.screenCenter,this._tmpSceneCenter),KG(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),ry(r,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=jt.PAN}};h([f({constructOnly:!0})],B_.prototype,"momentum",void 0),h([f({constructOnly:!0})],B_.prototype,"screenCenter",null),h([f({constructOnly:!0})],B_.prototype,"sceneCenter",null),h([f({constructOnly:!0})],B_.prototype,"radius",void 0),B_=h([k("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],B_);let Lh=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const r=this.computeDelta(e);this._updateDelta(r)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},mN=class{constructor(e,r,i){this._initialVelocity=e,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,r){const i=this.value(e);return this.value(e+r)-i}valueFromInitialVelocity(e,r){r=Math.min(r,this.duration);const i=1-this.friction;return e*(i**r-1)/Math.log(i)}},kze=class extends mN{constructor(e,r,i,s,n){super(e,r,i),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},cge=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new Lh(.6),this._screen=[new Lh(.4),new Lh(.4)],this._scene=[new Lh(.6),new Lh(.6),new Lh(.6)],this._tmpDirection=E()}add(e,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?0:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=s==null||i==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){se(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=_e(this._tmpDirection);s>0&&ee(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new kze(e,r,i,n==null?0:s/n,this._tmpDirection)}},TJ=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const SJ=1e-5;let Bze=class extends mN{constructor(e,r,i,s,n,o=0,a){super(e,r,i),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},zze=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=E(),this._tmpAxis2=E(),this._tmpAngles=ke(),this._time=new Lh(.3),this._screen=[new Lh(.4),new Lh(.4)],this._angle1=new TJ(.6),this._angle2=new TJ(.6),this._axis1=E(),this._axis2=E(),this._lastScene=E()}addMomentumDirectRotation(e,r,i,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=Zme(this._lastScene,r,this._tmpAxis2,s,n,o);this._angle2.update(0),co(this._tmpAxis2)<SJ?a=0:pe(this._axis1,this._tmpAxis2),this._angle1.update(a),ie(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}addMomentumPreserveHeading(e,r,i,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;Jme(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),co(this._tmpAxis2)<SJ?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),pe(this._axis1,this._tmpAxis1),pe(this._axis2,this._tmpAxis2)),ie(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?null:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=i==null||s==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new Bze(e,r,i,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},uge=class{constructor(e=2.5,r=.01,i=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this._maxVelocity=s,this.enabled=!0,this.value=new Lh(.8),this.time=new Lh(.3)}add(e,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=me(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,r,i){return new mN(e,r,i)}},hge=class extends uge{constructor(e=3,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){const i=this.value.lastValue;if(i!=null){let s=e-i;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=i+s}super.add(e,r)}},Vze=class extends mN{constructor(e,r,i){super(e,r,i)}value(e){const r=super.value(e);return Math.exp(r)}valueDelta(e,r){const i=super.value(e),s=super.value(e+r)-i;return Math.exp(s)}},dge=class extends uge{constructor(e=2.5,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){super.add(Math.log(e),r)}createMomentum(e,r,i){return new Vze(e,r,i)}},yB=class extends bp{constructor(){super(...arguments),this._smoothRotation=new LI(.05),this._rotationAxis=E(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=wr(),this._beginRadius=0,this._smoothScaling=new LI(.05),this._zoomCenterScreen=Vi(),this._zoomMomentumEstimator=new dge,this._rotationMomentumEstimator=new hge,this._panSphericalMomentumEstimator=new zze,this._panPlanarMomentumEstimator=new cge,this._adjustedSphere=ds(),this._tmp3d=E(),this._tmpScreenPointArray=Vi(),this._beginScreenPoint=Vi(),this._beginScenePoint=E(),this._screenPickPoint=Vi(),this._scenePickPoint=E(),this._mode=On.Horizontal,this._sphere=ds(),this._pointerCount=0,this._tmpInteractionDirection=E(),this._constraintOptions={selection:_i.ALL,interactionType:jt.NONE,interactionFactor:0,interactionStartCamera:new ot,interactionDirection:null,tiltMode:$n.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){var n;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panPlanarMomentumEstimator.enabled=r,this._panSphericalMomentumEstimator.enabled=r,this._beginHeading=-j0.normalize(At(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Nh(e.center,this._screenPickPoint),Ns(this._beginScreenPoint,this._screenPickPoint);const i=Mr(this.view.spatialReference),s=Yme(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,r2.Silhouette,this.view.map.ground.opacity===0?Lv:{});s.scenePickPoint!=null&&(this._scenePickPoint=s.scenePickPoint,this._sphere=s.sphere,ie(this._beginScenePoint,this._scenePickPoint),this._mode=pN(this.startCamera,this._screenPickPoint,i),this._mode===On.Vertical&&this._preparePlanarPanMode(e,s.hasGeometryIntersection),(n=this._constraintOptions.interactionStartCamera)==null||n.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1;this._mode===On.Horizontal?(r&&this._zoomSpherical(e),this._panningSpherical(e),r&&this._rotateSpherical(e)):(r&&this._zoomPlanar(e),this._panningPlanar(e),r&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return this._mode===On.Horizontal?new B_({view:this.view,momentum:r,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new Vw({view:this.view,momentum:r,zoomCenter:this._beginScenePoint});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new a1({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._mode===On.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new RM({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new jE({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,r){const i=ko(this._tmp3d,this.startCamera.viewForward);G3(this._scenePickPoint,i,this._panningPlane);const s=Vi(this._screenPickPoint[0],0),n=E(),o=_e(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],KC(this._adjustedSphere,this.startCamera,s,n);const a=po();this.startCamera.projectToRenderScreen(n,a);const l=E(),c=E(),u=E();ce(l,this._scenePickPoint,this.currentCamera.eye);const d=_e(l);pe(l,l);const p=jme*Math.max(Math.abs(this.view.camera.position.z),Hme),g=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,dN);let y=g??p;y=r?Math.min(y,d):y,ie(u,le(c,this.currentCamera.eye,ee(c,l,y))),this._panningPlane[3]=-de(this._panningPlane,u),this.startCamera.center=le(c,this.startCamera.eye,ee(c,this.startCamera.viewForward,y));const _=Nh(e.center,this._tmpScreenPointArray);pB(this._panningPlane,this.startCamera,_,this._beginScenePoint)}_zoomSpherical(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),qme(this._sphere,this.currentCamera,this._smoothScaling.value),Nh(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=jt.ZOOM,this._constraintOptions.interactionFactor=Ih(e.radius-this._beginRadius),ws(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const r=Nh(e.center,this._tmpScreenPointArray);KC(this._sphere,this.currentCamera,r,this._tmp3d),sj(this._beginScenePoint,de(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(ege(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(Kme(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=jt.PAN,this._constraintOptions.interactionFactor=Ih(X0(this._screenPickPoint,r)),ws(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){pe(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||ko(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value,i=r+dB(e.angle-r),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(i);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),ry(this.currentCamera,this._sphere,QC(this._rotationAxis,n)),this._constraintOptions.interactionType=jt.TUMBLE,this._constraintOptions.interactionFactor=Ih(e.radius*i),ws(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const r=Nh(e.center,this._tmpScreenPointArray);pB(this._panningPlane,this.currentCamera,r,this._tmp3d)&&(Xme(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(r,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=jt.PAN,this._constraintOptions.interactionFactor=Ih(X0(this._beginScreenPoint,r)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),ws(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),ij(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=jt.ZOOM,this._constraintOptions.interactionFactor=Ih(e.radius-this._beginRadius),ws(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ie(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||ko(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value;let i=e.angle-r;i=dB(i);const s=r+i,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),ry(this.currentCamera,this._sphere,QC(this._rotationAxis,o)),this._constraintOptions.interactionType=jt.TUMBLE,this._constraintOptions.interactionFactor=Ih(e.radius*o),ws(this.view,this.currentCamera,this._constraintOptions)}};yB=h([k("esri.views.3d.state.controllers.global.PinchAndPanController")],yB);const EJ=Te(0,0,1),Gze={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let _B=class extends bp{constructor(){super(...arguments),this._rotationValueSmooth=new LI(.05),this._scalingValueSmooth=new LI(.05),this._planeHorizontal=wr(),this._planeVertical=wr(),this._rotationMomentumEstimator=new hge,this._panMomentumEstimator=new cge(300,12,.9),this._zoomMomentumEstimator=new dge,this._beginRadius=0,this._beginCenter=E(),this._beginAngle=0,this._tmpPoints=[],this._panMode=On.Horizontal,this._beginCenterScreen=Vi(),this._tmpCentroid3d=E(),this._tmpCentroid2d=Vi(),this._tmp2d=Vi(),this._pointerCount=0,this._constraintOptions={selection:_i.ALL,interactionType:jt.NONE,interactionFactor:0,interactionStartCamera:new ot,interactionDirection:null,tiltMode:$n.TUMBLE}}begin(e){var y;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panMomentumEstimator.enabled=r,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Nh(e.center,this._beginCenterScreen),phe(EJ,0,this._planeHorizontal);const i=E(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?Lv:{}),n=E();ko(n,this.startCamera.viewForward);const o=E();ie(o,EJ);const a=de(n,o),l=Ru(a<0?-a:a);this._panMode=l>=Gze.ANGLE_THRESHOLD?On.Horizontal:On.Vertical;const c=Math.min(jme,1/Math.abs(de(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),Hme);v9(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||b9(this._planeHorizontal,this._planeHorizontal);const u=E(),d=E(),p=E();ce(u,i,this.currentCamera.eye);const g=_e(u);if(pe(u,u),this._panMode===On.Vertical){ee(o,o,a),ce(this._planeVertical,n,o),pe(this._planeVertical,this._planeVertical),v9(this._planeVertical,this._planeVertical,i);const _=this.view._stage.renderView.getMinimalDepthForArea(e3(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,dN);let v=_??c;v=s?Math.min(v,g):v,ie(p,le(d,this.currentCamera.eye,ee(d,u,v))),this._planeVertical[3]=-de(this._planeVertical,p),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),E5(this._tmpPoints,this._beginCenter)}else{const _=s?g:c;ie(p,le(d,this.currentCamera.eye,ee(d,u,_))),this._planeHorizontal[3]=-de(this._planeHorizontal,p),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),E5(this._tmpPoints,this._beginCenter)}(y=this._constraintOptions.interactionStartCamera)==null||y.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1,i=this._panMode===On.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(r){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),ij(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=jt.ZOOM,this._constraintOptions.interactionFactor=Ih(Math.abs(e.radius-this._beginRadius)),ws(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),E5(this._tmpPoints,this._tmpCentroid3d),Nh(e.center,this._tmpCentroid2d),Xme(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=jt.PAN,this._constraintOptions.interactionFactor=Ih(X0(this._beginCenterScreen,this._tmpCentroid2d)),ws(this.view,this.currentCamera,this._constraintOptions),r){const n=this._planeHorizontal,o=s,a=this._rotationValueSmooth.value,l=a+dB(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const u=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(u,.001*e.timestamp),ry(this.currentCamera,o,QC(n,u)),this._constraintOptions.interactionType=jt.TUMBLE,this._constraintOptions.interactionFactor=Ih(Math.abs(e.radius*u)),ws(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return new Vw({view:this.view,momentum:r,zoomCenter:this._beginCenter});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new a1({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new jE({view:this.view,momentum:s}):null}_computePlanePoints(e,r,i,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=E()),pB(r,i,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};_B=h([k("esri.views.3d.state.controllers.local.PinchAndPanController")],_B);let CJ=class extends Kn{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!oj(e.data,this.pointerAction))return;const r=e.timestamp-this._lastEndTimestamp,i=40,s=this._momentum&&this._momentum.active&&r<i;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const i=this._controller.end(e.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new yB({view:this._view}):new _B({view:this._view})}},jze=class extends Kn{constructor(e,r){super(!0),this.view=e,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}},pge=class extends Kn{constructor(e,r){super(!0),this.key=e,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},Hze=class extends pge{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},qze=class extends pge{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},Wze=class extends Kn{constructor(e,r=!1){super(!0),this._view=e,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(e){var s,n,o;const r=this._invert?-1:1,i=Vi(0,e.data.delta*r);switch(e.data.action){case"begin":(s=this._cameraController)==null||s.end(),this._cameraController=new GE({view:this._view,pivot:yl.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":(n=this._cameraController)==null||n.update(i);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}};function AJ(t){const e=t.native;return e?{buttons:e.buttons.map(r=>r.pressed?r.value||1:0),axes:e.axes.map(r=>Zze(r,t.axisThreshold))}:{buttons:[],axes:[]}}function Yze(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let r=0;r<t.axes.length;r++)if(t.axes[r]!==e.axes[r])return!1;for(let r=0;r<t.buttons.length;r++)if(t.buttons[r]!==e.buttons[r])return!1;return!0}function Xze(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function Zze(t,e){const r=Math.abs(t);return r<e?0:Math.sign(t)*(r-e)/(1-e)}let Jze=class{constructor(e,r){this._element=e,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,AJ(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=i&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const r=new hG(e);r.deviceType!=="unknown"&&(this._inputDevices[e.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=B1({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=AJ(n),l=i||Xze(a);o&&(o.timestamp===s.timestamp||!o.active&&l||Yze(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(e){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const s=r[i];this._validate(s)&&e(s)}}_emitGamepadEvent(e,r,i){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!i)return;const o=!n&&i?"start":n&&i?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[e.index],state:r,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let r=0;r<e.axes.length;r++)if(isNaN(e.axes[r]))return!1;return!0}};const RJ=te("edge"),Qze=te("chrome"),Kze=te("ff"),e7e=te("safari"),OJ="esri-view-surface",ub={touchNone:`${OJ}--touch-none`,touchPan:`${OJ}--touch-pan`};let fge=class mge{constructor(e,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Jze(e,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Oe(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const r in this._active)if(!e||!e.has(r)){const i=this._active[r];this._element.removeEventListener(F5[r],i),delete this._active[r]}e&&e.forEach(r=>{if(!this._active[r]&&F5[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(F5[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,r){r?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?ub.touchNone:ub.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?ub.touchPan:ub.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(ub.touchNone),this._element.classList.remove(ub.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,r){const i=rpe(this._element,e);return mge.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(e,r){const i=u5e(r);i&&e==="key-up"&&this._keyDownState.delete(i);const s={native:r,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,r){let i=r.deltaY;switch(r.deltaMode){case 0:RJ&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}RJ?i*=.7:Qze||e7e?i*=.6:Kze&&(i*=1.375);const s=100,n=Math.abs(i);n>s&&(i=i/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(e,o)}_handlePointerCaptureLost(e,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(e,r)}_handleDefault(e,r){const i={native:r};r.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};fge.test={disableSubpixelCoordinates:!1};const F5={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let t7e=class extends Kn{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};const fc={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function vB(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function r7e(t,e){const r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function i7e(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:Ou()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[T,S]=t,[C,A]=[S.x-T.x,S.y-T.y];return e.radius=Math.sqrt(C*C+A*A)/2,e.center.x=(T.x+S.x)/2,e.center.y=(T.y+S.y)/2,e}let r=0,i=0;for(let T=0;T<t.length;T++)r+=t[T].x,i+=t[T].y;r/=t.length,i/=t.length;const s=t.map(T=>T.x-r),n=t.map(T=>T.y-i);let o=0,a=0,l=0,c=0,u=0,d=0,p=0;for(let T=0;T<s.length;T++){const S=s[T],C=n[T],A=S*S,O=C*C;o+=A,a+=O,l+=S*C,c+=A*S,u+=O*C,d+=S*O,p+=C*A}const g=.5*(c+d),y=.5*(u+p),_=o*a-l*l,v=(g*a-y*l)/_,w=(o*y-l*g)/_,x=Ou(v+r,w+i);return{radius:Math.sqrt(v*v+w*w+(o+a)/t.length),center:x}}function HE(t){const{native:e}=t,{pointerId:r,button:i,pointerType:s}=e;return s==="mouse"?`${r}:${i}`:`${s}`}let s7e=class extends Kn{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,r,i,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:s,pointers:n7e(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const r=e.native.pointerId,i=rO(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,s);const n=OM(s,gge(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(i)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const r=e.native.pointerId,i=this._activePointerMap.get(r);i?i.event=e:this._addPointer(e)}_removePointer(e){const r=rO(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(r)}_updatePointerAngles(e){const r=rO(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=OM(i,r)-e,i.lastAngle=OM(i,r)-e})}_emitEvent(e,r,i){const s=rO(this._activePointerMap);this._drag.emit(this._createPayload(e,r,s,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const r=e.data.native.pointerId,i=e.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const r=e.data,i=r.currentEvent,s=e.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,s)):(this._addPointer(i),this._emitEvent("added",i,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function gge(t){const e=[];return t.forEach(r=>{e.push(Ou(r.event.x,r.event.y))}),i7e(e)}function rO(t){const e=gge(t);let r=0;return t.forEach(i=>{let s=OM(i,e),n=s-i.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=i.lastAngle+n,i.lastAngle=s;const o=s-i.initialAngle;r+=o}),r/=t.size||1,{angle:r,radius:e.radius,center:e.center}}function n7e(t){const e=new Map;return t.forEach((r,i)=>e.set(i,r.event)),e}function OM(t,e){const r=t.event,i=r.x-e.center.x,s=r.y-e.center.y;return Math.atan2(s,i)}var PJ;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(PJ||(PJ={}));let o7e=class extends Kn{constructor(e=fc.maximumDoubleClickDelay,r=fc.maximumDoubleClickDistance,i=fc.maximumDoubleTouchDelay,s=fc.maximumDoubleTouchDistance,n=T3){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=HE(r);if(!this._pointerState.has(i)){const s={downButton:r.native.button,x:r.x,y:r.y,immediateDoubleClick:null};this._pointerState.set(i,s),this.startCapturingPointer(r.native)}}_handlePointerUp(e){const r=e.data,i=HE(r),s=this._pointerState.get(i);if(s&&s.downButton===r.native.button){const n=s.immediateDoubleClick,o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;n?(n.timeoutHandle.remove(),vB(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(r))):vB(s,e.data)>o?this._removeState(r):this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,r){const i=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),i)}}_removeState(e){const r=HE(e);this._pointerState.delete(r),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},a7e=class extends Kn{constructor(e=fc.maximumClickDelay,r=fc.movementUntilMouseDrag,i=fc.movementUntilPenDrag,s=fc.movementUntilTouchDrag,n=fc.holdDelay,o=T3){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=di(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=r.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:r,previousEvent:r,startTimestamp:e.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(i,n),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,r,i){return{action:e,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(e){const r=e.data,i=r.native.pointerId,s=this._pointerState.get(i);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,r),void 0,s.modifiers):r7e(r,s.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(e),s.previousEvent=r)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const r=e.data,i=r.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,i===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,r)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,r){const i=e.data,s=i.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,r==="pointer-up"?i:n.previousEvent),void 0,n.modifiers):r==="pointer-up"&&n.downButton===i.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(s),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}},l7e=class extends Kn{constructor(e=fc.maximumDoubleClickDelay,r=fc.maximumDoubleClickDistance,i=fc.maximumDoubleTouchDelay,s=fc.maximumDoubleTouchDistance,n=T3){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=di(e.doubleClickTimer))}get hasPendingInputs(){return hc(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,r){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=di(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const r=this._pointerState.get(e);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:r,pointerType:i,button:s}=e.native;return i==="mouse"?`${r}:${s}`:`${i}`}_handleImmediateClick(e){const r=e.data,{pointerType:i}=r.native,s=this._getPointerId(r);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;vB(o,r)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const r=HE(e.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:r}=e,{native:{pointerType:i}}=r,s=HE(r),n=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n),a=1;this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},c7e=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const r=e.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var r,i;this._startEvent=e,(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},u7e=class extends Kn{constructor(e=20,r=40){super(!1),this._threshold=e,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new c7e({start:(i,s)=>this._observeStart(i,s),update:(i,s,n)=>this._observeUpdate(i,s,n),end:(i,s)=>this._observeEnd(s)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(e,r){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,r,i){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,r){let i=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:_,y:v}of r.pointers.values())i=Math.max(i,_),s=Math.min(s,_),n=Math.max(n,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,u=1/0;for(const{x:_,y:v}of e.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,v),u=Math.min(u,v);const d=i-s,p=n-o,g=a-l,y=c-u;return Math.abs(e.center.x-r.center.x)<this._threshold&&Math.abs(g-d)<=this._maxDelta&&Math.abs(y-p)<=this._maxDelta}_checkVerticalThresholdReached(e,r){let i=Math.abs(e.center.y-r.center.y);return e.pointers.forEach((s,n)=>{const o=r.pointers.get(n);i=Math.min(i,Math.abs(s.y-o.y))}),i>=this._threshold}},ph=class extends xe{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){var e;return!!((e=this._inputManager)!=null&&e.updating)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Oe(this._inputManager)}connect(){const e=this.view;this._source=new fge(this.view.surface,e.input);const r=[new o7e,new a7e,new l7e,new s7e(this.view.navigation),new u7e],i=new Jc({eventSource:this._source,recognizers:r});this._inputManager=i,i.installHandlers("prevent-context-menu",[new t7e],$0.INTERNAL),this._modeDragPan=new CJ(e,"primary"),this._modeDragRotate=new D5(e,"secondary",yl.CENTER),this._modeDragZoom=new Cze(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new jze(e),new GBe(e),new Lze(e),new Nze(e,s.pan),new Fze(e),new qze(e,s.resetTilt),new Hze(e,s.resetHeading),new D5(e,"primary",yl.EYE,[s.lookAround]),new D5(e,"secondary",yl.CENTER,[s.lookAround]),new CJ(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new Wze(e)],$0.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this.addHandles(ae(()=>{var n;return(n=this.view.navigation)==null?void 0:n.browserTouchPanEnabled},n=>{this._source.browserTouchPanningEnabled=!n},zr))}_updateMode(){var s;const e=this.mode,r=this.primaryDragAction,i=(s=bB.get(e))==null?void 0:s.get(r);i&&(this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};h([f()],ph.prototype,"view",void 0),h([f({value:"pan"})],ph.prototype,"primaryDragAction",null),h([f({value:"default"})],ph.prototype,"mode",null),h([f({readOnly:!0})],ph.prototype,"updating",null),h([f()],ph.prototype,"latestPointerType",null),h([f()],ph.prototype,"latestPointerLocation",null),h([f()],ph.prototype,"multiTouchActive",null),h([f()],ph.prototype,"_inputManager",void 0),ph=h([k("esri.views.3d.input.SceneInputManager")],ph);const bB=new Map,U5=new Map,k5=new Map;U5.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),U5.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),k5.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),k5.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),bB.set("default",U5),bB.set("pro",k5);const h7e=ph;let gs=class extends xe{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};h([f()],gs.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),h([f()],gs.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),h([f()],gs.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),h([f()],gs.prototype,"DECONFLICTOR_SHOW_GRID",void 0),h([f()],gs.prototype,"LABELS_SHOW_BORDER",void 0),h([f()],gs.prototype,"TEXT_SHOW_BASELINE",void 0),h([f()],gs.prototype,"TEXT_SHOW_BORDER",void 0),h([f()],gs.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),h([f()],gs.prototype,"OVERLAY_SHOW_CENTER",void 0),h([f()],gs.prototype,"SHOW_POI",void 0),h([f()],gs.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),h([f()],gs.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),h([f()],gs.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),h([f()],gs.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),h([f()],gs.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),h([f()],gs.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),h([f()],gs.prototype,"I3S_TREE_SHOW_TILES",void 0),h([f()],gs.prototype,"I3S_SHOW_MODIFICATIONS",void 0),h([f()],gs.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),h([f()],gs.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),h([f()],gs.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),h([f()],gs.prototype,"LINE_WIREFRAMES",void 0),gs=h([k("esri.views.3d.support.DebugFlags")],gs);const Zr=new gs;let sc,fx,wB=!1,xB=!1,TB=!1,SB=!1,qE=null;function d7e(t,e){if(!xB||!fx)return;yge();const r=fx;let i=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];i+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,u=(n+1)*t.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),_ge(a,l,c,u,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+e.size,70,50),r.fillText("total numTests: "+t.accNumTests,70,30)}function p7e(t){TB=Zr.DECONFLICTOR_SHOW_VISIBLE,SB=Zr.DECONFLICTOR_SHOW_INVISIBLE,wB=TB||SB,xB=Zr.DECONFLICTOR_SHOW_GRID,qE=null,wB||xB?qE=()=>f7e(t):sc&&(sc.parentElement.removeChild(sc),sc=null)}function yge(){qE&&(qE(),qE=null)}function f7e(t){sc==null&&(sc=document.createElement("canvas"),sc.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(sc));const{state:e}=t,{camera:r,pixelRatio:i}=e,{width:s,height:n}=r,o=s*i,a=n*i;sc.setAttribute("width",`${o}px`),sc.setAttribute("height",`${a}px`),sc.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),fx=sc.getContext("2d"),fx.clearRect(0,0,s,n),fx.font="12px Arial"}function _ge(t,e,r,i,s){yge();const n=sc.height,o=fx;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-r),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.closePath()}function m7e(t,e){wB&&(e&&TB||!e&&SB)&&_ge(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var uo,An;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(uo||(uo={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(An||(An={}));function vge(t,e){return new xge(t,Sge,e)}function g7e(t,e){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:s}=Sge;return new xge(t,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:B5.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:B5.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:s,minPixelSize:B5.minPixelSize},e)}function y7e(t){return Math.abs(t*t*t)}function bge(t,e,r){const i=r.parameters;return z5.scale=Math.min(i.divisor/(e-i.offset),1),z5.factor=y7e(t),z5}function uj(t,e){return ft(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function _7e(t,e,r){const i=bge(t,e,r);return i.minScaleFactor=0,uj(1,i)}function MJ(t,e,r,i){i.scale=_7e(t,e,r),i.factor=0,i.minScaleFactor=r.minScaleFactor}function wge(t,e,r=[0,0]){const i=Math.min(Math.max(e.scale,e.minScaleFactor),1);return r[0]=t[0]*i,r[1]=t[1]*i,r}function v7e(t,e,r,i){return uj(t,bge(e,r,i))}let xge=class Tge{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,r,i,s=b7e(),n){this._viewingMode=e,this._description=r,this._ellipsoidRadius=i,this.parameters=s,this._fontHeight=n,this._viewingMode===$e.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(e){return e!==this._fontHeight?new Tge(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,r,i){const{scaleStart:s,scaleFallOffRange:n}=this._description,{fovY:o,distance:a}=e,l=this._calculateCurvatureDependentParameters(e,r),c=this._coverageCompensation(e,r,l),{tiltAngle:u,scaleFallOffFactor:d}=l,p=Math.sin(u)*a,g=.5*Math.PI-u-o*(.5-s*c),y=p/Math.cos(g),_=g+o*n*c,v=(y-d*(p/Math.cos(_)))/(1-d);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=v,i.divisor=y-v,i}_calculateCurvatureDependentParametersLocal(e,r,i=$J){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(e,r,i=$J){const s=this._description.curvatureDependent,n=1+e.distance/r,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=me((o-a)/(l-a),0,1),[u,d]=[s.min,s.max];return i.tiltAngle=ft(u.tiltAngle,d.tiltAngle,c),i.scaleFallOffFactor=ft(u.scaleFallOffFactor,d.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,r,i){return(e.fovY-i.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,r,i){const s=r*r,n=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+s-2*Math.cos(n)*a*r,c=Math.sqrt(l),u=Math.sqrt(l-s);return(Math.acos(u/c)-Math.asin(r/(c/Math.sin(n)))+.5*o)/o}};const Sge={curvatureDependent:{min:{curvature:At(10),tiltAngle:At(12),scaleFallOffFactor:.5},max:{curvature:At(70),tiltAngle:At(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},B5={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function b7e(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}const z5={scale:0,factor:0,minScaleFactor:0},$J={tiltAngle:0,scaleFallOffFactor:0};function w7e(t){return t instanceof Float32Array&&t.length>=16}function x7e(t){return Array.isArray(t)&&t.length>=16}function T7e(t){return w7e(t)||x7e(t)}const i2={unknown:1,inches:jn(1,"meters","inches"),feet:jn(1,"meters","feet"),"us-feet":jn(1,"meters","us-feet"),yards:jn(1,"meters","yards"),miles:jn(1,"meters","miles"),"nautical-miles":jn(1,"meters","nautical-miles"),millimeters:jn(1,"meters","millimeters"),centimeters:jn(1,"meters","centimeters"),decimeters:jn(1,"meters","decimeters"),meters:jn(1,"meters","meters"),kilometers:jn(1,"meters","kilometers"),"decimal-degrees":1/EEe(1,"meters",mr.radius)};var Io,IJ;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(Io||(Io={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(IJ||(IJ={}));let hj=class{constructor(e){this.field=e}},S7e=class extends hj{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[Io.Undefined,Io.Undefined,Io.Undefined]}},E7e=class extends hj{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},C7e=class extends hj{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},A7e=class{};function xT(t){return t!=null}function hb(t){return typeof t=="number"}function gN(t){return typeof t=="string"}function R7e(t){return t==null||gN(t)}function Xs(t,e){t&&t.push(e)}function O7e(t,e,r,i=ge()){const s=t||0,n=e||0,o=r||0;return s!==0&&Ox(i,i,-s/180*Math.PI),n!==0&&Rx(i,i,n/180*Math.PI),o!==0&&eD(i,i,o/180*Math.PI),i}function hg(t,e,r,i,s){var a;const n=t.minSize,o=t.maxSize;if(t.expression)return Xs(s,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const l=i.symbolSize[r];return e.minSize[r]=l,e.maxSize[r]=l,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=Io.DefinedSize,!0}if(xT(t.field))return xT(t.stops)?t.stops.length===2&&hb(t.stops[0].size)&&hb(t.stops[1].size)?(LJ(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,r),e.type[r]=Io.DefinedSize,!0):(Xs(s,"Could not convert size info: stops only supported with 2 elements"),!1):hb(n)&&hb(o)&&xT(t.minDataValue)&&xT(t.maxDataValue)?(LJ(n,o,t.minDataValue,t.maxDataValue,e,r),e.type[r]=Io.DefinedSize,!0):t.valueUnit==="unknown"?(Xs(s,"Could not convert size info: proportional size not supported"),!1):i2[t.valueUnit]!=null?(e.minSize[r]=-1/0,e.maxSize[r]=1/0,e.offset[r]=0,e.factor[r]=1/i2[t.valueUnit],e.type[r]=Io.DefinedSize,!0):(Xs(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!xT(t.field)){if((a=t.stops)!=null&&a[0]&&hb(t.stops[0].size))return e.minSize[r]=t.stops[0].size,e.maxSize[r]=t.stops[0].size,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=Io.DefinedSize,!0;if(hb(n))return e.minSize[r]=n,e.maxSize[r]=n,e.offset[r]=n,e.factor[r]=0,e.type[r]=Io.DefinedSize,!0}return Xs(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function LJ(t,e,r,i,s,n){const o=Math.abs(i-r)>0?(e-t)/(i-r):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-r*o,s.factor[n]=o}function P7e(t,e,r,i){if(t.normalizationField||t.valueRepresentation)return Xs(i,"Could not convert size info: unsupported property"),null;if(!R7e(t.field))return Xs(i,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return Xs(i,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new S7e(t.field);let s;switch(t.axis){case"width":return s=hg(t,e.size,0,r,i),s?e:null;case"height":return s=hg(t,e.size,2,r,i),s?e:null;case"depth":return s=hg(t,e.size,1,r,i),s?e:null;case"width-and-depth":return s=hg(t,e.size,0,r,i),s&&hg(t,e.size,1,r,i),s?e:null;case null:case void 0:case"all":return s=hg(t,e.size,0,r,i),s=s&&hg(t,e.size,1,r,i),s=s&&hg(t,e.size,2,r,i),s?e:null;default:return Xs(i,`Could not convert size info: unknown axis "${t.axis}""`),null}}function M7e(t,e,r){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===Io.DefinedSize&&(n*=e.modelSize[s],t.type[s]=Io.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let i;if(t.type[0]!==Io.Undefined)i=0;else if(t.type[1]!==Io.Undefined)i=1;else{if(t.type[2]===Io.Undefined)return Xs(r,"No size axis contains a valid size or scale"),!1;i=2}for(let s=0;s<3;++s)t.type[s]===Io.Undefined&&(t.minSize[s]=t.minSize[i],t.maxSize[s]=t.maxSize[i],t.offset[s]=t.offset[i],t.factor[s]=t.factor[i],t.type[s]=t.type[i]);return!0}function DJ(t,e,r){t[4*e]=r.r/255,t[4*e+1]=r.g/255,t[4*e+2]=r.b/255,t[4*e+3]=r.a}function $7e(t,e,r){if(t.normalizationField)return Xs(r,"Could not convert color info: unsupported property"),null;if(gN(t.field)){if(!t.stops)return Xs(r,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return Xs(r,"Could not convert color info: too many color stops"),null;e.color=new E7e(t.field);const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.color.values[s]=n.value,DJ(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return Xs(r,"Could not convert color info: no field and no colors/stops"),null;{const i=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,DJ(e.color.colors,s,i)}}return e}function I7e(t,e,r){if(t.normalizationField)return Xs(r,"Could not convert opacity info: unsupported property"),null;if(gN(t.field)){if(!t.stops)return Xs(r,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return Xs(r,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new C7e(t.field);const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return Xs(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=i}}return e}function V5(t,e,r){const i=r===2&&t.rotationType==="arithmetic";e.offset[r]=i?90:0,e.factor[r]=i?-1:1,e.type[r]=1}function L7e(t,e,r){if(!gN(t.field))return Xs(r,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return Xs(r,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return V5(t,e.rotation,0),e;case"roll":return V5(t,e.rotation,1),e;case null:case void 0:case"heading":return V5(t,e.rotation,2),e;default:return Xs(r,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let eA=class{constructor(e,r=[1,1,1],i=[1,1,1],s=1,n=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=r,this.symbolSize=i,this.unitInMeters=s,this.anchor=n,this.scale=o,this.rotation=a}};function Ege(t,e,r){if(!t)return null;const i=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return Xs(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(n.type){case"size":return e.supports.size?P7e(n,s,e,r):s;case"color":return e.supports.color?$7e(n,s,r):s;case"opacity":return e.supports.opacity?I7e(n,s,r):null;case"rotation":return e.supports.rotation?L7e(n,s,r):s;default:return null}},new A7e);return!(t.length>0&&i)||i.size||i.color||i.opacity||i.rotation?i!=null&&i.size&&!M7e(i.size,e,r)?null:i:null}let D7e=class{constructor(e,r,i){this.visualVariables=e,this.materialParameters=r,this.requiresShaderTransformation=i}};function s2(t,e){if(!t||Zr.TESTS_DISABLE_FAST_UPDATES)return null;const r=Ege(t.visualVariables,e);return r?new D7e(r,Age(r,e),!!r.size):null}function n2(t,e,r){if(!e||!t)return!1;const i=t.visualVariables,s=Ege(e.visualVariables,r);return!!s&&!!(iO(i.size,s.size,"size")&&iO(i.color,s.color,"color")&&iO(i.rotation,s.rotation,"rotation")&&iO(i.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=Age(s,r),t.requiresShaderTransformation=!!s.size,!0)}function iO(t,e,r){if(!!t!=!!e||t&&t.field!==(e==null?void 0:e.field))return!1;if(t&&r==="rotation"){const i=t,s=e;for(let n=0;n<3;n++)if(i.type[n]!==s.type[n]||i.offset[n]!==s.offset[n]||i.factor[n]!==s.factor[n])return!1}return!0}let Cge=class extends Vr{constructor(e){super(),this.vvSize=(e==null?void 0:e.size)??null,this.vvColor=(e==null?void 0:e.color)??null,this.vvOpacity=(e==null?void 0:e.opacity)??null}};function Age(t,e){const r=new Cge(t);return r.vvSize&&(r.vvSymbolAnchor=e.anchor,Pu(WE),O7e(e.rotation[2],e.rotation[0],e.rotation[1],WE),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||Fi(),Iu(r.vvSymbolRotationMatrix,WE)),r}function N7e(t,e,r){if(!t.vvSize)return r;Ss(dg,r);const i=t.vvSymbolRotationMatrix;Xp(WE,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),Pr(dg,dg,WE);for(let s=0;s<3;++s){const n=t.vvSize.offset[s]+e[0]*t.vvSize.factor[s];NJ[s]=me(n,t.vvSize.minSize[s],t.vvSize.maxSize[s])}return O3(dg,dg,NJ),Ya(dg,dg,t.vvSymbolAnchor),dg}function dj(t,e,r){if(!e.vvSize)return se(t,1,1,1),t;for(let i=0;i<3;++i){const s=e.vvSize.offset[i]+r[0]*e.vvSize.factor[i];t[i]=me(s,e.vvSize.minSize[i],e.vvSize.maxSize[i])}return t}function Xh(t,e){const r=t==null?0:e.attributes[t];return typeof r=="number"&&isFinite(r)?r:0}const dg=ge(),NJ=E(),WE=ge();function pj(t){t.vertex.code.add(b`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(b`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(b`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(b`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(b`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(b`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function F7e(t){t.uniforms.add(new Pt("screenSizePerspective",e=>Rge(e.screenSizePerspective)))}function yN(t){t.uniforms.add(new Pt("screenSizePerspectiveAlignment",e=>Rge(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function Rge(t){return se(U7e,t.parameters.divisor,t.parameters.offset,t.minScaleFactor)}const U7e=E();function Oge(t,e){const r=t.vertex;e.hasVerticalOffset?(Pge(r),e.hasScreenSizePerspective&&(t.include(pj),yN(r),sd(t.vertex,e)),r.code.add(b`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?b`vec3 worldNormal = normalize(worldPos + localOrigin);`:b`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?b`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:b`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(b`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const k7e=Jt();function Pge(t){t.uniforms.add(new nr("verticalOffset",(e,r)=>{const{minWorldLength:i,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return Si(k7e,n*a,o,i,s)}))}const Mge=.5;function $ge(t,e){t.include(pj),t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.NORMAL,"vec3"),t.attributes.add(R.AUXPOS1,"vec4");const r=t.vertex;Rl(r,e),sd(r,e),r.uniforms.add(new nr("viewport",(i,s)=>s.camera.fullViewport),new Ee("polygonOffset",i=>i.shaderPolygonOffset),new Ee("cameraGroundRelative",(i,s)=>s.camera.aboveGround?1:-1)),e.hasVerticalOffset&&Pge(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(b`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(b`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.multipassEnabled?b.float(0):b`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||e2(r),e.draped||(r.uniforms.add(new Ee("perDistancePixelRatio",(i,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),r.code.add(b`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${b.float(Mge)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&N2(r),e.hasScreenSizePerspective&&yN(r),r.code.add(b`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offset of labels with respect to objects.
      // It also pulls the label towards the viewer so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?b`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":b`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}const sO=tn();function Ige(t,e,r,i,s,n){if(t.visible)if(t.boundingInfo){Je(t.type===Ki.Mesh);const o=e.tolerance;Lge(t.boundingInfo,r,i,o,s,n)}else{const o=t.attributes.get(R.POSITION),a=o.indices;tA(r,i,0,a.length/3,a,o,void 0,s,n)}}const B7e=E();function Lge(t,e,r,i,s,n){if(t==null)return;const o=Nge(e,r,B7e);if(Ice(sO,t.bbMin),Lce(sO,t.bbMax),s!=null&&s.applyToAabb(sO),mj(sO,e,o,i)){const{primitiveIndices:a,position:l}=t,c=a?a.length:l.indices.length/3;if(c>j7e){const u=t.getChildren();if(u!==void 0){for(const d of u)Lge(d,e,r,i,s,n);return}}tA(e,r,0,c,l.indices,l,a,s,n)}}const Dge=E();function tA(t,e,r,i,s,n,o,a,l){if(o)return z7e(t,e,r,i,s,n,o,a,l);const{data:c,stride:u}=n,d=t[0],p=t[1],g=t[2],y=e[0]-d,_=e[1]-p,v=e[2]-g;for(let w=r,x=3*r;w<i;++w){let T=u*s[x++],S=c[T++],C=c[T++],A=c[T];T=u*s[x++];let O=c[T++],$=c[T++],D=c[T];T=u*s[x++];let N=c[T++],z=c[T++],U=c[T];a!=null&&([S,C,A]=a.applyToVertex(S,C,A,w),[O,$,D]=a.applyToVertex(O,$,D,w),[N,z,U]=a.applyToVertex(N,z,U,w));const Y=O-S,H=$-C,V=D-A,J=N-S,P=z-C,I=U-A,B=_*I-P*v,G=v*J-I*y,q=y*P-J*_,Z=Y*B+H*G+V*q;if(Math.abs(Z)<=Number.EPSILON)continue;const K=d-S,fe=p-C,Pe=g-A,lt=K*B+fe*G+Pe*q;if(Z>0){if(lt<0||lt>Z)continue}else if(lt>0||lt<Z)continue;const Tt=fe*V-H*Pe,it=Pe*Y-V*K,dt=K*H-Y*fe,Be=y*Tt+_*it+v*dt;if(Z>0){if(Be<0||lt+Be>Z)continue}else if(Be>0||lt+Be<Z)continue;const Re=(J*Tt+P*it+I*dt)/Z;Re>=0&&l(Re,fj(Y,H,V,J,P,I,Dge),w,!1)}}function z7e(t,e,r,i,s,n,o,a,l){const{data:c,stride:u}=n,d=t[0],p=t[1],g=t[2],y=e[0]-d,_=e[1]-p,v=e[2]-g;for(let w=r;w<i;++w){const x=o[w];let T=3*x,S=u*s[T++],C=c[S++],A=c[S++],O=c[S];S=u*s[T++];let $=c[S++],D=c[S++],N=c[S];S=u*s[T];let z=c[S++],U=c[S++],Y=c[S];a!=null&&([C,A,O]=a.applyToVertex(C,A,O,w),[$,D,N]=a.applyToVertex($,D,N,w),[z,U,Y]=a.applyToVertex(z,U,Y,w));const H=$-C,V=D-A,J=N-O,P=z-C,I=U-A,B=Y-O,G=_*B-I*v,q=v*P-B*y,Z=y*I-P*_,K=H*G+V*q+J*Z;if(Math.abs(K)<=Number.EPSILON)continue;const fe=d-C,Pe=p-A,lt=g-O,Tt=fe*G+Pe*q+lt*Z;if(K>0){if(Tt<0||Tt>K)continue}else if(Tt>0||Tt<K)continue;const it=Pe*J-V*lt,dt=lt*H-J*fe,Be=fe*V-H*Pe,Re=y*it+_*dt+v*Be;if(K>0){if(Re<0||Tt+Re>K)continue}else if(Re>0||Tt+Re<K)continue;const Ce=(P*it+I*dt+B*Be)/K;Ce>=0&&l(Ce,fj(H,V,J,P,I,B,Dge),x,!1)}}const FJ=E(),UJ=E();function fj(t,e,r,i,s,n,o){return se(FJ,t,e,r),se(UJ,i,s,n),rt(o,FJ,UJ),pe(o,o),o}function Nge(t,e,r){return se(r,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function mj(t,e,r,i){return gj(t,e,r,i,1/0)}function gj(t,e,r,i,s){const n=(t[0]-i-e[0])*r[0],o=(t[3]+i-e[0])*r[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-i-e[1])*r[1],u=(t[4]+i-e[1])*r[1];if(l=Math.min(l,Math.max(c,u)),l<0||(a=Math.max(a,Math.min(c,u)),a>l))return!1;const d=(t[2]-i-e[2])*r[2],p=(t[5]+i-e[2])*r[2];return l=Math.min(l,Math.max(d,p)),!(l<0)&&(a=Math.max(a,Math.min(d,p)),!(a>l)&&a<s)}function Fge(t,e,r,i,s){let n=(r.screenLength||0)*t.pixelRatio;s!=null&&(n=v7e(n,i,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return me(o*e,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function Uge(t,e){const r=e?Uge(e):{};for(const i in t){let s=t[i];s!=null&&s.forEach&&(s=G7e(s)),s==null&&i in r||(r[i]=s)}return r}function V7e(t,e){let r=!1;for(const i in e){const s=e[i];s!==void 0&&(Array.isArray(s)?t[i]===null?(t[i]=s.slice(),r=!0):Nz(t[i],s)&&(r=!0):t[i]!==s&&(r=!0,t[i]=s))}return r}function G7e(t){const e=[];return t.forEach(r=>e.push(r)),e}const kge={multiply:1,ignore:2,replace:3,tint:4},j7e=1e3;let yy=class extends J3{constructor(e,r){super(),this.type=Ki.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._vertexAttributeLocations=hr,this._pp0=Te(0,0,1),this._pp1=Te(0,0,0),this._parameters=Uge(e,r),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,r=!0){V7e(this._parameters,e)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bindParameters.decorations===Al.ON)&&(this.parameters.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){var e;(e=this.repository)==null||e.materialChanged(this)}intersectDraped(e,r,i,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,r,i,this._pp0,this._pp1,n)}},Bge=class extends b9e{constructor(e,r,i){super(r,i),this.camera=e}};var Ti;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Ti||(Ti={}));let yj=class extends Vr{constructor(){super(...arguments),this.renderOccluded=Ti.Occlude,this.isDecoration=!1}},zge=class{constructor(){this.factor=new kJ,this.factorAlignment=new kJ}},kJ=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function hwt(t,e,r,i=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(r*=a,i===1)for(let c=0;c<l;++c)o[r]=s[n[c]],r+=a;else for(let c=0;c<l;++c){const u=s[n[c]];for(let d=0;d<i;d++)o[r]=u,r+=a}}function BJ(t,e,r){const{data:i,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length;r*=o;for(let l=0;l<a;++l){const c=2*s[l];n[r]=i[c],n[r+1]=i[c+1],r+=o}}function Vge(t,e,r,i){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(r*=a,i==null||i===1)for(let c=0;c<l;++c){const u=3*n[c];o[r]=s[u],o[r+1]=s[u+1],o[r+2]=s[u+2],r+=a}else for(let c=0;c<l;++c){const u=3*n[c];for(let d=0;d<i;++d)o[r]=s[u],o[r+1]=s[u+1],o[r+2]=s[u+2],r+=a}}function o2(t,e,r,i=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(r*=a,i===1)for(let c=0;c<l;++c){const u=4*n[c];o[r]=s[u],o[r+1]=s[u+1],o[r+2]=s[u+2],o[r+3]=s[u+3],r+=a}else for(let c=0;c<l;++c){const u=4*n[c];for(let d=0;d<i;++d)o[r]=s[u],o[r+1]=s[u+1],o[r+2]=s[u+2],o[r+3]=s[u+3],r+=a}}function zJ(t,e,r){const i=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<r;++n)i[e]=0,i[e+1]=0,i[e+2]=0,i[e+3]=0,e+=s}function _j(t,e,r,i,s=1){if(!e)return void Vge(t,r,i,s);const{data:n,indices:o}=t,a=r.typedBuffer,l=r.typedBufferStride,c=o.length,u=e[0],d=e[1],p=e[2],g=e[4],y=e[5],_=e[6],v=e[8],w=e[9],x=e[10],T=e[12],S=e[13],C=e[14];i*=l;let A=0,O=0,$=0;const D=iD(e)?N=>{A=n[N]+T,O=n[N+1]+S,$=n[N+2]+C}:N=>{const z=n[N],U=n[N+1],Y=n[N+2];A=u*z+g*U+v*Y+T,O=d*z+y*U+w*Y+S,$=p*z+_*U+x*Y+C};if(s===1)for(let N=0;N<c;++N)D(3*o[N]),a[i]=A,a[i+1]=O,a[i+2]=$,i+=l;else for(let N=0;N<c;++N){D(3*o[N]);for(let z=0;z<s;++z)a[i]=A,a[i+1]=O,a[i+2]=$,i+=l}}function vj(t,e,r,i,s=1){if(!e)return void Vge(t,r,i,s);const{data:n,indices:o}=t,a=e,l=r.typedBuffer,c=r.typedBufferStride,u=o.length,d=a[0],p=a[1],g=a[2],y=a[4],_=a[5],v=a[6],w=a[8],x=a[9],T=a[10],S=!$7(a),C=1e-6,A=1-C;i*=c;let O=0,$=0,D=0;const N=iD(a)?z=>{O=n[z],$=n[z+1],D=n[z+2]}:z=>{const U=n[z],Y=n[z+1],H=n[z+2];O=d*U+y*Y+w*H,$=p*U+_*Y+x*H,D=g*U+v*Y+T*H};if(s===1)if(S)for(let z=0;z<u;++z){N(3*o[z]);const U=O*O+$*$+D*D;if(U<A&&U>C){const Y=1/Math.sqrt(U);l[i]=O*Y,l[i+1]=$*Y,l[i+2]=D*Y}else l[i]=O,l[i+1]=$,l[i+2]=D;i+=c}else for(let z=0;z<u;++z)N(3*o[z]),l[i]=O,l[i+1]=$,l[i+2]=D,i+=c;else for(let z=0;z<u;++z){if(N(3*o[z]),S){const U=O*O+$*$+D*D;if(U<A&&U>C){const Y=1/Math.sqrt(U);O*=Y,$*=Y,D*=Y}}for(let U=0;U<s;++U)l[i]=O,l[i+1]=$,l[i+2]=D,i+=c}}function H7e(t,e,r,i,s=1){if(!e)return void o2(t,r,i,s);const{data:n,indices:o}=t,a=e,l=r.typedBuffer,c=r.typedBufferStride,u=o.length,d=a[0],p=a[1],g=a[2],y=a[4],_=a[5],v=a[6],w=a[8],x=a[9],T=a[10],S=!$7(a),C=1e-6,A=1-C;if(i*=c,s===1)for(let O=0;O<u;++O){const $=4*o[O],D=n[$],N=n[$+1],z=n[$+2],U=n[$+3];let Y=d*D+y*N+w*z,H=p*D+_*N+x*z,V=g*D+v*N+T*z;if(S){const J=Y*Y+H*H+V*V;if(J<A&&J>C){const P=1/Math.sqrt(J);Y*=P,H*=P,V*=P}}l[i]=Y,l[i+1]=H,l[i+2]=V,l[i+3]=U,i+=c}else for(let O=0;O<u;++O){const $=4*o[O],D=n[$],N=n[$+1],z=n[$+2],U=n[$+3];let Y=d*D+y*N+w*z,H=p*D+_*N+x*z,V=g*D+v*N+T*z;if(S){const J=Y*Y+H*H+V*V;if(J<A&&J>C){const P=1/Math.sqrt(J);Y*=P,H*=P,V*=P}}for(let J=0;J<s;++J)l[i]=Y,l[i+1]=H,l[i+2]=V,l[i+3]=U,i+=c}}function Gge(t,e,r,i,s=1){const{data:n,indices:o}=t,a=r.typedBuffer,l=r.typedBufferStride,c=o.length;if(i*=l,e!==n.length||e!==4)if(s!==1)if(e!==4)for(let u=0;u<c;++u){const d=3*o[u];for(let p=0;p<s;++p)a[i]=n[d],a[i+1]=n[d+1],a[i+2]=n[d+2],a[i+3]=255,i+=l}else for(let u=0;u<c;++u){const d=4*o[u];for(let p=0;p<s;++p)a[i]=n[d],a[i+1]=n[d+1],a[i+2]=n[d+2],a[i+3]=n[d+3],i+=l}else{if(e===4){for(let u=0;u<c;++u){const d=4*o[u];a[i]=n[d],a[i+1]=n[d+1],a[i+2]=n[d+2],a[i+3]=n[d+3],i+=l}return}for(let u=0;u<c;++u){const d=3*o[u];a[i]=n[d],a[i+1]=n[d+1],a[i+2]=n[d+2],a[i+3]=255,i+=l}}else{a[i]=n[0],a[i+1]=n[1],a[i+2]=n[2],a[i+3]=n[3];const u=new Uint32Array(r.typedBuffer.buffer,r.start),d=l/4,p=u[i/=4];i+=d;const g=c*s;for(let y=1;y<g;++y)u[i]=p,i+=d}}function q7e(t,e,r){const{data:i,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length,l=i[0];r*=o;for(let c=0;c<a;++c)n[r]=l,r+=o}function jge(t,e,r,i,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(i*=o,s===1)for(let a=0;a<r;++a)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<s;++l)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o}function W7e(t,e,r,i,s,n){var o;for(const a of e.fields.keys()){const l=t.attributes.get(a),c=l==null?void 0:l.indices;if(l&&c)Hge(a,l,r,i,s,n);else if(a===R.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const u=(o=t.attributes.get(R.POSITION))==null?void 0:o.indices;if(u){const d=u.length,p=s.getField(a,jo);jge(t.objectAndLayerIdColor,p,d,n)}}}}function Hge(t,e,r,i,s,n){switch(t){case R.POSITION:{Je(e.size===3);const o=s.getField(t,cn);Je(!!o,`No buffer view for ${t}`),o&&_j(e,r,o,n);break}case R.NORMAL:{Je(e.size===3);const o=s.getField(t,cn);Je(!!o,`No buffer view for ${t}`),o&&vj(e,i,o,n);break}case R.NORMALCOMPRESSED:{Je(e.size===2);const o=s.getField(t,Z3);Je(!!o,`No buffer view for ${t}`),o&&BJ(e,o,n);break}case R.UV0:{Je(e.size===2);const o=s.getField(t,Mv);Je(!!o,`No buffer view for ${t}`),o&&BJ(e,o,n);break}case R.COLOR:case R.SYMBOLCOLOR:{const o=s.getField(t,jo);Je(!!o,`No buffer view for ${t}`),Je(e.size===3||e.size===4),!o||e.size!==3&&e.size!==4||Gge(e,e.size,o,n);break}case R.COLORFEATUREATTRIBUTE:{const o=s.getField(t,eN);Je(!!o,`No buffer view for ${t}`),Je(e.size===1),o&&e.size===1&&q7e(e,o,n);break}case R.TANGENT:{Je(e.size===4);const o=s.getField(t,nd);Je(!!o,`No buffer view for ${t}`),o&&H7e(e,i,o,n);break}case R.PROFILERIGHT:case R.PROFILEUP:case R.PROFILEVERTEXANDNORMAL:case R.FEATUREVALUE:{Je(e.size===4);const o=s.getField(t,nd);Je(!!o,`No buffer view for ${t}`),o&&o2(e,o,n)}}}let dwt=class extends Vr{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function Y7e(t,e){qge(t,e,new Pt("slicePlaneOrigin",(r,i)=>Zge(e,r,i)),new Pt("slicePlaneBasis1",(r,i)=>{var s;return DI(e,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new Pt("slicePlaneBasis2",(r,i)=>{var s;return DI(e,r,i,(s=i.slicePlane)==null?void 0:s.basis2)}))}function us(t,e){qge(t,e,new Cc("slicePlaneOrigin",(r,i)=>Zge(e,r,i)),new Cc("slicePlaneBasis1",(r,i)=>{var s;return DI(e,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new Cc("slicePlaneBasis2",(r,i)=>{var s;return DI(e,r,i,(s=i.slicePlane)==null?void 0:s.basis2)}))}function qge(t,e,...r){if(!e.hasSlicePlane){const o=b`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...r),t.fragment.uniforms.add(...r);const i=b`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=b`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=e.hasSliceHighlight?b`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:b`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(i),t.fragment.code.add(i),t.fragment.code.add(n)}function Wge(t,e,r){return t.instancedDoublePrecision?se(X7e,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function Yge(t,e){return t!=null?ce(NI,e.origin,t):e.origin}function Xge(t,e,r){return t.hasSliceTranslatedView?e!=null?Ya(Z7e,r.camera.viewMatrix,e):r.camera.viewMatrix:null}function Zge(t,e,r){if(r.slicePlane==null)return Mn;const i=Wge(t,e,r),s=Yge(i,r.slicePlane),n=Xge(t,i,r);return n!=null?De(NI,s,n):s}function DI(t,e,r,i){if(i==null||r.slicePlane==null)return Mn;const s=Wge(t,e,r),n=Yge(s,r.slicePlane),o=Xge(t,s,r);return o!=null?(le(TT,i,n),De(NI,n,o),De(TT,TT,o),ce(TT,TT,NI)):i}const X7e=E(),NI=E(),TT=E(),Z7e=ge();function rA(t,e){const r=e.output===L.ObjectAndLayerIdColor,i=e.objectAndLayerIdColorInstanced;r&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),i?t.attributes.add(R.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(R.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(b`
     void forwardObjectAndLayerIdColor() {
      ${r?i?b`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:b`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:b``} }`),t.fragment.code.add(b`
      void outputObjectAndLayerIdColor() {
        ${r?b`fragColor = objectAndLayerIdColorVarying;`:b``} }`)}function _N(t){t.uniforms.add(new Op("alignPixelEnabled",(e,r)=>r.alignPixelEnabled)),t.code.add(b`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(b`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function J7e(t,e){const{vertex:r,fragment:i}=t;r.include(_N),e.multipassEnabled&&(r.include(Efe),t.varyings.add("depth","float")),r.code.add(b`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.multipassEnabled?b`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.multipassEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.include(Nl,e),i.code.add(b`
  void main() {
    fragColor = vec4(1);
    ${e.multipassEnabled?b`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)}function Jge(t){t.vertex.uniforms.add(new Ee("renderTransparentlyOccludedHUD",(e,r)=>r.hudRenderStyle===fl.Occluded?1:r.hudRenderStyle===fl.NotOccluded?0:.75),new nr("viewport",(e,r)=>r.camera.fullViewport),new Ze("hudVisibilityTexture",(e,r)=>{var i;return(i=r.hudVisibility)==null?void 0:i.colorTexture})),t.vertex.include(_N),t.vertex.code.add(b`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}const Qge=Ot(1,1,0,1),bj=Ot(1,0,1,1);function _y(t){t.fragment.uniforms.add(new Ze("depthTexture",(e,r)=>r.mainDepth)),t.fragment.constants.add("occludedHighlightFlag","vec4",Qge).add("unoccludedHighlightFlag","vec4",bj),t.fragment.code.add(b`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let Kge=class extends qi{constructor(e,r,i){super(e,"vec4",gr.Pass,(s,n,o)=>s.setUniform4fv(e,r(n,o)),i)}},Va=class extends qi{constructor(e,r,i){super(e,"float",gr.Pass,(s,n,o)=>s.setUniform1fv(e,r(n,o)),i)}},iA=class extends Cge{constructor(){super(...arguments),this.renderOccluded=Ti.Occlude,this.isDecoration=!1}};const mx=8;function am(t,e){const{vertex:r,attributes:i}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&i.add(R.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(r.uniforms.add(new Pt("vvSizeMinSize",s=>s.vvSize.minSize)),r.uniforms.add(new Pt("vvSizeMaxSize",s=>s.vvSize.maxSize)),r.uniforms.add(new Pt("vvSizeOffset",s=>s.vvSize.offset)),r.uniforms.add(new Pt("vvSizeFactor",s=>s.vvSize.factor)),r.uniforms.add(new fd("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),r.uniforms.add(new Pt("vvSymbolAnchor",s=>s.vvSymbolAnchor)),r.code.add(b`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(b`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?b`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(b`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(r.constants.add("vvColorNumber","int",mx),r.uniforms.add(new Va("vvColorValues",s=>s.vvColor.values,mx),new Kge("vvColorColors",s=>s.vvColor.colors,mx)),r.code.add(b`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?b`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):r.code.add(b`vec4 vvColor() { return vec4(1.0); }`)}const FI=.1,qn=.001;function Q7e(t){const e=new dr,r=t.signedDistanceFieldEnabled;if(e.include($ge,t),e.include(us,t),t.occlusionPass)return e.include(J7e,t),e;const{vertex:i,fragment:s}=e;e.include(pj),s.include(zu),s.include(tf),e.include(am,t),e.include(rA,t),e.include(Jge),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),e.varyings.add("voccluded","float"),i.uniforms.add(new nr("viewport",(c,u)=>u.camera.fullViewport),new Ir("screenOffset",(c,u)=>ir(e0e,2*c.screenOffset[0]*u.camera.pixelRatio,2*c.screenOffset[1]*u.camera.pixelRatio)),new Ir("anchorPosition",c=>UI(c)),new nr("materialColor",c=>c.color)),N2(i),r&&(i.uniforms.add(new nr("outlineColor",c=>c.outlineColor)),s.uniforms.add(new nr("outlineColor",c=>VJ(c)?c.outlineColor:Ec),new Ee("outlineSize",c=>VJ(c)?c.outlineSize:0))),t.pixelSnappingEnabled&&i.include(_N),t.hasScreenSizePerspective&&(F7e(i),yN(i)),t.debugDrawLabelBorder&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(R.UV0,"vec2"),e.attributes.add(R.COLOR,"vec4"),e.attributes.add(R.SIZE,"vec2"),e.attributes.add(R.FEATUREATTRIBUTE,"vec4"),i.code.add(b`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?b`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:b`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const n=b`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=t.pixelSnappingEnabled?r?b`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:b`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:b`posProj += quadOffset;`;i.code.add(b`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${t.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===L.ObjectAndLayerIdColor?b`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${b.float(qn)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${b.float(qn)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?b`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new Ze("tex",c=>c.texture));const a=t.debugDrawLabelBorder?b`(isBorder > 0.0 ? 0.0 : ${b.float(FI)})`:b.float(FI),l=b`
    ${t.debugDrawLabelBorder?b`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${t.sampleSignedDistanceFieldTexelCenter?b`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:b`
      vec2 samplePos = vtc;
      `}

    ${r?b`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${b.float(qn)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:b`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?b`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(t.output){case L.Color:s.code.add(b`
        void main() {
          ${l}
          ${t.transparencyPassType===Qe.FrontFace?"fragColor.rgb /= fragColor.a;":""}
        }`);break;case L.Alpha:s.code.add(b`
        void main() {
          ${l}
          fragColor = vec4(fragColor.a);
        }`);break;case L.ObjectAndLayerIdColor:s.code.add(b`
        void main() {
          ${l}
          outputObjectAndLayerIdColor();
        }`);break;case L.Highlight:s.constants.add("occludedHighlightFlag","vec4",Qge).add("unoccludedHighlightFlag","vec4",bj),s.code.add(b`
        void main() {
          ${l}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return e}function VJ(t){return t.outlineColor[3]>0&&t.outlineSize>0}function UI(t,e=e0e){return t.textureIsSignedDistanceField?K7e(t.anchorPosition,t.distanceFieldBoundingBox,e):Ns(e,t.anchorPosition),e}function K7e(t,e,r){e!=null?ir(r,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):ir(r,0,0)}const e0e=ke(),eVe=Object.freeze(Object.defineProperty({__proto__:null,build:Q7e,calculateAnchorPosForRendering:UI},Symbol.toStringTag,{value:"Module"})),Ac=Jn(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),tVe=Dl(ve.ONE,ve.ONE),t0e=Dl(ve.ZERO,ve.ONE_MINUS_SRC_ALPHA);function Bm(t){return t===Qe.FrontFace?null:t===Qe.Alpha?t0e:tVe}function vN(t){return t===Qe.FrontFace?Xa:null}const bN=5e5,wN={factor:-1,units:-2};function xN(t){return t?wN:null}function vy(t,e=Ar.LESS){return t===Qe.NONE||t===Qe.FrontFace?e:Ar.LEQUAL}let r0e=class i0e extends Sr{initializeConfiguration(e,r){r.spherical=e.viewingMode===$e.Global}initializeProgram(e){return new vr(e.rctx,i0e.shader.get().build(this.configuration),hr)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===Qe.NONE,s=e===Qe.FrontFace,n=this.configuration.hasPolygonOffset?rVe:null,o=(i||s)&&r.output!==L.Highlight&&(r.depthEnabled||r.occlusionPass)?Xa:null;return Et({blending:r.output===L.Color||r.output===L.Alpha||r.output===L.Highlight?i?iVe:Bm(e):null,depthTest:{func:Ar.LEQUAL},depthWrite:o,colorWrite:Ut,polygonOffset:n})}get primitiveType(){return this.configuration.occlusionPass?Qt.POINTS:Qt.TRIANGLES}};r0e.shader=new _r(eVe,()=>he(()=>import("./HUDMaterial.glsl-5810373e.js"),[],import.meta.url));const rVe={factor:0,units:-4},iVe=Dl(ve.ONE,ve.ONE_MINUS_SRC_ALPHA);let Es=class extends ga{constructor(){super(...arguments),this.output=L.Color,this.transparencyPassType=Qe.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};h([F({count:L.COUNT})],Es.prototype,"output",void 0),h([F({count:Qe.COUNT})],Es.prototype,"transparencyPassType",void 0),h([F()],Es.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([F()],Es.prototype,"spherical",void 0),h([F()],Es.prototype,"occlusionTestEnabled",void 0),h([F()],Es.prototype,"signedDistanceFieldEnabled",void 0),h([F()],Es.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),h([F()],Es.prototype,"vvSize",void 0),h([F()],Es.prototype,"vvColor",void 0),h([F()],Es.prototype,"hasVerticalOffset",void 0),h([F()],Es.prototype,"hasScreenSizePerspective",void 0),h([F()],Es.prototype,"debugDrawLabelBorder",void 0),h([F()],Es.prototype,"hasSlicePlane",void 0),h([F()],Es.prototype,"hasPolygonOffset",void 0),h([F()],Es.prototype,"depthEnabled",void 0),h([F()],Es.prototype,"pixelSnappingEnabled",void 0),h([F()],Es.prototype,"draped",void 0),h([F()],Es.prototype,"multipassEnabled",void 0),h([F()],Es.prototype,"cullAboveGround",void 0),h([F()],Es.prototype,"occlusionPass",void 0),h([F()],Es.prototype,"objectAndLayerIdColorInstanced",void 0),h([F({constValue:!0})],Es.prototype,"hasSliceInVertexProgram",void 0),h([F({constValue:!1})],Es.prototype,"hasVvInstancing",void 0);let a2=class extends yy{constructor(e){super(e,new mVe),this._configuration=new Es}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=r.slot===oe.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===L.Color||e===L.Alpha),e===L.Color&&(this._configuration.debugDrawLabelBorder=!!Zr.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(e,r,i,s,n,o){if(!(i.options.selectionMode&&i.options.hud&&e.visible&&i.point))return;const a=this.parameters,l=i.point,c=i.camera;let{scaleX:u,scaleY:d}=this._getScreenScale(e);u*=c.pixelRatio,d*=c.pixelRatio,Iu(j5,r),e.attributes.has(R.FEATUREATTRIBUTE)&&oVe(j5);const p=e.attributes.get(R.POSITION),g=e.attributes.get(R.SIZE),y=e.attributes.get(R.NORMAL),_=e.attributes.get(R.AUXPOS1);Je(p.size>=3);const v=UI(a),w=this.parameters.centerOffsetUnits==="screen";for(let x=0;x<p.data.length/p.size;x++){const T=x*p.size;se(wo,p.data[T],p.data[T+1],p.data[T+2]),De(wo,wo,r);const S=x*g.size;pg[0]=g.data[S]*u,pg[1]=g.data[S+1]*d,De(wo,wo,c.viewMatrix);const C=x*_.size;if(se(Vl,_.data[C],_.data[C+1],_.data[C+2]),!w&&(wo[0]+=Vl[0],wo[1]+=Vl[1],Vl[2]!==0)){const O=Vl[2];pe(Vl,wo),ce(wo,wo,ee(Vl,Vl,O))}const A=x*y.size;if(se(ST,y.data[A],y.data[A+1],y.data[A+2]),this._normalAndViewAngle(ST,j5,c,H5),this._applyVerticalOffsetTransformationView(wo,H5,c,G5),c.applyProjection(wo,Qo),Qo[0]>-1){w&&(Vl[0]||Vl[1])&&(Qo[0]+=Vl[0]*c.pixelRatio,Vl[1]!==0&&(Qo[1]+=uj(Vl[1],G5.factorAlignment)*c.pixelRatio),c.unapplyProjection(Qo,wo)),Qo[0]+=this.parameters.screenOffset[0]*c.pixelRatio,Qo[1]+=this.parameters.screenOffset[1]*c.pixelRatio,Qo[0]=Math.floor(Qo[0]),Qo[1]=Math.floor(Qo[1]),wge(pg,G5.factor,pg);const O=dVe*c.pixelRatio;let $=0;if(a.textureIsSignedDistanceField&&($=a.outlineSize*c.pixelRatio/2),GJ(l,Qo[0],Qo[1],pg,O,$,a,v)){const D=i.ray;if(De(jJ,wo,Ls(cVe,c.viewMatrix)),Qo[0]=l[0],Qo[1]=l[1],c.unprojectFromRenderScreen(Qo,wo)){const N=E();ie(N,D.direction);const z=1/_e(N);ee(N,N,z),o(hi(D.origin,wo)*z,N,-1,!0,1,jJ)}}}}}intersectDraped(e,r,i,s,n,o){const a=e.attributes.get(R.POSITION),l=e.attributes.get(R.SIZE),c=this.parameters,u=UI(c);let{scaleX:d,scaleY:p}=this._getScreenScale(e);d*=e.screenToWorldRatio,p*=e.screenToWorldRatio;const g=pVe*e.screenToWorldRatio;for(let y=0;y<a.data.length/a.size;y++){const _=y*a.size,v=a.data[_],w=a.data[_+1],x=y*l.size;pg[0]=l.data[x]*d,pg[1]=l.data[x+1]*p;let T=0;c.textureIsSignedDistanceField&&(T=c.outlineSize*e.screenToWorldRatio/2),GJ(s,v,w,pg,g,T,c,u)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new yVe(this)}_normalAndViewAngle(e,r,i,s){return T7e(r)&&(r=Iu(lVe,r)),Sl(s.normal,e,r),De(s.normal,s.normal,i.viewInverseTransposeMatrix),s.cosAngle=de(s0e,fVe),s}_updateScaleInfo(e,r,i){const s=this.parameters;s.screenSizePerspective!=null?MJ(i,r,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),s.screenSizePerspectiveAlignment!=null?MJ(i,r,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,r,i,s,n,o,a){const l=this._normalAndViewAngle(r,i,n,H5);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,r,i,s,n){return this._applyCenterOffsetNDC(e,r,i,s),n!=null&&ie(n,s),this._applyPolygonOffsetNDC(s,r,i,s),s}_applyPolygonOffsetView(e,r,i,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ie(n,e);const c=me(Math.abs(r.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/s.viewport[2];return ee(n,e,l>0?u:1/u),n}_applyVerticalGroundOffsetView(e,r,i,s){const n=_e(e),o=i.aboveGround?1:-1,a=i.computeRenderPixelSizeAtDist(n)*Mge,l=ee(wo,r.normal,o*a);return le(s,e,l),s}_applyVerticalOffsetTransformationView(e,r,i,s){var c;const n=this.parameters;if(!((c=n.verticalOffset)!=null&&c.screenLength)){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const u=_e(e);this._updateScaleInfo(s,u,r.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=_e(e),a=n.screenSizePerspectiveAlignment??n.screenSizePerspective,l=Fge(i,o,n.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(s,o,r.cosAngle),ee(r.normal,r.normal,l),le(e,e,r.normal)}_applyCenterOffsetView(e,r,i){const s=this.parameters.centerOffsetUnits!=="screen";return i!==e&&ie(i,e),s&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(pe(ST,i),le(i,i,ee(ST,ST,r[2])))),i}_applyCenterOffsetNDC(e,r,i,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&ie(s,e),n||(s[0]+=r[0]/i.fullWidth*2,s[1]+=r[1]/i.fullHeight*2),s}_applyPolygonOffsetNDC(e,r,i,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&ie(s,e),n){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);s[2]-=(a||o)*n}return s}produces(e,r){if(r===L.Color||r===L.Alpha||r===L.Highlight||r===L.ObjectAndLayerIdColor){if(e===oe.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:s}=this.parameters;return e===(i?oe.LABEL_MATERIAL:oe.HUD_MATERIAL)||s&&e===oe.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new sVe(e)}calculateRelativeScreenBounds(e,r,i=Gt()){return nVe(this.parameters,e,r,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}_getScreenScale(e){const r=e.attributes.get(R.FEATUREATTRIBUTE);if(r==null)return{scaleX:1,scaleY:1};const i=OV(r.data,hVe),[s,n]=dj(uVe,this.parameters,i);return{scaleX:s,scaleY:n}}},sVe=class extends EG{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(r0e,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function nVe(t,e,r,i=aVe){return Ns(i,t.anchorPosition),i[0]*=-e[0],i[1]*=-e[1],i[0]+=t.screenOffset[0]*r,i[1]+=t.screenOffset[1]*r,i}function oVe(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=1/Math.sqrt(e*e+r*r+i*i),d=1/Math.sqrt(s*s+n*n+o*o),p=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*u,t[1]=r*u,t[2]=i*u,t[3]=s*d,t[4]=n*d,t[5]=o*d,t[6]=a*p,t[7]=l*p,t[8]=c*p,t}function GJ(t,e,r,i,s,n,o,a){let l=e-s-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*s,u=r-s-(a[1]>0?i[1]*a[1]:0),d=u+i[1]+2*s;const p=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&p!=null&&(l+=i[0]*p[0],u+=i[1]*p[1],c-=i[0]*(1-p[2]),d-=i[1]*(1-p[3]),l-=n,c+=n,u-=n,d+=n),t[0]>l&&t[0]<c&&t[1]>u&&t[1]<d}const G5=new zge,aVe=ke(),wo=E(),ST=E(),Qo=Jt(),s0e=E(),jJ=E(),j5=Fi(),lVe=Fi(),cVe=ge(),Vl=E(),uVe=Jt(),hVe=Jt(),H5={normal:s0e,cosAngle:0},dVe=1,pVe=2,pg=[0,0],fVe=Te(0,0,1);let mVe=class extends ufe{constructor(){super(...arguments),this.renderOccluded=Ti.Occlude,this.isDecoration=!1,this.color=Ot(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=tr(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=Ot(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const n0e=Ci().vec3f(R.POSITION).vec3f(R.NORMAL).vec2f(R.UV0).vec4u8(R.COLOR).vec2f(R.SIZE).vec4f(R.AUXPOS1).vec4f(R.FEATUREATTRIBUTE),gVe=n0e.clone().vec4u8(R.OBJECTANDLAYERIDCOLOR);let yVe=class{constructor(e){this._material=e,this.vertexBufferLayout=te("enable-feature:objectAndLayerId-rendering")?gVe:n0e}elementCount(e){return 6*e.attributes.get(R.POSITION).indices.length}write(e,r,i,s,n){var w;_j(i.attributes.get(R.POSITION),e,s.position,n,6),vj(i.attributes.get(R.NORMAL),r,s.normal,n,6);const o=i.attributes.get(R.UV0).data;let a,l,c,u;if(o==null||o.length<4){const x=this._material.parameters;a=0,l=0,c=x.texCoordScale[0],u=x.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],u=o[3];c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let d=i.attributes.get(R.POSITION).indices.length,p=n;const g=s.uv0;for(let x=0;x<d;++x)g.set(p,0,a),g.set(p,1,l),p++,g.set(p,0,c),g.set(p,1,l),p++,g.set(p,0,c),g.set(p,1,u),p++,g.set(p,0,c),g.set(p,1,u),p++,g.set(p,0,a),g.set(p,1,u),p++,g.set(p,0,a),g.set(p,1,l),p++;Gge(i.attributes.get(R.COLOR),4,s.color,n,6);const{data:y,indices:_}=i.attributes.get(R.SIZE);d=_.length;const v=s.size;p=n;for(let x=0;x<d;++x){const T=y[2*_[x]],S=y[2*_[x]+1];for(let C=0;C<6;++C)v.set(p,0,T),v.set(p,1,S),p++}if(i.attributes.get(R.AUXPOS1)?o2(i.attributes.get(R.AUXPOS1),s.auxpos1,n,6):zJ(s.auxpos1,n,6*d),i.attributes.get(R.FEATUREATTRIBUTE)?o2(i.attributes.get(R.FEATUREATTRIBUTE),s.featureAttribute,n,6):zJ(s.featureAttribute,n,6*d),i.objectAndLayerIdColor!=null){const x=(w=i.attributes.get(R.POSITION))==null?void 0:w.indices;if(x){const T=x.length,S=s.getField(R.OBJECTANDLAYERIDCOLOR,jo);jge(i.objectAndLayerIdColor,S,T,n,6)}}}};const Sd=E(),db=Jt(),ET=Jt(),q5=E(),_Ve=ge(),vVe=ds(),W5=ln(),bVe=E(),wVe=Gt();class xVe{constructor(){this.aabr=Gt(),this.distance=0,this.culled=!1,this.visible=!1}}class TVe{constructor(e,r){this.graphics3DGraphic=e,this.slicePlaneEnabled=r,this.info={}}}var pl;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(pl||(pl={}));class o0e{constructor(){this.camera=new ot,this.slicePlane=$m(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),Av(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let Gw=class extends xe{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new o0e,this._state=pl.Idle,this._active=new Map,this._visible=new Map,this._iterators=new AVe,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==pl.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/pl.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case pl.Idle:this._startUpdate(),t.madeProgress();case pl.Process:if(this._state=pl.Process,!this._processActiveGraphics(t))return;case pl.Sort:if(this._state=pl.Sort,!this._sortVisibleGraphics(t))return;case pl.Deconflict:if(this._state=pl.Deconflict,!this._deconflictVisibleGraphics(t))return;default:d7e(this,this._visible),this._state=pl.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(r=>this.addToActiveGraphics(r)):t.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;if(((e==null?void 0:e.geometries.length)??0)!==1)return!1;const r=e==null?void 0:e.geometries[0];return(r==null?void 0:r.material)instanceof a2}_startUpdate(){p7e(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new xVe,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),SVe(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),r=T2(_Ve,this._runningViewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?vVe:null;let s=0;for(i!=null&&(De(i,Mn,this._runningViewState.camera.viewMatrix),i[3]=Mr(this.view.spatialReference).radius,s=che(i,Mn));!t.done;){t.madeProgress();const n=e.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o==null?void 0:o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const r=e.next();if(t.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===An.LABEL;for(;!t.done;){t.madeProgress();const i=e.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=i.value,n=s.info[this.visibilityGroup];if(!n||n.culled){this._setGraphicVisibility(s,!1);continue}const o=s.graphics3DGraphic,a=!r||o.isVisible();n.visible=a&&!this._isConflicted(s),n.visible&&this._addToBins(s),this._setGraphicVisibility(s,n.visible),m7e(n,n.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=HJ(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=HJ(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=EVe(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,r,i){const s=t.graphics3DGraphic;if(s.destroyed)return;const n=t.info[this.visibilityGroup];if(!s.isVisible(An.GRAPHIC,uo.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);Mu(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=PVe,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,Sd)||r!=null&&this._isCulledByHorizon(a,r,i)))return void(n.culled=!0);this._expandBoundingRect(n,l,c,a)}a==null?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(t,e,r){const i=this._runningViewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;De(Sd,a,i.viewMatrix);const l=n.attributes,c=l.get(R.NORMAL).data,u=l.get(R.AUXPOS1).data;o.applyShaderOffsetsView(Sd,c,s.transformation,u,i,r.scaleInfo,Sd),Si(db,Sd[0],Sd[1],Sd[2],1),gc(ET,db,i.projectionMatrix),ee(r.positionNDC,ET,1/ET[3]),o.applyShaderOffsetsNDC(r.positionNDC,u,i,r.positionNDC,q5),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(q5[2]),r.distance=q5[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),Si(ET,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),gc(db,ET,e),X1(db,db,1/db[3]),se(r.positionView,Sd[0],Sd[1],Sd[2])}_isCulledByHorizon(t,e,r){return ie(W5.direction,t.positionView),se(W5.origin,0,0,0),!!py(e,W5,bVe)&&t.distanceWithoutPolygonOffset>r}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&kV(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,r,{positionNDC:i,scaleInfo:s}){const n=this._runningViewState.camera,o=e.getScreenSize(RVe);wge(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=U$(r.calculateRelativeScreenBounds(o,s.factorAlignment.scale,wVe),ft(0,n.fullWidth,.5+.5*i[0]),ft(0,n.fullHeight,.5+.5*i[1])),l=this.marginFactor;if(l!==0){const c=l*Math.min(Lo(a),ja(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}M0(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,r=t.info[this.visibilityGroup];let i=!0;for(let s=Math.floor(r.aabr[0]/this._accBinsSizeX);s<=Math.floor(r.aabr[2]/this._accBinsSizeX);s++)if(!(s<0||s>=this._accBinsNumX))for(let n=Math.floor(r.aabr[1]/this._accBinsSizeY);n<=Math.floor(r.aabr[3]/this._accBinsSizeY);n++){if(n<0||n>=this._accBinsNumY)continue;i=!1;const o=this._accBins[s][n];for(let a=0;a<o.length;a++){const l=o.data[a],c=l.info[this.visibilityGroup];if(c&&c.visible&&l.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,aD(c.aabr,r.aabr)))return!0}}return i}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)i.push(new It)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],r=Math.floor(e.aabr[0]/this._accBinsSizeX),i=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const r=t.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(this.visibilityGroup,uo.DECONFLICTION,e),this.visibilityGroup===An.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,e))}};function SVe(t,e){const r=t.graphics3DGraphic;r.destroyed||r.setVisibilityFlag(e,uo.DECONFLICTION,!0)}function*HJ(t){if(Map.prototype.entries){const e=t.entries();for(let r=e.next();!r.done;r=e.next())yield r.value[1]}else yield*t.values()}function*EVe(t,e,r){e.clear(),t.forEach((s,n)=>{var l;const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.getVisibilityFlag(r,uo.DECONFLICTION);const a=(l=s.info)==null?void 0:l[r];o.prio=s.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const i=e.iterableSort((s,n)=>s.prio!==n.prio?n.prio-s.prio:s.distance!==n.distance?s.distance-n.distance:s.visible!==n.visible?s.visible?-1:1:s.id-n.id);for(let s=i.next();!s.done;s=i.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}h([f({constructOnly:!0})],Gw.prototype,"view",void 0),h([f({type:Boolean,readOnly:!0})],Gw.prototype,"updating",null),Gw=h([k("esri.views.3d.layers.graphics.Deconflictor")],Gw);class CVe{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class AVe{constructor(e=null,r=null,i=null){this.active=e,this.visible=r,this.sort=i,this.sortArray=new It({allocator:s=>s||new CVe})}}const RVe=ke();class OVe{constructor(){this.positionView=E(),this.positionNDC=E(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new zge}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const PVe=new OVe,MVe=2e3;let PM=class extends Gw{constructor(e){super(e),this.visibilityGroup=An.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return go.YIELD;const r=performance.now();if(e.state!==xr.IDLE&&r-this._lastDeconfliction<MVe)return go.YIELD;super.runTask(e),this.state===pl.Idle&&(this._lastDeconfliction=r)}enabledChanged(e,r){this.modifyGraphics(r,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};h([f({constructOnly:!0})],PM.prototype,"parent",void 0),PM=h([k("esri.views.3d.layers.graphics.LabelDeconflictor")],PM);let EB=class extends Gw{constructor(){super(...arguments),this._contexts=new Map,this._viewState=new o0e,this.visibilityGroup=An.GRAPHIC,this._marginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([ae(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.state)==null?void 0:r.camera},()=>{this._updateViewState(),this.setDirty()}),ae(()=>{var e,r,i;return(i=(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground)==null?void 0:i.opacity},(e,r)=>{e!==1&&r!==1||this.setDirty()}),ae(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},zr)]),this._frameTask=this.view.resourceController.scheduler.registerTask(ct.GRAPHICS_DECONFLICTOR,this),this._labels=new PM({view:this.view,parent:this})}destroy(){this._labels=Oe(this._labels),this._frameTask=di(this._frameTask)}get marginFactor(){return this._marginFactor}set marginFactor(e){this._marginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,r){const i=!(this._graphicSupportsDeconfliction(r)&&Y5(e));r.setVisibilityFlag(An.GRAPHIC,uo.DECONFLICTION,i)}_updateViewState(){var e;(e=this.view)!=null&&e.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&The(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){hc(this._contexts,(e,r)=>r.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const r=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,r,i),removeGraphic:i=>this._removeGraphic(r,i),labelingInfoChange:()=>this._labels.enabledChanged(e,r),featureReductionChange:()=>this.enabledChanged(e,r),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,r),clear:()=>r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic))}}removeGraphicsOwner(e){const r=this._contexts.get(e);r&&(r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,r,i){const s=i.graphic.uid,n=new TVe(i,e.symbolCreationContext.slicePlaneEnabled);r.set(s,n),Y5(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n)}_removeGraphic(e,r){const i=r.graphic.uid,s=e.get(i);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(i),this.setDirty())}enabledChanged(e,r){const i=Y5(e);i||$Ve(e),this.modifyGraphics(r,i)}_slicePlaneEnabledChanged(e,r){const i=e.symbolCreationContext.slicePlaneEnabled;r.forEach(s=>s.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const r=e.layers;if(!(r!=null&&r.length))return!1;for(const i of r)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){const r=this._contexts.get(e);if(r)return r;const i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function Y5(t){const e=t.layer;return!(!(e!=null&&e.featureReduction)||e.featureReduction.type!=="selection")}function $Ve(t){const e=t.graphics3DGraphics;e&&e.forEach(r=>r.setVisibilityFlag(An.GRAPHIC,uo.DECONFLICTION,!0))}EB=h([k("esri.views.3d.layers.graphics.GraphicsDeconflictor")],EB);function a0e(t){return"declaredClass"in t}function qJ(t){return"declaredClass"in t}function IVe(t){return"declaredClass"in t}function LVe(t,e){return t?IVe(t)?t:new iv({layer:e,sourceLayer:e,visible:t.visible,symbol:ye(t.symbol),attributes:ye(t.attributes),geometry:l0e(t.geometry)}):null}function l0e(t){return t==null?null:a0e(t)?t:$x(DVe(t))}function DVe(t){const{wkid:e,wkt:r,wkt2:i,latestWkid:s}=t.spatialReference,n={wkid:e,wkt:r,wkt2:i,latestWkid:s};switch(t.type){case"point":{const{x:o,y:a,z:l,m:c}=t;return{x:o,y:a,z:l,m:c,spatialReference:n}}case"polygon":{const{rings:o,hasZ:a,hasM:l}=t;return{rings:WJ(o),hasZ:a,hasM:l,spatialReference:n}}case"polyline":{const{paths:o,hasZ:a,hasM:l}=t;return{paths:WJ(o),hasZ:a,hasM:l,spatialReference:n}}case"extent":{const{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:d,mmin:p,mmax:g,hasZ:y,hasM:_}=t;return{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:d,mmin:p,mmax:g,hasZ:y,hasM:_,spatialReference:n}}case"multipoint":{const{points:o,hasZ:a,hasM:l}=t;return{points:u0e(o)?c0e(o):o,hasZ:a,hasM:l,spatialReference:n}}default:return}}function WJ(t){return NVe(t)?t.map(e=>c0e(e)):t}function c0e(t){return t.map(e=>Array.from(e))}function NVe(t){for(const e of t)if(e.length!==0)return u0e(e);return!1}function u0e(t){return t.length>0&&(y2(t[0])||_2(t[0]))}function FVe(t,e){if(!t)return null;let r;if(qJ(t)){if(e==null)return t.clone();if(qJ(e))return e.copy(t)}return e!=null?(r=e,r.x=t.x,r.y=t.y,r.spatialReference=t.spatialReference,t.hasZ?(r.z=t.z,r.hasZ=t.hasZ):(r.z=void 0,r.hasZ=!1),t.hasM?(r.m=t.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=fy(t.x,t.y,t.z,t.spatialReference),t.hasM&&(r.m=t.m,r.hasM=!0)),r}function Swt(t){const{wkid:e,wkt:r,wkt2:i,latestWkid:s}=t,n={wkid:e,wkt:r,wkt2:i,latestWkid:s};return at.fromJSON(n)}const wj="__begin__",xj="__end__",UVe=new RegExp(wj,"ig"),kVe=new RegExp(xj,"ig"),YJ=new RegExp("^"+wj,"i"),XJ=new RegExp(xj+"$","i"),kI='"',BVe=kI+" + ",zVe=" + "+kI;function VVe(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function Ewt(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function Tj(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=VVe(t.labelExpression),e.type="conventional"),e}function Cwt(t){const e=Tj(t);if(!e)return null;switch(e.type){case"conventional":return GVe(e.expression);case"arcade":return e.expression}return null}function Awt(t){const e=Tj(t);if(!e)return null;switch(e.type){case"conventional":return HVe(e.expression);case"arcade":return h0e(e.expression)}return null}function GVe(t){let e;return t?(e=IL(t,r=>wj+'$feature["'+r+'"]'+xj),e=YJ.test(e)?e.replace(YJ,""):kI+e,e=XJ.test(e)?e.replace(XJ,""):e+kI,e=e.replaceAll(UVe,BVe).replaceAll(kVe,zVe)):e='""',e}const jVe=/^\s*\{([^}]+)\}\s*$/i;function HVe(t){const e=t==null?void 0:t.match(jVe);return(e==null?void 0:e[1].trim())||null}const qVe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,WVe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,YVe=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function h0e(t){if(!t)return null;let e=qVe.exec(t)||WVe.exec(t);return e?e[1]||e[3]:(e=YVe.exec(t),e?e[2]:null)}const X5=ne.getLogger("esri.layers.support.labelFormatUtils"),Z5={type:"simple",evaluate:()=>null},XVe={getAttribute:(t,e)=>t.field(e)};async function d0e(t,e,r){if(!t||!t.symbol||!e)return Z5;const i=t.where,s=Tj(t);let n;if(s.type==="arcade"){const o=await wPe(s.expression,r,e);if(o==null)return Z5;n={type:"arcade",evaluate(a,l){try{const c="attributes"in a?o.repurposeFeature(a):a;c.contextTimeZone=l??null;const u=o.evaluate({$view:{timeZone:l},$feature:c},o.services);if(u!=null)return u.toString()}catch(c){X5.error(new X("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:a,expression:s}))}return null},needsHydrationToEvaluate:()=>h0e(s.expression)==null}}else n={type:"simple",evaluate:o=>s.expression.replaceAll(/{[^}]*}/g,a=>{const l=a.slice(1,-1),c=e.get(l);if(!c)return a;let u=null;return"attributes"in o?o&&o.attributes&&(u=o.attributes[c.name]):u=o.field(c.name),u==null?"":p0e(u,c)})};if(i){let o;try{o=await Xae(i,e)}catch(l){return X5.error(new X("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:l})),Z5}const a=n.evaluate;n.evaluate=(l,c)=>{const u="attributes"in l?void 0:XVe;try{if(o.testFeature(l,u))return a(l,c)}catch(d){X5.error(new X("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:l,error:d}))}return null}}return n}function p0e(t,e){if(t==null)return"";const r=e.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const s=t;for(const n of r.codedValues)if(n.code===s)return n.name}else if(r.type==="range"){const{max:s,min:n}=sce(e),o=+t;if(n!=null&&s!=null&&n<=o&&o<=s)return r.name}}let i=t;return XPe(e)?i=H0(i,sPe("short-date")):pce(e)&&(i=PC(+i)),i||""}const Rwt=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:d0e,formatField:p0e},Symbol.toStringTag,{value:"Module"}));function Sj(t,e){if(t.type==="point")return fg(t,e,!1);if(a0e(t))switch(t.type){case"extent":return fg(t.center,e,!1);case"polygon":return fg(t.centroid,e,!1);case"polyline":return fg(ZJ(t),e,!0);case"mesh":return fg(t.origin,e,!1)}else switch(t.type){case"extent":return fg(ZVe(t),e,!0);case"polygon":return fg(JVe(t),e,!0);case"polyline":return fg(ZJ(t),e,!0)}}function ZJ(t){const e=t.paths[0];if(!e||e.length===0)return null;const r=Rae(e,Aae(e)/2);return fy(r[0],r[1],r[2],t.spatialReference)}function ZVe(t){return fy(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function JVe(t){const e=t.rings[0];if(!e||e.length===0)return null;const r=Oae(t.rings,!!t.hasZ);return fy(r[0],r[1],r[2],t.spatialReference)}function fg(t,e,r){const i=r?t:FVe(t);return e&&t?Rue(t,i,e)?i:null:i}function Owt(t,e,r,i=0){if(t){e||(e=Gt());const s=t;let n=.5*s.width*(r-1),o=.5*s.height*(r-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),Si(e,s.xmin-n-i,s.ymin-o-i,s.xmax+n+i,s.ymax+o+i),e}return null}function f0e(t,e){for(let r=0;r<t.geometries.length;++r){const i=t.geometries[r].getMutableAttribute(R.AUXPOS1);i&&i.data[3]!==e&&(i.data[3]=e,t.geometryVertexAttributeUpdated(t.geometries[r],R.AUXPOS1))}}function YE(t,e,r=null){const i=V3(vu);return t!=null&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),e!=null?i[3]=e:t!=null&&t.length>3&&(i[3]=t[3]),r&&(i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r),i}function Pwt(t,e,r,i,s,n=[0,0,0,0]){for(let o=0;o<3;++o)n[o]=(t==null?void 0:t[o])!=null?t[o]:(r==null?void 0:r[o])!=null?r[o]:s[o];return n[3]=e??i??s[3],n}function JJ(t=Jf,e,r,i=1){const s=new Array(3);if(e==null||r==null)s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const u=l!=null,d=a===0&&!n&&!u,p=r[a];l==="symbol-value"||d?c=p!==0?e[a]/p:1:u&&l!=="proportional"&&isFinite(l)&&(c=p!==0?l/p:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=i;return Oo(s)}function QVe(t){return t.isPrimitive!=null}function TN(t){return CB(QVe(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function CB(t){const e=r=>r==null||r>=0;return Array.isArray(t)?t.every(e):e(t)}function KVe(t,e,r,i=ge()){return t&&Ox(i,i,-t/180*Math.PI),e&&Rx(i,i,e/180*Math.PI),r&&eD(i,i,r/180*Math.PI),i}function Ej(t,e,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=qo(e),s=Tv(t)*i,n=Sv(t)*i,o=dy(t)*(e.isGeographic?1:i);return s===0&&n===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(s,n,o)}function m0e(t,e,r,i,s,n,o,a,l,c,u){const d=aGe[u.mode];let p,g,y=0;if(Ni(t,e,r,i,l.spatialReference,s,a))return d.requiresAlignment(u)?(y=d.applyElevationAlignmentBuffer(i,s,n,o,a,l,c,u),p=n,g=o):(p=i,g=s),Ni(p,l.spatialReference,g,n,c.spatialReference,o,a)?y:void 0}function iy(t,e,r,i,s){const n=(uI(t)?t.z:xde(t)?t.array[t.offset+2]:t[2])||0;switch(r.mode){case"on-the-ground":{const o=_p(e,t,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=_p(e,t,"ground")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=_p(e,t,"scene")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(n,i),a=_p(e,t,"ground")??0;return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function eGe(t,e,r,i){return iy(t,e,r,i,jw),jw.z}function sA(t,e,r){return e==null||r==null?t.definedChanged:e==="on-the-ground"&&r==="on-the-ground"?t.staysOnTheGround:e===r||e!=="on-the-ground"&&r!=="on-the-ground"?es.UPDATE:t.onTheGroundChanged}function ku(t){return t==="relative-to-ground"||t==="relative-to-scene"}function sy(t){return t!=="absolute-height"}function tGe(t,e,r,i,s){iy(e,r,s,i,jw),f0e(t,jw.verticalDistanceToGround);const n=jw.sampledElevation,o=Ss(lGe,t.transformation);return nO[0]=e.x,nO[1]=e.y,nO[2]=jw.z,Ol(e.spatialReference,nO,o,i.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function rGe(t,e,r,i,s,n){let o=0;const a=n.spatialReference;e*=3,i*=3;for(let l=0;l<s;++l){const c=t[e],u=t[e+1],d=t[e+2],p=n.getElevation(c,u,d,a,"ground")??0;o+=p,r[i]=c,r[i+1]=u,r[i+2]=p,e+=3,i+=3}return o/s}function iGe(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,i*=3;for(let p=0;p<s;++p){const g=t[e],y=t[e+1],_=t[e+2],v=n.getElevation(g,y,_,d,"ground")??0;l+=v,r[i]=g,r[i+1]=y,r[i+2]=u==null?_+v+c:v+c,e+=3,i+=3}return l/s}function sGe(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,i*=3;for(let p=0;p<s;++p){const g=t[e],y=t[e+1],_=t[e+2],v=n.getElevation(g,y,_,d,"scene")??0;l+=v,r[i]=g,r[i+1]=y,r[i+2]=u==null?_+v+c:v+c,e+=3,i+=3}return l/s}function nGe(t){const e=t.meterUnitOffset,r=t.featureExpressionInfoContext;return e!==0||r!=null}function oGe(t,e,r,i,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,i*=3;for(let u=0;u<s;++u){const d=t[e],p=t[e+1],g=t[e+2];r[i]=d,r[i+1]=p,r[i+2]=c==null?g+l:l,e+=3,i+=3}return 0}let nA=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var es;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(es||(es={}));const aGe={"absolute-height":{applyElevationAlignmentBuffer:oGe,requiresAlignment:nGe},"on-the-ground":{applyElevationAlignmentBuffer:rGe,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:iGe,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:sGe,requiresAlignment:()=>!0}},lGe=ge(),jw=new nA,nO=E();function Cj(t){return t.mapPositions!=null}function g0e(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!Cj(l))continue;const{update:c,averageGeometrySampledElevation:u}=_0e(l,e,r,i,s);a+=u,c&&n.geometryVertexAttributeUpdated(l,R.POSITION)}return a/o.length}function I1(t,e,r,i,s,n){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(i(a,za),f0e(o,za.verticalDistanceToGround),l=za.sampledElevation):(i(a,za),e.mode!=="absolute-height"&&(l=za.sampledElevation));const c=Ss(cGe,n??o.transformation),u=se(y0e,c[12],c[13],c[14]);Zr.TESTS_DISABLE_OPTIMIZATIONS?(Ba[0]=a.x,Ba[1]=a.y,Ba[2]=za.z,Ol(a.spatialReference,Ba,c,s.spatialReference)&&(n?Ss(n,c):o.transformation=c)):s.setAltitudeOfTransformation(za.z,c);const d=Aj/s.unitInMeters;return(Math.abs(c[12]-u[0])>=d||Math.abs(c[13]-u[1])>=d||Math.abs(c[14]-u[2])>=d)&&(n?Ss(n,c):o.transformation=c),l}const cGe=ge();function uGe(t,e,r,i,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const o=e.centerPointInElevationSR;i(o,za);const a=e.mode!=="absolute-height"?za.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,u=dGe;l.getGlobalTransform(c,u);const d=se(y0e,u[12],u[13],u[14]);Zr.TESTS_DISABLE_OPTIMIZATIONS?(Ba[0]=o.x,Ba[1]=o.y,Ba[2]=za.z,Ol(o.spatialReference,Ba,u,s.spatialReference)&&l.setGlobalTransform(c,u)):s.setAltitudeOfTransformation(za.z,u);const p=Aj/s.unitInMeters;return(Zr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-d[0])>=p||Math.abs(u[13]-d[1])>=p||Math.abs(u[14]-d[2])>=p)&&l.setGlobalTransform(c,u),a}function hGe(t,e,r,i,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,u=!1;for(const d of o){if(!Cj(d))continue;const p=d.attributes.get(R.POSITION);if(p!==l){const{update:g,averageGeometrySampledElevation:y}=_0e(d,e,r,i,s);c=y,l=p,u=g}u&&n.geometryVertexAttributeUpdated(d,R.POSITION),a+=c}return a/o.length}const Aj=.01,Ba=E(),Vc=E(),pb=E(),dGe=ge(),y0e=E(),za=new nA;function _0e(t,e,r,i,s){let n=!1;const o=t.transformation,a=e.requiresSampledElevationInfo;Vc[0]=o[12],Vc[1]=o[13],Vc[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(R.POSITION),c=l.data,u=l.size,d=c.length/u,p=new oG(t.mapPositions,r);let g=0,y=0;for(let _=0;_<d;_++){if(pb[0]=c[g],pb[1]=c[g+1],pb[2]=c[g+2],i(p,za),a&&(y+=za.sampledElevation),Zr.TESTS_DISABLE_OPTIMIZATIONS)c[g]=p.array[p.offset],c[g+1]=p.array[p.offset+1],c[g+2]=za.z,Ni(c,r,g,c,s.spatialReference,g,1),c[g]-=Vc[0],c[g+1]-=Vc[1],c[g+2]-=Vc[2],n=!0;else{Ba[0]=c[g]+Vc[0],Ba[1]=c[g+1]+Vc[1],Ba[2]=c[g+2]+Vc[2],s.setAltitude(Ba,za.z),c[g]=Ba[0]-Vc[0],c[g+1]=Ba[1]-Vc[1],c[g+2]=Ba[2]-Vc[2];const v=Aj/s.unitInMeters;(Math.abs(pb[0]-c[g])>=v||Math.abs(pb[1]-c[g+1])>=v||Math.abs(pb[2]-c[g+2])>=v)&&(n=!0)}g+=u,p.offset+=3}return y/=d,{update:n,averageGeometrySampledElevation:y}}function pGe(t){return!!t&&i2[t]!=null}function fGe(t){return 1/(i2[t]||1)}function mGe(){const t=Object.keys(i2);return t.sort(),t}const $wt=mGe(),gGe=ne.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function yGe(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function Iwt(t){const e=t==null?void 0:t.expression;if(typeof e=="string"){const r=w0e(e);if(r!=null)return{cachedResult:r}}return null}async function Lwt(t,e,r,i){const s=t==null?void 0:t.expression;if(typeof s!="string")return null;const n=w0e(s);if(n!=null)return{cachedResult:n};const o=await tV();wt(r);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function v0e(t,e,r){return t.arcadeUtils.createFeature(e.attributes,e.geometry,r)}function SN(t,e){if(t!=null&&!b0e(t)){if(!e||!t.arcade)return void gGe.errorOncePerTick("Arcade support required but not provided");const r=e;r._geometry&&(r._geometry=l0e(r._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function _Ge(t){if(t!=null){if(b0e(t))return t.cachedResult;const e=t.arcade;let r=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof r!="number"&&(t.cachedResult=0,r=0),r}return 0}function Dwt(t,e=!1){let r=t==null?void 0:t.featureExpressionInfo;const i=r==null?void 0:r.expression;return e||i==="0"||(r=null),r??null}const vGe={cachedResult:0};function b0e(t){return t.cachedResult!=null}function w0e(t){return t==="0"?0:null}let BI=class x0e{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=fGe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:e+i}calculateOffsetRenderUnits(e){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=_Ge(i)*this._metersPerElevationInfoUnit),r/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=pGe(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,r,i){if(e==null)return void(this._featureExpressionInfoContext=null);const s=e==null?void 0:e.arcade;s&&r!=null&&i!=null?(this._featureExpressionInfoContext=yGe(e),SN(this._featureExpressionInfoContext,v0e(s.modules,r,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const r=new x0e;return e!=null&&r.setFromElevationInfo(e),r}},bGe=class{constructor(e,r,i){this.graphic=e,this.renderingInfo=r,this.layer=i}};var zt;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(zt||(zt={}));let wGe=class{constructor(e,r,i){this.baseMaterial=e,this.edgeMaterials=r,this.properties=i}},rf=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,r,i,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const r=e.stage;r.addMany(this._uniqueMaterials),r.addMany(this._uniqueGeometries),r.add(this.stageObject)}destroy(){var i;if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const r=e.renderer.edgeView;r!=null&&r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),(i=this._sharedResource)==null||i.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,r){if(this._edgeState==null)return;const i=QJ(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==i&&(n.objectTransparency=i,s=!0);s&&this.resetEdgeObject(r),this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,r){this._edgeState!=null&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!r),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stageLayer!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const r=this._stageLayer.stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(e,r,i,s){if(this.elevationAligner==null)return;i!=null&&SN(this.elevationContext.featureExpressionInfoContext,i);const n=(o,a)=>iy(o,e,this.elevationContext,r,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,r),this.resetEdgeObject(s)}alignWithAbsoluteElevation(e,r,i){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,r),this.resetEdgeObject(i)}getCenterObjectSpace(e=E()){return ie(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=tn()){const r=this.stageObject.boundingVolumeObjectSpace;return Ice(e,r.min),Lce(e,r.max),e}computeAttachmentOrigin(e){const r=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=r[12],e.render.origin[1]+=r[13],e.render.origin[2]+=r[14],e.render.num++;else for(const i of this.stageObject.geometries)i.computeAttachmentOrigin(df)&&(De(df,df,r),le(e.render.origin,e.render.origin,df),e.render.num++)}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=xGe,l=uV(o)?1:a.length;for(let u=0;u<l;u++){const d=a[u];mg[0]=o[d[0]],mg[1]=o[d[1]],mg[2]=o[d[2]],De(mg,mg,this.stageObject.transformation),zy[3*u]=mg[0],zy[3*u+1]=mg[1],zy[3*u+2]=mg[2]}if(!e(zy,0,l))return null;ui(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],zy[u+d]),o[d+3]=Math.max(o[d+3],zy[u+d]);c&&i.push({location:zy.slice(u,u+3),screenSpaceBoundingRect:c})}if(r!=null&&r.service&&this.elevationContext.mode!=="absolute-height"){Bh(o,df);const u=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let d=0;if(r.useViewElevation)d=r.service.getElevation(df[0],df[1],u)??0;else try{const p=Ej(o,r.service.spatialReference,r);d=await r.service.queryElevation(df[0],df[1],s,p,u)??0}catch{}$ce(o,0,0,-this.alignedSampledElevation+d)}return o}addObjectState(e,r){e===Tm.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),e===Tm.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(this._edgeState==null)return;const r=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,e):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,r){const i=this._edgeState;if(i==null)return;const s=QJ(i.baseMaterial);for(const n of i.edgeMaterials)n.objectTransparency=s;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}};function QJ(t){return t.isVisible()?t.parameters.transparent?zt.TRANSPARENT:zt.OPAQUE:zt.INVISIBLE}const zy=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],mg=E(),df=E(),xGe=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let T0e=class{constructor(e,r=null){this.labelText=r,this.elevationOffset=e??0}};const S0e=3,AB=3,E0e=10;let C0e=class{constructor(e,r=null){this.geometry=e,this.textures=r}},A0e=class{constructor(e,r,i){this.components=e,this.minScreenSpaceRadius=r,this.pivotOffset=i;const s=this.geometries;this.numVertices=s.reduce((n,o)=>n+o.attributes.get(R.POSITION).indices.length,0)}get geometries(){return PL(this.components.map(e=>e.geometry))}},R0e=class{constructor(e){this.levels=e,this.levels.sort((r,i)=>r.minScreenSpaceRadius===i.minScreenSpaceRadius?r.numVertices-i.numVertices:r.minScreenSpaceRadius-i.minScreenSpaceRadius)}};function oO(t){const e=[];return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry.material))),PL(e)}function KJ(t){const e=new Array;return t.levels.forEach(r=>r.components.forEach(i=>{i.textures!=null&&e.push(...i.textures)})),PL(e)}function eQ(t){const e=new Array;return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry))),PL(e)}function TGe(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function O0e(t,e){const r=(i,s,n=!1)=>new R0e(i.map(o=>{const a=s(o.tesselation);return n&&s9e(a),new A0e([new C0e(a)],o.minScreenSpaceRadius)}));switch(t){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>t9e(e,.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>qUe(e,1));case"cone":return r(J5,i=>bZ(e,1,.5,i,!1),!0);case"inverted-cone":return r(J5,i=>bZ(e,1,.5,i,!0),!0);case"cylinder":return r(J5,i=>i9e(e,1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>e9e(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>ZUe(e,1),!0);default:return}}const J5=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let uu=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new P0e}},Rj=class extends uu{constructor(e){super(e),this.estimated=!0}},SGe=class extends uu{constructor(e,r){super(r),this.numComplexities=e}},EGe=class extends Rj{constructor(e,r){super(r),this.numComplexities=e}},P0e=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function CGe(t){return t.type==="fill"}function AGe(t){return t.type==="extrude"}function RGe(t){return t&&t.enabled&&(AGe(t)||CGe(t))&&t.edges!=null}function OGe(t){return t&&t.enabled&&t.edges||null}function M0e(t,e){return PGe(OGe(t),e)}function PGe(t,e){if(t==null)return null;const r=t.color!=null?OV(qe.toUnitRGBA(t.color)):Ot(0,0,0,0),i=Fo(t.size),s=Fo(t.extensionLength);switch(t.type){case"solid":return MGe({color:r,size:i,extensionLength:s,...e});case"sketch":return $Ge({color:r,size:i,extensionLength:s,...e});default:return}}function MGe(t){return{...IGe,...t,type:"solid"}}function $Ge(t){return{...LGe,...t,type:"sketch"}}const IGe={color:Ot(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:zt.OPAQUE,hasSlicePlane:!1},LGe={color:Ot(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:zt.OPAQUE,hasSlicePlane:!1};function oA(t,e){switch(e.normalType){case Tr.Compressed:t.attributes.add(R.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(b`vec3 normalModel() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
return vec3(normalCompressed + sign(normalCompressed) * min(z, 0.0), z);
}`);break;case Tr.Attribute:t.attributes.add(R.NORMAL,"vec3"),t.vertex.code.add(b`vec3 normalModel() {
return normal;
}`);break;case Tr.ScreenDerivative:t.fragment.code.add(b`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case Tr.COUNT:case Tr.Ground:}}var Tr;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(Tr||(Tr={}));function $0e(t,e){const r=t.fragment;switch(r.code.add(b`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case ji.None:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case ji.View:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case ji.WindingOrder:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case ji.COUNT:}}var ji;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(ji||(ji={}));let z2=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.attributes.get(R.POSITION).indices.length}write(e,r,i,s,n){W7e(i,this.vertexBufferLayout,e,r,s,n)}};function EN(t,e){switch(e.normalType){case Tr.Attribute:case Tr.Compressed:t.include(oA,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new qC("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new fd("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),t.vertex.code.add(b`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case Tr.Ground:t.include(lx,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(b`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?b`normalize(vPositionWorldCameraRelative);`:b`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case Tr.ScreenDerivative:t.vertex.code.add(b`void forwardNormal() {}`);break;default:e.normalType;case Tr.COUNT:}}let I0e=class extends jfe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Fi()}},L0e=class extends Hfe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Fi(),this.toMapSpace=Jt()}};const Oj={func:Ar.LESS},zI={func:Ar.ALWAYS},Gp={mask:255},D0e={mask:0},DGe=t=>({function:{func:Ar.NOTEQUAL,ref:t,mask:t},operation:{fail:Di.KEEP,zFail:Di.KEEP,zPass:Di.KEEP}}),NGe=t=>({function:{func:Ar.ALWAYS,ref:t,mask:t},operation:{fail:Di.KEEP,zFail:Di.KEEP,zPass:Di.REPLACE}}),by={function:{func:Ar.ALWAYS,ref:Wa.OutlineVisualElementMask,mask:Wa.OutlineVisualElementMask},operation:{fail:Di.KEEP,zFail:Di.KEEP,zPass:Di.ZERO}},ny={function:{func:Ar.ALWAYS,ref:Wa.OutlineVisualElementMask,mask:Wa.OutlineVisualElementMask},operation:{fail:Di.KEEP,zFail:Di.KEEP,zPass:Di.REPLACE}},N0e={function:{func:Ar.EQUAL,ref:Wa.OutlineVisualElementMask,mask:Wa.OutlineVisualElementMask},operation:{fail:Di.KEEP,zFail:Di.KEEP,zPass:Di.KEEP}},F0e={function:{func:Ar.NOTEQUAL,ref:Wa.OutlineVisualElementMask,mask:Wa.OutlineVisualElementMask},operation:{fail:Di.KEEP,zFail:Di.KEEP,zPass:Di.KEEP}};function U0e({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:r,roughnessFactor:i,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||ho(n,Mn))&&o==null&&(i==null||i===1)&&(r==null||r===1||r===0)}const CN=[1,1,.5],Pj=[0,.6,.2],FGe=[0,1,.2];function k0e(t){t.vertex.code.add(b`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}var Zs;function UGe(t){switch(t){case"multiply":default:return Zs.Multiply;case"ignore":return Zs.Ignore;case"replace":return Zs.Replace;case"tint":return Zs.Tint}}function B0e(t,e,r){if(t==null||e===Zs.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=me(Math.round(t[3]*VI),0,VI),s=i===0||e===Zs.Tint?0:e===Zs.Replace?kGe:BGe;r[0]=me(Math.round(t[0]*fb),0,fb),r[1]=me(Math.round(t[1]*fb),0,fb),r[2]=me(Math.round(t[2]*fb),0,fb),r[3]=i+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Zs||(Zs={}));const fb=255,VI=85,kGe=VI,BGe=2*VI;function z0e(t){t.vertex.code.add(b`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${b.int(Zs.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${b.int(Zs.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${b.int(Zs.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${b.int(Zs.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}let aA=class extends qi{constructor(e,r){super(e,"int",gr.Pass,(i,s,n)=>i.setUniform1i(e,r(s,n)))}};function V0e(t,e){e.hasSymbolColors?(t.include(z0e),t.attributes.add(R.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(b`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new aA("colorMixMode",r=>kge[r.colorMixMode])),t.vertex.code.add(b`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function Dv(t,e){e.hasVertexColors?(t.attributes.add(R.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(b`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(b`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(b`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function G0e(t){t.code.add(b`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}function Em(t,e){switch(e.output){case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:t.fragment.include(G0e),t.fragment.code.add(b`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`);break;case L.Depth:t.fragment.include(zu),t.fragment.code.add(b`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}function zGe(t){t.fragment.code.add(b`
    #define discardOrAdjustAlpha(color) { if (color.a < ${b.float(qn)}) { discard; } }
  `)}let L1=class extends qi{constructor(e,r){super(e,"float",gr.Draw,(i,s,n)=>i.setUniform1f(e,r(s,n)))}};function D1(t,e){j0e(t,e,new Ee("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function VGe(t,e){j0e(t,e,new L1("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function j0e(t,e,r){const i=t.fragment;switch(e.alphaDiscardMode!==Ur.Mask&&e.alphaDiscardMode!==Ur.MaskBlend||i.uniforms.add(r),e.alphaDiscardMode){case Ur.Blend:return t.include(zGe);case Ur.Opaque:i.code.add(b`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Ur.Mask:i.code.add(b`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Ur.MaskBlend:t.fragment.code.add(b`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function H0e(t,e){const{vertex:r,fragment:i}=t,s=e.hasColorTexture&&e.alphaDiscardMode!==Ur.Opaque;switch(e.output){case L.Depth:case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:case L.ObjectAndLayerIdColor:Rl(r,e),t.include(qa,e),t.include(Rp,e),t.include(am,e),t.include(Em,e),t.include(us,e),t.include(rA,e),lv(t),t.varyings.add("depth","float"),s&&i.uniforms.add(new Ze("tex",n=>n.texture)),r.code.add(b`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`),t.include(D1,e),i.code.add(b`
          void main(void) {
            discardBySlice(vpos);
            ${s?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===L.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:b`outputDepth(depth);`}
          }
        `);break;case L.Normal:{Rl(r,e),t.include(qa,e),t.include(oA,e),t.include(EN,e),t.include(Rp,e),t.include(am,e),s&&i.uniforms.add(new Ze("tex",o=>o.texture)),e.normalType===Tr.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const n=e.normalType===Tr.Attribute||e.normalType===Tr.Compressed;r.code.add(b`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${n?b`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:b`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(us,e),t.include(D1,e),i.code.add(b`
          void main() {
            discardBySlice(vpos);
            ${s?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===Tr.ScreenDerivative?b`vec3 normal = screenDerivativeNormal(vPositionView);`:b`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case L.Highlight:Rl(r,e),t.include(qa,e),t.include(Rp,e),t.include(am,e),s&&i.uniforms.add(new Ze("tex",n=>n.texture)),r.code.add(b`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(us,e),t.include(D1,e),t.include(_y,e),i.code.add(b`
          void main() {
            discardBySlice(vpos);
            ${s?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function q0e(t,e){const r=t.fragment;e.hasVertexTangents?(t.attributes.add(R.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===ji.WindingOrder?r.code.add(b`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(b`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):r.code.add(b`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==xs.None&&(t.include(SG,e),r.uniforms.add(e.pbrTextureBindType===gr.Pass?new Ze("normalTexture",i=>i.textureNormal):new xu("normalTexture",i=>i.textureNormal)),r.code.add(b`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))}let W0e=class extends qi{constructor(e,r){super(e,"vec2",gr.Draw,(i,s,n,o)=>i.setUniform2fv(e,r(s,n,o)))}};const Q5=4;function GGe(){const t=new dr,e=t.fragment;t.include(Wo);const r=(Q5+1)/2,i=1/(2*r*r);return e.include(Nu),e.uniforms.add(new Ze("depthMap",s=>s.depthTexture),new xu("tex",s=>s.colorTexture),new W0e("blurSize",s=>s.blurSize),new Ee("projScale",(s,n)=>{const o=hi(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale}),new Ir("nearFar",(s,n)=>n.camera.nearFar)),e.code.add(b`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${b.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.outputs.add("fragBlur","float"),e.code.add(b`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${b.int(Q5)}; r <= ${b.int(Q5)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `),t}const jGe=Object.freeze(Object.defineProperty({__proto__:null,build:GGe},Symbol.toStringTag,{value:"Module"}));let Y0e=class X0e extends Sr{initializeProgram(e){return new vr(e.rctx,X0e.shader.get().build(),hr)}initializePipeline(){return Et({colorWrite:Ut})}};Y0e.shader=new _r(jGe,()=>he(()=>import("./SSAOBlur.glsl-2c189f88.js"),[],import.meta.url));const HGe="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";let qGe=class extends Vr{constructor(){super(...arguments),this.projScale=1}},WGe=class extends qGe{constructor(){super(...arguments),this.intensity=1}},YGe=class extends Vr{},XGe=class extends YGe{constructor(){super(...arguments),this.blurSize=ke()}};function AN(t){t.fragment.uniforms.add(new nr("projInfo",(e,r)=>ZGe(r))),t.fragment.uniforms.add(new Ir("zScale",(e,r)=>JGe(r))),t.fragment.code.add(b`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function ZGe(t){const e=t.camera.projectionMatrix;return e[11]===0?Si(tQ,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):Si(tQ,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const tQ=Jt();function JGe(t){return t.camera.projectionMatrix[11]===0?ir(rQ,0,1):ir(rQ,1,0)}const rQ=ke(),iQ=16;function QGe(){const t=new dr,e=t.fragment;return t.include(Wo),e.include(Nu),t.include(AN),e.uniforms.add(new Ee("radius",(r,i)=>Mj(i.camera))),e.code.add(b`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(b`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new Ir("nearFar",(r,i)=>i.camera.nearFar),new Ze("normalMap",r=>r.normalTexture),new Ze("depthMap",r=>r.depthTexture),new Ee("projScale",r=>r.projScale),new Ze("rnm",r=>r.noiseTexture),new Ir("rnmScale",(r,i)=>ir(sQ,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new Ee("intensity",r=>r.intensity),new Ir("screenSize",(r,i)=>ir(sQ,i.camera.fullWidth,i.camera.fullHeight))),t.outputs.add("fragOcclusion","float"),e.code.add(b`
    void main(void) {
      fillSphere();
      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
        fragOcclusion = 0.0;
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w < 0.5;

      float sum = 0.0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${b.int(iQ)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          if (texture(normalMap, tcTap).w < 0.5) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${b.int(iQ)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `),t}function Mj(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const sQ=ke(),KGe=Object.freeze(Object.defineProperty({__proto__:null,build:QGe,getRadius:Mj},Symbol.toStringTag,{value:"Module"}));let Z0e=class J0e extends Sr{initializeProgram(e){return new vr(e.rctx,J0e.shader.get().build(),hr)}initializePipeline(){return Et({colorWrite:Ut})}};Z0e.shader=new _r(KGe,()=>he(()=>import("./SSAO.glsl-f3148970.js"),[],import.meta.url));const WS=2;let YS=class extends Iv{constructor(e){super(e),this._context=null,this._passParameters=new WGe,this._drawParameters=new XGe,this.produces=new Map([[oe.SSAO,()=>this._produces()]])}_produces(){return this._enableTime!=null&&this._context!=null}consumes(){return this._produces()?O9e:lN}initializeRenderContext(e){this._context=e,this.addHandles([ae(()=>{var r;return this.view.qualitySettings.ambientOcclusion||((r=this._context)==null?void 0:r.isFeatureEnabled($s.SSAO))},r=>r?this._enable():this._disable(),Br)])}uninitializeRenderContext(){this._disable(),this._context=null}_disable(){this._passParameters.noiseTexture=Ke(this._passParameters.noiseTexture),this._enableTime=null}destroy(){this._disable()}_enable(){var i;if(this._enableTime!=null||!this._context)return;const e=Uint8Array.from(atob(HGe),s=>s.charCodeAt(0)),r=new Or;r.wrapMode=Ft.CLAMP_TO_EDGE,r.pixelFormat=ut.RGB,r.wrapMode=Ft.REPEAT,r.hasMipmap=!0,r.width=32,r.height=32,this._passParameters.noiseTexture=new Rt(this._context.renderContext.rctx,r,e),this._ssaoTechnique==null&&(this._ssaoTechnique=this._context.techniqueRepository.acquire(Z0e)),this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(Y0e)),this._enableTime=0,(i=this._context)==null||i.requestRender()}renderNode(e,r,i){var S,C;const s=e.bindParameters,n=(S=s.linearDepth)==null?void 0:S.colorTexture,o=(C=i==null?void 0:i.normal)==null?void 0:C.colorTexture;if(this._enableTime==null||this._context==null||n==null||!o)return;if(!this._ssaoTechnique.compiled||!this._blurTechnique.compiled)return this._enableTime=e.time,void this._context.requestRender();this._enableTime===0&&(this._enableTime=e.time);const a=e.rctx,l=s.camera,c=this.view.qualitySettings.fadeDuration,u=c>0?Math.min(c,e.time-this._enableTime)/c:1;this._passParameters.normalTexture=o,this._passParameters.depthTexture=n,this._passParameters.projScale=1/l.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*eje/Mj(l)**6*u;const d=l.fullViewport[2],p=l.fullViewport[3],g=Math.round(d/WS),y=Math.round(p/WS),_=this._context.fbos,v=_.acquire(cr.RED,d,p);a.bindFramebuffer(v.fbo),a.setViewport(0,0,d,p),a.bindTechnique(this._ssaoTechnique,this._passParameters,s).bindDraw(this._drawParameters,s,this._passParameters),a.screen.draw();const w=a.bindTechnique(this._blurTechnique,this._passParameters,s);a.setViewport(0,0,g,y);const x=_.acquire(cr.RED,g,y);a.bindFramebuffer(x.fbo),this._drawParameters.colorTexture=v.colorTexture,ir(this._drawParameters.blurSize,0,WS/p),w.bindDraw(this._drawParameters,s,this._passParameters),a.setViewport(0,0,g,y),a.screen.draw(),v.release();const T=_.acquire(cr.RED,g,y);return a.bindFramebuffer(T.fbo),a.setViewport(0,0,d,p),a.setClearColor(1,1,1,0),a.clear(ii.COLOR_BUFFER_BIT),a.setViewport(0,0,g,y),this._drawParameters.colorTexture=x.colorTexture,ir(this._drawParameters.blurSize,WS/d,0),w.bindDraw(this._drawParameters,s,this._passParameters),a.screen.draw(),a.setViewport4fv(l.fullViewport),x.release(),u<1&&this._context.requestRender(),T}};h([f({constructOnly:!0})],YS.prototype,"view",void 0),h([f()],YS.prototype,"_context",void 0),YS=h([k("esri.views.3d.webgl-engine.effects.ssao.SSAO")],YS);const eje=.5;function lA(t,e){const r=t.fragment;e.receiveAmbientOcclusion?(r.uniforms.add(new Ze("ssaoTex",(i,s)=>{var n;return(n=s.ssao)==null?void 0:n.colorTexture})),r.constants.add("blurSizePixelsInverse","float",1/WS),r.code.add(b`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):r.code.add(b`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function tje(t){const e=t.fragment.code;e.add(b`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(b`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(b`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function $j(t,e){const r=t.fragment.code;t.include(W3),e.pbrMode!==et.Normal&&e.pbrMode!==et.Schematic&&e.pbrMode!==et.Terrain&&e.pbrMode!==et.TerrainWithWater||(r.add(b`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(b`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==et.Normal&&e.pbrMode!==et.Schematic||(t.include(tje),r.add(b`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(b`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(b`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(b`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function rje(t,e){const r=t.fragment.code;t.include(W3),r.add(b`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(b`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(b`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(b`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(b`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function cA(t){t.constants.add("ambientBoostFactor","float",Ffe)}function V2(t){t.uniforms.add(new Ee("lightingGlobalFactor",(e,r)=>r.lighting.globalFactor))}function hv(t,e){const r=t.fragment;switch(t.include(lA,e),e.pbrMode!==et.Disabled&&t.include($j,e),t.include(AG,e),t.include(W3),r.code.add(b`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===et.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),cA(r),V2(r),Lm(r),r.code.add(b`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?b`normalize(vPosWorld)`:b`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Jp(r),r.code.add(b`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case et.Disabled:case et.WaterOnIntegratedMesh:case et.Water:t.include(pI),r.code.add(b`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case et.Normal:case et.Schematic:r.code.add(b`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(b`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?r.uniforms.add(new Op("hasFillLights",(i,s)=>s.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(b`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add(new Ee("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Ee("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(b`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(b`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode!==et.Schematic||e.hasColorTexture?b`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:b`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case et.Terrain:case et.TerrainWithWater:t.include(pI),r.code.add(b`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case et.COUNT:}}let ije=class extends qi{constructor(e,r,i){super(e,"mat4",gr.Draw,(s,n,o,a)=>s.setUniformMatrix4fv(e,r(n,o,a)),i)}},sje=class extends qi{constructor(e,r,i){super(e,"mat4",gr.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,r(n,o)),i)}},nje=class extends Vr{constructor(){super(...arguments),this.origin=E()}},oje=class extends nje{},aje=class extends Vr{constructor(){super(...arguments),this.modelTransformation=$i}},Ij=class extends aje{constructor(){super(...arguments),this.origin=E()}};function RN(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new sje("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),Q0e(t))}function dv(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new ije("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),Q0e(t))}function Q0e(t){const e=t.fragment;e.include(G0e),e.uniforms.add(new Ze("shadowMapTex",(r,i)=>i.shadowMap.depthTexture),new aA("numCascades",(r,i)=>i.shadowMap.numCascades),new nr("cascadeDistances",(r,i)=>i.shadowMap.cascadeDistances)),e.code.add(b`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMapTex, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMapTex);
}`)}function zo(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function K0e(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function MM(t,e,r,i,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function lje(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:K0e,create:zo,createView:lje,fromValues:MM},Symbol.toStringTag,{value:"Module"}));function cje(t){t.vertex.uniforms.add(new fd("colorTextureTransformMatrix",e=>e.colorTextureTransformMatrix!=null?e.colorTextureTransformMatrix:zo())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(b`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function uje(t){t.vertex.uniforms.add(new fd("normalTextureTransformMatrix",e=>e.normalTextureTransformMatrix!=null?e.normalTextureTransformMatrix:zo())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(b`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function hje(t){t.vertex.uniforms.add(new fd("emissiveTextureTransformMatrix",e=>e.emissiveTextureTransformMatrix!=null?e.emissiveTextureTransformMatrix:zo())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(b`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function dje(t){t.vertex.uniforms.add(new fd("occlusionTextureTransformMatrix",e=>e.occlusionTextureTransformMatrix!=null?e.occlusionTextureTransformMatrix:zo())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(b`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function pje(t){t.vertex.uniforms.add(new fd("metallicRoughnessTextureTransformMatrix",e=>e.metallicRoughnessTextureTransformMatrix!=null?e.metallicRoughnessTextureTransformMatrix:zo())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(b`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function t3(t){t.include(tf),t.code.add(b`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${b.int(Zs.Multiply)}) {
        return allMixed;
      }
      if (mode == ${b.int(Zs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${b.int(Zs.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${b.int(Zs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${b.int(Zs.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function fje(t){const e=new dr,{vertex:r,fragment:i,varyings:s}=e;if(Rl(r,t),e.include(Y3),s.add("vpos","vec3"),e.include(am,t),e.include(Gfe,t),e.include(Oge,t),t.hasColorTextureTransform&&e.include(cje),t.output===L.Color||t.output===L.Alpha){t.hasNormalTextureTransform&&e.include(uje),t.hasEmissionTextureTransform&&e.include(hje),t.hasOcclusionTextureTransform&&e.include(dje),t.hasMetallicRoughnessTextureTransform&&e.include(pje),sd(r,t),e.include(oA,t),e.include(qa,t);const n=t.normalType===Tr.Attribute||t.normalType===Tr.Compressed;n&&t.offsetBackfaces&&e.include(k0e),e.include(q0e,t),e.include(EN,t),t.instancedColor&&e.attributes.add(R.INSTANCECOLOR,"vec4"),s.add("vPositionLocal","vec3"),e.include(Rp,t),e.include(F2,t),e.include(V0e,t),e.include(Dv,t),r.uniforms.add(new nr("externalColor",o=>o.externalColor)),s.add("vcolorExt","vec4"),t.multipassEnabled&&s.add("depth","float"),r.code.add(b`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${b.float(qn)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${n?b`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${n&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?b`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?b`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?b`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?b`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?b`forwardMetallicRoughnessUV();`:""}
      }
    `)}switch(t.output){case L.Alpha:e.include(us,t),e.include(D1,t),e.include(Nl,t),i.uniforms.add(new Ee("opacity",n=>n.opacity),new Ee("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Ze("tex",n=>n.texture)),i.include(t3),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?b`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case L.Color:e.include(us,t),e.include(hv,t),e.include(lA,t),e.include(D1,t),e.include(t.instancedDoublePrecision?RN:dv,t),e.include(Nl,t),sd(i,t),i.uniforms.add(r.uniforms.get("localOrigin"),new Pt("ambient",n=>n.ambient),new Pt("diffuse",n=>n.diffuse),new Ee("opacity",n=>n.opacity),new Ee("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Ze("tex",n=>n.texture)),e.include(CG,t),e.include($j,t),i.include(t3),e.include($0e,t),cA(i),V2(i),Jp(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===Tr.ScreenDerivative?b`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:b`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===et.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?b`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?b`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?b`normalUV`:"vuv0"});`:b`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?b`normalize(posWorld);`:b`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?b`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===et.Normal||t.pbrMode===et.Schematic?b`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?b`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:b`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===Qe.Color?b`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}return e.include(H0e,t),e}const mje=Object.freeze(Object.defineProperty({__proto__:null,build:fje},Symbol.toStringTag,{value:"Module"}));let gje=class extends I0e{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Oo(CN),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=oi.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Te(0,0,0),this.instancedDoublePrecision=!1,this.normalType=Tr.Attribute,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Te(.2,.2,.2),this.diffuse=Te(.8,.8,.8),this.externalColor=Ot(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=E(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=ov.Less,this.textureAlphaMode=Ur.Blend,this.textureAlphaCutoff=FI,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Ti.Occlude,this.isDecoration=!1}},yje=class extends L0e{constructor(){super(...arguments),this.origin=E(),this.slicePlaneLocalOrigin=this.origin}},Lj=class eye extends Sr{initializeConfiguration(e,r){r.spherical=e.viewingMode===$e.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?xs.Default:xs.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(e){return this._initializeProgram(e,eye.shader)}_initializeProgram(e,r){return new vr(e.rctx,r.get().build(this.configuration),hr)}_convertDepthTestFunction(e){return e===ov.Lequal?Ar.LEQUAL:Ar.LESS}_makePipeline(e,r){const i=this.configuration,s=e===Qe.NONE,n=e===Qe.FrontFace;return Et({blending:i.output!==L.Color&&i.output!==L.Alpha||!i.transparent?null:s?Ac:Bm(e),culling:_je(i)?ZD(i.cullFace):null,depthTest:{func:vy(e,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:(s||n)&&i.writeDepth?Xa:null,colorWrite:Ut,stencilWrite:i.hasOccludees?Gp:null,stencilTest:i.hasOccludees?r?ny:by:null,polygonOffset:s||n?null:xN(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function _je(t){return t.cullFace!==oi.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}Lj.shader=new _r(mje,()=>he(()=>import("./DefaultMaterial.glsl-5c34968d.js"),[],import.meta.url));let Nt=class extends ga{constructor(){super(...arguments),this.output=L.Color,this.alphaDiscardMode=Ur.Opaque,this.doubleSidedMode=ji.None,this.pbrMode=et.Disabled,this.cullFace=oi.None,this.transparencyPassType=Qe.NONE,this.normalType=Tr.Attribute,this.textureCoordinateType=xs.None,this.customDepthTest=ov.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};h([F({count:L.COUNT})],Nt.prototype,"output",void 0),h([F({count:Ur.COUNT})],Nt.prototype,"alphaDiscardMode",void 0),h([F({count:ji.COUNT})],Nt.prototype,"doubleSidedMode",void 0),h([F({count:et.COUNT})],Nt.prototype,"pbrMode",void 0),h([F({count:oi.COUNT})],Nt.prototype,"cullFace",void 0),h([F({count:Qe.COUNT})],Nt.prototype,"transparencyPassType",void 0),h([F({count:Tr.COUNT})],Nt.prototype,"normalType",void 0),h([F({count:xs.COUNT})],Nt.prototype,"textureCoordinateType",void 0),h([F({count:ov.COUNT})],Nt.prototype,"customDepthTest",void 0),h([F()],Nt.prototype,"spherical",void 0),h([F()],Nt.prototype,"hasVertexColors",void 0),h([F()],Nt.prototype,"hasSymbolColors",void 0),h([F()],Nt.prototype,"hasVerticalOffset",void 0),h([F()],Nt.prototype,"hasSlicePlane",void 0),h([F()],Nt.prototype,"hasSliceHighlight",void 0),h([F()],Nt.prototype,"hasColorTexture",void 0),h([F()],Nt.prototype,"hasMetallicRoughnessTexture",void 0),h([F()],Nt.prototype,"hasEmissionTexture",void 0),h([F()],Nt.prototype,"hasOcclusionTexture",void 0),h([F()],Nt.prototype,"hasNormalTexture",void 0),h([F()],Nt.prototype,"hasScreenSizePerspective",void 0),h([F()],Nt.prototype,"hasVertexTangents",void 0),h([F()],Nt.prototype,"hasOccludees",void 0),h([F()],Nt.prototype,"multipassEnabled",void 0),h([F()],Nt.prototype,"hasModelTransformation",void 0),h([F()],Nt.prototype,"offsetBackfaces",void 0),h([F()],Nt.prototype,"vvSize",void 0),h([F()],Nt.prototype,"vvColor",void 0),h([F()],Nt.prototype,"receiveShadows",void 0),h([F()],Nt.prototype,"receiveAmbientOcclusion",void 0),h([F()],Nt.prototype,"textureAlphaPremultiplied",void 0),h([F()],Nt.prototype,"instanced",void 0),h([F()],Nt.prototype,"instancedColor",void 0),h([F()],Nt.prototype,"objectAndLayerIdColorInstanced",void 0),h([F()],Nt.prototype,"instancedDoublePrecision",void 0),h([F()],Nt.prototype,"doublePrecisionRequiresObfuscation",void 0),h([F()],Nt.prototype,"writeDepth",void 0),h([F()],Nt.prototype,"transparent",void 0),h([F()],Nt.prototype,"enableOffset",void 0),h([F()],Nt.prototype,"cullAboveGround",void 0),h([F()],Nt.prototype,"snowCover",void 0),h([F()],Nt.prototype,"hasColorTextureTransform",void 0),h([F()],Nt.prototype,"hasEmissionTextureTransform",void 0),h([F()],Nt.prototype,"hasNormalTextureTransform",void 0),h([F()],Nt.prototype,"hasOcclusionTextureTransform",void 0),h([F()],Nt.prototype,"hasMetallicRoughnessTextureTransform",void 0),h([F({constValue:!1})],Nt.prototype,"occlusionPass",void 0),h([F({constValue:!0})],Nt.prototype,"hasVvInstancing",void 0),h([F({constValue:!1})],Nt.prototype,"useCustomDTRExponentForWater",void 0),h([F({constValue:!1})],Nt.prototype,"supportsTextureAtlas",void 0),h([F({constValue:!0})],Nt.prototype,"useFillLights",void 0);function vje(t){const e=new dr,{vertex:r,fragment:i,varyings:s}=e;return Rl(r,t),e.include(Y3),s.add("vpos","vec3"),e.include(am,t),e.include(Gfe,t),e.include(Oge,t),t.output!==L.Color&&t.output!==L.Alpha||(sd(e.vertex,t),e.include(oA,t),e.include(qa,t),t.offsetBackfaces&&e.include(k0e),t.instancedColor&&e.attributes.add(R.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),t.multipassEnabled&&s.add("depth","float"),e.include(Rp,t),e.include(F2,t),e.include(V0e,t),e.include(Dv,t),r.uniforms.add(new nr("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),r.code.add(b`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${b.float(qn)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.multipassEnabled?b`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===L.Alpha&&(e.include(us,t),e.include(D1,t),e.include(Nl,t),i.uniforms.add(new Ee("opacity",n=>n.opacity),new Ee("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Ze("tex",n=>n.texture)),i.include(t3),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?b`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?b`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `)),t.output===L.Color&&(e.include(us,t),e.include(hv,t),e.include(lA,t),e.include(D1,t),e.include(t.instancedDoublePrecision?RN:dv,t),e.include(Nl,t),sd(e.fragment,t),Lm(i),cA(i),V2(i),i.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new Pt("ambient",n=>n.ambient),new Pt("diffuse",n=>n.diffuse),new Ee("opacity",n=>n.opacity),new Ee("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Ze("tex",n=>n.texture)),e.include(CG,t),e.include($j,t),i.include(t3),Jp(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?b`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===et.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?b`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?b`albedo = mix(albedo, vec3(1), 0.9);`:b``}
        ${b`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===et.Normal||t.pbrMode===et.Schematic?t.spherical?b`vec3 normalGround = normalize(vpos + localOrigin);`:b`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:b``}
        ${t.pbrMode===et.Normal||t.pbrMode===et.Schematic?b`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?b`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:b`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===Qe.Color?b`fragColor = premultiplyAlpha(fragColor);`:b``}
      }
    `)),e.include(H0e,t),e}const bje=Object.freeze(Object.defineProperty({__proto__:null,build:vje},Symbol.toStringTag,{value:"Module"}));let tye=class rye extends Lj{initializeConfiguration(e,r){super.initializeConfiguration(e,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=Tr.Attribute,r.doubleSidedMode=ji.WindingOrder,r.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,rye.shader)}};tye.shader=new _r(bje,()=>he(()=>import("./RealisticTree.glsl-6b16cd8d.js"),[],import.meta.url));let od=class extends yy{constructor(e){super(e,Tje),this.supportsEdges=!0,this._configuration=new Nt,this._vertexBufferLayout=Sje(this.parameters)}isVisibleForOutput(e){return e!==L.Shadow&&e!==L.ShadowExcludeHighlight&&e!==L.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:r,hasVertexColors:i,hasSymbolColors:s,vvColor:n}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=r||n||s;return i&&c?o||a:i?o?l:a:c?o||a:o?l:a}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?oi.None:this.parameters.cullFace,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e!==L.Color&&e!==L.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=ji.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?ji.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?ji.WindingOrder:ji.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=r.ssao!=null,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?et.Schematic:et.Normal:et.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<bN,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,r,i,s,n,o){if(this.parameters.verticalOffset!=null){const a=i.camera;se(eF,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case $e.Global:l=pe(nQ,eF);break;case $e.Local:l=ie(nQ,Aje)}let c=0;const u=ce(Rje,eF,a.eye),d=_e(u),p=ee(u,u,1/d);let g=null;this.parameters.screenSizePerspective&&(g=de(l,p)),c+=Fge(a,d,this.parameters.verticalOffset,g??0,this.parameters.screenSizePerspective),ee(l,l,c),Sl(K5,l,i.transform.inverseRotation),s=ce(Eje,s,K5),n=ce(Cje,n,K5)}Ige(e,i,s,n,P9(i.verticalOffset),o)}produces(e,r){return r===L.Color||r===L.Alpha||r===L.Depth||r===L.Normal||r===L.Shadow||r===L.ShadowHighlight||r===L.ShadowExcludeHighlight||r===L.Highlight||r===L.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?oe.TRANSPARENT_MATERIAL:oe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:oe.OPAQUE_MATERIAL)||e===oe.DRAPED_MATERIAL:!1}createGLMaterial(e){return new wje(e)}createBufferWriter(){return new z2(this._vertexBufferLayout)}},wje=class extends EG{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==L.Color&&this._output!==L.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const r=this._material.parameters;this.updateTexture(r.textureId);const i=e.camera.viewInverseTransposeMatrix;return se(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?tye:Lj,e)}},xje=class extends gje{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const Tje=new xje;function Sje(t){const e=Ci().vec3f(R.POSITION);return t.normalType===Tr.Compressed?e.vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(R.NORMAL),t.hasVertexTangents&&e.vec4f(R.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(R.UV0),t.hasVertexColors&&e.vec4u8(R.COLOR),t.hasSymbolColors&&e.vec4u8(R.SYMBOLCOLOR),te("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),e}const Eje=E(),Cje=E(),Aje=Te(0,0,1),nQ=E(),K5=E(),eF=E(),Rje=E(),iye=new Rj({});function yxt(t){return t.type==="web-style"?iye:Dj(t.symbolLayers.toArray().map(e=>sye(t,e)))}function Dj(t){let e=0,r=0,i=0,s=!1,n=0;const o=new P0e;for(const a of t)a!=null&&(e+=a.verticesPerFeature,r+=a.verticesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,s=s||a.estimated,++n);return s?new EGe(n,{verticesPerFeature:e,verticesPerCoordinate:r,drawCallsPerFeature:i,memory:o}):new SGe(n,{verticesPerFeature:e,verticesPerCoordinate:r,drawCallsPerFeature:i,memory:o})}function _xt(t){const e=Dj(t);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const tF={};function sye(t,e){var s,n;const r=nye(t,e),i=RGe(e)?2:0;switch(e.type){case"extrude":return new uu({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:i,memory:r});case"fill":if(t.type==="mesh-3d")return new uu({drawCallsPerFeature:i,memory:r});if(e.outline!=null&&e.outline.size>0)return new uu({verticesPerFeature:-12,verticesPerCoordinate:9,memory:r});case"water":return new uu({verticesPerFeature:-6,verticesPerCoordinate:3,memory:r});case"line":return new uu({verticesPerFeature:-6,verticesPerCoordinate:6,memory:r});case"object":return(s=e.resource)!=null&&s.href?new Rj({verticesPerFeature:100,memory:r}):{...Oje(((n=e.resource)==null?void 0:n.primitive)??Gce),memory:r};case"path":{let o=0,a=0;switch(e.profile){case"circle":o=E0e;break;case"quad":o=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":a=S0e;break;case"miter":case"bevel":a=1;break;default:return}const l=2*o,c=o*a*2,u=c+l;let d=-2*c-l;switch(e.cap){case"none":break;case"butt":case"square":d+=2*(o-1);break;case"round":d+=2*(o*(AB-1)*2+o);break;default:return}return new uu({verticesPerFeature:d,verticesPerCoordinate:u,memory:r})}case"text":case"icon":return new uu({verticesPerFeature:6,memory:r});default:return}}function nye(t,e){const r=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?xa.EXTRUDE_EDGES:xa.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?xa.FILL_OUTLINE:xa.FILL;case"water":return xa.FILL;case"line":return e.join==="round"?xa.LINE_ROUND:xa.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return xa.PATH_ROUND_CIRCLE;case"quad":return xa.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return xa.PATH_MITER_CIRCLE;case"quad":return xa.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return r?xa.OBJECT_POINT:xa.OBJECT_POLYGON;case"icon":case"text":return r?xa.ICON_POINT:xa.ICON_POLYGON;default:return}}function Oje(t){const e=tF[t];if(e)return e;const r=oye(O0e(t,new od({})).levels);return tF[t]=new uu({verticesPerFeature:r}),tF[t]}function oye(t){return t.reduce((e,r,i)=>e+r.numVertices*(1/10**i),0)/t.reduce((e,r,i)=>e+1/10**i,0)}const xa={ICON_POINT:{bytesPerFeature:2111.586639736967,bytesPerFeatureLabel:870.520855,resourceBytes:0,draped:{bytesPerFeature:1799.2619971817762,bytesPerFeatureLabel:857.4890149999999}},ICON_POLYGON:{bytesPerFeature:2829.8183316810564,bytesPerFeatureLabel:858.0951816666667,resourceBytes:0,draped:{bytesPerFeature:2521.242008227286,bytesPerFeatureLabel:869.6919750000001}},OBJECT_POINT:{bytesPerFeature:607.8007336777831,bytesPerFeatureLabel:715.7017950000001,resourceBytes:0,draped:{bytesPerFeature:607.8007336777831,bytesPerFeatureLabel:715.7017950000001}},OBJECT_POLYGON:{bytesPerFeature:1111.4123028075749,bytesPerFeatureLabel:684.5498416666667,resourceBytes:0,draped:{bytesPerFeature:1111.4123028075749,bytesPerFeatureLabel:684.5498416666667}},LINE_MITER:{bytesPerFeature:3053.034748007272,bytesPerFeatureLabel:804.5473016666666,resourceBytes:0,draped:{bytesPerFeature:2649.5661560225844,bytesPerFeatureLabel:843.3404083333334}},LINE_ROUND:{bytesPerFeature:3225.35183564197,bytesPerFeatureLabel:807.296835,resourceBytes:0,draped:{bytesPerFeature:2650.9229994933276,bytesPerFeatureLabel:861.108335}},PATH_MITER_CIRCLE:{bytesPerFeature:38664.832646351235,bytesPerFeatureLabel:862.95665,resourceBytes:0,draped:{bytesPerFeature:38664.832646351235,bytesPerFeatureLabel:862.95665}},PATH_ROUND_CIRCLE:{bytesPerFeature:42462.97022293504,bytesPerFeatureLabel:851.35885,resourceBytes:0,draped:{bytesPerFeature:42462.97022293504,bytesPerFeatureLabel:851.35885}},PATH_MITER_QUAD:{bytesPerFeature:25558.22153327986,bytesPerFeatureLabel:838.56885,resourceBytes:0,draped:{bytesPerFeature:25558.22153327986,bytesPerFeatureLabel:838.56885}},PATH_ROUND_QUAD:{bytesPerFeature:42274.86801764233,bytesPerFeatureLabel:867.5658500000001,resourceBytes:0,draped:{bytesPerFeature:42274.86801764233,bytesPerFeatureLabel:867.5658500000001}},FILL:{bytesPerFeature:3124.272297197038,bytesPerFeatureLabel:850.6966816666666,resourceBytes:0,draped:{bytesPerFeature:2630.99580851019,bytesPerFeatureLabel:845.464495}},FILL_OUTLINE:{bytesPerFeature:4501.643043274039,bytesPerFeatureLabel:866.3982816666668,resourceBytes:0,draped:{bytesPerFeature:3841.8870233416183,bytesPerFeatureLabel:854.9969683333334}},EXTRUDE:{bytesPerFeature:7545.975968446941,bytesPerFeatureLabel:859.7106016666668,resourceBytes:0,draped:{bytesPerFeature:7545.975968446941,bytesPerFeatureLabel:859.7106016666668}},EXTRUDE_EDGES:{bytesPerFeature:2872.306473115409,bytesPerFeatureLabel:604.556581666667,resourceBytes:0,draped:{bytesPerFeature:2872.306473115409,bytesPerFeatureLabel:604.556581666667}}};var Ts;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(Ts||(Ts={}));let Nj=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=lc.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,r){return this._loadStatus===lc.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===lc.FAILED?(r&&r(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=lc.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=lc.FAILED,!Os(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(e,r).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=Ml(this._abortController):this._loadStatus===lc.LOADING&&(this._loadStatus=lc.FAILED),this._loader=null}};var lc;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(lc||(lc={}));const mb=ne.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let sf=class extends Nj{constructor(e,r,i,s){super(i.schedule),this.symbol=e,this.symbolLayer=r,this._context=i,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this._materials=[],this.usedMemory=0,this.logger=mb,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new BI,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=oQ(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const r=this._drivenProperties,i=oQ(e);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,r,i,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!this._logGeometryValidationWarnings(r,i,s)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&mb.warnOncePerTick(l)}_logGeometryValidationWarnings(e,r,i){const s=`${i} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(mb.warnOncePerTick(`${s} (no ${r} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(mb.warnOncePerTick(`${s} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(e,r=null,i=null){if(r!=null&&!r.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;if(e.type==="point"){const s=e;if(!isFinite(s.x)||!isFinite(s.y))return mb.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return Pje}_defaultElevationInfoZ(){return Mje}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,r=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,r=new BI){const i=e.geometry,s=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,r.mode=this.getGeometryElevationMode(i,s),r.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";n&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=n?vGe:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,e,this._context.layer),r}prepareSymbolLayerPatch(e){}updateGeometry(e,r){return!1}updateTransform(e,r,i,s){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,r=aQ){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?i*=e.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,r=aQ){const i=this._getCombinedOpacity(e,r);if(this._drivenProperties.color)return YE(null,i);const s=e!=null?qe.toUnitRGB(e):Jf;return YE(s,i)}_getVertexOpacityAndColor(e,r=null){const i=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=YE(i,s);return r&&(n[0]*=r,n[1]*=r,n[2]*=r,n[3]*=r),n}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return sye(this.symbol,this.symbolLayer)}globalPropertyChanged(e,r,i){switch(e){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,s)!==es.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,r,i){let s=es.UPDATE;return e.forEach(n=>{const o=r(n);if(o!=null){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else s=es.RECREATE}),s}applyRendererDiff(e,r){return Ts.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const r=this._fastUpdates.visualVariables,i=r.size?Xh(r.size.field,e):0,s=r.color?Xh(r.color.field,e):0,n=r.opacity?Xh(r.opacity.field,e):0;return Ot(i,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&mb.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var r,i,s,n,o,a,l,c;return{size:((i=(r=this._fastUpdates)==null?void 0:r.visualVariables.size)==null?void 0:i.field)??null,color:((n=(s=this._fastUpdates)==null?void 0:s.visualVariables.color)==null?void 0:n.field)??null,opacity:((a=(o=this._fastUpdates)==null?void 0:o.visualVariables.opacity)==null?void 0:a.field)??null,rotation:((c=(l=this._fastUpdates)==null?void 0:l.visualVariables.rotation)==null?void 0:c.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function oQ(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(r=>{switch(r.type){case"color":if(e.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const s=r.stops[i].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const Pje={mode:"on-the-ground",offset:0,unit:"meters"},Mje={mode:"absolute-height",offset:0,unit:"meters"},aQ={hasIntrinsicColor:!1};let zm=class extends J3{get geometries(){return this._geometries}get transformation(){return this._transformation??$i}set transformation(e){this._transformation=Ss(this._transformation??ge(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?Ss(this._shaderTransformation??ge(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=Ki.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new aye),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){Je(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const r=this._geometries.splice(e,1)[0];r&&(this._emit("geometryRemoved",{object:this,geometry:r}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,r,i=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:r,sync:i}),ZFe(r)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const r of this._geometries)r.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new xI(Tm.MaskOccludee);for(const r of this._geometries)r.occludees=Qk(r.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const r of this._geometries)r.occludees=Kk(r.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new xI(Tm.Highlight);for(const r of this._geometries)r.highlights=Qk(r.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const r of this._geometries)r.highlights=Kk(r.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,r){return Pr(r,this.transformation,e.transformation)}getCombinedShaderTransformation(e,r=ge()){return Pr(r,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new lQ,this._validateBoundingVolume(this._bvWorldSpace,XE.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new lQ,this._validateBoundingVolume(this._bvObjectSpace,XE.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,r){const i=r===XE.ObjectSpace;for(const s of this._geometries){const n=s.boundingInfo;n&&$je(n,e,i?s.transformation:this.getCombinedShaderTransformation(s))}$r(e.bounds,e.min,e.max,.5);for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const o=i?s.transformation:this.getCombinedShaderTransformation(s),a=jx(o);De(cQ,n.center,o);const l=hi(cQ,e.bounds),c=n.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){var r;const e=(r=this._bvWorldSpace)==null?void 0:r.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,r){this._parentLayer&&this._parentLayer.events.emit(e,r)}get test(){const e=this;return{hasGeometry:r=>e._geometries.includes(r),getGeometryIndex:r=>e._geometries.indexOf(r)}}},aye=class{constructor(){this.min=Te(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Te(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},lQ=class extends aye{constructor(){super(...arguments),this.bounds=ds()}};function $je(t,e,r){const i=t.bbMin,s=t.bbMax;if(iD(r)){const n=se(Ije,r[12],r[13],r[14]);le(Gl,i,n),le(Ju,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Gl[o]),e.max[o]=Math.max(e.max[o],Ju[o])}else if(De(Gl,i,r),ho(i,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Gl[n]),e.max[n]=Math.max(e.max[n],Gl[n]);else{De(Ju,s,r);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Gl[n],Ju[n]),e.max[n]=Math.max(e.max[n],Gl[n],Ju[n]);for(let n=0;n<3;++n){ie(Gl,i),ie(Ju,s),Gl[n]=s[n],Ju[n]=i[n],De(Gl,Gl,r),De(Ju,Ju,r);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Gl[o],Ju[o]),e.max[o]=Math.max(e.max[o],Gl[o],Ju[o])}}}const Ije=E(),Gl=E(),Ju=E(),cQ=E();var XE;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(XE||(XE={}));function Fj(t,e,r,i,s){const n=t.clippingExtent;if(Ll(e,C0,t.elevationProvider.spatialReference),n!=null&&!lV(n,C0))return null;Ll(e,C0,t.renderCoordsHelper.spatialReference),r.localOrigin=t.localOriginFactory.getOrigin(C0);const o=new zm({geometries:[r],castShadow:!1,layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:o,sampledElevation:tGe(o,e,t.elevationProvider,t.renderCoordsHelper,i)}}function r3(t,e,r){const i=t.elevationContext,s=r.spatialReference;Ll(e,C0,s),i.centerPointInElevationSR=fy(C0[0],C0[1],e.hasZ?C0[2]:0,s??null)}function i3(t){switch(t.type){case"point":return t;case"polygon":case"extent":return Sj(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const r=Rae(e,Aae(e)/2);return fy(r[0],r[1],r[2],t.spatialReference)}case"mesh":return t.origin}return null}const C0=E();function lye(){return new Float32Array(2)}function Lje(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function mu(t,e){const r=new Float32Array(2);return r[0]=t,r[1]=e,r}function Dje(t,e){return new Float32Array(t,e,2)}function cye(){return lye()}function uye(){return mu(1,1)}function hye(){return mu(1,0)}function dye(){return mu(0,1)}const pye=cye(),fye=uye(),Nje=hye(),Fje=dye();Object.freeze(Object.defineProperty({__proto__:null,ONES:fye,UNIT_X:Nje,UNIT_Y:Fje,ZEROS:pye,clone:Lje,create:lye,createView:Dje,fromValues:mu,ones:uye,unitX:hye,unitY:dye,zeros:cye},Symbol.toStringTag,{value:"Module"}));function Uje(t){const e=new dr,{vertex:r,fragment:i}=e;return r.include(_N),e.include($ge,t),e.include(us,t),e.attributes.add(R.UV0,"vec2"),r.uniforms.add(new nr("viewport",(s,n)=>n.camera.fullViewport),new Ee("lineSize",(s,n)=>s.size>0?Math.max(1,s.size)*n.camera.pixelRatio:0),new Ir("pixelToNDC",(s,n)=>ir(hQ,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Ee("borderSize",(s,n)=>s.borderColor!=null?n.camera.pixelRatio:0),new Ir("screenOffset",(s,n)=>ir(hQ,s.horizontalScreenOffset*n.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.multipassEnabled&&e.varyings.add("depth","float"),t.occlusionTestEnabled&&e.include(Jge),t.hasScreenSizePerspective&&yN(r),r.code.add(b`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?b`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?b`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:b`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.multipassEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?b`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:b`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?b`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:b`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add(new nr("uColor",s=>uQ(s.color)),new nr("borderColor",s=>uQ(s.borderColor))),t.multipassEnabled&&(i.include(Efe,t),i.uniforms.add(new Ir("inverseViewport",(s,n)=>n.inverseViewport))),i.code.add(b`
    void main() {
      ${t.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?b`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:b`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function uQ(t){return t??Ec}const hQ=ke(),kje=Object.freeze(Object.defineProperty({__proto__:null,build:Uje},Symbol.toStringTag,{value:"Module"}));let mye=class gye extends Sr{initializeConfiguration(e,r){r.spherical=e.viewingMode===$e.Global}initializeProgram(e){return new vr(e.rctx,gye.shader.get().build(this.configuration),hr)}setPipelineState(e){const r=e?Ar.ALWAYS:Ar.LESS;return this.configuration.depthHudEnabled?Et({depthTest:{func:r},depthWrite:Xa}):Et({blending:Jn(ve.ONE,ve.SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:Ut})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}};mye.shader=new _r(kje,()=>he(()=>import("./LineCallout.glsl-11c51c28.js"),[],import.meta.url));let eu=class extends ga{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.multipassEnabled=!1}};h([F()],eu.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([F()],eu.prototype,"spherical",void 0),h([F()],eu.prototype,"occlusionTestEnabled",void 0),h([F()],eu.prototype,"hasVerticalOffset",void 0),h([F()],eu.prototype,"hasScreenSizePerspective",void 0),h([F()],eu.prototype,"depthHudEnabled",void 0),h([F()],eu.prototype,"depthHudAlignStartEnabled",void 0),h([F()],eu.prototype,"hasSlicePlane",void 0),h([F()],eu.prototype,"multipassEnabled",void 0),h([F({constValue:!0})],eu.prototype,"hasSliceInVertexProgram",void 0),h([F({constValue:!1})],eu.prototype,"draped",void 0);let aO=class RB extends yy{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new yye),this._configuration=new eu,this._uniqueMaterialIdentifier=RB.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,r){const i=(r==null?void 0:r.slot)!==oe.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration}intersect(){}produces(e,r){if(r===L.Color)switch(e){case oe.LINE_CALLOUTS:case oe.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new Bje(e)}createBufferWriter(){return new Vje}validateParameters(e){const r=RB.uniqueMaterialIdentifier(e);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(e){return JSON.stringify({horizontalScreenOffset:e.horizontalScreenOffset??0,centerOffsetUnits:e.centerOffsetUnits||"world"})}},Bje=class extends my{beginSlot(e){return this.ensureTechnique(mye,e)}},yye=class extends yj{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const zje=Ci().vec3f(R.POSITION).vec3f(R.NORMAL).vec2f(R.UV0).vec4f(R.AUXPOS1),dQ=[mu(0,0),mu(1,0),mu(0,1),mu(1,0),mu(1,1),mu(0,1)];let Vje=class{constructor(){this.vertexBufferLayout=zje}elementCount(e){return 6*e.attributes.get(R.POSITION).indices.length}write(e,r,i,s,n){_j(i.attributes.get(R.POSITION),e,s.position,n,6),vj(i.attributes.get(R.NORMAL),r,s.normal,n,6),o2(i.attributes.get(R.AUXPOS1),s.auxpos1,n,6);for(let o=0;o<dQ.length;++o)s.uv0.setVec(n+o,dQ[o])}},_ye=class vye extends sf{constructor(e,r){super(e,null,r,jje),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new aO(this._materialParameters),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const r=this._materialParameters;return r.horizontalScreenOffset=e.horizontalScreenOffset??0,r.centerOffsetUnits=e.centerOffsetUnits||"world",r}get _materialParameters(){var o;const e=new yye,r=this.symbol,i=r.callout;if(e.color=i.color!=null?qe.toUnitRGBA(i.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=Fo(i.size||0),r.verticalOffset){const{screenLength:a,minWorldLength:l,maxWorldLength:c}=r.verticalOffset;e.verticalOffset={screenLength:Fo(a),minWorldLength:l||0,maxWorldLength:c??1/0}}e.borderColor=((o=i.border)==null?void 0:o.color)!=null?qe.toUnitRGBA(i.border.color):null;const s=r.symbolLayers.at(0).type==="object",n=r.type==="label-3d";return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Gje}createGraphics3DGraphic(e){const r=e.renderingInfo,i=e.graphic,s=this.setGraphicElevationContext(i,new BI,r.elevationOffset||0),n=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!Xce(l)))return null;const a=Sj(i.geometry);return a==null?null:this._createAs3DShape(a,s,r,i.uid)}layerOpacityChanged(){var e;(e=this._materials[0])==null||e.setParameters(this._materialParameters)}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=sA(vye.elevationModeChangeTypes,i,s);return n!==es.UPDATE||e.forEach(o=>{const a=r(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,r,i=0){return super.setGraphicElevationContext(e,r),r.addOffsetRenderUnits(i),r}updateGraphicElevationContext(e,r){this.setGraphicElevationContext(e,r.elevationContext,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=ku(r.elevationContext.mode)}computeComplexity(){return new uu({verticesPerFeature:6})}_createVertexData(e){const{translation:r,centerOffset:i}=e,s=new Ue(r?[r[0],r[1],r[2]]:[0,0,0],rF,3,!0),n=new Ue(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],rF,4,!0);return[[R.POSITION,s],[R.NORMAL,new Ue([0,0,1],rF,3,!0)],[R.AUXPOS1,n]]}_getOrCreateMaterial(e){var s;const r=this._perInstanceMaterialParameters(e),i=aO.uniqueMaterialIdentifier(r);if(i===((s=this._materials[0])==null?void 0:s.uniqueMaterialIdentifier))return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let n=e.materialCollection.get(i);return n==null&&(n=new aO(r),e.materialCollection.add(i,n)),{material:n,isUnique:!1}}return{material:new aO(r),isUnique:!0}}_createAs3DShape(e,r,i,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(i),l=new Ds(a.material,this._createVertexData(i),null,Ki.Point,o),c=Fj(this._context,e,l,r,s);if(c==null)return null;const u=new rf(this,c.object,[l],a.isUnique?[a.material]:null,null,I1,r);return u.metadata=new T0e(i.elevationOffset),u.alignedSampledElevation=c.sampledElevation,u.needsElevationUpdates=ku(r.mode),r3(u,e,this._context.elevationProvider),u}};_ye.elevationModeChangeTypes={definedChanged:es.UPDATE,staysOnTheGround:es.UPDATE,onTheGroundChanged:es.RECREATE};const rF=[0],Gje={mode:"relative-to-ground",offset:0},jje={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let Hje=class{constructor(e,r,i=E(),s=Jt(),n=0,o="world",a=0,l=null){this.renderer=e,this.symbol=r,this.translation=i,this.centerOffset=s,this.horizontalScreenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},qje=class extends bGe{};const pQ=ne.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function Wje(t,e){if(!gV(t))return pQ.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const r=Yje[t.callout.type];return r?new r(t,e):(pQ.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const Yje={line:_ye},Uj=(t,e,r)=>[e,r],l2=(t,e,r)=>[e,r,t[2]],kj=(t,e,r)=>[e,r,t[2],t[3]];function Pxt(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function Xje({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function Zje({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function bye({scale:t,translate:e},r){return r*t[0]+e[0]}function wye({scale:t,translate:e},r){return e[1]-r*t[1]}function xye(t,e,r){const i=new Array(r.length);if(!r.length)return i;const[s,n]=t.scale;let o=bye(t,r[0][0]),a=wye(t,r[0][1]);i[0]=e(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*s,a-=c[1]*n,i[l]=e(c,o,a)}return i}function Tye(t,e,r){const i=new Array(r.length);for(let s=0;s<r.length;s++)i[s]=xye(t,e,r[s]);return i}function Jje(t,e,r,i){return xye(t,r?i?kj:l2:i?l2:Uj,e)}function Qje(t,e,r,i){return Tye(t,r?i?kj:l2:i?l2:Uj,e)}function Kje(t,e,r,i){return Tye(t,r?i?kj:l2:i?l2:Uj,e)}function Mxt(t,e,r,i,s){return e.x=Xje(t,r.x),e.y=Zje(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m)),e}function Sye(t,e,r,i,s){return r!=null&&(e.points=Jje(t,r.points,i,s)),e}function Eye(t,e,r,i,s){return r==null||(e.x=bye(t,r.x),e.y=wye(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m))),e}function Cye(t,e,r,i,s){return r!=null&&(e.rings=Kje(t,r.rings,i,s)),e}function Aye(t,e,r,i,s){return r!=null&&(e.paths=Qje(t,r.paths,i,s)),e}var OB;let XS=OB=class extends st{constructor(t){super(t),this.name=null,this.code=null}clone(){return new OB({name:this.name,code:this.code})}};h([f({type:String,json:{write:!0}})],XS.prototype,"name",void 0),h([f({type:[String,Number],json:{write:!0}})],XS.prototype,"code",void 0),XS=OB=h([k("esri.layers.support.CodedValue")],XS);const eHe=new Pc({inherited:"inherited",codedValue:"coded-value",range:"range"});let ZS=class extends st{constructor(e){super(e),this.name=null,this.type=null}};h([f({type:String,json:{write:!0}})],ZS.prototype,"name",void 0),h([Ht(eHe)],ZS.prototype,"type",void 0),ZS=h([k("esri.layers.support.Domain")],ZS);const ON=ZS;var PB;let JS=PB=class extends ON{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const r=String(t);this.codedValues.some(i=>(String(i.code)===r&&(e=i.name),!!e))}return e}clone(){return new PB({codedValues:ye(this.codedValues),name:this.name})}};h([f({type:[XS],json:{write:!0}})],JS.prototype,"codedValues",void 0),h([Ht({codedValue:"coded-value"})],JS.prototype,"type",void 0),JS=PB=h([k("esri.layers.support.CodedValueDomain")],JS);const Rye=JS;var MB;let $M=MB=class extends ON{constructor(t){super(t),this.type="inherited"}clone(){return new MB}};h([Ht({inherited:"inherited"})],$M.prototype,"type",void 0),$M=MB=h([k("esri.layers.support.InheritedDomain")],$M);const Oye=$M;var $B;let pw=$B=class extends ON{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new $B({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};h([f({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var r;return(r=e.range)==null?void 0:r[1]}},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,r){e[r]=[this.minValue||0,t]}}}})],pw.prototype,"maxValue",void 0),h([f({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var r;return(r=e.range)==null?void 0:r[0]}},write:{target:"range",writer(t,e,r){e[r]=[t,this.maxValue||0]}}}})],pw.prototype,"minValue",void 0),h([Ht({range:"range"})],pw.prototype,"type",void 0),pw=$B=h([k("esri.layers.support.RangeDomain")],pw);const Pye=pw,tHe={key:"type",base:ON,typeMap:{range:Pye,"coded-value":Rye,inherited:Oye}};function rHe(t){if(!(t!=null&&t.type))return null;switch(t.type){case"range":return Pye.fromJSON(t);case"codedValue":return Rye.fromJSON(t);case"inherited":return Oye.fromJSON(t)}return null}const iHe=new Pc({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var IB;const sHe=new Pc({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let ra=IB=class extends st{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return(r==null?void 0:r.value)??null}readValueType(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?sHe.fromJSON(r.fieldValueType):null}clone(){return new IB({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};h([f({type:String,json:{write:!0}})],ra.prototype,"alias",void 0),h([f({type:[String,Number],json:{write:{allowNull:!0}}})],ra.prototype,"defaultValue",void 0),h([f()],ra.prototype,"description",void 0),h([si("description")],ra.prototype,"readDescription",null),h([f({types:tHe,json:{read:{reader:rHe},write:!0}})],ra.prototype,"domain",void 0),h([f({type:Boolean,json:{write:!0}})],ra.prototype,"editable",void 0),h([f({type:Qs,json:{write:{overridePolicy:t=>({enabled:Number.isFinite(t)})}}})],ra.prototype,"length",void 0),h([f({type:String,json:{write:!0}})],ra.prototype,"name",void 0),h([f({type:Boolean,json:{write:!0}})],ra.prototype,"nullable",void 0),h([Ht(iHe)],ra.prototype,"type",void 0),h([f()],ra.prototype,"valueType",void 0),h([si("valueType",["description"])],ra.prototype,"readValueType",null),h([f({type:Boolean,json:{read:!1}})],ra.prototype,"visible",void 0),ra=IB=h([k("esri.layers.support.Field")],ra);const nHe=ra;let Ixt=class{constructor(e,r,i){this.uid=e,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}};function Dxt(t){return t.geometry!=null}let Nxt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function Uxt(t){var n;const e=zAe.fromJSON(t.geometryType),r=at.fromJSON(t.spatialReference),i=t.transform,s=t.features.map(o=>{const a=oHe(o,e,r,t.objectIdFieldName),l=a.geometry;if(l!=null&&i)switch(l.type){case"point":a.geometry=Eye(i,l,l,l.hasZ,l.hasM);break;case"multipoint":a.geometry=Sye(i,l,l,!!l.hasZ,!!l.hasM);break;case"polygon":a.geometry=Cye(i,l,l,!!l.hasZ,!!l.hasM);break;case"polyline":a.geometry=Aye(i,l,l,!!l.hasZ,!!l.hasM);break;case"extent":case"mesh":a.geometry=l}return a});return{geometryType:e,features:s,spatialReference:r,fields:((n=t.fields)==null?void 0:n.map(o=>nHe.fromJSON(o)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function oHe(t,e,r,i){return{uid:bc(),objectId:i&&t.attributes?t.attributes[i]:null,attributes:t.attributes,geometry:aHe(t.geometry,e,r),visible:!0}}function aHe(t,e,r){if(t==null)return null;switch(e){case"point":{const i=t;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=t;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=t;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=t;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function lHe(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),s=t.type==="polyline"?t.paths:t.rings;for(const n of s)r+=n.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32*(s.length+1);break}case"multipoint":{const r=2+(t.hasZ?1:0)+(t.hasM?1:0),i=t.points.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=F0(t.vertexAttributes.position,t.vertexAttributes.normal,t.vertexAttributes.uv,t.vertexAttributes.tangent)}return e}function kxt(t){let e=32;return e+=Ese(t.attributes),e+=3,e+=8+lHe(t.geometry),e}function Bxt(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const r of t.paths)e+=r.length;return e}case"polygon":{let e=0;for(const r of t.rings)e+=r.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function zxt(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function Vxt(t,e){switch(ui(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let r=0;r<t.paths.length;r++)E4(e,t.paths[r],!!t.hasZ);break;case"polygon":for(let r=0;r<t.rings.length;r++)E4(e,t.rings[r],!!t.hasZ);break;case"multipoint":E4(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function cHe(t,e){switch(Mu(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let r=0;r<t.paths.length;r++)p4(e,t.paths[r]);break;case"polygon":for(let r=0;r<t.rings.length;r++)p4(e,t.rings[r]);break;case"multipoint":p4(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function Gxt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}let pv=class Mye{constructor(e=null,r={},i,s){this.geometry=e,this.attributes=r,this.centroid=i,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new Mye(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function jxt(t){var e,r;return!!((r=(e=t.geometry)==null?void 0:e.coords)!=null&&r.length)}let Hxt=class extends pv{},uHe=class $ye{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new $ye;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}},oy=class IM{constructor(e=[],r=[],i=!1){this.lengths=e??[],this.coords=r??[],this.hasIndeterminateRingOrder=i}static fromRect(e){const[r,i,s,n]=e,o=s-r,a=n-i;return new IM([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,r)=>e+r)}forEachVertex(e){let r=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const s=this.lengths[i];for(let n=0;n<s;n++)e(this.coords[2*(n+r)],this.coords[2*(n+r)+1]);r+=s}}clone(e){return e?(e.set(this.coords),new IM(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new IM(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}};function Ho(t,e){return t?e?4:3:e?3:2}const uA=ne.getLogger("esri.layers.graphics.featureConversionUtils"),Iye={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},hHe=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n},fQ=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2]},dHe=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+3]},pHe=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2],t[r+3]=e[i+3]};function Bj(t,e,r,i){if(t){if(r)return e&&i?pHe:fQ;if(e&&i)return dHe}else if(e&&i)return fQ;return hHe}function iF({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function sF({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function nF({scale:t,translate:e},r,i){return r*t[i]+e[i]}function Wxt(t,e,r){return t?e?r?Gj(t):zj(t):r?Vj(t):PN(t):null}function PN(t){const e=t.coords;return{x:e[0],y:e[1]}}function Lye(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function zj(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function fHe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function Vj(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function mHe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function Gj(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function gHe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function yHe(t,e,r,i){let s=PN;r&&i?s=Gj:r?s=zj:i&&(s=Vj);for(const n of e){const{geometry:o,attributes:a}=n,l=o!=null?s(o):null;t.push({attributes:a,geometry:l})}return t}function jj(t,e){return t&&e?gHe:t?fHe:e?mHe:Lye}function _He(t,e,r,i,s){const n=jj(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?n(new oy,o):null;t.push(new pv(l,a,null,s?a[s]:void 0))}return t}function Yxt(t,e,r=jj(e.z!=null,e.m!=null)){return r(t,e)}function vHe(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?Dye(s,r,i):null});return t}function Dye(t,e,r){if(t==null)return null;const i=Ho(e,r),s=[];for(let n=0;n<t.coords.length;n+=i){const o=[];for(let a=0;a<i;a++)o.push(t.coords[n+a]);s.push(o)}return e?r?{points:s,hasZ:e,hasM:r}:{points:s,hasZ:e}:r?{points:s,hasM:r}:{points:s}}function bHe(t,e,r,i,s){const n=Ho(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?Nye(new oy,o,n):null;t.push(new pv(l,a,null,s?a[s]:void 0))}return t}function Nye(t,e,r=Ho(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const i=t.coords;let s=0;for(const n of e.points)for(let o=0;o<r;o++)i[s++]=n[o];return t}function wHe(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?Fye(s,r,i):null});return t}function Fye(t,e,r){if(!t)return null;const i=Ho(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const d=[];for(let p=0;p<i;p++)d.push(s[a++]);c.push(d)}o.push(c)}return e?r?{paths:o,hasZ:e,hasM:r}:{paths:o,hasZ:e}:r?{paths:o,hasM:r}:{paths:o}}function xHe(t,e,r,i,s){const n=Ho(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?Uye(new oy,o,n):null;t.push(new pv(l,a,null,s?a[s]:void 0))}return t}function Uye(t,e,r=Ho(e.hasZ,e.hasM)){const{lengths:i,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<r;l++)s[n++]=a[l];i.push(o.length)}return t}function THe(t,e,r,i){for(const{geometry:s,attributes:n,centroid:o}of e){const a=s!=null?kye(s,r,i):null;if(o!=null){const l=PN(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function kye(t,e,r){if(!t)return null;const i=Ho(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const d=[];for(let p=0;p<i;p++)d.push(s[a++]);c.push(d)}o.push(c)}return e?r?{rings:o,hasZ:e,hasM:r}:{rings:o,hasZ:e}:r?{rings:o,hasM:r}:{rings:o}}function SHe(t,e,r,i,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=n!=null?Bye(new oy,n,r,i):null,c=s?a[s]:void 0;o!=null?t.push(new pv(l,a,Lye(new oy,o),c)):t.push(new pv(l,a,null,c))}return t}function Bye(t,e,r=e.hasZ,i=e.hasM){return EHe(t,e.rings,r,i)}function EHe(t,e,r,i){const s=Ho(r,i),{lengths:n,coords:o}=t;let a=0;lm(t);for(const l of e){for(const c of l)for(let u=0;u<s;u++)o[a++]=c[u];n.push(l.length)}return t}const gx=[],ZE=[];function Xxt(t,e,r,i,s){gx[0]=t;const[n]=zye(ZE,gx,e,r,i,s);return ad(gx),ad(ZE),n}function zye(t,e,r,i,s,n){if(ad(t),!r){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new pv(null,o.attributes,null,a))}return t}switch(r){case"esriGeometryPoint":return _He(t,e,i,s,n);case"esriGeometryMultipoint":return bHe(t,e,i,s,n);case"esriGeometryPolyline":return xHe(t,e,i,s,n);case"esriGeometryPolygon":return SHe(t,e,i,s,n);default:uA.error("convertToFeatureSet:unknown-geometry",new X(`Unable to parse unknown geometry type '${r}'`)),ad(t)}return t}function Zxt(t,e,r,i){ZE[0]=t,Vye(gx,ZE,e,r,i);const s=gx[0];return ad(gx),ad(ZE),s}function CHe(t,e,r){if(t==null)return null;const i=new oy;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&r==null&&(r=t.hasM),B7(t)?jj(e??t.z!=null,r??t.m!=null)(i,t):lD(t)?Bye(i,t,e,r):z7(t)?Uye(i,t,Ho(e,r)):k7(t)?Nye(i,t,Ho(e,r)):void uA.error("convertFromGeometry:unknown-geometry",new X(`Unable to parse unknown geometry type '${t}'`))}function AHe(t,e,r,i){const s=t&&("coords"in t?t:t.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let n=PN;return r&&i?n=Gj:r?n=zj:i&&(n=Vj),n(s)}case"esriGeometryMultipoint":return Dye(s,r,i);case"esriGeometryPolyline":return Fye(s,r,i);case"esriGeometryPolygon":return kye(s,r,i);default:return uA.error("convertToGeometry:unknown-geometry",new X(`Unable to parse unknown geometry type '${e}'`)),null}}function RHe(t,e){for(const r of e)t.push({attributes:r.attributes});return t}function Vye(t,e,r,i,s){if(ad(t),r==null)return RHe(t,e);switch(r){case"esriGeometryPoint":return yHe(t,e,i,s);case"esriGeometryMultipoint":return vHe(t,e,i,s);case"esriGeometryPolyline":return wHe(t,e,i,s);case"esriGeometryPolygon":return THe(t,e,i,s);default:uA.error("convertToFeatureSet:unknown-geometry",new X(`Unable to parse unknown geometry type '${r}'`))}return t}function Jxt(t){const{objectIdFieldName:e,spatialReference:r,transform:i,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:d,queryGeometryType:p}=t,g={features:Vye([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:r,uniqueIdField:u,queryGeometry:AHe(d,p,!1,!1)};return i&&(g.transform=i),c&&(g.exceededTransferLimit=c),n&&(g.hasM=n),o&&(g.hasZ=o),g}function Qxt(t,e){const r=new uHe,{hasM:i,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:u,fields:d}=t;return d&&(r.fields=d),r.geometryType=l??null,r.objectIdFieldName=o??e??null,r.spatialReference=a??null,r.objectIdFieldName?(n&&zye(r.features,n,l,s,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),s&&(r.hasZ=s),u&&(r.transform=u),r):(uA.error(new X("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function Kxt(t){const{transform:e,features:r,hasM:i,hasZ:s}=t;if(!e)return t;for(const n of r)n.geometry!=null&&gQ(n.geometry,n.geometry,i,s,e),n.centroid!=null&&gQ(n.centroid,n.centroid,i,s,e);return t.transform=null,t}function e2t(t,e){const{geometryType:r,features:i,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new oy,mQ(l.geometry,a.geometry,s,n,r,t),a.centroid&&(l.centroid=new oy,mQ(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),i[o]=l}return e.transform=t,e}function mQ(t,e,r,i,s,n,o=r,a=i){if(lm(t),!(e!=null&&e.coords.length))return null;const l=Iye[s],{coords:c,lengths:u}=e,d=Ho(r,i),p=Ho(r&&o,i&&a),g=Bj(r,i,o,a);if(!u.length)return g(t.coords,c,0,0,iF(n,c[0]),sF(n,c[1])),lm(t,d,0),t;let y,_,v,w,x=0,T=0,S=T;for(const C of u){if(C<l)continue;let A=0;T=S,v=y=iF(n,c[x]),w=_=sF(n,c[x+1]),g(t.coords,c,T,x,v,w),A++,x+=d,T+=p;for(let O=1;O<C;O++,x+=d)v=iF(n,c[x]),w=sF(n,c[x+1]),v===y&&w===_||(g(t.coords,c,T,x,v-y,w-_),T+=p,A++,y=v,_=w);A>=l&&(t.lengths.push(A),S=T)}return ad(t.coords,S),t.coords.length?t:null}function t2t(t,e,r,i,s,n,o=r,a=i){if(lm(t),!(e!=null&&e.coords.length))return null;const l=Iye[s],{coords:c,lengths:u}=e,d=Ho(r,i),p=Ho(r&&o,i&&a),g=Bj(r,i,o,a);if(!u.length)return g(t.coords,c,0,0,c[0],c[1]),lm(t,d,0),t;let y=0;const _=n*n;for(const v of u){if(v<l){y+=v*d;continue}const w=t.coords.length/p,x=y,T=y+(v-1)*d;g(t.coords,c,t.coords.length,x,c[x],c[x+1]),LB(t.coords,c,d,_,g,x,T),g(t.coords,c,t.coords.length,T,c[T],c[T+1]);const S=t.coords.length/p-w;S>=l?t.lengths.push(S):ad(t.coords,w*p),y+=v*d}return t.coords.length?t:null}function OHe(t,e,r,i){const s=t[e],n=t[e+1],o=t[r],a=t[r+1],l=t[i],c=t[i+1];let u=o,d=a,p=l-u,g=c-d;if(p!==0||g!==0){const y=((s-u)*p+(n-d)*g)/(p*p+g*g);y>1?(u=l,d=c):y>0&&(u+=p*y,d+=g*y)}return p=s-u,g=n-d,p*p+g*g}function LB(t,e,r,i,s,n,o){let a,l=i,c=0;for(let u=n+r;u<o;u+=r)a=OHe(e,u,n,o),a>l&&(c=u,l=a);l>i&&(c-n>r&&LB(t,e,r,i,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>r&&LB(t,e,r,i,s,c,o))}function r2t(t,e,r,i){var c;if(!((c=e==null?void 0:e.coords)!=null&&c.length))return null;const s=Ho(r,i);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const u=e.coords;for(let d=0;d<u.length;d+=s){const p=u[d],g=u[d+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,g),l=Math.max(l,g)}}return LU(t)?kMe(t,n,o,a,l):I7(n,o,a,l,t),t}function gQ(t,e,r,i,s){const{coords:n,lengths:o}=e,a=Ho(r,i);if(!n.length)return t!==e&&lm(t),t;LL(s);const{originPosition:l,scale:c,translate:u}=s,d=MHe;d.originPosition=l;const p=d.scale;p[0]=c[0]??1,p[1]=-(c[1]??1),p[2]=c[2]??1,p[3]=c[3]??1;const g=d.translate;if(g[0]=u[0]??0,g[1]=u[1]??0,g[2]=u[2]??0,g[3]=u[3]??0,!o.length){for(let _=0;_<a;++_)t.coords[_]=nF(d,n[_],_);return t!==e&&lm(t,a,0),t}let y=0;for(let _=0;_<o.length;_++){const v=o[_];t.lengths[_]=v;for(let T=0;T<a;++T)t.coords[y+T]=nF(d,n[y+T],T);let w=t.coords[y],x=t.coords[y+1];y+=a;for(let T=1;T<v;T++,y+=a){w+=n[y]*p[0],x+=n[y+1]*p[1],t.coords[y]=w,t.coords[y+1]=x;for(let S=2;S<a;++S)t.coords[y+S]=nF(d,n[y+S],S)}}return t!==e&&lm(t,n.length,o.length),t}function i2t(t,e,r,i,s,n){if(lm(t),t.lengths.push(...e.lengths),r===s&&i===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=Ho(r,i),a=Bj(r,i,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function PHe(t,e,r,i){let s=0,n=t[i*e],o=t[i*(e+1)];for(let a=1;a<r;a++){const l=n+t[i*(e+a)],c=o+t[i*(e+a)+1],u=(l-n)*(c+o);n=l,o=c,s+=u}return .5*s}function s2t(t,e){const{coords:r,lengths:i}=t;let s=0,n=0;for(let o=0;o<i.length;o++){const a=i[o];n+=PHe(r,s,a,e),s+=a}return Math.abs(n)}function lm(t,e=0,r=0){ad(t.lengths,r),ad(t.coords,e)}function ad(t,e=0){t.length!==e&&(t.length=e)}const MHe={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},yQ=new Vo(Array,t=>_D(t,Dce),null,10,5),$He=Gt();let IHe=class{get labelLayers(){return this._labelLayers||Yxe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e==null?void 0:e.isElevationSource)}constructor(e,r,i,s,n){this.graphic=e,this.graphics3DSymbol=r,this.layers=i,this._visibleFlags=uo.ALL_LABEL,this.deconflictionPriority=0,++r.referenced,this._featureExpressionFeature=n?v0e(n,e,s):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(r=>{r.initialize(e),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,r){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(r),e.setVisibility(this.isVisible(An.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(e=!0)}),e}isVisible(e=An.GRAPHIC,r){const i=r?this._visibleFlags|r|An.LABEL*r:this._visibleFlags;return e===An.GRAPHIC?(i&uo.ALL_GRAPHIC)===uo.ALL_GRAPHIC:(i&uo.ALL_LABEL)===uo.ALL_LABEL}setVisibilityFlag(e,r,i){const s=this.isVisible(e);i?this._visibleFlags|=e*r:this._visibleFlags&=~(e*r);const n=this.isVisible(e);if(s===n)return!1;if(e===An.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(An.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,r){return(this._visibleFlags&e*r)!=0}computeExtent(e){if(!this._extent){const r=this.graphic.geometry;if(r==null)return!1;this._extent=Gt(),cHe(r,this._extent);const i=r.spatialReference;if(!hs(i,e)&&!OD(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,r){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,r)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,r,i){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=Np.fromExtent(s.type==="mesh"?s.extent:s)),CHe(s,r,i)}get usedMemory(){let e=Ese(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>e+=r.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:E(),num:0},draped:{origin:ke(),num:0}};for(const r of this.layers)r!=null&&r.computeAttachmentOrigin(e);return e.render.num>1&&ee(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&xl(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,r,i,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?ui(n.boundingBox):n.boundingBox=ui(),n.requiresDrapedElevation=!1,await jL(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?r:e,l=yQ.acquire(),c=await o.getProjectedBoundingBox(a,i,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&Dx(n.boundingBox,l),yQ.release(l)}),FMe(n.boundingBox)||z8(cV(n.boundingBox,$He))?n:null}needsElevationUpdates(){var e;for(const r of this.layers)if(r!=null&&(r.type==="object3d"||r.type==="lod-instance")&&r.needsElevationUpdates)return!0;return((e=this._labelLayers)==null?void 0:e.some(r=>(r==null?void 0:r.needsElevationUpdates)??!1))??!1}alignWithElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,r,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,r,i)})}addObjectStateSet(e,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e,r))}removeObjectState(e){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(e))}_forEachGraphicList(e,r){e==null||e.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){const e=this;return{addLabelLayer:r=>{e._labelLayers||(e._labelLayers=new Array),e._labelLayers.push(r)}}}},o2t=class{constructor(e,r){this.scheduler=e,this.schedule=r,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},LHe=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var _Q,vQ,bQ,DB={exports:{}};DB.exports,_Q=DB,vQ=function(){function t(P,I,B){B=B||2;var G,q,Z,K,fe,Pe,lt,Tt=I&&I.length,it=Tt?I[0]*B:P.length,dt=e(P,0,it,B,!0),Be=[];if(!dt||dt.next===dt.prev)return Be;if(Tt&&(dt=l(P,I,dt,B)),P.length>80*B){G=Z=P[0],q=K=P[1];for(var Re=B;Re<it;Re+=B)(fe=P[Re])<G&&(G=fe),(Pe=P[Re+1])<q&&(q=Pe),fe>Z&&(Z=fe),Pe>K&&(K=Pe);lt=(lt=Math.max(Z-G,K-q))!==0?1/lt:0}return i(dt,Be,B,G,q,lt),Be}function e(P,I,B,G,q){var Z,K;if(q===J(P,I,B,G)>0)for(Z=I;Z<B;Z+=G)K=Y(Z,P[Z],P[Z+1],K);else for(Z=B-G;Z>=I;Z-=G)K=Y(Z,P[Z],P[Z+1],K);if(K&&C(K,K.next)){var fe=K.next;H(K),K=fe}return K}function r(P,I){if(!P)return P;I||(I=P);var B,G=P;do if(B=!1,G.steiner||!C(G,G.next)&&S(G.prev,G,G.next)!==0)G=G.next;else{var q=G.prev;if(H(G),(G=I=q)===G.next)break;B=!0}while(B||G!==I);return I}function i(P,I,B,G,q,Z,K){if(P){!K&&Z&&y(P,G,q,Z);for(var fe,Pe,lt=P;P.prev!==P.next;)if(fe=P.prev,Pe=P.next,Z?n(P,G,q,Z):s(P))I.push(fe.i/B),I.push(P.i/B),I.push(Pe.i/B),H(P),P=Pe.next,lt=Pe.next;else if((P=Pe)===lt){K?K===1?i(P=o(r(P),I,B),I,B,G,q,Z,2):K===2&&a(P,I,B,G,q,Z):i(r(P),I,B,G,q,Z,1);break}}}function s(P){var I=P.prev,B=P,G=P.next;if(S(I,B,G)>=0)return!1;for(var q=P.next.next;q!==P.prev;){if(x(I.x,I.y,B.x,B.y,G.x,G.y,q.x,q.y)&&S(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function n(P,I,B,G){var q=P.prev,Z=P,K=P.next;if(S(q,Z,K)>=0)return!1;for(var fe=q.x<Z.x?q.x<K.x?q.x:K.x:Z.x<K.x?Z.x:K.x,Pe=q.y<Z.y?q.y<K.y?q.y:K.y:Z.y<K.y?Z.y:K.y,lt=q.x>Z.x?q.x>K.x?q.x:K.x:Z.x>K.x?Z.x:K.x,Tt=q.y>Z.y?q.y>K.y?q.y:K.y:Z.y>K.y?Z.y:K.y,it=v(fe,Pe,I,B,G),dt=v(lt,Tt,I,B,G),Be=P.prevZ,Re=P.nextZ;Be&&Be.z>=it&&Re&&Re.z<=dt;){if(Be!==P.prev&&Be!==P.next&&x(q.x,q.y,Z.x,Z.y,K.x,K.y,Be.x,Be.y)&&S(Be.prev,Be,Be.next)>=0||(Be=Be.prevZ,Re!==P.prev&&Re!==P.next&&x(q.x,q.y,Z.x,Z.y,K.x,K.y,Re.x,Re.y)&&S(Re.prev,Re,Re.next)>=0))return!1;Re=Re.nextZ}for(;Be&&Be.z>=it;){if(Be!==P.prev&&Be!==P.next&&x(q.x,q.y,Z.x,Z.y,K.x,K.y,Be.x,Be.y)&&S(Be.prev,Be,Be.next)>=0)return!1;Be=Be.prevZ}for(;Re&&Re.z<=dt;){if(Re!==P.prev&&Re!==P.next&&x(q.x,q.y,Z.x,Z.y,K.x,K.y,Re.x,Re.y)&&S(Re.prev,Re,Re.next)>=0)return!1;Re=Re.nextZ}return!0}function o(P,I,B){var G=P;do{var q=G.prev,Z=G.next.next;!C(q,Z)&&A(q,G,G.next,Z)&&N(q,Z)&&N(Z,q)&&(I.push(q.i/B),I.push(G.i/B),I.push(Z.i/B),H(G),H(G.next),G=P=Z),G=G.next}while(G!==P);return r(G)}function a(P,I,B,G,q,Z){var K=P;do{for(var fe=K.next.next;fe!==K.prev;){if(K.i!==fe.i&&T(K,fe)){var Pe=U(K,fe);return K=r(K,K.next),Pe=r(Pe,Pe.next),i(K,I,B,G,q,Z),void i(Pe,I,B,G,q,Z)}fe=fe.next}K=K.next}while(K!==P)}function l(P,I,B,G){var q,Z,K,fe=[];for(q=0,Z=I.length;q<Z;q++)(K=e(P,I[q]*G,q<Z-1?I[q+1]*G:P.length,G,!1))===K.next&&(K.steiner=!0),fe.push(w(K));for(fe.sort(c),q=0;q<fe.length;q++)B=r(B=d(fe[q],B),B.next);return B}function c(P,I){return P.x-I.x}function u(P){if(P.next.prev===P)return P;let I=P;for(;;){const B=I.next;if(B.prev===I||B===I||B===P)break;I=B}return I}function d(P,I){var B=p(P,I);if(!B)return I;var G=U(B,P),q=r(B,B.next);let Z=u(G);return r(Z,Z.next),q=u(q),u(I===B?q:I)}function p(P,I){var B,G=I,q=P.x,Z=P.y,K=-1/0;do{if(Z<=G.y&&Z>=G.next.y&&G.next.y!==G.y){var fe=G.x+(Z-G.y)*(G.next.x-G.x)/(G.next.y-G.y);if(fe<=q&&fe>K){if(K=fe,fe===q){if(Z===G.y)return G;if(Z===G.next.y)return G.next}B=G.x<G.next.x?G:G.next}}G=G.next}while(G!==I);if(!B)return null;if(q===K)return B;var Pe,lt=B,Tt=B.x,it=B.y,dt=1/0;G=B;do q>=G.x&&G.x>=Tt&&q!==G.x&&x(Z<it?q:K,Z,Tt,it,Z<it?K:q,Z,G.x,G.y)&&(Pe=Math.abs(Z-G.y)/(q-G.x),N(G,P)&&(Pe<dt||Pe===dt&&(G.x>B.x||G.x===B.x&&g(B,G)))&&(B=G,dt=Pe)),G=G.next;while(G!==lt);return B}function g(P,I){return S(P.prev,P,I.prev)<0&&S(I.next,P,P.next)<0}function y(P,I,B,G){var q=P;do q.z===null&&(q.z=v(q.x,q.y,I,B,G)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==P);q.prevZ.nextZ=null,q.prevZ=null,_(q)}function _(P){var I,B,G,q,Z,K,fe,Pe,lt=1;do{for(B=P,P=null,Z=null,K=0;B;){for(K++,G=B,fe=0,I=0;I<lt&&(fe++,G=G.nextZ);I++);for(Pe=lt;fe>0||Pe>0&&G;)fe!==0&&(Pe===0||!G||B.z<=G.z)?(q=B,B=B.nextZ,fe--):(q=G,G=G.nextZ,Pe--),Z?Z.nextZ=q:P=q,q.prevZ=Z,Z=q;B=G}Z.nextZ=null,lt*=2}while(K>1);return P}function v(P,I,B,G,q){return(P=1431655765&((P=858993459&((P=252645135&((P=16711935&((P=32767*(P-B)*q)|P<<8))|P<<4))|P<<2))|P<<1))|(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I=32767*(I-G)*q)|I<<8))|I<<4))|I<<2))|I<<1))<<1}function w(P){var I=P,B=P;do(I.x<B.x||I.x===B.x&&I.y<B.y)&&(B=I),I=I.next;while(I!==P);return B}function x(P,I,B,G,q,Z,K,fe){return(q-K)*(I-fe)-(P-K)*(Z-fe)>=0&&(P-K)*(G-fe)-(B-K)*(I-fe)>=0&&(B-K)*(Z-fe)-(q-K)*(G-fe)>=0}function T(P,I){return P.next.i!==I.i&&P.prev.i!==I.i&&!D(P,I)&&(N(P,I)&&N(I,P)&&z(P,I)&&(S(P.prev,P,I.prev)||S(P,I.prev,I))||C(P,I)&&S(P.prev,P,P.next)>0&&S(I.prev,I,I.next)>0)}function S(P,I,B){return(I.y-P.y)*(B.x-I.x)-(I.x-P.x)*(B.y-I.y)}function C(P,I){return P.x===I.x&&P.y===I.y}function A(P,I,B,G){var q=$(S(P,I,B)),Z=$(S(P,I,G)),K=$(S(B,G,P)),fe=$(S(B,G,I));return q!==Z&&K!==fe||!(q!==0||!O(P,B,I))||!(Z!==0||!O(P,G,I))||!(K!==0||!O(B,P,G))||!(fe!==0||!O(B,I,G))}function O(P,I,B){return I.x<=Math.max(P.x,B.x)&&I.x>=Math.min(P.x,B.x)&&I.y<=Math.max(P.y,B.y)&&I.y>=Math.min(P.y,B.y)}function $(P){return P>0?1:P<0?-1:0}function D(P,I){var B=P;do{if(B.i!==P.i&&B.next.i!==P.i&&B.i!==I.i&&B.next.i!==I.i&&A(B,B.next,P,I))return!0;B=B.next}while(B!==P);return!1}function N(P,I){return S(P.prev,P,P.next)<0?S(P,I,P.next)>=0&&S(P,P.prev,I)>=0:S(P,I,P.prev)<0||S(P,P.next,I)<0}function z(P,I){var B=P,G=!1,q=(P.x+I.x)/2,Z=(P.y+I.y)/2;do B.y>Z!=B.next.y>Z&&B.next.y!==B.y&&q<(B.next.x-B.x)*(Z-B.y)/(B.next.y-B.y)+B.x&&(G=!G),B=B.next;while(B!==P);return G}function U(P,I){var B=new V(P.i,P.x,P.y),G=new V(I.i,I.x,I.y),q=P.next,Z=I.prev;return P.next=I,I.prev=P,B.next=q,q.prev=B,G.next=B,B.prev=G,Z.next=G,G.prev=Z,G}function Y(P,I,B,G){var q=new V(P,I,B);return G?(q.next=G.next,q.prev=G,G.next.prev=q,G.next=q):(q.prev=q,q.next=q),q}function H(P){P.next.prev=P.prev,P.prev.next=P.next,P.prevZ&&(P.prevZ.nextZ=P.nextZ),P.nextZ&&(P.nextZ.prevZ=P.prevZ)}function V(P,I,B){this.i=P,this.x=I,this.y=B,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function J(P,I,B,G){for(var q=0,Z=I,K=B-G;Z<B;Z+=G)q+=(P[K]-P[Z])*(P[Z+1]+P[K+1]),K=Z;return q}return t.deviation=function(P,I,B,G){var q=I&&I.length,Z=q?I[0]*B:P.length,K=Math.abs(J(P,0,Z,B));if(q)for(var fe=0,Pe=I.length;fe<Pe;fe++){var lt=I[fe]*B,Tt=fe<Pe-1?I[fe+1]*B:P.length;K-=Math.abs(J(P,lt,Tt,B))}var it=0;for(fe=0;fe<G.length;fe+=3){var dt=G[fe]*B,Be=G[fe+1]*B,Re=G[fe+2]*B;it+=Math.abs((P[dt]-P[Re])*(P[Be+1]-P[dt+1])-(P[dt]-P[Be])*(P[Re+1]-P[dt+1]))}return K===0&&it===0?0:Math.abs((it-K)/K)},t.flatten=function(P){for(var I=P[0][0].length,B={vertices:[],holes:[],dimensions:I},G=0,q=0;q<P.length;q++){for(var Z=0;Z<P[q].length;Z++)for(var K=0;K<I;K++)B.vertices.push(P[q][Z][K]);q>0&&(G+=P[q-1].length,B.holes.push(G))}return B},t},(bQ=vQ())!==void 0&&(_Q.exports=bQ);const c2=Q3(DB.exports),MN=ne.getLogger("esri.views.3d.support.buffer.math");function DHe(t,e,r){ld(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function ld(t,e,r,i=3,s=i){if(t.length/i!==Math.ceil(e.length/s))return MN.error("source and destination buffers need to have the same number of elements"),t;const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[4],u=r[5],d=r[6],p=r[8],g=r[9],y=r[10],_=r[12],v=r[13],w=r[14];let x=0,T=0;for(let S=0;S<n;S++){const C=e[x],A=e[x+1],O=e[x+2];t[T]=o*C+c*A+p*O+_,t[T+1]=a*C+u*A+g*O+v,t[T+2]=l*C+d*A+y*O+w,x+=s,T+=i}return t}function Gye(t,e,r){cd(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function cd(t,e,r,i=3,s=i){if(t.length/i!==Math.ceil(e.length/s))return void MN.error("source and destination buffers need to have the same number of elements");const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],d=r[5],p=r[6],g=r[7],y=r[8];let _=0,v=0;for(let w=0;w<n;w++){const x=e[_],T=e[_+1],S=e[_+2];t[v]=o*x+c*T+p*S,t[v+1]=a*x+u*T+g*S,t[v+2]=l*x+d*T+y*S,_+=s,v+=i}}function NHe(t,e,r){GI(t.typedBuffer,e,r,t.typedBufferStride)}function GI(t,e,r,i=3){const s=Math.min(t.length/i,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=r*n[a],t[l+1]=r*n[a+1],t[l+2]=r*n[a+2],a+=o,l+=i}function FHe(t,e){$N(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function $N(t,e,r=3,i=r){const s=Math.min(t.length/r,e.length/i);let n=0,o=0;for(let a=0;a<s;a++){const l=e[n],c=e[n+1],u=e[n+2],d=l*l+c*c+u*u;if(d>0){const p=1/Math.sqrt(d);t[o]=p*l,t[o+1]=p*c,t[o+2]=p*u}n+=i,o+=r}}function UHe(t,e,r){const i=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let u=0;u<i;u++)s[c]=o[l]>>r,s[c+1]=o[l+1]>>r,s[c+2]=o[l+2]>>r,l+=a,c+=n}Object.freeze(Object.defineProperty({__proto__:null,normalize:$N,normalizeView:FHe,scale:GI,scaleView:NHe,shiftRight:UHe,transformMat3:cd,transformMat3View:Gye,transformMat4:ld,transformMat4View:DHe},Symbol.toStringTag,{value:"Module"}));function kHe(t,e,r){return{objectId:t,target:e,distance:r,type:"vertex"}}function wQ(t,e,r,i,s,n=!1){return{objectId:t,target:e,distance:r,type:"edge",start:i,end:s,draped:n}}var cm,Ro;function BHe(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function s3(t){return t!=null&&!isNaN(t)&&isFinite(t)}function zHe(t){return t.valueExpression?cm.Expression:t.field&&typeof t.field=="string"?cm.Field:cm.Unknown}function c2t(t,e){const r=e||zHe(t),i=t.valueUnit||"unknown";return r===cm.Unknown?Ro.Constant:t.stops?Ro.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?Ro.ClampedLinear:i==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?Ro.Proportional:Ro.Additive:Ro.Identity:Ro.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(cm||(cm={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(Ro||(Ro={}));const ay=ne.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),xQ=new iv,LM=Math.PI,VHe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function jye(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="color"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void ay.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof e=="number",n=s?null:e,o=n==null?void 0:n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let d=i.cache.compiledFunc;if(!l&&!u){const y=i.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(u){if((r==null?void 0:r.arcade)==null)return void ay.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(y),w=_.createExecContext(n,v,r.timeZone);if(!d){const x=_.createSyntaxTree(i.valueExpression);d=_.createFunction(x),i.cache.compiledFunc=d}a=_.executeFunction(d,w)}else o&&(a=o[l]);const p=i.normalizationField,g=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||s||!isNaN(g)&&g!==0)){isNaN(g)||s||(a/=g);const y=qj(a,c);if(y){const _=y[0],v=y[1],w=_===v?i.stops[_].color:qe.blendColors(i.stops[_].color,i.stops[v].color,y[2],r!=null?r.color:void 0);return new qe(w)}}}function Hye(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="opacity"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void ay.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n==null?void 0:n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let d=i.cache.compiledFunc;if(!l&&!u){const y=i.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(u){if((r==null?void 0:r.arcade)==null)return void ay.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(y),w=_.createExecContext(n,v,r.timeZone);if(!d){const x=_.createSyntaxTree(i.valueExpression);d=_.createFunction(x),i.cache.compiledFunc=d}a=_.executeFunction(d,w)}else o&&(a=o[l]);const p=i.normalizationField,g=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||s||!isNaN(g)&&g!==0)){isNaN(g)||s||(a/=g);const y=qj(a,c);if(y){const _=y[0],v=y[1];if(_===v)return i.stops[_].opacity;{const w=i.stops[_].opacity;return w+(i.stops[v].opacity-w)*y[2]}}}}function qye(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="rotation"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void ay.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=i.axis||"heading",n=s==="heading"&&i.rotationType==="arithmetic"?90:0,o=s==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a==null?void 0:a.attributes,c=i.field,{hasExpression:u}=i.cache;let d=i.cache.compiledFunc,p=0;if(!c&&!u)return p;if(u){if((r==null?void 0:r.arcade)==null)return void ay.error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,_=y.getViewInfo(g),v=y.createExecContext(a,_,r.timeZone);if(!d){const w=y.createSyntaxTree(i.valueExpression);d=y.createFunction(w),i.cache.compiledFunc=d}p=y.executeFunction(d,v)}else l&&(p=l[c]||0);return p=typeof p!="number"||isNaN(p)?null:n+o*p,p}function GHe(t,e,r){const i=typeof e=="number",s=i?null:e,n=s==null?void 0:s.attributes;let o=i?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const u=r!=null?r.scale:void 0,d=r!=null?r.view:void 0;o=u==null||d==="3d"?jHe(t):u}else if(!i)switch(t.inputValueType){case cm.Expression:{if((r==null?void 0:r.arcade)==null)return void ay.error("Use of arcade expressions requires an arcade context");const u={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},d=r.arcade.arcadeUtils,p=d.getViewInfo(u),g=d.createExecContext(s,p,r.timeZone);if(!l){const y=d.createSyntaxTree(t.valueExpression);l=d.createFunction(y),t.cache.compiledFunc=l}o=d.executeFunction(l,g);break}case cm.Field:n&&(o=n[t.field]);break;case cm.Unknown:o=null}if(!s3(o))return null;if(i||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return s3(c)&&c!==0?o/c:null}function jHe(t){let e=null,r=null;const i=t.stops;return i?(e=i[0].value,r=i[i.length-1].value):(e=t.minDataValue||0,r=t.maxDataValue||0),(e+r)/2}function IN(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void ay.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=Yye(GHe(i,e,r),i,e,r,i.cache.ipData);return s==null||isNaN(s)?0:s}function Pl(t,e,r){return t==null?null:BHe(t)?IN(t,e,r):s3(t)?t:null}function Wye(t,e,r){return s3(r)&&t>r?r:s3(e)&&t<e?e:t}function HHe(t,e,r,i){return t+((Pl(e.minSize,r,i)||e.minDataValue)??0)}function qHe(t,e,r){const i=t.stops;let s=(i==null?void 0:i.length)&&i[0].size;return s==null&&(s=t.minSize),Pl(s,e,r)}function WHe(t,e,r,i){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=Pl(e.minSize,r,i),o=Pl(e.maxSize,r,i),a=i!=null?i.shape:void 0;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?LM*(n/2)**2:n*n,u=c+s*((l?LM*(o/2)**2:o*o)-c);return l?2*Math.sqrt(u/LM):Math.sqrt(u)}return n+s*(o-n)}function YHe(t,e,r,i){const s=i!=null?i.shape:void 0,n=t/e.minDataValue,o=Pl(e.minSize,r,i),a=Pl(e.maxSize,r,i);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,Wye(l,o,a)}function XHe(t,e,r,i,s){var l,c,u;const[n,o,a]=qj(t,s);if(n===o)return Pl((l=e.stops)==null?void 0:l[n].size,r,i);{const d=Pl((c=e.stops)==null?void 0:c[n].size,r,i);return d+(Pl((u=e.stops)==null?void 0:u[o].size,r,i)-d)*a}}function ZHe(t,e,r,i){const s=((i==null?void 0:i.resolution)??1)*i2[e.valueUnit],n=Pl(e.minSize,r,i),o=Pl(e.maxSize,r,i),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/LM)/s:a==="radius"||a==="distance"?2*t/s:t/s,Wye(l,n,o)}function Yye(t,e,r,i,s){switch(e.transformationType){case Ro.Additive:return HHe(t,e,r,i);case Ro.Constant:return qHe(e,r,i);case Ro.ClampedLinear:return WHe(t,e,r,i);case Ro.Proportional:return YHe(t,e,r,i);case Ro.Stops:return XHe(t,e,r,i,s);case Ro.RealWorldSize:return ZHe(t,e,r,i);case Ro.Identity:return t;case Ro.Unknown:return null}}function JHe(t,e,r){const{isScaleDriven:i}=t.cache;if(!(i&&r==="3d"||e))return null;const s={scale:e,view:r};let n=Pl(t.minSize,xQ,s),o=Pl(t.maxSize,xQ,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function Hj(t,e,r){if(!t.visualVariables)return;const i=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=jye(l,e,r);i.push({variable:l,value:c})}),n.forEach(l=>{const c=Hye(l,e,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=qye(l,e,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=IN(l,e,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function qj(t,e){if(!e)return;let r=0,i=e.length-1;return e.some((s,n)=>t<s?(i=n,!0):(r=n,!1)),[r,i,(t-e[r])/(e[i]-e[r])]}function QHe(t,e,r){const i=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":IN(s,e,r);switch(s.axis){case"width":i[0]=n;break;case"depth":i[1]=n;break;case"height":i[2]=n;break;case"width-and-depth":i[0]=n,i[1]=n;break;case"all":case void 0:case null:i[0]=n,i[1]=n,i[2]=n;break;default:s.axis}}return i}const u2t=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:QHe,getColor:jye,getOpacity:Hye,getRotationAngle:qye,getSize:IN,getSizeForValue:Yye,getSizeFromNumberOrVariable:Pl,getSizeRangeAtScale:JHe,getVisualVariableValues:Hj,viewScaleRE:VHe},Symbol.toStringTag,{value:"Module"}));function LN(t,e){if(!t||t.symbol)return null;const r=e==null?void 0:e.renderer;return t&&r!=null&&r.getObservationRenderer?r.getObservationRenderer(t):r}function KHe(t,e){if(t.symbol!=null)return t.symbol;const r=LN(t,e);return r!=null&&r.type!=="dot-density"?r.getSymbol(t,e):null}function h2t(t,e){const r=LN(t,e),i=KHe(t,e);if(i==null)return null;const s={renderer:r,symbol:i};if(r==null||!("visualVariables"in r)||!r.visualVariables)return s;const n=Hj(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=u;break;case"depth":o[1]=u;break;case"height":o[2]=u;break;case"width-and-depth":o[0]=o[1]=u;break;default:o[0]=o[1]=o[2]=u}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function eqe(t,e){if(t.symbol!=null)return t.symbol;const r=LN(t,e);return r!=null?r.getSymbolAsync(t,e):null}async function d2t(t,e){const r=LN(t,e),i=await eqe(t,e);if(!i)return null;const s={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return s;const n=Hj(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=qe.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=u:c==="depth"?o[1]=u:c==="height"?o[2]=u:o[0]=o[1]=c==="width-and-depth"?u:o[2]=u}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function tqe(t,e=0){const r=t[e];return typeof r=="number"&&isFinite(r)?r:null}function rqe(t){for(let e=0;e<3;e++){const r=t[e];if(typeof r=="number")return isFinite(r)?r:0}return 0}function iqe(t,e,r,i){const s=(o=>!Array.isArray(o[0]))(e)?(o,a)=>e[3*o+a]:(o,a)=>e[o][a],n=i?qo(i)/A$(i):1;return DV(t,(o,a)=>se(o,s(a,0)*n,s(a,1)*n,s(a,2)),r)}function Xye(t,e,r){const i=iqe(TQ,t,e,r)?TQ:[0,0,1];return Math.abs(i[2])>Math.cos(At(80))?ki.Z:Math.abs(i[1])>Math.abs(i[0])?ki.Y:ki.X}const TQ=wr();function sqe(t,e,r){const i=Xye(t,(e.length>0?e[0]:t.length/3)-1,r);if(i!==ki.Z){t=t.slice();for(let s=0;s<t.length;s+=3)t[s+i]=t[s+2]}return c2(t,e,3)}function SQ(t){const e=[[R.POSITION,new Ue(t.attributeData.position,t.indices,3,!0)]],r=gy(t.indices.length);return t.attributeData.colorFeature!=null?e.push([R.COLORFEATUREATTRIBUTE,new Ue([t.attributeData.colorFeature],r,1,!0)]):t.attributeData.color&&e.push([R.COLOR,new Ue(t.attributeData.color,r,4,!0)]),t.attributeData.uvMapSpace&&e.push([R.UVMAPSPACE,new Ue(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&e.push([R.BOUNDINGRECT,new Ue(t.attributeData.boundingRect,t.indices,9,!0)]),new Ds(t.material,e,t.mapPositions,Ki.Mesh,t.attributeData.objectAndLayerIdColor)}function EQ(t,e=null){const r=[[R.POSITION,new Ue(t.attributeData.position,t.indices,3,!0)],[R.UV0,new Ue(t.attributeData.uv0,t.indices,2,!0)]];return new Ds(t.material,r,t.mapPositions,Ki.Mesh,e)}function n3(t){switch(t.type){case"extent":if(t instanceof Xr)return Np.fromExtent(t);break;case"polygon":return t}return null}let DN=class{constructor(e,r,i){this.renderData=e,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array}};function NB(t,e,r){const i=Array.isArray(t),s=i?t.length/e:t.byteLength/(4*e),n=i?t:new Uint32Array(t,0,s*e),o=(r==null?void 0:r.minReduction)??0,a=(r==null?void 0:r.originalIndices)||null,l=a?a.length:0,c=(r==null?void 0:r.componentOffsets)||null;let u=0;if(c)for(let A=0;A<c.length-1;A++){const O=c[A+1]-c[A];O>u&&(u=O)}else u=s;const d=Math.floor(1.1*u)+1;(Ed==null||Ed.length<2*d)&&(Ed=new Uint32Array(Yoe(2*d)));for(let A=0;A<2*d;A++)Ed[A]=0;let p=0;const g=!!c&&!!a,y=g?l:s;let _=wI(s);const v=new Uint32Array(l),w=1.96;let x=o!==0?Math.ceil(4*w*w/(o*o)*o*(1-o)):y,T=1,S=c?c[1]:y;for(let A=0;A<y;A++){if(A===x){const U=1-p/A;if(U+w*Math.sqrt(U*(1-U)/A)<o)return null;x*=2}if(A===S){for(let U=0;U<2*d;U++)Ed[U]=0;if(a)for(let U=c[T-1];U<c[T];U++)v[U]=_[a[U]];S=c[++T]}const O=g?a[A]:A,$=O*e,D=aqe(n,$,e);let N=D%d,z=p;for(;Ed[2*N+1]!==0;){if(Ed[2*N]===D){const U=Ed[2*N+1]-1;if(nqe(n,$,U*e,e)){z=_[U];break}}N++,N>=d&&(N-=d)}z===p&&(Ed[2*N]=D,Ed[2*N+1]=O+1,p++),_[O]=z}if(o!==0&&1-p/s<o)return null;if(g){for(let A=c[T-1];A<v.length;A++)v[A]=_[a[A]];_=Pp(v)}const C=i?new Array(p):new Uint32Array(p*e);p=0;for(let A=0;A<y;A++)_[A]===p&&(oqe(n,(g?a[A]:A)*e,C,p*e,e),p++);if(a&&!g){const A=new Uint32Array(l);for(let O=0;O<A.length;O++)A[O]=_[a[O]];_=Pp(A)}return{buffer:Array.isArray(C)?C:C.buffer,indices:_,uniqueCount:p}}function nqe(t,e,r,i){for(let s=0;s<i;s++)if(t[e+s]!==t[r+s])return!1;return!0}function oqe(t,e,r,i,s){for(let n=0;n<s;n++)r[i+n]=t[e+n]}function aqe(t,e,r){let i=0;for(let s=0;s<r;s++)i=t[e+s]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let Ed=null;function f2t(t){const e=hA(t.rings,t.hasZ,jp.CCW_IS_HOLE,t.spatialReference),r=new Array;let i=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,u=Tu(e.position,3*c,3*l),d=a.holeIndices.map(g=>g-c),p=Pp(c2(u,d,3));r.push({position:u,faces:p}),i+=u.length,s+=p.length}const n=lqe(r,i,s),o=Array.isArray(n.position)?NB(n.position,3,{originalIndices:n.faces}):NB(n.position.buffer,6,{originalIndices:n.faces});return n.position=hme(new Float64Array(o.buffer)),n.faces=o.indices,n}function lqe(t,e,r){if(t.length===1)return t[0];const i=Pn(e),s=new Array(r);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)i[n++]=l.position[c];for(const c of l.faces)s[o++]=c+a;a=n/3}return{position:i,faces:Pp(s)}}function hA(t,e,r,i){const s=t.length,n=new Array(s),o=new Array(s),a=new Array(s);let l=0,c=0,u=0,d=0;for(let y=0;y<s;++y)d+=t[y].length;const p=Pn(3*d);let g=0;for(let y=s-1;y>=0;y--){const _=t[y],v=r===jp.CCW_IS_HOLE&&cqe(_,e,i);if(v&&s!==1)n[l++]=_;else{let w=_.length;for(let T=0;T<l;++T)w+=n[T].length;const x={index:g,pathLengths:new Array(l+1),count:w,holeIndices:new Array(l)};x.pathLengths[0]=_.length,_.length>0&&(a[u++]={index:g,count:_.length}),g=v?lO(_,_.length-1,-1,p,g,_.length,e):lO(_,0,1,p,g,_.length,e);for(let T=0;T<l;++T){const S=n[T];x.holeIndices[T]=g,x.pathLengths[T+1]=S.length,S.length>0&&(a[u++]={index:g,count:S.length}),g=lO(S,0,1,p,g,S.length,e)}l=0,x.count>0&&(o[c++]=x)}}for(let y=0;y<l;++y){const _=n[y];_.length>0&&(a[u++]={index:g,count:_.length}),g=lO(_,0,1,p,g,_.length,e)}return o.length=c,a.length=u,{position:p,polygons:o,outlines:a}}function lO(t,e,r,i,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];i[s++]=l[0],i[s++]=l[1],i[s++]=o?l[2]:0,e+=r}return s/3}function cqe(t,e,r){if(e){const i=t.length-1,s=Xye(t,i,r);if(s===ki.X)return!RP(t,ki.Y,ki.Z);if(s===ki.Y)return!RP(t,ki.X,ki.Z)}return!RP(t,ki.X,ki.Y)}var jp;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(jp||(jp={}));var JE,jI,FB;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(JE||(JE={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(jI||(jI={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(FB||(FB={}));var As,gu,QE,Ws;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(As||(As={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(gu||(gu={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(QE||(QE={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(Ws||(Ws={}));let uqe=class{constructor(e,r){this.vec3=e,this.id=r}};function HI(t,e,r,i){return new uqe(Te(t,e,r),i)}let CQ=class{constructor(){this._extent=Gt(),this.resolution=0,this.renderLocalOrigin=HI(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new hqe}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const r=.001*e.range;if(this._extent[0]-r<=e.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];U$(this._extent,e.range,0,i)}if(this._extent[2]+r>=e.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];U$(this._extent,-e.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,ym(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const r=this.canvasGeometries.extents[e];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}},hqe=class{constructor(){this.extents=[Gt(),Gt(),Gt()],this.numViews=0}};var Ei;(function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.WaterNormal=3]="WaterNormal",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(Ei||(Ei={}));let dqe=class{constructor(e,r){this._fbos=e,this._format=r}get valid(){return this._handle!=null}dispose(){this._handle=Zt(this._handle)}get texture(){var e;return(e=this._handle)==null?void 0:e.colorTexture}bind(e,r,i){var s,n;this._handle&&this._handle.fbo.width===r&&this._handle.fbo.height===i||((s=this._handle)==null||s.release(),this._handle=this._fbos.acquire(this._format,r,i)),e.bindFramebuffer((n=this._handle)==null?void 0:n.fbo)}generateMipMap(){var e,r,i,s,n;(i=(r=(e=this._handle)==null?void 0:e.colorTexture)==null?void 0:r.descriptor)!=null&&i.hasMipmap&&((n=(s=this._handle)==null?void 0:s.colorTexture)==null||n.generateMipmap())}},gb=class{constructor(e,r,i,s=cr.RGBA_MIPMAP){this.output=r,this.content=i,this.fbo=new dqe(e,s)}get valid(){return this.fbo.valid}},pqe=class{constructor(e){this.targets=[new gb(e,L.Color,Ei.Color),new gb(e,L.Color,Ei.ColorNoRasterImage),new gb(e,L.Highlight,Ei.Highlight,cr.RGBA4),new gb(e,L.Normal,Ei.WaterNormal),new gb(e,L.Color,Ei.Occluded)],te("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new gb(e,L.ObjectAndLayerIdColor,Ei.ObjectAndLayerIdColor))}getTexture(e){var r;return(r=this.targets[e])==null?void 0:r.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce((e,r,i)=>r.valid?e|=1<<i:e,0)}},Wj=class extends I0e{constructor(){super(...arguments),this.slicePlaneLocalOrigin=E(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var Tl;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(Tl||(Tl={}));let fqe=class extends Wj{constructor(){super(...arguments),this.identifier=Tl.Material,this.output=L.Color,this.transparent=!1}},mqe=class extends Wj{constructor(){super(...arguments),this.identifier=Tl.ShadowMap}},gqe=class extends Wj{constructor(){super(...arguments),this.identifier=Tl.Highlight}};function yqe(t){t.fragment.code.add(b`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function _qe(t){t.fragment.code.add(b`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function vqe(t,e){const r=t.fragment;r.include(Nu),r.uniforms.add(new Ir("nearFar",(i,s)=>s.camera.nearFar)),r.uniforms.add(new Ze("depthMap",(i,s)=>{var n;return(n=s.linearDepth)==null?void 0:n.colorTexture})),r.uniforms.add(new Li("proj",(i,s)=>s.camera.projectionMatrix)),r.uniforms.add(new Ee("invResolutionHeight",(i,s)=>1/s.camera.height)),r.uniforms.add(new Li("reprojectionMatrix",(i,s)=>s.ssr.reprojectionMatrix)),r.code.add(b`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function Zye(t,e){t.include(rje,e),t.include(XD),t.include(_qe),e.hasCloudsReflections&&t.include(dfe,e),e.hasScreenSpaceReflections&&t.include(vqe,e);const r=t.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(b`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add(new Ee("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Ee("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(b`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&r.code.add(b`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(r.uniforms.add(new Li("view",(i,s)=>s.camera.viewMatrix),new Ze("lastFrameColorTexture",(i,s)=>{var n;return(n=s.ssr.lastFrameColor)==null?void 0:n.colorTexture}),new Ee("fadeFactorSSR",(i,s)=>s.ssr.fadeFactor)),r.code.add(b`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(b`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?r.code.add(b`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(b`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(b`return waterRenderedColor;
}`)}let qI=class extends qi{constructor(e,r){super(e,"vec4",gr.Draw,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}};var wp;function bqe(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new qI("overlayTexOffset",(s,n)=>wqe(s,n)),new qI("overlayTexScale",(s,n)=>xqe(s,n))),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new Ze("ovColorTex",(s,n)=>UB(s,n))),Jye(t,e)}function CT(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new AQ("overlayTexOffset"),new AQ("overlayTexScale")),i.uniforms.add(new Ee("overlayOpacity",s=>s.overlayOpacity),new Ze("ovColorTex",(s,n)=>{var o;return(o=n.overlay)==null?void 0:o.getTexture(s.overlayContent)})),Jye(t,e)}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(wp||(wp={}));let AQ=class extends qi{constructor(e){super(e,"vec4")}};function Jye(t,e){e.pbrMode!==et.Water&&e.pbrMode!==et.WaterOnIntegratedMesh&&e.pbrMode!==et.TerrainWithWater||t.include(Zye,e);const{vertex:r,fragment:i}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(b`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(b`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(b`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(b`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==et.Water&&e.pbrMode!==et.WaterOnIntegratedMesh&&e.pbrMode!==et.TerrainWithWater||(Lm(i),Jp(i),i.code.add(b`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function UB(t,e){var r,i,s;return t.identifier===Tl.Material&&t.output===L.Color?(r=e.overlay)==null?void 0:r.getTexture(Ei.ColorNoRasterImage):t.identifier===Tl.Material&&t.output===L.ObjectAndLayerIdColor?(i=e.overlay)==null?void 0:i.getTexture(Ei.ObjectAndLayerIdColor):t.identifier===Tl.Highlight?(s=e.overlay)==null?void 0:s.getTexture(Ei.Highlight):null}function wqe(t,e){var s,n,o,a;const r=(n=(s=e.overlay)==null?void 0:s.overlays[As.INNER])==null?void 0:n.extent;F$(r)&&(mp[0]=t.toMapSpace[0]/Lo(r)-r[0]/Lo(r),mp[1]=t.toMapSpace[1]/ja(r)-r[1]/ja(r));const i=(a=(o=e.overlay)==null?void 0:o.overlays[As.OUTER])==null?void 0:a.extent;return F$(i)&&(mp[2]=t.toMapSpace[0]/Lo(i)-i[0]/Lo(i),mp[3]=t.toMapSpace[1]/ja(i)-i[1]/ja(i)),mp}function xqe(t,e){var s,n,o,a;const r=(n=(s=e.overlay)==null?void 0:s.overlays[As.INNER])==null?void 0:n.extent;F$(r)&&(mp[0]=t.toMapSpace[2]/Lo(r),mp[1]=t.toMapSpace[3]/ja(r));const i=(a=(o=e.overlay)==null?void 0:o.overlays[As.OUTER])==null?void 0:a.extent;return F$(i)&&(mp[2]=t.toMapSpace[2]/Lo(i),mp[3]=t.toMapSpace[3]/ja(i)),mp}const mp=Jt();let Qye=class extends Vr{constructor(){super(...arguments),this.color=Ot(1,1,1,1)}};function Tqe(){const t=new dr;return t.include(Wo),t.fragment.uniforms.add(new Ze("tex",e=>e.texture),new nr("uColor",e=>e.color)),t.fragment.code.add(b`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`),t}const Sqe=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Qye,build:Tqe},Symbol.toStringTag,{value:"Module"}));let Kye=class{constructor(e){this._context=e,this._perConstructorInstances=new B2,this._frameCounter=0,this._keepAliveFrameCount=RQ}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,r=Cqe){const i=r.key;let s=this._perConstructorInstances.get(e,i);if(s==null){const n=new e(this._context,r,()=>this.release(n));s=new Eqe(n),this._perConstructorInstances.set(e,i,s)}return++s.refCount,s.technique}releaseAndAcquire(e,r,i){if(i!=null){if(r.key===i.key)return i;this.release(i)}return this.acquire(e,r)}release(e){if(e==null||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(e.constructor,e.key);r!=null&&(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==RQ&&this._perConstructorInstances.forEach((e,r)=>{e.forEach((i,s)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,s))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((r,i)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};e.push(s(r,i))}),await Promise.all(e)}},Eqe=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const RQ=-1,Cqe=new Za;let e_e=class{constructor(e,r,i,s){this._textureRepository=e,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=s,this._id2glMaterialRef=new B2}dispose(){this._textureRepository.destroy()}acquire(e,r,i){if(this._ownMaterial(e),!e.produces(r,i))return null;let s=this._id2glMaterialRef.get(i,e.id);if(s==null){const n=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRepository:this._textureRepository,output:i});s=new Aqe(n),this._id2glMaterialRef.set(i,e.id,s)}return s.ref(),s.glMaterial}release(e,r){const i=this._id2glMaterialRef.get(r,e.id);i!=null&&(i.unref(),i.referenced||(Ke(i.glMaterial),this._id2glMaterialRef.delete(r,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&ne.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},Aqe=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,Je(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const Rqe=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];let kB=class DM{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,r){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new wn,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}destroy(){this._degenerateObjects.clear(),wn.clearPool(),BB[0]=null,Vy.prune(),z_.prune()}add(e,r=e.length){this._objectCount+=r,this._grow(e,r);const i=wn.acquire();for(let s=0;s<r;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(i.init(this._root),this._add(n,i))}wn.release(i)}remove(e,r=null){this._objectCount-=e.length;const i=wn.acquire();for(const s of e){const n=r??Gx(this.objectToBoundingSphere(s),Iqe);QS(n[3])?(i.init(this._root),this._remove(s,n,i)):this._degenerateObjects.delete(s)}wn.release(i),this._shrink()}update(e,r){if(!QS(r[3])&&this._isDegenerate(e))return;const i=$qe(e);this.remove(i,r),this.add(i)}forEachAlongRay(e,r,i){const s=$c(e,r);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(e,r,i,s){const n=$c(e,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),!0})}forEach(e){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(e),i.residents!==null&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,r,i,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=oF(e,r),u=d=>{if(--n,!s(d))return;const p=this.objectToBoundingSphere(d);if(!E0(i,p))return;const g=n0(e,r,p),y=g-p[3],_=g+p[3];y<o&&(o=y,a=_,l=d)};return this._forEachNodeDepthOrdered(this._root,d=>{if(n<=0||!E0(i,d.bounds)||(ee(Gc,c,d.halfSize),le(Gc,Gc,d.bounds),n0(e,r,Gc)>a))return!1;const p=d.node;return p.terminals.forAll(g=>u(g)),p.residents!==null&&p.residents.forAll(g=>u(g)),!0},e,r),l}forEachInDepthRange(e,r,i,s,n,o,a){let l=-1/0,c=1/0;const u={setRange:_=>{i===DM.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};u.setRange(s);const d=n0(r,i,e),p=oF(r,i),g=oF(r,-i),y=_=>{if(!a(_))return;const v=this.objectToBoundingSphere(_),w=v,x=n0(r,i,w)-d,T=x-v[3],S=x+v[3];T>c||S<l||!E0(o,v)||n(_,u)};this._forEachNodeDepthOrdered(this._root,_=>{if(!E0(o,_.bounds)||(ee(Gc,p,_.halfSize),le(Gc,Gc,_.bounds),n0(r,i,Gc)-d>c)||(ee(Gc,g,_.halfSize),le(Gc,Gc,_.bounds),n0(r,i,Gc)-d<l))return!1;const v=_.node;return v.terminals.forAll(w=>y(w)),v.residents!==null&&v.residents.forAll(w=>y(w)),!0},r,i)}forEachNode(e){this._forEachNode(this._root,r=>e(r.node,r.bounds,r.halfSize,r.depth))}forEachNeighbor(e,r){const i=im(r),s=r,n=l=>{const c=this.objectToBoundingSphere(l),u=im(c),d=i+u;return!(Yn(c,s)-d*d<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};this._forEachNode(this._root,l=>{const c=im(l.bounds),u=i+c;if(Yn(l.bounds,s)-u*u>0)return!1;const d=l.node;return d.terminals.forAll(a),o&&d.residents!==null&&d.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,r){return cO(r.bounds,2*-r.halfSize,nc),cO(r.bounds,2*r.halfSize,oc),OX(e.origin,e.direction,nc,oc)}_intersectsNodeWithOffset(e,r,i){return cO(r.bounds,2*-r.halfSize,nc),cO(r.bounds,2*r.halfSize,oc),i.applyToMinMax(nc,oc),OX(e.origin,e.direction,nc,oc)}_intersectsObject(e,r){const i=this.objectToBoundingSphere(r);return!(i[3]>0)||y9(i,e)}_intersectsObjectWithOffset(e,r,i){const s=this.objectToBoundingSphere(r);return!(s[3]>0)||y9(i.applyToBoundingSphere(s),e)}_forEachNode(e,r){let i=wn.acquire().init(e);const s=[i];for(;s.length!==0;){if(i=s.pop(),r(i)&&!i.isLeaf())for(let n=0;n<i.node.children.length;n++)i.node.children[n]&&s.push(wn.acquire().init(i).advance(n));wn.release(i)}}_forEachNodeDepthOrdered(e,r,i,s=DM.DepthOrder.FRONT_TO_BACK){let n=wn.acquire().init(e);const o=[n];for(Mqe(i,s,MQ);o.length!==0;){if(n=o.pop(),r(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=MQ[a];n.node.children[l]&&o.push(wn.acquire().init(n).advance(l))}wn.release(n)}}_remove(e,r,i){Vy.clear();const s=i.advanceTo(r,(n,o)=>{Vy.push(n.node),Vy.push(o)})?i.node.terminals:i.node.residents;if(s.removeUnordered(e),s.length===0)for(let n=Vy.length-2;n>=0;n-=2){const o=Vy.data[n],a=Vy.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let r=0;r<e.children.length;r++)if(e.children[r])return!1;return!0}_purge(e,r){return r>=0&&(e.children[r]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new It({shrink:!0})),!0)}_add(e,r){r.advanceTo(this.objectToBoundingSphere(e))?r.node.terminals.push(e):(r.node.residents.push(e),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(e){const r=e.node.residents;e.node.residents=null;for(let i=0;i<r.length;i++){const s=wn.acquire().init(e);this._add(r.at(i),s),wn.release(s)}}_grow(e,r){if(r!==0&&(OQ(e,r,i=>this.objectToBoundingSphere(i),pf),QS(pf[3])&&!this._fitsInsideTree(pf)))if(this._nodeIsEmpty(this._root.node))Gx(pf,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(pf);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(pf,i):this._growRootAsSubNode(i),wn.release(i)}}_rebuildTree(e,r){ie(lF,r.bounds),lF[3]=r.halfSize,OQ([e,lF],2,s=>s,cF);const i=wn.acquire().init(this._root);this._root.initFrom(null,cF,cF[3]),this._root.increaseHalfSize(1.25),this._forEachNode(i,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),wn.release(i)}_placingRootViolatesMaxDepth(e){const r=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,s=>(i=Math.max(i,s.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const r=e[3],i=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(i[l]-r),u=i[l]+r-(n[l]+o),d=Math.max(0,Math.ceil(c/(2*o))),p=Math.max(0,Math.ceil(u/(2*o)))+1,g=2**Math.ceil(Math.log(d+p)*Math.LOG2E);s=Math.max(s,g),uO[l].min=d,uO[l].max=p}for(let l=0;l<3;l++){let c=uO[l].min,u=uO[l].max;const d=(s-(c+u))/2;c+=Math.ceil(d),u+=Math.floor(d);const p=n[l]-o-c*o*2;aF[l]=p+(u+c)*o}const a=s*o;return aF[3]=a*r_e,wn.acquire().initFrom(null,aF,a,0)}_growRootAsSubNode(e){const r=this._root.node;ie(pf,this._root.bounds),pf[3]=this._root.halfSize,this._root.init(e),e.advanceTo(pf,null,!0),e.node.children=r.children,e.node.residents=r.residents,e.node.terminals=r.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const r=this._root.node.children;let i=0,s=0;for(;s<r.length&&e==null;)i=s++,e=r[i];for(;s<r.length;)if(r[s++])return-1;return i}_isDegenerate(e){return!QS(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const r=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=r[0]-i&&e[0]<=r[0]+i&&e[1]>=r[1]-i&&e[1]<=r[1]+i&&e[2]>=r[2]-i&&e[2]<=r[2]+i}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:r,_objectCount:i}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:r,objectCount:i,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(e){var n,o;const r=e.children.map(a=>a?this._nodeToJSON(a):null),i=(n=e.residents)==null?void 0:n.map(a=>this.objectToBoundingSphere(a)),s=(o=e.terminals)==null?void 0:o.map(a=>this.objectToBoundingSphere(a));return{children:r,residents:i,terminals:s}}static fromJSON(e){const r=new DM(i=>i,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return r._objectCount=e.objectCount,r._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),r}},wn=class fw{constructor(){this.bounds=ds(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,r,i,s=this.depth){return this.node=e??fw.createEmptyNode(),r!=null&&Gx(r,this.bounds),this.halfSize=i,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*r_e}advance(e){let r=this.node.children[e];r||(r=fw.createEmptyNode(),this.node.children[e]=r),this.node=r,this.halfSize/=2,this.depth++;const i=t_e[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,r,i=!1){for(;;){if(this.isTerminalFor(e))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);r&&r(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const r=this.bounds;return(r[0]<e[0]?1:0)+(r[1]<e[1]?2:0)+(r[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new It({shrink:!0}),residents:new It({shrink:!0})}}static acquire(){return fw._pool.acquire()}static release(e){fw._pool.release(e)}static clearPool(){fw._pool.prune()}};function Oqe(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function Pqe(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function cO(t,e,r){r[0]=t[0]+e,r[1]=t[1]+e,r[2]=t[2]+e}function OQ(t,e,r,i){if(e===1){const s=r(t[0]);Gx(s,i)}else{nc[0]=1/0,nc[1]=1/0,nc[2]=1/0,oc[0]=-1/0,oc[1]=-1/0,oc[2]=-1/0;for(let s=0;s<e;s++){const n=r(t[s]);QS(n[3])&&(Oqe(nc,n),Pqe(oc,n))}$r(i,nc,oc,.5),i[3]=Math.max(oc[0]-nc[0],oc[1]-nc[1],oc[2]-nc[2])/2}}function Mqe(t,e,r){if(!z_.length)for(let i=0;i<8;++i)z_.push({index:0,distance:0});for(let i=0;i<8;++i){const s=t_e[i];z_.data[i].index=i,z_.data[i].distance=n0(t,e,s)}z_.sort((i,s)=>i.distance-s.distance);for(let i=0;i<8;++i)r[i]=z_.data[i].index}function oF(t,e){let r,i=1/0;for(let s=0;s<8;++s){const n=n0(t,e,PQ[s]);n<i&&(i=n,r=PQ[s])}return r}function n0(t,e,r){return e*(t[0]*r[0]+t[1]*r[1]+t[2]*r[2])}function QS(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}wn._pool=new Vo(wn),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(kB||(kB={}));const t_e=[Te(-1,-1,-1),Te(1,-1,-1),Te(-1,1,-1),Te(1,1,-1),Te(-1,-1,1),Te(1,-1,1),Te(-1,1,1),Te(1,1,1)],PQ=[Te(-1,-1,-1),Te(-1,-1,1),Te(-1,1,-1),Te(-1,1,1),Te(1,-1,-1),Te(1,-1,1),Te(1,1,-1),Te(1,1,1)],r_e=Math.sqrt(3),BB=[null];function $qe(t){return BB[0]=t,BB}const aF=ds(),Gc=E(),nc=E(),oc=E(),Vy=new It,Iqe=ds(),pf=ds(),lF=ds(),cF=ds(),uO=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],z_=new It,MQ=[0,0,0,0,0,0,0,0],Gh=kB;var D0;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(D0||(D0={}));let i_e=class extends J3{get objects(){return this._objects}constructor(e,r,i=""){super(),this.stage=e,this.apiLayerUid=i,this.type=Ki.Layer,this.events=new Ps,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new It,this._objectsAdded=new It,this._handles=new Am,this.apiLayerUid=i,this.visible=(r==null?void 0:r.visible)??!0,this.pickable=(r==null?void 0:r.pickable)??!0,this.updatePolicy=(r==null?void 0:r.updatePolicy)??D0.ASYNC,this._disableOctree=(r==null?void 0:r.disableOctree)??!1,e.add(this);for(const s of Rqe)this._handles.add(this.events.on(s,n=>e.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const r of e)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const r=new Array;if(this._objects.removeUnorderedMany(e,e.length,r),r.length!==0){for(const i of r)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),this._octree!=null){for(let i=0;i<r.length;)this._objectsAdded.removeUnordered(r[i])?(r[i]=r[r.length-1],r.length-=1):++i;this._octree.remove(r)}}}sync(){this.updatePolicy!==D0.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,r){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,r)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new Gh(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=Oe(this._octree),this._objectsAdded.clear()}};function WI(t){return t!=null&&t.type===Ki.Layer}var Rc,fv;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(Rc||(Rc={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(fv||(fv={}));let _n=class extends ga{constructor(){super(...arguments),this.output=L.Color,this.transparencyPassType=Qe.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=Rc.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=fv.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===Rc.Draped}};h([F({count:L.COUNT})],_n.prototype,"output",void 0),h([F({count:Qe.COUNT})],_n.prototype,"transparencyPassType",void 0),h([F()],_n.prototype,"occluder",void 0),h([F()],_n.prototype,"hasSlicePlane",void 0),h([F()],_n.prototype,"writeDepth",void 0),h([F({count:Rc.COUNT})],_n.prototype,"space",void 0),h([F()],_n.prototype,"hideOnShortSegments",void 0),h([F()],_n.prototype,"hasCap",void 0),h([F({count:fv.COUNT})],_n.prototype,"anchor",void 0),h([F()],_n.prototype,"hasTip",void 0),h([F()],_n.prototype,"vvSize",void 0),h([F()],_n.prototype,"vvColor",void 0),h([F()],_n.prototype,"vvOpacity",void 0),h([F()],_n.prototype,"hasOccludees",void 0),h([F()],_n.prototype,"multipassEnabled",void 0),h([F()],_n.prototype,"cullAboveGround",void 0),h([F({constValue:!1})],_n.prototype,"occlusionPass",void 0),h([F({constValue:!0})],_n.prototype,"hasVvInstancing",void 0),h([F({constValue:!0})],_n.prototype,"hasSliceTranslatedView",void 0);const $Q=8;function s_e(t,e){const r=t.vertex;r.uniforms.add(new Ee("intrinsicWidth",i=>i.width)),e.vvSize?(t.attributes.add(R.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new Pt("vvSizeMinSize",i=>i.vvSize.minSize),new Pt("vvSizeMaxSize",i=>i.vvSize.maxSize),new Pt("vvSizeOffset",i=>i.vvSize.offset),new Pt("vvSizeFactor",i=>i.vvSize.factor)),r.code.add(b`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(R.SIZE,"float"),r.code.add(b`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(R.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new Va("vvOpacityValues",i=>i.vvOpacity.values,$Q),new Va("vvOpacityOpacities",i=>i.vvOpacity.opacityValues,$Q)),r.code.add(b`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(b`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(am,e),t.attributes.add(R.COLORFEATUREATTRIBUTE,"float"),r.code.add(b`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(R.COLOR,"vec4"),r.code.add(b`vec4 getColor(){
return applyOpacity(color);
}`))}function o3(t,e,r=0){const i=me(t,0,Nqe);for(let s=0;s<4;s++)e[r+s]=Math.floor(256*Fqe(i*Lqe[s]))}function Yj(t,e=0){let r=0;for(let i=0;i<4;i++)r+=t[e+i]*Dqe[i];return r}const Lqe=[1,256,65536,16777216],Dqe=[1/256,1/65536,1/16777216,1/4294967296],Nqe=Yj(new Uint8ClampedArray([255,255,255,255]));function Fqe(t){return t-Math.floor(t)}let n_e=class{constructor(e,r,i){this._createTexture=e,this._parametersKey=r,this._repository=new Map,this._orphanCache=i.newCache(`procedural-texture-repository:${bc()}`,s=>s.dispose())}destroy(){for(const[e,{texture:r}]of this._repository)r.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,r=null){const i=this._acquire(e);return this.release(r),i}release(e){if(e==null)return;const r=this._parametersKey(e),i=this._repository.get(r);if(i&&(i.refCount--,i.refCount===0)){this._repository.delete(r);const{texture:s}=i,n=s.gpuMemoryUsage;this._orphanCache.put(r,s,n)}}_acquire(e){if(e==null)return null;const r=this._parametersKey(e),i=this._repository.get(r);if(i)return i.refCount++,i.texture;const s=this._orphanCache.pop(r)??this._createTexture(e),n=new Uqe(s);return this._repository.set(r,n),s}},Uqe=class{constructor(e){this.texture=e,this.refCount=1}};function kqe(t,e){return new n_e(r=>{const{encodedData:i,textureSize:s}=Bqe(r),n=new Or;return n.internalFormat=ut.RGBA,n.width=s,n.height=1,n.wrapMode=Ft.REPEAT,new Rt(t,n,i)},r=>`${r.pattern.join(",")}-r${r.pixelRatio}`,e)}function Bqe(t){const e=Xj(t),r=1/t.pixelRatio,i=o_e(t),s=a_e(t),n=(Math.floor(.5*(s-1))+.5)*r,o=[];let a=1;for(const p of e){for(let g=0;g<p;g++){const y=a*(Math.min(g,p-1-g)+.5)*r/n*.5+.5;o.push(y)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],u=new Uint8Array(4*i);let d=0;for(const p of c)o3(p,u,d),d+=4;return{encodedData:u,textureSize:i}}function Xj(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function o_e(t){if(t==null)return 1;const e=Xj(t);return Math.floor(e.reduce((r,i)=>r+i))}function a_e(t){return Xj(t).reduce((e,r)=>Math.max(e,r))}function zqe(t){return t==null?Ec:t.length===4?t:Si(Vqe,t[0],t[1],t[2],1)}const Vqe=Jt();function Gqe(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?jqe(t,e):Hqe(t)}function jqe(t,e){const r=!(e.draped&&e.stipplePreferContinuous),{vertex:i,fragment:s}=t;s.include(zu),e.draped||(sd(i,e),i.uniforms.add(new Ee("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),i.code.add(b`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),t.varyings.add("vStippleDistanceLimits","vec2"),t.varyings.add("vStipplePatternStretch","float"),i.code.add(b`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${Wqe};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(b`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(b`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),N2(i),i.code.add(b`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),s.uniforms.add(new Ze("stipplePatternTexture",n=>n.stippleTexture),new Ee("stipplePatternSDFNormalizer",n=>qqe(n.stipplePattern)),new Ee("stipplePatternPixelSizeInv",n=>1/l_e(n))),s.code.add(b`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),e.stippleOffColorEnabled?(s.uniforms.add(new nr("stippleOffColor",n=>zqe(n.stippleOffColor))),s.code.add(b`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(b`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function Hqe(t){t.fragment.code.add(b`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function qqe(t){return t?(Math.floor(.5*(a_e(t)-1))+.5)/t.pixelRatio:1}function l_e(t){const e=t.stipplePattern;return e?o_e(t.stipplePattern)/e.pixelRatio:1}const Wqe=b.float(.4);async function Cm(t,e){const{data:r}=await Hi(t,{responseType:"image",...e});return r}function Yqe(){if(uF==null){const t=e=>ei(`esri/libs/basisu/${e}`);uF=he(()=>import("./basis_transcoder-d6c41342.js"),[],import.meta.url).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(r=>(r.initializeBasis(),delete r.then,r)))}return uF}let uF;var l1;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(l1||(l1={}));let Zh=null,hO=null;async function c_e(){return hO==null&&(hO=Yqe(),Zh=await hO),hO}function Xqe(t,e){if(Zh==null)return t.byteLength;const r=new Zh.BasisFile(new Uint8Array(t)),i=h_e(r)?u_e(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),i}function Zqe(t,e){if(Zh==null)return t.byteLength;const r=new Zh.KTX2File(new Uint8Array(t)),i=d_e(r)?u_e(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),i}function u_e(t,e,r,i,s){const n=wG(e?ns.COMPRESSED_RGBA8_ETC2_EAC:ns.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*i*n*o)}function h_e(t){return t.getNumImages()>=1&&!t.isUASTC()}function d_e(t){return t.getFaces()>=1&&t.isETC1S()}async function Jqe(t,e,r){Zh==null&&(Zh=await c_e());const i=new Zh.BasisFile(new Uint8Array(r));if(!h_e(i))return null;i.startTranscoding();const s=p_e(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(n,o)=>i.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>i.transcodeImage(a,0,n,o,0,0));return i.close(),i.delete(),s}async function Qqe(t,e,r){Zh==null&&(Zh=await c_e());const i=new Zh.KTX2File(new Uint8Array(r));if(!d_e(i))return null;i.startTranscoding();const s=p_e(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(n,o)=>i.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>i.transcodeImage(a,n,0,0,o,0,-1,-1));return i.close(),i.delete(),s}function p_e(t,e,r,i,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[u,d]=l?i?[l1.ETC2_RGBA,ns.COMPRESSED_RGBA8_ETC2_EAC]:[l1.ETC1_RGB,ns.COMPRESSED_RGB8_ETC2]:c?i?[l1.BC3_RGBA,ns.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[l1.BC1_RGB,ns.COMPRESSED_RGB_S3TC_DXT1_EXT]:[l1.RGBA32,ut.RGBA],p=e.hasMipmap?r:Math.min(1,r),g=[];for(let y=0;y<p;y++)g.push(new Uint8Array(o(y,u))),a(y,u,g[y]);return e.internalFormat=d,e.hasMipmap=g.length>1,e.samplingMode=e.hasMipmap?Dt.LINEAR_MIPMAP_LINEAR:Dt.LINEAR,e.width=s,e.height=n,new Rt(t,e,{type:"compressed",levels:g})}const dO=ne.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),Kqe=542327876,eWe=131072,tWe=4;function Zj(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function rWe(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const iWe=Zj("DXT1"),sWe=Zj("DXT3"),nWe=Zj("DXT5"),oWe=31,aWe=0,lWe=1,cWe=2,uWe=3,hWe=4,dWe=7,pWe=20,fWe=21;function mWe(t,e,r){const i=gWe(r,e.hasMipmap??!1);if(i==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:o,height:a}=i;return e.samplingMode=s.levels.length>1?Dt.LINEAR_MIPMAP_LINEAR:Dt.LINEAR,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=o,e.height=a,new Rt(t,e,s)}function gWe(t,e){const r=new Int32Array(t,0,oWe);if(r[aWe]!==Kqe)return dO.error("Invalid magic number in DDS header"),null;if(!(r[pWe]&tWe))return dO.error("Unsupported format, must contain a FourCC code"),null;const i=r[fWe];let s,n;switch(i){case iWe:s=8,n=ns.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case sWe:s=16,n=ns.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case nWe:s=16,n=ns.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return dO.error("Unsupported FourCC code:",rWe(i)),null}let o=1,a=r[hWe],l=r[uWe];!(3&a)&&!(3&l)||(dO.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let d,p;r[cWe]&eWe&&e!==!1&&(o=Math.max(1,r[dWe]));let g=r[lWe]+4;const y=[];for(let _=0;_<o;++_)p=(a+3>>2)*(l+3>>2)*s,d=new Uint8Array(t,g,p),y.push(d),g+=p,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:n,width:c,height:u}}let Nv=class extends J3{get parameters(){return this._parameters}constructor(e,r){super(),this._data=e,this.type=Ki.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new Ps,this._parameters={..._We,...r},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?(this.frameUpdate=r=>this._frameUpdate(e,r),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(TC(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const r=!e.paused;if(e.src=e.src,r&&e.autoplay){const i=()=>{e.removeEventListener("canplay",i),e.play()};e.addEventListener("canplay",i)}}}_startPreloadImageElement(e){qp(e.src)||TC(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const r=new Or;return r.wrapMode=this._parameters.wrap??Ft.REPEAT,r.flipped=!this._parameters.noUnpackFlip,r.samplingMode=this._parameters.mipmap?Dt.LINEAR_MIPMAP_LINEAR:Dt.LINEAR,r.hasMipmap=!!this._parameters.mipmap,r.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,r.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),r}get glTexture(){return this._glTexture}get memoryEstimate(){var e;return((e=this._glTexture)==null?void 0:e.gpuMemoryUsage)||yWe(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const r=this._data;return r==null?(this._glTexture=new Rt(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),typeof r=="string"?this._loadFromURL(e,r):r instanceof Image?this._loadFromImageElement(e,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(e,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(e,r):(YT(r)||p0(r))&&this._parameters.encoding===sm.DDS_ENCODING?this._loadFromDDSData(e,r):(YT(r)||p0(r))&&this._parameters.encoding===sm.KTX2_ENCODING?this._loadFromKTX2(e,r):(YT(r)||p0(r))&&this._parameters.encoding===sm.BASIS_ENCODING?this._loadFromBasis(e,r):p0(r)?this._loadFromPixelData(e,r):YT(r)?this._loadFromPixelData(e,new Uint8Array(r)):null)}_frameUpdate(e,r){return this._glTexture==null||e.readyState<KE.HAVE_CURRENT_DATA||r===e.currentTime?r:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,r){return this._glTexture=mWe(e,this._createDescriptor(e),r),this._glTexture}_loadFromKTX2(e,r){return this._loadAsync(()=>Qqe(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(e,r){return this._loadAsync(()=>Jqe(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(e,r){Je(this._parameters.width>0&&this._parameters.height>0);const i=this._createDescriptor(e);return i.pixelFormat=this._parameters.components===1?ut.LUMINANCE:this._parameters.components===3?ut.RGB:ut.RGBA,i.width=this._parameters.width??0,i.height=this._parameters.height??0,this._glTexture=new Rt(e,i,r),this._glTexture}_loadFromURL(e,r){return this._loadAsync(async i=>{const s=await Cm(r,{signal:i});return wt(i),this._loadFromImage(e,s)})}_loadFromImageElement(e,r){return r.complete?this._loadFromImage(e,r):this._loadAsync(async i=>{const s=await Jne(r,r.src,!1,i);return wt(i),this._loadFromImage(e,s)})}_loadFromVideoElement(e,r){return r.readyState>=KE.HAVE_CURRENT_DATA?this._loadFromImage(e,r):this._loadFromVideoElementAsync(e,r)}_loadFromVideoElementAsync(e,r){return this._loadAsync(i=>new Promise((s,n)=>{const o=()=>{r.removeEventListener("loadeddata",a),r.removeEventListener("error",l),di(c)},a=()=>{r.readyState>=KE.HAVE_CURRENT_DATA&&(o(),s(this._loadFromImage(e,r)))},l=u=>{o(),n(u||new X("Failed to load video"))};r.addEventListener("loadeddata",a),r.addEventListener("error",l);const c=Uo(i,()=>l(ur()))}))}_loadFromImage(e,r){let i=r;if(!(i instanceof HTMLVideoElement)){const{maxTextureSize:o}=e.parameters;i=this._parameters.downsampleUncompressed?s8e(i,o):n8e(i,o)}const s=f_e(i);this._parameters.width=s.width,this._parameters.height=s.height;const n=this._createDescriptor(e);return n.pixelFormat=this._parameters.components===3?ut.RGB:ut.RGBA,n.width=s.width,n.height=s.height,this._glTexture=new Rt(e,n,i),this._glTexture}_loadAsync(e){const r=new AbortController;this._loadingController=r;const i=e(r.signal);this._loadingPromise=i;const s=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(s,s),i}unload(){if(this._glTexture=Ke(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function yWe(t,e){if(t==null)return 0;if(YT(t)||p0(t))return e.encoding===sm.KTX2_ENCODING?Zqe(t,!!e.mipmap):e.encoding===sm.BASIS_ENCODING?Xqe(t,!!e.mipmap):t.byteLength;const{width:r,height:i}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?f_e(t):e;return(e.mipmap?4/3:1)*r*i*(e.components||4)||0}function f_e(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var KE;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(KE||(KE={}));const _We={wrap:{s:Ft.REPEAT,t:Ft.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1},YI=128,Jj=.5;function vWe(t){return t==="cross"||t==="x"}function bWe(t,e=YI,r=e*Jj,i=0){const s=m_e(t,e,r,i);return new Nv(s,{mipmap:!1,wrap:{s:Ft.CLAMP_TO_EDGE,t:Ft.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0,reloadable:!0})}function m_e(t,e=YI,r=e*Jj,i=0){switch(t){case"circle":default:return wWe(e,r);case"square":return xWe(e,r);case"cross":return SWe(e,r,i);case"x":return EWe(e,r,i);case"kite":return TWe(e,r);case"triangle":return CWe(e,r);case"arrow":return AWe(e,r)}}function wWe(t,e){const r=t/2-.5;return dA(t,__e(r,r,e/2))}function xWe(t,e){return g_e(t,e,!1)}function TWe(t,e){return g_e(t,e,!0)}function SWe(t,e,r=0){return y_e(t,e,!1,r)}function EWe(t,e,r=0){return y_e(t,e,!0,r)}function CWe(t,e){return dA(t,v_e(t/2,e,e/2))}function AWe(t,e){const r=e,i=e/2,s=t/2,n=.8*r,o=__e(s,(t-e)/2-n,Math.sqrt(n*n+i*i)),a=v_e(s,r,i);return dA(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function g_e(t,e,r){return r&&(e/=Math.SQRT2),dA(t,(i,s)=>{let n=i-.5*t+.25,o=.5*t-s-.75;if(r){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function y_e(t,e,r,i=0){e-=i,r&&(e*=Math.SQRT2);const s=.5*e;return dA(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(r){const u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=i/2,a})}function __e(t,e,r){return(i,s)=>{const n=i-t,o=s-e;return Math.sqrt(n*n+o*o)-r}}function v_e(t,e,r){const i=Math.sqrt(e*e+r*r);return(s,n)=>{const o=Math.abs(s-t)-r,a=n-t+e/2+.75,l=(e*o+r*a)/i,c=-a;return Math.max(l,c)}}function dA(t,e){const r=new Uint8Array(4*t*t);for(let i=0;i<t;i++)for(let s=0;s<t;s++){const n=s+t*i;let o=e(s,i);o=o/t+.5,o3(o,r,4*n)}return r}const N1=64,Qj=N1/2,b_e=Qj/5,RWe=N1/b_e,OWe=.25;function PWe(t,e){const r=m_e(t,N1,Qj,b_e),i=new Or;return i.internalFormat=ut.RGBA,i.width=N1,i.height=N1,i.wrapMode=Ft.CLAMP_TO_EDGE,new Rt(e,i,r)}function w_e(t,e){const{vertex:r,constants:i}=t;i.add("markerSizePerLineWidth","float",RWe),N2(r),r.uniforms.get("markerScale")==null&&r.constants.add("markerScale","float",1),r.code.add(b`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===Rc.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new Ee("perRenderPixelRatio",(s,n)=>n.camera.perRenderPixelRatio)),r.code.add(b`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var Su;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(Su||(Su={}));let Yi=class extends ga{constructor(){super(...arguments),this.output=L.Color,this.capType=Su.BUTT,this.transparencyPassType=Qe.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};h([F({count:L.COUNT})],Yi.prototype,"output",void 0),h([F({count:Su.COUNT})],Yi.prototype,"capType",void 0),h([F({count:Qe.COUNT})],Yi.prototype,"transparencyPassType",void 0),h([F()],Yi.prototype,"occluder",void 0),h([F()],Yi.prototype,"hasSlicePlane",void 0),h([F()],Yi.prototype,"hasPolygonOffset",void 0),h([F()],Yi.prototype,"writeDepth",void 0),h([F()],Yi.prototype,"draped",void 0),h([F()],Yi.prototype,"stippleEnabled",void 0),h([F()],Yi.prototype,"stippleOffColorEnabled",void 0),h([F()],Yi.prototype,"stipplePreferContinuous",void 0),h([F()],Yi.prototype,"roundJoins",void 0),h([F()],Yi.prototype,"applyMarkerOffset",void 0),h([F()],Yi.prototype,"vvSize",void 0),h([F()],Yi.prototype,"vvColor",void 0),h([F()],Yi.prototype,"vvOpacity",void 0),h([F()],Yi.prototype,"falloffEnabled",void 0),h([F()],Yi.prototype,"innerColorEnabled",void 0),h([F()],Yi.prototype,"hasOccludees",void 0),h([F()],Yi.prototype,"multipassEnabled",void 0),h([F()],Yi.prototype,"cullAboveGround",void 0),h([F()],Yi.prototype,"wireframe",void 0),h([F()],Yi.prototype,"objectAndLayerIdColorInstanced",void 0),h([F({constValue:!1})],Yi.prototype,"occlusionPass",void 0),h([F({constValue:!0})],Yi.prototype,"hasVvInstancing",void 0),h([F({constValue:!0})],Yi.prototype,"hasSliceTranslatedView",void 0);const XI=1;function MWe(t){const e=new dr,{vertex:r,fragment:i}=e,s=t.multipassEnabled&&(t.output===L.Color||t.output===L.Alpha);e.include(W3),e.include(s_e,t),e.include(Gqe,t);const n=t.applyMarkerOffset&&!t.draped;n&&(r.uniforms.add(new Ee("markerScale",g=>g.markerScale)),e.include(w_e,{space:Rc.World,draped:!1})),t.output===L.Depth&&e.include(Em,t),e.include(rA,t),Rl(r,t),r.uniforms.add(new Li("inverseProjectionMatrix",(g,y)=>y.camera.inverseProjectionMatrix),new Ir("nearFar",(g,y)=>y.camera.nearFar),new Ee("miterLimit",g=>g.join!=="miter"?0:g.miterLimit),new nr("viewport",(g,y)=>y.camera.fullViewport)),r.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.SUBDIVISIONFACTOR,"float"),e.attributes.add(R.UV0,"vec2"),e.attributes.add(R.AUXPOS1,"vec3"),e.attributes.add(R.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),Q0(e),s&&e.varyings.add("depth","float");const o=t.stippleEnabled;o&&e.varyings.add("vLineSizeInv","float");const a=t.capType===Su.ROUND,l=o||a;l&&e.varyings.add("vLineWidth","float");const c=t.innerColorEnabled||a;c&&e.varyings.add("vLineDistance","float");const u=t.stippleEnabled&&a,d=t.falloffEnabled||u;d&&e.varyings.add("vLineDistanceNorm","float"),a&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),r.code.add(b`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(b`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),KD(e),r.code.add(b`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${s?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),N2(r),r.code.add(b`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${l?b`vLineWidth = lineWidth;`:""}
      ${o?b`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),n&&r.code.add(b`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),r.code.add(b`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||a)&&r.code.add(b`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${a?b`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(b`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?r.code.add(b`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?b`min(1.0, subdivisionFactor * ${b.float((XI+2)/(XI+1))})`:b`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(b`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const p=t.capType!==Su.BUTT;return r.code.add(b`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${p?b`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(b`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${d||c?b`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?b`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${d?b`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),a&&r.code.add(b`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?r.uniforms.add(new Ee("worldToScreenRatio",(g,y)=>1/y.screenToPCSRatio)):r.code.add(b`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(b`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?r.code.add(b`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(b`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Ee("stipplePatternPixelSize",g=>l_e(g))),r.code.add(b`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),r.code.add(b`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),s&&e.include(Nl,t),e.include(us,t),i.include(tf),i.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${s?"terrainDepthTest(depth);":""}
  `),t.wireframe?i.code.add(b`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(a&&i.code.add(b`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${b.float(qn)}) {
        discard;
      }
    `),u?i.code.add(b`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${b.float(qn)}, stippleCoverage);
      `):i.code.add(b`float stippleAlpha = getStippleAlpha();`),t.output!==L.ObjectAndLayerIdColor&&i.code.add(b`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),i.uniforms.add(new nr("intrinsicColor",g=>g.color)),i.code.add(b`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(i.uniforms.add(new nr("innerColor",g=>g.innerColor??g.color),new Ee("innerWidth",(g,y)=>g.innerWidth*y.camera.pixelRatio)),i.code.add(b`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),i.code.add(b`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(i.uniforms.add(new Ee("falloff",g=>g.falloff)),i.code.add(b`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),i.code.add(b`
    ${t.output===L.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${b.float(qn)}) {
      discard;
    }

    ${t.output===L.Alpha?b`fragColor = vec4(finalColor.a);`:""}
    ${t.output===L.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===L.Color&&t.transparencyPassType===Qe.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===L.Highlight?b`fragColor = vec4(1.0);`:""}
    ${t.output===L.Depth?b`outputDepth(linearDepth);`:""}
    ${t.output===L.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const $We=Object.freeze(Object.defineProperty({__proto__:null,build:MWe,ribbonlineNumRoundJoinSubdivisions:XI},Symbol.toStringTag,{value:"Module"})),x_e=new Map([[R.POSITION,0],[R.SUBDIVISIONFACTOR,1],[R.UV0,2],[R.AUXPOS1,3],[R.AUXPOS2,4],[R.COLOR,5],[R.COLORFEATUREATTRIBUTE,5],[R.SIZE,6],[R.SIZEFEATUREATTRIBUTE,6],[R.OPACITYFEATUREATTRIBUTE,7],[R.OBJECTANDLAYERIDCOLOR,8]]);let T_e=class S_e extends Sr{initializeProgram(e){return new vr(e.rctx,S_e.shader.get().build(this.configuration),x_e)}_makePipelineState(e,r){const i=this.configuration,s=e===Qe.NONE,n=e===Qe.FrontFace;return Et({blending:i.output===L.Color||i.output===L.Alpha?s?Ac:Bm(e):null,depthTest:{func:vy(e)},depthWrite:s?i.writeDepth?Xa:null:vN(e),colorWrite:Ut,stencilWrite:i.hasOccludees?Gp:null,stencilTest:i.hasOccludees?r?ny:by:null,polygonOffset:s||n?i.hasPolygonOffset?IQ:null:wN})}initializePipeline(){const e=this.configuration;if(e.occluder){const r=e.hasPolygonOffset?IQ:null;this._occluderPipelineTransparent=Et({blending:Ac,polygonOffset:r,depthTest:zI,depthWrite:null,colorWrite:Ut,stencilWrite:null,stencilTest:F0e}),this._occluderPipelineOpaque=Et({blending:Ac,polygonOffset:r,depthTest:zI,depthWrite:null,colorWrite:Ut,stencilWrite:D0e,stencilTest:N0e}),this._occluderPipelineMaskWrite=Et({blending:null,polygonOffset:r,depthTest:Oj,depthWrite:null,colorWrite:null,stencilWrite:Gp,stencilTest:ny})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Qt.LINES:Qt.TRIANGLE_STRIP}getPipeline(e,r,i){return e?this._occludeePipelineState:this.configuration.occluder?i?this._occluderPipelineTransparent:r?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};T_e.shader=new _r($We,()=>he(()=>import("./RibbonLine.glsl-17a6cb48.js"),[],import.meta.url));const IQ={factor:0,units:-4};var hl;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(hl||(hl={}));let Hw=class extends yy{constructor(e){super(e,new LWe),this._configuration=new Yi,this._vertexAttributeLocations=x_e}getConfiguration(e,r){this._configuration.output=e,this._configuration.draped=r.slot===oe.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null&&e!==L.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&NWe(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Ti.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.attributes.get(R.POSITION).data,l=e.attributes.get(R.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const _=e.attributes.get(R.SIZEFEATUREATTRIBUTE).data[0];c*=me(this.parameters.vvSize.offset[0]+_*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=s[0],d=s[1],p=(c/2+4)*e.screenToWorldRatio;let g=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],w=a[_+1],x=u-v,T=d-w,S=a[_+3]-v,C=a[_+4]-w,A=me((S*x+C*T)/(S*S+C*C),0,1),O=S*A-x,$=C*A-T,D=O*O+$*$;D<g&&(g=D,y=_/3)}g<p*p&&n(o.dist,o.normal,y,!1)}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!Npe(r))return void ne.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes,l=a.get(R.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const x=a.get(R.SIZEFEATUREATTRIBUTE).data[0];c*=me(this.parameters.vvSize.offset[0]+x*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(R.SIZE)&&(c*=a.get(R.SIZE).data[0]);const u=i.camera,d=FWe;Ns(d,i.point);const p=c*u.pixelRatio/2+4*u.pixelRatio;se(AT[0],d[0]-p,d[1]+p,0),se(AT[1],d[0]+p,d[1]+p,0),se(AT[2],d[0]+p,d[1]-p,0),se(AT[3],d[0]-p,d[1]-p,0);for(let x=0;x<4;x++)if(!u.unprojectFromRenderScreen(AT[x],ff[x]))return;$o(u.eye,ff[0],ff[1],dF),$o(u.eye,ff[1],ff[2],pF),$o(u.eye,ff[2],ff[3],fF),$o(u.eye,ff[3],ff[0],mF);let g=Number.MAX_VALUE,y=0;const _=E_e(this.parameters,a)?l.length-2:l.length-5;for(let x=0;x<_;x+=3){Ta[0]=l[x]+r[12],Ta[1]=l[x+1]+r[13],Ta[2]=l[x+2]+r[14];const T=(x+3)%l.length;if(Sa[0]=l[T]+r[12],Sa[1]=l[T+1]+r[13],Sa[2]=l[T+2]+r[14],Wr(dF,Ta)<0&&Wr(dF,Sa)<0||Wr(pF,Ta)<0&&Wr(pF,Sa)<0||Wr(fF,Ta)<0&&Wr(fF,Sa)<0||Wr(mF,Ta)<0&&Wr(mF,Sa)<0)continue;if(u.projectToRenderScreen(Ta,jy),u.projectToRenderScreen(Sa,Hy),jy[2]<0&&Hy[2]>0){ce(Cd,Ta,Sa);const C=u.frustum,A=-Wr(C[ri.NEAR],Ta)/de(Cd,C[ri.NEAR]);ee(Cd,Cd,A),le(Ta,Ta,Cd),u.projectToRenderScreen(Ta,jy)}else if(jy[2]>0&&Hy[2]<0){ce(Cd,Sa,Ta);const C=u.frustum,A=-Wr(C[ri.NEAR],Sa)/de(Cd,C[ri.NEAR]);ee(Cd,Cd,A),le(Sa,Sa,Cd),u.projectToRenderScreen(Sa,Hy)}else if(jy[2]<0&&Hy[2]<0)continue;jy[2]=0,Hy[2]=0;const S=$V(O1(jy,Hy,NQ),d);S<g&&(g=S,ie(LQ,Ta),ie(DQ,Sa),y=x/3)}const v=i.rayBegin,w=i.rayEnd;if(g<p*p){let x=Number.MAX_VALUE;if(ehe(O1(LQ,DQ,NQ),O1(v,w,UWe),Gy)){ce(Gy,Gy,v);const T=_e(Gy);ee(Gy,Gy,1/T),x=T/hi(v,w)}o(x,Gy,y,!1)}}get _layout(){const e=Ci().vec3f(R.POSITION).f32(R.SUBDIVISIONFACTOR).vec2f(R.UV0).vec3f(R.AUXPOS1).vec3f(R.AUXPOS2);return this.parameters.vvSize?e.f32(R.SIZEFEATUREATTRIBUTE):e.f32(R.SIZE),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4f(R.COLOR),this.parameters.vvOpacity&&e.f32(R.OPACITYFEATUREATTRIBUTE),te("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new DWe(this._layout,this.parameters)}produces(e,r){return r===L.Color||r===L.Alpha||r===L.Highlight||r===L.Depth||r===L.ObjectAndLayerIdColor?e===oe.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Ti.OccludeAndTransparentStencil?e===oe.OPAQUE_MATERIAL||e===oe.OCCLUDER_MATERIAL||e===oe.TRANSPARENT_OCCLUDER_MATERIAL:r===L.Color||r===L.Alpha?e===(this.parameters.writeDepth?oe.TRANSPARENT_MATERIAL:oe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===oe.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new IWe(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},IWe=class extends my{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==L.Color&&this._output!==L.Alpha||this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(T_e,e)}},LWe=class extends iA{constructor(){super(...arguments),this.width=0,this.color=vu,this.join="miter",this.cap=Su.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},DWe=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r,this.numJoinSubdivisions=0;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=XI+i}}_isClosed(e){return E_e(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const i=e.attributes.get(R.POSITION).indices.length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?i:i-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,r,i,s,n){var I;const o=kWe,a=BWe,l=zWe,c=i.attributes.get(R.POSITION),u=c.indices,d=c.data.length/3,p=(I=i.attributes.get(R.DISTANCETOSTART))==null?void 0:I.data;u&&u.length!==2*(d-1)&&console.warn("RibbonLineMaterial does not support indices");let g=1,y=0;const _=this.vertexBufferLayout.fields.has(R.SIZEFEATUREATTRIBUTE);_?y=i.attributes.get(R.SIZEFEATUREATTRIBUTE).data[0]:i.attributes.has(R.SIZE)&&(g=i.attributes.get(R.SIZE).data[0]);let v=[1,1,1,1],w=0;const x=this.vertexBufferLayout.fields.has(R.COLORFEATUREATTRIBUTE);x?w=i.attributes.get(R.COLORFEATUREATTRIBUTE).data[0]:i.attributes.has(R.COLOR)&&(v=i.attributes.get(R.COLOR).data);const T=te("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null;let S=0;const C=this.vertexBufferLayout.fields.has(R.OPACITYFEATUREATTRIBUTE);C&&(S=i.attributes.get(R.OPACITYFEATUREATTRIBUTE).data[0]);const A=new Float32Array(s.buffer),O=te("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,$=this.vertexBufferLayout.stride/4;let D=n*$;const N=D;let z=0;const U=p?(B,G,q)=>z=p[q]:(B,G,q)=>z+=hi(B,G),Y=te("enable-feature:objectAndLayerId-rendering"),H=(B,G,q,Z,K,fe,Pe)=>{if(A[D++]=G[0],A[D++]=G[1],A[D++]=G[2],A[D++]=Z,A[D++]=Pe,A[D++]=K,A[D++]=B[0],A[D++]=B[1],A[D++]=B[2],A[D++]=q[0],A[D++]=q[1],A[D++]=q[2],A[D++]=_?y:g,x)A[D++]=w;else{const lt=Math.min(4*fe,v.length-4);A[D++]=v[lt],A[D++]=v[lt+1],A[D++]=v[lt+2],A[D++]=v[lt+3]}C&&(A[D++]=S),Y&&(T!=null&&(O[4*D]=T[0],O[4*D+1]=T[1],O[4*D+2]=T[2],O[4*D+3]=T[3]),D++)};D+=$,se(a,c.data[0],c.data[1],c.data[2]),e&&De(a,a,e);const V=this._isClosed(i);if(V){const B=c.data.length-3;se(o,c.data[B],c.data[B+1],c.data[B+2]),e&&De(o,o,e)}else se(l,c.data[3],c.data[4],c.data[5]),e&&De(l,l,e),H(a,a,l,1,hl.LEFT_CAP_START,0,0),H(a,a,l,1,hl.RIGHT_CAP_START,0,0),ie(o,a),ie(a,l);const J=V?0:1,P=V?d:d-1;for(let B=J;B<P;B++){const G=(B+1)%d*3;se(l,c.data[G],c.data[G+1],c.data[G+2]),e&&De(l,l,e),U(o,a,B),H(o,a,l,0,hl.LEFT_JOIN_END,B,z),H(o,a,l,0,hl.RIGHT_JOIN_END,B,z);const q=this.numJoinSubdivisions;for(let Z=0;Z<q;++Z){const K=(Z+1)/(q+1);H(o,a,l,K,hl.LEFT_JOIN_END,B,z),H(o,a,l,K,hl.RIGHT_JOIN_END,B,z)}H(o,a,l,1,hl.LEFT_JOIN_START,B,z),H(o,a,l,1,hl.RIGHT_JOIN_START,B,z),ie(o,a),ie(a,l)}V?(se(l,c.data[3],c.data[4],c.data[5]),e&&De(l,l,e),z=U(o,a,P),H(o,a,l,0,hl.LEFT_JOIN_END,J,z),H(o,a,l,0,hl.RIGHT_JOIN_END,J,z)):(z=U(o,a,P),H(o,a,a,0,hl.LEFT_CAP_END,P,z),H(o,a,a,0,hl.RIGHT_CAP_END,P,z)),hF(A,N+$,A,N,$),D=hF(A,D-$,A,D,$),this._parameters.wireframe&&this._addWireframeVertices(s,N,D,$)}_addWireframeVertices(e,r,i,s){const n=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=hF(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function hF(t,e,r,i,s){for(let n=0;n<s;n++)r[i++]=t[e++];return i}function E_e(t,e){return t.isClosed?e.get(R.POSITION).indices.length>2:!1}function NWe(t){return t.anchor===fv.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const Ta=E(),Sa=E(),Cd=E(),Gy=E(),FWe=E(),jy=po(),Hy=po(),LQ=E(),DQ=E(),NQ=ud(),UWe=ud(),kWe=E(),BWe=E(),zWe=E(),AT=[po(),po(),po(),po()],ff=[E(),E(),E(),E()],dF=wr(),pF=wr(),fF=wr(),mF=wr();let Kj=class{constructor(e){this._originSR=e,this._rootOriginId="root/"+bc(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const r=this._origins.get(this._rootOriginId);if(r==null){const u=HI(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,u),u}const i=this._gridSize,s=Math.round(e[0]/i),n=Math.round(e[1]/i),o=Math.round(e[2]/i),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*i;if(ce(Dn,e,r.vec3),Dn[0]=Math.abs(Dn[0]),Dn[1]=Math.abs(Dn[1]),Dn[2]=Math.abs(Dn[2]),Dn[0]<c&&Dn[1]<c&&Dn[2]<c){if(l){const u=Math.max(...Dn);if(ce(Dn,e,l.vec3),Dn[0]=Math.abs(Dn[0]),Dn[1]=Math.abs(Dn[1]),Dn[2]=Math.abs(Dn[2]),Math.max(...Dn)<u)return l}return r}return l||(l=HI(s*i,n*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(e,r=Ot(1,1,0,1)){const i=window.view,s=i._stage,n=r.toString();if(!this._objects.has(n)){this._material=new Hw({width:2,color:r}),s.add(this._material);const g=new i_e(s,{pickable:!1}),y=new zm({castShadow:!1});s.add(y),g.add(y),this._objects.set(n,y)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),u=new Array,d=.5*this._gridSize;for(let g=0;g<l;g++)c[3*g]=e[0]+(1&a[g]?d:-d),c[3*g+1]=e[1]+(2&a[g]?d:-d),c[3*g+2]=e[2]+(4&a[g]?d:-d),g>0&&u.push(g-1,g);Ni(c,this._originSR,0,c,i.renderSpatialReference,0,l);const p=new Ds(this._material,[[R.POSITION,new Ue(c,u,3,!0)]],null,Ki.Line);s.add(p),o.addGeometry(p)}get test(){const e=this;return{set gridSize(r){e._gridSize=r}}}};const Dn=E();let C_e=class{constructor(e,r,i=null){this.rctx=e,this.sliceHelper=i,this.lastFrameCamera=new ot,this.output=L.Color,this.renderOccludedMask=FQ,this.bindParameters=new QD(r,i!=null?i.plane:null),this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=FQ}},VWe=class extends C_e{constructor(e,r,i,s){super(e,i,s),this.offscreenRenderingHelper=r,this.sliceHelper=s,this.time=0}};const FQ=Ti.Occlude|Ti.OccludeAndTransparent|Ti.OccludeAndTransparentStencil;let KS=class extends ot{constructor(){super(...arguments),this._projectionMatrix=ge()}get projectionMatrix(){return this._projectionMatrix}};h([f()],KS.prototype,"_projectionMatrix",void 0),h([f({readOnly:!0})],KS.prototype,"projectionMatrix",null),KS=h([k("esri.views.3d.webgl-engine.lib.CascadeCamera")],KS);var u2;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(u2||(u2={}));let pO=class{constructor(){this.camera=new KS,this.lightMat=ge()}},GWe=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},eH=class{get depthTexture(){var e;return(e=this._handle)==null?void 0:e.colorTexture}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return Si(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,r){this._fbos=e,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new GWe,this._projectionView=ge(),this._projectionViewInverse=ge(),this._modelViewLight=ge(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Jt(),this._cascades=[new pO,new pO,new pO,new pO],this._lastOrigin=null,this._maxTextureWidth=Math.min(te("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._handle=Zt(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=me(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)yF[e]=this._cascades[e];return yF.length=this._numCascades,yF}start(e,r,i,s,n){Je(this.enabled);const{near:o,far:a}=this._clampNearFar(i);this._computeCascadeDistances(o,a,s),this._textureHeight=this._computeTextureHeight(e,n,s),this._setupMatrices(e,r);const{viewMatrix:l,projectionMatrix:c}=e;for(let u=0;u<this._numCascades;++u)this._constructCascade(u,c,l,r);this._lastOrigin=null,this.clear()}finish(){var e;Je(this.enabled),(e=this._handle)==null||e.releaseDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!ho(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||E(),ie(this._lastOrigin,e);for(let r=0;r<this._numCascades;++r){Ya(GQ,this._cascades[r].lightMat,e);for(let i=0;i<16;++i)jQ[16*r+i]=GQ[i]}}return jQ}moveSnapshot(e){var r,i;Je(this.enabled),(r=this._handle)==null||r.releaseDepth(),(i=this._snapshots[e])==null||i.release(),this._snapshots[e]=this._handle,this._handle=null}copySnapshot(e){var a,l,c,u;const r=(l=(a=this._handle)==null?void 0:a.colorTexture)==null?void 0:l.descriptor;if(!this.enabled||!r)return;(c=this._snapshots[e])==null||c.release();const{width:i,height:s}=r;this._snapshots[e]=this._fbos.acquire(cr.RGBA4,i,s);const n=this._fbos.rctx;this._bindFbo();const o=n.bindTexture((u=this._snapshots[e])==null?void 0:u.colorTexture,Rt.TEXTURE_UNIT_FOR_UPDATES);n.gl.copyTexSubImage2D(Ji.TEXTURE_2D,0,0,0,0,0,i,s),n.bindTexture(o,Rt.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){var r;return this.enabled?(r=this._snapshots[e])==null?void 0:r.colorTexture:null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(ii.COLOR_BUFFER_BIT|ii.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,r,i){const s=Math.min(window.devicePixelRatio,r)/e.pixelRatio,n=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=M1(Math.floor(Math.max(e.fullWidth,e.fullHeight)*s*n));return Math.min(this._maxTextureWidth,this._numCascades*o)/this._numCascades}_ensureFbo(){var e,r,i;((e=this._handle)==null?void 0:e.fbo.width)===this._textureWidth&&((r=this._handle)==null?void 0:r.fbo.height)===this._textureHeight||((i=this._handle)==null||i.release(),this._handle=this._fbos.acquire(cr.RGBA4,this._textureWidth,this._textureHeight)),this._handle.acquireDepth(Hs.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=Zt(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){var r;const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer((r=this._handle)==null?void 0:r.fbo)}_constructCascade(e,r,i,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);Je(l<c);for(let g=0;g<8;++g){Si(UQ,g%4==0||g%4==3?-1:1,g%4==0||g%4==1?-1:1,g<4?l:c,1);const y=au[g];gc(y,UQ,this._projectionViewInverse),y[0]/=y[3],y[1]/=y[3],y[2]/=y[3]}ko(gF,au[0]),n.camera.viewMatrix=Ya(jWe,this._modelViewLight,gF);for(let g=0;g<8;++g)De(au[g],au[g],n.camera.viewMatrix);let u=au[0][2],d=au[0][2];for(let g=1;g<8;++g)u=Math.min(u,au[g][2]),d=Math.max(d,au[g][2]);u-=200,d+=200,n.camera.near=-d,n.camera.far=-u,YWe(i,s,u,d,n.camera),Pr(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const p=this._textureHeight;n.camera.viewport=[e*p,0,p,p]}_setupMatrices(e,r){Pr(this._projectionView,e.projectionMatrix,e.viewMatrix),Ls(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===$e.Global?e.eye:se(gF,0,0,1);tD(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(e){let{near:r,far:i}=e;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(e,r,i){const s=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(QFe(r/e,4)),s);const n=(r-e)/this._numCascades,o=(r/e)**(1/this._numCascades);let a=e,l=e;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=ft(a,l,this.settings.splitSchemeLambda),a*=o,l+=n}get test(){return{cascades:this._cascades,textureHeight:this._textureHeight}}};const jWe=ge(),UQ=Jt(),au=[];for(let t=0;t<8;++t)au.push(Jt());const kQ=ke(),BQ=ke(),HWe=ke(),zQ=ke(),VQ=ke(),gF=E(),yF=[],GQ=ge(),jQ=$i.concat($i,$i,$i,$i),jl=ke(),yb=ke(),qy=[ke(),ke(),ke(),ke()],rn=ke(),_F=ke(),gg=ke(),RT=ke(),_b=ke(),vb=ke(),fO=ke();function qWe(t,e,r,i,s,n,o,a){ir(jl,0,0);for(let C=0;C<4;++C)Ch(jl,jl,t[C]);xl(jl,jl,.25),ir(yb,0,0);for(let C=4;C<8;++C)Ch(yb,yb,t[C]);xl(yb,yb,.25),fu(qy[0],t[4],t[5],.5),fu(qy[1],t[5],t[6],.5),fu(qy[2],t[6],t[7],.5),fu(qy[3],t[7],t[4],.5);let l=0,c=dI(qy[0],jl);for(let C=1;C<4;++C){const A=dI(qy[C],jl);A<c&&(c=A,l=C)}pp(rn,qy[l],t[l+4]);const u=rn[0];let d,p;rn[0]=-rn[1],rn[1]=u,pp(_F,yb,jl),Vs(_F,rn)<0&&gG(rn,rn),fu(rn,rn,_F,r),HC(rn,rn),d=p=Vs(pp(gg,t[0],jl),rn);for(let C=1;C<8;++C){const A=Vs(pp(gg,t[C],jl),rn);A<d?d=A:A>p&&(p=A)}Ns(i,jl),xl(gg,rn,d-e),Ch(i,i,gg);let g=-1,y=1,_=0,v=0;for(let C=0;C<8;++C){pp(RT,t[C],i),HC(RT,RT);const A=rn[0]*RT[1]-rn[1]*RT[0];A>0?A>g&&(g=A,_=C):A<y&&(y=A,v=C)}Kv(g>0,"leftArea"),Kv(y<0,"rightArea"),xl(_b,rn,d),Ch(_b,_b,jl),xl(vb,rn,p),Ch(vb,vb,jl),fO[0]=-rn[1],fO[1]=rn[0];const w=xR(i,t[v],vb,Ch(gg,vb,fO),1,s),x=xR(i,t[_],vb,gg,1,n),T=xR(i,t[_],_b,Ch(gg,_b,fO),1,o),S=xR(i,t[v],_b,gg,1,a);Kv(w,"rayRay"),Kv(x,"rayRay"),Kv(T,"rayRay"),Kv(S,"rayRay")}function lr(t,e){return 3*e+t}const HQ=ke();function tl(t,e){return ir(HQ,t[e],t[e+3]),HQ}const Ea=ke(),je=Fi();function WWe(t,e,r,i,s){pp(Ea,r,i),xl(Ea,Ea,.5),je[0]=Ea[0],je[1]=Ea[1],je[2]=0,je[3]=Ea[1],je[4]=-Ea[0],je[5]=0,je[6]=Ea[0]*Ea[0]+Ea[1]*Ea[1],je[7]=Ea[0]*Ea[1]-Ea[1]*Ea[0],je[8]=1,je[lr(0,2)]=-Vs(tl(je,0),t),je[lr(1,2)]=-Vs(tl(je,1),t);let n=Vs(tl(je,0),r)+je[lr(0,2)],o=Vs(tl(je,1),r)+je[lr(1,2)],a=Vs(tl(je,0),i)+je[lr(0,2)],l=Vs(tl(je,1),i)+je[lr(1,2)];n=-(n+a)/(o+l),je[lr(0,0)]+=je[lr(1,0)]*n,je[lr(0,1)]+=je[lr(1,1)]*n,je[lr(0,2)]+=je[lr(1,2)]*n,n=1/(Vs(tl(je,0),r)+je[lr(0,2)]),o=1/(Vs(tl(je,1),r)+je[lr(1,2)]),je[lr(0,0)]*=n,je[lr(0,1)]*=n,je[lr(0,2)]*=n,je[lr(1,0)]*=o,je[lr(1,1)]*=o,je[lr(1,2)]*=o,je[lr(2,0)]=je[lr(1,0)],je[lr(2,1)]=je[lr(1,1)],je[lr(2,2)]=je[lr(1,2)],je[lr(1,2)]+=1,n=Vs(tl(je,1),e)+je[lr(1,2)],o=Vs(tl(je,2),e)+je[lr(2,2)],a=Vs(tl(je,1),r)+je[lr(1,2)],l=Vs(tl(je,2),r)+je[lr(2,2)],n=-.5*(n/o+a/l),je[lr(1,0)]+=je[lr(2,0)]*n,je[lr(1,1)]+=je[lr(2,1)]*n,je[lr(1,2)]+=je[lr(2,2)]*n,n=Vs(tl(je,1),e)+je[lr(1,2)],o=Vs(tl(je,2),e)+je[lr(2,2)],a=-o/n,je[lr(1,0)]*=a,je[lr(1,1)]*=a,je[lr(1,2)]*=a,s[0]=je[0],s[1]=je[1],s[2]=0,s[3]=je[2],s[4]=je[3],s[5]=je[4],s[6]=0,s[7]=je[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=je[6],s[13]=je[7],s[14]=0,s[15]=je[8]}function YWe(t,e,r,i,s){const n=1/au[0][3],o=1/au[4][3];Je(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(un(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,qWe(au,a,l,kQ,BQ,HWe,zQ,VQ),WWe(kQ,BQ,zQ,VQ,s.projectionMatrix),s.projectionMatrix[10]=2/(r-i),s.projectionMatrix[14]=-(r+i)/(r-i)}function XWe(t){return hd(t)&&t.intersector===Mi.TERRAIN&&!!t.target}let ZWe=class extends BD{constructor(e,r,i){super(e,r),this.triangleNr=i}};function A_e(t){return hd(t)&&t.intersector===Mi.OVERLAY&&!!t.target}let zB=class{constructor(){this.adds=new It,this.removes=new It,this.updates=new It({allocator:e=>e||new JWe,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},JWe=class{},QWe=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var Pi,qs;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(Pi||(Pi={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(qs||(qs={}));function R_e(t){const e=new Map,r=i=>{let s=e.get(i);return s||(s=new QWe,e.set(i,s)),s};return t.removes.forAll(i=>{vF(i)&&r(i.material).removes.push(i)}),t.adds.forAll(i=>{vF(i)&&r(i.material).adds.push(i)}),t.updates.forAll(i=>{vF(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),e}function vF(t){return t.geometry.indexCount>=1}let O_e=class{constructor(e,r){this._material=e,this._repository=r,this._map=new Map}dispose(){this._map.forEach((e,r)=>{e!=null&&this._repository.release(this._material,r)})}load(e,r,i){if(!this._material.produces(r,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const s=this._map.get(i);if(s!=null){if(s.ensureResources(e)===Z0.LOADED)return s;this._repository.requestRender()}return null}},VB=class extends L0e{constructor(e=E()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}};const KWe=Ci().vec3f(R.POSITION),eYe=Ci().vec3f(R.POSITION).vec2f(R.UV0),tYe=Ci().vec3f(R.POSITION).vec4u8(R.COLOR);Ci().vec3f(R.POSITION).vec4u8(R.OBJECTANDLAYERIDCOLOR);const rYe=Ci().vec3f(R.POSITION).vec2f(R.UV0).vec4u8(R.OBJECTANDLAYERIDCOLOR);Ci().vec3f(R.POSITION).vec4u8(R.COLOR).vec4u8(R.OBJECTANDLAYERIDCOLOR);let tH=class extends yy{intersect(e,r,i,s,n,o){return Ige(e,i,s,n,void 0,o)}};function qQ(t){t.fragment.uniforms.add(new Ze("texWaveNormal",e=>e.waveNormal),new Ze("texWavePerturbation",e=>e.wavePerturbation),new nr("waveParams",e=>Si(iYe,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new Ir("waveDirection",e=>ir(sYe,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(yqe),t.fragment.code.add(b`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const iYe=Jt(),sYe=ke();function a3(t,e){e.spherical?t.vertex.code.add(b`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(b`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(b`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(b`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function nYe(t){const e=new dr,{vertex:r,fragment:i}=e;Rl(r,t),e.include(qa,t),e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.UV0,"vec2");const s=new nr("waterColor",n=>n.color);if(t.output===L.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
        void main(void) {
          if (waterColor.a < ${b.float(qn)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(s),i.code.add(b`void main() {
fragColor = waterColor;
}`),e;switch(t.output!==L.Color&&t.output!==L.Alpha||(e.include(a3,t),e.include(F2,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.multipassEnabled&&e.varyings.add("depth","float"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(qn)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===L.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(Nl,t),t.output){case L.Alpha:e.include(us,t),i.uniforms.add(s),i.code.add(b`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case L.Color:e.include(pI),e.include(AG,{pbrMode:et.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(qQ),e.include(us,t),e.include(dv,t),e.include(Zye,t),i.uniforms.add(s,new Ee("timeElapsed",n=>n.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")),sd(i,t),i.include(tf),Lm(i),Jp(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?b`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===Qe.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `);break;case L.Normal:e.include(a3,t),e.include(qQ,t),e.include(us,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r.uniforms.add(s),r.code.add(b`
        void main(void) {
          if (waterColor.a < ${b.float(qn)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new Ee("timeElapsed",n=>n.timeElapsed)),i.code.add(b`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case L.Highlight:e.include(_y,t),e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(qn)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(us,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case L.ObjectAndLayerIdColor:e.include(rA,t),e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(qn)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(us,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const oYe=Object.freeze(Object.defineProperty({__proto__:null,build:nYe},Symbol.toStringTag,{value:"Module"}));let P_e=class M_e extends Sr{initializeConfiguration(e,r){r.spherical=e.viewingMode===$e.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new vr(e.rctx,M_e.shader.get().build(this.configuration),hr)}_setPipelineState(e){const r=this.configuration,i=e===Qe.NONE,s=e===Qe.FrontFace;return Et({blending:r.output!==L.Normal&&r.output!==L.Highlight&&r.output!==L.ObjectAndLayerIdColor&&r.transparent?i?Ac:Bm(e):null,depthTest:{func:vy(e)},depthWrite:i?r.writeDepth?Xa:null:vN(e),colorWrite:Ut,polygonOffset:i||s?null:xN(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};P_e.shader=new _r(oYe,()=>he(()=>import("./WaterSurface.glsl-42f99e29.js"),[],import.meta.url));let sn=class extends ga{constructor(){super(...arguments),this.output=L.Color,this.transparencyPassType=Qe.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.isDraped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}};h([F({count:L.COUNT})],sn.prototype,"output",void 0),h([F({count:Qe.COUNT})],sn.prototype,"transparencyPassType",void 0),h([F()],sn.prototype,"spherical",void 0),h([F()],sn.prototype,"receiveShadows",void 0),h([F()],sn.prototype,"hasSlicePlane",void 0),h([F()],sn.prototype,"transparent",void 0),h([F()],sn.prototype,"enableOffset",void 0),h([F()],sn.prototype,"writeDepth",void 0),h([F()],sn.prototype,"hasScreenSpaceReflections",void 0),h([F()],sn.prototype,"doublePrecisionRequiresObfuscation",void 0),h([F()],sn.prototype,"hasCloudsReflections",void 0),h([F()],sn.prototype,"objectAndLayerIdColorInstanced",void 0),h([F()],sn.prototype,"isDraped",void 0),h([F()],sn.prototype,"multipassEnabled",void 0),h([F()],sn.prototype,"cullAboveGround",void 0),h([F({constValue:!1})],sn.prototype,"occlusionPass",void 0),h([F({constValue:et.Water})],sn.prototype,"pbrMode",void 0),h([F({constValue:!0})],sn.prototype,"useCustomDTRExponentForWater",void 0),h([F({constValue:!0})],sn.prototype,"highStepCount",void 0),h([F({constValue:!1})],sn.prototype,"useFillLights",void 0);let aYe=class extends my{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){const r=e.ssr.lastFrameColor!=null;r!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:r})}_updateCloudsReflectionState(e){const r=e.cloudsFade.data!=null;r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===L.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(P_e,e)}},$_e=class extends tH{constructor(e){super(e,new I_e),this._configuration=new sn,this._animation=new vme}getConfiguration(e,r){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<bN,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(e){const r=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<lYe;const i=this._animation.advance(e);return this.setParameters({timeElapsed:jz(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&i}produces(e,r){switch(r){case L.Normal:return e===oe.DRAPED_WATER;case L.Color:if(this.parameters.isDraped)return e===oe.DRAPED_MATERIAL;break;case L.Alpha:break;case L.Highlight:case L.ObjectAndLayerIdColor:return e===oe.OPAQUE_MATERIAL||e===oe.DRAPED_MATERIAL;default:return!1}let i=oe.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?oe.TRANSPARENT_MATERIAL:oe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){return new aYe(e)}createBufferWriter(){return new z2(te("enable-feature:objectAndLayerId-rendering")?rYe:eYe)}get test(){return{animationEnabled:this._animation.enabled}}},I_e=class extends yj{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=tr(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Ot(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=E(),this.modelTransformation=null}};const lYe=35e3;let rH=class{constructor(e=0,r=0){this.from=e,this.to=r}get numElements(){return this.to-this.from}};function WQ(t){const e=new Map;t.forAll(i=>e.set(i.from,i));let r=!0;for(;r;)r=!1,t.forEach(i=>{const s=e.get(i.to);s&&(i.to=s.to,e.delete(s.from),t.removeUnordered(s),r=!0)})}let YQ=class extends rH{constructor(e,r,i){super(r,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},cYe=class{constructor(){this.first=0,this.count=0}},uYe=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new It({allocator:e=>e||new rH,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=mO(),this.drawCommandsHighlight=mO(),this.drawCommandsOccludees=mO(),this.drawCommandsShadowHighlightRest=mO()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,r){this.deleteInstance(e),this._instances.set(e,r),this._numElements+=r.numElements}deleteInstance(e){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,this._instances.delete(e))}updateInstance(e,r,i){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=r,s.to=i,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const i=this.drawCommandsDefault.pushNew(),s=this.holes.front();return this.vao!=null&&this.holes.length===1&&s.to===Math.floor(this.vao.byteSize/e)?(i.first=0,void(i.count=s.from)):(i.first=1/0,i.count=0,this._instances.forEach(n=>{i.first=Math.min(i.first,n.from),i.count=Math.max(i.count,n.to)}),void(i.count-=i.first))}const r=Array.from(this._instances.values()).sort((i,s)=>i.from===s.from?i.to-s.to:i.from-s.from);for(const i of r)i.isVisible&&(XQ(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),XQ(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function hYe(t){return t.vao!=null}function mO(){return new It({allocator:t=>t||new cYe,deallocator:t=>t})}function XQ(t,e){const r=t.back();if(r==null){const i=t.pushNew();return i.first=e.from,void(i.count=e.numElements)}if(dYe(r,e)){const i=e.from-r.first+e.numElements;r.count=i}else{const i=t.pushNew();i.first=e.from,i.count=e.numElements}}function dYe(t,e){return t.first+t.count>=e.from}let pYe=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(r=>r.instances.has(e))}};const fYe=zE+1;let mYe=class{constructor(e,r,i){this._rctx=e,this._locations=r,this._layout=i,this._cache=new H3(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const r=e.toString();let i=this._cache.pop(r);return i||(i=new pd(this._rctx,this._locations,{geometry:this._layout},{geometry:Cr.createVertex(this._rctx,yr.STATIC_DRAW)}),i.vertexBuffers.geometry.setSize(e),i)}deleteVao(e){if(e==null)return;const r=e.byteSize.toString();this._cache.put(r,e,fYe)}},eC=class extends Eme{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this.priority=0,this.produces=new Map}dispose(){this._glMaterials=Ke(this._glMaterials),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache=Ke(this._vaoCache)}initializeRenderContext(e,r){const{rctx:i}=e.renderContext;this._glMaterials=new O_e(this.material,r??e.materialRepository),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new mYe(i,this.material.vertexAttributeLocations,Ul(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof $_e}get isDecoration(){return this.material.parameters.isDecoration}get rendersOccluded(){return!this.isEmpty&&this.material.parameters.renderOccluded!==Ti.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,s)=>i+s.instances.size,0)),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,s)=>i+s.vao.usedMemory,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(r=>r.buffers.forEach(i=>i.instances.forEach(s=>e(s.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const r=this._bufferWriter;if(r===null)return;const i=r.vertexBufferLayout.stride/4;for(const s of e){const n=s.renderGeometry,o=this._dataByOrigin.get(n.localOrigin.id),a=o==null?void 0:o.findBuffer(n.id);if(a==null)return;const l=a.instances.get(n.id);if(s.updateType&(qs.GEOMETRY|qs.TRANSFORMATION)){const c=_O(r.elementCount(l.geometry.geometry)*i),u=r.vertexBufferLayout.createView(c.buffer);this._writeGeometry(n,u,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*i,0,l.numElements*i)}s.updateType&(qs.HIGHLIGHT|qs.OCCLUDEE|qs.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,r){const i=new B2;for(const s of e){const n=s.localOrigin;if(n==null)continue;let o=i.get(n.id,null);o==null&&(o=new ZQ(n.vec3),i.set(n.id,null,o)),o.changes.push(s)}for(const s of r){const n=s.localOrigin;if(n==null)continue;const o=this._dataByOrigin.get(n.id),a=o==null?void 0:o.findBuffer(s.id);if(a==null)continue;let l=i.get(n.id,a);l==null&&(l=new ZQ(n.vec3),i.set(n.id,a,l)),l.changes.push(s)}return i}_addAndRemoveGeometries(e,r){if(this._bufferWriter===null||this._vaoCache===null)return;const{_bufferWriter:i,_dataByOrigin:s}=this,n=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,r);o.forEach((a,l)=>{const c=a.get(null),u=c!=null?c.changes:[];o.delete(l,null);let d=s.get(l);if(a.forEach((p,g)=>{if(o.delete(l,g),g==null)return void Je(!1,"No VAO for removed geometries");if(g.instances.size===p.changes.length)return this._vaoCache.deleteVao(g.vao),gC(d.buffers,g),void(d.buffers.length===0&&u.length===0&&s.delete(l));const y=g.numElements,_=g.vao.byteSize/4,v=u.reduce((S,C)=>S+i.elementCount(C.geometry),0),w=p.changes.reduce((S,C)=>S+i.elementCount(C.geometry),0),x=Math.min((y+v-w)*n,yO),T=x>_;x>ZI&&x<_/2?(p.changes.forEach(({id:S})=>g.deleteInstance(S)),g.instances.forEach(({geometry:S})=>u.push(S)),this._vaoCache.deleteVao(g.vao),gC(d.buffers,g)):T?this._applyAndRebuild(g,u,p):this._applyRemoves(g,p)}),u.length>0)for(d==null&&(d=new pYe(c.origin),s.set(l,d)),d.buffers.forEach(p=>this._applyAdds(p,u));u.length>0;)d.buffers.push(this._applyAndRebuild(new uYe,u,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(r=>{r.drawCommandsDirty&&(r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,hc(r.instances,i=>(r.updateDrawState(i),r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees)),r.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||r.hasHighlights,this._hasOccludees=this._hasOccludees||r.hasOccludees})})}_applyAndRebuild(e,r,i){if(i!=null)for(const y of i.changes)e.deleteInstance(y.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(yO/o);let l=e.numElements;for(;r.length>0;){const y=r.pop(),_=s.elementCount(y.geometry);if(l+_>a&&l>0){r.push(y);break}l+=_;const v=new YQ(y,0,0);Je(e.instances.get(y.id)==null),e.addInstance(y.id,v)}const c=l*o,u=_O(c),d=s.vertexBufferLayout.createView(u.buffer);let p=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((y,_)=>{this._writeGeometry(y.geometry,d,p);const v=p;p+=s.elementCount(y.geometry.geometry),e.updateInstance(_,v,p),e.updateDrawState(y)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(KQ(c)),e.vao.vertexBuffers.geometry.setSubData(u,0,0,p*o),e.holes.clear();const g=e.holes.pushNew();return g.from=p,g.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,r){if(r.changes.length===0||this._bufferWriter===null)return;for(const a of r.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const u=Ad.back();if(u){if(u.to===c.from){u.to=c.to;continue}if(u.from===c.to){u.from=c.from;continue}}const d=Ad.pushNew();d.from=c.from,d.to=c.to}WQ(Ad);const i=this._bufferWriter.vertexBufferLayout.stride/4,s=Ad.reduce((a,l)=>Math.max(a,l.numElements),0)*i,n=_O(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.geometry;Ad.forAll(a=>o.setSubData(n,a.from*i,0,a.numElements*i)),e.holes.pushArray(Ad.data,Ad.length),Ad.forAll((a,l)=>Ad.data[l]=null),Ad.clear(),e.drawCommandsDirty=!0}_applyAdds(e,r){if(r.length===0||this._bufferWriter===null)return;if(!hYe(e))return void this._applyAndRebuild(e,r,null);const i=this._bufferWriter,s=i.vertexBufferLayout.stride/4,n=e.numElements,o=r.reduce((w,x)=>w+i.elementCount(x.geometry),0),a=Math.min((n+o)*s,yO),l=4*a;if(e.vao.byteSize<KQ(yO-ZI)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,r,null);WQ(e.holes);const c=new Array;for(const w of r){const x=i.elementCount(w.geometry),T=gYe(e.holes,x);c.push(T)}const u=e.vao.vertexBuffers.geometry;let d=0,p=0,g=0;const y=_O(a),_=i.vertexBufferLayout.createView(y.buffer);r.forEach((w,x)=>{const T=c[x];if(T==null)return;if(g!==T){const A=g-p;A>0&&u.setSubData(y,p*s,0,A*s),p=T,d=0}const S=i.elementCount(w.geometry);this._writeGeometry(w,_,d),d+=S,g=T+S;const C=new YQ(w,T,T+S);Je(e.instances.get(w.id)==null),e.addInstance(w.id,C),e.drawCommandsDirty=!0});const v=g-p;v>0&&u.setSubData(y,p*s,0,v*s),qxe(r,(w,x)=>c[x]==null)}_writeGeometry(e,r,i){if(this._bufferWriter===null)return;const s=e.localOrigin.vec3;KFe(JQ,-s[0],-s[1],-s[2]);const n=Pr(yYe,JQ,e.transformation);Ls(gO,n),$l(gO,gO),this._bufferWriter.write(n,gO,e.geometry,r,i)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:r,bindParameters:i}=e;if(!this.material.produces(i.slot,r))return null;const s=r===L.Highlight||r===L.ShadowHighlight;if(s&&!this._hasHighlights)return null;const n=r===L.ShadowExcludeHighlight,o=!(s||n);for(const a of this._dataByOrigin.values())for(const l of a.buffers){if(s&&!l.hasHighlights)continue;const c=(s?l.drawCommandsHighlight:n&&l.needsMultipleCommands()?l.drawCommandsShadowHighlightRest:l.drawCommandsDefault)||null,u=o&&l.drawCommandsOccludees||null;if(c!=null&&c.length||u!=null&&u.length){const d=this._glMaterials.load(e.rctx,i.slot,r),p=d!=null?d.beginSlot(i):null;if(p!=null)return p}}return null}renderNode(e,r){const{output:i,bindParameters:s}=e,n=i===L.Highlight||i===L.ShadowHighlight,o=i===L.ShadowExcludeHighlight,a=!(n||o),l=e.rctx,c=e.bindParameters.slot===oe.OCCLUDER_MATERIAL,u=e.bindParameters.slot===oe.TRANSPARENT_OCCLUDER_MATERIAL;l.runAppleAmdDriverHelper(),l.bindTechnique(r,this.material.parameters,s);for(const d of this._dataByOrigin.values())for(const p of d.buffers){if(n&&!p.hasHighlights)continue;const g=(n?p.drawCommandsHighlight:o&&p.needsMultipleCommands()?p.drawCommandsShadowHighlightRest:p.drawCommandsDefault)||null,y=a&&p.drawCommandsOccludees||null;(g!=null&&g.length||y!=null&&y.length)&&(r.program.bindDraw(new VB(d.origin),s,this.material.parameters),r.ensureAttributeLocations(p.vao),l.bindVAO(p.vao),g!=null&&g.length&&(l.setPipelineState(r.getPipeline(!1,c,u)),g.forAll(_=>l.drawArrays(r.primitiveType,_.first,_.count))),y!=null&&y.length&&(l.setPipelineState(r.getPipeline(!0,c,u)),y.forAll(_=>l.drawArrays(r.primitiveType,_.first,_.count))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}};h([f({constructOnly:!0})],eC.prototype,"material",void 0),eC=h([k("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],eC);let ZQ=class{constructor(e){this.origin=e,this.changes=new Array}};function gYe(t,e){let r;if(!t.some(s=>!(s.numElements<e)&&(r=s,!0)))return null;const i=r.from;return r.from+=e,r.from>=r.to&&t.removeUnordered(r),i}const JQ=ge(),yYe=ge(),gO=ge(),Ad=new It({allocator:t=>t||new rH,deallocator:null}),ZI=65536,bF=4*ZI,QQ=1024,L_e=16777216,yO=L_e/4;let wF=new Float32Array(ZI);function _O(t){return wF.length<t&&(wF=new Float32Array(t)),wF}function KQ(t){const e=4*t;return e<=QQ?QQ:e<bF?Yoe(e):Math.max(Math.min(Math.ceil(1.5*e/bF)*bF,L_e),e)}let Kl=class extends xe{constructor(e){super(e),this._pending=new _Ye,this._changes=new zB,this._materialRenderers=new It,this._sortedMaterialRenderers=new It,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forAll(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._materialRenderers.some(e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.length===0&&this._geometries.size===0}getMemoryForMaterial(e){if(e==null)return 0;const r=this._materialRenderers.find(i=>i.material===e);return(r==null?void 0:r.usedMemory)??0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=R_e(this._changes);let r=!1,i=!1,s=!1;return e.forEach((n,o)=>{let a=this._materialRenderers.find(u=>u.material===o);if(!a&&n.adds.length>0){const u=new eC({material:o});u.initializeRenderContext(this.rendererContext.pluginContext,this._materialRepository),a=u,this._materialRenderers.push(a),r=!0,i=!0,s=!0}if(!a)return;const l=i||a.hasHighlights,c=s||a.hasWater;a.modify(n),i=i||l!==a.hasHighlights,s=s||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.removeUnordered(a),a.dispose(),r=!0)}),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=this._materialRenderers.some(n=>n.hasHighlights)),s&&(this._hasWater=this._materialRenderers.some(n=>n.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,r){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const n of i)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of i)this._pending.adds.add(n);s&&this.notifyChange("updating"),r===Pi.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,r){const i=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);i&&!this._pending.empty&&this.notifyChange("updating"),r===Pi.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,r){const i=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=r}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),r){case qs.TRANSFORMATION:case qs.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case qs.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let r=!1;return this._sortedMaterialRenderers.forAll(i=>r=i.updateAnimation(e)||r),r}shouldRender(e){return this._sortedMaterialRenderers.some(r=>r.prepareTechnique(e))}render(e){this._sortedMaterialRenderers.forAll(r=>{const i=r.prepareTechnique(e);i!=null&&r.renderNode(e,i)})}intersect(e,r,i,s,n){return this._geometries.forEach(o=>{if(s&&!s(o))return;this._intersectRenderGeometry(o,i,r,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,i,r,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,i,r,-a.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear(),this._materialRenderers.forAll((e,r)=>{e.priority=r,this._sortedMaterialRenderers.push(e)}),this._sortedMaterialRenderers.sort((e,r)=>r.material.renderPriority===e.material.renderPriority?e.priority-r.priority:r.material.renderPriority-e.material.renderPriority)}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const r=this._changes.updates.data[e];this._pending.has(r.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,r,i,s,n,o){if(!e.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],xF[0]=i[0]-s,xF[1]=i[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,xF,(l,c,u)=>{vYe(r,u,e.material.renderPriority,o,n,e.layerUid,e.graphicUid)},r)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let r;for(const i of e){const s=i.graphicUid;s!=null&&s!==r&&(this.drapeSource.notifyGraphicGeometryChanged(s),r=s)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let r;for(const i of e){const s=i.graphicUid;s!=null&&s!==r&&(this.drapeSource.notifyGraphicVisibilityChanged(s),r=s)}}_validateRenderGeometries(e){for(const r of e)this._validateRenderGeometry(r);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};h([f()],Kl.prototype,"drapeSource",void 0),h([f()],Kl.prototype,"updating",null),h([f()],Kl.prototype,"rctx",null),h([f({constructOnly:!0})],Kl.prototype,"rendererContext",void 0),h([f()],Kl.prototype,"_materialRepository",null),h([f()],Kl.prototype,"_localOriginFactory",null),h([f({readOnly:!0})],Kl.prototype,"isEmpty",null),h([f()],Kl.prototype,"_materialRenderers",void 0),h([f()],Kl.prototype,"_geometries",void 0),Kl=h([k("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Kl);let _Ye=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function vYe(t,e,r,i,s,n,o){const a=new ZWe(n,o,e),l=c=>{c.set(Mi.OVERLAY,a,t.dist,t.normal,t.transformation,r,i)};if((s.results.min.drapedLayerOrder==null||r>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==Xn.MIN&&(s.results.max.drapedLayerOrder==null||r<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===Xn.ALL){const c=sG(s.ray);l(c),s.results.all.push(c)}}const xF=ke();let iH=class D_e extends Sr{initializeProgram(e){return new vr(e.rctx,D_e.shader.get().build(),hr)}initializePipeline(){return this.configuration.hasAlpha?Et({blending:Jn(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ut}):Et({colorWrite:Ut})}};iH.shader=new _r(Sqe,()=>he(()=>import("./TextureOnly.glsl-67db6377.js"),[],import.meta.url));let sH=class extends Za{constructor(){super(...arguments),this.hasAlpha=!1}};h([F()],sH.prototype,"hasAlpha",void 0);let N_e=class extends Vr{constructor(){super(...arguments),this.overlayIndex=As.INNER,this.opacity=1}};function bYe(){const t=new dr;return t.include(Wo),t.fragment.uniforms.add(new Ze("tex",e=>e.texture)),t.fragment.uniforms.add(new aA("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Ee("opacity",e=>e.opacity)),t.fragment.code.add(b`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const wYe=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:N_e,build:bYe},Symbol.toStringTag,{value:"Module"}));let F_e=class U_e extends Sr{initializeProgram(e){return new vr(e.rctx,U_e.shader.get().build(),hr)}initializePipeline(){return Et({blending:Dl(ve.ONE,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ut})}};F_e.shader=new _r(wYe,()=>he(()=>import("./OverlayCompositing.glsl-67f16806.js"),[],import.meta.url));let fh=class extends Iv{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new N_e,this.hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new It,this._passParameters=new Qye,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new ot,this.worldToPCSRatio=1,this.events=new Ps,this.longitudeCyclical=null,this.produces=new Map([[oe.DRAPED_MATERIAL,r=>r!==L.Highlight||this.hasHighlights],[oe.DRAPED_WATER,()=>!0]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,r=this.view._stage.renderView,{waterTextureRepository:i,stippleTextureRepository:s,markerTextureRepository:n}=r;this._shaderTechniqueRepository=new Kye({rctx:this._rctx,viewingMode:$e.Local,stippleTextureRepository:s,markerTextureRepository:n,waterTextureRepository:i}),this._renderContext=new C_e(this._rctx,new eH(e,this.view.state.viewingMode),null),this.addHandles([ae(()=>i.updating,()=>this.events.emit("content-changed"),Br),ae(()=>this.spatialReference,o=>this._localOriginFactory=new Kj(o),Br),Bo(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new e_e(r.textureRepository,this._shaderTechniqueRepository,o=>{(o.parameters.renderOccluded&JI)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=oe.DRAPED_MATERIAL,this._bindParameters.mainDepth=i8e(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=Qe.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new OG(Te(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(ct.STAGE,this))}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=Zt(this._debugTextureTechnique),this._passParameters.texture=Ke(this._passParameters.texture),this._bindParameters.mainDepth=Ke(this._bindParameters.mainDepth),this._shaderTechniqueRepository=Oe(this._shaderTechniqueRepository),this.disposeOverlays()}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||hc(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMemoryForMaterial(e){return Array.from(this._renderers.values()).reduce((r,i)=>r+i.getMemoryForMaterial(e),0)}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Kl)}createDrapeSourceRenderer(e,r,i){const s=this._renderers.get(e);s!=null&&s.destroy();const n=new r({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(ae(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(e==null)return;const r=this._renderers.get(e);r!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),r.destroy())}computeValidity(){var e;return((e=this._renderTargets)==null?void 0:e.computeValidity())??0}releaseRenderTargets(){var e;(e=this._renderTargets)==null||e.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&bP(e,r=>r.drapeTargetType===FB.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=bP(e,r=>r.drapeSourceType===JE.Features),this._hasDrapedRasterSource=bP(e,r=>r.drapeSourceType===JE.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,r,i=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new pqe(this.view._stage.renderer.fboCache),this._overlays=[new CQ,new CQ]),this.ensureDrapeTargets(e),this.ensureDrapeSources(r),this._bindParameters.overlayStretch=i}disposeOverlays(){this._overlays=null,this._renderTargets=Ke(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var r,i;if(e!=null)return e===Ei.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?(r=this._renderTargets)==null?void 0:r.getTexture(Ei.Color):(i=this._renderTargets)==null?void 0:i.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,r){let i=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||r(s))&&n.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=hc(this._renderers,s=>s.hasHighlights),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(fa,e=>e.updatePolicy===D0.SYNC)}get isEmpty(){return!Zr.OVERLAY_DRAW_DEBUG_TEXTURE&&!hc(this._renderers,e=>!e.isEmpty)}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}get mode(){var e,r;return this.isEmpty?wp.Disabled:(e=this._renderTargets)!=null&&e.getTexture(Ei.WaterNormal)?wp.EnabledWithWater:(r=this._renderTargets)!=null&&r.getTexture(Ei.Color)?wp.Enabled:wp.Disabled}updateAnimation(e){let r=!1;return this._renderers.forEach(i=>r=i.updateAnimation(e)||r),r}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const r of this._overlays)this.longitudeCyclical?r.setupGeometryViewsCyclical(this.longitudeCyclical):r.setupGeometryViewsDirect();for(const r of this._renderTargets.targets)(r.content!==Ei.ColorNoRasterImage||this._needsColorWithoutRasterImage)&&(this._drawTarget(As.INNER,r,e),this._drawTarget(As.OUTER,r,e))}}_drawTarget(e,r,i){const s=this._overlays[e],n=s.canvasGeometries;if(n.numViews===0)return;const{alignPixelEnabled:o,contentPixelRatio:a}=i;this._screenToWorldRatio=a*s.mapUnitsPerPixel/this._bindParameters.overlayStretch;const l=r.output;if(this.isEmpty||l===L.Highlight&&!this.hasHighlights||l===L.Normal&&!this.hasWater||!s.hasSomeSizedView())return;const c=this._rctx;this._camera.pixelRatio=s.pixelRatio*a,this._renderContext.output=l,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=l===L.Normal?oe.DRAPED_WATER:oe.DRAPED_MATERIAL;const u=Zr.OVERLAY_DRAW_DEBUG_TEXTURE&&r.content!==Ei.Occluded;if(!u&&!this._sortedRenderers.some(({renderer:_})=>_.shouldRender(this._renderContext)))return;const d=s.resolution;this._rctx.setViewport(e===As.INNER?0:d,0,d,d);const p=2*s.resolution,g=s.resolution,y=r.fbo;if(y.bind(c,p,g),e===As.INNER&&(c.setClearColor(0,0,0,0),c.clearSafe(ii.COLOR_BUFFER_BIT)),r.content===Ei.Occluded&&(this._renderContext.renderOccludedMask=JI),u)for(let _=0;_<n.numViews;_++)this._setViewParameters(n.extents[_],s),this._ensureDebugPatternResources(s.resolution,TYe[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._passParameters,null),this._rctx.screen.draw();this._sortedRenderers.forAll(({drapeSource:_,renderer:v})=>{if(r.content===Ei.ColorNoRasterImage&&_.drapeSourceType===JE.RasterImage)return;const{fullOpacity:w}=_,x=w!=null&&w<1&&l===L.Color?this.bindTemporaryFramebuffer(p,g):null;for(let T=0;T<n.numViews;T++)this._setViewParameters(n.extents[T],s),v.render(this._renderContext);if(x){y.bind(c,p,g),this._overlayParameters.texture=x.colorTexture,this._overlayParameters.opacity=w,this._overlayParameters.overlayIndex=e;const T=this.pluginContext.techniqueRepository.acquire(F_e);this._rctx.bindTechnique(T,this._overlayParameters,this._renderContext.bindParameters),this._rctx.screen.draw(),T.release(),x.release()}}),c.bindFramebuffer(null),e===As.OUTER&&y.generateMipMap(),this._renderContext.resetRenderOccludedMask()}bindTemporaryFramebuffer(e,r){const i=this.view._stage.renderer.fboCache,s=i.acquire(cr.RGBA,e,r);return i.rctx.bindFramebuffer(s.fbo),i.rctx.clearSafe(ii.COLOR_BUFFER_BIT),s}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,r,i,s){var o;let n=0;for(const a of this._renderers.values())n=((o=a.intersect)==null?void 0:o.call(a,e,r,i,s,n))??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((r,i)=>{const s=e.indexOf(i.layer),n=s>=0,o=this._renderers.size*(i.renderGroup??(n?jI.MapLayer:jI.ViewLayer))+(n?s:0);this._sortedRenderers.push(new xYe(i,r,o))}),this._sortedRenderers.sort((r,i)=>r.index-i.index)}_setViewParameters(e,r){const i=this._camera;i.viewport=[0,0,r.resolution,r.resolution],hae(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),P3(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=hc(this._renderers,r=>r.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateRendersOccluded(){const e=hc(this._renderers,r=>r.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_ensureDebugPatternResources(e,r){if(se(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const i=new Uint8Array(e*e*4);let s=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),u=Math.floor(a/10);c<2||u<2||10*c>e-20||10*u>e-20?(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=255):(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=1&c&&1&u?1&l^1&a?0:255:1&c^1&u?0:128)}const n=new Or(e);n.samplingMode=Dt.NEAREST,this._passParameters.texture=new Rt(this._rctx,n,i);const o=new sH;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(iH,o)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};h([f()],fh.prototype,"hasHighlights",void 0),h([f()],fh.prototype,"_sortedDrapeSourceRenderersDirty",void 0),h([f({autoDestroy:!0})],fh.prototype,"_shaderTechniqueRepository",void 0),h([f({constructOnly:!0})],fh.prototype,"view",void 0),h([f()],fh.prototype,"worldToPCSRatio",void 0),h([f()],fh.prototype,"spatialReference",void 0),h([f({type:Boolean,readOnly:!0})],fh.prototype,"updating",null),h([f()],fh.prototype,"isEmpty",null),fh=h([k("esri.views.3d.terrain.OverlayRenderer")],fh);let xYe=class{constructor(e,r,i){this.drapeSource=e,this.renderer=r,this.index=i}};const TYe=[[1,.5,.5],[.5,.5,1]],nH=-2,JI=Ti.OccludeAndTransparent;function oH(t,e,r,i){const s=hA(t.rings,!!t.hasZ,jp.CCW_IS_HOLE,t.spatialReference),n=Pn(s.position.length),o=m0e(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,r,i),a=o!=null;return new CYe(s.position,n,z_e(s.polygons,s.position,n),B_e(s.outlines,s.position,n),a,o)}function k_e(t,e){const r=hA(t.rings,!1,jp.CCW_IS_HOLE),i=Ni(r.position,t.spatialReference,0,r.position,e,0,r.position.length/3);for(let s=2;s<r.position.length;s+=3)r.position[s]=nH;return{position:r.position,polygons:z_e(r.polygons,r.position),outlines:B_e(r.outlines,r.position),projectionSuccess:i}}function B_e(t,e,r=null){return t.filter(({count:i})=>i>1).map(({index:i,count:s})=>{const n=3*i,o=3*s;return r!=null?new V_e(i,s,Tu(e,n,o),Tu(r,n,o)):new aH(i,s,Tu(e,n,o))})}function z_e(t,e,r=null){const i=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,u=o.map(p=>p-s),d=r!=null?new SYe(s,n,Tu(e,3*s,3*n),Tu(r,l,c),u,a):new EYe(s,n,Tu(e,3*s,3*n),u,a);i.push(d)}return i}let aH=class{constructor(e,r,i){this.index=e,this.count=r,this.position=i}},V_e=class extends aH{constructor(e,r,i,s){super(e,r,i),this.mapPositions=s}},SYe=class extends V_e{constructor(e,r,i,s,n,o){super(e,r,i,s),this.holeIndices=n,this.pathLengths=o}},EYe=class extends aH{constructor(e,r,i,s,n){super(e,r,i),this.holeIndices=s,this.pathLengths=n}},CYe=class{constructor(e,r,i,s,n,o){this.position=e,this.mapPositions=r,this.polygons=i,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function mv(t,e,r,i,s,n=2){const o=1/(Math.abs(r)+Math.abs(i)+Math.abs(s)),a=r*o,l=i*o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,u=s<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,d=e*n;t[d]=eK(c),t[d+1]=eK(u)}function AYe(t){const e=t.length/3,r=new Int16Array(2*e);let i=0;for(let s=0;s<e;++s)mv(r,s,t[i++],t[i++],t[i++]);return r}function RYe(t,e,r,i=2){const s=r*i,n=tK(e[s]),o=tK(e[s+1]),a=1-Math.abs(n)-Math.abs(o);t[2]=a,a<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=o),pe(t,t)}function eK(t){return me(Math.round(32767*t),-32767,32767)}function tK(t){return me(t/32767,-1,1)}const OYe=["polygon","extent"];let PYe=class extends sf{constructor(e,r,i,s){super(e,r,i,s),this.ensureDrapedStatus(!1)}async doLoad(){var a,l;if(!this._drivenProperties.size){const c=TN(this._getSymbolSize());if(c)throw new X("graphics3dextrudesymbollayer:invalid-size",c)}const e=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,r=this._getCombinedOpacityAndColor(e),i=Oo(r),s=r[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:s,transparent:n,cullFace:n?oi.None:oi.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:Tr.Compressed};this._materials[ec.Main]=new od(o),this._materials[ec.Bottom]=new od({...o,cullFace:oi.Back}),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,OYe,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r);return this._createAs3DShape(r,e.renderingInfo,i,s,r.uid)}layerOpacityChanged(e,r){var a,l,c,u;const i=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,s=this._getCombinedOpacity(i),n=s<1||this.needsDrivenTransparentPass;(c=this._materials[ec.Main])==null||c.setParameters({opacity:s,transparent:n}),(u=this._materials[ec.Bottom])==null||u.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(d=>{const p=r(d);p!=null&&p.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,sy)}slicePlaneEnabledChanged(e,r){var i,s;return(i=this._materials[ec.Main])==null||i.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),(s=this._materials[ec.Bottom])==null||s.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(n=>{const o=r(n);o!=null&&o.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){var r,i;const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return(r=this._materials[ec.Main])==null||r.setParameters(e),(i=this._materials[ec.Bottom])==null||i.setParameters(e),!0}_getExtrusionSize(e){let r;return r=e.size&&this._drivenProperties.size?tqe(e.size,2)??0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(e,r){return this._drivenPropertiesChanged(r)?Ts.RecreateSymbol:Ts.RecreateGraphics}async queryForSnapping(e,r,i,s){const n=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/A$(r),{objectId:o,target:a}=e,l=ye(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:u}=e,d=ye(c),p=ye(u);return d.z=(d.z??0)+n,p.z=(p.z??0)+n,[wQ(o,l,1/0,d,p)]}case"vertex":return[kHe(o,l,1/0),wQ(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,r,i,s,n){const o=n3(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some($=>$.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=oH(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=Sj(o);if(l==null)return null;const c=new Array,u=new Array,d=tn(),p=ge(),g=E(),y=this._context.renderCoordsHelper.viewingMode===$e.Global;y||this._context.renderCoordsHelper.worldUpAtPosition(null,g),Ol(o.spatialReference,[l.x,l.y,0],p,this._context.renderCoordsHelper.spatialReference);const _=ge();Ls(_,p);const v=Fi();wm(v,_);const{polygons:w,mapPositions:x,position:T}=a;for(const $ of w){const D=$.count;if(this._context.clippingExtent&&(ui(d),yc(d,$.mapPositions),!zh(d,this._context.clippingExtent)))continue;const N=c2($.mapPositions,$.holeIndices,3);if(N.length===0)continue;const z=N.length,U=6*D,Y=wI(U+z),H=wI(z),V=Pn(3*U),J=Pn(3*U),P=Pn(3*U),I=Pn(U);MYe(T,x,N,$,V,P,J,I,Y,H,this._getExtrusionSize(r),g,y),ld(V,V,_);const B=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),G=new NYe(V,P,AYe(J),I);c.push(rK(this._materials[ec.Main],Y,Y.length-H.length,G,i,B),rK(this._materials[ec.Bottom],H,0,G,i,B)),u.push(G.heights)}if(c.length===0)return null;const S=new zm({geometries:c,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});S.transformation=p;const C=M0e(this.symbolLayer,{opacity:this._getLayerOpacity()}),A=C!=null?{baseMaterial:this._materials[ec.Main],edgeMaterials:[C],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,O=new rf(this,S,c,null,null,($,D,N,z,U)=>LYe($,D,N,z,U,u),s,A);return O.alignedSampledElevation=a.sampledElevation,O.needsElevationUpdates=sy(s.mode),O}};function rK(t,e,r,i,s,n){const o=gy(e.length),a=[[R.POSITION,new Ue(i.positions,e,3,!0)],[R.NORMALCOMPRESSED,new Ue(i.normals,e,2,!0)],[R.COLOR,new Ue(s,o,4,!0)]];return new Ds(t,a,i.elevation,Ki.Mesh,n,r)}function MYe(t,e,r,i,s,n,o,a,l,c,u,d,p){const g=r.length/3;let y=0,_=2*i.count;$Ye(t,e,i.index,i.count,r,0,g,s,n,o,a,l,c,_,u,d,p);let v=2*i.count;_=0,iK(s,n,a,o,y,i.pathLengths[0],i.count,v,l,_,u),v+=4*i.pathLengths[0],_+=2*i.pathLengths[0],y+=i.pathLengths[0];for(let w=1;w<i.pathLengths.length;++w)iK(s,n,a,o,y,i.pathLengths[w],i.count,v,l,_,u),v+=4*i.pathLengths[w],_+=2*i.pathLengths[w],y+=i.pathLengths[w]}function $Ye(t,e,r,i,s,n,o,a,l,c,u,d,p,g,y,_,v){ie(Ca,_);const w=y>0?1:-1;let x=3*r,T=0,S=3*T,C=i,A=3*C;for(let D=0;D<i;++D)v&&(Ca[0]=t[x],Ca[1]=t[x+1],Ca[2]=t[x+2],pe(Ca,Ca)),a[S]=t[x],a[S+1]=t[x+1],a[S+2]=t[x+2],l[S]=e[x],l[S+1]=e[x+1],l[S+2]=e[x+2],c[S]=-w*Ca[0],c[S+1]=-w*Ca[1],c[S+2]=-w*Ca[2],u[T]=0,a[A]=t[x]+y*Ca[0],a[A+1]=t[x+1]+y*Ca[1],a[A+2]=t[x+2]+y*Ca[2],l[A]=e[x],l[A+1]=e[x+1],l[A+2]=e[x+2],c[A]=w*Ca[0],c[A+1]=w*Ca[1],c[A+2]=w*Ca[2],u[C]=y,S+=3,A+=3,x+=3,T+=1,C+=1;x=3*n,S=0,A=3*g;const O=y<0?cK:lK,$=y<0?lK:cK;for(let D=0;D<o;++D)p[S]=s[x+O[0]],p[S+1]=s[x+O[1]],p[S+2]=s[x+O[2]],d[A]=s[x+$[0]]+i,d[A+1]=s[x+$[1]]+i,d[A+2]=s[x+$[2]]+i,S+=3,A+=3,x+=3}function vO(t,e,r,i,s,n,o){i[n]=i[o],o*=3,t[n*=3]=t[o],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n]=e[o],e[n+1]=e[o+1],e[n+2]=e[o+2],r[n]=s[0],r[n+1]=s[1],r[n+2]=s[2]}const OT=E();function iK(t,e,r,i,s,n,o,a,l,c,u){let d=s,p=s+1,g=s+o,y=s+o+1,_=a,v=a+1,w=a+2*n,x=a+2*n+1;u<0&&(d=s+o+1,y=s),c*=3;for(let T=0;T<n;++T)T===n-1&&(u>0?(p=s,y=s+o):(p=s,d=s+o)),IYe(t,d,p,g,OT),vO(t,e,i,r,OT,_,d),vO(t,e,i,r,OT,v,p),vO(t,e,i,r,OT,w,g),vO(t,e,i,r,OT,x,y),l[c++]=_,l[c++]=w,l[c++]=x,l[c++]=_,l[c++]=x,l[c++]=v,d++,p++,g++,y++,_+=2,v+=2,w+=2,x+=2}const TF=E(),sK=E(),nK=E(),oK=E(),aK=E();function IYe(t,e,r,i,s){e*=3,r*=3,i*=3,se(TF,t[e++],t[e++],t[e++]),se(sK,t[r++],t[r++],t[r++]),se(nK,t[i++],t[i++],t[i++]),ce(oK,sK,TF),ce(aK,nK,TF),rt(s,aK,oK),pe(s,s)}const bb=E();function LYe(t,e,r,i,s,n){const o=t.stageObject,a=o.geometries,l=a.length,c=e.mode!=="absolute-height";let u=0;const d=o.transformation,p=T2(ge(),d);for(let g=0;g<l;g+=2){const y=a[g];if(!Cj(y))continue;const _=y.getMutableAttribute(R.POSITION).data,v=n[g/2],w=new oG(y.mapPositions),x=_.length/3;let T=0,S=!1,C=0;for(let A=0;A<x;A++){bb[0]=_[T],bb[1]=_[T+1],bb[2]=_[T+2],i(w,bO),c&&(C+=bO.sampledElevation),Zr.TESTS_DISABLE_OPTIMIZATIONS?(se(rl,w.array[w.offset],w.array[w.offset+1],bO.z+v[T/3]),r!=null&&s.toRenderCoords(rl,r,rl),De(rl,rl,p)):(se(rl,_[T],_[T+1],_[T+2]),De(rl,rl,d),s.setAltitude(rl,bO.z+v[T/3]),De(rl,rl,p)),_[T]=rl[0],_[T+1]=rl[1],_[T+2]=rl[2];const O=DYe/s.unitInMeters;(Math.abs(bb[0]-_[T])>=O||Math.abs(bb[1]-_[T+1])>=O||Math.abs(bb[2]-_[T+2])>=O)&&(S=!0),w.offset+=3,T+=3}S&&(y.invalidateBoundingInfo(),o.geometryVertexAttributeUpdated(a[g],R.POSITION),a[g+1].invalidateBoundingInfo(),o.geometryVertexAttributeUpdated(a[g+1],R.POSITION)),u+=C/x}return u/l}const rl=E(),Ca=E(),bO=new nA,lK=[0,2,1],cK=[0,1,2],DYe=.01;var ec;(function(t){t[t.Main=0]="Main",t[t.Bottom=1]="Bottom"})(ec||(ec={}));class NYe{constructor(e,r,i,s){this.positions=e,this.elevation=r,this.normals=i,this.heights=s}}var uK,hK,GB={exports:{}};GB.exports,hK=function(){function t(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function e(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function r(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function i(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:of},u=of,d="none",p=")",g=",",y="(",_="%",v="px",w="cm",x="mm",T="in",S="pt",C="pc",A="deg",O="rad",$="grad",D="turn",N="#",z=".",U="e",Y=/^[ \t\n\r]/,H=/^[a-z\-]/,V=/^[0-9a-fA-F]/,J=/^[+\-]/,P=/^[0-9]/,I=va("none"),B=pn("none",!1),G=pn(")",!1),q=pn(",",!1),Z=va("whitespace"),K=wy([" ","	",`
`,"\r"],!1,!1),fe=va("function"),Pe=pn("(",!1),lt=va("identifier"),Tt=wy([["a","z"],"-"],!1,!1),it=va("percentage"),dt=pn("%",!1),Be=va("length"),Re=pn("px",!1),Ce=pn("cm",!1),_t=pn("mm",!1),Se=pn("in",!1),Ne=pn("pt",!1),We=pn("pc",!1),ht=va("angle"),bt=pn("deg",!1),Ct=pn("rad",!1),Gr=pn("grad",!1),Ie=pn("turn",!1),Lt=va("number"),Fe=va("color"),mt=pn("#",!1),gt=wy([["0","9"],["a","f"],["A","F"]],!1,!1),Mt=wy(["+","-"],!1,!1),$t=wy([["0","9"]],!1,!1),jr=pn(".",!1),ai=pn("e",!1),Hr=function(){return[]},Bt=function(j,ue){return{type:"function",name:j,parameters:ue||[]}},pr=function(j,ue){return ue.length>0?H2(j,ue,3):[j]},Er=function(j){return{type:"quantity",value:j.value,unit:j.unit}},pi=function(j){return{type:"color",colorType:j.type,value:j.value}},vi=function(j){return j},br=function(){return Ja()},ar=function(j){return{value:j,unit:"%"}},bi=function(j){return{value:j,unit:"px"}},Jr=function(j){return{value:j,unit:"cm"}},fr=function(j){return{value:j,unit:"mm"}},Qr=function(j){return{value:j,unit:"in"}},Ai=function(j){return{value:j,unit:"pt"}},ps=function(j){return{value:j,unit:"pc"}},In=function(j){return{value:j,unit:"deg"}},Ln=function(j){return{value:j,unit:"rad"}},_o=function(j){return{value:j,unit:"grad"}},ts=function(j){return{value:j,unit:"turn"}},Ri=function(j){return{value:j,unit:null}},or=function(){return{type:"hex",value:Ja()}},hn=function(j){return{type:"function",value:j}},eo=function(){return{type:"named",value:Ja()}},Yo=function(){return parseFloat(Ja())},re=0,fi=0,ju=[{line:1,column:1}],dn=0,Hu=[],Ye=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');u=c[n.startRule]}function Ja(){return s.substring(fi,re)}function pn(j,ue){return{type:"literal",text:j,ignoreCase:ue}}function wy(j,ue,we){return{type:"class",parts:j,inverted:ue,ignoreCase:we}}function xy(){return{type:"end"}}function va(j){return{type:"other",description:j}}function nf(j){var ue,we=ju[j];if(we)return we;for(ue=j-1;!ju[ue];)ue--;for(we={line:(we=ju[ue]).line,column:we.column};ue<j;)s.charCodeAt(ue)===10?(we.line++,we.column=1):we.column++,ue++;return ju[j]=we,we}function Ty(j,ue,we){var sr=nf(j),Ms=nf(ue),li={source:l,start:{offset:j,line:sr.line,column:sr.column},end:{offset:ue,line:Ms.line,column:Ms.column}};return we&&l&&typeof l.offset=="function"&&(li.start=l.offset(li.start),li.end=l.offset(li.end)),li}function qt(j){re<dn||(re>dn&&(dn=re,Hu=[]),Hu.push(j))}function Vm(j,ue,we){return new e(e.buildMessage(j,ue),j,ue,we)}function of(){var j;return(j=Gm())===a&&(j=Xo()),j}function Gm(){var j,ue;return Ye++,j=re,Wi(),s.substr(re,4)===d?(ue=d,re+=4):(ue=a,Ye===0&&qt(B)),ue!==a?(Wi(),fi=j,j=Hr()):(re=j,j=a),Ye--,j===a&&Ye===0&&qt(I),j}function Xo(){var j,ue;if(j=[],(ue=Qa())!==a)for(;ue!==a;)j.push(ue),ue=Qa();else j=a;return j}function Qa(){var j,ue,we,sr;return j=re,Wi(),(ue=jm())!==a?(Wi(),(we=gd())===a&&(we=null),Wi(),s.charCodeAt(re)===41?(sr=p,re++):(sr=a,Ye===0&&qt(G)),sr!==a?(Wi(),fi=j,j=Bt(ue,we)):(re=j,j=a)):(re=j,j=a),j}function gd(){var j,ue,we,sr,Ms,li,Zo,Ay;if(j=re,(ue=fn())!==a){for(we=[],sr=re,Ms=Wi(),s.charCodeAt(re)===44?(li=g,re++):(li=a,Ye===0&&qt(q)),li===a&&(li=null),Zo=Wi(),(Ay=fn())!==a?sr=Ms=[Ms,li,Zo,Ay]:(re=sr,sr=a);sr!==a;)we.push(sr),sr=re,Ms=Wi(),s.charCodeAt(re)===44?(li=g,re++):(li=a,Ye===0&&qt(q)),li===a&&(li=null),Zo=Wi(),(Ay=fn())!==a?sr=Ms=[Ms,li,Zo,Ay]:(re=sr,sr=a);fi=j,j=pr(ue,we)}else re=j,j=a;return j}function fn(){var j,ue;return j=re,(ue=Ey())===a&&(ue=Fv())===a&&(ue=Cy())===a&&(ue=Hm()),ue!==a&&(fi=j,ue=Er(ue)),(j=ue)===a&&(j=re,(ue=wA())!==a&&(fi=j,ue=pi(ue)),j=ue),j}function Wi(){var j,ue;for(Ye++,j=[],Y.test(s.charAt(re))?(ue=s.charAt(re),re++):(ue=a,Ye===0&&qt(K));ue!==a;)j.push(ue),Y.test(s.charAt(re))?(ue=s.charAt(re),re++):(ue=a,Ye===0&&qt(K));return Ye--,ue=a,Ye===0&&qt(Z),j}function jm(){var j,ue,we;return Ye++,j=re,(ue=Sy())!==a?(s.charCodeAt(re)===40?(we=y,re++):(we=a,Ye===0&&qt(Pe)),we!==a?(fi=j,j=vi(ue)):(re=j,j=a)):(re=j,j=a),Ye--,j===a&&(ue=a,Ye===0&&qt(fe)),j}function Sy(){var j,ue,we;if(Ye++,j=re,ue=[],H.test(s.charAt(re))?(we=s.charAt(re),re++):(we=a,Ye===0&&qt(Tt)),we!==a)for(;we!==a;)ue.push(we),H.test(s.charAt(re))?(we=s.charAt(re),re++):(we=a,Ye===0&&qt(Tt));else ue=a;return ue!==a&&(fi=j,ue=br()),Ye--,(j=ue)===a&&(ue=a,Ye===0&&qt(lt)),j}function Ey(){var j,ue,we;return Ye++,j=re,Wi(),(ue=ba())!==a?(s.charCodeAt(re)===37?(we=_,re++):(we=a,Ye===0&&qt(dt)),we!==a?(fi=j,j=ar(ue)):(re=j,j=a)):(re=j,j=a),Ye--,j===a&&Ye===0&&qt(it),j}function Fv(){var j,ue,we;return Ye++,j=re,Wi(),(ue=ba())!==a?(s.substr(re,2)===v?(we=v,re+=2):(we=a,Ye===0&&qt(Re)),we!==a?(fi=j,j=bi(ue)):(re=j,j=a)):(re=j,j=a),j===a&&(j=re,Wi(),(ue=ba())!==a?(s.substr(re,2)===w?(we=w,re+=2):(we=a,Ye===0&&qt(Ce)),we!==a?(fi=j,j=Jr(ue)):(re=j,j=a)):(re=j,j=a),j===a&&(j=re,Wi(),(ue=ba())!==a?(s.substr(re,2)===x?(we=x,re+=2):(we=a,Ye===0&&qt(_t)),we!==a?(fi=j,j=fr(ue)):(re=j,j=a)):(re=j,j=a),j===a&&(j=re,Wi(),(ue=ba())!==a?(s.substr(re,2)===T?(we=T,re+=2):(we=a,Ye===0&&qt(Se)),we!==a?(fi=j,j=Qr(ue)):(re=j,j=a)):(re=j,j=a),j===a&&(j=re,Wi(),(ue=ba())!==a?(s.substr(re,2)===S?(we=S,re+=2):(we=a,Ye===0&&qt(Ne)),we!==a?(fi=j,j=Ai(ue)):(re=j,j=a)):(re=j,j=a),j===a&&(j=re,Wi(),(ue=ba())!==a?(s.substr(re,2)===C?(we=C,re+=2):(we=a,Ye===0&&qt(We)),we!==a?(fi=j,j=ps(ue)):(re=j,j=a)):(re=j,j=a)))))),Ye--,j===a&&Ye===0&&qt(Be),j}function Cy(){var j,ue,we;return Ye++,j=re,(ue=ba())!==a?(s.substr(re,3)===A?(we=A,re+=3):(we=a,Ye===0&&qt(bt)),we!==a?(fi=j,j=In(ue)):(re=j,j=a)):(re=j,j=a),j===a&&(j=re,(ue=ba())!==a?(s.substr(re,3)===O?(we=O,re+=3):(we=a,Ye===0&&qt(Ct)),we!==a?(fi=j,j=Ln(ue)):(re=j,j=a)):(re=j,j=a),j===a&&(j=re,(ue=ba())!==a?(s.substr(re,4)===$?(we=$,re+=4):(we=a,Ye===0&&qt(Gr)),we!==a?(fi=j,j=_o(ue)):(re=j,j=a)):(re=j,j=a),j===a&&(j=re,(ue=ba())!==a?(s.substr(re,4)===D?(we=D,re+=4):(we=a,Ye===0&&qt(Ie)),we!==a?(fi=j,j=ts(ue)):(re=j,j=a)):(re=j,j=a)))),Ye--,j===a&&(ue=a,Ye===0&&qt(ht)),j}function Hm(){var j,ue;return Ye++,j=re,Wi(),(ue=ba())!==a?(fi=j,j=Ri(ue)):(re=j,j=a),Ye--,j===a&&Ye===0&&qt(Lt),j}function wA(){var j,ue,we,sr;if(Ye++,j=re,s.charCodeAt(re)===35?(ue=N,re++):(ue=a,Ye===0&&qt(mt)),ue!==a){if(we=[],V.test(s.charAt(re))?(sr=s.charAt(re),re++):(sr=a,Ye===0&&qt(gt)),sr!==a)for(;sr!==a;)we.push(sr),V.test(s.charAt(re))?(sr=s.charAt(re),re++):(sr=a,Ye===0&&qt(gt));else we=a;we!==a?(fi=j,j=or()):(re=j,j=a)}else re=j,j=a;return j===a&&(j=re,(ue=Qa())!==a&&(fi=j,ue=hn(ue)),(j=ue)===a&&(j=re,(ue=Sy())!==a&&(fi=j,ue=eo()),j=ue)),Ye--,j===a&&(ue=a,Ye===0&&qt(Fe)),j}function ba(){var j,ue,we,sr,Ms,li,Zo;for(j=re,J.test(s.charAt(re))?(s.charAt(re),re++):Ye===0&&qt(Mt),ue=re,we=[],P.test(s.charAt(re))?(sr=s.charAt(re),re++):(sr=a,Ye===0&&qt($t));sr!==a;)we.push(sr),P.test(s.charAt(re))?(sr=s.charAt(re),re++):(sr=a,Ye===0&&qt($t));if(s.charCodeAt(re)===46?(sr=z,re++):(sr=a,Ye===0&&qt(jr)),sr!==a){if(Ms=[],P.test(s.charAt(re))?(li=s.charAt(re),re++):(li=a,Ye===0&&qt($t)),li!==a)for(;li!==a;)Ms.push(li),P.test(s.charAt(re))?(li=s.charAt(re),re++):(li=a,Ye===0&&qt($t));else Ms=a;Ms!==a?ue=we=[we,sr,Ms]:(re=ue,ue=a)}else re=ue,ue=a;if(ue===a)if(ue=[],P.test(s.charAt(re))?(we=s.charAt(re),re++):(we=a,Ye===0&&qt($t)),we!==a)for(;we!==a;)ue.push(we),P.test(s.charAt(re))?(we=s.charAt(re),re++):(we=a,Ye===0&&qt($t));else ue=a;if(ue!==a){if(we=re,s.charCodeAt(re)===101?(sr=U,re++):(sr=a,Ye===0&&qt(ai)),sr!==a){if(J.test(s.charAt(re))?(Ms=s.charAt(re),re++):(Ms=a,Ye===0&&qt(Mt)),Ms===a&&(Ms=null),li=[],P.test(s.charAt(re))?(Zo=s.charAt(re),re++):(Zo=a,Ye===0&&qt($t)),Zo!==a)for(;Zo!==a;)li.push(Zo),P.test(s.charAt(re))?(Zo=s.charAt(re),re++):(Zo=a,Ye===0&&qt($t));else li=a;li!==a?we=sr=[sr,Ms,li]:(re=we,we=a)}else re=we,we=a;we===a&&(we=null),fi=j,j=Yo()}else re=j,j=a;return j}function j2(j,ue){return j.map(function(we){return we[ue]})}function H2(j,ue,we){return[j].concat(j2(ue,we))}if((o=u())!==a&&re===s.length)return o;throw o!==a&&re<s.length&&qt(xy()),Vm(Hu,dn<s.length?s.charAt(dn):null,dn<s.length?Ty(dn,dn+1):Ty(dn,dn))}return t(e,Error),e.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,u=this.location.source+":"+c.line+":"+c.column;if(a){var d=this.location.end,p=r("",c.line.toString().length," "),g=a[l.line-1],y=(l.line===d.line?d.column:g.length+1)-l.column||1;n+=`
 --> `+u+`
`+p+` |
`+c.line+" | "+g+`
`+p+" | "+r("",l.column-1," ")+r("",y,"^")}else n+=`
 at `+u}return n},e.buildMessage=function(s,n){var o={literal:function(g){return'"'+l(g.text)+'"'},class:function(g){var y=g.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(g.inverted?"^":"")+y.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(g){return g.description}};function a(g){return g.charCodeAt(0).toString(16).toUpperCase()}function l(g){return g.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(g){return g.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function u(g){return o[g.type](g)}function d(g){var y,_,v=g.map(u);if(v.sort(),v.length>0){for(y=1,_=1;y<v.length;y++)v[y-1]!==v[y]&&(v[_]=v[y],_++);v.length=_}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function p(g){return g?'"'+l(g)+'"':"end of input"}return"Expected "+d(s)+" but "+p(n)+" found."},{SyntaxError:e,parse:i}},(uK=GB).exports&&(uK.exports=hK());var FYe=GB.exports;function CTt(t){if(!t||t.length===0)return null;if(typeof t=="string"){const r=dK(t);return r&&r.length!==0?r:null}const e=t.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new X("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:dK(r.value)}});e.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<e.length-1;r++){if(!hAe(e[r].effects,e[r+1].effects))throw new X("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[r].effects,b:e[r+1].effects});dAe(e[r].effects,e[r+1].effects)}return e.sort((r,i)=>i.scale-r.scale),e}function dK(t){let e;if(!t)return[];try{e=FYe.parse(t)}catch(r){throw new X("effect:invalid-syntax","Invalid effect syntax",{value:t,error:r})}return e.map(r=>UYe(r))}function UYe(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return kYe(t);case"opacity":return BYe(t);case"hue-rotate":return zYe(t);case"blur":return VYe(t);case"drop-shadow":return GYe(t);case"bloom":return jYe(t)}}catch(e){throw e.details.filter=t,e}throw new X("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function kYe(t){let e=1;return G2(t.parameters,1),t.parameters.length===1&&(e=Oh(t.parameters[0])),new k8(t.name,e)}function BYe(t){let e=1;return G2(t.parameters,1),t.parameters.length===1&&(e=Oh(t.parameters[0])),new Tae(e)}function zYe(t){let e=0;return G2(t.parameters,1),t.parameters.length===1&&(e=ZYe(t.parameters[0])),new wae(e)}function VYe(t){let e=0;return G2(t.parameters,1),t.parameters.length===1&&(e=uH(t.parameters[0]),pA(e,t.parameters[0])),new gae(e)}function GYe(t){const e=[];let r=null;for(const i of t.parameters)if(i.type==="color"){if(e.length&&Object.freeze(e),r)throw new X("effect:type-error","Accepts only one color",{});r=JYe(i)}else{const s=uH(i);if(Object.isFrozen(e))throw new X("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&pA(s,i)}if(e.length<2||e.length>3)throw new X("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new vae(e[0],e[1],e[2]||0,r||G_e("black"))}function jYe(t){let e=1,r=0,i=0;return G2(t.parameters,3),t.parameters[0]&&(e=Oh(t.parameters[0])),t.parameters[1]&&(r=uH(t.parameters[1]),pA(r,t.parameters[1])),t.parameters[2]&&(i=Oh(t.parameters[2])),new fae(e,r,i)}function G2(t,e){if(t.length>e)throw new X("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function NN(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in cH)return"<length>";if(t.unit in lH)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function pA(t,e){if(t<0)throw new X("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function HYe(t){if(t.type!=="quantity"||t.unit!==null)throw new X("effect:type-error",`Expected <double>, Actual: ${NN(t)}`,{term:t})}function qYe(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new X("effect:type-error",`Expected <double> or <percentage>, Actual: ${NN(t)}`,{term:t})}const lH={deg:1,grad:.9,rad:180/Math.PI,turn:360};function WYe(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&lH[t.unit]!=null))throw new X("effect:type-error",`Expected <angle>, Actual: ${NN(t)}`,{term:t})}const cH={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function YYe(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&cH[t.unit]!=null))throw new X("effect:type-error",`Expected <length>, Actual: ${NN(t)}`,{term:t})}function Oh(t){qYe(t);const e=t.value;return pA(e,t),t.unit==="%"?.01*e:e}function XYe(t){return HYe(t),pA(t.value,t),t.value}function ZYe(t){return WYe(t),t.value*lH[t.unit]||0}function uH(t){return YYe(t),t.value*cH[t.unit]||0}function JYe(t){switch(t.colorType){case"hex":return UCe(t.value);case"named":return G_e(t.value);case"function":return eXe(t.value)}}function G_e(t){if(!Ooe(t))throw new X("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return FCe(t)}const QYe=/^rgba?/i,KYe=/^hsla?/i;function eXe(t){if(G2(t.parameters,4),QYe.test(t.name))return[Oh(t.parameters[0]),Oh(t.parameters[1]),Oh(t.parameters[2]),t.parameters[3]?Oh(t.parameters[3]):1];if(KYe.test(t.name))return Poe(XYe(t.parameters[0]),Oh(t.parameters[1]),Oh(t.parameters[2]),t.parameters[3]?Oh(t.parameters[3]):1);throw new X("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function tXe(t){return typeof t=="function"}function ATt(t,e,r,i){return tXe(t)?t(e,r,i):t}function RTt(t){return[t.r,t.g,t.b,t.a]}const rXe=` /-,
`;function pK(t){let e=t.length;for(;e--;)if(!rXe.includes(t.charAt(e)))return!1;return!0}function iXe(t,e){const r=[];let i=0,s=-1;do if(s=t.indexOf("[",i),s>=i){if(s>i){const n=t.substr(i,s-i);r.push([n,null,pK(n)])}if(i=s+1,s=t.indexOf("]",i),s>=i){if(s>i){const n=e[t.substr(i,s-i)];n&&r.push([null,n,!1])}i=s+1}}while(s!==-1);if(i<t.length-1){const n=t.substr(i);r.push([n,null,pK(n)])}return r}function sXe(t,e,r){let i="",s=null;for(const n of e){const[o,a,l]=n;if(o)l?s=o:(s&&(i+=s,s=null),i+=o);else{const c=t.attributes[a];c&&(s&&(i+=s,s=null),i+=c)}}return nXe(i,r)}function OTt(t,e,r){const i=iXe(e,t);return s=>sXe(s,i,r)}function nXe(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function PTt(t,e,r,i,s,n,o=!0){const a=e/s,l=r/n,c=Math.ceil(a/2),u=Math.ceil(l/2);for(let d=0;d<n;d++)for(let p=0;p<s;p++){const g=4*(p+(o?n-d-1:d)*s);let y=0,_=0,v=0,w=0,x=0,T=0,S=0;const C=(d+.5)*l;for(let A=Math.floor(d*l);A<(d+1)*l;A++){const O=Math.abs(C-(A+.5))/u,$=(p+.5)*a,D=O*O;for(let N=Math.floor(p*a);N<(p+1)*a;N++){let z=Math.abs($-(N+.5))/c;const U=Math.sqrt(D+z*z);U>=-1&&U<=1&&(y=2*U*U*U-3*U*U+1,y>0&&(z=4*(N+A*e),S+=y*t[z+3],v+=y,t[z+3]<255&&(y=y*t[z+3]/250),w+=y*t[z],x+=y*t[z+1],T+=y*t[z+2],_+=y))}}i[g]=w/_,i[g+1]=x/_,i[g+2]=T/_,i[g+3]=S/v}}function j_e(t){return t?{r:t[0],g:t[1],b:t[2],a:t[3]/255}:{r:0,g:0,b:0,a:0}}function oXe(t){var e;return((e=t.data)==null?void 0:e.symbol)??null}function aXe(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function lXe(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function H_e(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const MTt=(t,e=0)=>t==null||isNaN(t)?e:t,$Tt=t=>t.tintColor?j_e(t.tintColor):{r:255,g:255,b:255,a:1},ITt=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function LTt(){return he(()=>import("./geometryEngineJSON-f1d85e8d.js"),["./geometryEngineJSON-f1d85e8d.js","./geometryEngineBase-28832c3f.js","./geometryEngineJSON-6db1e989.js","./json-48e3ea08.js"],import.meta.url)}function DTt(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function NTt(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function FTt(t){let e="normal",r="normal";if(t){const i=t.toLowerCase();i.includes("italic")?e="italic":i.includes("oblique")&&(e="oblique"),i.includes("bold")?r="bold":i.includes("light")&&(r="lighter")}return{style:e,weight:r}}function UTt(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function fK(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=fK(e);if(r!=null)return r}break;case"CIMTextSymbol":return fK(t.symbol);case"CIMSolidFill":return t.color}}function mK(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const r of e){const i=mK(r);if(i!=null)return i}break}case"CIMTextSymbol":return mK(t.symbol);case"CIMSolidStroke":return t.color}}function gK(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=gK(e);if(r!==void 0)return r}break;case"CIMTextSymbol":return gK(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function kTt(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function BTt(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function zTt(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const VTt=t=>t.includes("data:image/svg+xml");function GTt(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function q_e(t,e,r,i){if(t)if(t.type!=="CIMTextSymbol"){if(r&&t.effects)for(const s of t.effects)hXe(s,e);if(t.symbolLayers)for(const s of t.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":cXe(s,e,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!(i!=null&&i.preserveOutlineWidth)&&s.width&&(s.width*=e);break;case"CIMPictureFill":s.height&&(s.height*=e),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e);break;case"CIMHatchFill":q_e(s.lineSymbol,e,!0,{...i,preserveOutlineWidth:!1}),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e),s.separation&&(s.separation*=e)}}else t.height!=null&&(t.height*=e)}function cXe(t,e,r){if(t&&(t.markerPlacement&&uXe(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const i of t.markerGraphics)t.scaleSymbolsProportionally||q_e(i.symbol,e,!0,r)}function uXe(t,e){switch(H_e(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function hXe(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const r=t.dashTemplate.map(i=>i*e);t.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function dXe(t){const e=[];return jB(oXe(t),e),e.length?new qe(j_e(e[0])):null}function jB(t,e){var s;if(!t)return;let r;r=t.type==="CIMTextSymbol"?t.symbol:t;const i=t.type==="CIMPolygonSymbol";if(r!=null&&r.symbolLayers){for(const n of r.symbolLayers)if(!(n.colorLocked||i&&(lXe(n)||aXe(n)&&n.markerPlacement&&H_e(n.markerPlacement))))switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor&&yK(e,n.tintColor);break;case"CIMVectorMarker":(s=n.markerGraphics)==null||s.forEach(o=>{jB(o.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":yK(e,n.color);break;case"CIMHatchFill":jB(n.lineSymbol,e)}}}function yK(t,e){for(const r of t)if(r.join(".")===e.join("."))return;t.push(e)}let pXe=class{constructor(e,r){this._storage=new Qpe,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),r&&this._storage.registerRemoveFunc("",r)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,r,i=1){this._storage.put(this,e,r,i,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};new pXe(1e3);new qe([128,128,128]);const fXe=new qe("white");function mXe(t){var e;return((e=t.resource)==null?void 0:e.href)??""}function HTt(t,e){if(!t)return null;let r=null;return rv(t)?r=gXe(t):CD(t)&&(r=t.type==="cim"?dXe(t):t.color?new qe(t.color):null),r?l3(r,e):null}function gXe(t){const e=t.symbolLayers;if(!e)return null;let r=null;return e.forEach(i=>{var s;i.type==="object"&&((s=i.resource)!=null&&s.href)||(r=i.type==="water"?i.color:i.material?i.material.color:null)}),r?new qe(r):null}function l3(t,e){if(e==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*e,new qe(r)}function yXe(t,e,r){const i=t.symbolLayers;if(!i)return;const s=n=>l3(e=e??n??(r!=null?fXe:null),r);i.forEach(n=>{var o,a;if(n.type!=="object"||!((o=n.resource)!=null&&o.href)||e)if(n.type==="water")n.color=s(n.color);else{const l=n.material!=null?n.material.color:null,c=s(l);n.material==null?n.material=new Sc({color:c}):n.material.color=c,r!=null&&"outline"in n&&((a=n.outline)==null?void 0:a.color)!=null&&(n.outline.color=l3(n.outline.color,r))}})}function _Xe(t,e,r){var i;(e=e??t.color)&&(t.color=l3(e,r)),r!=null&&"outline"in t&&((i=t.outline)!=null&&i.color)&&(t.outline.color=l3(t.outline.color,r))}function qTt(t,e,r){t&&(e||r!=null)&&(e&&(e=new qe(e)),rv(t)?yXe(t,e,r):CD(t)&&_Xe(t,e,r))}async function vXe(t,e){const r=t.symbolLayers;r&&await jL(r,async i=>bXe(i,e))}async function bXe(t,e){switch(t.type){case"extrude":xXe(t,e);break;case"icon":case"line":case"text":wXe(t,e);break;case"path":SXe(t,e);break;case"object":await TXe(t,e)}}function wXe(t,e){const r=W_e(e);r!=null&&(t.size=r)}function W_e(t){for(const e of t)if(typeof e=="number")return e;return null}function xXe(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function TXe(t,e){const{resourceSize:r,symbolSize:i}=await EXe(t),s=Y_e(e,r,i);t.width=tC(e[0],i[0],r[0],s),t.depth=tC(e[1],i[1],r[1],s),t.height=tC(e[2],i[2],r[2],s)}function SXe(t,e){const r=Y_e(e,Jf,[t.width,void 0,t.height]);t.width=tC(e[0],t.width,1,r),t.height=tC(e[2],t.height,1,r)}function Y_e(t,e,r){for(let i=0;i<3;i++){const s=t[i];switch(s){case"symbol-value":{const n=r[i];return n!=null?n/e[i]:1}case"proportional":break;default:if(s&&e[i])return s/e[i]}}return 1}async function EXe(t){const{computeObjectLayerResourceSize:e}=await he(()=>import("./symbolLayerUtils-4a916319.js"),[],import.meta.url),r=await e(t,10),{width:i,height:s,depth:n}=t,o=[i,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function tC(t,e,r,i){switch(t){case"proportional":return r*i;case"symbol-value":return e??r;default:return t}}function CXe(t,e){const r=W_e(e);if(r!=null)switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const i=t.width/t.height;i>1?(t.width=r,t.height=r*i):(t.width=r*i,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function WTt(t,e){if(t&&e)return rv(t)?vXe(t,e):void(CD(t)&&CXe(t,e))}function YTt(t,e,r){if(t&&e!=null)if(rv(t)){const i=t.symbolLayers;i&&i.forEach(s=>{if(s&&s.type==="object")switch(r){case"tilt":s.tilt=e;break;case"roll":s.roll=e;break;default:s.heading=e}})}else CD(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function XTt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function ZTt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}function AXe(t,e,r,i,s){if(t==null)return null;const n=t.referencesGeometry()&&s?RXe(e,i,s):e,o=t.repurposeFeature(n);try{return t.evaluate({...r,$feature:o},t.services)}catch(a){return ne.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const SF=new Map;function RXe(t,e,r){const{transform:i,hasZ:s,hasM:n}=r;SF.has(e)||SF.set(e,OXe(e));const o=SF.get(e)(t.geometry,i,s,n);return{...t,geometry:o}}function OXe(t){const e={};switch(t){case"esriGeometryPoint":return(r,i,s,n)=>Eye(i,e,r,s,n);case"esriGeometryPolygon":return(r,i,s,n)=>Cye(i,e,r,s,n);case"esriGeometryPolyline":return(r,i,s,n)=>Aye(i,e,r,s,n);case"esriGeometryMultipoint":return(r,i,s,n)=>Sye(i,e,r,s,n);default:return ne.getLogger("esri.views.2d.support.arcadeOnDemand").error(new X("mapview-arcade",`Unable to handle geometryType: ${t}`)),r=>r}}const JTt=1.2,PXe=Ec,MXe=4;let FN=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Pi.ADD);if(e||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,qs.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Pi.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=E()){return se(e,0,0,0)}getBoundingBoxObjectSpace(e=tn()){return ui(e)}addObjectState(e,r){e===Tm.Highlight&&(this.renderGeometries.forEach(i=>{const s=i.geometry.addHighlight();r.addRenderGeometry(i,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,qs.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(r=>{e.removeRenderGeometry(r)})}removeRenderGeometryObjectState(e,r){e.geometry.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,qs.HIGHLIGHT)}computeAttachmentOrigin(e){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(wb)&&(e.draped.origin[0]+=wb[0],e.draped.origin[1]+=wb[1],e.draped.num++)}async getProjectedBoundingBox(e,r,i,s,n){ui(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,_K,i),NMe(n,_K)}if(r){let o;Bh(n,wb);const a=Ej(n,r.service.spatialReference,r);try{o=await r.service.queryElevation(wb[0],wb[1],s,a,"ground")}catch{}o!=null&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(e,r,i,s){if(this.boundingBox)_D(Rd,this.boundingBox);else{const n=e.boundingSphere,o=n[3];Rd[0]=n[0]-o,Rd[1]=n[1]-o,Rd[2]=n[2]-o,Rd[3]=n[0]+o,Rd[4]=n[1]+o,Rd[5]=n[2]+o}return r(Rd,0,2),this.calculateRelativeScreenBounds&&s.push({location:Bh(Rd),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),cV(Rd,i)}};const _K=Gt(),Rd=tn(),wb=E();function QI(t,e,r){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=r,t.canvas}function X_e(t){const{size:e}=t.definition,r=t.fontString(e);let i=vK.get(r);if(!i){const s=QI(IXe,0,0).getContext("2d");t.setFontProperties(s,e);const n=s.measureText(LXe);i=new $Xe(n.actualBoundingBoxAscent,n.actualBoundingBoxDescent),vK.set(r,i)}return i}const vK=new Map;let $Xe=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,r){this.maxAscent=e,this.maxDescent=r}};const IXe={canvas:null},LXe=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),KI=1;let Z_e=class{constructor(e,r,i,s){this.text=e,this._alignment=r,this._parameters=i,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.replaceAll(" ","Â ").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let r=0;r<this._lines.length-1;r++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=QI(bK,wO,wO).getContext("2d");this._parameters.setFontProperties(e,this._fontSize);let r=2*this._haloSize;const i=this._parameters.definition.font;i.style!=="italic"&&i.style!=="oblique"&&i.weight!=="bold"&&i.weight!=="bolder"||(r+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s,n,o=0,a=0,l=0;this._lines.forEach((p,g)=>{const y=e.measureText(p),_=y.width,v=_+r;this._textWidths.push(_),this._lineWidths.push(v),o=Math.max(o,v),a=Math.max(a,y.actualBoundingBoxAscent),l=Math.max(l,y.actualBoundingBoxDescent),g===0&&(s=y),g===this._lines.length-1&&(n=y)});const c=X_e(this._parameters);a=Math.max(a,c.maxAscent),l=Math.max(l,c.maxDescent);const u=s.actualBoundingBoxAscent,d=this._parameters.definition.font.decoration==="underline"?l:n.actualBoundingBoxDescent;this._metricsCached=new NXe(u,d,a,l,o)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*DXe}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,KI)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case N0.Left:return this._horizontalPadding;case N0.Center:return(this.displayWidth-this._lineWidths[e])/2;case N0.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,r,i){e.save();const s=r/=this.renderPixelRatio,n=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;r+=o,i+=a;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const u=this._lines[c],d=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,r+d,i),this._renderLineDecoration(e,r+d,i,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,r+this._getLineXOffset(c),i),this._renderLineDecoration(e,r+d,i,this._textWidths[c]),i+=this._lineSpacing}if(Zr.TEXT_SHOW_BASELINE){e.strokeStyle=wK,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let u=0;u<this._lines.length;++u)this._drawLine(e,[s,c],[s+this.displayWidth,c]),c+=this._lineSpacing}if(Zr.TEXT_SHOW_BORDER&&(e.strokeStyle=wK,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,r,i,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._midLineAscent}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(r+s+l),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,r,i,s){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=me(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(r,i+s),e.arcTo(r,i,r+s,i,s),e.lineTo(r+n-s,i),e.arcTo(r+n,i,r+n,i+s,s),e.lineTo(r+n,i+o-s),e.arcTo(r+n,i+o,r+n-s,i+o,s),e.lineTo(r+s,i+o),e.arcTo(r,i+o,r,i+o-s,s),e.closePath()):e.rect(r,i,n,o)}_renderHalo(e,r,i,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=QI(bK,Math.max(o,wO),Math.max(a,wO)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let d=n;for(let p=0;p<this._lines.length;++p){const g=this._getLineXOffset(p);this._renderLineDecoration(c,s+g,d,this._textWidths[p],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),e.globalAlpha=1}_renderHaloEmulated(e,r,i){for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of J_e)this._fillText(e,n,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(e,r,i){const s=2*this._haloSize;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let u=0;u<l;u++){const d=1-(l-1)*c+u*c;e.lineWidth=this._toRenderUnit(d*s),this._strokeText(e,o,r+a,i)}i+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,r,i,s){e.fillText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_strokeText(e,r,i,s){e.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_drawLine(e,r,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,r,i){const s=this._toRenderUnit(r[0]),n=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,u=Math.floor(n)+.5,d=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,u),e.lineTo(c,u),e.lineTo(c,d),e.lineTo(l,d),e.lineTo(l,u),e.stroke()}};const J_e=[];for(let e=0;e<360;e+=360/16)J_e.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var N0;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(N0||(N0={}));const bK={canvas:null},DXe=.2,wO=512,wK="rgb(255, 0, 255, 0.5)";let NXe=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,r,i,s,n){this.firstLineAscent=e,this.lastLineDescent=r,this.maxLineAscent=i,this.maxLineDescent=s,this.displayWidth=n}};const FXe=Object.freeze({left:0,center:.5,right:1}),NM=Object.freeze({"bottom-left":tr(0,0),bottom:tr(.5,0),"bottom-right":tr(1,0),left:tr(0,.5),center:tr(.5,.5),right:tr(1,.5),"top-left":tr(0,1),top:tr(.5,1),"top-right":tr(1,1)});function Q_e(t){switch(t){case"left":return N0.Left;case"right":return N0.Right;default:return N0.Center}}function xK(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function UXe(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function kXe(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function BXe(t){return t==="middle"?"center":t}function zXe(t,e){switch(t){case"top":return ir(e,0,KI);case"bottom":return ir(e,0,-KI);default:return Ns(e,_m)}}let h2=class{constructor(e,r={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=ge(),this._shaderTransformation=null,this._boundingSphere=null,this.id=bc(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.castShadow=r.castShadow??!1,r.objectShaderTransformation!=null&&this.objectShaderTransformationChanged(r.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){Ss(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=ge()),Pr(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??(this._boundingSphere=ds()),De(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*jx(this.shaderTransformation)),this._boundingSphere):nhe}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation==null?this.transformation:this._shaderTransformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const TK=Te(0,0,1),VXe=16,GXe=1.5,b1=Jj,jXe=[b1/2,b1/2,1-b1/2,1-b1/2],HXe=[YI*b1,YI*b1];let HB=class K_e extends sf{getCachedSize(){return{size:this._getIconSize()}}constructor(e,r,i,s){super(e,r,i,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(i!=null)this._prepareResourcesPrimitive(r,i);else{const s=mXe(this.symbolLayer),n=B0(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(n.data),e):await this._prepareResourcesHref(r,s,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=TN(this._getIconSize());if(e)throw new X("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,r=Math.round(e.size!=null?Fo(e.size):VXe);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(e){const r=this._getGraphicHash(e);let i=r===""?null:this._cimSymbolTextures.get(r);if(!i){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",s,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height};i=new Nv(n.imageData,o),this._cimSymbolTextures.set(r,i),this._context.stage.add(i)}return i}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(qXe(r)){const{screenLength:i,minWorldLength:s,maxWorldLength:n}=r.verticalOffset;e.verticalOffset={screenLength:Fo(i),minWorldLength:s||0,maxWorldLength:n??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,r){const i=this._getOutlineSize();if(EF(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const n=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>bWe(r));this._textureHandle=n,e.textureId=n.texture.id}e.textureIsSignedDistanceField=!0,e.sampleSignedDistanceFieldTexelCenter=vWe(r),e.distanceFieldBoundingBox=jXe;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/b1,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,r,i){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await mm(this._context.sharedResources.textures.fromUrl(r,n,{signal:i}));if(o.ok===!1)throw ly(o.error),new X("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._textureHandle=o.value;const a=o.value.texture,l=a.parameters.width/a.parameters.height;this._size=l>1?[s,Math.round(s/l)]:[Math.round(s*l),s],e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,r,i){const s=new N3({data:r});if(!this._context.sharedResources.cimSymbolRasterizer){const u=(await he(()=>import("./CIMSymbolRasterizer-1bcb99dd.js"),["./CIMSymbolRasterizer-1bcb99dd.js","./cimAnalyzer-bf709f50.js","./labelPoint-773cc97e.js","./TileClipper-ae6eca9e.js","./definitions-f7ca1c70.js","./number-e491b09e.js","./BidiEngine-9a40f2f4.js","./rasterizingUtils-640ee782.js"],import.meta.url)).CIMSymbolRasterizer;wt(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new u(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(u=>u.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol3D(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const u=this._context.renderer;if(isNaN(u.scaleExpression)){const d=u.scaleExpression,p=await xPe(d,this._context.layer.spatialReference,n);a=(g,y,_)=>{const v=AXe(p,g,{$view:_},"esriGeometryPoint",y);return v!==null?v:1}}else o=Number(u.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];wt(i);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(u=>c.get(u).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||r$e}_getOutlineSize(){var i;let e=0;const r=this.symbolLayer;return((i=r.outline)==null?void 0:i.size)!=null?Math.max(Fo(r.outline.size),0):(e=EF(this._getPrimitive())?GXe:0,Math.max(e,0))}_getOutlineColor(){var s;const e=this._getLayerOpacity(),r=this.symbolLayer,i=(s=r==null?void 0:r.outline)==null?void 0:s.color;if(i!=null){const n=qe.toUnitRGB(i),o=i.a*e;return[n[0],n[1],n[2],o]}return[0,0,0,0]}_getFillColor(){var i,s;if(EF(this._getPrimitive()))return PXe;const e=this._getPrimitive()==null,r=(s=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:s.color;return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:e})}_getAnchorPos(e,r){return e==="relative"?tr((r.x||0)+.5,.5-(r.y||0)):e in NM?NM[e]:NM.center}_createMaterialAndAddToStage(e,r){if(this._cimLayers){this._fastUpdates=null;let i=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new a2(e),this._cimSymbolMaterials.set(e.textureId??0,i),r.add(i)),i}return this._fastUpdates=s2(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._materials[0]=new a2(e),r.add(this._materials[0]),this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._textureHandle=Zt(this._textureHandle)}_getScaleFactor(e,r){if(this._drivenProperties.size&&e.size){for(let i=0;i<3;i++){const s=e.size[i];s&&s!=="symbol-value"&&s!=="proportional"&&(e.size[i]=Fo(s))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/r;if(isFinite(+e.size[2]))return+e.size[2]/r}return 1}createGraphics3DGraphic(e){var d;const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;let i,s=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(r),g={textureId:p.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(g,this._context.stage),s=[p.parameters.width,p.parameters.height]}else s=this._size,i=this._materials[0];const n=i3(r.geometry);if(n==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!((d=this._fastUpdates)!=null&&d.visualVariables.size)){const p=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=tr(s[0]*l,s[1]*l),u=this.setGraphicElevationContext(r);return this.ensureDrapedStatus(u.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,n,i,a,c,e.layer.uid):this._createAs3DShape(r,n,i,a,c,u,r.uid)}layerOpacityChanged(){const e=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:e}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=sA(K_e.elevationModeChangeTypes,i,s);if(n!==es.UPDATE)return n;const o=ku(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,r){var i;for(const s in e.diff){if(s!=="visualVariables"||!n2(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return Ts.RecreateSymbol;(i=this._materials[0])==null||i.setParameters(this._fastUpdates.materialParameters)}return Ts.FastUpdate}_defaultElevationInfoNoZ(){return WXe}_createAs3DShape(e,r,i,s,n,o,a){const l=this.getFastUpdateAttrValues(e),c=this._context.layer.uid,u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:c}),d=eB(i,TK,null,s,n,YXe,null,l,u),p=Fj(this._context,r,d,o,a);if(p==null)return null;const g=new rf(this,p.object,[d],null,null,I1,o);return g.alignedSampledElevation=p.sampledElevation,g.needsElevationUpdates=ku(o.mode)||o.mode==="absolute-height",g.getScreenSize=this._createScreenSizeGetter(n,l),g.calculateRelativeScreenBounds=y=>i.calculateRelativeScreenBounds(g.getScreenSize(),1,y),r3(g,r,this._context.elevationProvider),g}_createAsOverlay(e,r,i,s,n,o){i.renderPriority=this._renderPriority;const a=Jt();Ll(r,a,this._context.overlaySR),a[2]=nH;const l=this._context.clippingExtent;if(l!=null&&!lV(l,a))return null;const c=this.getFastUpdateAttrValues(e),u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),d=eB(i,TK,a,s,n,null,null,c,u),p=new h2(d,{layerUid:o,graphicUid:e.uid}),g=new FN(this,[p],null,this._context.drapeSourceRenderer);return g.getScreenSize=this._createScreenSizeGetter(n,c),g.calculateRelativeScreenBounds=y=>i.calculateRelativeScreenBounds(g.getScreenSize(),1,y),g}_createScreenSizeGetter(e,r){const i=this._outlineSize+2;if(this._fastUpdates&&r){const o=e[0]/this._symbolTextureRatio,a=e[1]/this._symbolTextureRatio;return(l=ke())=>{const[c,u]=dj(XXe,this._fastUpdates.materialParameters,r);return l[0]=c*o+i,l[1]=u*a+i,l}}const s=e[0]/this._symbolTextureRatio+i,n=e[1]/this._symbolTextureRatio+i;return(o=ke())=>(o[0]=s,o[1]=n,o)}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),r=Te(e,e,e),i=Kh(1),s=e*i,n=Te(s,s,s);return new eA({size:!0,color:!0,rotation:!0,opacity:!1},r,n,i)}_getGraphicHash(e){let r="";for(const i of this._cimRequiredFields)r+=i+e.attributes[i];return r}_forEachMaterial(e){this._materials.forEach(e),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._materials[0]}}};function qXe(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function EF(t){return t!=null&&(t==="cross"||t==="x")}HB.PRIMITIVE_SIZE=HXe,HB.elevationModeChangeTypes={definedChanged:es.UPDATE,staysOnTheGround:es.NONE,onTheGroundChanged:es.RECREATE};const WXe={mode:"relative-to-ground",offset:0},YXe=Ot(0,0,0,1),XXe=E();function qB(t){switch(t){case"butt":return Su.BUTT;case"square":return Su.SQUARE;case"round":return Su.ROUND;default:return null}}function SK(t){return t==="diamond"?"kite":t}function WB(t,e,r=null){const i=[],s=e.mapPositions;ZXe(e,i);const n=i[0][1].data,o=i[0][1].indices.length,a=gy(o);return JXe(e,i,a),eZe(e,i,a),QXe(e,i,a),KXe(e,i,a),tZe(e,i,a),rZe(e,i,a),iZe(e,i,n),new Ds(t,i,s,Ki.Line,r)}function ZXe(t,e){const{attributeData:{position:r},removeDuplicateStartEnd:i}=t,s=sZe(r)&&i,n=r.length/3-(s?1:0),o=new Array(2*(n-1)),a=s?r.slice(0,-3):r;let l=0;for(let c=0;c<n-1;c++)o[l++]=c,o[l++]=c+1;e.push([R.POSITION,new Ue(a,o,3,s)])}function JXe(t,e,r){if(t.attributeData.colorFeature!=null)return;const i=t.attributeData.color;e.push([R.COLOR,new Ue(i??vu,r,4)])}function QXe(t,e,r){t.attributeData.normal&&e.push([R.NORMAL,new Ue(t.attributeData.normal,r,3)])}function KXe(t,e,r){t.attributeData.colorFeature!=null&&e.push([R.COLORFEATUREATTRIBUTE,new Ue([t.attributeData.colorFeature],r,1,!0)])}function eZe(t,e,r){t.attributeData.sizeFeature==null&&e.push([R.SIZE,new Ue([t.attributeData.size??1],r,1,!0)])}function tZe(t,e,r){t.attributeData.sizeFeature!=null&&e.push([R.SIZEFEATUREATTRIBUTE,new Ue([t.attributeData.sizeFeature],r,1,!0)])}function rZe(t,e,r){t.attributeData.opacityFeature!=null&&e.push([R.OPACITYFEATUREATTRIBUTE,new Ue([t.attributeData.opacityFeature],r,1,!0)])}function iZe(t,e,r){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==$e.Global||!t.overlayInfo.spatialReference.isGeographic)return;const i=Pn(r.length),s=Mr(t.overlayInfo.spatialReference);for(let d=0;d<i.length;d+=3)TV(r,d,i,d,s);const n=r.length/3,o=Gi(n+1);let a=nZe,l=oZe,c=0,u=0;se(a,i[u++],i[u++],i[u++]),o[0]=0;for(let d=1;d<n+1;++d)d===n&&(u=0),se(l,i[u++],i[u++],i[u++]),c+=Dpe(a,l),o[d]=c,[a,l]=[l,a];e.push([R.DISTANCETOSTART,new Ue(o,e[0][1].indices,1,!0)])}function sZe(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const nZe=E(),oZe=E();function iSt(t,e){if(t==null||t.length===0)return[];const r=[];return t.forEach(i=>{const s=i.length,n=Pn(3*s);i.forEach((a,l)=>{n[3*l]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};r.push(o)}),r}function aZe(t,e,r,i){const s=t.type==="polygon"?jp.CCW_IS_HOLE:jp.NONE,n=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=hA(n,!!t.hasZ,s,t.spatialReference),l=Pn(o.length),c=m0e(o,t.spatialReference,0,l,0,o,0,o.length/3,e,r,i),u=c!=null;return{lines:u?e1e(a,o,l):[],projectionSuccess:u,sampledElevation:c}}function lZe(t,e){const r=t.type==="polygon"?jp.CCW_IS_HOLE:jp.NONE,i=t.type==="polygon"?t.rings:t.paths,{position:s,outlines:n}=hA(i,!1,r),o=Ni(s,t.spatialReference,0,s,e,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=nH;return{lines:o?e1e(n,s):[],projectionSuccess:o}}function e1e(t,e,r=null){const i=new Array;for(const{index:s,count:n}of t){if(n<=1)continue;const o=3*s,a=3*n;i.push({position:Tu(e,3*s,3*n),mapPositions:r!=null?Tu(r,o,a):void 0})}return i}function cZe(t){const e=new dr,r=t.multipassEnabled&&(t.output===L.Color||t.output===L.Alpha),i=t.space===Rc.World;e.include(s_e,t),e.include(w_e,t),t.output===L.Depth&&e.include(Em,t);const{vertex:s,fragment:n}=e;return n.include(zu),Rl(s,t),e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.UV0,"vec2"),e.attributes.add(R.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),Q0(e),r&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),s.uniforms.add(new Ir("nearFar",(o,a)=>a.camera.nearFar),new nr("viewport",(o,a)=>a.camera.fullViewport)),s.code.add(b`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(b`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(e.attributes.add(R.NORMAL,"vec3"),e2(s),s.constants.add("tiltThreshold","float",.7),s.code.add(b`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(b`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(b`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===fv.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===Rc.Screen&&(s.uniforms.add(new Li("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(b`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(b`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new Ee("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(b`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),N2(s),KD(e),s.code.add(b`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),i?(t.hideOnShortSegments&&s.code.add(b`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(b`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(b`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===Rc.Screen&&s.code.add(b`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(b`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&e.include(Nl,t),e.include(us,t),n.uniforms.add(new nr("intrinsicColor",o=>o.color),new Ze("tex",o=>o.markerTexture)),n.include(tf),e.constants.add("texelSize","float",1/N1),n.code.add(b`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",Qj/N1),e.constants.add("relativeTipLineWidth","float",OWe),n.code.add(b`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",qn),n.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===L.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===L.Alpha?b`fragColor = vec4(finalColor.a);`:""}
    ${t.output===L.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===L.Color&&t.transparencyPassType===Qe.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===L.Highlight?b`fragColor = vec4(1.0);`:""}
    ${t.output===L.Depth?b`outputDepth(linearDepth);`:""}
  }
  `),e}const uZe=Object.freeze(Object.defineProperty({__proto__:null,build:cZe},Symbol.toStringTag,{value:"Module"})),t1e=new Map([[R.POSITION,0],[R.UV0,1],[R.AUXPOS1,2],[R.NORMAL,3],[R.COLOR,4],[R.COLORFEATUREATTRIBUTE,4],[R.SIZE,5],[R.SIZEFEATUREATTRIBUTE,5],[R.OPACITYFEATUREATTRIBUTE,6]]);let r1e=class i1e extends Sr{initializeProgram(e){return new vr(e.rctx,i1e.shader.get().build(this.configuration),t1e)}_makePipelineState(e,r){const i=this.configuration,s=e===Qe.NONE;return Et({blending:i.output===L.Color||i.output===L.Alpha?s?Ac:Bm(e):null,depthTest:{func:vy(e)},depthWrite:s?i.writeDepth?Xa:null:vN(e),colorWrite:Ut,stencilWrite:i.hasOccludees?Gp:null,stencilTest:i.hasOccludees?r?ny:by:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Et({blending:Ac,depthTest:zI,depthWrite:null,colorWrite:Ut,stencilWrite:null,stencilTest:F0e}),this._occluderPipelineOpaque=Et({blending:Ac,depthTest:zI,depthWrite:null,colorWrite:Ut,stencilWrite:D0e,stencilTest:N0e}),this._occluderPipelineMaskWrite=Et({blending:null,depthTest:Oj,depthWrite:null,colorWrite:null,stencilWrite:Gp,stencilTest:ny})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e,r,i){return e?this._occludeePipelineState:this.configuration.occluder?i?this._occluderPipelineTransparent:r?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};r1e.shader=new _r(uZe,()=>he(()=>import("./LineMarker.glsl-84a37608.js"),[],import.meta.url));let hZe=class extends yy{constructor(e){super(e,new pZe),this._vertexAttributeLocations=t1e,this._configuration=new _n,this._layout=this.createLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.space=r.slot===oe.DRAPED_MATERIAL?Rc.Draped:this.parameters.worldSpace?Rc.World:Rc.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Su.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===Ti.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=Ci().vec3f(R.POSITION).vec2f(R.UV0).vec3f(R.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(R.NORMAL),this.parameters.vvSize?e.f32(R.SIZEFEATUREATTRIBUTE):e.f32(R.SIZE),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4f(R.COLOR),this.parameters.vvOpacity&&e.f32(R.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new fZe(this._layout,this.parameters)}produces(e,r){return r===L.Color||r===L.Alpha||r===L.Highlight||r===L.Depth?e===oe.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Ti.OccludeAndTransparentStencil?e===oe.OPAQUE_MATERIAL||e===oe.OCCLUDER_MATERIAL||e===oe.TRANSPARENT_OCCLUDER_MATERIAL:r===L.Color||r===L.Alpha?e===(this.parameters.writeDepth?oe.TRANSPARENT_MATERIAL:oe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===oe.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new dZe(e)}},dZe=class extends EG{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextureRepository.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const r=this._material.parameters.markerPrimitive;return r!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(r,this._markerPrimitive)}),this._markerPrimitive=r),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r1e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==L.Color&&this._output!==L.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},pZe=class extends iA{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=Su.BUTT,this.anchor=fv.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},fZe=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,r,i,s,n){const o=i.attributes.get(R.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.attributes.get(R.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let u=1,d=0;this._parameters.vvSize?d=i.attributes.get(R.SIZEFEATUREATTRIBUTE).data[0]:i.attributes.has(R.SIZE)&&(u=i.attributes.get(R.SIZE).data[0]);let p=[1,1,1,1],g=0;this._parameters.vvColor?g=i.attributes.get(R.COLORFEATUREATTRIBUTE).data[0]:i.attributes.has(R.COLOR)&&(p=i.attributes.get(R.COLOR).data);let y=0;this._parameters.vvOpacity&&(y=i.attributes.get(R.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(s.buffer);let v=n*(this.vertexBufferLayout.stride/4);const w=(C,A,O,$)=>{if(_[v++]=C[0],_[v++]=C[1],_[v++]=C[2],_[v++]=O[0],_[v++]=O[1],_[v++]=A[0],_[v++]=A[1],_[v++]=A[2],this._parameters.worldSpace&&(_[v++]=l[0],_[v++]=l[1],_[v++]=l[2]),this._parameters.vvSize?_[v++]=d:_[v++]=u,this._parameters.vvColor)_[v++]=g;else{const D=Math.min(4*$,p.length-4);_[v++]=p[D],_[v++]=p[D+1],_[v++]=p[D+2],_[v++]=p[D+3]}this._parameters.vvOpacity&&(_[v++]=y)};let x;(function(C){C[C.ASCENDING=1]="ASCENDING",C[C.DESCENDING=-1]="DESCENDING"})(x||(x={}));const T=(C,A)=>{const O=se(mZe,o[3*C],o[3*C+1],o[3*C+2]),$=gZe;let D=C+A;do se($,o[3*D],o[3*D+1],o[3*D+2]),D+=A;while(Y1(O,$)&&D>=0&&D<a);e&&(De(O,O,e),De($,$,e)),w(O,$,[-1,-1],C),w(O,$,[1,-1],C),w(O,$,[1,1],C),w(O,$,[-1,-1],C),w(O,$,[1,1],C),w(O,$,[-1,1],C)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||T(0,x.ASCENDING),S!=="end"&&S!=="begin-end"||T(a-1,x.DESCENDING)}};const mZe=E(),gZe=E(),xo={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},yZe={dash:xo.dash,"dash-dot":[...xo.dash,...xo.dot],dot:xo.dot,"long-dash":xo["long-dash"],"long-dash-dot":[...xo["long-dash"],...xo.dot],"long-dash-dot-dot":[...xo["long-dash"],...xo.dot,...xo.dot],none:null,"short-dash":xo["short-dash"],"short-dash-dot":[...xo["short-dash"],...xo["short-dot"]],"short-dash-dot-dot":[...xo["short-dash"],...xo["short-dot"],...xo["short-dot"]],"short-dot":xo["short-dot"],solid:null},_Ze=8;function vZe(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function lSt(t){return{pattern:[t,t],pixelRatio:2}}function s1e(t){return t!=null&&t.type==="style"?bZe(t.style):null}function bZe(t){return t!=null?vZe(yZe[t],_Ze):null}const wZe=["polyline","polygon","extent"],EK=new eA({size:!0,color:!0,rotation:!1,opacity:!0});let n1e=class o1e extends sf{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){if(this._fastUpdates=s2(this._context.renderer,EK),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:Kh(1))<0)throw new X("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,r=!1){var n,o;const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:qB(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:s1e(this.symbolLayer.pattern)};return(o=this._fastUpdates)!=null&&o.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){var e;return(e=this.symbolLayer.material)==null?void 0:e.color}get _markerColor(){var e;return(e=this.symbolLayer.marker)==null?void 0:e.color}get _lineMaterial(){return this._materials[is.Line]==null&&(this._materials[is.Line]=new Hw(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[is.Line])),this._materials[is.Line]}get _ringMaterial(){return this._materials[is.Ring]==null&&(this._materials[is.Ring]=new Hw(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[is.Ring])),this._materials[is.Ring]}get _wireframeLineMaterial(){return this._materials[is.LineWireframe]==null&&(this._materials[is.LineWireframe]=new Hw({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[is.LineWireframe])),this._materials[is.LineWireframe]}get _wireframeRingMaterial(){return this._materials[is.RingWireframe]==null&&(this._materials[is.RingWireframe]=new Hw({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._materials[is.RingWireframe])),this._materials[is.RingWireframe]}get _markerMaterial(){return this._materials[is.Marker]==null&&this.symbolLayer.marker!=null&&(this._materials[is.Marker]=new hZe({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:SK(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[is.Marker])),this._materials[is.Marker]}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0}_getDrivenSize(e){return this._drivenProperties.size&&e.size?Fo(rqe(e.size)):1}_getDrivenColor(e){const r=Ot(1,1,1,1);return this._drivenProperties.color&&e.color&&(r[0]=e.color[0],r[1]=e.color[1],r[2]=e.color[2],e.color.length>0&&(r[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(r[3]=e.opacity),r}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,wZe,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,r.uid)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables")return Ts.RecreateSymbol;{const s=this._fastUpdates;if(!n2(s,r,EK))return Ts.RecreateSymbol;this._forEachMaterial(n=>n==null?void 0:n.setParameters(s.materialParameters))}}return Ts.FastUpdate}prepareSymbolLayerPatch(e){var n,o;if(e.diff.type!=="partial")return;const r=e.diff.diff,i={};((n=r.size)==null?void 0:n.type)==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),((o=r.cap)==null?void 0:o.type)==="complete"&&(i.cap=qB(r.cap.newValue??"butt"),delete r.cap);const s=this._prepareMarkerPatch(e,r);this._prepareMaterialPatch(e,r,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a==null?void 0:a.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((e,r)=>this._updateMaterialLayerOpacity(e,r===is.Marker))}_forEachMaterial(e){this._materials.forEach(e)}_updateMaterialLayerOpacity(e,r=!1){var a,l;if(e==null)return;const i=e.parameters.color,s=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,n=this._patternHidesLine&&!r?0:this._getCombinedOpacity(s),o=Ot(i[0],i[1],i[2],n);e.setParameters({color:o})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=sA(o1e.elevationModeChangeTypes,i,s);if(n!==es.UPDATE)return n;const o=ku(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r==null?void 0:r.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof Xr)return Np.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,r,i){const s=e.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=tn(),c=aZe(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),u=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,u,"LineSymbol3DLayer");for(let g=0;g<c.lines.length;g++){const y=c.lines[g],_=y.position,v=y.mapPositions;if(this._context.clippingExtent!=null&&(ui(l),yc(l,v),!zh(l,this._context.clippingExtent)))continue;const w=this._createGeometry(n.type==="polygon"?this._ringMaterial:this._lineMaterial,e,_,v,n.type,rC.ELEVATED,i);a.push(w),Zr.LINE_WIREFRAMES&&a.push(w.instantiate({material:n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&a.push(w.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const d=new zm({geometries:a,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),p=new rf(this,d,a,null,null,hGe,r);return p.alignedSampledElevation=c.sampledElevation,p.needsElevationUpdates=ku(r.mode),p}_createGeometry(e,r,i,s,n,o,a){var _,v,w;const l=o===rC.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=n==="polygon",u=(_=this._fastUpdates)==null?void 0:_.visualVariables.color,d=(v=this._fastUpdates)==null?void 0:v.visualVariables.size,p=(w=this._fastUpdates)==null?void 0:w.visualVariables.opacity,g=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),y={position:i,size:d?null:this._getDrivenSize(r.renderingInfo),color:u?null:this._getDrivenColor(r.renderingInfo),sizeFeature:d?Xh(d.field,r.graphic):null,colorFeature:u?Xh(u.field,r.graphic):null,opacityFeature:p?Xh(p.field,r.graphic):null};return WB(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:s,attributeData:y},g)}_createAsOverlay(e,r){const i=e.graphic,s=this._getGeometryAsPolygonOrPolyline(i.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=Zr.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=tn(),d=ui(),p=lZe(s,this._context.overlaySR),g=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,n,g,"LineSymbol3DLayer");for(const y of p.lines){if(ui(u),yc(u,y.position),!zh(u,this._context.clippingExtent))continue;Dx(d,u);const _=v=>{const w=this._createGeometry(v,e,y.position,void 0,s.type,rC.DRAPED,i.uid),x=new h2(w,{layerUid:r,graphicUid:i.uid});c.push(x)};if(l!=null){_(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||yc(u,y.position,0,1),v!=="end"&&v!=="begin-end"||yc(u,y.position,y.position.length-3,1)}_(o),Zr.LINE_WIREFRAMES&&_(a)}return new FN(this,c,d,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){var r;return e=e??Kh(1),this._drivenProperties.size?(r=this._fastUpdates)!=null&&r.visualVariables.size?Fo(1):1:Fo(e)}_prepareMaterialPatch(e,r,i){var a,l;const s=r.material;if(s==null)return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._materials[is.Marker],e));if(s.type==="collection")return;const n=s.type==="complete"?(a=s.newValue)==null?void 0:a.color:((l=s.diff.color)==null?void 0:l.type)==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);i.useMaterialColor&&this._patchMaterialColor(V3(o),this._materials[is.Marker],e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._materials[is.Line],e),delete r.material}_prepareMarkerPatch(e,r){var u;const i=r.marker,s=this._markerMaterial;if(i==null||i.type!=="partial"||i.diff==null||i.diff.placement!=null||i.diff.style!=null&&i.diff.style.type!=="complete"||i.diff.color!=null&&i.diff.color.type!=="complete"||s==null)return{changed:!1,useMaterialColor:this._markerColor==null};const n=i.diff.color,o=n!=null,a=o?n.newValue:null,l=a==null&&this._markerColor==null;a&&this._patchMaterialColor(this._getCombinedOpacityAndColor(a),s,e);const c=(u=i.diff.style)==null?void 0:u.newValue;return c&&e.symbolLayerStatePatches.push(()=>s.setParameters({markerPrimitive:SK(c)})),delete r.marker,{changed:o,useMaterialColor:l}}_patchMaterialColor(e,r,i){r!=null&&i.symbolLayerStatePatches.push(()=>r.setParameters({color:e}))}};var rC,is;n1e.elevationModeChangeTypes={definedChanged:es.RECREATE,staysOnTheGround:es.NONE,onTheGroundChanged:es.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(rC||(rC={})),function(t){t[t.Line=0]="Line",t[t.Ring=1]="Ring",t[t.LineWireframe=2]="LineWireframe",t[t.RingWireframe=3]="RingWireframe",t[t.Marker=4]="Marker"}(is||(is={}));function a1e(t,e,r){return Ni(t,e,0,xO,r.spatialReference,0,1)?(r.x=xO[0],r.y=xO[1],r.z=xO[2],r):null}const xO=E();let PT=null,eL=!0;function CF(t,e,r){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(eL)try{return new ImageData(t,e)}catch{eL=!1}return l1e(t,e,r)}function xZe(t,e,r,i){if(!e||!r)throw new Error("Cannot construct image data without dimensions");if(eL)try{return new ImageData(t,e,r)}catch{eL=!1}const s=l1e(e,r,i);return s.data.set(t,0),s}function TZe(){return PT||(PT=document.createElement("canvas"),PT.width=1,PT.height=1),PT}function l1e(t,e,r){return r||(r=TZe()),r.getContext("2d").createImageData(t,e)}async function SZe(t,e){const r=window.URL.createObjectURL(t);try{const{data:i}=await Hi(r,{...e,responseType:"image"});return i}catch(i){throw Os(i)?i:new X("invalid-image",`Could not fetch requested image at ${r}`)}finally{window.URL.revokeObjectURL(r)}}async function cSt(t,e){const{arrayBuffer:r,mediaType:i}=await EZe(t,e),s=i==="image/png";if(i==="image/gif"){const{isAnimatedGIF:n,parseGif:o}=await he(()=>import("./gif-3d8d8ed1.js"),[],import.meta.url);if(n(r))return o(r,e)}if(s){const{isAnimatedPNG:n,parseApng:o}=await he(()=>import("./apng-452f7e3e.js"),[],import.meta.url);if(n(r))return o(r,e)}return SZe(new Blob([r],{type:i}),e)}async function EZe(t,e){const r=B0(t);if(r!=null&&r.isBase64)return{arrayBuffer:Fne(r.data),mediaType:r.mediaType};const i=await Hi(t,{responseType:"array-buffer",...e});return{arrayBuffer:i.data,mediaType:i.getHeader("Content-Type")}}var mw;const AF=new WeakMap;let CZe=0,Qd=mw=class extends st{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,i){if(t instanceof HTMLImageElement){const s={type:"image-element",src:Nx(t.src,i),crossOrigin:t.crossOrigin};e[r]=s}else if(t instanceof HTMLCanvasElement){const s=t.getContext("2d").getImageData(0,0,t.width,t.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};e[r]=n}else if(t instanceof HTMLVideoElement){const s={type:"video-element",src:Nx(t.src,i),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=s}else if(t instanceof ImageData){const s={type:"image-data",imageData:this._encodeImageData(t)};e[r]=s}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const r=e.substr(e.length-4,4).toLowerCase(),i=e.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(r="")=>`d:${r},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(AF.has(this.data)||AF.set(this.data,++CZe),e(AF.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new mw(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return xZe(r,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new mw({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new mw({data:t}):Tx(mw,t)}};h([f({type:String,json:{write:tv}})],Qd.prototype,"url",null),h([f({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),f()],Qd.prototype,"data",null),h([ni("data")],Qd.prototype,"writeData",null),h([si("data")],Qd.prototype,"readData",null),h([f({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Qd.prototype,"transparent",null),h([f({json:{write:!0}})],Qd.prototype,"wrap",void 0),h([f({readOnly:!0})],Qd.prototype,"contentHash",null),Qd=mw=h([k("esri.geometry.support.MeshTexture")],Qd);const iC=Qd;let gw=class extends Lc(st){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};h([f({type:[Number],nonNullable:!0,json:{write:!0}})],gw.prototype,"offset",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0}})],gw.prototype,"rotation",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],gw.prototype,"scale",void 0),gw=h([k("esri.geometry.support.MeshTextureTransform")],gw);const yx=gw;var YB;let mh=YB=class extends st{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new YB(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}clonePropertiesWithDeduplication(t){var e,r,i,s;return{color:this.color!=null?this.color.clone():null,colorTexture:(e=this.colorTexture)==null?void 0:e.cloneWithDeduplication(t),normalTexture:(r=this.normalTexture)==null?void 0:r.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(i=this.colorTextureTransform)==null?void 0:i.clone(),normalTextureTransform:(s=this.normalTextureTransform)==null?void 0:s.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};h([f({type:qe,json:{write:!0}})],mh.prototype,"color",void 0),h([f({type:iC,json:{write:!0}})],mh.prototype,"colorTexture",void 0),h([f({type:yx,json:{write:!0}})],mh.prototype,"colorTextureTransform",void 0),h([f({type:iC,json:{write:!0}})],mh.prototype,"normalTexture",void 0),h([f({type:yx,json:{write:!0}})],mh.prototype,"normalTextureTransform",void 0),h([f({nonNullable:!0,json:{write:!0}})],mh.prototype,"alphaMode",void 0),h([f({nonNullable:!0,json:{write:!0}})],mh.prototype,"alphaCutoff",void 0),h([f({nonNullable:!0,json:{write:!0}})],mh.prototype,"doubleSided",void 0),mh=YB=h([k("esri.geometry.support.MeshMaterial")],mh);const hH=mh;var XB;let tu=XB=class extends hH{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new XB(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){var e,r,i,s,n,o,a;return{...super.clonePropertiesWithDeduplication(t),emissiveColor:(e=this.emissiveColor)==null?void 0:e.clone(),emissiveTexture:(r=this.emissiveTexture)==null?void 0:r.cloneWithDeduplication(t),emissiveTextureTransform:(i=this.emissiveTextureTransform)==null?void 0:i.clone(),occlusionTexture:(s=this.occlusionTexture)==null?void 0:s.cloneWithDeduplication(t),occlusionTextureTransform:(n=this.occlusionTextureTransform)==null?void 0:n.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(o=this.metallicRoughnessTexture)==null?void 0:o.cloneWithDeduplication(t),metallicRoughnessTextureTransform:(a=this.metallicRoughnessTextureTransform)==null?void 0:a.clone()}}};h([f({type:qe,json:{write:!0}})],tu.prototype,"emissiveColor",void 0),h([f({type:iC,json:{write:!0}})],tu.prototype,"emissiveTexture",void 0),h([f({type:yx,json:{write:!0}})],tu.prototype,"emissiveTextureTransform",void 0),h([f({type:iC,json:{write:!0}})],tu.prototype,"occlusionTexture",void 0),h([f({type:yx,json:{write:!0}})],tu.prototype,"occlusionTextureTransform",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],tu.prototype,"metallic",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],tu.prototype,"roughness",void 0),h([f({type:iC,json:{write:!0}})],tu.prototype,"metallicRoughnessTexture",void 0),h([f({type:yx,json:{write:!0}})],tu.prototype,"metallicRoughnessTextureTransform",void 0),tu=XB=h([k("esri.geometry.support.MeshMaterialMetallicRoughness")],tu);const c1e=tu;var FM;const u1e="esri.geometry.support.MeshVertexAttributes",xb=ne.getLogger(u1e);let jc=FM=class extends st{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return yw(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},xb)}castPosition(t){return t&&t instanceof Float32Array&&xb.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),yw(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},xb)}castUv(t){return yw(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},xb)}castNormal(t){return yw(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},xb)}castTangent(t){return yw(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},xb)}clone(){const t={position:ye(this.position),uv:ye(this.uv),normal:ye(this.normal),tangent:ye(this.tangent),color:ye(this.color)};return new FM(t)}clonePositional(){const t={position:ye(this.position),normal:ye(this.normal),tangent:ye(this.tangent),uv:this.uv,color:this.color};return new FM(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function RF(t,e,r,i){const{loggerTag:s,stride:n}=e;return t.length%n!=0?(i.error(s,`Invalid array length, expected a multiple of ${n}`),new r([])):t}function yw(t,e,r,i,s){if(!t)return t;if(t instanceof e)return RF(t,i,e,s);for(const n of r)if(t instanceof n)return RF(new e(t),i,e,s);if(Array.isArray(t))return RF(new e(t),i,e,s);{const n=r.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${t.constructor.name}`),new e([])}}function MT(t,e,r){e[r]=AZe(t)}function AZe(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}h([f({json:{write:MT}})],jc.prototype,"color",void 0),h([zi("color")],jc.prototype,"castColor",null),h([f({nonNullable:!0,json:{write:MT}})],jc.prototype,"position",void 0),h([zi("position")],jc.prototype,"castPosition",null),h([f({json:{write:MT}})],jc.prototype,"uv",void 0),h([zi("uv")],jc.prototype,"castUv",null),h([f({json:{write:MT}})],jc.prototype,"normal",void 0),h([zi("normal")],jc.prototype,"castNormal",null),h([f({json:{write:MT}})],jc.prototype,"tangent",void 0),h([zi("tangent")],jc.prototype,"castTangent",null),jc=FM=h([k(u1e)],jc);var eE;const h1e="esri.geometry.support.MeshComponent",RZe=ne.getLogger(h1e);let Kd=eE=class extends st{static from(t){return Tx(eE,t)}constructor(t){super(t),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return yw(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},RZe)}castMaterial(t){return Tx(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?c1e:hH,t)}clone(){return new eE({faces:ye(this.faces),shading:this.shading,material:ye(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(t,e){const r={faces:ye(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new eE(r)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};h([f({json:{write:!0}})],Kd.prototype,"faces",void 0),h([zi("faces")],Kd.prototype,"castFaces",null),h([f({type:hH,json:{write:!0}})],Kd.prototype,"material",void 0),h([zi("material")],Kd.prototype,"castMaterial",null),h([f()],Kd.prototype,"name",void 0),h([f({type:String,json:{write:!0}})],Kd.prototype,"shading",void 0),h([f({type:Boolean})],Kd.prototype,"trustSourceNormals",void 0),Kd=eE=h([k(h1e)],Kd);const OZe=Kd;let tE=class extends Lc(st){constructor(e){super(e),this.type="georeferenced-relative",this.isRelative=!0,this.isGeoreferenced=!0,this.origin=E()}getOriginPoint(e){const[r,i,s]=this.origin;return new nt({x:r,y:i,z:s,spatialReference:e})}setOriginFromPoint({x:e,y:r,z:i}){this.origin=Te(e,r,i??0)}};h([Ht({georeferencedRelative:"georeferenced-relative"},{readOnly:!0})],tE.prototype,"type",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],tE.prototype,"origin",void 0),tE=h([k("esri.geometry.support.MeshGeoreferencedRelativeVertexSpace")],tE);const PZe=tE;let UM=class extends Lc(st){constructor(){super({}),this.type="georeferenced",this.isRelative=!1,this.isGeoreferenced=!0}};h([Ht({georeferenced:"georeferenced"},{readOnly:!0})],UM.prototype,"type",void 0),UM=h([k("esri.geometry.support.MeshGeoreferencedVertexSpace")],UM);const MZe=UM;let rE=class extends Lc(st){constructor(e){super(e),this.type="local",this.isRelative=!0,this.isGeoreferenced=!1,this.origin=E()}getOriginPoint(e){const[r,i,s]=this.origin;return new nt({x:r,y:i,z:s,spatialReference:e})}setOriginFromPoint({x:e,y:r,z:i}){this.origin=Te(e,r,i??0)}};h([Ht({local:"local"},{readOnly:!0})],rE.prototype,"type",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],rE.prototype,"origin",void 0),rE=h([k("esri.geometry.support.MeshLocalVertexSpace")],rE);const $Ze=rE;var ZB;let ep=ZB=class extends st{constructor(t){super(t),this.translation=E(),this.rotationAxis=Oo(hfe),this.rotationAngle=0,this.scale=Te(1,1,1)}get rotation(){return yM(this.rotationAxis,this.rotationAngle)}set rotation(t){this.rotationAxis=Ii(t),this.rotationAngle=u8e(t)}get localMatrix(){const t=ge();return BC(CK,this.rotation,lk(this.rotation)),cae(t,CK,this.translation,this.scale),t}get localMatrixInverse(){return Ls(ge(),this.localMatrix)}applyLocal(t,e){return De(e,t,this.localMatrix)}applyLocalInverse(t,e){return De(e,t,this.localMatrixInverse)}equals(t){return this===t||t!=null&&M7(this.localMatrix,t.localMatrix)}clone(){const t={translation:Ii(this.translation),rotationAxis:Ii(this.rotationAxis),rotationAngle:this.rotationAngle,scale:Ii(this.scale)};return new ZB(t)}};h([f({type:[Number],nonNullable:!0,json:{write:!0}})],ep.prototype,"translation",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],ep.prototype,"rotationAxis",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0}})],ep.prototype,"rotationAngle",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],ep.prototype,"scale",void 0),h([f()],ep.prototype,"rotation",null),h([f()],ep.prototype,"localMatrix",null),h([f()],ep.prototype,"localMatrixInverse",null),ep=ZB=h([k("esri.geometry.support.MeshTransform")],ep);const CK=Bu(),IZe=ep;function d1e(t,e){return t.isGeographic||t.isWebMercator&&((e==null?void 0:e.geographic)??!0)}function fSt(t,e,r){const i=!t.isGeoreferenced;(r==null?void 0:r.geographic)!=null&&r.geographic!==i&&ne.getLogger(e).warnOnce(`Specifying the 'geographic' parameter (${r.geographic}) for a Mesh vertex space of type "${t.type}" is not supported. This parameter will be ignored.`)}const UN=ne.getLogger("esri.geometry.support.meshUtils.normalProjection");function p1e(t,e,r,i,s){return BN(i)?(kN(um.TO_PCPF,cn.fromTypedArray(t),Uu.fromTypedArray(e),Uu.fromTypedArray(r),i,cn.fromTypedArray(s)),s):(UN.error("Cannot convert spatial reference to PCPF"),s)}function LZe(t,e,r,i,s){return BN(i)?(kN(um.FROM_PCPF,cn.fromTypedArray(t),Uu.fromTypedArray(e),Uu.fromTypedArray(r),i,cn.fromTypedArray(s)),s):(UN.error("Cannot convert to spatial reference from PCPF"),s)}function DZe(t,e,r){return Ni(t,e,0,r,I2(e),0,t.length/3),r}function NZe(t,e,r){return Ni(t,I2(r),0,e,r,0,t.length/3),e}function f1e(t,e,r){return wm(xn,r),cd(e,t,xn),QV(xn)||$N(e,e),e}function m1e(t,e,r){if(wm(xn,r),cd(e,t,xn,4),QV(xn)||$N(e,e,4),t!==e)for(let i=3;i<t.length;i+=4)e[i]=t[i];return e}function g1e(t,e,r,i,s){if(!BN(i))return UN.error("Cannot convert spatial reference to PCPF"),s;kN(um.TO_PCPF,cn.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),Uu.fromTypedArray(e),Uu.fromTypedArray(r),i,cn.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function FZe(t,e,r,i,s){if(!BN(i))return UN.error("Cannot convert to spatial reference from PCPF"),s;kN(um.FROM_PCPF,cn.fromTypedArray(t,16),Uu.fromTypedArray(e),Uu.fromTypedArray(r),i,cn.fromTypedArray(s,16));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function kN(t,e,r,i,s,n){if(!e)return;const o=r.count,a=I2(s);if(y1e(s))for(let l=0;l<o;l++)i.getVec(l,TO),e.getVec(l,Od),Ol(a,TO,SO,a),Iu(xn,SO),t===um.FROM_PCPF&&Lu(xn,xn),Sl(Od,Od,xn),n.setVec(l,Od);else for(let l=0;l<o;l++){i.getVec(l,TO),e.getVec(l,Od),Ol(a,TO,SO,a),Iu(xn,SO);const c=R$(r.get(l,1));let u=Math.cos(c);t===um.TO_PCPF&&(u=1/u),xn[0]*=u,xn[1]*=u,xn[2]*=u,xn[3]*=u,xn[4]*=u,xn[5]*=u,t===um.FROM_PCPF&&Lu(xn,xn),Sl(Od,Od,xn),pe(Od,Od),n.setVec(l,Od)}return n}function BN(t){return y1e(t)||UZe(t)}function y1e(t){return t.isWGS84||doe(t)||Wp(t)||Yp(t)}function UZe(t){return t.isWebMercator}var um;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(um||(um={}));const TO=E(),Od=E(),SO=ge(),xn=Fi();function dH(t,e,r){return d1e(e.spatialReference,r)?VZe(t,e,r):zZe(t,e,r)}function _1e(t,e=$i){const{position:r,normal:i,tangent:s}=t;return{position:ld(new Float64Array(r.length),r,e),normal:i!=null?f1e(i,new Float32Array(i.length),e):null,tangent:s!=null?m1e(s,new Float32Array(s.length),e):null}}function v1e(t,e,r,i){const{position:s,normal:n,tangent:o}=t;return e.isRelative?dH(_1e(t,r==null?void 0:r.localMatrix),e.getOriginPoint(i),{geographic:!e.isGeoreferenced}):{position:s,normal:n,tangent:o}}function kZe(t,e,r){if(r!=null&&r.useTransform){const{position:i,normal:s,tangent:n}=t,{x:o,y:a,z:l}=e,c=Te(o,a,l??0);return{vertexAttributes:{position:i,normal:s,tangent:n},vertexSpace:r.geographic??1?new $Ze({origin:c}):new PZe({origin:c}),transform:new IZe}}return{vertexAttributes:dH(t,e,r),vertexSpace:new MZe,transform:null}}function JB(t,e,r){return d1e(e.spatialReference,r)?qZe(t,e,r):w1e(t,e,r)}function BZe(t,e,r,i,s){if(!e.isRelative)return JB(t,i,s);const{spatialReference:n}=i,o=v1e(t,e,r,n);return i.equals(e.getOriginPoint(n))?w1e(o,i,s):JB(o,i,s)}function b1e({positions:t,transform:e,vertexSpace:r,inSpatialReference:i,outSpatialReference:s,outPositions:n,localMode:o}){const a=r.isRelative?r.origin:Mn,l=r.isRelative?(e==null?void 0:e.localMatrix)??$i:$i;if(r.isGeoreferenced){const p=n??Pn(t.length);if(rD(l,$i)?$Ue(p,t):ld(p,t,l),!ho(a,Mn)){const[g,y,_]=a;for(let v=0;v<p.length;v+=3)p[v]+=g,p[v+1]+=y,p[v+2]+=_}return Ni(p,i,0,p,s,0,p.length/3),p}let c=i;const u=I2(i);c=s.isWebMercator&&o||!Bp(i,u)?c:u,Ol(i,a,w1,c),Pr(w1,w1,l);const d=n??Pn(t.length);return ld(d,t,w1),Ni(d,c,0,d,s,0,d.length/3),d}function zZe(t,e,r){const i=new Float64Array(t.position.length),s=t.position,n=e.x,o=e.y,a=e.z??0,l=pH(r?r.unit:null,e.spatialReference);for(let c=0;c<s.length;c+=3)i[c]=s[c]*l+n,i[c+1]=s[c+1]*l+o,i[c+2]=s[c+2]*l+a;return{position:i,normal:t.normal,tangent:t.tangent}}function VZe(t,e,r){const i=e.spatialReference,s=x1e(e,r,w1),n=new Float64Array(t.position.length),o=GZe(t.position,s,i,n),a=wm(T1e,s);return{position:o,normal:jZe(o,n,t.normal,a,i),tangent:HZe(o,n,t.tangent,a,i)}}function GZe(t,e,r,i){ld(i,t,e);const s=new Float64Array(t.length);return NZe(i,s,r)}function jZe(t,e,r,i,s){if(r==null)return null;const n=new Float32Array(r.length);return cd(n,r,i),LZe(n,t,e,s,n),n}function HZe(t,e,r,i,s){if(r==null)return null;const n=new Float32Array(r.length);cd(n,r,i,4);for(let o=3;o<n.length;o+=4)n[o]=r[o];return FZe(n,t,e,s,n),n}function w1e(t,e,r){const i=new Float64Array(t.position.length),s=t.position,n=e.x,o=e.y,a=e.z??0,l=pH(r?r.unit:null,e.spatialReference);for(let c=0;c<s.length;c+=3)i[c]=(s[c]-n)/l,i[c+1]=(s[c+1]-o)/l,i[c+2]=(s[c+2]-a)/l;return{position:i,normal:t.normal,tangent:t.tangent}}function qZe(t,e,r){const i=e.spatialReference;x1e(e,r,w1);const s=Ls(ZZe,w1),n=new Float64Array(t.position.length),o=WZe(t.position,i,s,n),a=wm(T1e,s);return{position:o,normal:YZe(t.normal,t.position,n,i,a),tangent:XZe(t.tangent,t.position,n,i,a)}}function x1e(t,e,r){Ol(t.spatialReference,[t.x,t.y,t.z??0],r,I2(t.spatialReference));const i=pH(e?e.unit:null,t.spatialReference);return O3(r,r,[i,i,i]),r}function WZe(t,e,r,i){const s=DZe(t,e,i),n=new Float64Array(s.length);return ld(n,s,r),n}function YZe(t,e,r,i,s){if(t==null)return null;const n=p1e(t,e,r,i,new Float32Array(t.length));return cd(n,n,s),n}function XZe(t,e,r,i,s){if(t==null)return null;const n=g1e(t,e,r,i,new Float32Array(t.length));return cd(n,n,s,4),n}function pH(t,e){if(t==null)return 1;const r=S8(e);return 1/jn(r,"meters",t)}const w1=ge(),ZZe=ge(),T1e=Fi(),mSt=Object.freeze(Object.defineProperty({__proto__:null,applyTransform:_1e,georeference:dH,georeferenceApplyTransform:v1e,georeferenceByTransform:kZe,project:b1e,ungeoreference:JB,ungeoreferenceByTransform:BZe},Symbol.toStringTag,{value:"Module"}));var sC;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(sC||(sC={}));let S1e=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=sm.KTX2_ENCODING}};function nC(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function JZe(t){const e=new Blob([t]),r=await e.text();return JSON.parse(r)}async function QZe(t,e){if(e===sm.KTX2_ENCODING)return new S1e(t);const r=new Blob([t],{type:e}),i=URL.createObjectURL(r),s=new Image;if(te("esri-iPhone"))return new Promise((n,o)=>{const a=()=>{c(),n(s)},l=u=>{c(),o(u)},c=()=>{URL.revokeObjectURL(i),s.removeEventListener("load",a),s.removeEventListener("error",l)};s.addEventListener("load",a),s.addEventListener("error",l),s.src=i});try{s.src=i,await s.decode()}catch{console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(i),s}function gp(t){if(t==null)return null;const e=t.offset!=null?t.offset:pye,r=t.rotation!=null?t.rotation:0,i=t.scale!=null?t.scale:fye,s=MM(1,0,0,0,1,0,e[0],e[1],1),n=MM(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=MM(i[0],0,0,0,i[1],0,0,0,1),a=zo();return qx(a,n,o),qx(a,s,a),a}let KZe=class extends rf{constructor(){super(...arguments),this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(e,r){if(this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!0;const{stageObject:i}=this,s=i.geometries.slice();i.removeAllGeometries();const n=N$(OF,i.transformation),o=r.getOrigin(n);for(const a of s){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,i.addGeometry(c)}this._originalGeometries=s}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!1;const{stageObject:r}=this,i=r.geometries.map(s=>e(s.material));r.removeAllGeometries();for(let s=0;s<this._originalGeometries.length;s++){const n=this._originalGeometries[s],o=i[s];o.setParameters({modelTransformation:null}),o===n.material?r.addGeometry(n):r.addGeometry(n.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,r,i){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:s}=this;if(s.geometries.length===0)return;const n=s.geometries[0].localOrigin,o=N$(OF,e),a=i.getOrigin(o);if(a===n)return;const l=(r==null?void 0:r.localMatrix)??$i;s.shaderTransformation=null,s.transformation=e,s.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,r,i){const{stageObject:s}=this,n=(r==null?void 0:r.localMatrix)??$i;if(!this._fastTransformUpdatesEnabled)return s.shaderTransformation=null,s.transformation=e,s.geometries.forEach(g=>{g.transformation=n}),void(this._fastUpdateEdgeTransform()||this.resetEdgeObject(i));const o=s.transformation,a=s.geometries[0].transformation,l=e,c=n,u=Pr(AK,o,a),d=Pr(RK,l,c),p=Pr(OK,d,Ls(OK,a));s.shaderTransformation=p,this._setFastMaterialTransformation({matA:u,matB:d}),this._fastUpdateEdgeTransform()||this.resetEdgeObject(i)}alignWithElevation(e,r,i,s){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,r,i,s);i!=null&&SN(this.elevationContext.featureExpressionInfoContext,i);const n=(y,_)=>iy(y,e,this.elevationContext,r,_),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=Pr(AK,a,l),u=o.effectiveTransformation,d=Ss(eJe,u);this.alignedSampledElevation=I1(this,this.elevationContext,e.spatialReference,n,r,d),o.shaderTransformation=d;const p=o.geometries[0].transformation,g=Pr(RK,d,p);this._setFastMaterialTransformation({matA:c,matB:g}),this._fastUpdateEdgeTransform()||this.resetEdgeObject(s)}_setFastMaterialTransformation({matA:e,matB:r}){const{stageObject:i}=this;if(i.geometries.length===0)return;const s=i.geometries[0].localOrigin,n=P3(tJe,ee(OF,s.vec3,-1)),o=Pr(PK,n,e),a=Pr(MK,n,r),l=Ls(PK,o),c=Pr(MK,a,l);for(const u of i.geometries)u.material.setParameters({modelTransformation:c})}_fastUpdateEdgeTransform(){return this._stageLayer.stage.renderer.ensureEdgeView().fastUpdateObject3DEdgesTransform(this.stageObject)}};const OF=E(),AK=ge(),RK=ge(),eJe=ge(),OK=ge(),PK=ge(),MK=ge(),tJe=ge();let rJe=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,r,i){e.enableFastTransformUpdates(s=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(s))return s;const o=r.byMaterial(s);return this._fastTransformOriginalMaterials.set(s,o),r.delete(s),s}const n=new od(s.parameters);return i.stage.add(n),this._fastTransformClonedMaterials.set(n,s),n},i.localOriginFactory)}disable(e,r,i){const s=new Set,n=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,u=this._fastTransformOriginalMaterials.get(c);return r.has(u.uid)?(s.add(c),r.byUid(u.uid).material):(n.add(c),u.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),i.stage.remove(a),l});for(const o of s)this._fastTransformOriginalMaterials.delete(o),i.stage.remove(o);for(const o of n){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),r.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,r,i){this._graphicReferenceCount--,this.disable(e,r,i)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:r})=>r)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},iJe=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,r){this._byUid.set(e,r),this._byMaterial.set(r.material,r)}delete(e){var i;const r=(i=this._byMaterial.get(e))==null?void 0:i.uid;r&&(this._byUid.delete(r),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};function sJe(t){const e=new dr,{vertex:r,fragment:i}=e;return e.include(qa,t),e.include(Dv,t),Rl(r,t),e.attributes.add(R.POSITION,"vec3"),e.varyings.add("vpos","vec3"),r.code.add(b`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`),t.output===L.Highlight&&e.include(_y,t),e.include(us,t),i.uniforms.add(new Ee("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),t.hasVertexColors||i.uniforms.add(new nr("constantColor",s=>s.color)),i.code.add(b`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    ${t.output===L.ObjectAndLayerIdColor?b`color.a = 1.0;`:""}

    if (color.a < ${b.float(qn)}) {
      discard;
    }

    ${t.output===L.Color?b`fragColor = highlightSlice(color, vpos);`:""}
    ${t.output===L.Highlight?b`outputHighlight();`:""}
  }
  `),e}const nJe=Object.freeze(Object.defineProperty({__proto__:null,build:sJe},Symbol.toStringTag,{value:"Module"}));let E1e=class C1e extends Sr{initializeProgram(e){return new vr(e.rctx,C1e.shader.get().build(this.configuration),hr)}initializePipeline(){const e=this.configuration,r=Jn(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),i=(s,n=null,o=null)=>Et({blending:n,depthTest:Oj,depthWrite:o,colorWrite:Ut,stencilWrite:e.hasOccludees?Gp:null,stencilTest:e.hasOccludees?s?ny:by:null});return e.output===L.Color?(this._occludeePipelineState=i(!0,e.transparent?r:null,Xa),i(!1,e.transparent?r:null,Xa)):i(!1)}get primitiveType(){return Qt.LINES}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};E1e.shader=new _r(nJe,()=>he(()=>import("./NativeLine.glsl-f0f2b494.js"),[],import.meta.url));let _w=class extends ga{constructor(){super(...arguments),this.output=L.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.hasOccludees=!1}};h([F({count:L.COUNT})],_w.prototype,"output",void 0),h([F()],_w.prototype,"hasSlicePlane",void 0),h([F()],_w.prototype,"hasVertexColors",void 0),h([F()],_w.prototype,"transparent",void 0),h([F()],_w.prototype,"hasOccludees",void 0);let $K=class extends yy{constructor(e){super(e,new aJe),this._configuration=new _w}getConfiguration(e){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!Npe(r))return void ne.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes.get(R.POSITION).data,l=i.camera,c=cJe;Ns(c,i.point);const u=2;se($T[0],c[0]-u,c[1]+u,0),se($T[1],c[0]+u,c[1]+u,0),se($T[2],c[0]+u,c[1]-u,0),se($T[3],c[0]-u,c[1]-u,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen($T[_],mf[_]))return;$o(l.eye,mf[0],mf[1],PF),$o(l.eye,mf[1],mf[2],MF),$o(l.eye,mf[2],mf[3],$F),$o(l.eye,mf[3],mf[0],IF);let d=Number.MAX_VALUE,p=0;for(let _=0;_<a.length-5;_+=3){if(Aa[0]=a[_]+r[12],Aa[1]=a[_+1]+r[13],Aa[2]=a[_+2]+r[14],Ra[0]=a[_+3]+r[12],Ra[1]=a[_+4]+r[13],Ra[2]=a[_+5]+r[14],Wr(PF,Aa)<0&&Wr(PF,Ra)<0||Wr(MF,Aa)<0&&Wr(MF,Ra)<0||Wr($F,Aa)<0&&Wr($F,Ra)<0||Wr(IF,Aa)<0&&Wr(IF,Ra)<0)continue;if(l.projectToRenderScreen(Aa,Yy),l.projectToRenderScreen(Ra,Xy),Yy[2]<0&&Xy[2]>0){ce(Pd,Aa,Ra);const w=l.frustum,x=-Wr(w[ri.NEAR],Aa)/de(Pd,w[ri.NEAR]);ee(Pd,Pd,x),le(Aa,Aa,Pd),l.projectToRenderScreen(Aa,Yy)}else if(Yy[2]>0&&Xy[2]<0){ce(Pd,Ra,Aa);const w=l.frustum,x=-Wr(w[ri.NEAR],Ra)/de(Pd,w[ri.NEAR]);ee(Pd,Pd,x),le(Ra,Ra,Pd),l.projectToRenderScreen(Ra,Xy)}else if(Yy[2]<0&&Xy[2]<0)continue;Yy[2]=0,Xy[2]=0;const v=$V(O1(Yy,Xy,DK),c);v<d&&(d=v,ie(IK,Aa),ie(LK,Ra),p=_/3)}const g=i.rayBegin,y=i.rayEnd;if(d<u*u){let _=Number.MAX_VALUE;if(ehe(O1(IK,LK,DK),O1(g,y,lJe),Wy)){ce(Wy,Wy,g);const v=_e(Wy);ee(Wy,Wy,1/v),_=v/hi(g,y)}o(_,Wy,p,!1)}}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.attributes.get(R.POSITION).data,l=e.attributes.get(R.SIZE),c=l?l.data[0]:0,u=s[0],d=s[1],p=((c+1)/2+4)*e.screenToWorldRatio;let g=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],w=a[_+1],x=u-v,T=d-w,S=a[_+3]-v,C=a[_+4]-w,A=me((S*x+C*T)/(S*S+C*C),0,1),O=S*A-x,$=C*A-T,D=O*O+$*$;D<g&&(g=D,y=_/3)}g<p*p&&n(o.dist,o.normal,y,!1)}produces(e,r){return!(r!==L.Color&&r!==L.Highlight&&r!==L.ObjectAndLayerIdColor||e!==oe.OPAQUE_MATERIAL&&e!==oe.DRAPED_MATERIAL)}createGLMaterial(e){return new oJe(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?tYe:KWe;return new z2(e)}},oJe=class extends my{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===L.Color&&this._updateOccludeeState(e),this.ensureTechnique(E1e,e)}},aJe=class extends yj{constructor(){super(...arguments),this.color=vu,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.hasOccludees=!1}};const Aa=E(),Ra=E(),Pd=E(),Wy=E(),Yy=po(),Xy=po(),IK=E(),LK=E(),DK=ud(),lJe=ud(),cJe=E(),$T=[po(),po(),po(),po()],mf=[E(),E(),E(),E()],PF=wr(),MF=wr(),$F=wr(),IF=wr(),uJe=["mesh"];class hJe extends sf{constructor(e,r,i,s){super(e,r,i,s),this._materialInfoCache=new iJe,this._fastUpdateProcessor=new rJe,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Zr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new $K({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new $K({color:[0,1,1,1]}))}destroy(){super.destroy(),this._textures.forEach(e=>e.unload()),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,uJe,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,r){const i=this._getLayerOpacity();this._updateMaterialParameters(s=>{s.material.setParameters({layerOpacity:i});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),e.forEach(s=>{var n;return(n=r(s))==null?void 0:n.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,sy)}slicePlaneEnabledChanged(e,r){return this._updateMaterialParameters(({material:i})=>{i.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(i=>{var s;return(s=r(i))==null?void 0:s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:r})=>r.setParameters({usePBR:e})),!0}updateTransform(e,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=dJe,{origin:a,transform:l}=i;switch(Ol(r,se(mn,a.x,a.y,a.z??0),o,n),s){case sC.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case sC.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case sC.UpdateFastLocalOrigin:e.updateFastLocalOrigin(o,l,this._context.localOriginFactory)}const{elevationContext:c}=e;c.centerPointInElevationSR=this._getCenterPointInElevationSR(o);const{elevationProvider:u,renderCoordsHelper:d}=this._context,p=(g,y)=>iy(g,u,c,d,y);return e.alignedSampledElevation=I1(e,c,u.spatialReference,p,d,o),e.updateTransform(o,l,this._context.isAsync),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return e==null?"-":e instanceof qe?e.toHex():e.contentHash}_materialPropertiesDefault(e,r){const i=this._requiresSymbolVertexColors(),s=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${r},svc:${i}`}}_textureTransformUid(e){const{offset:r,scale:i,rotation:s}=e??fJe;return`${r[0]},${r[1]},${s},${i[0]},${i[1]}`}_materialProperties(e,r,i){const s=this._materialPropertiesDefault(e,i);if(!r.material)return s;const{color:n,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:u,alphaCutoff:d,alphaMode:p}=r.material,g=this._colorOrTextureUid(n),y=this._colorOrTextureUid(o),_=this._textureTransformUid(a),v=this._colorOrTextureUid(l),w=this._textureTransformUid(c);if(s.color=n,s.colorTexture=o,s.normalTexture=l,s.uid=`${s.uid},cmuid:${g},ctmuid:${y},cttuid:${_},ntmuid:${v},nttuid:${w},ds:${u},ac:${d},am:${p}`,r.material instanceof c1e){const{metallic:x,roughness:T,metallicRoughnessTexture:S,metallicRoughnessTextureTransform:C,emissiveColor:A,emissiveTexture:O,emissiveTextureTransform:$,occlusionTexture:D,occlusionTextureTransform:N}=r.material,z=this._colorOrTextureUid(S),U=this._textureTransformUid(C),Y=this._colorOrTextureUid(A),H=this._colorOrTextureUid(O),V=this._textureTransformUid($),J=this._colorOrTextureUid(D),P=this._textureTransformUid(N);s.metallic=x,s.roughness=T,s.metallicRoughnessTexture=S,s.emissiveColor=A,s.emissiveTexture=O,s.occlusionTexture=D,s.colorTextureTransform=this._convertTextureTransform(a),s.normalTextureTransform=this._convertTextureTransform(c),s.emissiveTextureTransform=this._convertTextureTransform($),s.occlusionTextureTransform=this._convertTextureTransform(N),s.metallicRoughnessTextureTransform=this._convertTextureTransform(C),s.uid=`${s.uid},mrm:${x},mrr:${T},mrt:${z},mrtt:${U},emuid:${Y},etmuid:${H},ett:${V},otmuid:${J},ott:${P}`}return s}_convertTextureTransform(e){if(!e)return null;const{scale:r,offset:i,rotation:s}=e;return{scale:r,offset:i,rotation:At(s)}}_setInternalColorValueParameters(e,r){r.diffuse=qe.toUnitRGB(e),r.opacity=e.a}_getLoadableTextureResource(e){return e.data??e.url}_getInternalTextureId(e){const r=this._getInternalTexture(e,Ur.Opaque);return r==null?void 0:r.id}_getInternalTexture(e,r){const i=this._getLoadableTextureResource(e);if(!i)return null;const s=`${e.contentHash}/${r}`;let n=this._textures.get(s);if(!n){let o=null;const a=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,l={wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,maxAnisotropy:a,mipmap:a>1};nC(i)?(o=i.data,l.preMultiplyAlpha=!1,l.encoding=i.encoding):(o=i,l.preMultiplyAlpha=r!==Ur.Opaque,l.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),n=new Nv(o,l),this._textures.set(s,n),n.load(this._context.stage.renderView.renderingContext),this._context.stage.add(n)}return n}_castTextureWrap(e="repeat"){if(typeof e=="string"){const r=this._castTextureWrapIndividual(e);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return Ft.CLAMP_TO_EDGE;case"mirror":return Ft.MIRRORED_REPEAT;default:return Ft.REPEAT}}_setInternalMaterialParameters(e,r){if(e.color!=null&&this._setInternalColorValueParameters(e.color,r),e.colorTexture!=null){const i=this._getInternalTexture(e.colorTexture,r.textureAlphaMode);i?(r.textureId=i.id,r.textureAlphaPremultiplied=!!i.parameters.preMultiplyAlpha):r.textureId=void 0}e.normalTexture&&(r.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor&&(r.emissiveFactor=qe.toUnitRGB(e.emissiveColor)),e.emissiveTexture&&(r.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture&&(r.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture&&(r.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),r.colorTextureTransformMatrix=gp(e.colorTextureTransform),r.normalTextureTransformMatrix=gp(e.normalTextureTransform),r.occlusionTextureTransformMatrix=gp(e.occlusionTextureTransform),r.emissiveTextureTransformMatrix=gp(e.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=gp(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){var s,n;const r=this._drivenProperties.color;let i=((s=this.symbolLayer.material)==null?void 0:s.colorMixMode)??null;if(r)e.externalColor=vu;else{const o=((n=this.symbolLayer.material)==null?void 0:n.color)??null;o?e.externalColor=qe.toUnitRGBA(o):(i=null,e.externalColor=vu)}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const r=e.vertexAttributes.color;if(r==null)return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(e,r){var y,_,v;const i=(y=r.material)==null?void 0:y.color,s=(_=r.material)==null?void 0:_.colorTexture,n=(v=r.material)==null?void 0:v.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(e)||i!=null&&i.a<1||(s==null?void 0:s.transparent)||o),l=this._materialProperties(e,r,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const u={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},d=U0e({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:qe.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),p={usePBR:this._usePBR(),isSchematic:d,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Mn,diffuse:Jf,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:oi.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p.mrrFactors=d?[...Pj]:[l.metallic,l.roughness,CN[2]],r.material&&(p.doubleSided=r.material.doubleSided,p.cullFace=r.material.doubleSided?oi.None:oi.Back,p.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(p),this._setMaterialTransparentParameter(p,u),this._setInternalMaterialParameters(l,p);const g=new od(p);return u.material=g,this._materialInfoCache.set(l.uid,u),this._context.stage.add(g),g}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,r){e.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,r.alphaMode==="auto"?e.textureAlphaMode=e.transparent?Ur.MaskBlend:Ur.Opaque:e.textureAlphaMode=r.alphaMode==="opaque"?Ur.Opaque:r.alphaMode==="mask"?Ur.Mask:Ur.Blend}_addDebugNormals(e,r){const i=r.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let g=0;g<i;g++){const y=r[g],_=y.attributes.get(R.POSITION),v=y.attributes.get(R.NORMAL),w=_.data,x=_.indices,T=v.data,S=v.indices;for(let C=0;C<x.length;C++){const A=3*x[C],O=3*S[C];for(let $=0;$<3;$++)o.push(w[A+$]);for(let $=0;$<3;$++)o.push(w[A+$]+T[O+$]*n);if(a.push(a.length),a.push(a.length),C%3==0){this._calculateFaceNormal(w,x,C,Eb),this._getFaceVertices(w,x,C,mn,Tb,Sb),le(mn,mn,Tb),le(mn,mn,Sb),ee(mn,mn,1/3);for(let $=0;$<3;$++)l.push(mn[$]);for(let $=0;$<3;$++)l.push(mn[$]+Eb[$]*n);c.push(c.length),c.push(c.length)}}}const u=r[0].transformation,d=new Ds(this._debugVertexNormalMaterial,[[R.POSITION,new Ue(o,a,3,!0)]],null,Ki.Line);r.push(d),d.transformation=u;const p=new Ds(this._debugFaceNormalMaterial,[[R.POSITION,new Ue(l,c,3,!0)]],null,Ki.Line);p.transformation=u,r.push(p)}_createAs3DShape(e,r,i,s){const n=e.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,r,s);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;Zr.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a);const c=new zm({geometries:a,layerUid:this._context.layer.uid,graphicUid:s});c.transformation=l;const u=M0e(this.symbolLayer,{opacity:this._getLayerOpacity()}),d=u?new wGe(a[0].material,[u],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,p=new KZe(this,c,a,null,null,I1,i,d);this._fastUpdateProcessor.onAddGraphic(),p.needsElevationUpdates=sy(i.mode),p.useObjectOriginAsAttachmentOrigin=!0,i.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:g,renderCoordsHelper:y}=this._context,_=(v,w)=>iy(v,g,i,y,w);return p.alignedSampledElevation=I1(p,i,g.spatialReference,_,y),p}_getCenterPointInElevationSR(e){const r=fy(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return a1e([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(e,r,i,s){switch(i.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,r,i,s);case"flat":return this._createComponentNormalsFlat(e,s);case"smooth":return this._createComponentNormalsSmooth(e,s)}}_createComponentNormalsSource(e,r,i,s){if(r==null)return this._createComponentNormalsFlat(e,s);let n=!1;if(!i.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(e,s,o,Eb);for(let a=0;a<3;a++){const l=3*s[o+a];mn[0]=r[l],mn[1]=r[l+1],mn[2]=r[l+2],de(Eb,mn)<0&&(r[l]=-r[l],r[l+1]=-r[l+1],r[l+2]=-r[l+2],n=!0)}}return new LF(r,s,n)}_createComponentNormalsFlat(e,r){const i=Gi(r.length),s=new Array(3*r.length);for(let n=0;n<r.length;n+=3){const o=this._calculateFaceNormal(e,r,n,Eb);for(let a=0;a<3;a++)i[n+a]=o[a],s[n+a]=n/3}return new LF(i,s,!1)}_createComponentNormalsSmooth(e,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(e,r,o,Eb);for(let l=0;l<3;l++){const c=r[o+l];let u=i[c];u||(u={normal:E(),count:0},i[c]=u),le(u.normal,u.normal,a),u.count++}}const s=Gi(3*r.length),n=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(pe(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return new LF(s,n,!1)}_getFaceVertices(e,r,i,s,n,o){const a=3*r[i],l=3*r[i+1],c=3*r[i+2];s[0]=e[a],s[1]=e[a+1],s[2]=e[a+2],n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],o[0]=e[c],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,r,i,s){return this._getFaceVertices(e,r,i,mn,Tb,Sb),ce(Tb,Tb,mn),ce(Sb,Sb,mn),rt(mn,Tb,Sb),pe(s,mn),s}_getOrCreateComponents(e){return e.components??pJe}_createPositionBuffer(e,r){let i=e.vertexAttributes.position;const s=r.reprojection===dl.ECEF?r.transformBeforeProject:null;if(s&&(i=ld(new Float64Array(i.length),i,s)),r.reprojection===dl.NONE)return r.needsBufferCopy?new Float64Array(i):i;const n=s?i:new Float64Array(i.length);return Ni(i,e.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,i.length/3),n}_createNormalBuffer(e,r,i){let s=e.vertexAttributes.normal;if(s==null)return null;const n=i.reprojection===dl.ECEF?i.transformBeforeProject:null;if(n&&(s=f1e(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===dl.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=n?s:new Float32Array(s.length);return p1e(s,o,r,e.spatialReference,a)}_createTangentBuffer(e,r,i){let s=e.vertexAttributes.tangent;if(s==null)return null;const n=i.reprojection===dl.ECEF?i.transformBeforeProject:null;if(n&&(s=m1e(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===dl.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=n?s:new Float32Array(s.length);return g1e(s,o,r,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){var r,i;if(this._requiresSymbolVertexColors()){const s=this._getVertexOpacityAndColor(e),n=UGe((i=(r=this.symbolLayer)==null?void 0:r.material)==null?void 0:i.colorMixMode),o=new Uint8Array(4);return B0e(s,n,o),o}return null}_createBuffers(e,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=e.vertexAttributes.normal,n=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(s&&s.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(n&&n.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),u=this._createSymbolColorBuffer(r),d=this._createNormalBuffer(e,l,a),p=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:d,tangentBuffer:p,uvBuffer:n,colorBuffer:c,symbolColorBuffer:u,objectTransformation:a.reprojection===dl.NONE&&a.objectTransformation?a.objectTransformation:this._transformOriginLocal(e,l,d,p),geometryTransformation:a.reprojection===dl.NONE&&a.geometryTransformation?a.geometryTransformation:ge()}}_computeReprojectionInfo(e){var n;const{vertexSpace:r}=e,i=r.isRelative,s=r.isGeoreferenced?this._context.renderCoordsHelper.viewingMode===$e.Local?dl.NONE:dl.ECEF:dl.NONE;if(i){const{origin:o}=r,a=ge(),l=((n=e.transform)==null?void 0:n.localMatrix)??$i;if(s===dl.NONE)return Ol(e.spatialReference,o,a,this._context.renderCoordsHelper.spatialReference),{reprojection:s,objectTransformation:a,geometryTransformation:Vx(l),needsBufferCopy:!1};const c=P3(ge(),o);return Pr(c,c,l),{reprojection:s,transformBeforeProject:c,needsBufferCopy:!0}}return{reprojection:s,needsBufferCopy:!0}}_transformOriginLocal(e,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=e.anchor;EO[0]=o.x,EO[1]=o.y,EO[2]=o.z??0;const a=ge();return Ol(e.spatialReference,EO,a,n),Ls(NK,a),ld(r,r,NK),(i||s)&&(Iu(IT,a),Lu(IT,IT),i&&cd(i,i,IT),s&&cd(s,s,IT,4)),a}_validateFaces(e,r){const i=e.vertexAttributes.position.length/3,s=r.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(i<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,r){return r.faces??$v(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){var o;if(!this._context.clippingExtent)return!1;const r=(o=e.vertexAttributes)==null?void 0:o.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference,s=b1e({positions:r,transform:e.transform,vertexSpace:e.vertexSpace,inSpatialReference:e.spatialReference,outSpatialReference:i??e.spatialReference,localMode:this._context.stage.viewingMode===$e.Local}),n=s.length/3;return ui(DF),yc(DF,s,0,n),!zh(DF,this._context.clippingExtent)}_createGeometryInfo(e,r,i){if(!Bp(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const s=this._createBuffers(e,r);if(s==null)return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:d,geometryTransformation:p}=s,g=this._getOrCreateComponents(e),y=new Array;let _=!1;const v=N$(mn,d),w=this._context.localOriginFactory.getOrigin(v);for(const x of g){if(!this._validateFaces(e,x))return null;const T=this._getOrCreateFaces(e,x);if(T.length===0)continue;const S=this._createComponentNormals(n,c,x,T);S.didFlipNormals&&(_=!0);const C=[[R.POSITION,new Ue(n,T,3,!0)],[R.NORMAL,new Ue(S.normals,S.indices,3,!0)]];a&&C.push([R.COLOR,new Ue(a,T,4,!0)]),l&&C.push([R.SYMBOLCOLOR,new Ue(l,gy(T.length),4,!0)]),o&&C.push([R.UV0,new Ue(o,T,2,!0)]),u&&C.push([R.TANGENT,new Ue(u,T,4,!0)]);const A=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),O=this._getOrCreateMaterial(e,x),$=new Ds(O,C,null,Ki.Mesh,A);$.transformation=p,$.localOrigin=w,y.push($)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:y,objectTransformation:d}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((r,i)=>{i.setParameters(r.parameters)})}test(){return{...super.test(),materials:this._materialInfoCache.materials}}}class LF{constructor(e,r,i){this.normals=e,this.indices=r,this.didFlipNormals=i}}const EO=E(),mn=E(),Tb=E(),Sb=E(),Eb=E(),NK=ge(),IT=Fi(),dJe=ge(),DF=tn(),pJe=[new OZe],fJe=new yx;var dl;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(dl||(dl={}));let mJe=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const r=this._lodRenderer.instanceData;e!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,r,i){if(this.elevationAligner){SN(this.elevationContext.featureExpressionInfoContext,i);const s=(o,a)=>iy(o,e,this.elevationContext,r,a),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,r);n!=null&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=E()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Md),De(e,this._lodRenderer.baseBoundingSphere.center,Md)}getBoundingBoxObjectSpace(e=tn()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Md);const r=this._lodRenderer.baseBoundingBox;ui(e);for(let i=0;i<8;++i)se(Hc,1&i?r[3]:r[0],2&i?r[4]:r[1],4&i?r[5]:r[2]),De(Hc,Hc,Md),rd(e,Hc);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Md),e.render.origin[0]+=Md[12],e.render.origin[1]+=Md[13],e.render.origin[2]+=Md[14],e.render.num++}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=gJe,l=uV(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Md);for(let u=0;u<l;u++){const d=a[u];Hc[0]=o[d[0]],Hc[1]=o[d[1]],Hc[2]=o[d[2]],De(Hc,Hc,Md),Zy[3*u]=Hc[0],Zy[3*u+1]=Hc[1],Zy[3*u+2]=Hc[2]}if(!e(Zy,0,l))return null;ui(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],Zy[u+d]),o[d+3]=Math.max(o[d+3],Zy[u+d]);c&&i.push({location:Zy.slice(u,u+3),screenSpaceBoundingRect:c})}if(r&&(Bh(o,NF),this.elevationContext.mode!=="absolute-height")){let u;const d=Ej(o,r.service.spatialReference,r);try{u=await r.service.queryElevation(NF[0],NF[1],s,d,"ground")}catch{}u!=null&&$ce(o,0,0,-this.alignedSampledElevation+u)}return o}addObjectState(e,r){if(e===Tm.Highlight){const i=new xI(e);this._addHighlightId(i),r.addExternal(s=>{this._removeHighlightId(s)},i)}}removeObjectState(e){this._highlights.forEach(r=>e.remove(r))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const Zy=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Hc=E(),NF=E(),gJe=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Md=ge();function yJe(t,e){const r=t.stageResources.geometries.map(s=>new C0e(s,t.stageResources.textures)),i=t.lodThreshold==null||t.lodThreshold===0&&e>0?vJe(r):t.lodThreshold;return new A0e(r,i,t.pivotOffset)}function _Je(t){return new R0e(t.map((e,r)=>yJe(e,r)))}function vJe(t){const e=t.reduce((r,{geometry:i})=>r+i.indexCount/3,0);return Math.sqrt(e*bJe/Math.PI)}const bJe=20;function wJe(t){return t=t||globalThis.location.hostname,xJe.some(e=>(t==null?void 0:t.match(e))!=null)}function QB(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(A1e)!=null||e.match(O1e)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(R1e)!=null||e.match(P1e)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const A1e=/^devext.arcgis.com$/,R1e=/^qaext.arcgis.com$/,O1e=/^[\w-]*\.mapsdevext.arcgis.com$/,P1e=/^[\w-]*\.mapsqa.arcgis.com$/,xJe=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,A1e,R1e,/^jsapps.esri.com$/,O1e,P1e];function TJe(t,e,r){if(t.count!==e.count)return void MN.error("source and destination buffers need to have the same number of elements");const i=t.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],d=r[7],p=r[8],g=r[9],y=r[10],_=r[11],v=r[12],w=r[13],x=r[14],T=r[15],S=t.typedBuffer,C=t.typedBufferStride,A=e.typedBuffer,O=e.typedBufferStride;for(let $=0;$<i;$++){const D=$*C,N=$*O,z=A[N],U=A[N+1],Y=A[N+2],H=A[N+3];S[D]=s*z+l*U+p*Y+v*H,S[D+1]=n*z+c*U+g*Y+w*H,S[D+2]=o*z+u*U+y*Y+x*H,S[D+3]=a*z+d*U+_*Y+T*H}}function SJe(t,e,r){fH(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function fH(t,e,r,i=4,s=i){if(t.length/i!=e.length/s)return void MN.error("source and destination buffers need to have the same number of elements");const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],d=r[5],p=r[6],g=r[7],y=r[8];let _=0,v=0;for(let w=0;w<n;w++){const x=e[_],T=e[_+1],S=e[_+2],C=e[_+3];t[v]=o*x+c*T+p*S,t[v+1]=a*x+u*T+g*S,t[v+2]=l*x+d*T+y*S,t[v+3]=C,_+=s,v+=i}}function EJe(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*s,c=a*o,u=n[c],d=n[c+1],p=n[c+2],g=u*u+d*d+p*p;if(g>0){const y=1/Math.sqrt(g);i[l]=y*u,i[l+1]=y*d,i[l+2]=y*p}}}function CJe(t,e,r){tL(t.typedBuffer,e,r,t.typedBufferStride)}function tL(t,e,r,i=4){const s=Math.min(t.length/i,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=r*n[a],t[l+1]=r*n[a+1],t[l+2]=r*n[a+2],t[l+3]=r*n[a+3],a+=o,l+=i}Object.freeze(Object.defineProperty({__proto__:null,normalize:EJe,scale:tL,scaleView:CJe,transformMat3:fH,transformMat3View:SJe,transformMat4:TJe},Symbol.toStringTag,{value:"Module"}));function AJe(t,e){mH(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function mH(t,e,r=2,i=r){const s=e.length/2;let n=0,o=0;if(Cu(e)||Qxe(e)){for(let l=0;l<s;++l)t[n]=e[o],t[n+1]=e[o+1],n+=r,o+=i;return}const a=Kxe(e);if(Jxe(e))for(let l=0;l<s;++l)t[n]=Math.max(e[o]/a,-1),t[n+1]=Math.max(e[o+1]/a,-1),n+=r,o+=i;else for(let l=0;l<s;++l)t[n]=e[o]/a,t[n+1]=e[o+1]/a,n+=r,o+=i}function RJe(t,e,r,i){const s=t.typedBuffer,n=t.typedBufferStride,o=(i==null?void 0:i.count)??t.count;let a=((i==null?void 0:i.dstIndex)??0)*n;for(let l=0;l<o;++l)s[a]=e,s[a+1]=r,a+=n}Object.freeze(Object.defineProperty({__proto__:null,fill:RJe,normalizeIntegerBuffer:mH,normalizeIntegerBufferView:AJe},Symbol.toStringTag,{value:"Module"}));function OJe(t,e){fA(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function fA(t,e,r=3,i=r){const s=e.length/i;let n=0,o=0;for(let a=0;a<s;++a)t[n]=e[o],t[n+1]=e[o+1],t[n+2]=e[o+2],n+=r,o+=i}function PJe(t,e,r,i,s){const n=t.typedBuffer,o=t.typedBufferStride,a=(s==null?void 0:s.count)??t.count;let l=((s==null?void 0:s.dstIndex)??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=r,n[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:fA,copyView:OJe,fill:PJe},Symbol.toStringTag,{value:"Module"}));function MJe(t,e){gH(t.typedBuffer,e,t.typedBufferStride)}function gH(t,e,r=4){const i=e.typedBuffer,s=e.typedBufferStride,n=e.count;let o=0,a=0;for(let l=0;l<n;++l)t[o]=i[a],t[o+1]=i[a+1],t[o+2]=i[a+2],t[o+3]=i[a+3],o+=r,a+=s}function $Je(t,e,r,i,s,n){const o=t.typedBuffer,a=t.typedBufferStride,l=(n==null?void 0:n.count)??t.count;let c=((n==null?void 0:n.dstIndex)??0)*a;for(let u=0;u<l;++u)o[c]=e,o[c+1]=r,o[c+2]=i,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:gH,copyView:MJe,fill:$Je},Symbol.toStringTag,{value:"Module"}));let M1e=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,r){return this._load("json",e,r)}async loadBinary(e,r){return qp(e)?(wt(r),t7(e)):this._load("binary",e,r)}async loadImage(e,r){return this._load("image",e,r)}async _load(e,r,i){if(this._streamDataRequester==null)return(await Hi(r,{responseType:IJe[e]})).data;const s=await mm(this._streamDataRequester.request(r,e,i));if(s.ok===!0)return s.value;throw ly(s.error),new X("",`Request for resource failed: ${s.error}`)}};const IJe={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function LJe(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function DJe(t,e={}){return{data:t,parameters:{wrap:{s:Ft.REPEAT,t:Ft.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}let d2=class{constructor(e,r,i=""){this.major=e,this.minor=r,this._context=i}lessThan(e,r){return this.major<e||e===this.major&&this.minor<r}since(e,r){return!this.lessThan(e,r)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new X(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new d2(this.major,this.minor,this._context)}static parse(e,r=""){const[i,s]=e.split("."),n=/^\s*\d+\s*$/;if(!(i!=null&&i.match)||!n.test(i))throw new X((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!(s!=null&&s.match)||!n.test(s))throw new X((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(i,10),a=parseInt(s,10);return new d2(o,a,r)}};function kM(t,e){const r=t.count;e||(e=new t.TypedArrayConstructor(r));for(let i=0;i<r;i++)e[i]=t.get(i);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:kM},Symbol.toStringTag,{value:"Module"}));let FK=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const r=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,r,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var oC,UK;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(oC||(oC={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(UK||(UK={}));const $1e={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},NJe={pbrMetallicRoughness:$1e,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},FJe={ESRI_externalColorMixMode:"tint"},kK=(t={})=>{const e={...$1e,...t.pbrMetallicRoughness},r=UJe({...FJe,...t.extras});return{...NJe,...t,pbrMetallicRoughness:e,extras:r}};function UJe(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const kJe={magFilter:Dt.LINEAR,minFilter:Dt.LINEAR_MIPMAP_LINEAR,wrapS:Ft.REPEAT,wrapT:Ft.REPEAT},BJe=t=>({...kJe,...t});function zJe(t){let e,r;return t.replace(/^(.*\/)?([^/]*)$/,(i,s,n)=>(e=s||"",r=n||"","")),{dirPart:e,filePart:r}}const CO={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let VJe=class Xg{constructor(e,r,i,s){if(this._context=e,this.uri=r,this.json=i,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=zJe(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.scenes==null)throw new X("gltf-loader-unsupported-feature","Scenes must be defined.");if(i.meshes==null)throw new X("gltf-loader-unsupported-feature","Meshes must be defined");if(i.nodes==null)throw new X("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,r,i){if(qp(r)){const o=B0(r);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new Xg(e,r,l)}catch{}const a=t7(r);if(Xg._isGLBData(a))return this._fromGLBData(e,r,a)}if(YJe.test(r)||(i==null?void 0:i.expectedType)==="gltf"){const o=await e.loadJSON(r,i);return new Xg(e,r,o)}const s=await e.loadBinary(r,i);if(Xg._isGLBData(s))return this._fromGLBData(e,r,s);if(XJe.test(r)||(i==null?void 0:i.expectedType)==="glb")throw new X("gltf-loader-invalid-glb","This is not a valid glb file.");const n=await e.loadJSON(r,i);return new Xg(e,r,n)}static _isGLBData(e){if(e==null)return!1;const r=new FK(e);return r.remainingBytes()>=4&&r.readUint32()===CO.MAGIC}static async _fromGLBData(e,r,i){const s=await Xg._parseGLBData(i);return new Xg(e,r,s.json,s.binaryData)}static async _parseGLBData(e){const r=new FK(e);if(r.remainingBytes()<12)throw new X("gltf-loader-error","glb binary data is insufficiently large.");const i=r.readUint32(),s=r.readUint32(),n=r.readUint32();if(i!==CO.MAGIC)throw new X("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(e.byteLength<n)throw new X("gltf-loader-error","glb binary data is smaller than header specifies.");if(s!==2)throw new X("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let o,a,l=0;for(;r.remainingBytes()>=8;){const c=r.readUint32(),u=r.readUint32();if(l===0){if(u!==CO.CHUNK_TYPE_JSON)throw new X("gltf-loader-error","First glb chunk must be JSON.");if(c<0)throw new X("gltf-loader-error","No JSON data found.");o=await JZe(r.readUint8Array(c))}else if(l===1){if(u!==CO.CHUNK_TYPE_BIN)throw new X("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");a=r.readUint8Array(c)}else ne.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");l+=1}if(!o)throw new X("gltf-loader-error","No glb JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,r){const i=this.json.buffers[e];if(i.uri==null){if(this._glbBuffer==null)throw new X("gltf-loader-error","glb buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(e,r);if(s.byteLength!==i.byteLength)throw new X("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(e,r){const i=this._bufferLoaders.get(e);if(i)return i;const s=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(s),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,n),n}async getAccessor(e,r){if(!this.json.accessors)throw new X("gltf-loader-unsupported-feature","Accessors missing.");const i=this.json.accessors[e];if((i==null?void 0:i.bufferView)==null)throw new X("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(i.type in[oC.MAT2,oC.MAT3,oC.MAT4])throw new X("gltf-loader-unsupported-feature",`AttributeType ${i.type} is not supported`);const s=this.json.bufferViews[i.bufferView],n=await this.getBuffer(s.buffer,r),o=HJe[i.type],a=qJe[i.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(e,r){if(e.indices==null)return;const i=await this.getAccessor(e.indices,r);if(i.isDenselyPacked)switch(i.componentType){case Xe.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case Xe.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case Xe.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case Xe.UNSIGNED_BYTE:return kM(this._wrapAccessor(t2,i));case Xe.UNSIGNED_SHORT:return kM(this._wrapAccessor(sN,i));case Xe.UNSIGNED_INT:return kM(this._wrapAccessor(oN,i))}}async getPositionData(e,r){if(e.attributes.POSITION==null)throw new X("gltf-loader-unsupported-feature","No POSITION vertex data found.");const i=await this.getAccessor(e.attributes.POSITION,r);if(i.componentType!==Xe.FLOAT)throw new X("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+Xe[i.componentType]);if(i.componentCount!==3)throw new X("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(cn,i)}async getNormalData(e,r){if(e.attributes.NORMAL==null)throw new X("gltf-loader-error","No NORMAL vertex data found.");const i=await this.getAccessor(e.attributes.NORMAL,r);if(i.componentType!==Xe.FLOAT)throw new X("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+Xe[i.componentType]);if(i.componentCount!==3)throw new X("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(cn,i)}async getTangentData(e,r){if(e.attributes.TANGENT==null)throw new X("gltf-loader-error","No TANGENT vertex data found.");const i=await this.getAccessor(e.attributes.TANGENT,r);if(i.componentType!==Xe.FLOAT)throw new X("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+Xe[i.componentType]);if(i.componentCount!==4)throw new X("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed());return new nd(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(e,r){if(e.attributes.TEXCOORD_0==null)throw new X("gltf-loader-error","No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(e.attributes.TEXCOORD_0,r);if(i.componentCount!==2)throw new X("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed());if(i.componentType===Xe.FLOAT)return this._wrapAccessor(Mv,i);if(!i.normalized)throw new X("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return WJe(i)}async getVertexColors(e,r){if(e.attributes.COLOR_0==null)throw new X("gltf-loader-error","No COLOR_0 vertex data found.");const i=await this.getAccessor(e.attributes.COLOR_0,r);if(i.componentCount!==4&&i.componentCount!==3)throw new X("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed());if(i.componentCount===4){if(i.componentType===Xe.FLOAT)return this._wrapAccessor(nd,i);if(i.componentType===Xe.UNSIGNED_BYTE)return this._wrapAccessor(jo,i);if(i.componentType===Xe.UNSIGNED_SHORT)return this._wrapAccessor(X3,i)}else if(i.componentCount===3){if(i.componentType===Xe.FLOAT)return this._wrapAccessor(cn,i);if(i.componentType===Xe.UNSIGNED_BYTE)return this._wrapAccessor(iN,i);if(i.componentType===Xe.UNSIGNED_SHORT)return this._wrapAccessor(nN,i)}throw new X("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+Xe[i.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,r,i){var n,o,a,l,c,u,d,p,g,y;let s=e.material?this._materialCache.get(e.material):void 0;if(!s){const _=e.material!=null?kK(this.json.materials[e.material]):kK(),v=_.pbrMetallicRoughness,w=this.hasVertexColors(e),x=this.getTexture(v.baseColorTexture,r),T=this.getTexture(_.normalTexture,r),S=i?this.getTexture(_.occlusionTexture,r):void 0,C=i?this.getTexture(_.emissiveTexture,r):void 0,A=i?this.getTexture(v.metallicRoughnessTexture,r):void 0,O=e.material!=null?e.material:-1;s={alphaMode:_.alphaMode,alphaCutoff:_.alphaCutoff,color:v.baseColorFactor,doubleSided:!!_.doubleSided,colorTexture:await x,normalTexture:await T,name:_.name,id:O,occlusionTexture:await S,emissiveTexture:await C,emissiveFactor:_.emissiveFactor,metallicFactor:v.metallicFactor,roughnessFactor:v.roughnessFactor,metallicRoughnessTexture:await A,hasVertexColors:w,ESRI_externalColorMixMode:_.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(n=v==null?void 0:v.baseColorTexture)==null?void 0:n.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=_.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(u=(c=_.occlusionTexture)==null?void 0:c.extensions)==null?void 0:u.KHR_texture_transform,emissiveTextureTransform:(p=(d=_.emissiveTexture)==null?void 0:d.extensions)==null?void 0:p.KHR_texture_transform,metallicRoughnessTextureTransform:(y=(g=v==null?void 0:v.metallicRoughnessTexture)==null?void 0:g.extensions)==null?void 0:y.KHR_texture_transform}}return s}async getTexture(e,r){if(!e)return;if((e.texCoord||0)!==0)throw new X("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const i=e.index,s=this.json.textures[i],n=BJe(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=this._getTextureSourceId(s),a=this.json.images[o],l=await this._loadTextureImageData(i,s,r);return mne(this._textureCache,i,()=>{const c=d=>d===33071||d===33648||d===10497,u=d=>{throw new X("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${d}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:u(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:u(n.wrapT),minFilter:n.minFilter,name:a.name,id:i}})}getNodeTransform(e){if(e===void 0)return GJe;let r=this._nodeTransformCache.get(e);if(!r){const i=this.getNodeTransform(this._getNodeParent(e)),s=this.json.nodes[e];s.matrix?r=Pr(ge(),i,s.matrix):s.translation||s.rotation||s.scale?(r=Vx(i),s.translation&&Ya(r,r,s.translation),s.rotation&&(AO[3]=KV(AO,s.rotation),El(r,r,AO[3],AO)),s.scale&&O3(r,r,s.scale)):r=Vx(i),this._nodeTransformCache.set(e,r)}return r}_wrapAccessor(e,r){return new e(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(e){return dc(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=d2.parse(this.json.asset.version,"glTF");jJe.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new X("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,r)=>{e.children&&e.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(e,r,i){const s=this._textureLoaders.get(e);if(s)return s;const n=this._createTextureLoader(r,i);return this._textureLoaders.set(e,n),n}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new X("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,r){const i=this._getTextureSourceId(e),s=this.json.images[i];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),r);return new S1e(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),r)}if(s.bufferView==null)throw new X("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new X("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,r);if(n.byteStride!=null)throw new X("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return QZe(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await Sq(Array.from(this._bufferLoaders.values())),r=await Sq(Array.from(this._textureLoaders.values()));return e.reduce((i,s)=>i+((s==null?void 0:s.byteLength)??0),0)+r.reduce((i,s)=>i+(s?nC(s)?s.data.byteLength:s.width*s.height*4:0),0)}};const GJe=nae(ge(),Math.PI/2),jJe=new d2(2,0,"glTF"),AO=Bu(),HJe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qJe={[Xe.BYTE]:1,[Xe.UNSIGNED_BYTE]:1,[Xe.SHORT]:2,[Xe.UNSIGNED_SHORT]:2,[Xe.FLOAT]:4,[Xe.INT]:4,[Xe.UNSIGNED_INT]:4};function WJe(t){switch(t.componentType){case Xe.BYTE:return new aN(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Xe.UNSIGNED_BYTE:return new rN(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Xe.SHORT:return new Z3(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Xe.UNSIGNED_SHORT:return new kG(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Xe.UNSIGNED_INT:return new BG(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Xe.FLOAT:return new Mv(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}const YJe=/\.gltf$/i,XJe=/\.glb$/i;let ZJe=0;async function I1e(t,e,r={},i=!0){const s=await VJe.load(t,e,r),n="gltf_"+ZJe++,o={lods:[],materials:new Map,textures:new Map,meta:JJe(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await QJe(s,async(u,d,p,g)=>{var N;const y=l.get(p)??0;l.set(p,y+1);const _=u.mode!==void 0?u.mode:Qt.TRIANGLES,v=_===Qt.TRIANGLES||_===Qt.TRIANGLE_STRIP||_===Qt.TRIANGLE_FAN?_:null;if(v==null)return void ne.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+Qt[_]+"). Skipping primitive.");if(!s.hasPositions(u))return void ne.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const w=s.getPositionData(u,r),x=s.getMaterial(u,r,i),T=s.hasNormals(u)?s.getNormalData(u,r):null,S=s.hasTangents(u)?s.getTangentData(u,r):null,C=s.hasTextureCoordinates(u)?s.getTextureCoordinates(u,r):null,A=s.hasVertexColors(u)?s.getVertexColors(u,r):null,O=s.getIndexData(u,r),$={name:g,transform:Vx(d),attributes:{position:await w,normal:T?await T:null,texCoord0:C?await C:null,color:A?await A:null,tangent:S?await S:null},indices:await O,primitiveType:v,material:eQe(o,await x,n)};let D=null;((N=o.meta)==null?void 0:N.ESRI_lod)!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(D=o.meta.ESRI_lod.thresholds[p]),o.lods[p]=o.lods[p]||{parts:[],name:g,lodThreshold:D},o.lods[p].parts[y]=$});for(const u of o.lods)u.parts=u.parts.filter(d=>!!d);const c=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{},size:c}}function JJe(t){const e=t.json;let r=null;return e.nodes.forEach(i=>{const s=i.extras;s!=null&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(r=s)}),r}async function QJe(t,e){const r=t.json,i=r.scenes[r.scene||0].nodes,s=i.length>1,n=[];for(const a of i){const l=r.nodes[a];n.push(o(a,0)),KJe(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,u)=>o(c,u+1))}async function o(a,l){const c=r.nodes[a],u=t.getNodeTransform(a);if(c.weights!=null&&ne.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const d=r.meshes[c.mesh];for(const p of d.primitives)n.push(e(p,u,l,d.name))}for(const d of c.children||[])n.push(o(d,l))}await Promise.all(n)}function KJe(t){var e;return((e=t.extensions)==null?void 0:e.MSFT_lod)&&Array.isArray(t.extensions.MSFT_lod.ids)}function eQe(t,e,r){const i=n=>{const o=`${r}_tex_${n&&n.id}${n!=null&&n.name?"_"+n.name:""}`;if(n&&!t.textures.has(o)){const a=DJe(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:tQe.has(n.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},s=`${r}_mat_${e.id}_${e.name}`;if(!t.materials.has(s)){const n=LJe({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?i(e.colorTexture):void 0,textureNormal:e.normalTexture?i(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?i(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?i(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?i(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(s,n)}return s}const tQe=new Set([Dt.LINEAR_MIPMAP_LINEAR,Dt.LINEAR_MIPMAP_NEAREST]);function rQe(t,e){switch(e){case Qt.TRIANGLES:return iQe(t);case Qt.TRIANGLE_STRIP:return sQe(t);case Qt.TRIANGLE_FAN:return nQe(t)}}function iQe(t){return typeof t=="number"?$v(t):p0(t)?new Uint16Array(t):t}function sQe(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const r=e-2,i=wI(3*r);if(typeof t=="number"){let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=n,i[s++]=n+1,i[s++]=n+2):(i[s++]=n+1,i[s++]=n,i[s++]=n+2)}else{let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=t[n],i[s++]=t[n+1],i[s++]=t[n+2]):(i[s++]=t[n+1],i[s++]=t[n],i[s++]=t[n+2])}return i}function nQe(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const r=e-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof t=="number"){let a=0;for(let l=0;l<r;++l)i[a++]=0,i[a++]=l+1,i[a++]=l+2;return i}const s=t[0];let n=t[1],o=0;for(let a=0;a<r;++a){const l=t[a+2];i[o++]=s,i[o++]=n,i[o++]=l,n=l}return i}let oQe=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},aQe=class{constructor(e,r,i){this.name=e,this.lodThreshold=r,this.pivotOffset=i,this.stageResources=new oQe,this.numberOfVertices=0}};const Lf=ne.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function L1e(t,e){const r=await lQe(t,e),i=await pQe(r.textureDefinitions??{},e);let s=0;for(const n in i)if(i.hasOwnProperty(n)){const o=i[n];s+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:r,textures:i,size:s+Cse(r)}}async function lQe(t,e){const r=e==null?void 0:e.streamDataRequester;if(r)return cQe(t,r,e);const i=await mm(Hi(t,e));if(i.ok===!0)return i.value.data;ly(i.error),D1e(i.error)}async function cQe(t,e,r){const i=await mm(e.request(t,"json",r));if(i.ok===!0)return i.value;ly(i.error),D1e(i.error.details.url)}function D1e(t){throw new X("",`Request for object resource failed: ${t}`)}function uQe(t){const e=t.params,r=e.topology;let i=!0;switch(e.vertexAttributes||(Lf.warn("Geometry must specify vertex attributes"),i=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a!=null&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(Lf.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(Lf.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(Lf.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else Lf.warn("Indexed geometries must specify faces"),i=!1;break}default:Lf.warn(`Unsupported topology '${r}'`),i=!1}t.params.material||(Lf.warn("Geometry requires material"),i=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(Lf.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function hQe(t,e){var y,_;const r=new Array,i=new Array,s=new Array,n=new B2,o=t.resource,a=d2.parse(o.version||"1.0","wosr");mQe.validate(a);const l=o.model.name,c=o.model.geometries,u=o.materialDefinitions??{},d=t.textures;let p=0;const g=new Map;for(let v=0;v<c.length;v++){const w=c[v];if(!uQe(w))continue;const x=fQe(w),T=w.params.vertexAttributes,S=[],C=V=>{if(w.params.topology==="PerAttributeArray")return null;const J=w.params.faces;for(const P in J)if(P===V)return J[P].values;return null},A=T[R.POSITION],O=A.values.length/A.valuesPerElement;for(const V in T){const J=T[V],P=J.values,I=C(V)??$v(O);S.push([V,new Ue(P,I,J.valuesPerElement,!0)])}const $=x.texture,D=d&&d[$];if(D&&!g.has($)){const{image:V,parameters:J}=D,P=new Nv(V,J);i.push(P),g.set($,P)}const N=g.get($),z=N?N.id:void 0,U=x.material;let Y=n.get(U,$);if(Y==null){const V=u[U.substring(U.lastIndexOf("/")+1)].params;V.transparency===1&&(V.transparency=0);const J=D&&D.alphaChannelUsage,P=V.transparency>0||J==="transparency"||J==="maskAndTransparency",I=D?N1e(D.alphaChannelUsage):void 0,B={ambient:Oo(V.diffuse),diffuse:Oo(V.diffuse),opacity:1-(V.transparency||0),transparent:P,textureAlphaMode:I,textureAlphaCutoff:.33,textureId:z,initTextureTransparent:!0,doubleSided:!0,cullFace:oi.None,colorMixMode:V.externalColorMixMode||"tint",textureAlphaPremultiplied:(D==null?void 0:D.parameters.preMultiplyAlpha)??!1};e!=null&&e.materialParameters&&Object.assign(B,e.materialParameters),Y=new od(B),n.set(U,$,Y)}s.push(Y);const H=new Ds(Y,S);p+=((_=(y=S.find(V=>V[0]===R.POSITION))==null?void 0:y[1])==null?void 0:_.indices.length)??0,r.push(H)}return{engineResources:[{name:l,stageResources:{textures:i,materials:s,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:p,lodThreshold:null}],referenceBoundingBox:dQe(r)}}function dQe(t){const e=ui();return t.forEach(r=>{const i=r.boundingInfo;i!=null&&(rd(e,i.bbMin),rd(e,i.bbMax))}),e}async function pQe(t,e){const r=new Array;for(const n in t){const o=t[n],a=o.images[0].data;if(!a){Lf.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,u=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:Ft.REPEAT,t:Ft.REPEAT},preMultiplyAlpha:N1e(u)!==Ur.Opaque},p=e!=null&&e.disableTextures?Promise.resolve(null):Cm(l,e);r.push(p.then(g=>({refId:c,image:g,parameters:d,alphaChannelUsage:u})))}const i=await Promise.all(r),s={};for(const n of i)s[n.refId]=n;return s}function N1e(t){switch(t){case"mask":return Ur.Mask;case"maskAndTransparency":return Ur.MaskBlend;case"none":return Ur.Opaque;default:return Ur.Blend}}function fQe(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const mQe=new d2(1,2,"wosr"),Cb=2.1;async function F1e(t,e){var d;const r=U1e(QB(t));if(r.fileType==="wosr"){const p=await(e.cache?e.cache.loadWOSR(r.url,e):L1e(r.url,e)),{engineResources:g,referenceBoundingBox:y}=hQe(p,e);return{lods:g,referenceBoundingBox:y,isEsriSymbolResource:!1,isWosr:!0}}const i=await(e.cache?e.cache.loadGLTF(r.url,e,!!e.usePBR):I1e(new M1e(e.streamDataRequester),r.url,e,e.usePBR)),s=(d=i.model.meta)==null?void 0:d.ESRI_proxyEllipsoid,n=i.meta.isEsriSymbolResource&&s!=null&&i.meta.uri.includes("/RealisticTrees/");n&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,vQe(i,s));const o=!!e.usePBR,a=i.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[...FGe]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...CN]},l={...e.materialParameters,treeRendering:n},{engineResources:c,referenceBoundingBox:u}=k1e(i,a,l,e.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:c,referenceBoundingBox:u,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function U1e(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function k1e(t,e,r,i){const s=t.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=ui();return s.lods.forEach((u,d)=>{const p=i.skipHighLods===!0&&(l>1&&d===0||l>3&&d===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&d!==i.singleLodIndex;if(p&&d!==0)return;const g=new aQe(u.name,u.lodThreshold,[0,0,0]);u.parts.forEach(y=>{const _=p?new od({}):gQe(s,y,g,e,r,o,a),{geometry:v,vertexCount:w}=yQe(y,_??new od({})),x=v.boundingInfo;x!=null&&d===0&&(rd(c,x.bbMin),rd(c,x.bbMax)),_!=null&&(g.stageResources.geometries.push(v),g.numberOfVertices+=w)}),p||n.push(g)}),{engineResources:n,referenceBoundingBox:c}}function gQe(t,e,r,i,s,n,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,u=e.attributes.normal!=null;if(l==null)return null;const d=_Qe(l.alphaMode);if(!n.has(a)){if(c){const C=(A,O=!1)=>{if(A!=null&&!o.has(A)){const $=t.textures.get(A);if($!=null){const D=$.data;o.set(A,new Nv(nC(D)?D.data:D,{...$.parameters,preMultiplyAlpha:!nC(D)&&O,encoding:nC(D)&&D.encoding!=null?D.encoding:void 0}))}}};C(l.textureColor,d!==Ur.Opaque),C(l.textureNormal),C(l.textureOcclusion),C(l.textureEmissive),C(l.textureMetallicRoughness)}const g=l.color[0]**(1/Cb),y=l.color[1]**(1/Cb),_=l.color[2]**(1/Cb),v=l.emissiveFactor[0]**(1/Cb),w=l.emissiveFactor[1]**(1/Cb),x=l.emissiveFactor[2]**(1/Cb),T=l.textureColor!=null&&c?o.get(l.textureColor):null,S=U0e({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion});n.set(a,new od({...i,transparent:d===Ur.Blend,customDepthTest:ov.Lequal,textureAlphaMode:d,textureAlphaCutoff:l.alphaCutoff,diffuse:[g,y,_],ambient:[g,y,_],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?oi.None:oi.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:u?Tr.Attribute:Tr.ScreenDerivative,castShadows:!0,textureId:T!=null?T.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:T!=null&&!!T.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[v,w,x],mrrFactors:S?[...Pj]:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:S,colorTextureTransformMatrix:gp(l.colorTextureTransform),normalTextureTransformMatrix:gp(l.normalTextureTransform),occlusionTextureTransformMatrix:gp(l.occlusionTextureTransform),emissiveTextureTransformMatrix:gp(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:gp(l.metallicRoughnessTextureTransform),...s}))}const p=n.get(a);if(r.stageResources.materials.push(p),c){const g=y=>{y!=null&&r.stageResources.textures.push(o.get(y))};g(l.textureColor),g(l.textureNormal),g(l.textureOcclusion),g(l.textureEmissive),g(l.textureMetallicRoughness)}return p}function yQe(t,e){const r=t.attributes.position.count,i=rQe(t.indices||r,t.primitiveType),s=Gi(3*r),{typedBuffer:n,typedBufferStride:o}=t.attributes.position;ld(s,n,t.transform,3,o);const a=[[R.POSITION,new Ue(s,i,3,!0)]];if(t.attributes.normal!=null){const l=Gi(3*r),{typedBuffer:c,typedBufferStride:u}=t.attributes.normal;wm(RO,t.transform),cd(l,c,RO,3,u),a.push([R.NORMAL,new Ue(l,i,3,!0)])}if(t.attributes.tangent!=null){const l=Gi(4*r),{typedBuffer:c,typedBufferStride:u}=t.attributes.tangent;wm(RO,t.transform),fH(l,c,RO,4,u),a.push([R.TANGENT,new Ue(l,i,4,!0)])}if(t.attributes.texCoord0!=null){const l=Gi(2*r),{typedBuffer:c,typedBufferStride:u}=t.attributes.texCoord0;mH(l,c,2,u),a.push([R.UV0,new Ue(l,i,2,!0)])}if(t.attributes.color!=null){const l=new Uint8Array(4*r);t.attributes.color.elementCount===4?t.attributes.color instanceof nd?tL(l,t.attributes.color,255):t.attributes.color instanceof jo?gH(l,t.attributes.color):t.attributes.color instanceof X3&&tL(l,t.attributes.color,1/256):(l.fill(255),t.attributes.color instanceof cn?GI(l,t.attributes.color,255,4):t.attributes.color instanceof iN?fA(l,t.attributes.color.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof nN&&GI(l,t.attributes.color,1/256,4)),a.push([R.COLOR,new Ue(l,i,4,!0)])}return{geometry:new Ds(e,a),vertexCount:r}}const RO=Fi();function _Qe(t){switch(t){case"BLEND":return Ur.Blend;case"MASK":return Ur.Mask;case"OPAQUE":case null:case void 0:return Ur.Opaque}}function vQe(t,e){for(let r=0;r<t.model.lods.length;++r){const i=t.model.lods[r];for(const s of i.parts){const n=s.attributes.normal;if(n==null)return;const o=s.attributes.position,a=o.count,l=E(),c=E(),u=E(),d=new Uint8Array(4*a),p=new Float64Array(3*a),g=Ls(ge(),s.transform);let y=0,_=0;for(let v=0;v<a;v++){o.getVec(v,c),n.getVec(v,l),De(c,c,s.transform),ce(u,c,e.center),M$(u,u,e.radius);const w=u[2],x=_e(u),T=Math.min(.45+.55*x*x,1);M$(u,u,e.radius),g!==null&&De(u,u,g),pe(u,u),r+1!==t.model.lods.length&&t.model.lods.length>1&&$r(u,u,l,w>-1?.2:Math.min(-4*w-3.8,1)),p[y]=u[0],p[y+1]=u[1],p[y+2]=u[2],y+=3,d[_]=255*T,d[_+1]=255*T,d[_+2]=255*T,d[_+3]=255,_+=4}s.attributes.normal=new cn(p),s.attributes.color=new jo(d)}}}const PSt=Object.freeze(Object.defineProperty({__proto__:null,fetch:F1e,gltfToEngineResources:k1e,parseUrl:U1e},Symbol.toStringTag,{value:"Module"})),bQe=()=>!!te("enable-feature:force-wosr"),MSt=()=>!!te("enable-feature:direct-3d-object-feature-layer-display"),wQe=()=>te.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),xQe=()=>te.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),$St=()=>!!te("enable-i3s-patching"),TQe=()=>te.add("enable-i3s-patching",!0,!0,!0),SQe=()=>te.add("enable-i3s-patching",!1,!0,!0),ISt=()=>!!te("enable-feature:SceneLayer-editing"),EQe=(t="i3s-patching")=>{switch(SQe(),xQe(),te.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":wQe();break;case"i3s-patching":TQe()}};EQe("i3s-patching");let FF={};async function CQe(t,e){try{return{data:(await yH(t,e)).data,baseUrl:s7(t),styleUrl:t}}catch(r){return ly(r),null}}function AQe(t,e,r){const i=e.portal!=null?e.portal:Au.getDefault();let s;const n=`${i.url} - ${i.user&&i.user.username} - ${t}`;return FF[n]||(FF[n]=RQe(t,i,r).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl??"",styleName:t}))),FF[n]}function RQe(t,e,r){return e.load(r).then(()=>{const i=new hp({disableExtraQuery:!0,query:`owner:${BK} AND type:${zK} AND typekeywords:"${t}"`});return e.queryItems(i,r)}).then(({results:i})=>{var o;let s=null;const n=t.toLowerCase();if(i&&Array.isArray(i)){for(const a of i)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===n))&&a.type===zK&&a.owner===BK){s=a;break}}if(!s)throw new X("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(r)})}function B1e(t,e,r){return(t==null?void 0:t.styleUrl)!=null?CQe(t.styleUrl,r):(t==null?void 0:t.styleName)!=null?AQe(t.styleName,e,r):Promise.reject(new X("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function z1e(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function V1e(t,e,r=["gltf"]){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!bQe())for(const i of r){const s=t.formatInfos.find(n=>n.type===i);if(s)return s.href}return t.webRef}function yH(t,e){const r={responseType:"json",query:{f:"json"},...e};return Hi(rm(t),r)}const BK="esri_en",zK="Style",OQe="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",LT={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function PQe(t,e=LT){var a,l;if(!t)return{symbol:null};const{retainId:r=LT.retainId,ignoreDrivers:i=LT.ignoreDrivers,hasLabelingContext:s=LT.hasLabelingContext,retainCIM:n=LT.retainCIM}=e;let o=null;if(rv(t)||t instanceof P2)o=t.clone();else if(t.type==="cim"){const c=(l=(a=t.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new X("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:t})};o=n?t.clone():_0.fromCIMSymbol(t)}else if(t instanceof xv)o=wD.fromSimpleLineSymbol(t);else if(t instanceof ED)o=_0.fromSimpleMarkerSymbol(t);else if(t instanceof TD)o=_0.fromPictureMarkerSymbol(t);else if(t instanceof vV)o=e.geometryType&&e.geometryType==="mesh"?xD.fromSimpleFillSymbol(t):SD.fromSimpleFillSymbol(t);else{if(!(t instanceof k3))return{error:new X("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=s?bD.fromTextSymbol(t):_0.fromTextSymbol(t)}return r&&o&&o.type!=="cim"&&(o.id=t.id),i&&rv(o)&&o.symbolLayers.forEach(c=>c.ignoreDrivers=!0),{symbol:o}}function LSt(t,e,r,i){const s=G1e(t,{},{context:i,isLabelSymbol:!1});s!=null&&(e[r]=s)}function DSt(t,e,r,i){const s=G1e(t,{},{context:i,isLabelSymbol:!0});s!=null&&(e[r]=s)}function VK(t){return t instanceof O2||t instanceof P2}function G1e(t,e,r){if(t==null)return null;const{context:i,isLabelSymbol:s}=r,n=i==null?void 0:i.origin,o=i==null?void 0:i.messages;if(n==="web-scene"&&!VK(t)){const a=PQe(t,{retainCIM:!0,hasLabelingContext:s});return a.symbol!=null?a.symbol.write(e,i):(o==null||o.push(new X("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:i,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!bCe(i==null?void 0:i.layer))&&VK(t)?(o==null||o.push(new X("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:i})),null):t.write(e,i)}function j1e(t,e){return m$e(t,null,e)}function MQe(t,e,r,i){const s=t.name;return s==null?Promise.reject(new X("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?$Qe(s,e,i):B1e(t,e,i).then(n=>vH(n,s,e,r,V1e,i))}function _H(t,e){return e.items.find(r=>r.name===t)}function vH(t,e,r,i,s,n){var g,y;const o=(r==null?void 0:r.portal)!=null?r.portal:Au.getDefault(),a={portal:o,url:Wn(t.baseUrl),origin:"portal-item"},l=_H(e,t.data);if(!l){const _=`The symbol name '${e}' could not be found`;return Promise.reject(new X("symbolstyleutils:symbol-name-not-found",_,{symbolName:e}))}let c=ev(s(l,i),a),u=((g=l.thumbnail)==null?void 0:g.href)??null;const d=(y=l.thumbnail)==null?void 0:y.imageData;wJe()&&(c=QB(c)??"",u=QB(u));const p={portal:o,url:Wn(s7(c)),origin:"portal-item"};return yH(c,n).then(_=>{const v=i==="cimRef"?z1e(_.data):_.data,w=j1e(v,p);if(w&&rv(w)){if(u){const x=ev(u,a);w.thumbnail=new A1({url:x})}else d&&(w.thumbnail=new A1({url:`data:image/png;base64,${d}`}));t.styleUrl?w.styleOrigin=new IC({portal:r.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(w.styleOrigin=new IC({portal:r.portal,styleName:t.styleName,name:e}))}return w})}function $Qe(t,e,r){const i=OQe.replaceAll(/\{SymbolName\}/gi,t),s=e.portal!=null?e.portal:Au.getDefault();return yH(i,r).then(n=>{const o=z1e(n.data);return j1e(o,{portal:s,url:Wn(s7(i)),origin:"portal-item"})})}const IQe=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:vH,getStyleItemFromStyle:_H,resolveWebStyleSymbol:MQe},Symbol.toStringTag,{value:"Module"}));async function LQe(t){var a;if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new X("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const r={portal:t.portal},i=await B1e(t,r).catch(()=>null);if(i===null)return null;const s=_H(e,i.data);if(s&&!((a=s.formatInfos)!=null&&a.some(l=>l.type==="gltf_basisu")))return null;const n=await vH(i,e,r,"webRef",(l,c)=>V1e(l,c,["gltf_basisu","gltf"])).catch(()=>null);if(n===null||n.type!=="point-3d")return null;const o=n.symbolLayers.items[0];return o.type==="object"?o.resource:null}let DQe=class{constructor(e,r,i){this._elementSize=r,this._buffer=Cr.createVertex(e,yr.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.byteLength}copyRange(e,r,i,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(r-e)*this.elementSize);new Uint8Array(i.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,r){const i=e*this._elementSize,s=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,s)}resize(e){const r=e*this._elementSize,i=new ArrayBuffer(r);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=e}},NQe=class{constructor(e){this.modelOriginHi=e.getField(R.INSTANCEMODELORIGINHI,cn),this.modelOriginLo=e.getField(R.INSTANCEMODELORIGINLO,cn),this.model=e.getField(R.INSTANCEMODEL,K0),this.modelNormal=e.getField(R.INSTANCEMODELNORMAL,K0),this.featureAttribute=e.getField(R.INSTANCEFEATUREATTRIBUTE,nd),this.color=e.getField(R.INSTANCECOLOR,jo),this.objectAndLayerIdColor=e.getField(R.INSTANCEOBJECTANDLAYERIDCOLOR,jo)}},GK=class{constructor(e,r){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,r=this._tailIndex;return e>=r?e-r:e+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){var e;return((e=this._buffer)==null?void 0:e.usedMemory)??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){Je(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){Je(this._updating,"not updating"),this.size<kxe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){Je(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),Je(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){Je(this._updating,"not updating"),Je(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(rL,Math.floor(this._capacity*OL));this._resize(e)}_shrink(){const e=Math.max(rL,Math.floor(this._capacity*Uxe));this._resize(e)}_resize(e){if(Je(this._updating,"not updating"),e===this._capacity)return;const r=new DQe(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,s=this._compactInstances(r);Je(s===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=r,this._view=new NQe(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,e),r-i):i>r?(this._buffer.copyRange(i,this._capacity,e),r>0&&this._buffer.copyRange(0,r,e,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,r){e<r?this._buffer.transferRange(e,r):e>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(e,this._capacity))}};const rL=64;var xi;function FQe(t){let e=Ci().mat4f64(R.LOCALTRANSFORM).mat4f64(R.GLOBALTRANSFORM).vec4f64(R.BOUNDINGSPHERE).vec3f64(R.MODELORIGIN).mat3f(R.INSTANCEMODEL).mat3f(R.INSTANCEMODELNORMAL).vec2f(R.MODELSCALEFACTORS);return t.includes(R.FEATUREATTRIBUTE)&&(e=e.vec4f(R.FEATUREATTRIBUTE)),t.includes(R.COLOR)&&(e=e.vec4u8(R.COLOR)),t.includes(R.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(R.OBJECTANDLAYERIDCOLOR)),e=e.u8(R.STATE).u8(R.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(xi||(xi={}));let jK=class{constructor(e){this.localTransform=e.getField(R.LOCALTRANSFORM,YC),this.globalTransform=e.getField(R.GLOBALTRANSFORM,YC),this.modelOrigin=e.getField(R.MODELORIGIN,Uu),this.model=e.getField(R.INSTANCEMODEL,K0),this.modelNormal=e.getField(R.INSTANCEMODELNORMAL,K0),this.modelScaleFactors=e.getField(R.MODELSCALEFACTORS,Mv),this.boundingSphere=e.getField(R.BOUNDINGSPHERE,tN),this.featureAttribute=e.getField(R.FEATUREATTRIBUTE,nd),this.color=e.getField(R.COLOR,jo),this.objectAndLayerIdColor=e.getField(R.OBJECTANDLAYERIDCOLOR,jo),this.state=e.getField(R.STATE,t2),this.lodLevel=e.getField(R.LODLEVEL,t2)}},vw=class extends xe{constructor(e,r){super(e),this.events=new Ps,this._capacity=0,this._size=0,this._next=0,this._layout=FQe(r),this._capacity=rL,this._buffer=this._layout.createBuffer(this._capacity),this._view=new jK(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,xi.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const r=this._view.state;Je(e>=0&&e<this._capacity&&(r.get(e)&xi.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,xi.ACTIVE)?this._setStateFlags(e,xi.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const r=this._view.state;Je(e>=0&&e<this._capacity&&(r.get(e)&xi.ALLOCATED)!=0,"invalid instance handle"),r.set(e,0),this._size--}setLocalTransform(e,r,i=!0){this._view.localTransform.setMat(e,r),i&&this.updateModelTransform(e)}getLocalTransform(e,r){this._view.localTransform.getMat(e,r)}setGlobalTransform(e,r,i=!0){this._view.globalTransform.setMat(e,r),i&&this.updateModelTransform(e)}getGlobalTransform(e,r){this._view.globalTransform.getMat(e,r)}updateModelTransform(e){const r=this._view,i=il,s=Qu;r.localTransform.getMat(e,HK),r.globalTransform.getMat(e,UF);const n=Pr(UF,UF,HK);se(i,n[12],n[13],n[14]),r.modelOrigin.setVec(e,i),Iu(s,n),r.model.setMat(e,s);const o=jIe(il,n);o.sort(),r.modelScaleFactors.set(e,0,o[1]),r.modelScaleFactors.set(e,1,o[2]),Ov(s,s),Lu(s,s),r.modelNormal.setMat(e,s),this._setStateFlags(e,xi.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,r){const i=this._view;i.model.getMat(e,Qu),i.modelOrigin.getVec(e,il),r[0]=Qu[0],r[1]=Qu[1],r[2]=Qu[2],r[3]=0,r[4]=Qu[3],r[5]=Qu[4],r[6]=Qu[5],r[7]=0,r[8]=Qu[6],r[9]=Qu[7],r[10]=Qu[8],r[11]=0,r[12]=il[0],r[13]=il[1],r[14]=il[2],r[15]=1}applyShaderTransformation(e,r){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedModelTransform(e,r){return this.getModelTransform(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedLocalTransform(e,r){this._view.localTransform.getMat(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedMaxScaleFactor(e){let r=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(il,this,e),r*=Math.max(il[0],il[1],il[2])),r}getCombinedMedianScaleFactor(e){let r=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(il,this,e),r*=UQe(il[0],il[1],il[2])),r}getModel(e,r){this._view.model.getMat(e,r)}setFeatureAttribute(e,r){this._view.featureAttribute.setVec(e,r)}getFeatureAttribute(e,r){this._view.featureAttribute.getVec(e,r)}setColor(e,r){this._view.color.setVec(e,r)}setObjectAndLayerIdColor(e,r){this._view.objectAndLayerIdColor.setVec(e,r)}setVisible(e,r){r!==this.getVisible(e)&&(this._setStateFlag(e,xi.VISIBLE,r),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,xi.VISIBLE)}setHighlight(e,r){r!==this.getHighlight(e)&&(this._setStateFlag(e,xi.HIGHLIGHT,r),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,xi.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++r;return r}_setStateFlags(e,r){const i=this._view.state;r=i.get(e)|r,i.set(e,r)}_clearStateFlags(e,r){const i=this._view.state;r=i.get(e)&~r,i.set(e,r)}_setStateFlag(e,r,i){i?this._setStateFlags(e,r):this._clearStateFlags(e,r)}_getStateFlag(e,r){return!!(this._view.state.get(e)&r)}_grow(){this._capacity=Math.max(rL,Math.floor(this._capacity*OL)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new jK(this._buffer)}_findSlot(){const e=this._view.state;let r=this._next;for(;e.get(r)&xi.ALLOCATED;)r=r+1===this._capacity?0:r+1;return this._next=r+1===this._capacity?0:r+1,r}};function UQe(t,e,r){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),r))}h([f({constructOnly:!0})],vw.prototype,"shaderTransformation",void 0),h([f()],vw.prototype,"_size",void 0),h([f({readOnly:!0})],vw.prototype,"size",null),vw=h([k("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],vw);const il=E(),Qu=Fi(),HK=ge(),UF=ge();let kQe=class extends Gh{constructor(e,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=r,this._tmpSphere=ds(),this._tmpMat4=ge()}addInstance(e){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);De(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*jx(i),r.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},BQe=class{constructor(e,r){this._worldSpaceRadius=e,this._minScreenSpaceRadii=r}selectLevel(e,r,i){const s=i.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*r/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}},zQe=class extends BD{constructor(e,r,i,s,n,o){super(e,r),this.layerUid=e,this.graphicUid=r,this.geometryId=i,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}};function bH(t){return hd(t)&&t.intersector===Mi.LOD&&!!t.target}let VQe=class{constructor(e,r){const i=e.renderContext.rctx,s=r.geometry;this._materialRepository=e.materialRepository,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=o.createBuffer(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new O_e(s.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=Cr.createVertex(i,yr.STATIC_DRAW,l.buffer),this.vao=new pd(i,hr,{geometry:Ul(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,r,i,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,i,s,(u,d,p,g,y)=>{if(u>=0){if(r!=null&&!r(e.rayBegin,e.rayEnd,u))return;const _=new zQe(o.layerUid,o.graphicUid(n),c,p,a,l);if((e.results.min.drapedLayerOrder==null||y>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||u<e.results.min.dist)&&e.results.min.set(Mi.LOD,_,u,d,e.transform.transform,y),e.options.store!==Xn.MIN&&(e.results.max.drapedLayerOrder==null||y>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||u>e.results.max.dist)&&e.results.max.set(Mi.LOD,_,u,d,e.transform.transform,y),e.options.store===Xn.ALL){const v=sG(e.results.min.ray);v.set(Mi.LOD,_,u,d,e.transform.transform,y),e.results.all.push(v)}}})}},GQe=class H1e{static async create(e,r,i){const s=await Promise.allSettled(r.components.map(o=>e.controller.schedule(()=>new VQe(e,o),i))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(v3);if(Ys(i)||n.length!==s.length){n.forEach(o=>o.destroy()),wt(i);for(const o of s)if(o.status==="rejected")throw o.reason}return new H1e(r.minScreenSpaceRadius,n)}constructor(e,r){this.minScreenSpaceRadius=e,this.components=r}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,r,i,s,n,o,a){this.components.forEach(l=>l.intersect(e,r,i,s,n,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=ui();this.components.forEach(r=>{r.boundingInfo!=null&&(rd(e,r.boundingInfo.bbMin),rd(e,r.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,r=E();Bh(e,r),this._boundingSphere={center:r,radius:.5*Mce(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,r)=>e+r.triangleCount,0)}};const jQe=t=>{const e=t.baseBoundingSphere.radius,r=t.levels.map(i=>i.minScreenSpaceRadius);return new BQe(e,r)};let ru=class extends M9e{constructor(e,r){super(e),this.type=Mi.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new ot,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[oe.OPAQUE_MATERIAL,i=>this._produces(i)],[oe.TRANSPARENT_MATERIAL,i=>!!this._hasTransparentLevels()&&this._produces(i)]]),this._instanceData=new vw({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(r.registerTask(ct.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=qQe(this.optionalFields),this._glInstanceBufferLayout=Ul(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce((e,r)=>r.reduce((i,s)=>i+s.usedMemory,e),0)}get renderStats(){const e=this._instanceData.size,r=[];return this._levels.forEach((i,s)=>{const n=this._allRenderInstanceData[0][s].size+this._allRenderInstanceData[1][s].size,o=i.triangleCount;r.push({renderedInstances:n,renderedTriangles:n*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:r.reduce((i,s)=>i+s.renderedInstances,0),renderedTriangles:r.reduce((i,s)=>i+s.renderedTriangles,0),levels:r}}async initializeRenderContext(e,r){this._context=e;const i=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new GK(i,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new GK(i,this._instanceBufferLayout)),GQe.create(e,o,r)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(v3);if(Ys(r)||n.length!==s.length){n.forEach(o=>o.destroy()),wt(r);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=jQe(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}_hasTransparentLevels(){return this._levels.some(e=>e.components.some(r=>r.material.produces(oe.TRANSPARENT_MATERIAL,L.Color)))}hasHighlights(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}_produces(e){return e!==L.Highlight&&e!==L.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!Zr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const r=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),r||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(fa),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const r=this._getInstanceDatas(e.output);if(!r)return null;const i=new Array;return r.forEach(s=>this.levels.forEach((n,o)=>{n.components.forEach(a=>i.push(this._beginComponent(e,s[o],a)))})),i}renderNode(e,r){const i=this._getInstanceDatas(e.output);if(!i||r==null)return;let s=0;e.rctx.bindVAO(),i.forEach(n=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,r[s++],n[a],l,a))}))}_getInstanceDatas(e){const r=e!==L.Highlight&&e!==L.ShadowHighlight,i=e!==L.ShadowExcludeHighlight;return r&&i?this._allRenderInstanceData:r?this._defaultRenderInstanceData:i?this._highlightRenderInstanceData:null}intersect(e,r,i,s){if(!this.baseMaterial.isVisible()||this._octree==null)return;const n=E();ce(n,s,i);const o=a=>{this._instanceData.getCombinedModelTransform(a,YK),e.transform.set(YK),De(XK,i,e.transform.inverse),De(ZK,s,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),u=this._levels.length;Je((l&xi.ACTIVE)!=0,"invalid instance state"),Je(c>=0&&c<u,"invaid lod level"),this._levels[c].intersect(e,r,XK,ZK,a,this.metadata,u)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(i,n,o)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(this._octreeCached==null){const r=this._instanceData,i=(e=r.view)==null?void 0:e.state;if(!i)return null;this._octreeCached=new kQe(r,this.baseBoundingSphere);for(let s=0;s<r.capacity;++s)i.get(s)&xi.ACTIVE&&this._octreeCached.addInstance(s)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Oe(this._octreeCached)}queryDepthRange(e){if(this._octree==null)return{near:1/0,far:-1/0};const r=e.viewForward,i=this._octree.findClosest(r,Gh.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(r,Gh.DepthOrder.BACK_TO_FRONT,e.frustum);if(i==null||s==null)return{near:1/0,far:-1/0};const n=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(i,$d),ce($d,$d,n);const a=de($d,r)-$d[3];o.boundingSphere.getVec(s,$d),ce($d,$d,n);const l=de($d,r)+$d[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(r=>r.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:r,_camera:i,_levelSelector:s}=this;this._allRenderInstanceData.forEach(d=>d.forEach(p=>p.beginUpdate()));const n=this._instanceData,o=n.view;let a=n.size;const l=n.capacity;let c=this._instanceIndex;const u=Math.ceil(l/500);for(let d=0;d<a&&!e.done;++d){c===this._cycleStartIndex&&this._startUpdateCycle();const p=o.state.get(c);let g=0;if(!(p&xi.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const y=o.lodLevel.get(c);if(p&xi.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][y].freeTail(),p&xi.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][y].freeTail(),p&xi.REMOVE)n.freeInstance(c);else if(p&xi.VISIBLE){let _=0;r&&(o.modelOrigin.getVec(c,WK),_=s.selectLevel(WK,n.getCombinedMedianScaleFactor(c),i)),g=p&~(xi.ACTIVE|xi.TRANSFORM_CHANGED),_>=0&&(p&xi.HIGHLIGHT?(qK(this._highlightRenderInstanceData[0][_],o,c),g|=xi.HIGHLIGHT_ACTIVE):(qK(this._defaultRenderInstanceData[0][_],o,c),g|=xi.DEFAULT_ACTIVE)),o.state.set(c,g),o.lodLevel.set(c,_)}else g=p&~(xi.ACTIVE|xi.TRANSFORM_CHANGED),o.state.set(c,g);if(this._octreeCached!=null){const _=!!(p&xi.ACTIVE),v=!!(g&xi.ACTIVE);!_&&v?this._octreeCached.addInstance(c):_&&!v?this._octreeCached.removeInstance(c):_&&v&&p&xi.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,c%u==0&&e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(d=>d.forEach(p=>p.endUpdate())),this._context.requestRender()}_beginComponent(e,r,i){if(r.size===0)return null;const s=i.glMaterials.load(e.rctx,e.bindParameters.slot,e.output);return s!=null?s.beginSlot(e.bindParameters):null}_renderComponent(e,r,i,s,n){if(!r)return;const{bindParameters:o,rctx:a}=e;a.runAppleAmdDriverHelper();const l=a.bindTechnique(r,s.material.parameters,o);a.bindVAO(s.vao),r.ensureAttributeLocations(s.vao),l.bindDraw(WQe,o,s.material.parameters),Zr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===L.Color&&(l.setUniform4fv("externalColor",JK[Math.min(n,JK.length-1)]),l.setUniform1i("colorMixMode",kge.replace));const c=i.capacity,u=i.headIndex,d=i.tailIndex,p=i.firstIndex,g=this._glInstanceBufferLayout,y=(_,v)=>{vG(a,hr,i.buffer,g,_),a.drawArraysInstanced(r.primitiveType,0,s.vertexCount,v-_),bG(a,hr,i.buffer,g)};s.material.parameters.transparent&&p!=null?u>d?(Je(p>=d&&p<=u,"invalid firstIndex"),y(p,u),y(d,p)):u<d&&(p<=u?(Je(p>=0&&p<=u,"invalid firstIndex"),y(p,u),y(d,c),y(0,p)):(Je(p>=d&&p<=c,"invalid firstIndex"),y(p,c),y(0,u),y(d,p))):u>d?y(d,u):u<d&&(y(0,u),y(d,c)),a.bindVAO(null)}};function qK(t,e,r){const i=t.allocateHead();HQe(e,r,t.view,i)}function HQe(t,e,r,i){zUe(t.modelOrigin,e,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,t.model,e),r.modelNormal.copyFrom(i,t.modelNormal,e),t.color&&r.color&&r.color.copyFrom(i,t.color,e),t.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,t.objectAndLayerIdColor,e),t.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,t.featureAttribute,e)}function qQe(t){let e=Ci().vec3f(R.INSTANCEMODELORIGINHI).vec3f(R.INSTANCEMODELORIGINLO).mat3f(R.INSTANCEMODEL).mat3f(R.INSTANCEMODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(R.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(R.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(R.INSTANCEOBJECTANDLAYERIDCOLOR)),e}h([f({constructOnly:!0})],ru.prototype,"symbol",void 0),h([f({constructOnly:!0})],ru.prototype,"optionalFields",void 0),h([f({constructOnly:!0})],ru.prototype,"metadata",void 0),h([f({constructOnly:!0})],ru.prototype,"shaderTransformation",void 0),h([f()],ru.prototype,"_instanceData",void 0),h([f()],ru.prototype,"_cycleStartIndex",void 0),h([f({readOnly:!0})],ru.prototype,"_enableLevelSelection",null),h([f()],ru.prototype,"_updateCyclesWithStaticCamera",void 0),h([f({readOnly:!0})],ru.prototype,"running",null),ru=h([k("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],ru);const WK=E(),$d=Jt(),YK=ge(),XK=E(),ZK=E(),JK=[Ot(1,0,1,1),Ot(0,0,1,1),Ot(0,1,0,1),Ot(1,1,0,1),Ot(1,0,0,1)],WQe=new yje;let QK=class{constructor(e,r,i,s,n,o,a,l,c,u,d,p){this.lodResources=e,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=u,this.physicalBasedRenderingEnabled=d,this.pivotOffset=p}},YQe=class extends sf{getCachedSize(){const[e,r,i]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:r,height:i}}constructor(e,r,i,s){super(e,r,i,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&TN(this.symbolLayer))throw new Error;if(this._isPrimitive){const r=this.symbolLayer.resource,i=r&&TGe(r.primitive)?r.primitive:Gce;this._resources=await this._createResourcesForPrimitive(i,e)}else{const r=await LQe(this.symbol.styleOrigin),i=(r==null?void 0:r.href)??this.symbolLayer.resource.href;this._resources=await this._createResourcesForUrl(i,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){var e;return!((e=this.symbolLayer.resource)!=null&&e.href)}get lodRenderer(){var e;return(e=this._resources)==null?void 0:e.lodRenderer}get materials(){var e;return((e=this._resources)==null?void 0:e.stageResources.materials)??[]}_setMaterialTransparencyParameters(e,r=(s=>(s=(i=>(i=this.symbolLayer)==null?void 0:i.material)())==null?void 0:s.color)()){const n=this._getCombinedOpacity(r),o=n<1||this.needsDrivenTransparentPass;return e.transparent=o,e.opacity=n,e.cullFace=o?oi.None:oi.Back,e}async _createResourcesForPrimitive(e,r){const i=this.symbolLayer,s=tn(HMe(e)),n=Oo(GA(s)),o=Oo(C4(n,i)),a=_e(o),l=!1,c=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...Pj],ambient:Jf,diffuse:Jf,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},d=!!u.usePBR;this._setMaterialTransparencyParameters(u);const p=this.symbol;if(p.type==="point-3d"&&p.verticalOffset){const{screenLength:x,minWorldLength:T,maxWorldLength:S}=p.verticalOffset;u.verticalOffset={screenLength:Fo(x),minWorldLength:T||0,maxWorldLength:S??1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=vu;else{const x=i.material!=null?i.material.color:null,T=x!=null?qe.toUnitRGBA(x):vu;u.externalColor=T}this._fastUpdates=s2(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,null)),u.isInstanced=!0,this._fastUpdates?(Object.assign(u,this._fastUpdates.materialParameters),this._optionalFields.push(R.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(u.hasInstancedColor=!0,this._optionalFields.push(R.COLOR)),te("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(R.OBJECTANDLAYERIDCOLOR);const g=new od(u),y=O0e(e,g);if(!y)throw new Error(`Unknown object symbol primitive: ${e}`);const _=oO(y).map(x=>({opacity:1,transparent:x.parameters.transparent})),v=await this._createStageResources(y,d,r),w=await this._createLodRenderer(y,r);return new QK(y,w,v,_,n,l,c,s,o,a,d,null)}async _createResourcesForUrl(e,r){var N,z;const i={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=s2(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(i.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(R.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(i.materialParameters.hasInstancedColor=!0,this._optionalFields.push(R.COLOR)),te("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(R.OBJECTANDLAYERIDCOLOR);const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:U,minWorldLength:Y,maxWorldLength:H}=s.verticalOffset;i.materialParameters.verticalOffset={screenLength:Fo(U),minWorldLength:Y||0,maxWorldLength:H??1/0},i.materialParameters.castShadows=!1}const n=this._context.physicalBasedRenderingEnabled;i.signal=r,i.usePBR=n,i.skipHighLods=this._context.skipHighSymbolLods;const o=await F1e(e,i),a=o.isEsriSymbolResource,l=o.isWosr,c=_Je(o.lods),u=this._context,d=this.symbolLayer.material,p=this._getExternalColorParameters(d),g=(z=(N=this.symbolLayer)==null?void 0:N.material)==null?void 0:z.color,y=this._getCombinedOpacity(g,{hasIntrinsicColor:!0}),_=this.needsDrivenTransparentPass,v=oO(c),w=oO(c).map(U=>({opacity:U.parameters.opacity||1,transparent:U.parameters.transparent}));v.forEach(U=>{const Y=U.parameters;U.setParameters(p);const H=Y.opacity*y,V=H<1||_||Y.transparent;U.setParameters({opacity:H,transparent:V}),u.screenSizePerspectiveEnabled&&U.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})});const x=o.referenceBoundingBox,T=Oo(GA(x)),S=Oo(c.levels[0].pivotOffset),C=Oo(C4(T,this.symbolLayer)),A=_e(C),O=this._fastUpdates;n2(O,this._context.renderer,this._fastVisualVariableConvertOptions(x,C,T,S))&&v.forEach(U=>U.setParameters(O.materialParameters));const $=await this._createStageResources(c,n,r),D=await this._createLodRenderer(c,r);return new QK(c,D,$,w,T,a,l,x,C,A,n,S)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,r,i){const s=this._context.stage,n=oO(e);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=KJ(e);s.addMany(o),this._addDisposeResource(()=>{o.forEach(l=>l.unload()),s.removeMany(o)}),await Promise.all(o.map(l=>this._context.stage.schedule(()=>l.load(s.renderView.renderingContext),i))),wt(i);const a=eQ(e);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(e,r){const i=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},n=this._fastUpdates,o=n?{applyTransform:(l,c,u)=>{l.getFeatureAttribute(c,OO),Ss(u,N7e(n.materialParameters,OO,u))},scaleFactor:(l,c,u)=>{c.getFeatureAttribute(u,OO),dj(l,n.materialParameters,OO)}}:null,a=new ru({symbol:e,optionalFields:this._optionalFields,metadata:s,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(a),a.destroy()}),await i.addRenderPlugin(a,r),a}_getExternalColorParameters(e){const r={};return this._drivenProperties.color?r.externalColor=vu:(e==null?void 0:e.color)!=null?r.externalColor=qe.toUnitRGBA(e.color):(r.externalColor=vu,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;const i=i3(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const s=this.setGraphicElevationContext(r),n=e.renderingInfo;return this._createAs3DShape(r,i,n,s,r.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){var n,o;if(this._resources==null)return;const e=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let a=0;a<i.length;a++){const l=i[a],c=(o=(n=this.symbolLayer)==null?void 0:n.material)==null?void 0:o.color,u=s[a],d=this._getCombinedOpacity(c,{hasIntrinsicColor:r})*u.opacity,p=d<1||e||u.transparent;l.setParameters({opacity:d,transparent:p}),this._isPrimitive&&l.setParameters({cullFace:p?oi.None:oi.Back})}}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,sy)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:r}=this._resources;for(const i of e.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,r){if(this._resources==null)return Ts.RecreateSymbol;const{stageResources:{materials:i},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!n2(this._fastUpdates,r,this._fastVisualVariableConvertOptions(n,o,a,l)))return Ts.RecreateSymbol;for(const u of i)u.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return Ts.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,r=oye(e.levels),i=a=>Array.from(a.attributes.values()).reduce((l,c)=>l+F0(c.data,c.indices),0),s=eQ(e).reduce((a,l)=>a+i(l),0),n=KJ(e).reduce((a,l)=>a+l.memoryEstimate,0)+s,o={...nye(this.symbol,this.symbolLayer),resourceBytes:n};return new uu({verticesPerFeature:r,memory:o})}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,r,i,s,n,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(Ll(r,Ab,this._context.elevationProvider.spatialReference),l!=null&&!lV(l,Ab))return null;const c=this._requiresTerrainElevation(s),u=this._computeGlobalTransform(r,s,kF,PO),d=this._computeLocalTransform(this._resources,this.symbolLayer,i,KK),p=this._resources.lodRenderer.instanceData,g=p.addInstance();this._instanceIndexToGraphicUid.set(g,n),p.setLocalTransform(g,d,!1),p.setGlobalTransform(g,u),a&&p.setFeatureAttribute(g,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&p.setColor(g,YE(i.color,i.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&p.setObjectAndLayerIdColor(g,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const y=new mJe(this,g,uGe,s);return c&&(y.alignedSampledElevation=PO.sampledElevation),y.needsElevationUpdates=sy(s.mode),r3(y,r,this._context.elevationProvider),y}_computeGlobalTransform(e,r,i,s){return iy(e,this._context.elevationProvider,r,this._context.renderCoordsHelper,s),Ab[0]=e.x,Ab[1]=e.y,Ab[2]=s.z,Ol(e.spatialReference,Ab,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,r,i,s){return Pu(s),this._applyObjectRotation(i,!1,s),this._applyObjectRotation(r,!0,s),this._applyObjectScale(e,i,s),this._applyAnchor(e,r,s),s}_applyObjectScale(e,r,i){var o;if((o=this._fastUpdates)!=null&&o.requiresShaderTransformation)return;const s=this._drivenProperties.size&&r.size?r.size:e.symbolSize,n=JJ(s,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||O3(i,i,n)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchTransform(e,r),this._preparePatchColor(e,r)}updateGeometry(e,r){if(this._resources==null)return!0;const i=r&&i3(r);if(i==null)return!1;const s=this.getGeometryElevationMode(r);return e.elevationContext.mode===s&&(this._computeGlobalTransform(i,e.elevationContext,kF,PO),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=PO.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,kF,!0),r3(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||this._resources==null)return;const i=(y,_,v)=>(y!=null&&y.type==="complete"?y.newValue:_)??v,s=i(r.heading,this.symbolLayer.heading,0),n=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),u=i(r.anchor,this.symbolLayer.anchor,void 0),d=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const p={heading:s,tilt:n,roll:o,anchor:u,anchorPosition:d},g=this._resources;this.loadStatus===lc.LOADED&&e.symbolLayerStatePatches.push(()=>{g.symbolSize=Oo(C4(g.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((y,_)=>{const v=this._computeLocalTransform(g,p,_,KK),w=y.instanceIndex;g.lodRenderer.instanceData.setLocalTransform(w,v,!0)})}_preparePatchColor(e,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const s=i.color.newValue,n=s!=null?qe.toUnitRGBA(s):vu;delete i.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParameters({},s)):l=this._setMaterialTransparencyParameters({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,r,i){var s;if(!((s=this._fastUpdates)!=null&&s.requiresShaderTransformation)||!r)return KVe(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,r,i){const s=E();switch(i.anchor){case"center":ie(s,Bh(e)),ko(s,s);break;case"top":{const n=Bh(e);se(s,-n[0],-n[1],-e[5]);break}case"bottom":{const n=Bh(e);se(s,-n[0],-n[1],-e[2]);break}case"relative":{const n=Bh(e),o=GA(e),a=i.anchorPosition,l=a?Te(a.x,a.y,a.z):Mn;ZL(s,o,l),le(s,s,n),ko(s,s);break}default:r!=null?ko(s,r):ie(s,Mn)}return s}_applyAnchor(e,r,i){var n;if((n=this._fastUpdates)!=null&&n.requiresShaderTransformation)return;const s=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,r);s&&Ya(i,i,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,r,i,s){const n=e!=null?Oo(GA(e)):Jf,o=e!=null?this._computeAnchor(e,s,this.symbolLayer):Mn,a=this._context.renderCoordsHelper.unitInMeters,l=JJ(r??void 0,r,i,a),c=Te(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new eA({size:!0,color:!0,rotation:!0,opacity:!1},n,r??Jf,a,o,l,c)}};const Ab=E(),KK=ge(),kF=ge(),OO=Jt(),PO=new nA;let XQe=class{constructor(e,r,i,s){this.vertices=e,this.positionsES=r,this.offset=s;const n=e.length,o=Math.floor(n/2),a=this.offset+3*o,l=i[a],c=i[a+1],u=i[a+2];this.origin=Te(l,c,u),this.positions=Gi(3*n);const d=this.offset+3*n;for(let p=this.offset;p<d;p+=3)this.positions[p]=i[p]-l,this.positions[p+1]=i[p+1]-c,this.positions[p+2]=i[p+2]-u;this.updatePathVertexInformation()}get usedMemory(){return F0(this.positions)}updatePathVertexInformation(){const e=this.vertices.length,r=this.vertices[0];let i=this.offset;const s=this.positions;r.vRight[0]=s[i+3]-s[i],r.vRight[1]=s[i+4]-s[i+1],r.vRight[2]=s[i+5]-s[i+2],i+=3;let n=_e(r.vRight);r.vMinSiblingLength=n,pe(r.vRight,r.vRight);let o=r;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=s[i+3]-s[i],l.vRight[1]=s[i+4]-s[i+1],l.vRight[2]=s[i+5]-s[i+2];const c=_e(l.vRight);l.vMinSiblingLength=Math.min(n,c),n=c,pe(l.vRight,l.vRight)}else ie(l.vRight,l.vLeft),l.vMinSiblingLength=n;o=l,i+=3}}},ZQe=class{constructor(e,r,i,s,n,o={}){this.path=e,this.profile=r,this.extruder=i,this.startCap=s,this.endCap=n,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=LUe(1*this.numVerticesTotal),this.profileRightAxes=Gi(4*this.numVerticesTotal),this.profileUpAxes=Gi(4*this.numVerticesTotal),this.profileVertexAndNormals=Gi(4*this.numVerticesTotal),this.positions=bI(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}get usedMemory(){return F0(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(e,r,i,s,n){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=r.right[0],this.profileRightAxes[o+1]=r.right[1],this.profileRightAxes[o+2]=r.right[2],this.profileUpAxes[o]=r.up[0],this.profileUpAxes[o+1]=r.up[1],this.profileUpAxes[o+2]=r.up[2],this.profileVertexAndNormals[o]=i[0],this.profileVertexAndNormals[o+1]=i[1],this.profileVertexAndNormals[o+2]=s[0],this.profileVertexAndNormals[o+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,r,i,s,n,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=r.right[0],this.profileRightAxes[a+1]=r.right[1],this.profileRightAxes[a+2]=r.right[2],this.profileRightAxes[a+3]=n,this.profileUpAxes[a]=r.up[0],this.profileUpAxes[a+1]=r.up[1],this.profileUpAxes[a+2]=r.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=i[0],this.profileVertexAndNormals[a+1]=i[1],this.profileVertexAndNormals[a+2]=s[0],this.profileVertexAndNormals[a+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:r,vertices:i}=this.path;this.positions=bI(e,r,3*i.length);let s=0;const n=(a,l,c,u,d)=>this.emitCapVertex(s,a,l,c,u,d),o=(a,l,c,u)=>this.emitVertex(s,a,l,c,u);for(this.startCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=1;s<i.length-1;++s)this.extruder.extrude(i[s],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=0,this.startCap.rebuildCapGeometry(i[s],n),s=i.length-1,this.endCap.rebuildCapGeometry(i[s],n)}buildTopology(){const e=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let s=3*(2*(r*i));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.numIndices,this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,u,d)=>{n.push(c),n.push(u),n.push(d),o.push(c),o.push(u),o.push(d),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[u]),a.push(this.pathVertexData[d])};for(let c=0;c<r;++c){const u=this.profile.indices[2*c],d=this.profile.indices[2*c+1];for(let p=0;p<i;++p){const g=p*e+u,y=(p+1)*e+d,_=p*e+d;l(g,(p+1)*e+u,y),l(g,y,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=Pp(n),this.normalIndices=Pp(o),this.pathVertexIndices=Pp(a)}onPathChanged(){this._rebuildGeometry()}},wH=class{rebuildConnectingProfileGeometry(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],0,0)}},eee=class extends wH{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},MO=class extends wH{constructor(e,r=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=r,this.flip=i}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,r,i){const s=this.profilePlaneOffset;for(let n=0;n<r.vertices.length;++n)i(e.frame,r.vertices[n],r.normals[n],s,0)}rebuildCapGeometry(e,r){const i=this.profile,s=this.flip?1:-1,n=this.profilePlaneOffset,o=q1e;ir(o,0,0);for(let a=0;a<i.vertices.length;++a)r(e.frame,i.vertices[a],o,n,s)}buildTopology(e,r){const i=this.profile,s=this.vertexBufferStart+i.indices[0];for(let n=1;n<i.numSegments;++n){const o=i.indices[2*n],a=i.indices[2*n+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?r(c,l,s):r(s,l,c)}}},tee=class extends wH{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const r=this.profile;e+=2*r.numSegments*(this.numSegments-1);for(let i=0;i<r.numSegments;++i){const s=r.indices[2*i],n=r.indices[2*i+1];r.poleIndices[s]===r.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,r){const i=this.profile,s=e.frame,n=.5*this.sign,o=JQe,a=q1e;ir(a,0,0);for(const l of i.poles)l.normal?r(s,l.position,l.normal,n,0):r(s,l.position,a,n,this.sign);if(this.breakNormals)for(let l=0;l<i.vertices.length;++l)r(s,i.vertices[l],i.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,u=Math.sin(c),d=Math.cos(c);for(let p=0;p<i.vertices.length;++p){const g=i.poles[i.poleIndices[p]];pp(o,i.vertices[p],g.position),xl(o,o,u),g.normal?(Ch(o,o,g.position),r(s,o,g.normal,n*d,0)):(HC(a,o),xl(a,a,u),Ch(o,o,g.position),r(s,o,a,n*d,this.sign*d))}}}buildTopology(e,r){const i=this.profile,s=this.breakNormals?this.vertexBufferStart+i.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+i.poles.length+i.vertices.length:this.vertexBufferStart+i.poles.length;for(let o=0;o<i.numSegments;++o){const a=i.indices[2*o],l=i.indices[2*o+1],c=this.vertexBufferStart+i.poleIndices[a],u=this.vertexBufferStart+i.poleIndices[l];let d=s+a,p=s+l;for(let g=0;g<this.numSegments-1;++g){const y=n+g*i.vertices.length+a,_=n+g*i.vertices.length+l;this.flip?(r(y,p,d),r(p,y,_)):(r(d,p,y),r(_,y,p)),d=y,p=_}this.flip?(r(c,p,d),c!==u&&r(c,u,p)):(r(d,p,c),c!==u&&r(p,u,c))}}};const JQe=ke(),q1e=ke();let QQe=class{numProfilesPerJoin(){return 1}extrude(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],!1)}},BF=class{constructor(e,r){this.cutoffAngle=e,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,r,i){const s=eKe,{rotationAngle:n,rotationRight:o,frame:a}=e;if(Math.abs(n)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){Mc(iee,.5*-n+c*n/this.numBendSubdivisions,l),KQe(s,a,iee);for(let u=0;u<r.vertices.length;++u)Vs(r.vertices[u],o)*n>=0?i(s,r.vertices[u],r.normals[u],!1):i(a,e.applyMiterStretch(ree,r.vertices[u]),r.normals[u],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<r.vertices.length;++c){const u=Vs(r.vertices[c],o)*n>=0;i(a,e.applyMiterStretch(ree,r.vertices[c]),r.normals[c],!u)}}},W1e=class{constructor(){this.up=E(),this.right=E()}};function KQe(t,e,r){De(t.up,e.up,r),De(t.right,e.right,r)}const ree=ke(),iee=ge(),eKe=new W1e;let tKe=class extends Ds{constructor(e,r,i,s,n,o){super(e,r,null,Ki.Mesh,o),this.path=i,this.geometrySR=s,this.stencilWidth=n}};var Mp;function Y1e(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(Mp||(Mp={}));let X1e=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},Z1e=class extends X1e{constructor(e){super(e),this.vertexAttributeColor=Ot(255,255,255,255),this.size=new Array,this.vertexAttributePosition=Gi(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:r,pathVertexData:i,path:s,positions:n,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<r;++c){let u=i[c];const d=u===0||u===s.vertices.length-1;u*=3;const p=oKe;let g=0,y=0;const _=4*c,v=se(aKe,o[_],o[_+1],o[_+2]),w=se(lKe,a[_],a[_+1],a[_+2]),x=ir(see,l[_]*e[0],l[_+1]*e[1]);if(d)rt(p,w,v),g=o[_+3]*e[0],y=a[_+3];else{const A=iKe,O=sKe;ir(A,o[_+3],a[_+3]);const $=mG(A);HC(A,A);const D=Vs(x,A);if(Math.abs(D)>$){ir(O,-A[1],A[0]);const N=Vs(x,O);xl(A,A,$*Math.sign(D)),xl(O,O,N),Ch(x,A,O)}se(p,0,0,0)}const T=se(nKe,v[0]*x[0]+w[0]*x[1],v[1]*x[0]+w[1]*x[1],v[2]*x[0]+w[2]*x[1]),S=3*c;this.vertexAttributePosition[S]=n[u]+T[0]+p[0]*g,this.vertexAttributePosition[S+1]=n[u+1]+T[1]+p[1]*g,this.vertexAttributePosition[S+2]=n[u+2]+T[2]+p[2]*g;const C=ir(see,l[_+2],l[_+3]);mv(this.vertexAttributeNormal,c,v[0]*C[0]+w[0]*C[1]+p[0]*y,v[1]*C[0]+w[1]*C[1]+p[1]*y,v[2]*C[0]+w[2]*C[1]+p[2]*y)}}createGeometryData(){const e=this.builder.vertexIndices.length,{normalIndices:r,vertexIndices:i}=this.builder;return[[R.POSITION,new Ue(this.vertexAttributePosition,i,3,!0)],[R.NORMALCOMPRESSED,new Ue(this.vertexAttributeNormal,r,2,!0)],[R.COLOR,new Ue(this.vertexAttributeColor,gy(e),4)]]}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,r,i){const s=this.builder.vertexIndices,n=new j3(this.vertexAttributePosition,3),o=s.length/3;tA(e,r,0,o,s,n,void 0,void 0,i)}},rKe=class extends X1e{constructor(e,r,i,s){super(e),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=s,this.vvData=null,this.baked=new Z1e(e),this.vvData=Gi(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n]=r,this.vvData[4*n+1]=i,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){const{positions:e,profileRightAxes:r,profileUpAxes:i,profileVertexAndNormals:s,pathVertexIndices:n,vertexIndices:o}=this.builder;return[[R.POSITION,new Ue(e,n,3,!0)],[R.PROFILERIGHT,new Ue(r,o,4,!0)],[R.PROFILEUP,new Ue(i,o,4,!0)],[R.PROFILEVERTEXANDNORMAL,new Ue(s,o,4,!0)],[R.FEATUREVALUE,new Ue(this.vvData,n,4,!0)]]}onPathChanged(e){super.onPathChanged(e);const r=e.getMutableAttribute(R.POSITION);r&&(r.data=this.builder.positions)}};const see=ke(),iKe=ke(),sKe=ke(),nKe=E(),oKe=E(),aKe=E(),lKe=E();function cKe(t,e){let r=null;const i=t.vertices.length,s=.99619469809,n=E(),o=E(),a=E(),l=E(),c=E(),u=E(),d=wr();let p=t.vertices[0];ie(o,e),se(n,0,1,0),TI(p.vRight,o,n,n,a,o,s),ie(p.frame.up,o),ie(p.frame.right,a);const g=t.positions;let y=t.offset;r=p;for(let _=1;_<i;++_){p=t.vertices[_],le(c,p.vLeft,p.vRight);let v=_e(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=p.vRight[0],c[1]=p.vRight[1],c[2]=p.vRight[2]),u[0]=g[y]+r.frame.up[0],u[1]=g[y+1]+r.frame.up[1],u[2]=g[y+2]+r.frame.up[2],y+=3;const w=se(uKe,g[y],g[y+1],g[y+2]);G3(w,c,d),Cv(d,$c(u,p.vLeft),l)?(l[0]-=g[y],l[1]-=g[y+1],l[2]-=g[y+2],pe(o,l),rt(a,c,o),pe(a,a)):TI(c,r.frame.up,r.frame.right,n,a,o,s),ie(p.frame.up,o),ie(p.frame.right,a),r=p}}const uKe=E();let J1e=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,r){return this.vertices.push(SS(e)),this.normals.push(SS(r)),this.vertices.length-1}addPole(e,r=null){return this.poles.push({position:SS(e),normal:r?SS(r):null}),this.poles.length-1}addSegment(e,r=null){this.indices.push(e.v0),this.indices.push(e.v1),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.indices.length/2}translate(e,r){for(const i of this.vertices)i[0]+=e,i[1]+=r;for(const i of this.poles)i.position[0]+=e,i.position[1]+=r}get usedMemory(){return this.vertices.length*F0(this.vertices[0])*2+F0(this.indices)}};const Q1e={top:[0,-.5],bottom:[0,.5]};function zF(t){const r=E0e,i=new J1e,s={v0:0,v1:0};i.addPole(tr(0,0));for(let o=0;o<r;++o){const a=2*o*Math.PI/r,l=Math.cos(a),c=Math.sin(a),u=tr(l*.5,c*.5),d=tr(l,c);i.addVertex(u,d)}for(let o=0;o<r-1;++o){const a={v0:o,v1:o+1};i.addSegment(a,s)}const n={v0:r-1,v1:0};if(i.addSegment(n,s),t!=="center"){const o=Q1e[t];i.translate(o[0],o[1])}return i}const hKe={center:zF("center"),top:zF("top"),bottom:zF("bottom")},dKe={center:VF("center"),top:VF("top"),bottom:VF("bottom")};function VF(t){const i=new J1e,s=tr(.5*-1,.5*-1),n=tr(.5*1,.5*-1),o=tr(.5*1,.5*1),a=tr(.5*-1,.5*1),l=tr(0,-1),c=tr(1,0),u=tr(0,1),d=tr(-1,0);if(i.addPole(tr(0,.5*1),u),i.addPole(tr(0,.5*1)),i.addPole(tr(0,.5*-1)),i.addPole(tr(0,.5*-1),l),i.addVertex(s,l),i.addVertex(n,l),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(n,c),i.addVertex(o,c),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(o,u),i.addVertex(a,u),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(a,d),i.addVertex(s,d),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const p=Q1e[t];i.translate(p[0],p[1])}return i}function pKe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function fKe(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function K1e(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function mKe(t,e){if(t===e){const r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function gKe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*n-s*i;return o?(o=1/o,t[0]=n*o,t[1]=-i*o,t[2]=-s*o,t[3]=r*o,t):null}function yKe(t,e){const r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function _Ke(t){return t[0]*t[3]-t[2]*t[1]}function eve(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*a+n*l,t[1]=s*a+o*l,t[2]=i*c+n*u,t[3]=s*c+o*u,t}function vKe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+n*a,t[1]=s*l+o*a,t[2]=i*-a+n*l,t[3]=s*-a+o*l,t}function bKe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1];return t[0]=i*a,t[1]=s*a,t[2]=n*l,t[3]=o*l,t}function wKe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t}function xKe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function TKe(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function SKe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function EKe(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]}function CKe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function tve(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function AKe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function RKe(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=Qn();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}function OKe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function PKe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}const MKe=eve,$Ke=tve;Object.freeze(Object.defineProperty({__proto__:null,LDU:EKe,add:CKe,adjoint:yKe,copy:pKe,determinant:_Ke,equals:RKe,exactEquals:AKe,frob:SKe,fromRotation:wKe,fromScaling:xKe,identity:fKe,invert:gKe,mul:MKe,multiply:eve,multiplyScalar:OKe,multiplyScalarAndAdd:PKe,rotate:vKe,scale:bKe,set:K1e,str:TKe,sub:$Ke,subtract:tve,transpose:mKe},Symbol.toStringTag,{value:"Module"}));function rve(){return[1,0,0,1]}function IKe(t){return[t[0],t[1],t[2],t[3]]}function LKe(t,e,r,i){return[t,e,r,i]}function DKe(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:IKe,create:rve,createView:DKe,fromValues:LKe},Symbol.toStringTag,{value:"Module"}));let ive=class{constructor(){this.vLeft=E(),this.vRight=E(),this.vMinSiblingLength=0,this.frame=new W1e}setFrameFromUpVector(e){ie(this.frame.up,e),le(NT,this.vLeft,this.vRight),pe(NT,NT),ee(aee,this.frame.up,de(NT,this.frame.up)),ce($O,NT,aee),pe($O,$O),rt(this.frame.right,$O,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},NKe=class extends ive{get rotationFrameUp(){return this.frame.up}get rotationRight(){return que}get rotationAngle(){return ee(yg,this.frame.up,de(this.frame.up,this.vLeft)),ce(yg,this.vLeft,yg),ko(yg,yg),pe(yg,yg),ee(Ob,this.frame.up,de(this.frame.up,this.vRight)),ce(Ob,this.vRight,Ob),pe(Ob,Ob),rt(iL,this.rotationFrameUp,this.vLeft),Math.sign(de(iL,this.vRight))*(Math.PI-un(de(yg,Ob)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)<=0)return r;const s=L8(Math.cos(.5*i));return ir(e,(s-1+1)*r[0],r[1])}},FKe=class extends ive{get rotationFrameUp(){const e=Math.sign(de(this.frame.right,this.vRight));return rt(DT,this.vRight,this.vLeft),ee(DT,DT,e),pe(DT,DT)}get rotationRight(){const e=this.rotationFrameUp,r=de(e,this.frame.up),i=de(e,this.frame.right);return ee(Rb,this.frame.up,-i),ee(oee,this.frame.right,r),le(Rb,Rb,oee),pe(Rb,Rb),UKe(nee,this.frame,Rb),nee}get rotationAngle(){const e=Math.sign(de(this.frame.right,this.vRight));return ko(iL,this.vLeft),-e*(Math.PI-un(de(iL,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*L8(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)===0)return r;const s=L8(Math.cos(.5*i)),n=this.rotationRight,o=K1e(BKe,1+(s-1)*n[0]*n[0],(s-1)*n[0]*n[1],(s-1)*n[0]*n[1],1+(s-1)*n[1]*n[1]);return $pe(e,r,o)}};function UKe(t,e,r){ir(t,de(r,e.right),de(r,e.up))}function kKe(t){switch(t){case Mp.World:return new NKe;case Mp.Path:return new FKe}}const DT=E(),nee=ke(),Rb=E(),oee=E(),iL=E(),yg=E(),Ob=E(),aee=E(),NT=E(),$O=E(),BKe=rve(),GF=8;function zKe(t,e){const r=R.FEATUREVALUE;t.attributes.add(r,"vec4");const i=t.vertex;i.code.add(b`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new Ir("size",s=>s.size)),e.vvSize?(i.uniforms.add(new Pt("vvSizeMinSize",s=>s.vvSize.minSize),new Pt("vvSizeMaxSize",s=>s.vvSize.maxSize),new Pt("vvSizeOffset",s=>s.vvSize.offset),new Pt("vvSizeFactor",s=>s.vvSize.factor)),i.code.add(b`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(b`vec2 getSize(){
return size;
}`),e.vvOpacity?(i.constants.add("vvOpacityNumber","int",GF),i.uniforms.add(new Va("vvOpacityValues",s=>s.vvOpacity.values,GF),new Va("vvOpacityOpacities",s=>s.vvOpacity.opacityValues,GF)),i.code.add(b`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(b`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(i.constants.add("vvColorNumber","int",mx),i.uniforms.add(new Va("vvColorValues",s=>s.vvColor.values,mx),new Kge("vvColorColors",s=>s.vvColor.colors,mx)),i.code.add(b`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(b`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(Y3),t.attributes.add(R.PROFILERIGHT,"vec4"),t.attributes.add(R.PROFILEUP,"vec4"),t.attributes.add(R.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(b`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(b`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(b`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(b`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let VKe=class extends iA{constructor(){super(...arguments),this.size=tr(1,1)}};function GKe(t){const e=new dr,{vertex:r,fragment:i}=e;switch(Rl(r,t),e.varyings.add("vpos","vec3"),e.include(zKe,t),t.output!==L.Color&&t.output!==L.Alpha||(e.include(qa,t),e.include(dv,t),e.include(F2,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.multipassEnabled&&e.varyings.add("depth","float"),r.code.add(b`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===L.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(Nl,t),t.output){case L.Alpha:e.include(us,t),i.uniforms.add(new Ee("opacity",s=>s.opacity)),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case L.Color:e.include(us,t),e.include(hv,t),e.include(lA,t),e.include(dv,t),e.include($0e,t),sd(i,t),cA(i),V2(i),i.uniforms.add(r.uniforms.get("localOrigin"),new Pt("ambient",s=>s.ambient),new Pt("diffuse",s=>s.diffuse),new Pt("specular",s=>s.specular),new Ee("opacity",s=>s.opacity)),i.include(tf),Jp(i),i.code.add(b`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===Qe.Color?"fragColor = premultiplyAlpha(fragColor);":""}
        }
      `);break;case L.Depth:case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:e.include(qa,t),lv(e),e.varyings.add("depth","float"),r.code.add(b`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(us,t),e.include(Em,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case L.Normal:e.include(qa,t),e.include(a3,t),e2(r),e.varyings.add("vnormal","vec3"),r.code.add(b`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(us,t),i.code.add(b`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case L.Highlight:e.include(qa,t),e.include(a3,t),e.varyings.add("vnormal","vec3"),r.code.add(b`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(us,t),e.include(_y,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const jKe=Object.freeze(Object.defineProperty({__proto__:null,build:GKe},Symbol.toStringTag,{value:"Module"})),sve=new Map([[R.POSITION,0],[R.PROFILERIGHT,1],[R.PROFILEUP,2],[R.PROFILEVERTEXANDNORMAL,3],[R.FEATUREVALUE,4]]);let HKe=class extends VKe{constructor(){super(...arguments),this.ambient=Te(.2,.2,.2),this.diffuse=Te(.8,.8,.8),this.specular=Te(0,0,0),this.opacity=1,this.origin=E(),this.modelTransformation=null}},nve=class ove extends Sr{initializeConfiguration(e,r){r.spherical=e.viewingMode===$e.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new vr(e.rctx,ove.shader.get().build(this.configuration),sve)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===Qe.NONE,s=e===Qe.FrontFace;return Et({blending:r.output!==L.Color&&r.output!==L.Alpha||!r.transparent?null:i?Ac:Bm(e),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==ji.None?zpe:null,depthTest:{func:vy(e)},depthWrite:i||s?Xa:null,colorWrite:Ut,stencilWrite:r.hasOccludees?Gp:null,stencilTest:r.hasOccludees?by:null,polygonOffset:i||s?null:wN})}};nve.shader=new _r(jKe,()=>he(()=>import("./Path.glsl-4aa274b9.js"),[],import.meta.url));let Bs=class extends ga{constructor(){super(...arguments),this.output=L.Color,this.doubleSidedMode=ji.None,this.transparencyPassType=Qe.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};h([F({count:L.COUNT})],Bs.prototype,"output",void 0),h([F({count:ji.COUNT})],Bs.prototype,"doubleSidedMode",void 0),h([F({count:Qe.COUNT})],Bs.prototype,"transparencyPassType",void 0),h([F()],Bs.prototype,"spherical",void 0),h([F()],Bs.prototype,"receiveShadows",void 0),h([F()],Bs.prototype,"receiveAmbientOcclusion",void 0),h([F()],Bs.prototype,"vvSize",void 0),h([F()],Bs.prototype,"vvColor",void 0),h([F()],Bs.prototype,"vvOpacity",void 0),h([F()],Bs.prototype,"hasSlicePlane",void 0),h([F()],Bs.prototype,"transparent",void 0),h([F()],Bs.prototype,"hasOccludees",void 0),h([F()],Bs.prototype,"multipassEnabled",void 0),h([F()],Bs.prototype,"cullAboveGround",void 0),h([F()],Bs.prototype,"doublePrecisionRequiresObfuscation",void 0),h([F({constValue:!1})],Bs.prototype,"occlusionPass",void 0),h([F({constValue:et.Disabled})],Bs.prototype,"pbrMode",void 0),h([F({constValue:!0})],Bs.prototype,"hasVvInstancing",void 0),h([F({constValue:!1})],Bs.prototype,"useCustomDTRExponentForWater",void 0),h([F({constValue:!1})],Bs.prototype,"useFillLights",void 0),h([F({constValue:!1})],Bs.prototype,"hasColorTexture",void 0);let qKe=class ave extends yy{constructor(e){super(e,new YKe),this.supportsEdges=!0,this._vertexAttributeLocations=sve,this._configuration=new Bs,this._vertexBufferLayout=ave.getVertexBufferLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==L.Color&&e!==L.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?ji.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?ji.WindingOrder:ji.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=r.ssao!=null),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==L.Shadow&&e!==L.ShadowExcludeHighlight&&e!==L.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,r,i,s,n,o){const a=e;if(!Y1e(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:v,factor:w,minSize:x,maxSize:T}=this.parameters.vvSize,S=l.sizeAttributeValue;c[0]*=me(v[0]+S*w[0],x[0],T[0]),c[1]*=me(v[2]+S*w[2],x[2],T[2])}const u=Math.max(c[0],c[1]),d=e.boundingInfo;if(d==null)return void this._intersectTriangles(l,c,s,n,o);const p=K1(d.bbMin[0]-u,d.bbMin[1]-u,d.bbMin[2]-u,d.bbMax[0]+u,d.bbMax[1]+u,d.bbMax[2]+u),g=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],y=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]),_=[y/g[0],y/g[1],y/g[2]];mj(p,s,_,i.tolerance)&&this._intersectTriangles(l,c,s,n,o)}_intersectTriangles(e,r,i,s,n){e.baked.size&&e.baked.size[0]===r[0]&&e.baked.size[1]===r[1]||e.baked.bake(r),e.baked.intersect(i,s,n)}createBufferWriter(){return new z2(this._vertexBufferLayout)}produces(e,r){switch(r){case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case L.Color:case L.Alpha:case L.Depth:case L.Normal:case L.Highlight:case L.ObjectAndLayerIdColor:return e===(this.parameters.transparent?oe.TRANSPARENT_MATERIAL:oe.OPAQUE_MATERIAL)||e===oe.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new WKe(e)}static getVertexBufferLayout(){return Ci().vec3f(R.POSITION).vec4f(R.PROFILERIGHT).vec4f(R.PROFILEUP).vec4f(R.PROFILEVERTEXANDNORMAL).vec4f(R.FEATUREVALUE)}},WKe=class extends my{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==L.Color&&this._output!==L.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(nve,e)}},YKe=class extends HKe{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const XKe=["polyline"];let ZKe=class extends sf{constructor(e,r,i,s){super(e,r,i,s),this._intrinsicSize=tr(1,1),this._upVectorAlignment=Mp.Path,this._stencilWidth=.1,this.usedMemory=0,this.ensureDrapedStatus(!1)}async doLoad(){var p,g,y,_,v;const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,r=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new eA({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,r],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=((g=(p=this._context.renderer)==null?void 0:p.visualVariables)==null?void 0:g.length)>0?s2(this._context.renderer,this._vvConvertOptions):null;const i=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?Mp.World:Mp.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=hKe[i];break;case"quad":this._profile=dKe[i]}switch(this.symbolLayer.join){case"round":this._extruder=new BF(0,S0e);break;case"bevel":this._extruder=new BF(0,1);break;case"miter":this._extruder=new BF(.8*Math.PI,1);break;default:this._extruder=new QQe}const n=this.symbolLayer.cap||"butt";switch(n){case"none":this._startCap=new eee,this._endCap=new eee;break;case"butt":default:this._startCap=new MO(this._profile,0),this._endCap=new MO(this._profile,0,!0);break;case"square":this._startCap=new MO(this._profile,-.5),this._endCap=new MO(this._profile,.5,!0);break;case"round":{const w=s==="quad";this._startCap=new tee({profile:this._profile,flip:!1,breakNormals:w,subdivisions:AB}),this._endCap=new tee({profile:this._profile,flip:!0,breakNormals:w,subdivisions:AB});break}}const o=(_=(y=this.symbolLayer)==null?void 0:y.material)==null?void 0:_.color,a=this._getCombinedOpacityAndColor(o),l=Oo(a),c=a[3],u=c<1||this.needsDrivenTransparentPass,d={diffuse:l,ambient:l,opacity:c,transparent:u,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:u||n==="none"?oi.None:oi.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(ir(this._intrinsicSize,e,r),!CB(this._intrinsicSize[0])||!CB(this._intrinsicSize[1])))throw new X("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if((v=this._fastUpdates)!=null&&v.visualVariables.size||xl(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const w={...d,...this._fastUpdates.materialParameters,size:Bue(this._intrinsicSize)};this._materials[0]=new qKe(w)}else d.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,d.normalType=Tr.Compressed,this._materials[0]=new od(d);this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials[0]=null,this._materials.length=0}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,XKe,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(){var s,n,o;const e=(n=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:n.color,r=this._getCombinedOpacity(e),i=r<1||this.needsDrivenTransparentPass;(o=this._materials[0])==null||o.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,sy)}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){var e;return(e=this._materials[0])==null||e.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,r){var i;for(const s in e.diff){if(s!=="visualVariables"||!n2(this._fastUpdates,r,this._vvConvertOptions))return Ts.RecreateSymbol;(i=this._materials[0])==null||i.setParameters(this._fastUpdates.materialParameters)}return Ts.FastUpdate}_getVertexData(e){let r=0;const i=e.paths,s=[],n=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const d of i)r+=d.length;const l=Pn(3*r);let c,u=0;for(const d of i){s.push({offset:u,numVertices:d.length});for(const p of d)l[u++]=p[0],l[u++]=p[1],l[u++]=e.hasZ?p[2]:0}return o==null||n.equals(o)||Ni(l,n,0,l,o,0,r)?(o==null||o.equals(a)?c=hme(l):(c=Pn(3*r),Ni(l,o,0,c,a,0,r)),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,r,i,s){var y,_,v;this.usedMemory=0;const n=e.geometry,o=this._getVertexData(n);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(w=>w.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=n.spatialReference,c=tn(),u=this._context.renderCoordsHelper,d=new oG(o.vertexDataES);for(const w of o.pathVertexDataInfos){const x=w.numVertices;if(x<2)continue;const T=w.offset;if(this._context.clippingExtent!=null&&(ui(c),yc(c,o.vertexDataES,T,x),!zh(c,this._context.clippingExtent)))continue;const S=new Array,C=T+3*x;for(let U=T;U<C;U+=3){d.offset=U;const Y=eGe(d,this._context.elevationProvider,i,u);se(as,o.vertexDataRS[U],o.vertexDataRS[U+1],o.vertexDataRS[U+2]),u.setAltitude(as,Y),o.vertexDataRS[U]=as[0],o.vertexDataRS[U+1]=as[1],o.vertexDataRS[U+2]=as[2],S.push(kKe(this._upVectorAlignment))}const A=new XQe(S,o.vertexDataES,o.vertexDataRS,T);lve(A,this._upVectorAlignment,this._context.renderCoordsHelper);const O=new ZQe(A,this._profile,this._extruder,this._startCap,this._endCap);let $=null;if(this._fastUpdates){const U=this._fastUpdates.visualVariables,Y=Xh((y=U.size)==null?void 0:y.field,e)??0,H=Xh((_=U.color)==null?void 0:_.field,e)??0,V=Xh((v=U.opacity)==null?void 0:v.field,e)??0;$=new rKe(O,Y,H,V)}else{const U=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const V=r.size;U[0]*=lee(V[0],V[2]==="symbol-value"?this.symbolLayer.height||0:V[2],this.symbolLayer.width||0),U[1]*=lee(V[2],V[0]==="symbol-value"?this.symbolLayer.width||0:V[0],this.symbolLayer.height||0)}let Y;this._drivenProperties.color&&(Y=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(Y=Y?[Y[0],Y[1],Y[2],r.opacity]:[1,1,1,r.opacity]);const H=new Z1e(O);H.bake(U),Y&&H.bakeVertexColors(Y),$=H}const D=$.createGeometryData(),N=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),z=new tKe(this._materials[0],D,$,l,this._stencilWidth,N);z.transformation=Ya(ge(),$i,O.path.origin),a.push(z),this.usedMemory+=O.usedMemory}if(a.length===0)return null;const p=new zm({geometries:a,layerUid:this._context.layer.uid,graphicUid:s}),g=new rf(this,p,a,null,null,(w,x,T,S,C)=>QKe(w,x,S,C,this._upVectorAlignment),i);return g.alignedSampledElevation=0,g.needsElevationUpdates=sy(i.mode),g}};function lve(t,e,r){const{origin:i,positions:s}=t;let n=t.offset;switch(e){default:case Mp.World:for(const o of t.vertices)as[0]=s[n++]+i[0],as[1]=s[n++]+i[1],as[2]=s[n++]+i[2],r.worldUpAtPosition(as,as),o.setFrameFromUpVector(as);break;case Mp.Path:as[0]=s[n]+i[0],as[1]=s[n+1]+i[1],as[2]=s[n+2]+i[2],r.worldUpAtPosition(as,as),cKe(t,as)}}function lee(t,e,r){switch(t){case"symbol-value":return r;case"proportional":return e;default:return t}}function JKe(t,e,r,i){let s=0;const{origin:n,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let u=t.offset;u<c;u+=3)se(as,l[u],l[u+1],l[u+2]),r(as,jF),s+=jF.sampledElevation,as[0]=a[u]+n[0],as[1]=a[u+1]+n[1],as[2]=a[u+2]+n[2],i.setAltitude(as,jF.z),a[u]=as[0]-n[0],a[u+1]=as[1]-n[1],a[u+2]=as[2]-n[2];return t.updatePathVertexInformation(),s/o.length}function QKe(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!Y1e(l))continue;const c=l.path,u=c.builder.path;a+=JKe(u,e,r,i),s!==Mp.World&&lve(u,s,i),c.onPathChanged(l),l.invalidateBoundingInfo(),n.geometryVertexAttributeUpdated(l,R.POSITION)}return a/o.length}const as=E(),jF=new nA;function KKe(t,e,r,i,s=1){if(r.isGeographic&&i===$e.Global){const c=Pn(e.length),u=e.length,d=Mr(r);for(let p=0;p<u;p+=3)TV(e,p,c,p,d);e=c}ir(js,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)js[0]=Math.min(js[0],e[c]),js[1]=Math.min(js[1],e[c+1]);const n=js[0]%s,o=js[1]%s,a=js[0]-n,l=js[1]-o;for(let c=0;c<e.length;c+=3){const u=c/3*4;t[u]=(e[c]-a)/s,t[u+1]=(e[c+1]-l)/s,t[u+2]=a/s,t[u+3]=l/s}}function cve(t,e,r,i,s=1){se(Jy,1,0,0),se(Qy,0,1,0),se(Mb,0,0,1),tet(HF,r),YIe(cee,r)&&eet(cee,Jy,Qy,Mb,i,HF),ir(js,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),ir(Ky,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u=0;u<r.length;u+=3){se(Pb,r[u],r[u+1],r[u+2]);const d=de(Jy,Pb),p=de(Qy,Pb);js[0]=Math.min(js[0],d),js[1]=Math.min(js[1],p),Ky[0]=Math.max(Ky[0],d),Ky[1]=Math.max(Ky[1],p)}const n=de(Mb,HF);WF(_g,js[0],js[1],n,Jy,Qy,Mb),WF(e_,Ky[0],js[1],n,Jy,Qy,Mb),WF(t_,js[0],Ky[1],n,Jy,Qy,Mb),ce(e_,e_,_g),ee(e_,e_,.5),ce(t_,t_,_g),ee(t_,t_,.5),le(_g,_g,e_),le(_g,_g,t_);const o=js[0]%s,a=js[1]%s,l=js[0]-o,c=js[1]-a;for(let u=0;u<r.length;u+=3){se(Pb,r[u],r[u+1],r[u+2]);const d=u/3,p=4*d;t[p]=(de(Jy,Pb)-l)/s,t[p+1]=(de(Qy,Pb)-c)/s,t[p+2]=l/s,t[p+3]=c/s;const g=9*d;for(let y=0;y<3;y++)e[g+y]=_g[y],e[g+y+3]=e_[y],e[g+y+6]=t_[y]}}const HF=E(),Pb=E(),cee=wr(),Jy=E(),Qy=E(),Mb=E(),js=ke(),Ky=ke(),_g=E(),e_=E(),t_=E();function eet(t,e,r,i,s,n){s!=null?(s.basisMatrixAtPosition(n,Id),se(IO,Id[0],Id[1],Id[2]),se(LO,Id[4],Id[5],Id[6]),se(qF,Id[8],Id[9],Id[10])):(se(IO,1,0,0),se(LO,0,1,0),se(qF,0,0,1));const o=t;de(o,qF)<0&&ee(o,o,-1),ie(i,o);const a=de(o,LO),l=de(o,IO);Math.abs(a)>Math.abs(l)?(Ga(e,IO,o,-l),pe(e,e),rt(r,e,o),pe(r,r),ee(r,r,-1)):(Ga(r,LO,o,-a),pe(r,r),rt(e,r,o),pe(e,e))}const Id=ge(),IO=E(),LO=E(),qF=E();function tet(t,e){se(FT,0,0,0);for(let r=0;r<e.length-3;r+=3)FT[0]+=e[r],FT[1]+=e[r+1],FT[2]+=e[r+2];ee(t,FT,1/(e.length/3-1))}const FT=E();function WF(t,e,r,i,s,n,o){se(t,e*s[0]+r*n[0]+i*o[0],e*s[1]+r*n[1]+i*o[1],e*s[2]+r*n[2]+i*o[2])}function ret(t){const e=new dr,{vertex:r,fragment:i,attributes:s,varyings:n}=e;Rl(r,t),e.include(qa,t),e.include(Dv,t),e.include(am,t),e.include(rA,t),s.add(R.POSITION,"vec3"),t.vvColor&&s.add(R.COLORFEATUREATTRIBUTE,"float"),n.add("vColor","vec4"),n.add("vpos","vec3");const o=t.multipassEnabled&&(t.output===L.Color||t.output===L.Alpha);o&&n.add("depth","float"),r.uniforms.add(new nr("eColor",c=>c.color));const a=t.output===L.Depth;a&&(e.include(Em,t),lv(e),Q0(e)),r.code.add(b`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${a?b`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:b`transformPosition(proj, view, vpos);`}
    }
  `),e.include(us,t),o&&e.include(Nl,t),i.include(tf);const l=t.output===L.Highlight;return l&&e.include(_y,t),i.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${t.output===L.ObjectAndLayerIdColor?b`fColor.a = 1.0;`:""}

    if (fColor.a < ${b.float(qn)}) {
      discard;
    }

    ${t.output===L.Alpha?b`fragColor = vec4(fColor.a);`:""}

    ${t.output===L.Color?b`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===Qe.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    ${l?b`outputHighlight();`:""};
    ${t.output===L.Depth?b`outputDepth(linearDepth);`:""};
    ${t.output===L.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const iet=Object.freeze(Object.defineProperty({__proto__:null,build:ret},Symbol.toStringTag,{value:"Module"}));let uve=class hve extends Sr{initializeProgram(e){return new vr(e.rctx,hve.shader.get().build(this.configuration),hr)}_createPipeline(e,r){const i=this.configuration,s=e===Qe.NONE,n=e===Qe.FrontFace;return Et({blending:i.output!==L.Color&&i.output!==L.Alpha||!i.transparent?null:s?Ac:Bm(e),culling:ZD(i.cullFace),depthTest:{func:vy(e)},depthWrite:(s||n)&&i.writeDepth?Xa:null,colorWrite:Ut,stencilWrite:i.hasOccludees?Gp:null,stencilTest:i.hasOccludees?r?ny:by:null,polygonOffset:s||n?i.polygonOffset?set:null:xN(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};uve.shader=new _r(iet,()=>he(()=>import("./ColorMaterial.glsl-97dea179.js"),[],import.meta.url));const set={factor:1,units:1};let Bn=class extends ga{constructor(){super(...arguments),this.output=L.Color,this.cullFace=oi.None,this.transparencyPassType=Qe.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}};h([F({count:L.COUNT})],Bn.prototype,"output",void 0),h([F({count:oi.COUNT})],Bn.prototype,"cullFace",void 0),h([F({count:Qe.COUNT})],Bn.prototype,"transparencyPassType",void 0),h([F()],Bn.prototype,"hasSlicePlane",void 0),h([F()],Bn.prototype,"hasVertexColors",void 0),h([F()],Bn.prototype,"transparent",void 0),h([F()],Bn.prototype,"polygonOffset",void 0),h([F()],Bn.prototype,"enableOffset",void 0),h([F()],Bn.prototype,"writeDepth",void 0),h([F()],Bn.prototype,"hasOccludees",void 0),h([F()],Bn.prototype,"multipassEnabled",void 0),h([F()],Bn.prototype,"cullAboveGround",void 0),h([F()],Bn.prototype,"objectAndLayerIdColorInstanced",void 0),h([F()],Bn.prototype,"vvColor",void 0),h([F({constValue:!1})],Bn.prototype,"occlusionPass",void 0),h([F({constValue:!0})],Bn.prototype,"hasVvInstancing",void 0),h([F({constValue:!1})],Bn.prototype,"vvSize",void 0),h([F({constValue:!1})],Bn.prototype,"vvOpacity",void 0);let uee=class extends tH{constructor(e){super(e,new oet),this.supportsEdges=!0,this._configuration=new Bn}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<bN,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}produces(e,r){return r===L.Color||r===L.Alpha||r===L.Highlight||r===L.Depth&&this.parameters.writeLinearDepth||r===L.ObjectAndLayerIdColor?e===oe.DRAPED_MATERIAL?!0:r===L.Highlight?e===oe.OPAQUE_MATERIAL:e===(this._isTransparent?this.parameters.writeDepth?oe.TRANSPARENT_MATERIAL:oe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:oe.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new net(e)}createBufferWriter(){const e=Ci().vec3f(R.POSITION);return te("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4u8(R.COLOR),new z2(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}},net=class extends my{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==L.Color&&this._output!==L.Alpha||this._updateOccludeeState(e),this.ensureTechnique(uve,e)}},oet=class extends iA{constructor(){super(...arguments),this.color=Ec,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=oi.None,this.hasOccludees=!1}};var Hn;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(Hn||(Hn={}));const KB=.70710678118,hee=KB,aet=.08715574274;function cet(t){const e=new dr,r=t.multipassEnabled&&(t.output===L.Color||t.output===L.Alpha),{vertex:i,fragment:s,attributes:n,varyings:o}=e;Rl(i,t),e.include(qa,t),e.include(Dv,t),e.include(am,t),t.draped?i.uniforms.add(new Ee("worldToScreenRatio",(c,u)=>1/u.screenToPCSRatio)):n.add(R.BOUNDINGRECT,"mat3"),n.add(R.POSITION,"vec3"),n.add(R.UVMAPSPACE,"vec4"),t.vvColor&&n.add(R.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),r&&o.add("depth","float"),i.uniforms.add(new nr("uColor",c=>c.color));const a=t.style===Hn.ForwardDiagonal||t.style===Hn.BackwardDiagonal||t.style===Hn.DiagonalCross;a&&i.code.add(b`
      const mat2 rotate45 = mat2(${b.float(KB)}, ${b.float(-hee)},
                                 ${b.float(hee)}, ${b.float(KB)});
    `),t.draped||(sd(i,t),i.uniforms.add(new Ee("worldToScreenPerDistanceRatio",(c,u)=>1/u.camera.perScreenPixelRatio)),i.code.add(b`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(b`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(b`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${b.float(aet)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(b`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":b`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${b.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const l=t.output===L.Depth;return l&&(e.include(Em,t),lv(e),Q0(e)),i.code.add(b`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = ${l?b`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:b`transformPosition(proj, view, vpos);`}
    }
  `),e.include(us,t),s.include(tf),t.draped&&s.uniforms.add(new Ee("texelSize",(c,u)=>1/u.camera.pixelRatio)),t.output===L.Highlight&&e.include(_y,t),r&&e.include(Nl,t),t.output!==L.Highlight&&(s.code.add(b`
      const float lineWidth = ${b.float(t.lineWidth)};
      const float spacing = ${b.float(t.patternSpacing)};
      const float spacingINV = ${b.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||s.code.add(b`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),s.code.add(b`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==L.Highlight?b`color.a *= ${uet(t)};`:""}

      ${t.output===L.ObjectAndLayerIdColor?b`color.a = 1.0;`:""}

      if (color.a < ${b.float(qn)}) {
        discard;
      }

      ${t.output===L.Alpha?b`fragColor = vec4(color.a);`:""}

      ${t.output===L.Color?b`fragColor = color; ${t.transparencyPassType===Qe.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
      ${t.output===L.Highlight?b`outputHighlight();`:""}
      ${t.output===L.Depth?b`outputDepth(linearDepth);`:""};
    }
  `),e}function uet(t){function e(r){return t.draped?b`coverage(vuv.${r}, texelSize)`:b`sampleAA(vuv.${r})`}switch(t.style){case Hn.ForwardDiagonal:case Hn.Horizontal:return e("y");case Hn.BackwardDiagonal:case Hn.Vertical:return e("x");case Hn.DiagonalCross:case Hn.Cross:return b`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const het=Object.freeze(Object.defineProperty({__proto__:null,build:cet},Symbol.toStringTag,{value:"Module"}));let dve=class pve extends Sr{initializeProgram(e){return new vr(e.rctx,pve.shader.get().build(this.configuration),fve)}_setPipelineState(e,r){const i=this.configuration,s=e===Qe.NONE,n=e===Qe.FrontFace;return Et({blending:i.output===L.Color||i.output===L.Alpha?s?Ac:Bm(e):null,culling:ZD(i.cullFace),depthTest:{func:vy(e)},depthWrite:s?i.writeDepth?Xa:null:vN(e),colorWrite:Ut,stencilWrite:i.hasOccludees?Gp:null,stencilTest:i.hasOccludees?r?ny:by:null,polygonOffset:s||n?i.polygonOffset?det:null:xN(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};dve.shader=new _r(het,()=>he(()=>import("./Pattern.glsl-2cbe797a.js"),[],import.meta.url));const det={factor:1,units:1};let nn=class extends ga{constructor(){super(...arguments),this.output=L.Color,this.cullFace=oi.None,this.transparencyPassType=Qe.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.multipassEnabled=!1,this.cullAboveGround=!1,this.vvColor=!1}};h([F({count:L.COUNT})],nn.prototype,"output",void 0),h([F({count:oi.COUNT})],nn.prototype,"cullFace",void 0),h([F({count:Hn.COUNT})],nn.prototype,"style",void 0),h([F({count:Qe.COUNT})],nn.prototype,"transparencyPassType",void 0),h([F()],nn.prototype,"hasSlicePlane",void 0),h([F()],nn.prototype,"hasVertexColors",void 0),h([F()],nn.prototype,"polygonOffset",void 0),h([F()],nn.prototype,"writeDepth",void 0),h([F()],nn.prototype,"hasOccludees",void 0),h([F()],nn.prototype,"patternSpacing",void 0),h([F()],nn.prototype,"lineWidth",void 0),h([F()],nn.prototype,"enableOffset",void 0),h([F()],nn.prototype,"draped",void 0),h([F()],nn.prototype,"multipassEnabled",void 0),h([F()],nn.prototype,"cullAboveGround",void 0),h([F()],nn.prototype,"vvColor",void 0),h([F({constValue:!1})],nn.prototype,"occlusionPass",void 0),h([F({constValue:!1})],nn.prototype,"hasVvInstancing",void 0),h([F({constValue:!1})],nn.prototype,"vvSize",void 0),h([F({constValue:!1})],nn.prototype,"vvOpacity",void 0);const fve=new Map([[R.POSITION,0],[R.COLOR,3],[R.UVMAPSPACE,4],[R.COLORFEATUREATTRIBUTE,5],[R.BOUNDINGRECT,6]]);let xH=class extends tH{constructor(e){super(e,new met),this.supportsEdges=!0,this._vertexAttributeLocations=fve,this._configuration=new nn}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<bN,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}produces(e,r){return r===L.Color||r===L.Alpha||r===L.Highlight||r===L.Depth&&this.parameters.writeLinearDepth?e===oe.DRAPED_MATERIAL?!0:r===L.Highlight?e===oe.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?oe.TRANSPARENT_MATERIAL:oe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new pet(e)}createBufferWriter(){const e=Ci().vec3f(R.POSITION).vec4f(R.UVMAPSPACE);return this.parameters.draped||e.mat3f(R.BOUNDINGRECT),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4u8(R.COLOR),new fet(e)}},pet=class extends my{_updateParameters(e){return this.ensureTechnique(dve,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==L.Color&&this._output!==L.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},fet=class extends z2{write(e,r,i,s,n){for(const o of this.vertexBufferLayout.fields.keys()){const a=i.attributes.get(o),l=a==null?void 0:a.indices;if(a&&l)switch(o){case R.UVMAPSPACE:{Je(a.size===4);const c=s.getField(o,nd);c&&o2(a,c,n);break}case R.BOUNDINGRECT:{Je(a.size===9);const c=s.getField(o,K0);c&&this.writeBoundingRect(a,e,c,n);break}default:Hge(o,a,e,r,s,n)}}}writeBoundingRect(e,r,i,s){const{data:n,indices:o}=e,a=r,l=i.typedBuffer,c=i.typedBufferStride,u=o.length;s*=c;for(let d=0;d<u;++d){const p=9*o[d],g=n[p],y=n[p+1],_=n[p+2];l[s]=a[0]*g+a[4]*y+a[8]*_+a[12],l[s+1]=a[1]*g+a[5]*y+a[9]*_+a[13],l[s+2]=a[2]*g+a[6]*y+a[10]*_+a[14];for(let v=3;v<9;++v)l[s+v]=n[p+v];s+=c}}},met=class extends iA{constructor(){super(...arguments),this.color=Ot(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=oi.None,this.hasOccludees=!1,this.style=Hn.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function get(t,e){const r=(t==null?void 0:t.pattern)??null;return r==null?new uee(e):r.style==="none"||r.style==="solid"?(r.style==="none"&&(e.color=Ot(0,0,0,0),e.forceTransparentMode=!0),new uee(e)):(e.style=yet(r.style),new xH(e))}function yet(t){switch(t){case"horizontal":return Hn.Horizontal;case"vertical":return Hn.Vertical;case"cross":return Hn.Cross;case"forward-diagonal":return Hn.ForwardDiagonal;case"backward-diagonal":return Hn.BackwardDiagonal;case"diagonal-cross":return Hn.DiagonalCross;default:return}}function _et(t){return t.material instanceof xH&&!t.material.parameters.draped}function vet(t,e){if(_et(t)){const r=t.attributes.get(R.POSITION).data,i=t.getMutableAttribute(R.UVMAPSPACE).data,s=t.getMutableAttribute(R.BOUNDINGRECT).data;cve(i,s,r,e)}}function bet(t,e,r,i,s){const n=g0e(t,e,r,i,s),o=t.stageObject.geometries;for(const a of o)vet(a,s);return n}const wet=["polyline","polygon","extent"],dee=new eA({size:!1,color:!0,rotation:!1,opacity:!1});let mve=class gve extends sf{constructor(e,r,i,s){super(e,r,i,s),this._needsUV=!1}async doLoad(){this._fastUpdates=s2(this._context.renderer,dee)}_createMaterials(){var s,n,o;if(this._materials.length>0)return;const e=(n=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:n.color,r=this._getCombinedOpacityAndColor(e);this._materials[ss.Fill]=get(this.symbolLayer,{color:r,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...(o=this._fastUpdates)==null?void 0:o.materialParameters}),this._needsUV=this._materials[ss.Fill]instanceof xH;const i=this.symbolLayer.outline;if(this._isValidOutline(i)){const a=s1e(i.pattern);this._materials[ss.Outline]=new Hw({width:Fo(i.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:a,cap:qB(i.patternCap||"butt")})}this._context.stage.addMany(this._materials)}_isValidOutline(e){return(e==null?void 0:e.size)!=null&&e.size>0&&e.color!=null&&(e.pattern==null||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,wet,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._createMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,s)}applyRendererDiff(e,r){var i;for(const s in e.diff){if(s!=="visualVariables"||!n2(this._fastUpdates,r,dee))return Ts.RecreateSymbol;(i=this._materials[ss.Fill])==null||i.setParameters(this._fastUpdates.materialParameters)}return Ts.FastUpdate}layerOpacityChanged(){var e,r;if(this._materials[ss.Fill]!=null){const i=this._materials[ss.Fill].parameters.color,s=(r=(e=this.symbolLayer)==null?void 0:e.material)==null?void 0:r.color,n=this._getCombinedOpacity(s);this._materials[ss.Fill].setParameters({color:[i[0],i[1],i[2],n],forceTransparentMode:this.needsDrivenTransparentPass})}if(this._materials[ss.Outline]!=null){const i=this._materials[ss.Outline].parameters.color;this._materials[ss.Outline].setParameters({color:[i[0],i[1],i[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=sA(gve.elevationModeChangeTypes,i,s);if(n!==es.UPDATE)return n;const o=ku(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){var e;if((e=this._materials[ss.Fill])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[ss.Outline]){const r={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[ss.Outline].setParameters(r)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var u;const s=n3(e.geometry);if(!s)return null;const n=oH(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new xet(n,r,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=Gi(4*a,!0),o.boundingRect=Pn(9*a,!0),cve(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(u=this._context.stage.renderView)==null?void 0:u.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._materials[ss.Outline]&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new zm({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new rf(this,l,o.outGeometries,null,null,bet,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=ku(i.mode),c}_createAs3DShapeFill(e,r){var s;const i=r.renderData.polygons;for(const{position:n,mapPositions:o,holeIndices:a,index:l,count:c}of i){if(this._context.clippingExtent!=null&&(ui(Ku),yc(Ku,o),!zh(Ku,this._context.clippingExtent)))continue;const u=sqe(o,a,this._context.elevationProvider.spatialReference);if(u.length===0)continue;const d=(s=this._fastUpdates)==null?void 0:s.visualVariables.color,p=SQ({material:this._materials[ss.Fill],indices:u,mapPositions:o,attributeData:{position:n,color:d?null:r.color,colorFeature:d?Xh(d.field,e):null,uvMapSpace:this._needsUV?bI(r.uvMapSpace,4*l,4*c):null,boundingRect:this._needsUV?Tu(r.boundingRect,9*l,9*c):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(p)}}_createAs3DShapeOutline(e){if(this._materials[ss.Outline]==null)return;const r=e.renderData.outlines;for(const{mapPositions:i,position:s}of r){if(this._context.clippingExtent!=null&&(ui(Ku),yc(Ku,i),!zh(Ku,this._context.clippingExtent)))continue;const n=WB(this._materials[ss.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:i,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(n)}}_createAsOverlay(e,r){var a;const i=n3(e.geometry);if(i==null)return null;this._materials[ss.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,this._materials[ss.Outline]!=null&&(this._materials[ss.Outline].renderPriority=this._renderPriority);const s=k_e(i,this._context.overlaySR),n=new Tet(s,r,this._context.layer.uid,e.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=Gi(4*o,!0),KKe(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=ui(),n.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(n),this._createAsOverlayFill(e,n),this._materials[ss.Outline]&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,i.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new FN(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,r){var s;const i=r.renderData.polygons;for(const{position:n,holeIndices:o,index:a,count:l}of i){const c=ui(Ku);if(yc(c,n),!zh(c,this._context.clippingExtent))continue;const u=c2(n,o,3);if(u.length===0)continue;Dx(r.outBoundingBox,c);const d=(s=this._fastUpdates)==null?void 0:s.visualVariables.color,p=SQ({material:this._materials[ss.Fill],indices:u,attributeData:{position:n,color:d?null:r.color,colorFeature:d?Xh(d.field,e):null,uvMapSpace:this._needsUV?bI(r.uvMapSpace,4*a,4*l):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(new h2(p,r))}}_createAsOverlayOutline(e){if(this._materials[ss.Outline]==null)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{position:s}=r[i];if(ui(Ku),yc(Ku,s),!zh(Ku,this._context.clippingExtent))continue;Dx(e.outBoundingBox,Ku);const n=WB(this._materials[ss.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(new h2(n,e))}}_getOutlineOpacity(){var r,i;const e=(i=(r=this.symbolLayer)==null?void 0:r.outline)==null?void 0:i.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){var i,s;const e=(s=(i=this.symbolLayer)==null?void 0:i.outline)==null?void 0:s.color,r=this._getOutlineOpacity();return YE(e!=null?qe.toUnitRGB(e):null,r)}test(){return{...super.test(),createAsOverlay:(e,r)=>this._createAsOverlay(e,r),createAs3DShape:(e,r,i)=>this._createAs3DShape(e,r,i)}}};mve.elevationModeChangeTypes={definedChanged:es.RECREATE,staysOnTheGround:es.NONE,onTheGroundChanged:es.RECREATE};const Ku=tn();let xet=class extends DN{constructor(e,r,i,s){super(e,i,s),this.color=r}},Tet=class extends DN{constructor(e,r,i,s){super(e,i,s),this.color=r}};var ss;(function(t){t[t.Fill=0]="Fill",t[t.Outline=1]="Outline"})(ss||(ss={}));let yve=class{constructor(e,r="center",i=!1,s=ke(),n=Ot(0,0,0,-1),o="world",a=E(),l=0){this.verticalOffset=e,this.anchor=r,this.hasLabelVerticalOffset=i,this.screenOffset=s,this.centerOffset=n,this.centerOffsetUnits=o,this.translation=a,this.elevationOffset=l}},_ve=class{constructor(e,r="center",i="center",s=null,n=ke()){this.placement=e,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=s,this.displaySize=n}};const Eet="arial-unicode-ms",pee="woff2",fee=new Map,vve=new Set;let Cet=class{constructor(e,r){this.fontFace=e,this.promise=r}};async function Aet(t){const e=Pet(t),r=fee.get(e);if(r)return r.promise;const i=new FontFace(t.family,`url('${kr.fontsUrl}/woff2/${e}.${pee}') format('${pee}')`,{style:t.style,weight:t.weight}),s=document.fonts;if(s.has(i)&&i.status==="loading")return i.loaded;const n=i.load().then(()=>(s.add(i),i));return fee.set(e,new Cet(i,n)),vve.add(i),n}function Ret(t){return vve.has(t)}function Oet(t){if(!t)return Eet;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function Pet(t){const e=Met(t)+$et(t);return Oet(t.family)+(e.length>0?e:"-regular")}function Met(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function $et(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let bve=class wve{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const r=this.definition.font,i="sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji";return`${r.style} ${r.weight} ${e}px ${r.family}, ${i}`}setFontProperties(e,r){e.font=this.fontString(r),e.textAlign="left",e.textBaseline="alphabetic"}_colorToRGB(e){return`rgb(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()},${e[3]})`}static async fromSymbol(e,r){var p,g,y,_,v;const i=(p=e==null?void 0:e.material)==null?void 0:p.color,s=qe.toUnitRGBA(i)??Ec,n=e.size!=null?Fo(e.size):12,o=e.lineHeight,a=e.background!=null?qe.toUnitRGBA(e.background.color):Ec,l={family:((g=e.font)==null?void 0:g.family)??"sans-serif",decoration:((y=e.font)==null?void 0:y.decoration)??"none",weight:((_=e.font)==null?void 0:_.weight)??"normal",style:((v=e.font)==null?void 0:v.style)??"normal"},c=e.halo,u=(c==null?void 0:c.color)!=null&&c.size>0?{size:Fo(c.size),color:qe.toUnitRGBA(c.color)}:{size:0,color:Ec},d=new wve({color:s,size:n,background:{color:a,padding:e.background!=null?[.65*n,.5*n]:[0,0],borderRadius:e.background!=null?n*(6/16):0},lineSpacingFactor:o,font:l,halo:u,pixelRatio:r});if(e.font){let w=!1;const x=d.fontString(n);try{w=(await document.fonts.load(x)).some(T=>!Ret(T))}catch{ne.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${x}'. Some text symbology may be rendered using the default browser font.`)}if(!w&&!Iet.has(e.font.family))try{await Aet(e.font)}catch{}}return d}};const Iet=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),vg=4096;let x1=class extends xe{constructor(e){super(e),this.type=Ki.Texture,this.id=bc(),this.events=new Ps,this._glTexture=null,this._atlas=new Net(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=Ke(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return aC=0,[vg-bg-aC,vg-bg-aC-mee]}load(e){if(this._glTexture)return this._glTexture;const r=new Or;return r.wrapMode=Ft.CLAMP_TO_EDGE,r.samplingMode=Dt.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.preMultiplyAlpha=!0,r.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new Rt(e,r,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(ct.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=di(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=Ke(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.width.toString()),this._canvas.setAttribute("height",e.height.toString())}_resizeAtlas(e,r){var n,o;const{width:i,height:s}=this._atlas;i===e&&s===r||(this._atlas.width=e,this._atlas.height=r,(n=this._glTexture)==null||n.resize(e,r),(o=this._glTexture)==null||o.updateData(0,0,0,i,s,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(a=>{const l=this._stageObjects.get(a.textRenderer.key);l==null||l.forEach(c=>YF(c,a))}),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,r,i,s){const n=this._atlas;if(n.width<i||n.height<s)return!1;let o=n.cursors.get(s);if(!o){if(n.height<n.nextY+s)return!1;o=[new gee(n.nextY)],n.cursors.set(s,o),n.nextY+=s}let a=o.find(l=>n.width>=l.x+i);if(a==null){if(n.height<n.nextY+s)return!1;a=new gee(n.nextY),n.nextY+=s,o.push(a)}return e.setNewPosition(a),this._elements.set(r,e),this._elementsToRender.set(r,e),a.x+=i,!0}_ensureStageObjects(e){const r=this._stageObjects.get(e);if(r)return r;const i=new Set;return this._stageObjects.set(e,i),i}_addStageObject(e,r){this._ensureStageObjects(e).add(r)}_removeStageObject(e,r){const i=this._stageObjects.get(e);i!=null&&i.delete(r)&&(r.geometries[0].setAttributeData(R.SIZE,[0,0]),r.geometryVertexAttributeUpdated(r.geometries[0],R.SIZE),this._elementsToRender.delete(e))}_processAddition(e){const r=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(r,e);const i=this._atlas,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+bg,a=n+bg+mee;if(!this._addAtlasElement(e,r,o,a)){if(this._canRepack)this._reset();else if(i.width<o){const l=Math.min(M1(Math.max(o,1.5*i.width)),vg);this._resizeAtlas(l,i.height)}else{const l=i.nextY+a,c=Math.min(M1(Math.max(l,1.5*i.height)),vg);if(c>i.height)this._resizeAtlas(i.width,c);else if(i.width<vg){const u=Math.min(M1(1.5*i.width),vg);this._resizeAtlas(u,i.height)}}this._elements.set(r,e)}}_renderElement(e){const r=e.commitNewPosition();this._ctx.clearRect(r[0]-bg,r[1]-bg,e.textRenderer.renderedWidth+2*bg,e.textRenderer.renderedHeight+2*bg),e.textRenderer.render(this._ctx,r[0],r[1]);const i=this._stageObjects.get(e.textRenderer.key);i==null||i.forEach(s=>YF(s,e))}get running(){return this.updating}runTask(e){if(this._glTexture==null)return go.YIELD;for(;this._needsRepack&&(this._canRepack||this._atlas.height<vg&&this._atlas.height<vg);){this._canRepack=this._needsRepack=!1;const r=this._elements;this._elements=new Map,r.forEach(i=>this._processAddition(i)),e.madeProgress()}if(this._elementsToRender.size>0){for(const[r,i]of this._elementsToRender){if(e.done)break;this._renderElement(i),this._elementsToRender.delete(r),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addTextTexture(e,r){const i=e.key;this._addStageObject(i,r);let s=this._elements.get(i);s==null&&(s=new Det(this._atlas,e),this._processAddition(s),this.setDirty()),Let(r,s),YF(r,s)}removeTextTexture(e,r){const i=e.key;if(!this._elements.get(i))return;this._removeStageObject(i,r);const s=this._stageObjects.get(i);s&&s.size!==0||this._elements.delete(i),(s==null?void 0:s.size)===0&&this._stageObjects.delete(i),this._canRepack=!0}setDirty(){this._glTexture&&(this.updating=!0)}get test(){const{_elements:e,_stageObjects:r,_atlas:i}=this,s=this;return{elements:e,stageObjects:r,atlas:i,resizeAtlas:(n,o)=>s._resizeAtlas(n,o),run:n=>s.runTask(n)}}};function Let(t,e){t.geometries[0].setAttributeData(R.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),t.geometryVertexAttributeUpdated(t.geometries[0],R.SIZE)}function YF(t,e){t.geometries[0].setAttributeData(R.UV0,e.uv),t.geometryVertexAttributeUpdated(t.geometries[0],R.UV0,!0)}h([f({constructOnly:!0})],x1.prototype,"view",void 0),h([f({type:Boolean})],x1.prototype,"updating",void 0),x1=h([k("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],x1);const bg=2,mee=2;let Det=class{constructor(e,r){this._atlas=e,this.textRenderer=r,this._uv=Jt(),this._newPosition=[0,0]}get uv(){if(this._xOffset==null||this._yOffset==null)return Ec;const{renderedWidth:e,renderedHeight:r}=this.textRenderer;return Si(this._uv,this._xOffset/this._atlas.width,(this._yOffset+r)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},Net=class{constructor(e,r){this.width=e,this.height=r,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=aC}},gee=class{constructor(e){this.y=e,this.x=aC}},aC=0,Fet=class{constructor(e,r,i){this._renderer=new Z_e(e,r,i,x1.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=QI(Uet,this._renderer.renderedWidth,this._renderer.renderedHeight),r=e.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new Nv(e,{wrap:{s:Ft.CLAMP_TO_EDGE,t:Ft.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const Uet={canvas:null},ket=[0,0,1];let Bet=class extends sf{constructor(e,r,i,s){super(e,r,i,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=TN(this.symbolLayer.size);if(e)throw new X("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await bve.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const r=e.graphic,i=i3(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const s=this.symbolLayer.text;if(s==null||s==="")return null;const n=gV(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(n!=null&&!Xce(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const{verticalAlignment:o}=this.symbolLayer,a=new yve(n);zXe(o,a.screenOffset);const l=new _ve(a,this.symbolLayer.horizontalAlignment,BXe(o));return this._createAs3DShape(r,i,s,l)}createLabel(e,r,i,s,n){const o=e.graphic,a=i3(o.geometry);if(a==null)return this.logger.warn(`unsupported geometry type for label: ${o.geometry.type}`),null;const l=r.text;return!l||/^\s+$/.test(l)?null:this._createAs3DShape(o,a,l,r,i,s,n)}setGraphicElevationContext(e,r,i=0){return super.setGraphicElevationContext(e,r),r.addOffsetRenderUnits(i),r}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,r){return yee(e,r,(i,s)=>{this.updateGraphicElevationContext(s,i)}),es.UPDATE}slicePlaneEnabledChanged(e,r){return yee(e,r,i=>{for(const s of i.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,r){const i=r.elevationContext;this.setGraphicElevationContext(e,i,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=ku(i.mode)||i.mode==="absolute-height"}_defaultElevationInfoNoZ(){return Vet}_createAs3DShape(e,r,i,s,n=null,o=null,a=()=>s.placement.elevationOffset){var D;const l=this.setGraphicElevationContext(e,new BI,s.placement.elevationOffset),c=((D=e.geometry)==null?void 0:D.type)==="polyline",u=e.uid;let d=null,p=null;if(o==null){const N=Q_e(s.horizontalPlacement);d=new Fet(i,N,this._textRenderParameters);let z=null;if(this._context.sharedResources.textures!=null){p=this._context.sharedResources.textures.fromData(d.key,()=>d.create()),p.texture.events.on("unloaded",()=>z==null?void 0:z.release());const U=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(U==null||Fl(U))return p.release(),null;z=U}}const g=zet(d,s),y={occlusionTest:!0,screenOffset:s.placement.screenOffset,anchorPosition:g,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.placement.centerOffsetUnits,drawInSecondSlot:!0};if(o?y.textureId=o.id:p&&(y.textureId=p.texture.id),s.placement.verticalOffset!=null){const{screenLength:N,minWorldLength:z,maxWorldLength:U}=s.placement.verticalOffset;y.verticalOffset={screenLength:Fo(N),minWorldLength:z||0,maxWorldLength:U??1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:N,screenSizePerspectiveSettingsLabels:z}=this._context.sharedResources,U=X_e(this._textRenderParameters);y.screenSizePerspective=z.overrideFontHeight(U.maxHeight),y.screenSizePerspectiveAlignment=N}c&&(y.shaderPolygonOffset=1e-4),y.hasSlicePlane=this._context.slicePlaneEnabled;const _=(N,z)=>{const U=JSON.stringify(z);let Y=N.get(U);return Y==null&&(Y=new a2(z),N.add(U,Y)),Y},v=n?_(n,y):new a2(y),w=s.placement.translation,x=d?tr(d.displayWidth,d.displayHeight):_m,T=s.placement.centerOffset,S=eB(v,ket,w,null,x,T,[0,0],null),C=Fj(this._context,r,S,l,u);if(C==null)return null;const A=(N,z,U,Y,H,V)=>{const J=a()||s.placement.elevationOffset,P=this.setGraphicElevationContext(e,z,J);return I1(N,P,U,Y,H,V)},O=new rf(this,C.object,[S],n==null?[v]:null,p,A,l);O.alignedSampledElevation=C.sampledElevation,O.needsElevationUpdates=ku(l.mode)||l.mode==="absolute-height",O.getScreenSize=(N=ke())=>(N[0]=d?d.displayWidth:s.displaySize[0],N[1]=d?d.displayHeight:s.displaySize[1],N);const $=new T0e(s.placement.elevationOffset,i);return O.metadata=$,r3(O,r,this._context.elevationProvider),O}};function yee(t,e,r){t&&t.forEach(i=>{const s=e(i);s!=null&&r(s,i.graphic)})}function zet(t,e){if(e.verticalPlacement==="baseline"){const i=FXe[e.horizontalPlacement],s=t!=null?t.baselineAnchorY:0;return tr(i,s)}const r=kXe(e.horizontalPlacement,e.verticalPlacement);return NM[r]}const Vet={mode:"relative-to-ground",offset:0},Get={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},jet=["polyline","polygon","extent"];let ez=class V_ extends sf{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,jet,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(this._materials[0])return;const e=new I_e,r=this.symbolLayer.color;r!=null&&(e.color=qe.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?V_.headingVectorFromAngle(this.symbolLayer.waveDirection):tr(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=Get[s];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._materials[0]=new $_e(e),this._context.stage.add(this._materials[0])}layerOpacityChanged(){if(this._materials[0]==null)return;const e=this._materials[0].parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[e[0],e[1],e[2],r],transparent:i})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=sA(V_.elevationModeChangeTypes,i,s);if(n!==es.UPDATE)return n;const o=ku(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var d;const s=n3(e.geometry);if(s==null)return null;const n=oH(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=n.position.length/3,a=Pn(2*o);this._createUVCoordsFromVertices(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new Het(n,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=(d=this._context.stage.renderView)==null?void 0:d.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new zm({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),u=new rf(this,c,l.outGeometries,null,null,g0e,r);return u.alignedSampledElevation=l.renderData.sampledElevation,u.needsElevationUpdates=ku(r.mode),u}_createUVCoordsFromVertices(e,r,i,s){const n=qo(s);Mu(wg);for(let l=0;l<i;l++)ir(_ee,r[3*l],r[3*l+1]),L7(wg,_ee);X1(wg,wg,n);const o=wg[0]%V_.unitSizeOfTexture,a=wg[1]%V_.unitSizeOfTexture;DO[0]=wg[0]-o,DO[1]=wg[1]-a;for(let l=0;l<i;l++)e[2*l]=(r[3*l]*n-DO[0])/V_.unitSizeOfTexture,e[2*l+1]=(r[3*l+1]*n-DO[1])/V_.unitSizeOfTexture}_create3DShapeGeometries(e){const r=e.renderData.polygons,i=e.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of r){if(this._context.clippingExtent!=null&&(ui(r_),yc(r_,a),!zh(r_,this._context.clippingExtent)))continue;const c=c2(a,l,3);if(c.length===0)continue;const u=Tu(i,2*n,2*s),d=EQ({material:this._materials[0],indices:c,mapPositions:a,attributeData:{position:o,uv0:u}},e.objectAndLayerIdColor);e.outGeometries.push(d)}}_createAsOverlay(e){var a;const r=n3(e.geometry);if(r==null)return null;this._materials[0].renderPriority=this._renderPriority;const i=k_e(r,this._context.overlaySR),s=i.position.length/3,n=Pn(2*s);this._createUVCoordsFromVertices(n,i.position,s,this._context.overlaySR);const o=new qet(i,n,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(o),o.outBoundingBox=ui(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new FN(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const r=e.uvCoords,i=e.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of i){if(ui(r_),yc(r_,s),!zh(r_,this._context.clippingExtent))continue;Dx(e.outBoundingBox,r_);const l=c2(s,n,3);if(l.length===0)continue;const c=Tu(r,2*o,2*a),u=EQ({material:this._materials[0],indices:l,attributeData:{position:s,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new h2(u,e))}}static headingVectorFromAngle(e){const r=ke(),i=XL(e);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};ez.unitSizeOfTexture=100,ez.elevationModeChangeTypes={definedChanged:es.RECREATE,staysOnTheGround:es.NONE,onTheGroundChanged:es.RECREATE};const DO=ke(),wg=Gt(),_ee=ke(),r_=tn();let Het=class extends DN{constructor(e,r,i,s){super(e,i,s),this.uvCoords=r}},qet=class extends DN{constructor(e,r,i,s){super(e,i,s),this.uvCoords=r}};function Wet(t,e,r,i){var n;const s=((n=Xet[t.type])==null?void 0:n[e.type])||Yet[e.type];return s?new s(t,e,r,i):(ne.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const Yet={icon:HB,object:YQe,line:n1e,path:ZKe,fill:mve,extrude:PYe,text:Bet,water:ez},Xet={"mesh-3d":{fill:hJe}};let Zet=class extends Nj{set symbol(e){this._symbol=e,e.symbolLayers.forEach((r,i)=>{const s=this.symbolLayers[i];s!=null&&(s.symbol=e,s.symbolLayer=r)})}get symbol(){return this._symbol}constructor(e,r,i){super(r.schedule),this._symbol=e,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const s=[];for(let n=0;n<i;n++){const o=r.at(n);if(o.enabled===!1)continue;NO.renderPriority=1-(1+n)/i,NO.renderPriorityStep=1/i,NO.ignoreDrivers=o.ignoreDrivers;const a=Wet(this.symbol,o,this._context,NO),l=UL(e,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await jL(this.symbolLayers,async(n,o)=>{if(n!=null)try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),wt(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const r=this.symbolLayers[e];return r!=null?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e==null?void 0:e.queryForSnapping)}createGraphics3DGraphic(e,r){var o,a;const i=e.graphic,s=this.symbolLayers.map(l=>(l==null?void 0:l.createGraphics3DGraphic(e))??null),n=this._context.arcade||((a=(o=this._context.featureExpressionInfoContext)==null?void 0:o.arcade)==null?void 0:a.modules)||null;return new IHe(i,r||this,s,e.layer,n)}get complexity(){return Dj(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,r){const i=this.symbolLayers.length;for(let s=0;s<i;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof rf?l:null};if(n!=null&&!n.globalPropertyChanged(e,r,o))return!1}return!0}applyRendererDiff(e,r){return this.loadStatus!==lc.LOADED?Ts.RecreateSymbol:this.symbolLayers.reduce((i,s)=>i!==Ts.RecreateSymbol&&s!=null?Math.min(i,s.applyRendererDiff(e,r)):i,Ts.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===lc.FAILED||e.diff.type!=="partial")return;const r=e.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const o=i[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const u=l.layers[n];u!=null&&a.graphics3DGraphicPatches.forEach(d=>d(u,c))})}})}updateGeometry(e,r){return this._updateGeometryOrTransform(e,(i,s)=>i.updateGeometry(s,r))}updateTransform(e,r,i,s){return this._updateGeometryOrTransform(e,(n,o)=>n.updateTransform(o,r,i,s))}_updateGeometryOrTransform(e,r){for(let i=0;i<this.symbolLayers.length;i++){const s=this.symbolLayers[i];if(s==null)continue;const n=e.layers[i];if(!n||!r(s,n))return!1}return!0}onRemoveGraphic(e){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(i==null)continue;const s=e.layers[r];s!=null&&i.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=0,r=0,i=0;return this.symbolLayers.forEach(s=>{s!=null&&(s.loadStatus===lc.LOADING?e++:s.isFastUpdatesEnabled()?i++:r++)}),{loading:e,slow:r,fast:i}}async queryForSnapping(e,r,i,s){const n=this.symbolLayers.filter(v3).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,r,i,s)),o=await Promise.all(n);return wt(s),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)e!=null&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const NO=new LHe;let Jet=class extends Nj{constructor(e,r,i){super(r),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const r=await this.symbol.fetchSymbol({signal:e});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:iye}globalPropertyChanged(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,r)}applyRendererDiff(e,r){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,r):Ts.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,r)}updateTransform(e,r,i,s){var n;return((n=this.graphics3DSymbol)==null?void 0:n.updateTransform(e,r,i,s))??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function TH(t){return t instanceof Jet?t.graphics3DSymbol:t instanceof Zet?t:null}const c3=ne.getLogger("esri.views.3d.layers.graphics.labelPlacement");let Qet=class{constructor(e,r,i,s=null){this.graphics3DGraphic=e,this.labelSymbol=r,this.labelClass=i,this.disablePlacement=s}};function vee(t){const e=att(t);if(e==null)return null;const r=Ket(t,e);if(r==null)return null;const i=r.anchor,s=!!e.hasLabelVerticalOffset,n=e.verticalOffset;return ttt(new yve(n,i,s),r,t)}function Ket(t,e){if(e.anchor)return e;const r=t.labelClass.labelPlacement,i=jh[r],s=i||sL(t);return r&&!i&&c3.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),ett(s,t)}function SH(t){const e=t.graphics3DGraphic.graphics3DSymbol,r=TH(e);return r!=null?r.symbol.symbolLayers.at(0):null}function ett(t,e){const r=e.graphics3DGraphic.graphic.geometry;if(r==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(c3.warnOncePerTick(bee(t==null?void 0:t.placement,e.disablePlacement.logEntityDescription)),sL(e)):t;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return c3.warnOncePerTick(bee(t==null?void 0:t.placement,`'${i}' geometries`)),sL(e);break;case"point":case"mesh":return t}return t}function bee(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function sL(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:Mn,anchor:"center"};case"polygon":{const r=SH(t);return r!=null&&r.type==="extrude"?jh["above-center"]:{placement:"center-center",normalizedOffset:Mn,anchor:"center"}}case"point":case"mesh":return jh["above-center"];default:return}}function ttt(t,e,r){const i=r.graphics3DGraphic.graphic.geometry;if(i==null)return null;switch(i.type){case"point":itt(t,e,r);break;case"polygon":rtt(t,e,r);break;case"mesh":EH(t,e,r.graphics3DGraphic.layers[0])}const s=MXe-KI;return t.screenOffset[0]+=s*e.normalizedOffset[0],t.screenOffset[1]+=s*e.normalizedOffset[1],t}function rtt(t,e,r){const i=SH(r);if(i!=null)switch(i.type){case"extrude":{const s=r.graphics3DGraphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(lC),Bh(lC,t.translation),t.translation[2]=dy(lC)/2):se(t.translation,0,0,0),EH(t,e,s);break}}}function itt(t,e,r){const i=SH(r);if(i==null)return;const s=r.graphics3DGraphic.layers[0];switch(s!=null?s.getCenterObjectSpace(t.translation):se(t.translation,0,0,0),i.type){case"icon":case"text":stt(t,e,r,s);break;case"object":EH(t,e,s)}}function stt(t,e,r,i){const{graphics3DGraphic:s}=r,n=i!=null?i.getScreenSize():null;if(s.isDraped||n==null)t.hasLabelVerticalOffset||t.anchor==="center"||(jh[r.labelClass.labelPlacement]&&c3.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=ntt(r);t.screenOffset[0]=n[0]/2*(e.normalizedOffset[0]-o[0]);const a=n[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function ntt(t,e=ltt){const{graphics3DGraphic:r}=t,i=r.layers[0],s=(i==null?void 0:i.stageObject.geometries[0].material)??null;if(s&&s instanceof a2){const n=s.parameters.anchorPosition;e[0]=2*(n[0]-.5),e[1]=2*(n[1]-.5)}else e[0]=0,e[1]=0;return e}function EH(t,e,r){const i=r!=null?r.getBoundingBoxObjectSpace(lC):lC,s=Te(i[3]-i[0],i[4]-i[1],i[5]-i[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=_e(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function ott(t){return t==="above-center"}function att(t){const e=t.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=t,s=TH(i.graphics3DSymbol),n=(s==null?void 0:s.symbol.type)==="point-3d"?s.symbol:null,o=jh[e]||sL(t);return n!=null&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:wee(n.verticalOffset),anchor:null,normalizedOffset:null}:!r||!r.hasVisibleVerticalOffset()||n!=null&&n.supportsCallout()&&n.verticalOffset&&!i.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&ott(o.placement)?{placement:"above-center",verticalOffset:wee(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(c3.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}function wee(t){const{screenLength:e,minWorldLength:r,maxWorldLength:i}=t;return{screenLength:e,minWorldLength:r,maxWorldLength:i}}const jh={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},xee={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in xee){const e=xee[t],r=jh[t];e.forEach(i=>{jh[i]=r})}Object.freeze&&(Object.freeze(jh),Object.keys(jh).forEach(t=>{var e;Object.freeze(jh[t]),Object.freeze((e=jh[t])==null?void 0:e.normalizedOffset)}));const ltt=[0,0],lC=tn();let Tee=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,r){this._materials.set(e,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}},See=class{constructor(e,r){this.labelingContext=e,this.graphics3DGraphic=r,this.hasGraphics3DResources=!1,this.visible=!1,this.addedToTextureAtlas=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},ctt=class{constructor(e,r,i,s,n){this.labelClass=e,this.graphics3DSymbol=r,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},utt=class{constructor(e,r,i,s,n,o,a,l){this.layer=r,this.graphics3DCore=i,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new i_e(e,{pickable:!0,disableOctree:!0},r.uid)}destroy(){this.stageLayer.destroy()}},G_=class extends xe{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([ae(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),ae(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(ct.LABELER,this)]),this._textTextureAtlas=new x1({view:this.view}),this._hudMaterialCollection=new Tee(this.view._stage),this._calloutMaterialCollection=new Tee(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=Ke(this._textTextureAtlas),this._hudMaterialCollection=Ke(this._hudMaterialCollection),this._calloutMaterialCollection=Ke(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),eh.graphic=null,eh.renderingInfo=null,eh.layer=null}_activateLabelingContext(e){e.graphics.forEach((r,i)=>{const s=new See(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s),r.setVisibilityFlag(An.LABEL,uo.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((r,i)=>{r.setVisibilityFlag(An.LABEL,uo.USER,!1),this.setLabelGraphicVisibility(r,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i&&(this._textTextureAtlas.addTextTexture(i,r.stageObject),e.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i!=null&&(this._textTextureAtlas.removeTextTexture(i,r.stageObject),e.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),go.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const r of this._labelingContexts)if(r.active)if(XF(r))this._dirty=!0;else if(ZF(r.labelClassContexts)){if(r.labelClassContexts===null){this._deactivateLabelingContext(r);continue}this._createLabelClassContext(r),this._dirty=!0}else hc(r.labelsToInitialize,(i,s)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(s,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textInitialized||!i.visible&&i.hasGraphics3DResources)&&(r.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0);this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a;const r=(o=e.labelClassAbortController)==null?void 0:o.signal;e.layer.when&&await e.layer.when(),wt(r),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,s=i.layer,n=(a=s.labelingInfo)==null?void 0:a.filter(l=>!!l.symbol);!n||n.length===0||(await jL(n,async(l,c)=>{const u=l.symbol,d=TH(i.getOrCreateGraphics3DSymbol(u));if(d==null)return void ne.getLogger(this).error("Failed to create Graphics3DSymbol for label");await d.load(),wt(r);let p=null;gV(u)&&u.hasVisibleCallout()&&(p=Wje(u,i.symbolCreationContext),await p.load(),wt(r));const g=await mm(d0e(l,e.layer.fieldsIndex,this.view.spatialReference));if(wt(r),g.ok===!0){const y=await this._createTextRenderParameters(d.symbol);wt(r),e.labelClassContexts[c]=new ctt(l,d,p,y,g.value)}else ne.getLogger(this).error(`Label expression failed to evaluate: ${g.error}`)}),wt(r))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(r=>{if(Os(r))throw r;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const r=e.symbolLayers.at(0);return(r==null?void 0:r.type)!=="text"?null:bve.fromSymbol(r,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced;const r=e.labelClassAbortController;e.labelClassAbortController=new AbortController,Ml(r),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,r,i,s,n,o){const a=new _ve(i,xK(i.anchor),UXe(i.anchor),e.text,tr(e.displayWidth,e.displayHeight));return eh.graphic=r,eh.renderingInfo=null,eh.layer=s,n.createLabel(eh,a,this._hudMaterialCollection,this._textTextureAtlas,()=>{const l=vee(o);return l?l.elevationOffset:null})}_createLineCalloutGraphic(e,r,i,s,n){eh.graphic=e,eh.layer=n;const o=s.screenOffset[0];return eh.renderingInfo=new Hje(null,r,s.translation,s.centerOffset,o,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),i.createGraphics3DGraphic(eh)}_ensureGraphics3DResources(e){var c;if(e.hasGraphics3DResources)return!1;const r=e.graphics3DGraphic;if(r.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,s=i.labelClassContexts;if(ZF(s)||!i.emptySymbolLabelSupported&&r.layers.length===0)return!1;let n=!1;const o=r.graphic,a=i.layer,l=FO(i.layer);for(let u=0;u<s.length;u++){const d=e.textRenderers[u],p=e.textLabelPlacements[u];if(d==null||p==null)continue;const g=s[u],y=g.graphics3DSymbol,_=y.symbol&&y.symbol.type==="label-3d"?y.symbol:null,v=y.symbolLayers[0];if(!v)continue;v.setElevationInfoOverride(i.elevationInfoOverride);const w=new Qet(r,_,g.labelClass),x=this._createTextSymbolGraphic(d,o,p,a,v,w);if(x==null)return!1;x._labelClass=g.labelClass,x._labelIndex=u,r.addLabelGraphic(x,i.stageLayer),r.deconflictionPriority=((c=g.textRenderParameters)==null?void 0:c.definition.size)??0,r.setVisibilityFlag(An.LABEL,uo.USER,l),r.setVisibilityFlag(An.LABEL,uo.SCALE_RANGE,!0),r.setVisibilityFlag(An.LABEL,uo.DECONFLICTION,!1),n=!0;const T=g.graphics3DCalloutSymbolLayer;if(T&&p.hasLabelVerticalOffset){T.setElevationInfoOverride(i.elevationInfoOverride);const S=this._createLineCalloutGraphic(o,_,T,p,a);S!=null&&(g.calloutSymbolLayerIndex=r.labelLayers.length,r.addLabelGraphic(S,i.stageLayer))}break}return i.scaleVisibility&&n&&i.scaleVisibility.updateGraphicLabelScaleVisibility(r),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const r=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelLayers){if(i._labelClass==null)continue;const s=r[i._labelIndex].graphics3DSymbol.symbolLayers[0];s==null||s.onRemoveGraphic(i)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var n;if(e.textInitialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(ZF(i))return;const s=e.graphics3DGraphic.graphic;for(let o=0;o<i.length;o++){const a=i[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,(a==null?void 0:a.textRenderParameters)==null)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const x=l.needsHydrationToEvaluate()?LVe(s,r.layer):s;c=l.evaluate(x)}catch{c=null}else c=l.evaluate(s);if(c==null||c===""||/^\s+$/.test(c))continue;const u=a.graphics3DSymbol,d=((n=u.symbol)==null?void 0:n.type)==="label-3d"?u.symbol:null;if(!u.symbolLayers[0])continue;const p=e.graphics3DGraphic,g=a.labelClass,y=r.disablePlacement,_=vee({graphics3DGraphic:p,labelSymbol:d,labelClass:g,disablePlacement:y});if(_==null)continue;const v=xK(_.anchor),w=Q_e(v);e.textRenderers[o]=new Z_e(c,w,a.textRenderParameters,x1.maxSize),e.textLabelPlacements[o]=_}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,r){const i=r.graphic.uid;if(e.graphics.set(i,r),e.active){const s=new See(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,r){const i=r.graphic.uid,s=this._labels.get(i);e.graphics.delete(i),s&&(this._destroyGraphic(s,i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,r){this._labels.delete(r),e.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,r){if(!r)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of r){const s=e.graphics.get(i);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,r){for(const i of r.labelClassContexts){const s=new Map;r.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),i.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const r=FO(e.layer);r&&!e.active&&this._activateLabelingContext(e),!r&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((r,i)=>{const s=this._labels.get(i);s&&(this._destroyGraphic(s,i),s.visible=!1,e.labelsToInitialize.set(i,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const r of this._labelingContexts)if(r.graphics3DCore===e)return r;return null}addGraphicsOwner(e,r,i){const s=i&&i.emptySymbolLabelSupported||!1,n=(i==null?void 0:i.elevationInfoOverride)||null,o=(i==null?void 0:i.disablePlacement)||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new utt(this.view._stage,a,e,r,s,n,o,FO(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>FO(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const r=this._findLabelingContext(e);if(!r)return;const i=this._labelingContexts.indexOf(r);this._labelingContexts.splice(i,1),r.graphics.forEach(s=>this._removeGraphic(r,s)),r.destroy(),this.setDirty()}setLabelGraphicVisibility(e,r){const i=e.graphic.uid,s=this._labels.get(i);s&&s.visible!==r&&(r&&!s.addedToTextureAtlas?(this._addLabelTextureToAtlas(s),s.textInitialized||s.labelingContext.labelsToInitialize.set(i,s)):!r&&s.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(s),s.visible=r,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(r=>XF(r))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((r,i)=>r+(XF(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function XF(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function ZF(t){return!t||t.length===0}function FO(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(r=>!!r.symbol))}h([f({constructOnly:!0})],G_.prototype,"view",void 0),h([f({constructOnly:!0})],G_.prototype,"deconflictor",void 0),h([f()],G_.prototype,"_textTextureAtlas",void 0),h([f({type:Boolean,readOnly:!0})],G_.prototype,"updating",null),G_=h([k("esri.views.3d.layers.graphics.Labeler")],G_);const eh=new qje(null,null,null);let iE=class bw{constructor(e,r,i,s=null){this.lij=[0,0,0],this.extent=Gt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Ao.VISIBLE_ON_SURFACE,screenRect:Gt(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,r,i,s)}acquire(e,r,i,s){this.tilingScheme=s,this.id=bw.id(e,r,i),this.lij[0]=e,this.lij[1]=r,this.lij[2]=i,s.getExtent(e,r,i,this.extent),this.resolution=s.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const r=this.lij[0]+1,i=2*this.lij[1],s=2*this.lij[2];return e?(e[0].acquire(r,i,s,this.tilingScheme),e[1].acquire(r,i+1,s,this.tilingScheme),e[2].acquire(r,i,s+1,this.tilingScheme),e[3].acquire(r,i+1,s+1,this.tilingScheme),e):[new bw(r,i,s,this.tilingScheme),new bw(r,i+1,s,this.tilingScheme),new bw(r,i,s+1,this.tilingScheme),new bw(r,i+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,ym(e.measures.screenRect,this.measures.screenRect)}static id(e,r,i){return`${e}/${r}/${i}`}};var Ao;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Ao||(Ao={}));const xve=.5*Math.PI,htt=xve/Math.PI*180;let dtt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:E(),direction:E()};for(let r=0;r<4;r++)this._extent[r]={origin:E(),direction:E(),cap:{next:null,direction:E()}},this._planes[r]=wr();this._planes[ri.NEAR]=wr(),this._planes[ri.FAR]=wr(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,r,i,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,r,i),le(this._center.origin,n[0].origin,n[2].origin),ee(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||ee(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,Rm(a.cap.direction,a.origin,l.origin),UC(a.direction,a.cap.direction,a.origin,this._planes[o]),s||ee(a.direction,a.direction,-1)}UC(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[ri.NEAR]),s?b9(this._planes[ri.NEAR],this._planes[ri.FAR]):(ID(this._planes[ri.FAR],this._planes[ri.NEAR]),b9(this._planes[ri.NEAR],this._planes[ri.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*Mr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,r,i=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===$e.Global){const n=this._maxSpanSpatialReference.isGeographic?htt:xve*r;if(this._maxSpan>n)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const n=this._extent[0];return!(i||!e.intersectsRay($c(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!i&&e.intersectsRay($c(o.origin,o.direction))||e.intersectsLineSegment(O1(o.origin,o.cap.next,ftt),o.cap.direction))return!0}const s=i?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const o=e.lines[n];if(Y9e(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,r,i){D7(e,th),th[2]=i,Ol(r,th,JF,this._renderCoordsHelper.spatialReference),Ls(Eee,JF),ui(sl);for(const{x0:n,x1:o,y0:a,y1:l}of ptt)for(let c=0;c<5;c++){const u=c/4;th[0]=ft(e[n],e[o],u),th[1]=ft(e[a],e[l],u),th[2]=i,mo(th,r,th,this._renderCoordsHelper.spatialReference),De(th,th,Eee),rd(sl,th)}se(this._extent[0].origin,sl[0],sl[1],sl[2]),se(this._extent[1].origin,sl[3],sl[1],sl[2]),se(this._extent[2].origin,sl[3],sl[4],sl[2]),se(this._extent[3].origin,sl[0],sl[4],sl[2]);for(let n=0;n<4;++n)De(this._extent[n].origin,this._extent[n].origin,JF)}_toRenderBoundingExtentLocal(e,r,i){OD(e,r,gf,this._renderCoordsHelper.spatialReference),se(this._extent[0].origin,gf[0],gf[1],i),se(this._extent[1].origin,gf[2],gf[1],i),se(this._extent[2].origin,gf[2],gf[3],i),se(this._extent[3].origin,gf[0],gf[3],i)}_toRenderBoundingExtent(e,r,i){switch(this._renderCoordsHelper.viewingMode){case $e.Global:this._toRenderBoundingExtentGlobal(e,r,i);break;case $e.Local:this._toRenderBoundingExtentLocal(e,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(Wr(e.planes[ri.NEAR],this._center.origin)<0&&de(this._center.direction,e.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(Wr(e.planes[ri.NEAR],i.origin)<0&&de(i.direction,e.direction)<0)return!0}return!1}};const ptt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],th=E(),JF=ge(),Eee=ge(),sl=tn(),gf=Gt(),ftt=ud();let mtt=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new u0(e),this._extendedFrustum=new u0(e),this._intersector=new dtt({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>r,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return Ao.INVISIBLE;const r=this._renderCoordsHelper.viewingMode===$e.Global&&e.lij[0]>=gtt&&e.lij[0]<ytt,i=this._getOrCalculateSingleTileVisibility(e,!r);return i!==Ao.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(e):i}_shortenFrustumFarPlane(e){const r=u0.nearFarLineIndices,i=e.mutablePoints;for(const s of r){const[n,o]=s,a=i[n],l=i[o];ce(Hl,l,a),ee(Hl,Hl,vtt),le(i[o],a,Hl)}e.updatePoints(i)}_calculateAggregatedChildrenVisibility(e){let r=Ao.INVISIBLE;const i=this._cache.get(e.id);if(i!=null)return i;const s=Oee.acquire();e.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==Ao.INVISIBLE&&(r=o,o===Ao.VISIBLE_ON_SURFACE))break}return Oee.release(s),this._cache.set(e.id,r),r}_getOrCalculateSingleTileVisibility(e,r){const i=this._cache.get(e.id);if(i!=null)return i;const s=this._calculateSingleTileVisibility(e);return r&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===$e.Global&&e.lij[0]<_tt?this._calculateSingleTileVisibilitySided(e,!1)===Ao.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,r){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,r);const i=Mr(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,i)?this._intersector.isVisibleInFrustum(this._frustum,i,!0)?Ao.VISIBLE_ON_SURFACE:Ao.VISIBLE_WHEN_EXTENDED:Ao.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(e.eye,Hl);this._aboveGround||ko(r,r);const i=un(-de(r,e.viewForward));if(this._allTilesInvisible=i>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=i>e.fovY/2,!this._hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,Hl),a){case He.FAR_BOTTOM_LEFT:case He.FAR_TOP_LEFT:case He.NEAR_BOTTOM_LEFT:case He.NEAR_TOP_LEFT:w9(this._extendedFrustum.planes[ri.LEFT],Hl,Hl);break;case He.FAR_BOTTOM_RIGHT:case He.FAR_TOP_RIGHT:case He.NEAR_BOTTOM_RIGHT:case He.NEAR_TOP_RIGHT:w9(this._extendedFrustum.planes[ri.RIGHT],Hl,Hl)}ee(Hl,Hl,s.direction),this._renderCoordsHelper.intersectInfiniteManifold($c(l,Hl),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),$o(n[He.NEAR_BOTTOM_LEFT],n[He.NEAR_BOTTOM_RIGHT],n[He.NEAR_TOP_RIGHT],Aee),$o(n[He.NEAR_BOTTOM_RIGHT],n[He.NEAR_TOP_RIGHT],n[He.NEAR_TOP_LEFT],Ree),de(Aee,Ree)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[He.NEAR_BOTTOM_LEFT],o[He.NEAR_BOTTOM_RIGHT]]=[o[He.NEAR_BOTTOM_RIGHT],o[He.NEAR_BOTTOM_LEFT]]:[o[He.NEAR_TOP_LEFT],o[He.NEAR_TOP_RIGHT]]=[o[He.NEAR_TOP_RIGHT],o[He.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-Cee;return{zWithMargin:e,pointIndices:u0.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+Cee;return{zWithMargin:e,pointIndices:u0.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<e}}};const gtt=2,ytt=6,_tt=12,vtt=.95,Cee=1,Hl=E(),Aee=wr(),Ree=wr(),Oee=new Vo(Array,t=>{t.length!==4&&(t[0]=new iE,t[1]=new iE,t[2]=new iE,t[3]=new iE)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let btt=class{constructor(e){this._camera=new ot,this._focusOnMap=[0,0],this._screenRect=Gt(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new mtt(e.renderCoordsHelper)}begin(e,r,i){this._camera.copyFrom(e),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,I7(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=OAe(e.extent,this._focusOnMap),e.measures.visibility!==Ao.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const r=wtt,i=1<<r,s=e.measures.screenRect;Mu(s);let n=0;const o=e.lij[0]+r,a=e.lij[1]<<r,l=e.lij[2]<<r,c=this._tileSizeWithBias(e),u=c*c;for(let d=0;d<i;d++)for(let p=0;p<i;p++)if(n+=this._computeScreenArea(e,o,a+d,l+p,s),n>u)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===Ao.VISIBLE_WHEN_EXTENDED?this._tileSize*xtt:this._tileSize}_computeScreenArea(e,r,i,s,n){const o=e.measures.visibility===Ao.VISIBLE_WHEN_EXTENDED;this._projectToScreen(r,i,s,o,xg),Mu(QF);for(let a=0;a<4;a++)L7(QF,xg[a]);return M0(n,QF,n),_Z(xg[0],xg[1],xg[2])+_Z(xg[0],xg[2],xg[3])}_projectToScreen(e,r,i,s,n){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,r,i,UT),this._toRenderCoords(UT,0,3,Tg[0]),this._toRenderCoords(UT,2,3,Tg[1]),this._toRenderCoords(UT,2,1,Tg[2]),this._toRenderCoords(UT,0,1,Tg[3]),s&&(this._projectToPlane(Tg,this._camera.frustum[ri.NEAR]),this._projectToPlane(Tg,this._camera.frustum[ri.TOP]),this._projectToPlane(Tg,this._camera.frustum[ri.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(Tg[o],Pee),this._camera.renderToScreen(Pee,n[o])}_projectToPlane(e,r){for(let s=0;s<4;s++)BT[s]=Wr(r,e[s]);const i=Math.max(BT[0],BT[1],BT[2],BT[3]);if(i>0){const s=ee(kT,r,-i);for(let n=0;n<4;n++)le(e[n],e[n],s)}}_toRenderCoords(e,r,i,s){return kT[0]=e[r],kT[1]=e[i],kT[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(kT,this._tilingScheme.spatialReference,s),s}};const QF=Gt(),wtt=2,xtt=5,xg=[Vi(),Vi(),Vi(),Vi()],UT=Gt(),kT=E(),Tg=[E(),E(),E(),E()],BT=[0,0,0,0],Pee=po();function ZEt(t,e,r){if(t==null||r==null)return!1;let i=!0;return Gs[0]=t.xmin!=null?t.xmin:0,Gs[1]=t.ymin!=null?t.ymin:0,Gs[2]=t.zmin!=null?t.zmin:0,i=i&&Ni(Gs,t.spatialReference,0,e,r,0,1),Gs[0]=t.xmax!=null?t.xmax:0,Gs[1]=t.ymax!=null?t.ymax:0,Gs[2]=t.zmax!=null?t.zmax:0,i=i&&Ni(Gs,t.spatialReference,0,e,r,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),i}function Tve(t,e,r){if(t==null||r==null)return!1;let i=!0;return Gs[0]=t.xmin!=null?t.xmin:0,Gs[1]=t.ymin!=null?t.ymin:0,Gs[2]=t.zmin!=null?t.zmin:0,i=i&&Ni(Gs,t.spatialReference,0,Gs,r,0,1),e[0]=Gs[0],e[1]=Gs[1],Gs[0]=t.xmax!=null?t.xmax:0,Gs[1]=t.ymax!=null?t.ymax:0,Gs[2]=t.zmax!=null?t.zmax:0,i=i&&Ni(Gs,t.spatialReference,0,Gs,r,0,1),e[2]=Gs[0],e[3]=Gs[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),i}const Gs=E();let Vn=class extends xe{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void ne.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const r=this._get("filterExtent");if(r===e||r!=null&&e&&r.equals(e))return;const i=e!=null?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=Gt();return Tve(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new St,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new It}initialize(){this.addHandles([ae(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Fr),ae(()=>{var e,r,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(r=this.viewState)==null?void 0:r.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),Br)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(ct.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=di(this._frameWorker)}addClient(){const e=bc();return this._clients.add(e),this._clients.size===1&&this._setDirty(),Rr(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(fa))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=ct.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=ct.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new btt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(r=>new iE(r[0],r[1],r[2],e))}_purgeHorizonTiles(e){e.sort((r,i)=>{const s=r.measures.screenRect,n=i.measures.screenRect;return s[1]+s[3]-(n[1]+n[3])}),Mu(UO);for(let r=0;r<e.length;r++)if(M0(UO,e.data[r].measures.screenRect,UO),ja(UO)>Ttt)return e.data.slice(r,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:r}=this;for(;this._pendingTiles.length>0&&!e.done;){const i=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!aD(this._filterExtentRect,i.extent)||(this._tileMeasurements.updateTile(i),i.measures.visibility!==Ao.INVISIBLE&&(i.measures.shouldSplit?(r.ensureMaxLod(i.lij[0]+1),this._pendingTiles.push(...i.getChildren())):this._newTiles.push(i)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const r=e.filter(s=>{const n=this._idToTile.get(s.id);return n?(n.copyMeasurementsFrom(s),n.used=!0):this._idToTile.set(s.id,s),!n}),i=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(i),this.tiles.addMany(r),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,r)=>e.measures.visibility!==r.measures.visibility?e.measures.visibility===Ao.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-r.measures.distance),this.tiles.forEach((e,r)=>e.loadPriority=r)}};h([f({constructOnly:!0})],Vn.prototype,"scheduler",void 0),h([f({constructOnly:!0})],Vn.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],Vn.prototype,"tilingSchemeOwner",void 0),h([f({constructOnly:!0})],Vn.prototype,"cameraOnSurface",void 0),h([f({constructOnly:!0})],Vn.prototype,"focus",void 0),h([f({constructOnly:!0})],Vn.prototype,"viewState",void 0),h([f({constructOnly:!0})],Vn.prototype,"terrain",void 0),h([f()],Vn.prototype,"tiles",void 0),h([f()],Vn.prototype,"tileSize",void 0),h([f({readOnly:!0})],Vn.prototype,"tilingScheme",null),h([f()],Vn.prototype,"filterExtent",null),h([f({readOnly:!0})],Vn.prototype,"_filterExtentRect",null),h([f({readOnly:!0})],Vn.prototype,"_rootTileIds",null),h([f({value:!1})],Vn.prototype,"suspended",null),h([f({readOnly:!0})],Vn.prototype,"updating",null),Vn=h([k("esri.views.3d.layers.support.FeatureTileTree3D")],Vn);const UO=Gt(),Ttt=10;let Xi=class extends xe{constructor(){super(...arguments),this._propertiesPool=new xm({camera:ot},this),this._lastSeenCameraProjectionValues=new ot,this.mode=xr.ANIMATING,this._cssCamera=new ot,this._camera=new ot,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Ps,this.viewingMode=$e.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,r){this._set("viewingMode",e),this._set("spatialReference",r),this._set("constraints",new If({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new xm({camera:ot},this)}destroy(){var e;this.cameraController=null,(e=this._propertiesPool)==null||e.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===$e.Global){const e=Mr(this.spatialReference).radius;this.camera=new ot({eye:Te(4*e,0,0),center:Te(e,0,0),up:Te(0,0,1)})}else this.camera=new ot({eye:Te(0,0,100),center:Te(0,0,0),up:Te(0,1,0)})}get animation(){return this.cameraController instanceof JC&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get camera(){return this._camera}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:r,width:i,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(r/s),e.width=Math.round(i/s),e}set camera(e){e!==qc&&qc.copyFrom(e),qc.computeUp(this.viewingMode),this.events.emit("before-camera-change",qc);const r=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,qc)&&(this._lastSeenCameraProjectionValues.copyFrom(qc),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!r.equals(qc)&&(this._camera=this._propertiesPool.get("camera").copyFrom(qc),this._cameraChanged=!r.almostEquals(qc),this._cameraChanged)){const i=fne(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===xr.IDLE}get updating(){return this.mode!==xr.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===$e.Global}get isLocal(){return this.viewingMode===$e.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){var r;this.stopActiveCameraController()?((r=this.cameraController)==null||r.destroy(),e&&(this.removeHandles(Mee),this.addHandles($u(()=>e.state===Ui.Finished||e.state===Ui.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),Mee),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Ui.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Ui.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();qc.copyFrom(this._get("camera")),e(qc),this.camera=qc,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,r){return e.fov!==r.fov||e.fullViewport[0]!==r.fullViewport[0]||e.fullViewport[1]!==r.fullViewport[1]||e.fullViewport[2]!==r.fullViewport[2]||e.fullViewport[3]!==r.fullViewport[3]||e.padding[Yt.TOP]!==r.padding[Yt.TOP]||e.padding[Yt.RIGHT]!==r.padding[Yt.RIGHT]||e.padding[Yt.BOTTOM]!==r.padding[Yt.BOTTOM]||e.padding[Yt.LEFT]!==r.padding[Yt.LEFT]}};h([f()],Xi.prototype,"mode",void 0),h([f({readOnly:!0,type:Jx})],Xi.prototype,"animation",null),h([f({type:ot})],Xi.prototype,"camera",null),h([f({type:ot})],Xi.prototype,"cssCamera",null),h([f()],Xi.prototype,"_cssCamera",void 0),h([f()],Xi.prototype,"_camera",void 0),h([f({readOnly:!0})],Xi.prototype,"pixelRatio",null),h([f()],Xi.prototype,"rasterPixelRatio",void 0),h([f()],Xi.prototype,"contentPixelRatio",void 0),h([f({readOnly:!0})],Xi.prototype,"alignPixelEnabled",null),h([f({readOnly:!0})],Xi.prototype,"updating",null),h([f({})],Xi.prototype,"_contentCamera",void 0),h([f({type:ot})],Xi.prototype,"contentCamera",null),h([f({readOnly:!0})],Xi.prototype,"fixedContentCamera",null),h([f({readOnly:!0})],Xi.prototype,"constraints",void 0),h([f({readOnly:!0})],Xi.prototype,"events",void 0),h([f({readOnly:!0})],Xi.prototype,"isGlobal",null),h([f({readOnly:!0})],Xi.prototype,"isLocal",null),h([f({readOnly:!0})],Xi.prototype,"viewingMode",void 0),h([f({readOnly:!0})],Xi.prototype,"spatialReference",void 0),h([f()],Xi.prototype,"navigating",null),h([f()],Xi.prototype,"stationary",null),h([f()],Xi.prototype,"_cameraChanged",void 0),h([f()],Xi.prototype,"cameraController",null),Xi=h([k("esri.views.3d.state.ViewState")],Xi);const Stt=Xi,qc=new ot,Mee="ViewStateHandles";let Ett=class{constructor(e,r,i){this.viewingMode=e,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new It,this._tolerance=Yx,this._tmpRay=ln(),this._tmpRegion=Gt(),this._validateHUDIntersector=Du(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,r,i){return this.intersectRay(this._getPickRay(e,this._tmpRay),$ee(this.viewingMode),r,i)}intersectScreenFreePointFallback(e,r,i){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),r,i)}intersectRayFreePointFallback(e,r,i){return this.intersectRay(e,$ee(this.viewingMode),r,i)||this._intersectRayFreePointLocal(e,r)}intersectRay(e,r,i,s){return r.options.selectionMode=!1,r.options.store=Xn.MIN,this.computeIntersection(e,r,s),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,r,i=.5,s=.5){return e.getRenderCenter(zO,i,s),zO[0]+=.0466,zO[1]-=.0123,tj(e,zO,r)}intersectIntersectorScreen(e,r,i){this.computeIntersection(this._getPickRay(e,this._tmpRay),r,i)}intersectToolIntersectorScreen(e,r,i){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,r,i)}intersectToolIntersectorRay(e,r,i){r.options.selectionMode=!0,this.computeIntersection(e,r,i);const s=r.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||hd(s)&&s.intersector!==Mi.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(e,r,i))}setTolerance(e=Yx){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((r,i)=>r.type===Mi.TERRAIN?1:i.type===Mi.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===Mi.TERRAIN?1:i.type===Mi.TERRAIN?-1:0)}_getPickRay(e,r){const i=this._view.state.camera;return ej(i,e,r)}_intersectRayFreePointLocal(e,r){return this.viewingMode!==$e.Local||e==null||le(r,e.origin,pe(Le.get(),e.direction)),!1}intersectElevationFromScreen(e,r,i=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),r,i,s)}_intersectElevation(e,r,i=0,s=null){if(e==null)return null;const n=r!=null?r.mode:"absolute-height",o=(r==null?void 0:r.offset)??0,a=n!=="on-the-ground"?o+i:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,BO)){const x=this._view.computeMapPointFromVec3d(BO);return x.z??(x.z=0),x.z-=o,x}return null}const c=this._view.state.camera,u=Le.get();c.projectToRenderScreen(e.origin,u);const d=new Iee(null,this._forEachLayer),p=this._view.slicePlane,g=p!=null?BY(p):null,y=Du(this.viewingMode);y.options.store=Xn.MIN,y.options.verticalOffset=l;const _=e.origin,v=le(Le.get(),_,e.direction);y.reset(_,v,c),y.point=u;const w=s?"type"in s&&s.type==="graphics"?x=>x.layerUid!==s.uid:x=>x.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const x=T=>(!w||w(T))&&!!T.lastValidElevationBB;y.intersect(d.layers,u,this._tolerance,null,x),this._externalIntersectionHandlers.forAll(T=>{if(T.type===Mi.I3S||T.type===Mi.TERRAIN){const S=T.slicePlaneEnabled?g:null;T.intersect(y,S,y.rayBegin,y.rayEnd,u)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(x=>{if(x.isGround){const T=x.slicePlaneEnabled?g:null;x.intersect(y,T,y.rayBegin,y.rayEnd,u)}})}if(y.results.min.getIntersectionPoint(BO)){const x=this._view.computeMapPointFromVec3d(BO);return x.z=i,x}return null}computeIntersection(e,r,i){var y;if(e==null)return;const s=this._view.state.camera,n=Le.get();s.projectToRenderScreen(e.origin,n);const o=new Iee(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const a=e.origin,l=le(Le.get(),e.origin,e.direction);r.reset(a,l,s),r.intersect(o.layers,n,this._tolerance);const c=this._view.slicePlane,u=c!=null?BY(c):null;r.intersect(o.sliceableLayers,n,this._tolerance,u);const d=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(_=>{const v=_.layerUid,w=Array.isArray(v),x=w?v:[v];w&&(r.options.filteredLayerUids=[]);let T=!1;for(const S of x)o.filterLayerUid(S)?T=!0:w&&r.options.filteredLayerUids.push(S);if(r.options.isFiltered=!T,_.isGround&&d||!r.options.isFiltered){const S=_.slicePlaneEnabled?u:null;_.intersect(r,S,a,l,n)}});const p=Le.get(),g=this._view.basemapTerrain;if(i&&i.enableDraped&&g.spatialReference!=null&&r.results.ground.getIntersectionPoint(p)){const _=g.overlayManager.renderer,v=this._view.renderCoordsHelper.spatialReference,w=Le.get();this._view.renderCoordsHelper.fromRenderCoords(p,w,g.spatialReference),w[2]=((y=this._view.elevationProvider)==null?void 0:y.getElevation(p[0],p[1],p[2],v,"ground"))??0,_.intersect(r,w,r.results.ground,x=>o.filterRenderGeometry(x))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(e){const r=e.results.hud;ym(this._tmpRegion,j8);const i=this._view.state.camera,s=[],n=this._tmpRegion,o=w=>{const x=new Att(w);i.projectToRenderScreen(w.target.center,x.screenPoint),x.screenPoint[0]=Math.floor(x.screenPoint[0]),x.screenPoint[1]=Math.floor(x.screenPoint[1]),s.push(x),L7(n,x.screenPoint)};e.sortResults(r.all),r.min.dist!=null&&o(r.min);for(const w of r.all)r.min.target.object!==w.target.object&&r.max.target.object!==w.target.object&&o(w);if(r.max.dist!=null&&r.max.target.object!==r.min.target.object&&o(r.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,n[0]-sE),u=Math.max(0,n[1]-sE),d=Math.min(Lo(n)+2*sE,a-c),p=Math.min(ja(n)+2*sE,l-u),g=new Uint8Array(d*p*4);this._view._stage.renderer.readHUDVisibility(c,u,d,p,g);let y=!0;const _=e.results.max.dist==null;let v=0;for(const w of s)for(const x of Ctt)if(g[4*(Math.min(w.screenPoint[0]+x[0],a)-n[0]+(Math.min(w.screenPoint[1]+x[1],l)-n[1])*d)]){y&&(e.results.min.copy(w.result),y=!1),_&&e.results.max.copy(w.result),e.options.store===Xn.ALL&&e.results.all.splice(v++,0,w.result);break}}};const sE=1,Ctt=(()=>{const t=[],e=sE;for(let r=-e;r<=e;r++)for(let i=-e;i<=e;i++)t.push([i+e,r+e]);return t})();let Att=class{constructor(e){this.result=e,this.screenPoint=po()}},kO;function $ee(t){return kO&&kO.viewingMode===t||(kO=Du(t)),kO}let Iee=class{constructor(e,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,r(i=>{i.pickable&&this.filterLayerUid(i.apiLayerUid)&&(i.sliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(e){const{include:r,exclude:i}=this;return e==null?r==null&&i==null:(r==null||r.has(e))&&(i==null||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function Lee(t){return typeof t=="object"&&"intersect"in t}const BO=E(),zO=po();let rCt=class{constructor(e,r){this.spatialReference=e,this._view=r}getElevation(e,r,i){return this._view.elevationProvider.getElevation(e,r,0,this.spatialReference,i)}async queryElevation(e,r,i,s,n){return this._view.elevationProvider.queryElevation(e,r,0,this.spatialReference,n,i,s)}},Rtt=class{constructor(e,r,i,s){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(ct.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(fa);else for(const r of this._queries)r.result.reject(ur())}queryElevation(e,r,i,s=0){const n=Go(),o={x:e,y:r,minDemResolution:s,result:n,signal:i};return this._queries.push(o),Uo(i,()=>{Fz(this._queries,o),n.reject(ur())}),n.promise}get running(){return this._queries.length>0}runTask(e){const r=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return r.forEach(u=>u.result.reject()),void e.madeProgress();const s=r.map(u=>[u.x,u.y]),n=r.reduce((u,d)=>Math.min(u,d.minDemResolution),1/0),o=new S2({points:s,spatialReference:this.spatialReference}),a=r.length>1&&r.some(u=>!!u.signal)?new AbortController:null,l=a!=null?a.signal:r[0].signal;if(a!=null){let u=0;r.forEach(d=>Uo(d.signal,()=>{u++,d.result.reject(ur()),u===r.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};i.queryElevation(o,c).then(u=>{r.forEach((d,p)=>{d.signal!=null&&d.signal.aborted?d.result.reject(ur()):d.result.resolve(u.geometry.points[p][2])})}).catch(u=>{r.forEach(d=>d.result.reject(u))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(fa)}}},nE=class extends Ps.EventedMixin(xe){get spatialReference(){var e,r;return(r=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:r.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=Oe(this._elevationQueryCached)}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,r,i,s,n){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&r===a.y&&i===a.z&&hs(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=VO(o,this._im,e,r,i,s,n),o==null&&(o=VO(o,this._ground,e,r,i,s,n)),n==="scene"&&(o=VO(o,this._scene,e,r,i,s,n)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:r,z:i,spatialReference:s,queryContext:n,result:o}),o}getSphereElevationBounds(e,r){let i=1/0,s=-1/0;for(const n of[this._im,this._ground,this._scene])n.forEach(o=>{if(o.getSphereElevationBounds){const a=o.getSphereElevationBounds(e,r);a!=null&&(i=Math.min(i,a.min),s=Math.max(s,a.max))}});return{min:i,max:s}}getRootElevationBounds(){let e=1/0,r=-1/0;for(const i of[this._im,this._ground,this._scene])i.forEach(s=>{if(s.getRootElevationBounds){const n=s.getRootElevationBounds();n!=null&&(e=Math.min(e,n.min),r=Math.max(r,n.max))}});return{min:e,max:r}}async queryElevation(e,r,i,s,n,o=null,a=0){const l=this._getElevationQuery(s);try{const c=await l.queryElevation(e,r,o,a);return n==="scene"?VO(c,this._scene,e,r,i,s,n):c}catch(c){return ly(c),this.getElevation(e,r,i,s,n)}}register(e,r){this.addHandles(r.on("elevation-change",i=>this.emit("elevation-change",i)),r),this._providersFromContext(e).push(r)}unregister(e){this.removeHandles(e);for(const r of[this._im,this._ground,this._scene]){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){const r=this._elevationQueryCached;if(r!=null&&hs(e,r.spatialReference))return r;r==null||r.destroy({completeTasks:!0});const{wkid:i,wkt:s,wkt2:n,latestWkid:o}=e,a=new Rtt(this.view.resourceController.scheduler,new at({wkid:i,wkt:s,wkt2:n,latestWkid:o}),()=>{var l;return(l=this.view.map)==null?void 0:l.ground},{maximumAutoTileRequests:4});return this._elevationQueryCached=a,a}};function VO(t,e,r,i,s,n,o){for(const a of e){const l=a.getElevation(r,i,s,n,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}h([f({constructOnly:!0})],nE.prototype,"view",void 0),h([f()],nE.prototype,"spatialReference",null),nE=h([k("esri.views.3d.support.CombinedElevationProvider")],nE);let u3=class tz{static isValidProfile(e){return e in tz.profiles}static getDefaultProfile(){return te("esri-iPhone")?"low":"medium"}static apply(e,r){const i=tz.profiles[e];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxNumberOfDrawCalls=i.graphics3D.maxNumberOfDrawCalls,r.graphics3D.maxTotalNumberOfVertices=i.graphics3D.maxTotalNumberOfVertices,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods,r.graphics3D.uncompressedTextureDownsamplingEnabled=i.graphics3D.uncompressedTextureDownsamplingEnabled;const s=r.sceneService.object,n=i.sceneService.object;s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration,r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.vtlContentZoom=i.tiledSurface.vtlContentZoom,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=i.fadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.highResolutionAtmosphere=i.highResolutionAtmosphere,r.reflections=i.reflections,r.ambientOcclusion=i.ambientOcclusion,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumPixelRatio=i.maximumPixelRatio}};u3.test={reset(){const t=Sve();for(const e of Object.keys(t))u3.profiles[e]=t[e]}};const zT={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function Sve(){const t=!!te("esri-mobile"),e=!!te("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,reduceTileLevelDifferences:!0,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+zT.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!te("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600+zT.GalaxyS20:750+zT.FullHD,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!te("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900+zT.SurfacePro7:1500+zT.FullHDRetina,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}(function(t){t.profiles=Sve()})(u3||(u3={}));const BM=u3,Eve=new qe([0,255,255]),Cve=1,Ave=.25,Rve=new qe([0,0,0]),Ove=.4,Pve=.2;let tp=class extends xe{constructor(){super(...arguments),this.color=Eve.clone(),this.haloColor=null,this.haloOpacity=Cve,this.fillOpacity=Ave,this.shadowOpacity=Ove,this.shadowColor=Rve.clone(),this.shadowDifference=Pve}};h([f({type:qe})],tp.prototype,"color",void 0),h([f({type:qe})],tp.prototype,"haloColor",void 0),h([f()],tp.prototype,"haloOpacity",void 0),h([f()],tp.prototype,"fillOpacity",void 0),h([f()],tp.prototype,"shadowOpacity",void 0),h([f({type:qe})],tp.prototype,"shadowColor",void 0),h([f()],tp.prototype,"shadowDifference",void 0),tp=h([k("esri.views.3d.support.HighlightOptions")],tp);const Mve=tp;function Ott(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function $ve(t){return typeof t=="string"?Wn(t):ye(t)}function Ptt(t,e,r){const i={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){i[s]=[];for(let o=0;o<n.length;o++)i[s][o]=Ptt(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(r==null?void 0:r[s]);i[s]=e?o:JSON.stringify(o)}else i[s]=e?n:JSON.stringify(n);else i[s]=n}return i}function Mtt(t){return{geometryType:M3(t[0]),geometries:t.map(e=>e.toJSON())}}function Ive(t,e,r){const i=GAe(e);return t.map(s=>{const n=i.fromJSON(s);return n.spatialReference=r,n})}let j_=class extends st{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),r=this.geometries[0],i={};return i.outSR=E$(this.outSpatialReference),i.inSR=E$(r.spatialReference),i.geometries=JSON.stringify({geometryType:M3(r),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};h([f()],j_.prototype,"geometries",void 0),h([f({json:{read:{source:"outSR"}}})],j_.prototype,"outSpatialReference",void 0),h([f()],j_.prototype,"transformation",void 0),h([f()],j_.prototype,"transformForward",void 0),j_=h([k("esri.rest.support.ProjectParameters")],j_);const CH=j_,$tt=ya(CH);async function Lve(t,e,r){e=$tt(e);const i=$ve(t),s={...i.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=M3(e.geometries[0]),a=Ott(s,r);return Hi(i.path+"/project",a).then(({data:{geometries:l}})=>Ive(l,o,n))}async function AH(t=null,e){var s,n;if(kr.geometryServiceUrl)return kr.geometryServiceUrl;if(!t)throw new X("internal:geometry-service-url-not-configured");let r;r="portal"in t?t.portal||Au.getDefault():t,await r.load({signal:e});const i=(n=(s=r.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!i)throw new X("internal:geometry-service-url-not-configured");return i}async function Itt(t,e,r=null,i){const s=await AH(r,i),n=new CH;n.geometries=[t],n.outSpatialReference=e;const o=await Lve(s,n,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new X("internal:geometry-service-projection-failed")}const Ltt=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:AH,projectGeometry:Itt},Symbol.toStringTag,{value:"Module"}));let Dtt=class{constructor(e,r){this.spatialReference=r,this.unitInMeters=qo(this.spatialReference,Mr(this.spatialReference).metersPerDegree);const i=e&&"portalItem"in e?e.portalItem:void 0;this._geometryServiceURLPromise=AH(i).catch(()=>{throw new X("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const r=await this._geometryServiceURLPromise;let i,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?i=e:(i=[e],s=!1);const n=i.map(l=>l instanceof nt?l:new nt(l,this.spatialReference)),o=new CH({geometries:n,outSpatialReference:at.WGS84}),a=(await Lve(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}},tc=class extends xe{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};h([f()],tc.prototype,"minTotalNumberOfFeatures",void 0),h([f()],tc.prototype,"maxTotalNumberOfFeatures",void 0),h([f()],tc.prototype,"maxNumberOfDrawCalls",void 0),h([f()],tc.prototype,"maxTotalNumberOfVertices",void 0),h([f()],tc.prototype,"snapshotAvailable",void 0),h([f()],tc.prototype,"polygonLodFactor",void 0),h([f()],tc.prototype,"polylineLodFactor",void 0),h([f()],tc.prototype,"skipHighSymbolLods",void 0),h([f()],tc.prototype,"uncompressedTextureDownsamplingEnabled",void 0),tc=h([k("esri.views.3d.support.QualitySettings.Graphics3DSettings")],tc);let $p=class extends xe{constructor(){super(...arguments),this.lodFactor=1}};h([f()],$p.prototype,"lodFactor",void 0),$p=h([k("esri.views.3d.support.QualitySettings.LoDFactorSettings")],$p);let nL=class extends $p{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};nL=h([k("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],nL);let Vf=class extends xe{constructor(){super(...arguments),this.object=new nL,this.point=new $p,this.integratedMesh=new $p,this.pointCloud=new $p,this.uncompressedTextureDownsamplingEnabled=!1}};h([f({type:nL})],Vf.prototype,"object",void 0),h([f({type:$p})],Vf.prototype,"point",void 0),h([f({type:$p})],Vf.prototype,"integratedMesh",void 0),h([f({type:$p})],Vf.prototype,"pointCloud",void 0),h([f()],Vf.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Vf=h([k("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Vf);let Gf=class extends xe{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};h([f()],Gf.prototype,"lodBias",void 0),h([f()],Gf.prototype,"angledSplitBias",void 0),h([f()],Gf.prototype,"vtlContentZoom",void 0),h([f()],Gf.prototype,"reduceTileLevelDifferences",void 0),h([f()],Gf.prototype,"textureFadeDuration",void 0),Gf=h([k("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Gf);let qw=class extends xe{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};h([f()],qw.prototype,"pixelRatio",void 0),h([f()],qw.prototype,"maxTotalNumberOfFeatures",void 0),qw=h([k("esri.views.3d.support.QualitySettings.HeatmapSettings")],qw);let so=class extends xe{constructor(){super(...arguments),this.graphics3D=new tc,this.sceneService=new Vf,this.tiledSurface=new Gf,this.heatmap=new qw,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};h([f({type:tc})],so.prototype,"graphics3D",void 0),h([f({type:Vf})],so.prototype,"sceneService",void 0),h([f({type:Gf})],so.prototype,"tiledSurface",void 0),h([f({type:qw})],so.prototype,"heatmap",void 0),h([f()],so.prototype,"fadeDuration",void 0),h([f()],so.prototype,"antialiasingEnabled",void 0),h([f()],so.prototype,"physicallyBasedRenderingEnabled",void 0),h([f()],so.prototype,"highQualityTransparency",void 0),h([f()],so.prototype,"highResolutionAtmosphere",void 0),h([f()],so.prototype,"reflections",void 0),h([f()],so.prototype,"ambientOcclusion",void 0),h([f()],so.prototype,"memoryLimit",void 0),h([f()],so.prototype,"additionalCacheMemory",void 0),h([f()],so.prototype,"frameRate",void 0),h([f()],so.prototype,"maximumPixelRatio",void 0),so=h([k("esri.views.3d.support.QualitySettings.QualitySettings")],so);const Dee=so;function Ntt(t){return y2(t)&&t.length>=3}function Ftt(t){return(_2(t)||Array.isArray(t))&&t.length>=3}function Utt(t){return Ntt(t)||Ftt(t)}let ktt=class rz{constructor(e,r,i,s){this.viewingMode=e,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=s,this._tmpCoordinateSystem=vLe(s)}set extent(e){e&&bLe(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return RLe(this._coordinateSystem,e)}setAltitude(e,r,i=e){return Rhe(this._coordinateSystem,i,r,e)}setAltitudeOfTransformation(e,r){OLe(this._coordinateSystem,r,e,r)}worldUpAtPosition(e,r){return SLe(this._coordinateSystem,e,r)}worldBasisAtPosition(e,r,i){return ELe(this._coordinateSystem,e,r,i)}basisMatrixAtPosition(e,r){const i=this.worldBasisAtPosition(e,ki.X,Le.get()),s=this.worldBasisAtPosition(e,ki.Y,Le.get()),n=this.worldBasisAtPosition(e,ki.Z,Le.get());return Xp(r,i[0],i[1],i[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),r}headingAtPosition(e,r){const i=this.worldUpAtPosition(e,Le.get()),s=this.worldBasisAtPosition(e,ki.Y,Le.get()),n=she(r,s,i);return _a(n)}intersectManifoldClosestSilhouette(e,r,i){return D4(this._coordinateSystem,r,this._tmpCoordinateSystem),ALe(this._tmpCoordinateSystem,e,i),i}intersectManifold(e,r,i){D4(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=Le.get();return CLe(this._tmpCoordinateSystem,e,s)?ie(i,s):null}intersectInfiniteManifold(e,r,i){if(this.viewingMode===$e.Global)return this.intersectManifold(e,r,i);D4(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=Le.get();return Cv(s.plane,e,n)?ie(i,n):null}toRenderCoords(e,r,i){return uI(e)?Ll(e,r,this.spatialReference):mo(e,r,i,this.spatialReference)}fromRenderCoords(e,r,i=null){return uI(r)?(i!=null&&(r.spatialReference=i),a1e(e,this.spatialReference,r)):Utt(r)?mo(e,this.spatialReference,r,i)?r:null:bm(e,this.spatialReference,r)}static create(e,r){switch(e){case $e.Local:return new rz($e.Local,r,qo(r),TLe());case $e.Global:return new rz($e.Global,r,1,xLe(r))}}static renderUnitScaleFactor(e,r){return S8(e)/S8(r)}};var yp;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(yp||(yp={}));const Btt=(()=>{const t=new Array;return t[yp.ELEVATION]=10,t[yp.BASEMAP]=10,t[yp.I3S_INDEX]=10,t[yp.I3S_DATA]=10,t[yp.SYMBOLOGY]=5,t})(),ztt=30;function Dve(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function Vtt(t){return new ia({view:t})}const Nee=.1,GO=1,KF=1,Gtt=.75,jtt=.6,Fee=1.3;let ia=class extends xe{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new Qpe,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles(B1({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(GO),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,r){return new D6e(e,this._cacheStorage,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<jtt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(GO);else if(e)(this._memoryPredicted>1.1*KF||this._usedMemory>KF)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>Nee&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/Fee),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>KF)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/Fee),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<Gtt&&this._quality<GO){this._stableQuality=this._quality;const r=.05;e=this._updateQuality(this._quality+r)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,Nee),GO))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){var o,a,l,c,u;if(!this.view)return;(a=(o=this.view._stage)==null?void 0:o.renderer)==null||a.tick();let e=(((l=this.view.basemapTerrain)==null?void 0:l.usedMemory)??0)+(((u=(c=this.view._stage)==null?void 0:c.renderer)==null?void 0:u.usedMemory)??0),r=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(d=>{if(Dve(d)){const p=d.ignoresMemoryFactor?this._quality:1;e+=d.usedMemory*p,r+=d.unloadedMemory*p}});const i=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&i){this._warnMemoryUsage=e;const d=g=>(g/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",p=Math.round(100*this._quality);ne.getLogger(this).warn(`Memory Limit exceeded! Limit: ${d(s)} Current: ${d(e)} Projected: ${d(e+r)} Quality: ${p}%`)}this._usedMemory=e/s,this._memoryPredicted=(e+r)/s;const n=s-e;this._cacheStorage.maxSize=Math.max(0,n+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const r=e._numQualityChanges;return e._numQualityChanges=0,r}}}};h([f({constructOnly:!0})],ia.prototype,"view",void 0),h([f()],ia.prototype,"maxMemory",null),h([f()],ia.prototype,"additionalCacheMemory",null),h([f({readOnly:!0})],ia.prototype,"memoryFactor",null),h([f({readOnly:!0})],ia.prototype,"updating",null),h([f({readOnly:!0})],ia.prototype,"usedMemory",null),h([f({readOnly:!0})],ia.prototype,"usedCacheMemory",null),h([f()],ia.prototype,"_quality",void 0),h([f()],ia.prototype,"_usedMemory",void 0),h([f()],ia.prototype,"_updating",void 0),h([f()],ia.prototype,"_stableQuality",void 0),h([f()],ia.prototype,"_maxMemory",void 0),h([f()],ia.prototype,"_additionalCacheMemory",void 0),ia=h([k("esri.views.3d.support.MemoryController")],ia);let Htt=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},qtt=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new Wtt}},Wtt=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},Ytt=class{constructor(e,r,i,s){this._workerFunc=e,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=s.map(n=>new qtt(n))}destroy(){this._clients.length=0}hasQuota(e){const r=this._clients[e];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(e){const r=this._clients[e.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(i,s)=>this._taskCallback(i,s))):r.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const r=this._clients[e.client];this._totalNumWorkers--,r&&(r.numWorkers--,r.statistics.requests++,r.statistics.size+=e.size||0,r.statistics.duration+=e.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,Je(r.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,r){e._cancelled||(this._callbackFunc(e,r),this._taskFinished(e))}getStatsForType(e){const r=this._clients[e];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const e=this;return{set workerFunc(r){e._workerFunc=r}}}},zM=class extends xe{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,r,i){this._loadQueue=new Ytt((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,r),i&&(this._frameTask=i.registerTask(ct.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=di(this._frameTask),this._tasks.forEach(e=>Ml(e.abortController)),this._loadQueue=Oe(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,r,i,s={}){const n=Go();n.__signal=s!=null?s.signal:null;const o=this._createOrUpdateTask(e,r,i,s,n);return Uo(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,r,i,s,n,o){const a=new Qtt(e,r,i,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,r){var i;gC(e.resolvers,r),r.reject(ur()),e.resolvers.length===0&&(e.status===su.DOWNLOADING&&(e.status=su.CANCELLED,this._loadQueue.cancel(e),(i=e.abortController)==null||i.abort(),e.request=null,e.abortController=null),e.status=su.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,r){e.resolvers.push(r)}_createOrUpdateTask(e,r,i,s,n){const o=Ktt((s==null?void 0:s.uid)||e,r,i),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,r,i,o,n)}_doneLoadingCB(e,r){this._loadQueue&&(Je(e.status===su.DOWNLOADING),e.status=su.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:r}):this._doneLoading(e,r))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const r=this._onLoadQueue.shift();wt(r.task.abortController),r.task.abortController=null,r.callback(r.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const r=this._doneQueue.shift();r.task.status!==su.DOWNLOADED&&(r.err=r.err||ur()),this._doneLoading(r.task,r.err),e.madeProgress()}}_doneLoading(e,r){if(r&&!Os(r)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(r)Os(r)?s.reject(r):s.reject(new X("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${r}`,{url:e.url,error:r}));else{--i;const n=i>0?ye(e.result):e.result;s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,r){if(e.status===su.CANCELLED)return!1;let i,s;switch(e.startTime=performance.now(),e.status=su.DOWNLOADING,e.docType){case"binary":s="array-buffer",i=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=Hi(e.url,{...e.options,responseType:s,timeout:i,signal:n});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:r,task:e}):(e.abortController=null,r(e))},l=c=>{e.status===su.DOWNLOADING&&r(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const u=c.data,d=Ztt(u);if(s="image",e.size=u.byteLength,d==="unknown")return e.request=Hi(e.url,{responseType:s,timeout:i,signal:n}),void e.request.then(y=>a(y.data),l);const p=new Blob([u],{type:d}),g=window.URL.createObjectURL(p);o=()=>window.URL.revokeObjectURL(g),e.request=Hi(g,{responseType:s,timeout:i,signal:n}),e.request.then(y=>a(new RH(y.data,d,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};h([f({readOnly:!0})],zM.prototype,"updating",void 0),zM=h([k("esri.views.3d.support.StreamDataLoader")],zM);const Xtt={numRetries:0};function Ztt(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let RH=class{constructor(e,r,i){this.image=e,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}};function Jtt(t){return"image"in t&&"type"in t}let Qtt=class extends Htt{constructor(e,r,i,s,n){super(s),this.url=e,this.options=r,this.docType=i,this.key=n,this.result=null,this.status=su.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Xtt.numRetries}};function Ktt(t,e,r){return`${t}:${e}:${r}`}var su;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(su||(su={}));let VM=class extends xe{constructor(){super(...arguments),this.updating=!1}};function ert(t){return new gh({view:t})}h([f({readOnly:!0})],VM.prototype,"updating",void 0),VM=h([k("esri.views.3d.support.ResourceControllerMain")],VM);let gh=class extends VM{constructor(){super(...arguments),this._immediateTask=Kx,this._normalTask=Kx,this._updatingObjects=Zx([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=uUe(),this._memoryController=Vtt(this.view),this._streamDataLoader=new zM,this._streamDataLoader.setup(ztt,Btt,this._scheduler),this.addHandles([ae(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},Fr),ae(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=B1({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(ct.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(ct.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=di(this._frameTask),this._streamDataLoader=Oe(this._streamDataLoader),this._memoryController=Oe(this._memoryController),this._scheduler=Oe(this._scheduler),this.view=null}get updating(){var e,r,i,s;return!!((e=this._memoryController)!=null&&e.updating||(r=this._streamDataLoader)!=null&&r.updating||(i=this._immediateTask)!=null&&i.updating)||((s=this._updatingObjects)==null?void 0:s.value.some(n=>n.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const r=this._streamDataLoader;return{request:(i,s,n)=>r.request(i,s,e,n),get busy(){return!r.hasDownloadSlots(e)}}}addUpdatingObject(e){const r=this._updatingObjects;return r.value=[...r.value,e],Rr(()=>{r.value=r.value.filter(i=>i!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(jz(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.updateBudget(e)&&this._scheduler.frame())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};h([f()],gh.prototype,"view",void 0),h([f()],gh.prototype,"_scheduler",void 0),h([f()],gh.prototype,"_memoryController",void 0),h([f()],gh.prototype,"_streamDataLoader",void 0),h([f()],gh.prototype,"_immediateTask",void 0),h([f()],gh.prototype,"_normalTask",void 0),h([f()],gh.prototype,"_updatingObjects",void 0),h([f({readOnly:!0})],gh.prototype,"updating",null),gh=h([k("esri.views.3d.support.ResourceControllerImpl")],gh);function trt(t){return Dve(t)}function rrt(t){return"performanceInfo"in t}var Po,tt;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(Po||(Po={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(tt||(tt={}));const $b=E(),irt=E(),yf=E(),_f=E();function srt(t,e,r=0){const i=t.extent;if(i==null)return!1;if(r===0)return $ae(i,e);const s=Math.min(i[2]-i[0],i[3]-i[1]);return RAe(i,e,r*s)}function jO(t,e,r,i){ie($b,r),$b[i]=e[i];const s=ce($b,$b,e),n=ce(irt,t,e),o=de(n,s),a=de(s,s);let l;l=o<=0?e:a<=o?r:le($b,e,ee(s,s,o/a));const c=ce($b,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function nrt(t,e,r){const i=t.extent;if(i==null)return 0;yf[0]=i[0],yf[1]=i[1],yf[2]=r,_f[0]=i[2],_f[1]=i[3],_f[2]=r;let s=1/0,n=1/0;return e[0]<yf[0]?s=jO(e,yf,_f,0):e[0]>_f[0]&&(s=jO(e,_f,yf,0)),e[1]<yf[1]?n=jO(e,yf,_f,1):e[1]>_f[1]&&(n=jO(e,_f,yf,1)),Math.min(s,n)}function ort(t,e,r){if(t==null)return uG();if(t.spatialReference.isGeographic&&!Y0(t.spatialReference))return new X("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=wl.checkUnsupported(t);if(i!=null)return i;if(r==null)return new X("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=art(t,r);if(s)return s;const n=t.spatialReference;return e==null||n.equals(e)||e.isWGS84&&n.isWebMercator?null:new X("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function art(t,e){const r=t.lods,i=r[0].resolution*2**r[0].level,s=[i*t.size[0],i*t.size[1]],n=[t.origin.x,t.origin.y],o=Mae(e),a=Gt();wl.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>Fw){const c=r[0].scale*2**r[0].level;let u=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/i;const d=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**d)*10**d,new X("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:l,allowedNumRootTiles:Fw})}return null}const lrt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:ort,isInsideExtent:srt,tiltToExtentEdge:nrt},Symbol.toStringTag,{value:"Module"}));function crt(){return!0}function urt(){return 0}function hrt(t,e){if(t==null)return uG();const r=t.lods.length-1,i=t.spatialReference,s=Y0(i)||Wp(i)||Yp(i);if(i.isWebMercator){if(!wl.makeWebMercatorAuxiliarySphere(r).compatibleWith(t))return new X("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new X("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!wl.makeGCSWithTileSize(t.spatialReference,t.size[0],r).compatibleWith(t))return t.spatialReference.isWGS84?new X("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new X("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?void 0:new X("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const drt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:hrt,isInsideExtent:crt,tiltToExtentEdge:urt},Symbol.toStringTag,{value:"Module"})),prt={[$e.Global]:drt,[$e.Local]:lrt};function up(t,e){t||console.warn("Terrain: "+e)}let Ks=!1,oL=!1;function frt(t){oL=t,Ks=Ks||t}function mrt(t){Ks=t}function be(t,e){var r;if(Ks&&!t){const i=(r=new Error().stack)==null?void 0:r.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function iz(t){return zN(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function aL(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function zN(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function OH(t){return(t==null?void 0:t.type)==="tile-3d"}function p2(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function Nve(t){return(t==null?void 0:t.type)==="wmts-3d"}function sz(t){return(t==null?void 0:t.type)==="elevation-3d"}function VT(t){return(t==null?void 0:t.type)==="group"}function h3(t){return t&&(OH(t)||Nve(t)||zN(t)||p2(t))}function nz(t){return t&&(OH(t)||zN(t)||p2(t)||Nve(t))}function d3(t){return nz(t)||sz(t)}function grt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="raster-tile"}function yrt(t){return Fve(t==null?void 0:t.sourceLayerInfo)||!!(t!=null&&t.isVTLBackground)}function _rt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="tile-texture"}function vrt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e instanceof HTMLImageElement||e instanceof RH||e instanceof HTMLCanvasElement||e instanceof ImageData}function Fve(t){return(t==null?void 0:t.data)!=null&&"type"in t.data&&t.data.type==="vector-tile"}function _x(t){return t!=null&&"release"in t&&t.release(),null}function Uee(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function PH(t,e,r,i){return prt[i].checkIfTileInfoSupportedForViewSR(t,r,e)}function VN(t,e,r){let i=null,s=null;if((t==null?void 0:t.type)==="wmts"){const n=brt(t,e,r);i=n.tileInfo,s=n.fullExtent}else{s=aL(t)?t.getCompatibleFullExtent(e):t.fullExtent;const n=r===$e.Local;if(aL(t))i=t.getCompatibleTileInfo(e,s,n);else if((t==null?void 0:t.type)==="vector-tile"){const o=n&&!wrt(e)||xrt.force512VTL,a=t.tileInfo.spatialReference.isGeographic;i=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=t.tileInfo}return i!=null&&s!=null&&PH(i,s,e,r)==null?{tileInfo:i,fullExtent:s}:null}function brt(t,e,r){const i=wCe(t);if(i!=null){if(!St.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const s=i.find(n=>PH(n.tileInfo,n.fullExtent,e,r)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function wrt(t){return t.isWGS84||t.isWebMercator||doe(t)||!SC(t)}const xrt={force512VTL:!1};function kee(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function vf(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function yu(t,e,r=Ert){return Math.abs(t-e)<r}function lL(t){return t===tt.NORTH_EAST?tt.SOUTH_WEST:t===tt.NORTH_WEST?tt.SOUTH_EAST:t===tt.SOUTH_WEST?tt.NORTH_EAST:tt.NORTH_WEST}function MH(t){return t===tt.NORTH?tt.SOUTH:t===tt.EAST?tt.WEST:t===tt.SOUTH?tt.NORTH:tt.EAST}function Trt(t){return t===tt.NORTH_WEST||t===tt.SOUTH_WEST}function Srt(t){return t===tt.NORTH_WEST||t===tt.NORTH_EAST}function Bee(t){return t===tt.NORTH_WEST||t===tt.WEST||t===tt.SOUTH_WEST}function zee(t){return t===tt.NORTH_EAST||t===tt.EAST||t===tt.SOUTH_EAST}function Vee(t){return t===tt.SOUTH_EAST||t===tt.SOUTH||t===tt.SOUTH_WEST}function Gee(t){return t===tt.NORTH_EAST||t===tt.NORTH||t===tt.NORTH_WEST}const em=[tt.NORTH,tt.EAST,tt.SOUTH,tt.WEST],cL=[tt.NORTH_EAST,tt.SOUTH_EAST,tt.SOUTH_WEST,tt.NORTH_WEST],Ert=1e-5;let Crt=class{constructor(e,r){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=d3(e)?r.basemapTerrain.getUsedMemoryForLayerView(e):e.usedMemory,rrt(e)){const i=e.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}},Art=class{constructor(e){var r,i,s,n,o,a,l;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const c=e.resourceController.memoryController;this.totalMemory=(c.maxMemory??0)*K$.MEGABYTES,this.usedMemory=Math.round(c.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=c.usedCacheMemory}this.terrainMemory=((r=e.basemapTerrain)==null?void 0:r.usedMemory)??0,this.edgesMemory=((n=(s=(i=e==null?void 0:e._stage)==null?void 0:i.renderer)==null?void 0:s.edgeView)==null?void 0:n.usedMemory)??0,this.fboMemory=((l=(a=(o=e==null?void 0:e._stage)==null?void 0:o.renderer)==null?void 0:a.memoryInfo)==null?void 0:l.fbos)??0,e.allLayerViews.items.forEach(c=>{(trt(c)||d3(c))&&this.layerPerformanceInfos.push(new Crt(c,e))}),this.layerPerformanceInfos.sort((c,u)=>u.memory-c.memory)}},Rrt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,r,i){const s=i?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return n!=null?Promise.resolve(n):this._loadOnce(this._gltfLoading,this._gltfMemCache,s,o=>I1e(new M1e(o.streamDataRequester),e,o,i),r)}loadWOSR(e,r){const i=`wosr:${e}:${r.disableTextures}`,s=this._wosrMemCache.get(i);return s!=null?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,n=>L1e(e,n),r)}async _loadOnce(e,r,i,s,n){wt(n);const o=Uo(n,()=>this._abortLoad(e,i));let a=e.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:s({...n,signal:l.signal})},e.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),e.delete(i),wt(n),l}finally{di(o)}}_abortLoad(e,r){const i=e.get(r);i!=null&&--i.refCount>0||(e.delete(r),i!=null&&i.abortController.abort())}},Ww=class extends xe{constructor(e,r){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(r==null?void 0:r.registerTask(ct.TEXTURE_UNLOAD))??Kx}normalizeCtorArgs(){return{}}destroy(){var e,r,i;super.destroy(),(e=this._frameTask)==null||e.remove(),(r=this._textureRequests)==null||r.forEach(s=>this._releaseTextureRequest(s)),(i=this._textureRequests)==null||i.clear()}get updating(){return this._frameTask.updating}fromData(e,r){const i=this.makeUid(e);let s=this._textureRequests.get(i);if(!s){const n=new Uve;n.texture=r(),this._stage&&(n.texture.load(this._stage.renderView.renderingContext),this._stage.add(n.texture)),this._textureRequests.set(i,n),s=n}return s.referenceCount++,{uid:i,texture:s.texture,release:()=>this._release(i)}}_release(e){const r=this._textureRequests.get(e);r?(r.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),r.referenceCount--,r.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){var i;if(!this._textureRequests)return;const r=this._textureRequests.get(e);!r||r.referenceCount>0||((i=r.texture)==null||i.unload(),this._releaseTextureRequest(r),this._textureRequests.delete(e))}_releaseTextureRequest(e){var r;e.texture?(r=this._stage)==null||r.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,r=null){return r!=null?`${e}.${r}px`:e}};h([f()],Ww.prototype,"_frameTask",void 0),h([f()],Ww.prototype,"updating",null),Ww=h([k("esri.views.3d.support.TextureCollection")],Ww);let Uve=class{constructor(){this.referenceCount=0}},Ort=class extends Ww{constructor(e,r,i){super(r,i),this._streamDataRequester=e}async fromUrl(e,r,i){wt(i);const s=i!=null?i.signal:null,n=this.makeUid(e,r);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o=new Uve,o.abortController=a;const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async u=>{const d=this._createTexture(e,u,r);return c.texture=d,c.abortController=null,await d.load(this._stage.renderView.renderingContext),this._stage.add(d),{uid:n,texture:d,release:()=>this._release(n)}},u=>{throw c.abortController=null,u})}o.referenceCount++;try{return await F2e(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,r,i){var n;const s={width:r.width,height:r.height,wrap:{s:Ft.CLAMP_TO_EDGE,t:Ft.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(jne(e)){if(i||r.width===0&&r.height===0){const o=r.width?r.height/r.width:1;i=i||64,o>1?(r.width=Math.round(i/o),r.height=i):(r.width=i,r.height=Math.round(i*o))}(n=this._stage.renderView)!=null&&n.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new Nv(r,s)}},Prt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(yp.SYMBOLOGY),this.objectResourceCache=new Rrt((i,s)=>e.resourceController.memoryController.newCache(i,s)),this.textures=new Ort(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const r=Mr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=vge(e.viewingMode,r),this.screenSizePerspectiveSettingsLabels=g7e(e.viewingMode,r)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return Rr();this._graphicsOwners.push(e);const r=ae(()=>{var i;return(i=e.layer)==null?void 0:i.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Rr(()=>{r.remove(),gC(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(r=>{var i;return((i=r.layer)==null?void 0:i.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Am;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([ae(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,Fr),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Oe(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;HO.distance=e.centerOnSurfaceInfrequent.distance,HO.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(HO),this.screenSizePerspectiveSettingsLabels.update(HO),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const HO={distance:0,fovY:0};let ww=class{constructor(e,r,i=""){this.graphics=e,this._symbol=new _0({symbolLayers:new St([new y0({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new Ev({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})])})}show(e,r){if(r==null)return;this.hide();const i=new nt({x:e[0],y:e[1],z:e[2],spatialReference:r});this._graphic=new iv({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},h0=class extends xe{constructor(e){super(e)}};h([f({constructOnly:!0})],h0.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],h0.prototype,"surface",void 0),h([f({constructOnly:!0})],h0.prototype,"state",void 0),h0=h([k("esri.views.3d.support.PointOfInterest")],h0);const Mrt=Array;let yh=class extends h0{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new xm({location:nt,renderLocation:Mrt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=E(),this._tmpPoint=new nt}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(Bo(()=>{var r,i;return(i=(r=this.map)==null?void 0:r.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Oe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,r=hi(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return nv(i,r,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){var s;if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!((s=this.map)!=null&&s.ground))return this._updateSurfaceAltitude(0),go.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const r=(this._tmpPoint.z??0)>$rt&&this.renderCoordsHelper.viewingMode===$e.Global&&(e.isWGS84||e.isWebMercator);let i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:r?Irt:0}).then(n=>this._updateSurfaceAltitude(n.geometry.z??0)).catch(n=>{Os(n)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,go.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(e6,this._estimatedSurfaceAltitude,this._camera.eye),ho(this._get("renderLocation"),e6)||(this._set("renderLocation",ie(this._propertiesPool.get("renderLocation"),e6)),this.notifyChange("renderLocation"))}};h([f({constructOnly:!0})],yh.prototype,"scheduler",void 0),h([f({constructOnly:!0})],yh.prototype,"cache",void 0),h([f({constructOnly:!0})],yh.prototype,"task",void 0),h([f({readOnly:!0})],yh.prototype,"location",null),h([f({constructOnly:!0})],yh.prototype,"map",void 0),h([f({readOnly:!0})],yh.prototype,"renderLocation",void 0),h([f({readOnly:!0})],yh.prototype,"scale",null),h([f({readOnly:!0})],yh.prototype,"updating",null),yh=h([k("esri.views.3d.support.CameraOnSurface")],yh);const e6=E(),$rt=1e5,Irt=1e6,Lrt=Array;let nu=class extends h0{constructor(e){super(e),this._propertiesPool=new xm({location:nt,renderLocation:Lrt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=E(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=di(this._frameWorker),this._propertiesPool=Oe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,go.YIELD}_updateRenderLocation(){const e=Nrt;let r=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!r&&i&&(r=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),r&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=Frt;r&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(ie(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),r?this.distance=hi(this._camera.eye,e):(ee(e,this._camera.viewForward,this._get("distance")),le(e,e,this._camera.eye)),ho(this._get("renderLocation"),e)||this._set("renderLocation",ie(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,r){var s,n;const i=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(i.ray,e,r))return!1;if(this.state.isGlobal){const o=Mr(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=co(i.eye),c=l<a*a,u=hi(i.eye,r);if(c&&u>o/4){const d=a-Math.sqrt(l);return ee(r,i.viewForward,d),le(r,r,i.eye),!0}}else{const o=(s=this.surface)!=null&&s.ready?this.surface.extent:null;o!=null&&OD(o,(n=this.surface)==null?void 0:n.spatialReference,GT,this.renderCoordsHelper.spatialReference)&&(r[0]=me(r[0],GT[0],GT[2]),r[1]=me(r[1],GT[1],GT[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,r){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,r)){if(Zr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,s=hi(i,e),n=hi(i,r);if(Math.abs(n-s)/s>Drt)return!0}return!1}};h([f({constructOnly:!0})],nu.prototype,"scheduler",void 0),h([f({constructOnly:!0})],nu.prototype,"task",void 0),h([f()],nu.prototype,"distance",void 0),h([f({constructOnly:!0})],nu.prototype,"estimateSurfaceAltitudeAtCenter",void 0),h([f({readOnly:!0})],nu.prototype,"location",null),h([f({readOnly:!0})],nu.prototype,"renderLocation",void 0),h([f()],nu.prototype,"updating",void 0),nu=h([k("esri.views.3d.support.CenterOnSurface")],nu);const Drt=.05,Nrt=E(),Frt=E(),GT=Gt();let Urt=class{constructor(e){this._handles=new Am,this.events=new Ps,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Oe(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),e.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",krt)}};const krt={},Brt=Array;let rp=class extends h0{constructor(e){super(e),this._propertiesPool=new xm({location:nt,renderLocation:Brt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([ae(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),ae(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(ct.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Oe(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),r=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(r,jee);const n=Math.max(0,(Math.acos(de(jee,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!Y1(e,r)){const c=this._propertiesPool.get("renderLocation");ie(c,r),this._set("renderLocation",c)}return go.YIELD}const o=1-me(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(Hee);const l=this._propertiesPool.get("renderLocation");return $r(l,r,Hee,a),e&&Y1(e,l)||this._set("renderLocation",l),go.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const r=this.state.contentCamera,i=r.getRenderCenter(po());if(i[1]=r.aboveGround?r.padding[Yt.BOTTOM]:r.fullHeight-r.padding[Yt.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(r.unprojectFromRenderScreen(i,jT)){ce(jT,jT,r.eye);const n=pe(jT,jT);if(this.renderCoordsHelper.intersectInfiniteManifold($c(r.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,r.eye)}updateRenderLocation(){this._dirty=!0}};h([f()],rp.prototype,"_dirty",void 0),h([f({constructOnly:!0})],rp.prototype,"scheduler",void 0),h([f({constructOnly:!0})],rp.prototype,"centerOnSurface",void 0),h([f({constructOnly:!0})],rp.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),h([f({readOnly:!0})],rp.prototype,"updating",null),h([f({readOnly:!0})],rp.prototype,"location",null),h([f({readOnly:!0})],rp.prototype,"renderLocation",void 0),rp=h([k("esri.views.3d.support.pointsOfInterest.Focus")],rp);const jee=E(),jT=E(),Hee=E();let Df=class extends xe{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=E();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([ae(()=>{var e,r;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(r=this.surfaceView)==null?void 0:r.extent]},()=>this._update()),Bo(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}_update(){var i;if(this._updateController&&(this._updateController.abort(),this._updateController=null),((i=this.surfaceView)==null?void 0:i.extent)==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=D7(this.surfaceView.extent),r=new nt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(r,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(s=>{this._updateController=null,this._set("location",s.geometry)}).catch(s=>{Os(s)||s&&s.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",s)})):this._set("location",r)}};h([f({constructOnly:!0})],Df.prototype,"view",void 0),h([f({constructOnly:!0})],Df.prototype,"cache",void 0),h([f()],Df.prototype,"surface",null),h([f()],Df.prototype,"surfaceView",null),h([f({readOnly:!0})],Df.prototype,"location",void 0),h([f({readOnly:!0})],Df.prototype,"renderLocation",null),Df=h([k("esri.views.3d.terrain.StableSurfaceCenter")],Df);let Nf=class extends xe{constructor(e){super(e),this._tileGeometryUpdateExtent=Mu(),this._tileGeometryUpdateSpatialReference=null,this.events=new Ps,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(ct.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",zrt),Mu(this._tileGeometryUpdateExtent),this._set("updating",!1)),go.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,M0(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let r=1;r<this.centerOnSurfaces.length;r++){const i=this.centerOnSurfaces[r];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,r){const i=this.state.contentCamera.eye,s=Vrt,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,i_,r),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,s_,r),i_[0]<s_[0]?(s[0]=i_[0],s[2]=s_[0]):(s[0]=s_[0],s[2]=i_[0]),i_[1]<s_[1]?(s[1]=i_[1],s[3]=s_[1]):(s[1]=s_[1],s[3]=i_[1]),aD(s,e)}};h([f({constructOnly:!0})],Nf.prototype,"state",void 0),h([f({constructOnly:!0})],Nf.prototype,"centerOnSurfaces",void 0),h([f({constructOnly:!0})],Nf.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],Nf.prototype,"scheduler",void 0),h([f({constructOnly:!0})],Nf.prototype,"surface",void 0),h([f({readOnly:!0})],Nf.prototype,"updating",void 0),Nf=h([k("esri.views.3d.support.SurfaceGeometryUpdates")],Nf);const zrt={},i_=E(),s_=E(),Vrt=Mu();let Na=class extends xe{constructor(e){super(e),this._handles=new Am,this._tmpRay=ln(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new xm({renderPointOfView:Grt},this),this.renderPointOfView=E(),this._pois=new Array,this._debugCenters=new Map}initialize(){var u;const{state:e,basemapTerrain:r,renderCoordsHelper:i,map:s}=this.view;this._surfaceIntersector=Du(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Xn.MIN,this._contentIntersector=Du(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(u=this.view.basemapTerrain)==null?void 0:u.elevationQueryCache,l={state:e,scheduler:o,surface:r,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new nu({...l,task:ct.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new nu({...l,task:ct.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new nu({...l,task:ct.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new yh({...l,cache:a,task:ct.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new Nf({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new Urt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new Df({cache:a,view:this.view})),this._set("focus",new rp({state:e,scheduler:o,surface:r,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(d,p)=>this._estimateSurfaceIntersectionAtRenderPoint(d,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new ww(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new ww(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new ww(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new ww(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new ww(c,"green","Focus")),this._handles.add([ae(()=>e.contentCamera,d=>this._cameraChanged(d),Fr),ae(()=>r.extent,()=>this._updateCenterPointsOfInterest()),$u(()=>!r.updating,()=>this._updateCenterPointsOfInterest(),Fr),Bo(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Bo(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),$u(()=>Zr.SHOW_POI,d=>this._setDebug(d),zr)]),this._cameraChanged(this.view.state.contentCamera);for(const d of this._pois)d.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(r=>r.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,Ib,Hrt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Ib):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const r=e.origin,i=le(Ib,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,r,i),this._surfaceIntersector.results.min.getIntersectionPoint(Ib)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Ib)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,r,i){const s=tj(r,e,jrt);if(s==null)return null;const n=s.origin,o=le(Ib,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,r),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const r=e.eye;ho(this.renderPointOfView,r)||this._set("renderPointOfView",ie(this._propertiesPool.get("renderPointOfView"),r))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(r=>r.hide()),void this._handles.remove("debug");for(const r of this._pois)this._handles.add(ae(()=>r.renderLocation,i=>{var s;return(s=this._debugCenters.get(r))==null?void 0:s.show(i,r.renderCoordsHelper.spatialReference)},zr),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};h([f({readOnly:!0})],Na.prototype,"centerOnContent",void 0),h([f({readOnly:!0})],Na.prototype,"centerOnSurfaceFrequent",void 0),h([f({readOnly:!0})],Na.prototype,"centerOnSurfaceInfrequent",void 0),h([f({readOnly:!0})],Na.prototype,"cameraOnSurface",void 0),h([f({readOnly:!0})],Na.prototype,"focus",void 0),h([f({readOnly:!0})],Na.prototype,"renderPointOfView",void 0),h([f({readOnly:!0})],Na.prototype,"surfaceOrigin",void 0),h([f({readOnly:!0})],Na.prototype,"contentGeometryUpdates",void 0),h([f({readOnly:!0})],Na.prototype,"surfaceGeometryUpdates",void 0),h([f({constructOnly:!0})],Na.prototype,"view",void 0),h([f({readOnly:!0})],Na.prototype,"updating",null),Na=h([k("esri.views.3d.support.PointsOfInterest")],Na);const Grt=Array,Ib=E(),jrt=ln(),Hrt={exclude:new Set([l0])},qrt=(t=>t)(["operational-layers","basemap","ground"]),A0=new St,cC=new WeakMap;function Wrt(t){Xrt(t)&&A0.push(new WeakRef(t))}function Yrt(t){const e=A0.find(r=>r.deref()===t);e&&A0.remove(e)}function Xrt(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function kve(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:kve(e,t%e):0}let t6=0,qO=0;function Zrt(){const t=Date.now();let e=!1;for(const r of A0){const i=r.deref();i?i.refreshInterval&&t-(cC.get(i)??0)+5>=6e4*i.refreshInterval&&(cC.set(i,t),i.refresh(t)):e=!0}if(e)for(let r=A0.length-1;r>=0;r--)A0.at(r).deref()||A0.removeAt(r)}hne(()=>{const t=Date.now();let e=0;for(const r of A0){const i=r.deref();i&&(e=kve(Math.round(6e4*i.refreshInterval),e),i.refreshInterval?cC.get(i)||cC.set(i,t):cC.delete(i))}if(e!==qO){if(qO=e,clearInterval(t6),qO===0)return void(t6=0);t6=setInterval(Zrt,qO)}});function Jrt(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const qee=.1,VCt=t=>{let e=class extends t{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=sne(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||Wrt(this)},()=>{})}destroy(){Yrt(this)}castRefreshInterval(r){return r>=qee?r:r<=0?0:qee}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){yC(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{ne.getLogger(this).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}get test(){const r=this;return{set refreshInterval(i){r._set("refreshInterval",i)}}}};return h([f({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:qrt}}}}})],e.prototype,"refreshInterval",void 0),h([zi("refreshInterval")],e.prototype,"castRefreshInterval",null),h([f({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),h([f({readOnly:!0})],e.prototype,"refreshParameters",null),e=h([k("esri.layers.mixins.RefreshableLayer")],e),e};let Qrt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,r){this._store.put(e,r,r.values.byteLength+256)}},Krt=class{constructor(e,r,i,s){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=r,this.height=i,this.noDataValue=s)}get hasNoDataValues(){if(this._hasNoDataValues==null){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(this._minValue!=null)return;const{noDataValue:e,values:r}=this;let i=1/0,s=-1/0,n=!0;for(const o of r)o===e?this._hasNoDataValues=!0:(i=o<i?o:i,s=o>s?o:s,n=!1);n?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=s>-3e38?s:0)}},Bve=class{constructor(e,r,i,s,n={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=V$e(e,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>ne.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,r){const i={removed:!1,eventName:e,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),Rr(()=>{i.removed=!0,Fz(this._listeners,i),this._thread&&i.threadHandle!=null&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,r){return this.invokeMethod(this._mainMethod,e,r)}invokeMethod(e,r,i){if(this._thread){const s=this._transferLists[e],n=s?s(r):[];return this._thread.invoke(e,r,{transferList:n,signal:i})}return this._promise?this._promise.then(()=>(wt(i),this.invokeMethod(e,r,i))):Promise.reject(null)}broadcast(e,r){return this._thread?Promise.all(this._thread.broadcast(r,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,r)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(r=>{e.removed||(e.threadHandle=r)})}},Wee=class extends Bve{constructor(e=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,r,i){return e&&e.byteLength!==0?this.invoke({buffer:e,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(uC.forEach((e,r)=>{e===this&&uC.delete(r)}),this.destroy())}};const uC=new Map;function eit(t=null){let e=uC.get(t);return e||(t!=null?(e=new Wee(r=>t.immediate.schedule(r)),uC.set(t,e)):(e=new Wee,uC.set(null,e))),++e.ref,e}var vl,Yee,Xee;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(vl||(vl={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(Yee||(Yee={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(Xee||(Xee={}));let tit=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},YCt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function ZCt(t,e,r,i,s,n){const o=r-s;if(o>=0)return(e>>o)+(i-(n<<o))*(t>>o);const a=-o;return e-(n-(i<<a))*(t>>a)<<a}let JCt=class{constructor(e,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][s]||null}getCellSpan(e,r,i,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function rit(t,e,r,i,s,n){const o=e[i++];for(let a=0;a<o;a++){const l=new tit(n);l.xTile=e[i++],l.yTile=e[i++],l.hash=e[i++],l.priority=e[i++];const c=e[i++];for(let p=0;p<c;p++){const g=e[i++],y=e[i++],_=e[i++],v=e[i++],w=!!e[i++],x=e[i++],T=r[i++],S=r[i++],C=e[i++],A=e[i++];l.colliders.push({xTile:g,yTile:y,dxPixels:_,dyPixels:v,hard:w,partIndex:x,width:C,height:A,minLod:T,maxLod:S})}const u=t[i++];for(let p=0;p<u;p++)l.textVertexRanges.push([t[i++],t[i++]]);const d=t[i++];for(let p=0;p<d;p++)l.iconVertexRanges.push([t[i++],t[i++]]);s.push(l)}return i}function KCt(t,e,r){for(const[i,s]of t.symbols)iit(t,e,r,s,i)}function iit(t,e,r,i,s){const n=t.layerData.get(s);if(n.type===vl.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],u=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const p=r?Math.floor(127*u)|d<<7:d?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.iconVertexRanges)for(let d=c;d<c+u;d+=4)n.iconOpacity[d/4]=l;if(o.selectedForRendering){const c=a.parts[1],u=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const p=r?Math.floor(127*u)|d<<7:d?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.textVertexRanges)for(let d=c;d<c+u;d+=4)n.textOpacity[d/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}let GN=class{constructor(e,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let i=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[i++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},sit=class extends GN{constructor(e,r){super(e,r),this.type=vl.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=i[s++],this.lineIndexCount=i[s++];const n=i[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=i[s++],l=i[s++],c=i[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){var e,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.vao)==null?void 0:r.usedMemory)??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=Ke(this.vao)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Cr.createVertex(e,yr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Cr.createIndex(e,yr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const u=this.layer.lineMaterial;this.vao=new Fu(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}},nit=class extends GN{constructor(e,r){super(e,r),this.type=vl.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=i[s++],this.fillIndexCount=i[s++],this.outlineIndexStart=i[s++],this.outlineIndexCount=i[s++];const n=i[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=i[s++],l=i[s++],c=i[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){var e,r,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.fillVAO)==null?void 0:r.usedMemory)??0)+(((i=this.outlineVAO)==null?void 0:i.usedMemory)??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=Ke(this.fillVAO),this.outlineVAO=Ke(this.outlineVAO)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Cr.createVertex(e,yr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Cr.createIndex(e,yr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const u=s[i++],d=Cr.createVertex(e,yr.STATIC_DRAW,new Int32Array(n.buffer,4*i,u));i+=u;const p=s[i++],g=Cr.createIndex(e,yr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,p));i+=p;const y=this.layer,_=y.fillMaterial,v=y.outlineMaterial;this.fillVAO=new Fu(e,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new Fu(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:d},g)}},oit=class extends GN{constructor(e,r,i){super(e,r),this.type=vl.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let p=0;p<l;p++){const g=s[a++],y=s[a++],_=s[a++];this.iconPerPageElementsMap.set(g,[y,_])}const c=s[a++];for(let p=0;p<c;p++){const g=s[a++],y=s[a++],_=s[a++];this.glyphPerPageElementsMap.set(g,[y,_])}const u=s[a++],d=s[a++];this.iconOpacity=new Int32Array(u),this.textOpacity=new Int32Array(d),a=rit(s,n,o,a,this.symbols,i),this.bufferDataOffset=a}get memoryUsed(){var e,r,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.iconVAO)==null?void 0:r.usedMemory)??0)+(((i=this.textVAO)==null?void 0:i.usedMemory)??0)+F0(this.iconOpacity)+F0(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[r,i]of this.iconPerPageElementsMap)e+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){this.iconVAO=Ke(this.iconVAO),this.textVAO=Ke(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,r=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===r.byteLength&&r.setSubData(e,0,0,e.length);const i=this.textOpacity,s=this.textVAO.vertexBuffers.opacity;i.length>0&&i.byteLength===s.byteLength&&s.setSubData(i,0,0,i.length)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Cr.createVertex(e,yr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Cr.createIndex(e,yr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const u=s[i++],d=Cr.createVertex(e,yr.STATIC_DRAW,new Int32Array(n.buffer,4*i,u));i+=u;const p=s[i++],g=Cr.createIndex(e,yr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,p));i+=p;const y=Cr.createVertex(e,yr.STATIC_DRAW,this.iconOpacity.buffer),_=Cr.createVertex(e,yr.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,w=v.iconMaterial,x=v.textMaterial;this.iconVAO=new Fu(e,w.getAttributeLocations(),w.getLayoutInfo(),{geometry:a,opacity:y},c),this.textVAO=new Fu(e,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:d,opacity:_},g)}},ait=class extends GN{constructor(e,r){super(e,r),this.type=vl.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=i[s++],this.circleIndexCount=i[s++],this.bufferDataOffset=s}get memoryUsed(){var e,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.vao)==null?void 0:r.usedMemory)??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=Ke(this.vao)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Cr.createVertex(e,yr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Cr.createIndex(e,yr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const u=this.layer.circleMaterial;this.vao=new Fu(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}};const n3t=!0,o3t=32,Zee=200,lit=1/te("mapview-transitions-duration");let cit=class extends Ps{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var i;if(this._stage===e)return;const r=this._stage;this._stage=e,e?(i=this._stage)!=null&&i.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r==null||r.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Go(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Go(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,r;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(r=this._fadeOutResolver)==null||r.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,r){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===i)this.computedVisible=this.visible;else{const n=e*lit;this.computedOpacity=s>i?Math.max(i,s-n):Math.min(i,s+n),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},gv=class H_{static getId(e,r,i,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${r}/${i}/${s}`}constructor(e,r,i,s){this.set(e,r,i,s)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|e<<8|i}acquire(e,r,i,s){this.set(e,r,i,s)}contains(e){const r=e.level-this.level;return r>=0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new H_(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,r,i,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+r,this.col=+i,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new H_(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,r=this.row<<1,i=this.col<<1,s=this.world;return[new H_(e,r,i,s),new H_(e,r,i+1,s),new H_(e,r+1,i,s),new H_(e,r+1,i+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};gv.pool=new Vo(gv,null,null,25,50);let zve=class extends cit{constructor(e,r,i,s,n,o,a=n,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new gv(e),this.resolution=r,this.x=i,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const r=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;WV(i,o,0,0,0,a,0,s,n,1),qx(this.transforms.dvs,e.displayViewMat3,i)}},r6=class Vve extends zve{constructor(e,r,i,s,n,o,a,l=null){super(e,r,i,s,n,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<Zee}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<Zee)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){var i;let r=!1;for(const s of e){const n=this.layerData.get(s);n&&(this._memoryUsedByLayerData-=n.memoryUsed,n.type===vl.SYMBOL&&this.symbols.delete(s)&&(r=!0),n.destroy(),this.layerData.delete(s))}(i=this._memCache)==null||i.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){this.status!=="unloaded"&&(Gve.delete(this),Vve._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsed(){return this._memoryUsedByLayerData+256}changeDataImpl(e){var i;let r=!1;if(e){const{bucketsWithData:s,emptyBuckets:n}=e,o=this._createRenderBuckets(s);if(n&&n.byteLength>0){const a=new Uint32Array(n);for(const l of a)this._deleteLayerData(l)}for(const[a,l]of o)this._deleteLayerData(a),l.type===vl.SYMBOL&&(this.symbols.set(a,l.symbols),r=!0),this._memoryUsedByLayerData+=l.memoryUsed,this.layerData.set(a,l);(i=this._memCache)==null||i.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const[s,n]of this.layerData)n.type===vl.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const r=this.resolution/(e.resolution*e.pixelRatio),i=this.width/this.rangeX*r,s=this.height/this.rangeY*r,n=[0,0];e.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;YV(o),aI(o,o,n),XV(o,o,Math.PI*e.rotation/180),ZV(o,o,[i,s,1])}_createTransforms(){return{dvs:zo(),tileMat3:zo(),tileUnitsToPixels:zo()}}static _destroyRenderBuckets(e){if(!e)return;const r=new Set;for(const i of e.values())r.has(i)||(i.destroy(),r.add(i));e.clear()}_createRenderBuckets(e){const r=new Map,i=new Map;for(const s of e){const n=this._deserializeBucket(s,i);for(const o of n.layerUIDs)r.set(o,n)}return r}_deserializeBucket(e,r){let i=r.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case vl.FILL:i=new nit(e,this.styleRepository);break;case vl.LINE:i=new sit(e,this.styleRepository);break;case vl.SYMBOL:i=new oit(e,this.styleRepository,this);break;case vl.CIRCLE:i=new ait(e,this.styleRepository)}return r.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;const r=this.layerData.get(e);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(e)}};const Gve=new Map;function uit(){Gve.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(r=>console.log(r)),console.log("========"),t[1].forEach(r=>console.log(r))})}const c3t={value:.5,readOnly:!0},hit={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let Yw=class{constructor(e=0,r=0){this.min=e,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},dit=class{constructor(e,r){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(r[2]-r[0]),this.dy=(e.width-1)/(r[3]-r[1]),this.x0=r[0],this.y1=r[3]}},pit=class{constructor(e,r,i){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=r,this.samplerData=new dit(i,r)}computeMinMaxValue(e,r,i,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,u=this.samplerData.data.values,d=.5*zC;let p=(c-1)/o,g=(i-this.j*o)*p,y=(r-this.i*o)*p;if(p<1){const _=Math.floor(g),v=Math.floor(y),w=_+v*c,x=u[w],T=u[w+1],S=u[w+c],C=u[w+c+1];if(x+T+S+C<d){const A=g-_,O=y-v,$=KA(x,T,S,C,A,O),D=KA(x,T,S,C,A+p,O),N=KA(x,T,S,C,A,O+p),z=KA(x,T,S,C,A+p,O+p);return s.min=Math.min($,D,N,z),s.max=Math.max($,D,N,z),s}g=_,y=v,p=1}else g=Math.floor(g),y=Math.floor(y),p=Math.ceil(p);for(let _=g;_<=g+p;_++)for(let v=y;v<=y+p;v++){const w=u[_+v*c];w<d?(a=Math.min(a,w),l=Math.max(l,w)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const fit=.5*zC;function Bi(t,e,r){if(r==null)return null;for(const i of r){if(!i)continue;const s=i.safeWidth;let n=me(i.dy*(i.y1-e),0,s),o=me(i.dx*(t-i.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=i.data.width,u=a*c+l,d=i.data.values,p=d[u],g=d[u+1],y=u+c,_=d[y],v=d[y+1];if(p+_+g+v<fit){n-=a,o-=l;const w=p+(g-p)*o;return w+(_+(v-_)*o-w)*n}}return null}let iu=class extends xe{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(r=>{const i=r.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const s=jve(i.fullExtent,this.viewSpatialReference);s!=null&&e.push(Mae(s))}}),e}};function mit(t,e){return t===$e.Global?new oz(e):new az(e)}h([f({readOnly:!0})],iu.prototype,"layerViewsExtent",null),h([f({readOnly:!0})],iu.prototype,"tiledLayersExtent",null),h([f({readOnly:!0})],iu.prototype,"stencilEnabledExtents",null),h([f()],iu.prototype,"viewSpatialReference",void 0),h([f()],iu.prototype,"tilingScheme",void 0),h([f()],iu.prototype,"defaultTiledLayersExtent",void 0),h([f({constructOnly:!0})],iu.prototype,"layers",void 0),h([f({constructOnly:!0})],iu.prototype,"layerViews",void 0),iu=h([k("esri.views.3d.terrain.ExtentHelper")],iu);let oz=class extends iu{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?Zde:r5e}};oz=h([k("esri.views.3d.terrain.ExtentHelperGlobal")],oz);let az=class extends iu{_computeLayerViewsExtent(){const e=Mu(),r=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=jve("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,r);M0(e,a,e)}});const i=z8(e)?e:null,s=this._get("layerViewsExtent");return E1(i,s)?s:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const r=this.viewSpatialReference,i=Mu();this.layers.forEach(o=>{if(o.loaded&&TE(o)){const a=VN(o,r,$e.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a;l!=null&&c!=null&&(aL(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&M0(i,c,i)}}),M0(i,this.defaultTiledLayersExtent,i);const s=z8(i)?i:null,n=this._get("tiledLayersExtent");return E1(s,n)?n:s}};function jve(t,e){return t==null||t.spatialReference.equals(e)?t:DE(t,t.spatialReference,e)}az=h([k("esri.views.3d.terrain.ExtentHelperLocal")],az);var Vt;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(Vt||(Vt={}));const q_=[Vt.ELEVATION,Vt.MAP];function Hve(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const r=Object.keys(t);for(const i of r)i.includes(".glsl")&&delete t[i]}}const qve=1.3,git=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let Sg,La=class extends xe{get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Zr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Mr(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return qve/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=te("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){const e=this.view;this.renderer=new fh({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),e._stage.renderer.renderPlugins.add(this.renderer);const r=()=>this.setDrawTexturesDirty();this._groundIntersector=Du(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([ae(()=>this.renderer.hasHighlights,r),this.renderer.events.on("has-water",i=>{var s;return(s=e._stage)==null?void 0:s.renderer.setParameters({hasOverlayWater:i})}),this.renderer.events.on("renders-occluded",()=>{r(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",r),ae(()=>e.state.camera.pixelRatio,r),ae(()=>e.state.alignPixelEnabled,r),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),ae(()=>{var i,s,n;return[(i=e.pointsOfInterest)==null?void 0:i.renderPointOfView,(n=(s=e.pointsOfInterest)==null?void 0:s.centerOnSurfaceFrequent)==null?void 0:n.location]},()=>this.setPlacementDirty()),ae(()=>{var i,s;return[(i=e.state)==null?void 0:i.pixelRatio,(s=e.state)==null?void 0:s.contentPixelRatio]},()=>this.setPlacementDirty(),Fr),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(ct.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",i=>{this._updateOverlays(fa,i.camera,cs.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(cs.BACKGROUND,i)})]),e._stage.renderer.renderOverlay=i=>this._renderOverlay(i)}_renderOverlay(e){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._dispatchAnimationUpdate(e),this._drawOverlays(cs.UPDATE,this.view.state)}destroy(){var e;(e=this.view)!=null&&e._stage&&(this.view._stage.renderer.renderPlugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{}),Sg&&(Sg.hide(),Sg=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const r=this.view.renderSpatialReference;e!=null&&r!=null?(this._renderSR=r,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new G0(-20037508342787e-6,20037508342787e-6):new G0(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(e,r,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,r,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Kl)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,cs.UPDATE)}_updateOverlays(e,r,i){if(!this._spatialReference)return go.YIELD;const s=this._computeOverlayResolution(r);this._computeOverlayExtents(r,s,Ld),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,Ld.stretch);const n=this._updateOverlay(As.INNER,Ld.inner,s,1*Ld.pixelRatioAdjustment,Ld.mapUnitsPerPixel),o=Lo(Ld.inner)/Lo(Ld.outer),a=this._updateOverlay(As.OUTER,Ld.outer,s,o*Ld.pixelRatioAdjustment,Ld.mapUnitsPerPixel);n!==ap.EXTENT&&a!==ap.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(i)),n===ap.NONE&&a===ap.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const r=this.view.state.contentPixelRatio*this.view.resolutionScale,i=e.fullWidth/e.pixelRatio*r,s=e.fullHeight/e.pixelRatio*r,n=Math.ceil(1.5*Math.max(i,s));return Math.min(M1(n),this._maxResolution)}_updateOverlay(e,r,i,s,n){if(this.renderer.overlays.length===0)return ap.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,yit(r,o.extent)&&i===o.resolution)return a===n?ap.NONE:ap.RERENDER_ONLY;ym(o.extent,r),o.resolution=i;const l=D7(o.extent);return o.renderLocalOrigin=HI(l[0],l[1],0,"OV_"+this._latestOriginId++),ap.EXTENT}setTileParameters(e){const r=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[As.INNER],s=this.renderer.overlays[As.OUTER],n=e.extent;this._rectInsideRect(i.extent,n)||this._rectanglesOverlap(n,i.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,As.INNER,r),this._setTileOverlayData(n,As.OUTER,r)):(this._clearTileOverlayData(As.INNER,r),this._clearTileOverlayData(As.OUTER,r))}else this._clearTileOverlayData(As.INNER,r),this._clearTileOverlayData(As.OUTER,r)}overlayPixelSizeInMapUnits(e,r){if(this.renderer.overlays.length===0)return r();const i=this.renderer.overlays[As.INNER],s=this.renderer.overlays[As.OUTER],n=this._pointIsInExtent(e,i.extent)?i:s;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,r,i){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[r].extent,n=Lo(s),o=ja(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}i.setScale(r,Lo(e)/n,ja(e)/o),i.setOffset(r,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,r){r.setScale(e,-1,-1),r.setOffset(e,-1,-1)}async reloadShaders(){Hve(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(fa)}_dispatchAnimationUpdate(e){const r=e-this._animationTimeLast;if(r>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const i=r/this.surface.view._stage.renderer.animationTimeDilation,s=new Bge(this.view.state.camera,i,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,r,i,s){const n=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,wit,r,i);if(n==null)return!1;const o=n.origin,a=le(WO,n.origin,n.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,r){let i=.5;const s=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=me(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const u=WO;$2(MD($D,Mr(this.view.spatialReference).radius+l),$c(e.eye,e.viewForward),u),ce(u,u,e.eye);const d=j0.normalize(she(e.viewForward,u,e.viewRight))/e.fovY+.5,p=d<=0||d>=1?.5:s;i=c?p*d:d+p*(1-d)}else{const u=.5*Math.PI-Math.acos(-e.viewForward[2]),d=Math.tan(u),p=Ot(0,d,1,0),g=gc(p,p,e.projectionMatrix)[1],y=me(.5+.5*g,0,1);i=y===1||y===0?.5:c?y*s:1-(1-y)*s}return!!this._intersectGroundFromView(e,.5,i,r)&&QL(r,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,r,i){const s=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=E();this._findHorizonBasedPointOfInterest(e,n)||ie(n,s),Zr.OVERLAY_SHOW_CENTER?(Sg==null&&(Sg=new ww(this.view.graphics,"red")),Sg.show(n,this._renderSR)):Sg!=null&&Sg.hide();const o=Math.max(.1,hi(e.eye,n)),a=ty(this.view.renderCoordsHelper,s,e.eye);this._overlaySREqualsRenderSR||mo(n,this._renderSR,n,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference&&this._spatialReference.isGeographic,u=c&&this._spatialReference?1/Mr(this._spatialReference).metersPerDegree:1,d=this.view.state.contentPixelRatio,p=e.perScreenPixelRatio/d*o*u;i.mapUnitsPerPixel=p/this._worldToPCSRatio,i.stretch=this._overlayStretch;let g=r*p/2*i.stretch,y=!1,_=c?90:1/0;this._isSpherical&&l&&this._spatialReference&&(this._spatialReference.isWebMercator?(g/=Math.cos(R$(n[1])),_=l[3]):(y=!0,g/=Mr(this._spatialReference).metersPerDegree,_=90),g>=_&&(g=_,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let v=1;y&&(v=1/Math.max(.2,Math.cos(Math.abs(At(n[1])))),g*v>180&&(v=180/g),i.mapUnitsPerPixel*=v);const w=Math.log(2)/12;g=Math.exp(Math.round(Math.log(g)/w)*w);const x=g*v,T=32,S=.5*r/(T*x),C=.5*r/(T*g);n[0]=Math.round(n[0]*S)/S,n[1]=Math.round(n[1]*C)/C;const A=i.inner;A[0]=n[0]-x,A[1]=n[1]-g,A[2]=n[0]+x,A[3]=n[1]+g,this._isSpherical&&this._shiftExtentToFitBounds(A,1/0,_);const O=i.outer;if(6*x>Lo(l))ym(O,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)O[0]=A[0]-x,O[1]=A[1]-g,O[2]=A[2]+x,O[3]=A[3]+g;else{mo(e.eye,this._renderSR,WO,this._spatialReference),pp(n_,n,WO);let D=-Math.atan2(n_[1],n_[0])+.125*Math.PI;D<0&&(D+=2*Math.PI);const N=Math.floor(D/(.25*Math.PI));X1(n_,git[N],2*g),n_[0]*=v,n_[2]*=v,E7(O,A,n_)}if(this._isSpherical)O[0]=this._longitudeCyclical.clamp(O[0]),O[2]=this._longitudeCyclical.clamp(O[2]),O[1]=Math.max(O[1],-_),O[3]=Math.min(O[3],_);else{const D=V8(A,l,vit),N=V8(O,l,bit);mW(D,N)&&(O[2]=O[0],O[3]=O[1])}const $=Math.abs(A[2]-A[0])/r;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,$),i.pixelRatioAdjustment=i.mapUnitsPerPixel/$}_drawOverlays(e,r){if(!this.renderer.hasOverlays)return;if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const i=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const s=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(r),s!==this.renderer.computeValidity()&&this.surface.updateTileOverlayParams(cs.UPDATE),i?(this.surface.requestRender(e),e===cs.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(cs.BACKGROUND),this.renderer}_rectanglesOverlap(e,r){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(r[0],r[2],e[0])||this._longitudeCyclical.contains(r[0],r[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],r[0]))&&!(e[1]>r[3]||e[3]<r[1]):aD(e,r))}_rectInsideRect(e,r){return r!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],r[0])&&this._longitudeCyclical.contains(e[0],e[2],r[2])&&r[1]>e[1]&&r[3]<e[3]:mW(e,r))}_pointIsInExtent(e,r){if(this._longitudeCyclical)return this._longitudeCyclical.contains(r[0],r[2],e.x)&&e.y>=r[1]&&e.y<=r[3];const i=e.x,s=e.y;return i>r[0]&&i<r[2]&&s>r[1]&&s<r[3]}_shiftExtentToFitBounds(e,r,i){let s=0,n=0;e[0]<-r?s=e[0]+r:e[2]>r&&(s=r-e[2]),e[1]<-i?n=e[1]+i:e[3]>i&&(n=i-e[3]),U$(e,s,n)}get test(){return{renderer:this.renderer,update:()=>this.runTask(fa)}}};function yit(t,e){const i=Zr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i}h([f()],La.prototype,"_spatialReference",void 0),h([f({readOnly:!0})],La.prototype,"running",null),h([f()],La.prototype,"_placementDirty",void 0),h([f()],La.prototype,"_contentUpdated",void 0),h([f()],La.prototype,"_isSpherical",null),h([f()],La.prototype,"_worldToPCSRatio",null),h([f({autoDestroy:!0})],La.prototype,"renderer",void 0),h([f({constructOnly:!0})],La.prototype,"view",void 0),h([f({constructOnly:!0})],La.prototype,"surface",void 0),h([f()],La.prototype,"suspended",null),h([f()],La.prototype,"updating",null),h([f({type:Boolean})],La.prototype,"rendersOccluded",null),La=h([k("esri.views.3d.terrain.OverlayManager")],La);let _it=class{constructor(){this.inner=Gt(),this.outer=Gt(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=qve}};const n_=Jt(),WO=E(),Ld=new _it,vit=Gt(),bit=Gt(),wit=ln();var ap;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(ap||(ap={}));let xit=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=ui(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}release(){this.vertexAttributes=Zt(this.vertexAttributes),this.indices=null}},Jee=class{constructor(e,r,i,s,n){this.attributes=e,this.localOrigin=r,this.index0=i,this.stride=s,this.count=n}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return be(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,r){this.attributes.position.getVec(e,r)}getVertexPos(e,r){this._getVertexRaw(this.getAttributeIndex(r),e),le(e,e,this.localOrigin)}getNormal(e,r){const{typedBuffer:i,typedBufferStride:s}=this.attributes.normalCompressed;RYe(e,i,this.getAttributeIndex(r),s)}_setNormal(e,r,i,s){const{typedBuffer:n,typedBufferStride:o}=this.attributes.normalCompressed;mv(n,e,r,i,s,o)}_setUV(e,r,i){Jh(this.attributes.uv0,e,r,i)}setNormalFromValues(e,r,i,s){this._setNormal(this.getAttributeIndex(e),r,i,s)}setVertexFromValuesRawPositionUV(e,r,i,s,n,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,r,i,s),this._setUV(a,n,o)}setVertexFromValuesRawPositionUVNormal(e,r,i,s,n,o,a,l,c){const u=this.getAttributeIndex(e);this.attributes.position.setValues(u,r,i,s),this._setUV(u,n,o),this._setNormal(u,a,l,c)}};const Qee=16384;function Jh(t,e,r,i){t.setValues(e,r*Qee,i*Qee)}function Eu(t,e,r,i){t<i[0]?i[0]=t:t>i[3]&&(i[3]=t),e<i[1]?i[1]=e:e>i[4]&&(i[4]=e),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}let Tit=class{constructor(){this.sinLonLUT=new Array(CS+1),this.cosLonLUT=new Array(CS+1),this.sinLatLUT=new Array(CS+1),this.cosLatLUT=new Array(CS+1)}update(e,r,i){const s=r[0],n=r[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},YO=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},Sit=class{constructor(){this.cornerNeighborData=[new YO,new YO,new YO,new YO],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},Eit=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new Sit}},Wve=class GM{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Oe(this._current),this._next=Oe(this._next),this._waiting=Oe(this._waiting),this._delayed=Oe(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let e=GM.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,hm.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const r=this._fadeDuration,i=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==Ws.FADING,n=e-this._fadeStart>=r;(i||s||n)&&(Oe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=GM.test.fadeMoment||performance.now(),r=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return this._next!=null||this._delayed!=null}push(e,r=hm.Immediate){this._delayed=Oe(this._delayed),this._push(e,r)}_push(e,r){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const i=GM.test.fadeMoment||performance.now();return r!==hm.Immediate?(this._delayed=e,void(this._delayedTime=i+r)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void(e!=null&&(Oe(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const r=this._getFadeDuration();return e+r-e%r}get _isFadingEnabled(){return this._getFadeDuration()>0}};var hm;Wve.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(hm||(hm={}));var f2;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(f2||(f2={}));let Yve=class{constructor(){this._queue=new It,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var r;const e=(r=this._last)==null?void 0:r.children;return e!=null&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},Cit=class{constructor(){this._q=new It}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}};function hC(t,e,r){if((e==null?void 0:e.fullExtent)==null)return!1;const i=e.fullExtent,s=t.extent;if(r){if(s[0]<i.xmin||s[1]<i.ymin||s[2]>i.xmax||s[3]>i.ymax)return!1}else if(i.xmin>s[2]||i.ymin>s[3]||i.xmax<s[0]||i.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&n>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&n<.99999999*a)}function dm(t,e){const r=t.lij,i=e.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function Xve(t,e,r=null){r==null||r.length===0?t===f2.BACK_TO_FRONT?e.sort(Ait):e.sort(Rit):e.sort((i,s)=>Oit(i,s,t,r))}function Ait(t,e){const r=e.screenDepth-t.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function Rit(t,e){const r=t.screenDepth-e.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function Zve(t,e,r){const i=t.screenDepth,s=e.screenDepth;return i<s?-r:i>s?r:dm(t,e)}function Oit(t,e,r,i){return Kee(t,i)===Kee(e,i)?Zve(t,e,r):t?r:-r}function Kee(t,e){for(const r of e)if(t.intersectsExtent(r))return!0;return!1}function Pit(t,e){const r=t.distanceToPOI-e.distanceToPOI;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function Mit(t,e){const r=t.length;for(let i=0;i<r;++i)t.at(i).updateDistanceToPOI(e);t.sort(Pit)}function $it(t,e,r){let i=1,s=0,n=0;for(;t!==e;)if(i*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),!(1&t.lij[1])&&(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(e,s,n,i)}function Iit(t){for(let e=0;e<t.length;e++){const r=t[e],i=r.parent;if(i)for(let s=0;s<4;s++){const n=i.children[s];if(n&&n!==r)return!0}}return!1}function C3t(t,e){if(!t||!e||t[0]===e[0])return!1;const r=t[0]<e[0],i=r?t:e,s=r?e:t,n=1<<s[0]-i[0];return Math.floor(s[1]/n)===i[1]&&Math.floor(s[2]/n)===i[2]}let $H=class{get updating(){return!!this._tileRequested}init(e,r,i,s){this.tile=e,this._layerIdx=r,this._layerClass=i,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(r,i),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,r){this._setUpsampleTile(e,r),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,Ws.FADING,r):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(e,r),s=iz(i),{minLevel:n,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?hC:()=>!0;let u=this.tile;const d=u.level;let p;const g=this._tileLayerInfo.upsampleInfo,y=g!=null?g.tile.level:-1,_=g!=null&&y-d>=a,v=s==null?void 0:s.tilemapCache,w=i.type==="vector-tile-3d"?i.schemaHelper:null;for(;u&&c(u,s,!1)&&u.level>=n;){const x=u.level,T=d-x,S=u.layerInfo[r][e];if(S.data&&T>=a){(!_||x>y)&&this._setUpsampleTile(u),S.dataInvalidated&&(p=u);break}const C=(w==null?void 0:w.getLevelRowColumn(u.lij))??u.lij;if((v==null?void 0:v.getAvailability(C[0],C[1],u.lij[2]))!=="unavailable"&&x<=o&&!S.data&&!S.dataMissing&&((!p||u.level===n||x%Xde==0||d-p.level<a)&&(p=u),T>=l))break;u=u.parent}if(p!=null&&d-p.level<a)if(g)p=null;else{const x=this._findAncestorWithData();x!=null&&(this._setUpsampleTile(x),p=x.layerInfo[r][e].dataInvalidated?x:null)}return p}_findAncestorWithData(){const e=this.tile.elevationLevel,r=this._desiredMinLevelDelta;let i;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=r)return s;i=s}return i}_setUpsampleTile(e,r){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,Ws.FADING,r)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},Lit=class extends $H{get _desiredMinLevelDelta(){throw ete}get _progressiveLevelModulo(){throw ete}dispose(){}};const ete=new Error("Abstract method called on TileAgent"),nl=new Lit;let Jve=class extends $H{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return N9(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},Qve=class extends $H{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return Xde}};var F1,yv;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(F1||(F1={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(yv||(yv={}));function Dit(t){t.fragment.uniforms.add(new Ze("u_colormap",e=>e.u_colormap),new Ee("u_colormapOffset",e=>e.colormap.u_colormapOffset),new Ee("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new Ee("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(b`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function Nit(t){t.fragment.uniforms.add(new Ze("u_transformGrid",e=>e.u_transformGrid),new Ir("u_transformSpacing",e=>e.common.u_transformSpacing),new Ir("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(b`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let Kve=class extends Vr{constructor(){super(...arguments),this.scale=1,this.offset=_m}};function ebe(t){t.attributes.add(R.POSITION,"vec2"),t.attributes.add(R.UV0,"vec2"),t.vertex.uniforms.add(new Ee("scale",e=>e.scale)),t.vertex.uniforms.add(new Ir("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(b`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let Fit=class extends Kve{constructor(e,r,i){super(),this.common=e,this.u_image=r,this.u_transformGrid=i}};function Uit(t,e){t.include(Nit),t.fragment.uniforms.add(new Ze("u_image",i=>i.u_image),new Op("u_flipY",i=>i.common.u_flipY),new Op("u_applyTransform",i=>i.common.u_applyTransform));const{requireBilinearWithNN:r}=e;r&&t.fragment.uniforms.add(new Ir("u_srcImageSize",i=>i.common.u_srcImageSize)),t.fragment.code.add(b`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),r?t.fragment.code.add(b`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(b`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var Ae;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Ae||(Ae={}));const lz={normal:Ae.Normal,average:Ae.Average,lighten:Ae.Lighten,lighter:Ae.Lighter,screen:Ae.Screen,plus:Ae.Plus,"color-dodge":Ae.ColorDodge,darken:Ae.Darken,multiply:Ae.Multiply,"color-burn":Ae.ColorBurn,overlay:Ae.Overlay,"soft-light":Ae.SoftLight,"hard-light":Ae.HardLight,"vivid-light":Ae.VividLight,hue:Ae.Hue,saturation:Ae.Saturation,luminosity:Ae.Luminosity,color:Ae.Color,difference:Ae.Difference,exclusion:Ae.Exclusion,minus:Ae.Minus,invert:Ae.Invert,reflect:Ae.Reflect,"destination-over":Ae.DestinationOver,"destination-atop":Ae.DestinationAtop,"destination-in":Ae.DestinationIn,"destination-out":Ae.DestinationOut,"source-atop":Ae.SourceAtop,"source-in":Ae.SourceIn,"source-out":Ae.SourceOut,xor:Ae.Xor};function kit(t){return t===Ae.DestinationOver||t===Ae.DestinationAtop||t===Ae.DestinationIn||t===Ae.DestinationOut||t===Ae.SourceAtop||t===Ae.SourceIn||t===Ae.SourceOut||t===Ae.Xor}function IH(t){t.code.add(b`
    float lineFactorAtPosition(float value) {
      float pos = value * ${b.float(257)};
      if(pos < 0.5 || pos > ${b.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function Bit(t,e){const r=e.blendMode;r!==Ae.Normal&&(r===Ae.Reflect&&t.code.add(b`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==Ae.ColorDodge&&r!==Ae.VividLight||t.code.add(b`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==Ae.ColorBurn&&r!==Ae.VividLight||t.code.add(b`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===Ae.Overlay&&t.code.add(b`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===Ae.HardLight&&t.code.add(b`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===Ae.SoftLight&&t.code.add(b`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===Ae.VividLight&&t.code.add(b`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==Ae.Hue&&r!==Ae.Saturation&&r!==Ae.Color&&r!==Ae.Luminosity||(t.code.add(b`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==Ae.Hue&&r!==Ae.Saturation||t.code.add(b`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(b`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===Ae.Multiply?b`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Average?b`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Lighten?b`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Darken?b`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Lighter?b`return vec4(cl * ol + cb * ob, ol + ob);`:r===Ae.Plus?b`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===Ae.Minus?b`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===Ae.Screen?b`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Difference?b`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Invert?b`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Ae.DestinationOver?b`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===Ae.DestinationAtop?b`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===Ae.DestinationOut?b`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===Ae.SourceAtop?b`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Ae.SourceOut?b`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===Ae.Xor?b`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===Ae.DestinationIn?b`return vec4(cb * ob * ol, ol * ob);`:r===Ae.SourceIn?b`return vec4(cl * ol * ob, ol * ob);`:r===Ae.Hue?b`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Saturation?b`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Color?b`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Luminosity?b`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Exclusion?b`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Reflect?b`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.ColorDodge?b`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.ColorBurn?b`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Overlay?b`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.SoftLight?b`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.HardLight?b`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.VividLight?b`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:b``}
    }
  `))}var Is,_c,Ph;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(Is||(Is={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(_c||(_c={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(Ph||(Ph={}));function tbe(t,e){const r=e.output===Is.GridComposite,i=e.output===Is.ColorComposite,s=e.output===Is.GroupBackgroundComposite,n=e.output===Is.Composite;r&&t.fragment.include(IH),i&&t.fragment.uniforms.add(new Pt("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===_c.Required;o&&t.fragment.uniforms.add(new Ee("baseOpacity",c=>c.baseOpacity)),n&&t.fragment.uniforms.add(new Ze("fboColor",c=>c.fboTexture));const a=e.blendMode!==Ae.Normal,l=e.premultipliedSource===Ph.On;t.fragment.include(Bit,e),t.fragment.code.add(b`
    vec4 getBackground(vec2 uv) {
      return ${o?b`baseOpacity *`:""} ${s?b`vec4(0.0, 0.0, 0.0, 0.0)`:i?b`vec4(backgroundColor, 1.0)`:r?b`vec4(gridColor(uv), 1.0)`:b`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?b`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:b`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(n&&!o||s)?b`colorLayer * opacity;`:b`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let jN=class extends Fit{constructor(e,r,i,s,n,o){super(e,s,n),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=Mn,this.fboTexture=null,this.baseOpacity=1}},zit=class extends jN{},Vit=class extends jN{};function Git(t){const e=new dr;return e.include(ebe),e.include(Uit,t),e.include(Dit,t),e.include(tbe,t),e.fragment.code.add(b`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===F1.Stretch?Hit(e,t):t.colorizerType===F1.Lut?jit(e):t.colorizerType===F1.Hillshade&&qit(e,t),e}function jit(t){t.fragment.code.add(b`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function Hit(t,e){t.fragment.uniforms.add(new aA("u_bandCount",i=>i.symbolizer.u_bandCount),new Va("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new Va("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new Va("u_factor",i=>i.symbolizer.u_factor,3),new Ee("u_minOutput",i=>i.symbolizer.u_minOutput),new Ee("u_maxOutput",i=>i.symbolizer.u_maxOutput),new Op("u_useGamma",i=>i.symbolizer.u_useGamma),new Va("u_gamma",i=>i.symbolizer.u_gamma,3),new Va("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new Ee("u_opacity",i=>i.common.u_opacity)),t.fragment.code.add(b`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=e.applyColormap?b`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:b`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(b`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===yv.Noop?b`
        fragColor = applyBackgroundBlend(currentPixel);`:b`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function qit(t,e){const r=t.fragment;r.uniforms.add(new Ze("u_image",s=>s.u_image),new aA("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new Va("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new Va("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new Va("u_cosZs",s=>s.symbolizer.u_cosZs,6),new Va("u_weights",s=>s.symbolizer.u_weights,6),new Ir("u_factor",s=>s.symbolizer.u_factor),new Ee("u_minValue",s=>s.symbolizer.u_minValue),new Ee("u_maxValue",s=>s.symbolizer.u_maxValue),new Ir("u_srcImageSize",s=>s.common.u_srcImageSize)),r.include(tf),r.code.add(b`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(b`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=e.applyColormap?b`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:b`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(b`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const Wit=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:Vit,ColorizerStretchUniforms:zit,ColorizerUniforms:jN,build:Git},Symbol.toStringTag,{value:"Module"}));function Yit(t,e,r="nearest",i=!1){var c;const s=!(i&&e.pixelType==="u8"),n=s?en.FLOAT:en.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:s?e.getAsRGBAFloat():e.getAsRGBA(),a=(c=t.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l=new Or;return l.width=e.width,l.height=e.height,l.internalFormat=t.type===rr.WEBGL2&&s?Ve.RGBA32F:ut.RGBA,l.samplingMode=!a||r!=="bilinear"&&r!=="cubic"?Dt.NEAREST:Dt.LINEAR,l.dataType=n,l.wrapMode=Ft.CLAMP_TO_EDGE,new Rt(t,l,o)}function Xit(t,e){const{spacing:r,offsets:i,coefficients:s,size:[n,o]}=e,a=r[0]>1,l=new Or;l.width=a?4*n:n,l.height=o,l.internalFormat=t.type===rr.WEBGL2?Ve.RGBA32F:ut.RGBA,l.dataType=en.FLOAT,l.samplingMode=Dt.NEAREST,l.wrapMode=Ft.CLAMP_TO_EDGE;const c=new Float32Array(a?n*o*16:2*i.length);if(a&&s!=null)for(let u=0,d=0;u<s.length;u++)c[d++]=s[u],u%3==2&&(c[d++]=1);else for(let u=0;u<o;u++)for(let d=0;d<n;d++){const p=4*(u*n+d),g=2*(d*o+u);c[p]=i[g],c[p+1]=i[g+1],c[p+3]=i[g]===-1?0:1}return new Rt(t,l,c)}function tte(t,e){const r=new Or;return r.internalFormat=ut.RGBA,r.width=e.length/4,r.height=1,r.samplingMode=Dt.NEAREST,r.wrapMode=Ft.CLAMP_TO_EDGE,new Rt(t,r,e)}function Zit(t,e,r,i=1,s=!0){return{u_flipY:s,u_applyTransform:!!t,u_opacity:i,u_transformSpacing:t?t.spacing:_m,u_transformGridSize:t?t.size:_m,u_targetImageSize:e,u_srcImageSize:r}}function Jit(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function Qit(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function Kit(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const rte={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let est=class{constructor(e,r,i=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=r,this.width=i||r.width,this.height=s||r.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=Ke(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...rte,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||rte}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){e!=null&&e.length>0?this._bandIds&&e.every((r,i)=>{var s;return!!((s=this._bandIds)!=null&&s[i])&&r===this._bandIds[i]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture!=null){const r=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(r==="bilinear"?Dt.LINEAR:Dt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=Ke(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(e,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(e),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=Xit(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:r,width:i,height:s,opacity:n}=this,o=Zit(r,[i,s],[this.source.width,this.source.height],n),a=Jit(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?Qit(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?Kit(this.symbolizerParameters):null;return new jN(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return this.interpolation==="bilinear"&&e.colormap!=null&&e.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(r=>r!=null?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=Ke(this._rasterTexture),this._transformGridTexture=Ke(this._transformGridTexture),this._colormapTexture=Ke(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=Ke(this._rasterTexture));const s=r==null&&this.bandIds==null||r!=null&&this.bandIds!=null&&r.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&s)return;this._rasterTexture=Ke(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=Yit(e,i,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((s,n)=>s!==r[n])?(this._colormapTexture=Ke(this._colormapTexture),this._colormapTexture=tte(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=tte(e,i),void(this._colormap=i)):(this._colormapTexture=Ke(this._colormapTexture),void(this._colormap=null))}},jM=class{constructor(){this.waitingAgents=new It,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const r=i6.acquire();return r._init(e),r}release(){this.dispose(),HM.delete(this),i6.release(this)}dispose(){this.loadingAgent=Ke(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=_x(this._data)}static prune(){i6.prune(0)}_init(e){this.waitingAgents.clear(),this._data=_x(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Ml(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,r){if(e!==r&&r!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),$it(e,r,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){_x(this._data),this._data=e}};const i6=new Vo(jM,null,()=>{}),HM=new Map;function tst(){HM.size>0&&(console.log(`${HM.size} live TilePerLayerInfo allocations:`),HM.forEach(t=>console.log(t,`
`)))}let oE=class{constructor(e,r){this._texture=e,this._cache=r,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){if(--this._refCount,this._refCount===0)if(this._cache){const e=`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;this._cache.put(e,this)}else this.dispose()}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.gpuMemoryUsage}};var pt;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.RENDERDATA=8]="RENDERDATA",t[t.GEOMETRY=16]="GEOMETRY",t[t.TEXTURE_NOFADING=32]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=64]="TEXTURE_FADING"})(pt||(pt={}));const rst=.1;let LH=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Gt(),this._elevationBounds=ke(),this.layerInfo=[[],[]],this.extentInRadians=Gt(),this.centerAtSeaLevel=E(),this._center=[E(),ds(),E()],this.up=x7(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=E()}static prune(){DH.prune(0),NH.prune(0),jM.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Cs.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,r=(e==null?void 0:e.frustumVisibility)??Po.INTERSECTS;this._frustumVisibility=r===Po.INSIDE?Po.INSIDE:r===Po.OUTSIDE?Po.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const i=this._frustumVisibility!==Po.OUTSIDE&&this._intersectsClippingArea;i!==this._visible&&(this._visible=i,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){return this.isLeaf}init(e,r,i,s,n){this.lij[0]=e,this.lij[1]=r,this.lij[2]=i,this.ellipsoid=Mr(n.tilingScheme.spatialReference),n.tilingScheme.getExtent(e,r,i,this.extent),n.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,n.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Cs.MIDDLE][3]=0,this.elevationLevel=e,s&&s.elevationBounds?Ns(this._elevationBounds,s.elevationBounds):ir(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=s,this.unsetChildren(),this._surface=n,this.updateVisibility();for(const o of q_){const a=n.numLayers(o),l=this.layerInfo[o];for(const c of l)c.release();l.length=a;for(let c=0;c<a;c++)l[c]=jM.acquire(this._surface.upsampleInfoPool),o===Vt.ELEVATION&&this.findElevationBoundsForLayer(c,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(n.tilingScheme.pixelSize,CS)}dispose(){up(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of q_){for(const r of this.layerInfo[e])r.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Vt.MAP].reduce((e,r)=>e+(r instanceof r6?r.memoryUsed/r.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){var i;if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=this._baseUsedMemory,this._mapTileMemoryInternal=0;let e=0;for(const{data:s}of this.layerInfo[Vt.MAP])s instanceof r6?e+=this._getTerrainDataMemory(s):this._mapTileMemoryInternal+=this._getTerrainDataMemory(s);const r=this._cpuImageMemorySize;for(const s of this.layerInfo[Vt.ELEVATION])this._usedMemory+=s.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=((i=this.renderData.texture)==null?void 0:i.usedMemory)??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,r){const i=this.layerInfo[e][r];return i!=null&&i.data?e===Vt.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):e===Vt.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof oE?e.texture.gpuMemoryUsage:e instanceof HTMLImageElement||e instanceof RH?this._cpuImageMemorySize:e instanceof est?e.memoryUsage:e instanceof r6?e.memoryUsed/e.referenced:0}updateScreenDepth(e){const r=this._center[Cs.MIDDLE],i=e,s=r[0],n=r[1],o=r[2],a=i[2]*s+i[6]*n+i[10]*o+i[14];this.screenDepth=a<0?0:a/(i[3]*s+i[7]*n+i[11]*o+i[15])}shouldSplit(e,r,i){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===Po.OUTSIDE))return pt.NONE;const s=this.level;ce(ZO,this._center[Cs.MIDDLE],r);let n=co(ZO),o=ZO,a=Cs.MIDDLE;ce(s6,this._center[Cs.TOP],r);const l=co(s6);l<n&&(n=l,o=s6,a=Cs.TOP),ce(n6,this._center[Cs.BOTTOM],r);const c=co(n6);if(c<n&&(n=c,o=n6,a=Cs.BOTTOM),this._edgeLen2>n&&s<e.maxLod)return pt.SPLIT;const u=i!=null?i-s:1/0,d=Math.sqrt(n),p=e.fovX*d*2,g=this._edgeLen/p,y=()=>{if(s<e.maxLod)return this.elevationLevel=s,pt.NONE;const O=s+Math.ceil(-Math.log2(e.relativeWidthLimit/g));return O!==this.elevationLevel?(this.elevationLevel=O,pt.ELEVATION):pt.NONE};if(u<=.5)return y();const _=de(this.up,ZO),v=this._elevationBounds[1]-this._elevationBounds[0],w=v/this.edgeLen;if(e.aboveGround&&_>0&&w<.001&&_/d-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-w>0)return pt.NONE;const x=i!=null?3-Math.min(u,2):1;if(g*x<e.relativeWidthLimit||s>=e.maxLod)return y();if(s<7)return pt.SPLIT;ee(Nn,this.up,_),ce(Nn,Nn,o);const T=co(Nn);if(T<=this.radius*this.radius)return pt.SPLIT;ee(Nn,Nn,this.radius/Math.sqrt(T)),le(Nn,Nn,this._center[a]),ce(Nn,r,Nn);const S=Math.min(1,(Math.abs(de(Nn,this.up))+.5*v+this._curvatureHeight)/_e(Nn)),C=rst/e.angledSplitBias,A=e.fovY*d*2;return S*(this._edgeLen/A*x)<C*e.relativeHeightLimit?pt.NONE:pt.SPLIT}setChildren(e,r,i,s){up(!!(e&&r&&i&&s),"Null child passed"),this._children[0]=e,this._children[1]=r,this._children[2]=i,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of q_)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const r of q_){const i=this.layerInfo[r];for(const s of i)s.loadingAgent&&s.loadingAgent!==nl&&(XO(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(pt.GEOMETRY),this.resetPendingUpdate(pt.TEXTURE_NOFADING),this.resetPendingUpdate(pt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[Vt.MAP];for(const r of e)r.loadingAgent&&r.loadingAgent!==nl&&(XO(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(E1(e,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=i&&this._isWithinClippingArea,n=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(pt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,r){return this.layerInfo[r][e]}hasLayerData(e,r){const i=this.layerInfo[r][e];return!(!(i!=null&&i.data)||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of q_){const r=this.layerInfo[e];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==nl&&i.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(pt.SPLIT)||e!==Vt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===pt.SPLIT||e===pt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,r,i){const s=this.layerInfo[r][e];if(s.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e),!0;if(s.waitingAgents.push(i),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e);const a=s.data&&"type"in s.data&&s.data.type==="vector-tile";return i.dataArrived(this,a),!0}if(s.requestPromise)return!0;Ml(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,r,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const r=this._children;return r[0]?r[0].findByLij(e)||r[1].findByLij(e)||r[2].findByLij(e)||r[3].findByLij(e):null}distanceToSquared(e){return co(ce(Nn,this._center[Cs.MIDDLE],e))}containsPoint(e){const r=this.extent;return e[0]>=r[0]&&e[1]>=r[1]&&e[0]<=r[2]&&e[1]<=r[3]}containsPointXY(e,r){const i=this.extent;return e>=i[0]&&r>=i[1]&&e<=i[2]&&r<=i[3]}unrequestLayerData(e,r,i){const s=this.layerInfo[r][e],n=s.waitingAgents,o=n.removeUnordered(i)!=null;up(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,r,i){const s=i!=null&&"type"in i&&i.type==="vector-tile",n=this.layerInfo[r][e];n.data=i,n.dataInvalidated=!1,n.waitingAgents.forAll(o=>o.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,r,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${r}/${e} error ${i}`);const s=this.layerInfo[r][e];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,r,i){switch(i&&this.forEachLoadedNeighbor(s=>s.updateRenderData(e,r)),e){case Vt.MAP:return this._updateTexture(r);case Vt.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===Ws.FADING?pt.TEXTURE_NOFADING:pt.TEXTURE_FADING),this.setPendingUpdate(e===Ws.FADING?pt.TEXTURE_FADING:pt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(pt.GEOMETRY);for(const e of this.layerInfo[Vt.ELEVATION])e.pendingUpdates|=pt.GEOMETRY}invalidateLayerData(e,r){this.layerInfo[r][e].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const e=this._elevationBounds,r=e[0],i=e[1];ir(e,1/0,-1/0);const s=this.layerInfo[Vt.ELEVATION];let n=!0;for(const o of s)o.elevationBounds!=null&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(n=!1));n&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),r===e[0]&&i===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,r=.5*(e[0]+e[1]),i=this._center;ee(Nn,this.up,r),le(i[Cs.MIDDLE],this.centerAtSeaLevel,Nn),ee(Nn,this.up,e[0]),le(i[Cs.TOP],this.centerAtSeaLevel,Nn),ee(Nn,this.up,e[1]),le(i[Cs.BOTTOM],this.centerAtSeaLevel,Nn)}findElevationBoundsForLayer(e,r){const i=this.layerInfo[Vt.ELEVATION][e],s=N9(this.level),n=Math.max(this.elevationLevel-s,0),o=i.elevationBounds;if(o!=null&&o.level>=r&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,Vt.ELEVATION),l=iz(a);if(!hC(this,l,!1))return;const c=sst;let u=!1;const d=i.data;if(d&&d.level<=n){const p=i.data;c.min=p.samplerData.data.minValue,c.max=p.samplerData.data.maxValue,c.hasNoDataValues=p.samplerData.data.hasNoDataValues,c.level=this.level,u=!0}else{let p,g,y=0;for(let _=this._parent;_&&(!g||y<s)&&(y=this.elevationLevel-_.level,p=g||p,g=_.layerInfo[Vt.ELEVATION][e].data,!(!g&&p&&_.level<=n));_=_.parent);g=g||p,g&&(g.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=g.level,u=!0))}u&&(i.elevationBounds==null&&(i.elevationBounds=new Yw),i.elevationBounds.copyFrom(c))}modifyLayers(e,r,i){const s=this.layerInfo[i];for(const a of s)a.loadingAgent&&a.loadingAgent!==nl&&(XO(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=r.length;s.length=o;for(let a=0;a<o;a++){const l=r[a];s[a]=l>-1?n[l]:jM.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,Ws.FADING))}updateAgents(e){if(this.renderData){const r=this.layerInfo[e];for(const i of r)i.loadingAgent===nl&&(i.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of q_){const r=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==nl&&(i.loadingAgent.setSuspension(r),i.loadingAgent===nl&&this.updateRenderData(e,Ws.FADING))}}removeLayerAgent(e,r){const i=this.layerInfo[r][e];i.loadingAgent&&i.loadingAgent!==nl&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,r){const i=this.layerInfo[r][e];i.loadingAgent=nl,i.data||i.upsampleInfo!=null||this._createOrUpdateAgents(e+1,r)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||Cx(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,r,i){var s,n,o;for(let a=e;a<r;++a){const l=this._surface.layerViewByIndex(a,i);if(h3(l)&&((s=l==null?void 0:l.layer)==null?void 0:s.blendMode)!=="normal"||Cx((n=l==null?void 0:l.layer)==null?void 0:n.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,r){const i=this.layerInfo[r];if(i.length===0)return;const s=this._isSuspended(r);for(let n=e;n<i.length;++n){const o=i[n];let a=!1;const l=this._surface.layerViewByIndex(n,r),c=iz(l);if(o.loadingAgent?hC(this,c,!1)?(o.loadingAgent!==nl&&o.loadingAgent.setSuspension(s),o.loadingAgent!==nl&&(a=o.loadingAgent.update())):o.dispose():hC(this,c,!1)&&(o.loadingAgent=ist(this,n,r,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===nl&&this.setPendingUpdate(pt.GEOMETRY):(XO(o.loadingAgent),o.loadingAgent=nl)),o.loadingAgent===nl&&this.updateRenderData(r,Ws.FADING),!this._hasBlendModes(e,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(e){const r=this.extent;return r[0]>=e[0]&&e[2]>=r[2]&&r[1]>=e[1]&&e[3]>=r[3]}intersectsExtent(e){const r=this.extent;return r[2]>=e[0]&&e[2]>=r[0]&&r[3]>=e[1]&&e[3]>=r[1]}getElevationVerticesPerSide(e){const r=this.elevationLevel-this.level,i=Math.max(this.level-e,N9(this.level)-r),s=me(1+(this.maxTesselation>>i),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,r){if(!e)return null;const i=this.surface.rootTiles;if(i!=null){for(const s of i)if(nst(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!r(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return r(n)?n:null}}return null}findNeighborTile(e,r){const i=this.lij,s=this.getNeighborLIJ(i,e);return s?ost(i,s)?r(this)?this:null:this._findLIJ(s,r):null}findCorner(e,r){const i=e===tt.NORTH_EAST?1:e===tt.NORTH_WEST?0:e===tt.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!r||!r(s));)s=s.children[i];return s}findNeighborCornerTileExact(e,r){var i;return((i=this.findNeighborTile(e,s=>r(s)||s.level===this.level))==null?void 0:i.findCorner(lL(e),r))||null}forAllSubtreeOnSide(e,r){const i=e===tt.NORTH?[0,1]:e===tt.NORTH_EAST?[1]:e===tt.EAST?[1,3]:e===tt.SOUTH_EAST?[3]:e===tt.SOUTH?[2,3]:e===tt.SOUTH_WEST?[2]:e===tt.WEST?[0,2]:[0],s=n=>{const o=n.children;!r(n)&&o[0]&&i.forEach(a=>s(o[a]))};s(this)}getNeighborEdgeStartVertexIndex(e,r){if(!r)return 0;const i=this.level-r.level;if(be(!Ks||i>=0),i===0)return 0;const s=2**i,n=(1&e)==1,o=n?0:1,a=r.lij[o+1]*s,l=this.lij[o+1],c=l-a,u=n?s-1-c:c;return Ks&&(be(a<=l&&l<a+s),be(0<=u&&u<s)),u}forEachLoadedNeighbor(e){const r=this.level,i=s=>s.level===r||s.isLoaded;em.forEach(s=>{const n=this.findNeighborTile(s,i);n!=null&&n!==this&&n.forAllSubtreeOnSide(MH(s),o=>!!o.isLoaded&&(e(o,s),!0))}),cL.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,i))==null?void 0:o.findCorner(lL(s),a=>a.isLoaded);be(!n||cz(this,n,s)),n!=null&&n.isLoaded&&e(n,s)})}getNeighborLIJ(e,r){const i=Gee(r)?-1:Vee(r)?1:0,s=Bee(r)?-1:zee(r)?1:0,n=[e[0],e[1]+i,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){const e=this.surface.extent,r=(e==null?void 0:e[1])??null;return r!=null&&this.extent[1]+Qn()>=r}checkGeometryWaterproofness(){var e;oL&&(be(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const r=this.extent,i=this.surface.rootTilesExtent,s=.25*(r[2]-r[0]);if(Gee(e)&&r[3]+s>=i[3]||Vee(e)&&r[1]-s<=i[1])return!1;const n=this.surface.isGlobal;return!(!n&&Bee(e)&&r[0]-s<=i[0])&&!(!n&&zee(e)&&r[2]+s>=i[2])}updateDistanceToPOI(e){const r=this._lastPOI;if(this.distanceToPOI>=0&&r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2])return;ie(this._lastPOI,e);const i=this._center[Cs.MIDDLE],s=e[0]-i[0],n=e[1]-i[1],o=e[2]-i[2];this.distanceToPOI=s*s+n*n+o*o}};function ist(t,e,r,i){const s=r===Vt.ELEVATION?NH.acquire():DH.acquire();return s.init(t,e,r,i),s}function XO(t){t.dispose(),t instanceof Jve?NH.release(t):t instanceof Qve&&DH.release(t)}const DH=new Vo(Qve),NH=new Vo(Jve),sst=new Yw;var Cs;function nst(t,e){const r=t.level,i=e[0];if(r>i)return!1;const s=i-r,n=Math.floor(e[1]/2**s),o=Math.floor(e[2]/2**s);return n===t.lij[1]&&o===t.lij[2]}function ost(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function ast(t,e,r){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&r===tt.EAST||t.isWestEnd&&e.isEastEnd&&r===tt.WEST))return!0;const i=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(r){case tt.NORTH:return yu(t.extent[3],e.extent[1],i);case tt.SOUTH:return yu(t.extent[1],e.extent[3],i);case tt.EAST:return yu(t.extent[2],e.extent[0],i)||yu(t.extent[2],-e.extent[0],i);case tt.WEST:return yu(t.extent[0],e.extent[2],i)||yu(t.extent[0],-e.extent[2],i)}}function cz(t,e,r){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?ite(t,e,r):ite(e,t,lL(r)))}function ite(t,e,r){be(t.level>=e.level);const i=Trt(r),s=Srt(r),n=t.extent,o=e.extent,a=[i?n[0]:n[2],s?n[3]:n[1]],l=[i?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),u=yu(a[0],l[0],c)||t.surface.isGlobal&&yu(a[0],-l[0],c),d=yu(a[1],l[1],c);if(u&&d)return!0;if(t.level===e.level||!u&&!d)return be(!1),!1;const p=u?ste(o[1],o[3],n[1],n[3],c):ste(o[0],o[2],n[0],n[2],c);return be(p),p}function ste(t,e,r,i,s){return t-s<=r&&r<=i&&i<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(Cs||(Cs={}));const ZO=E(),s6=E(),n6=E(),Nn=E();let lst=class{constructor(){this._scales=Ot(-1,-1,-1,-1),this._offsets=Ot(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,r,i){this._scales[2*e]=r,this._scales[2*e+1]=i}setOffset(e,r,i){this._offsets[2*e]=r,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}};function cst(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(b`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(b`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(b`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}var xp;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(xp||(xp={}));let ust=class extends Ij{constructor(){super(...arguments),this.overlayOpacity=1}};function hst(t,e){const{vertex:r,fragment:i,varyings:s}=t;s.add("vtc","vec2"),r.uniforms.add(new nte("texOffsetAndScale")),i.uniforms.add(new ote("tex")),i.uniforms.add(new o6("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(r.uniforms.add(new nte("nextTexOffsetAndScale")),s.add("nvtc","vec2"),i.uniforms.add(new ote("texNext")),i.uniforms.add(new o6("nextTexOpacities")),i.uniforms.add(new dst("fadeFactor")));const o=e.tileBlendInput===xp.ColorComposite,a=e.tileBlendInput===xp.GridComposite;a&&i.include(IH),o&&i.uniforms.add(new o6("backgroundColor")),r.code.add(b`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?b`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:b``}
  }`),i.code.add(b`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?b`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?b`backgroundColor`:b`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:b`return color;`}
    }`),n?i.code.add(b`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(b`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let dst=class extends qi{constructor(e){super(e,"float")}},o6=class extends qi{constructor(e){super(e,"vec3")}},nte=class extends qi{constructor(e){super(e,"vec4")}},ote=class extends qi{constructor(e){super(e,"sampler2D")}},rbe=class extends ust{};function pst(t){const e=new dr,{vertex:r,fragment:i,varyings:s}=e;e.include(Y3),e.include(oA,t),e.include(Rp,t);const n=()=>{e.include(a3,t),r.code.add(b`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};Rl(r,t),e.include(qa,t);const o=t.overlayMode!==wp.Disabled,a=o&&t.invisible;switch(t.output){case L.Color:{e.include(hst,t),e.include(hv,t),o&&e.include(CT,{...t,pbrMode:t.pbrMode===et.Terrain?et.TerrainWithWater:et.Water});const l=t.overlayMode===wp.EnabledWithWater;l&&e.include(cst,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),t.screenSizePerspective&&e2(r);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(F2,t),t.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),r.code.add(b`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?b`forwardVertexTangent(vnormal);`:b``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?b`setOverlayVTC(uv);`:""}
          ${t.tileBorders?b`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?b`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?b`forwardLinearDepth();`:""}

        }
      `),e.include(us,t),e.include(hv,t),e.include(lA,t),e.include(dv,t),sd(i,t),cA(i),V2(i),i.uniforms.add(r.uniforms.get("localOrigin"),new Pt("viewDirection",(u,d)=>pe(ate,se(ate,d.camera.viewMatrix[12],d.camera.viewMatrix[13],d.camera.viewMatrix[14])))),l&&i.uniforms.add(new Ze("ovWaterTex",(u,d)=>{var p;return(p=d.overlay)==null?void 0:p.getTexture(Ei.WaterNormal)}),new zfe("view",(u,d)=>Ya(fst,d.camera.viewMatrix,u.origin))),i.code.add(b`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),Lm(i),Jp(i),i.code.add(b`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?b`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?b`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===et.Terrain||t.pbrMode===et.TerrainWithWater?b`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:b`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?b`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?b`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?b`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:b`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?b`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case L.Depth:a&&e.include(CT,t),e.include(Em,t),Q0(e),lv(e),r.code.add(b`
              void main(void) {
                ${a?b`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(b`
              void main() {
                ${a?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:e.include(Em,t),Q0(e),lv(e),r.code.add(b`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(b`void main() {
outputDepth(linearDepth);
}`);break;case L.Normal:a&&e.include(CT,t),s.add("vnormal","vec3"),e2(r),n(),r.code.add(b`
            void main(void) {
              ${a?b`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),i.code.add(b`
            void main() {
              ${a?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case L.Highlight:o&&e.include(CT,t),r.code.add(b`
          void main() {
            ${o?b`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(_y,t),i.code.add(b`
          void main() {
            ${o?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===L.ObjectAndLayerIdColor&&(o?(e.include(CT,{...t,pbrMode:et.Disabled}),r.code.add(b`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(b`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(r.code.add(b`void main(void) {}`),i.code.add(b`void main() {
fragColor = vec4(0.0);
}`))),e}const fst=ge(),ate=E(),mst=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:rbe,build:pst},Symbol.toStringTag,{value:"Module"}));let ibe=class sbe extends Sr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,r){r.spherical=e.viewingMode===$e.Global}initializeProgram(e){return new vr(e.rctx,sbe.shader.get().build(this.configuration),nbe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return Et({blending:r.renderOccluded?Dl(ve.ONE,ve.ONE_MINUS_SRC_ALPHA):null,culling:i?_G:null,depthTest:r.renderOccluded?null:{func:Ar.LESS},depthWrite:r.renderOccluded?null:Xa,colorWrite:Ut,stencilTest:e?DGe(Wa.IntegratedMeshMaskExcluded):null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}};ibe.shader=new _r(mst,()=>he(()=>import("./Terrain.glsl-f08eea4e.js"),[],import.meta.url));const nbe=new Map([[R.POSITION,0],[R.UV0,1],[R.NORMALCOMPRESSED,2]]);let gst=class{constructor(){this.geometry=new xit,this.intersectionData=null,this.geometryState=null,this._textureRef=new Wve(()=>this.tile.surface.textureFadeDuration),this.overlay=new lst,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const r=this.geometry;r.indices=null,r.vertexAttributes=null,ui(r.boundingBox),r.indexCount=0,r.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new Eit,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Ks&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)be(this.geometry.outerEdges[r].count===this.geometryState.neighborData.edgeResolutions[r]+1)}_calculateEdgeResolution(e,r){var l;const i=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const c=i.surface.extent;if(c!=null&&(e===0&&i.extent[3]>c[3]||e===1&&i.extent[2]>c[2]||e===2&&i.extent[1]<c[1]||e===3&&i.extent[0]<c[0]))return s}const n=i.level,o=em[e];if(!r)return be(((l=i.surface)==null?void 0:l.rootTiles)==null||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),s;if(r.isLoaded){const c=r,u=c.renderData.geometryState,d=n-c.level;if(be(d>=0),d===0){const y=u.numVerticesPerSide-1;return Math.max(y,s)}const p=2**d,g=u.neighborData.edgeResolutions[(e+2)%4]/p;return Math.max(1,g)}be(!r.isLeaf);let a=s;return r.forAllSubtreeOnSide(MH(o),c=>c===i||(c.isLoaded?(a=Math.max(a,2**(c.level-n)),!0):(be(!c.isLeaf),!1))),a}updateNeighborData(){var a;const e=this.tile;if(!e.intersectsClippingArea)return;const r=e.renderData.geometryState.neighborData,i=l=>(l.isLoaded||l.level===e.level)&&(l==null?void 0:l.intersectsClippingArea),s=r.edgePeerNeighbors,n=r.edgePeerNeighborSamplerVersions;for(let l=0;l<4;++l){const c=e.findNeighborTile(em[l],i),u=c1(e,c),d=((a=u==null?void 0:u.renderData)==null?void 0:a.geometryState.samplerDataVersion)??-1,p=s[l],g=u!==c1(e,p),y=n[l]!==d;s[l]=c,(g||y)&&(n[l]=d,this._markEdgeDirty(l));const _=r.edgeResolutions[l],v=this._calculateEdgeResolution(l,c);be(J1(v)),be(v>=1),r.edgeResolutions[l]=v,_!==v&&this._markEdgeResolutionDirty(l)}const o=r.cornerPeerNeighbors;for(let l=0;l<4;++l){const c=e.findNeighborTile(cL[l],i);o[l]=c;const u=c1(e,s[l]),d=c1(e,s[(l+1)%4]),p=c1(e,c);rh[l]=p,rh[(l+1)%4]=d,rh[(l+2)%4]=e,rh[(l+3)%4]=u,be(rh.some(v=>(v==null?void 0:v.isLoaded)||v===e));const g=rh.reduce((v,w)=>Math.min(v,(w==null?void 0:w.level)??1/0),1/0);rh.forEach((v,w)=>{v&&(v==null?void 0:v.level)>g&&(rh[w]=null)}),be(rh.some(v=>(v==null?void 0:v.isLoaded)||v===e));const y=r.cornerNeighborData[l].cornerTiles,_=r.cornerNeighborData[l].cornerTileSamplerVersions;for(let v=0;v<4;++v){const w=rh[v],x=(w==null?void 0:w.renderData.geometryState.samplerDataVersion)??-1,T=y[v]!==w,S=!T&&_[v]!==x;(T||S)&&(y[v]=w,_[v]=x,this._markCornerDirty(l))}be(y.some(v=>(v==null?void 0:v.isLoaded)||v===e))}Ks&&be(this.geometryState.neighborData.edgeResolutions.every(l=>l>0));for(let l=0;l<4;++l)rh[l]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Ks&&be(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const r=this.tile,i=this._vao,s=this.geometry.vertexAttributes,n=!i||!s||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!n&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;n?(this.releaseGeometry(),this._createGeometry(e)):o||a?r.updateEdgeElevations():a?r.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=Ke(this._vao),this.geometry.release(),!0)}ensureTexture(e,r,i){const s=r?ut.RGBA:ut.RGB;return this._texture==null||this._texture.descriptor.width===e&&this._texture.descriptor.pixelFormat===s||this.releaseTexture(),this._texture==null&&(this._texture=i(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const r=1<<e;this._dirtyCorners|=r}_markEdgeDirty(e){const r=1<<e;this._dirtyEdges|=r,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const r=1<<e;this._dirtyEdgeResolutions|=r,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),r=this.tile,i=e.samplerData?r.getElevationVerticesPerSide(e.maxTileLevel):r.getDefaultVerticesPerSide(),s=Math.max(i,5);let n=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),pm(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0);const l=r.surface.wireframe;return o.wireframe!==l&&(this._wireframeChanged=!0,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const r=this.geometry.vertexAttributes,i=this.geometry.indices,s=e.gl;this._vao=new pd(e,nbe,{geometry:Ul(r.layout)},{geometry:Cr.createVertex(e,s.STATIC_DRAW,r.buffer)},Cr.createIndex(e,s.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,r=hm.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,r=this.tile.layerInfo[Vt.ELEVATION],i=r.length,s=new Array(i);let n=0,o=0,a=!1;for(let u=0;u<i;u++){const d=r[u];if(d.upsampleInfo!=null){const p=d.upsampleInfo.tile,g=p.layerInfo[Vt.ELEVATION][u].data,y=g&&g.samplerData;e&&e[n]===y||(a=!0),s[n++]=y,o=Math.max(o,p.lij[0])}else if(d.data){const p=this.tile.surface.layerViewByIndex(u,Vt.ELEVATION);if(hC(this.tile,p.layer,!1)){const g=d.data;e&&e[n]===g.samplerData||(a=!0),s[n++]=g.samplerData,o=this.tile.level}}}e!=null&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var r,i,s;const e=((r=this.intersectionData)==null?void 0:r.estimatedMemoryUsage)??0;return(((i=this.geometry.indices)==null?void 0:i.byteLength)??0)+(((s=this.geometry.vertexAttributes)==null?void 0:s.byteLength)??0)+e}get texture(){return this._texture}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!Ks)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void be(e==null?void 0:e.isLoaded);const r=e.surface.extent;if(r!=null&&!e.intersectsExtent(r))return;const i=em.map((a,l)=>r!=null&&(l<2?-1:1)*(e.extent[3-l]-r[3-l])<0),s=e.level;be(this._dirtyCorners===0),be(this._dirtyEdges===0),be(this._dirtyEdgeResolutions===0),be(!this._numVerticesPerSideChanged),be(!this._samplerDataChanged),be(!this._clippingAreaChanged),be(!this._wireframeChanged);const n=cL.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a!=null&&a.intersectsClippingArea?a:null),o=this.geometryState.neighborData;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=n[a];be(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l==null?void 0:l.lij}] exp=[${c==null?void 0:c.lij}]`)}em.forEach((a,l)=>{if(i[l])return;const c=e.findNeighborTile(a,B=>(B.level===s||(B==null?void 0:B.isLoaded))&&(B==null?void 0:B.intersectsClippingArea));if(!c){const B=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void be(!B)}be(c.isLoaded||c.level===e.level),be(c===this.geometryState.neighborData.edgePeerNeighbors[l]);const u=s-c.level;if(!c.isLoaded)return be(!c.isLeaf),void be(u===0);const d=c.renderData;be(ast(e,c,a)),be(u>=0);const p=2**u;if(u<0)return void be(!1);const g=e.renderData,y=g.geometry,_=y.outerEdges[l],v=y.numVerticesPerSide-1,w=d.geometry;if(!w)return void be(!1);const x=this.geometryState.neighborData.edgePeerNeighbors[l];if(x!=null&&x.isLoaded){const B=x.renderData;be(x==x),be(g.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===B.geometryState.samplerDataVersion),be(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===B.geometryState.samplerDataVersion)}const T=(l+2)%4,S=w.outerEdges[T],C=_.count-1,A=S.count-1;be(C*p===A,`Tile[${e.lij}]:e${l},res=${C} edgeRes mismatch with Neighbor[${c.lij}]:e${T},res=${A} (expected:${C*p})`);const O=e.extent,$=a===tt.NORTH||a===tt.SOUTH,D=S.count-1,N=D/2**u,z=_.count-1;if(N<1)return void be(z===1);be(N===z),be(J1(N));const U=w.numVerticesPerSide-1;be(u>0||N===Math.max(U,v));const Y=e.getNeighborEdgeStartVertexIndex(l,c);be(0<=Y&&Y<p);const H=Y*N;be(0<=H&&H<=D-N);let V=0,J=H;_.getVertexPos(Dd,0),_.getVertexPos(Nd,_.count-1);const P=hi(Dd,Nd),I=Math.max(yst,1e-4*P);for(let B=0;B<=N;++B){_.getVertexPos(Dd,V),S.getVertexPos(Nd,J);const G=B/N,q=$?O[0]+G*(O[2]-O[0]):a===tt.WEST?O[0]:O[2],Z=$?a===tt.SOUTH?O[1]:O[3]:O[1]+G*(O[3]-O[1]),K=e.surface.extent;if(K==null||oD(K,q,Z)){const fe=R3(Dd,Nd),Pe=ml(Dd)-mr.radius,lt=ml(Nd)-mr.radius,Tt=fe<I;if(!Tt){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${V}/${_.count}] and [${c.lij}].edge${T}[${J}/${S.count}]`),K!=null&&console.warn("  surface extent= ",K," x,y=",q,",",Z);const Be=E();ce(Be,g.localOrigin,d.localOrigin),ml(Be)>0&&console.warn(`   localOrigins: ${g.localOrigin} vs ${d.localOrigin} d=${ml(Be)} [${Be}]`),(()=>{const Re=Ii(Dd),Ce=Ii(Nd);e.updateEdgeElevations(),c.updateEdgeElevations(),_.getVertexPos(Dd,V),S.getVertexPos(Nd,J);const _t=E();Rn(_t,Dd,Re),ml(_t)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${Re} vs ${Dd} d=${ml(_t)} [${_t}]`),Rn(_t,Nd,Ce),ml(_t)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${Ce} vs ${Nd} d=${ml(_t)} [${_t}]`)})(),be(Tt,`Mismatch in tile [${e.lij}].edge[${l}][${V}/${_.count}] vs neighbor [${c.lij}].edge[${T}][${J}/${S.count}] ${vf(Dd)} vs ${vf(Nd)}  dist=${fe} h(t|n|d)=${Pe}|${lt}|${lt-Pe}`)}_.getNormal(Lb,V),S.getNormal(Db,J),pe(lte,Lb),pe(cte,Db);const it=de(lte,cte),dt=1-it<.01||!1||e===c;if(!dt){const Be=E();Rn(Be,Lb,Db);const Re=()=>`Mismatch in tile edge normal ${kee(e.lij)} (${V}/${_.count-1}) edge ${l} vs neighbor ${kee(c.lij)}  (${J}/${S.count-1}) nedge ${T} :${vf(Lb)} vs ${vf(Db)}  dot = ${it} : ${vf(Be)}`;console.warn("Mismatch in tile edge normal: ",Re());{e.updateEdgeElevations(),c.updateEdgeElevations();const Ce=E(),_t=E();_.getNormal(Ce,V),S.getNormal(_t,J),Y1(Lb,Ce)||console.warn("Missing update in tile normal: ",vf(Lb)," => ",vf(Ce)),Y1(Db,_t)||console.warn("Missing update in neighbor normal: ",vf(Db)," => ",vf(_t))}be(dt,Re())}}V+=1,J+=1}})}};const Dd=E(),Nd=E(),Lb=E(),Db=E(),lte=E(),cte=E(),yst=1,rh=[null,null,null,null];function c1(t,e){return e!=null&&e.isLoaded||e===t?e:null}const _st=65536;function vst(t,e){const r=t.tile,{extent:i,extentInRadians:s,surface:n}=r,o=t.localOrigin,a=t.geometryState,l=n.isWebMercator,c=a.numVerticesPerSide,u=c-1,d=(c-2)**2,p=l&&(e===gu.HAS_SOUTH_POLE||e===gu.HAS_BOTH_POLES),g=l&&(e===gu.HAS_NORTH_POLE||e===gu.HAS_BOTH_POLES),y=6,_=((p?1:0)+(g?1:0))*y*(u+1),v=a.neighborData,w=v.edgeResolutions.reduce(($,D)=>$+D+1,0),x=d+_+w,T=n.renderer.tileGeometryCache.acquire(x),S=t.geometry;S.numVerticesPerSide=a.numVerticesPerSide,S.vertexAttributes=T;const C=S.boundingBox;ui(C);const A=FH(t);Gn.update(u,s,A),bst(t),mbe(t,d),obe(t);const O=[];if((()=>{let $=d+w;const D=o[0],N=o[1],z=o[2],U=r.ellipsoid.radius,Y=i[1],H=i[3],V=(J,P)=>{const I=P*c;Eu(-D,-N,J*U-z,C),O.push({connectedRowOffset:I,connectedOuterEdgeOffset:J===1?0:2,rowOffset:$,latitudeResolution:y});const B=cbe(J===-1?Y:H,U),G=J*Math.PI/2-B,q=.99*(J===1?1:-1),Z=U+0,{position:K,uv0:fe}=T,{typedBuffer:Pe,typedBufferStride:lt}=T.normalCompressed;for(let Tt=1;Tt<=y;++Tt){const it=B+G*(Tt/y),dt=Math.cos(it),Be=Math.sin(it);for(let Re=0;Re<=u;Re++){const Ce=Re/u,_t=Gn.sinLonLUT[Re],Se=Gn.cosLonLUT[Re]*dt,Ne=_t*dt,We=Be,ht=Se*Z-D,bt=Ne*Z-N,Ct=We*Z-z;Eu(ht,bt,Ct,C),K.setValues($,ht,bt,Ct),Jh(fe,$,Ce,q),mv(Pe,$,Se,Ne,We,lt),++$}}};p&&V(-1,0),g&&V(1,u)})(),fbe(S,a.numVerticesPerSide,O,[0,c-1],[0,c-1],a.wireframe),t.intersectionData=null,Ks)for(let $=0;$<4;++$)be(S.outerEdges[$].count===v.edgeResolutions[$]+1)}function bst(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=t.geometryState,i=r.numVerticesPerSide,s=i-2,n=i-1,o=t.geometry,a=o.vertexAttributes,l=a.position,c=a.uv0,{typedBuffer:u,typedBufferStride:d}=a.normalCompressed,p=e.extent,g=p[0],y=p[2],_=p[1],v=p[3],w=e.ellipsoid.radius,x=r.samplerData,T=t.localOrigin,S=T[0],C=T[1],A=T[2],O=l.typedBuffer,$=l.typedBufferStride,D=1/n,N=o.boundingBox;let z=0;if(1<=s){const U=D,Y=_*(1-U)+v*U,H=Gn.sinLatLUT[1],V=Gn.cosLatLUT[1];for(let J=1;J<=s;J++){const P=J*D,I=g*(1-P)+y*P,B=Gn.sinLonLUT[J],G=Gn.cosLonLUT[J],q=w+Bi(I,Y,x),Z=q*G*V-S,K=q*B*V-C,fe=q*H-A;Eu(Z,K,fe,N);const Pe=(J-1)*$;O[Pe]=Z,O[Pe+1]=K,O[Pe+2]=fe,Jh(c,J-1,P,U)}}for(let U=1;U<=s;U++){const Y=U*D,H=_*(1-Y)+v*Y,V=Gn.sinLatLUT[U],J=Gn.cosLatLUT[U],P=U+1,I=P*D,B=_*(1-I)+v*I,G=Gn.sinLatLUT[P],q=Gn.cosLatLUT[P],Z=Gn.sinLonLUT[0],K=Gn.cosLonLUT[0],fe=w+Bi(g,H,x);let Pe=K*J*fe-S,lt=Z*J*fe-C,Tt=V*fe-A;const it=z*$;let dt=O[it],Be=O[it+1],Re=O[it+2];for(let Ce=1;Ce<=s;Ce++){const _t=Ce*D,Se=g*(1-_t)+y*_t,Ne=Gn.sinLonLUT[Ce],We=Gn.cosLonLUT[Ce];let ht=0,bt=0,Ct=0;if(Ce<s){const fr=(z+1)*$;ht=O[fr],bt=O[fr+1],Ct=O[fr+2]}else{const fr=Gn.sinLonLUT[n],Qr=Gn.cosLonLUT[n],Ai=w+Bi(y,H,x);ht=Qr*J*Ai-S,bt=fr*J*Ai-C,Ct=V*Ai-A}const Gr=Pe,Ie=lt,Lt=Tt;Pe=dt,lt=Be,Tt=Re,dt=ht,Be=bt,Re=Ct;const Fe=ht-Gr,mt=bt-Ie,gt=Ct-Lt;let Mt=0,$t=0,jr=0;if(U>1){const fr=(z-s)*$;Mt=O[fr],$t=O[fr+1],jr=O[fr+2]}else{const fr=Gn.sinLatLUT[0],Qr=Gn.cosLatLUT[0],Ai=w+Bi(Se,_,x);Mt=We*Qr*Ai-S,$t=Ne*Qr*Ai-C,jr=fr*Ai-A}const ai=w+Bi(Se,B,x),Hr=We*q*ai-S,Bt=Ne*q*ai-C,pr=G*ai-A;if(U<s){const fr=z+s,Qr=fr*$;O[Qr]=Hr,O[Qr+1]=Bt,O[Qr+2]=pr,Eu(Hr,Bt,pr,N),Jh(c,fr,_t,I)}const Er=Mt-Hr,pi=$t-Bt,vi=jr-pr;let br=We*J,ar=Ne*J,bi=V;bi*bi<.999&&(br=gt*pi-mt*vi,ar=Fe*vi-gt*Er,bi=mt*Er-Fe*pi);const Jr=1/Math.sqrt(br*br+ar*ar+bi*bi);mv(u,z,br*Jr,ar*Jr,bi*Jr,d),++z}}}function wst(t){t.tile.intersectsClippingArea&&(obe(t),HN(t))}function xst(t){t.tile.intersectsClippingArea&&(lbe(t),abe(t,!0),HN(t))}function obe(t){t.tile.intersectsClippingArea&&(lbe(t),abe(t))}function abe(t,e=!1){const r=t.geometryState,i=t.geometry,s=r.neighborData,n=t.tile,o=n.level,a=n.extent,l=n.ellipsoid.radius,c=n.extentInRadians,u=c[0],d=c[2],p=c[1],g=c[3],y=r.samplerData,_=a[0],v=a[2],w=a[1],x=a[3],T=FH(t),S=i.boundingBox,C=t.localOrigin,A=C[0],O=C[1],$=C[2],D=i.vertexAttributes,N=D.position,z=N.typedBuffer,U=N.typedBufferStride,Y=D.uv0;for(let H=0;H<4;++H){const V=H===1||H===3,J=s.edgeResolutions[H];be(J1(J));const P=J+1,I=c1(n,s.edgePeerNeighbors[H]);if(_be(n,I,H)){gbe(t,H,I);continue}const B=I!=null;be(!B||I.level===n.level),be(!B||dm(n,I)<=0);const G=I==null?void 0:I.renderData,q=G==null?void 0:G.geometryState;if(Ks){const Fe=n.surface;if(!I&&Fe&&!Fe.updatingRootTiles){const mt=em[H],gt=n.findNeighborTile(mt,Mt=>Mt.isLoaded||Mt.isLeaf||Mt.level===n.level);gt?gt.intersectsClippingArea&&(be(!gt.isLoaded),be(!gt.isLeaf),be(gt.level===o)):be((Fe==null?void 0:Fe.rootTiles)==null||!n.shouldHaveNeighbor(mt))}}const Z=H===1?a[2]:a[0],K=I==null?void 0:I.extent,fe=K&&V?H===1?K[0]:K[2]:Z,Pe=H===0?a[3]:a[1],lt=H===1?1:0,Tt=H===0?1:0,it=H===1?d:u,dt=H===0?g:p,Be=Math.sin(it),Re=Math.cos(it),Ce=Math.sin(dt),_t=Math.cos(dt),Se=q==null?void 0:q.samplerData,Ne=B?(Fe,mt,gt)=>.5*(Bi(Fe,mt,y)+Bi(gt,mt,Se)):(Fe,mt,gt)=>Bi(Fe,mt,y),We=i.outerEdges[H],ht=e&&P>3?P-3:1,bt=y!=null&&y.some(Fe=>Fe!=null),Ct=Se!=null&&Se.some(Fe=>Fe!=null),Gr=bt||Ct,Ie=1/J,Lt=We.index0;be(!K||yu(K[2]-K[0],a[2]-a[0])),(()=>{const Fe=H===1?-1:H===3?1:0,mt=H===0?-1:H===2?1:0,gt=(a[2]-a[0])*Ie,Mt=Fe*gt,$t=mt*gt,jr=V?Fe*((d-u)*Ie):0,ai=V?0:mt*Ie,Hr=Tt,Bt=V?it+jr:it,pr=V?Math.sin(Bt):Be,Er=V?Math.cos(Bt):Re,pi=V?it-jr:it,vi=V?Math.sin(pi):Be,br=V?Math.cos(pi):Re,ar=V?dt:T(Hr+ai),bi=V?Ce:Math.sin(ar),Jr=V?_t:Math.cos(ar),fr=V?dt:T(Hr-ai),Qr=V?Ce:Math.sin(fr),Ai=V?_t:Math.cos(fr);let ps=0,In=0,Ln=0;{const or=0*Ie,hn=V?Z:_*(1-or)+v*or,eo=V?fe:hn,Yo=V?w*(1-or)+x*or:Pe,re=V?it:u*(1-or)+d*or,fi=V?Be:Math.sin(re),ju=V?Re:Math.cos(re),dn=V?T(or):dt,Hu=V?Math.sin(dn):Ce,Ye=V?Math.cos(dn):_t,Ja=l+Ne(hn,Yo,eo);ps=ju*Ye*Ja,In=fi*Ye*Ja,Ln=Hu*Ja}let _o=0,ts=0,Ri=0;{const or=1*Ie,hn=V?Z:_*(1-or)+v*or,eo=V?fe:hn,Yo=V?w*(1-or)+x*or:Pe,re=V?it:u*(1-or)+d*or,fi=V?Be:Math.sin(re),ju=V?Re:Math.cos(re),dn=V?T(or):dt,Hu=V?Math.sin(dn):Ce,Ye=V?Math.cos(dn):_t,Ja=l+Ne(hn,Yo,eo);_o=ju*Ye*Ja,ts=fi*Ye*Ja,Ri=Hu*Ja}for(let or=1;or<P-1;or+=ht){let hn=0,eo=0,Yo=0;{const Xo=(or+1)*Ie,Qa=V?Z:_*(1-Xo)+v*Xo,gd=V?fe:Qa,fn=V?w*(1-Xo)+x*Xo:Pe,Wi=V?it:u*(1-Xo)+d*Xo,jm=V?Be:Math.sin(Wi),Sy=V?Re:Math.cos(Wi),Ey=V?T(Xo):dt,Fv=V?Math.sin(Ey):Ce,Cy=V?Math.cos(Ey):_t,Hm=l+Ne(Qa,fn,gd);hn=Sy*Cy*Hm,eo=jm*Cy*Hm,Yo=Fv*Hm}const re=hn,fi=eo,ju=Yo,dn=_o,Hu=ts,Ye=Ri;_o=re,ts=fi,Ri=ju;{const Xo=Lt+or,Qa=Xo*U,gd=dn-A,fn=Hu-O,Wi=Ye-$;z[Qa]=gd,z[Qa+1]=fn,z[Qa+2]=Wi,Eu(gd,fn,Wi,S);const jm=or*Ie;Jh(Y,Xo,V?lt:jm,V?jm:Tt)}const Ja=ps,pn=In,wy=Ln;ps=dn,In=Hu,Ln=Ye;const xy=dn,va=Hu,nf=Ye,Ty=1/Math.sqrt(xy*xy+va*va+nf*nf),qt=nf*Ty;let Vm=0,of=0,Gm=0;if(Gr&&qt*qt<.999){let Xo=0,Qa=0,gd=0;{const fn=H===0?-1:1;Xo=fn*(re-Ja),Qa=fn*(fi-pn),gd=fn*(ju-wy)}{const fn=or*Ie,Wi=V?Z:_*(1-fn)+v*fn,jm=V?fe:Wi,Sy=V?w*(1-fn)+x*fn:Pe,Ey=V?it:u*(1-fn)+d*fn,Fv=V?Be:Math.sin(Ey),Cy=V?Re:Math.cos(Ey),Hm=V?T(fn):dt,wA=V?Math.sin(Hm):Ce,ba=V?Math.cos(Hm):_t;let j2=xy,H2=va,j=nf;if(B){const ue=l+Bi(jm-Mt,Sy-$t,Se),we=V?ba:Ai;j2=(V?br:Cy)*we*ue,H2=(V?vi:Fv)*we*ue,j=(V?wA:Qr)*ue}{const ue=l+Bi(Wi+Mt,Sy+$t,y),we=V?ba:Jr,sr=(V?Er:Cy)*we*ue,Ms=(V?pr:Fv)*we*ue,li=(V?wA:bi)*ue;B||(j2=2*xy-sr,H2=2*va-Ms,j=2*nf-li);const Zo=H===3?-1:1,Ay=Zo*(j2-sr),oq=Zo*(H2-Ms),aq=Zo*(j-li);Vm=gd*oq-Qa*aq,of=Xo*aq-gd*Ay,Gm=Qa*Ay-Xo*oq;const QN=1/Math.sqrt(Vm*Vm+of*of+Gm*Gm);Vm*=QN,of*=QN,Gm*=QN}}}else Vm=xy*Ty,of=va*Ty,Gm=nf*Ty;We.setNormalFromValues(or,Vm,of,Gm)}})()}}function lbe(t){ybe(t)}function cbe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function Tst(t,e,r,i){return cbe(t*(1-i)+e*i,r)}function Sst(t,e,r){return t*(1-r)+e*r}function FH(t){const e=t.tile;if(e.surface.isWebMercator){const i=e.extent,s=e.ellipsoid.radius;return n=>Tst(i[1],i[3],s,n)}const r=e.extentInRadians;return i=>Sst(r[1],r[3],i)}function Est(t,e){const r=t.tile,{extent:i,surface:s}=r,n=t.geometryState,o=i[0],a=i[1],l=i[2]-o,c=i[3]-a,u=n.clippingArea,d=u!=null?Math.max(0,(u[0]-o)/l):0,p=u!=null?Math.max(0,(u[1]-a)/c):0,g=u!=null?Math.min(1,(u[2]-o)/l):1,y=u!=null?Math.min(1,(u[3]-a)/c):1,_=n.numVerticesPerSide,v=(_-2)**2,w=v+n.neighborData.edgeResolutions.reduce((C,A)=>C+A+1,0),x=s.renderer.tileGeometryCache.acquire(w),T=t.geometry,S=T.boundingBox;ui(S),T.numVerticesPerSide=n.numVerticesPerSide,T.vertexAttributes=x,Si(T.uvRange,d,p,g,y),Cst(t),mbe(t,v),ube(t),fbe(T,n.numVerticesPerSide,[],[0,_-1],[0,_-1],n.wireframe),t.intersectionData=null}function Cst(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=e.surface,i=t.geometryState,s=i.samplerData,n=t.localOrigin,o=r.isWebMercatorOnPlateeCarree,a=i.clippingArea,l=a??UH,c=e.extent,u=c[0],d=c[1],p=c[2],g=c[3],y=Math.max(u,l[0]),_=Math.min(p,l[2]),v=Math.max(d,l[1]),w=Math.min(g,l[3]),x=e.ellipsoid.radius,T=e.horizontalScale,S=i.numVerticesPerSide,C=S-1,A=S-2,O=t.geometry,$=O.vertexAttributes,D=$.position,N=$.uv0,{typedBuffer:z,typedBufferStride:U}=$.normalCompressed,Y=O.uvRange,H=Y[0],V=Y[1],J=Y[2],P=Y[3],I=O.boundingBox,B=n[0],G=n[1],q=n[2],Z=D.typedBuffer,K=D.typedBufferStride;let fe=0;const Pe=me(d,v,w),lt=o?(Math.PI/2-2*Math.atan(Math.exp(-Pe/x)))*x:Pe*T,Tt=1/C,it=me(d*(1-Tt)+g*Tt,v,w);let dt=lt,Be=o?(Math.PI/2-2*Math.atan(Math.exp(-it/x)))*x:it*T;for(let Re=1;Re<=A;Re++){const Ce=Re/C,_t=me(d*(1-Ce)+g*Ce,v,w),Se=me(Ce,V,P),Ne=Be,We=(Re-1)/C,ht=me(d*(1-We)+g*We,v,w),bt=dt,Ct=(Re+1)/C,Gr=me(d*(1-Ct)+g*Ct,v,w),Ie=o?(Math.PI/2-2*Math.atan(Math.exp(-Gr/x)))*x:Gr*T,Lt=me(Ct,V,P);dt=Be,Be=Ie;const Fe=me(u,y,_);let mt=Fe*T,gt=Bi(Fe,_t,s);const Mt=1/C,$t=me(Mt,H,J),jr=me(u*(1-$t)+p*$t,y,_);let ai=$t,Hr=jr,Bt=jr*T,pr=Bi(jr,_t,s);if(Re===1){const Er=Bt-B,pi=dt-G,vi=pr-q,br=0*K;Z[br]=Er,Z[br+1]=pi,Z[br+2]=vi,Eu(Er,pi,vi,I);const ar=me(Mt,H,J);Jh(N,fe,ar,Se)}for(let Er=1;Er<=A;Er++){const pi=Bt,vi=pr,br=(Er+1)/C,ar=me(br,H,J),bi=me(u*(1-br)+p*br,y,_),Jr=Hr;Hr=bi;{const ts=fe+1,Ri=ts*K;if(Re===1||Er===A){const or=bi*T,hn=Bi(bi,_t,s);if(Re===1&&Er<A){const eo=or-B,Yo=Ne-G,re=hn-q;Z[Ri]=eo,Z[Ri+1]=Yo,Z[Ri+2]=re,Eu(eo,Yo,re,I),Jh(N,ts,ar,Se)}Bt=or,pr=hn}else Bt=Z[Ri]+B,pr=Z[Ri+2]+q}const fr=Bt,Qr=pr,Ai=mt,ps=gt;mt=pi,gt=vi;const In=(fe-A)*K,Ln=Re===1?Bi(Jr,ht,s):Z[In+2]+q,_o=Bi(Jr,Gr,s);if(Re<A){const ts=fe+A,Ri=ts*K,or=pi-B,hn=Ie-G,eo=_o-q;Z[Ri]=or,Z[Ri+1]=hn,Z[Ri+2]=eo,Eu(or,hn,eo,I);const Yo=ai;ai=ar,Jh(N,ts,Yo,Lt)}{const ts=fr-Ai,Ri=bt-Ie,or=Ri*(Qr-ps),hn=ts*(Ln-_o),eo=-Ri*ts,Yo=or*or+hn*hn+eo*eo;if(Yo===0)mv(z,fe,0,0,1,U);else{const re=1/Math.sqrt(Yo);mv(z,fe,or*re,hn*re,eo*re,U)}}++fe}}}function Ast(t,e){t.tile.intersectsClippingArea&&(dbe(t),hbe(t,!0),HN(t))}function Rst(t,e){t.tile.intersectsClippingArea&&(ube(t),HN(t))}function ube(t,e){t.tile.intersectsClippingArea&&(dbe(t),hbe(t,!1))}function hbe(t,e){const r=t.geometryState,i=r.neighborData,s=t.tile,n=s.surface,o=s.extent,a=r.clippingArea,l=a??UH,c=o[0],u=o[2],d=o[1],p=o[3],g=[p>l[3],u>l[2],d<l[1],c<l[0]],y=t.geometry,_=s.horizontalScale,v=pbe(n.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,_),w=y.boundingBox,x=y.uvRange[0],T=y.uvRange[1],S=y.uvRange[2],C=y.uvRange[3],A=Math.max(c,l[0]),O=Math.min(u,l[2]),$=Math.max(d,l[1]),D=Math.min(p,l[3]),N=t.localOrigin,z=N[0],U=N[1],Y=N[2],H=r.samplerData;for(let V=0;V<4;++V){const J=V===1||V===3,P=i.edgeResolutions[V];be(J1(P));const I=P+1,B=g[V],G=c1(s,i.edgePeerNeighbors[V]);if(!B&&_be(s,G,V)){gbe(t,V,G);continue}const q=G!=null&&!B,Z=G==null?void 0:G.renderData,K=Z==null?void 0:Z.geometryState;if(Ks&&(be(!q||G.level===s.level),be(!q||dm(s,G)<=0),s&&!G&&!n.updatingRootTiles)){const Fe=em[V],mt=s.findNeighborTile(Fe,gt=>gt.isLoaded||gt.isLeaf||gt.level===s.level);n.updatingRootTiles||(mt?mt.intersectsClippingArea&&(be(!mt.isLoaded),be(!mt.isLeaf),be(mt.level===s.level)):be((n==null?void 0:n.rootTiles)==null||!s.shouldHaveNeighbor(Fe)))}const fe=me(V===1?u:c,A,O),Pe=me(V===0?p:d,$,D),lt=K==null?void 0:K.samplerData,Tt=y.outerEdges[V],it=e&&I>3?I-3:1,dt=me(V===1?1:0,x,S),Be=me(V===0?1:0,T,C),Re=q?(Fe,mt)=>.5*(Bi(Fe,mt,lt)+Bi(Fe,mt,H)):(Fe,mt)=>Bi(Fe,mt,H),Ce=(u-c)/P,_t=J?V===1?Ce:-Ce:0,Se=J?0:V===0?Ce:-Ce,Ne=-_t,We=-Se;let ht=0,bt=0,Ct=0;{const Fe=0/P,mt=J?fe:me(c*(1-Fe)+u*Fe,A,O),gt=J?me(d*(1-Fe)+p*Fe,$,D):Pe,Mt=Re(mt,gt);ht=mt*_,bt=v(gt),Ct=Mt}let Gr=0,Ie=0,Lt=0;{const Fe=1/P,mt=J?fe:me(c*(1-Fe)+u*Fe,A,O),gt=J?me(d*(1-Fe)+p*Fe,$,D):Pe,Mt=Re(mt,gt);Gr=mt*_,Ie=v(gt),Lt=Mt}for(let Fe=1;Fe<I-1;Fe+=it){const mt=Fe/P,gt=Gr,Mt=Ie,$t=Lt;{const ar=J?dt:me(mt,x,S),bi=J?me(mt,T,C):Be,Jr=gt-z,fr=Mt-U,Qr=$t-Y;Eu(gt,fr,Qr,w),Tt.setVertexFromValuesRawPositionUV(Fe,Jr,fr,Qr,ar,bi)}{const ar=(Fe+1)/P,bi=J?fe:me(c*(1-ar)+u*ar,A,O),Jr=J?me(d*(1-ar)+p*ar,$,D):Pe,fr=Re(bi,Jr);Gr=bi*_,Ie=v(Jr),Lt=fr}const jr=Gr,ai=Lt,Hr=ht,Bt=bt,pr=Ct;ht=gt,bt=Mt,Ct=$t;let Er=0,pi=0,vi=0;if(J){const ar=Ie-Mt,bi=ai-$t,Jr=Bt-Mt,fr=pr-$t,Qr=me(d*(1-mt)+p*mt,$,D),Ai=fe+Ne,ps=Ai*_-gt,In=Bi(Ai,Qr,H)-$t,Ln=V===3?-1:1;if(Er=Ln*(-Jr+ar)*In,pi=Ln*ps*(-fr+bi),vi=-Ln*ps*(-Jr+ar),q){const _o=fe+_t,ts=_o*_-gt;Er=(-Jr+ar)*(In-(Bi(_o,Qr,lt)-$t)),pi=(ps-ts)*(-fr+bi),vi=-(ps-ts)*(-Jr+ar)}}else{const ar=jr-gt,bi=ai-$t,Jr=Hr-gt,fr=pr-$t,Qr=me(c*(1-mt)+u*mt,A,O),Ai=Pe+We,ps=Bi(Qr,Ai,H)-$t,In=v(Ai)-Mt,Ln=V===2?-1:1;if(Er=Ln*In*(-fr+bi),pi=Ln*(-Jr+ar)*ps,vi=-Ln*In*(-Jr+ar),q){const _o=Qr,ts=Pe+Se,Ri=v(ts)-Mt;Er=(-In+Ri)*(-fr+bi),pi=(-Jr+ar)*(-ps+(Bi(_o,ts,lt)-$t)),vi=-(-In+Ri)*(-Jr+ar)}}const br=1/Math.sqrt(Er*Er+pi*pi+vi*vi);Tt.setNormalFromValues(Fe,Er*br,pi*br,vi*br)}}}function dbe(t,e){ybe(t)}function Ost(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function Pst(t,e){return t*e}function pbe(t,e,r){return t?i=>Ost(i,e):i=>Pst(i,r)}function fbe(t,e,r,i,s,n){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,i[1])-Math.max(1,i[0]))*(Math.min(e-2,s[1])-Math.max(1,s[0])),c=em.map((T,S)=>S===0&&s[1]<e-2||S===1&&i[1]<e-2||S===2&&s[0]>1||S===3&&i[0]>1),u=t.outerEdges.reduce((T,S,C)=>T+(c[C]?0:o-2+S.count-1),0),d=r.reduce((T,S)=>T+o*(2*(S.latitudeResolution-1)+1),0),p=n?2:1,g=3*(l+u+d)*p,y=a>=_st?new Uint32Array(g):new Uint16Array(g);let _=0;const v=e-2,w=o-2;be(w>=0);const x=(T,S,C,A,O,$)=>{const D=T*O,N=$[D],z=$[D+1],U=$[D+2],Y=S*O,H=$[Y],V=$[Y+1],J=$[Y+2],P=C*O,I=$[P],B=$[P+1],G=$[P+2],q=A*O,Z=$[q],K=$[q+1],fe=$[q+2];return(H-Z)*(H-Z)+(V-K)*(V-K)+(J-fe)*(J-fe)>(N-I)*(N-I)+(z-B)*(z-B)+(U-G)*(U-G)};if(n){const T=(C,A,O)=>{y[_++]=C,y[_++]=A,y[_++]=A,y[_++]=O,y[_++]=O,y[_++]=C,Ks&&(be(C<a),be(A<a),be(O<a),be(_<=g))};(()=>{for(let C=Math.max(s[0],1)-1;C<Math.min(s[1],e-2)-1;++C){const A=C*v;for(let O=Math.max(i[0],1)-1;O<Math.min(i[1],e-2)-1;++O){const $=C*v+O,D=$+1,N=D+v,z=N-1,U=A+O,Y=U+1,H=Y+v,V=H-1,J=t.vertexAttributes.position.typedBuffer,P=t.vertexAttributes.position.typedBufferStride;x(U,Y,H,V,P,J)?(T($,D,N),T(N,z,$)):(T($,D,z),T(z,N,D))}}})(),be(_===3*l*p),(()=>{for(let C=0;C<4;++C){const A=_;if(c[C])continue;const O=t.outerEdges[C],$=t.innerEdges[C];let D=0,N=0;const z=O.count,U=$.count;be(U===o-1);let Y=0;const H=C===1||C===2?(V,J,P)=>T(V,J,P):(V,J,P)=>T(V,P,J);for(;D<z-1||N<U-1;){const V=$.getVertexIndex(N),J=O.getVertexIndex(D),P=D<z-1,I=N<U-1;P&&(!I||(P?0+o*(D+.5)/(z-1):0)<=(I?1+w*(N+.5)/(U-1):0))?(++D,Ks&&be(D<z),H(V,J,O.getVertexIndex(D)),Y++):(++N,Ks&&be(N<U),H(V,J,$.getVertexIndex(N)),Y++)}Ks&&(be(D===z-1),be(N===U-1),be(Y===z+U-2),be(Y===o-2+O.count-1),be(_===A+3*Y*p))}})(),be(_===3*(l+u)*p);const S=C=>{const A=t.outerEdges[C.connectedOuterEdgeOffset];let O=A.getVertexIndex(0),$=A.stride;for(let D=0;D<C.latitudeResolution;++D){const N=D===0?C.rowOffset:O+e;for(let z=0;z<o;z++)T(O,O+1,N+z),D<C.latitudeResolution-1&&T(O+1,N+z+1,N+z),O+=$;O=N,$=1}};r.forEach(S)}else{(()=>{const S=Math.max(s[0],1)-1,C=Math.min(s[1],e-2)-1,A=Math.max(i[0],1)-1,O=Math.min(i[1],e-2)-1;for(let $=S;$<C;++$){const D=$*v;for(let N=A;N<O;++N){const z=D+N,U=z+1,Y=U+v,H=Y-1,V=t.vertexAttributes.position.typedBuffer,J=t.vertexAttributes.position.typedBufferStride;x(z,U,Y,H,J,V)?(y[_]=z,y[_+1]=U,y[_+2]=Y,y[_+3]=Y,y[_+4]=H,y[_+5]=z):(y[_]=z,y[_+1]=U,y[_+2]=H,y[_+3]=H,y[_+4]=U,y[_+5]=Y),_+=6}}})(),be(_===3*l*p),(()=>{for(let S=0;S<4;++S){if(c[S])continue;const C=t.outerEdges[S],A=t.innerEdges[S];let O=0,$=0;const D=C.count,N=A.count;be(N===o-1);const z=S===1||S===2,U=z?1:2,Y=z?2:1,H=C.index0,V=C.stride,J=A.index0,P=A.stride;for(;O<D-1||$<N-1;){const I=J+$*P,B=H+O*V,G=O<D-1,q=$<N-1,Z=G&&(!q||(G?0+o*(O+.5)/(D-1):0)<=(q?1+w*($+.5)/(N-1):0));Z?++O:++$;const K=Z?B+V:I+P;y[_]=I,y[_+U]=B,y[_+Y]=K,_+=3}}})(),be(_===3*(l+u)*p);const T=S=>{const C=t.outerEdges[S.connectedOuterEdgeOffset];let A=C.getVertexIndex(0),O=C.stride;for(let $=0;$<S.latitudeResolution;++$){const D=$===0?S.rowOffset:A+e;for(let N=0;N<o;N++){const z=D+N;y[_]=A,y[_+1]=A+1,y[_+2]=z,$<S.latitudeResolution-1?(y[_+3]=A+1,y[_+4]=z+1,y[_+5]=z,_+=6):_+=3,A+=O}A=D,O=1}};r.forEach(T)}be(_===g),t.indices=y,t.indexCount=g}function mbe(t,e){const r=t.localOrigin,i=t.geometry,s=t.geometryState.neighborData.edgeResolutions,n=i.numVerticesPerSide-2,o=i.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,u=(l===0?n-1:0)*n+(l===1?n-1:0),d=(c?0:1)*n+(c?1:0);i.innerEdges[l]=new Jee(o,r,u,d,n)}{const c=a,u=s[l]+1;i.outerEdges[l]=new Jee(o,r,c,1,u),a+=u}}}function gbe(t,e,r){const i=(e+2)%4,s=t.geometryState,n=t.tile,o=s.neighborData,a=n.level-r.level,l=e===1||e===3,c=o.edgeResolutions[e];be(J1(c));const u=c+1,d=t.geometry,p=d.boundingBox,g=d.outerEdges[e],y=d.uvRange[0],_=d.uvRange[1],v=d.uvRange[2],w=d.uvRange[3],x=me(e===1?1:0,y,v),T=me(e===0?1:0,_,w),S=r.renderData,C=S.geometryState,A=S.geometry.outerEdges[i],O=n.getNeighborEdgeStartVertexIndex(e,r)*c,$=c*2**a;be(C.neighborData.edgeResolutions[i]===$),be(A.count-1===$);const D=S.localOrigin[0]-t.localOrigin[0],N=S.localOrigin[1]-t.localOrigin[1],z=S.localOrigin[2]-t.localOrigin[2],U=g.attributes,Y=g.index0,H=g.stride,V=U.position.typedBuffer,J=U.position.typedBufferStride,P=U.normalCompressed.typedBuffer,I=U.normalCompressed.typedBufferStride,B=U.uv0,G=A.attributes,q=A.index0,Z=A.stride,K=G.position.typedBuffer,fe=G.position.typedBufferStride,Pe=G.normalCompressed.typedBuffer,lt=G.normalCompressed.typedBufferStride;for(let Tt=1;Tt<u-1;++Tt){const it=Y+H*Tt,dt=q+Z*(O+Tt),Be=it*J,Re=dt*fe,Ce=K[Re]+D,_t=K[Re+1]+N,Se=K[Re+2]+z;V[Be]=Ce,V[Be+1]=_t,V[Be+2]=Se,Eu(Ce,_t,Se,p);const Ne=it*I,We=dt*lt;P[Ne]=Pe[We],P[Ne+1]=Pe[We+1];const ht=Tt/c,bt=l?x:me(ht,y,v),Ct=l?me(ht,_,w):T;Jh(B,it,bt,Ct)}}function ybe(t){var Re;const e=t.geometryState,r=e.neighborData,i=t.localOrigin,s=r.cornerNeighborData,n=t.geometry,o=n.outerEdges,a=n.boundingBox,l=t.tile,c=((Re=t.tile.surface.view)==null?void 0:Re.viewingMode)==="local",u=l.ellipsoid.radius,d=l.extentInRadians,p=l.horizontalScale;let g=0,y=0,_=0;const v=(Ce,_t,Se)=>{const Ne=d[_t===0?1:3],We=d[Ce===0?0:2],ht=Math.cos(Ne),bt=Math.sin(Ne),Ct=Math.sin(We),Gr=Math.cos(We),Ie=u+Se;g=Gr*ht*Ie,y=Ct*ht*Ie,_=bt*Ie},w=c?(()=>{const Ce=t.geometryState.clippingArea,_t=l.extent,Se=Ce!=null&&(_t[3]>Ce[3]||_t[2]>Ce[2]||_t[1]<Ce[1]||_t[0]<Ce[0]),Ne=pbe(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,p);return(We,ht,bt)=>{const Ct=We===0?Y[0]:Y[2],Gr=ht===0?Y[1]:Y[3],Ie=Se?me(Ct,Ce[0],Ce[2]):Ct,Lt=Se?me(Gr,Ce[1],Ce[3]):Gr,Fe=bt;g=Ie*p,y=Ne(Lt),_=Fe}})():v;let x=0,T=0,S=0,C=0,A=0,O=0,$=0,D=0,N=0;const z=c&&t.tile.surface.isWebMercatorOnPlateeCarree,U=(Ce,_t,Se,Ne,We)=>{let ht=0,bt=0,Ct=0;if(c){const Gr=_t*p,Ie=z?(Math.PI/2-2*Math.atan(Math.exp(-Se/u)))*u:Se*p;ht=Gr-g,bt=Ie-y,Ct=Ne-_}else{const Gr=FH(Ce),Ie=Ce.tile,Lt=Ie.extent,Fe=Ie.extentInRadians,mt=(_t-Lt[0])/(Lt[2]-Lt[0]),gt=(Se-Lt[1])/(Lt[3]-Lt[1]),Mt=Fe[0]*(1-mt)+Fe[2]*mt,$t=Gr(gt),jr=Math.cos($t),ai=Math.sin($t),Hr=Math.sin(Mt),Bt=Math.cos(Mt),pr=u+Ne;ht=Bt*jr*pr-g,bt=Hr*jr*pr-y,Ct=ai*pr-_}switch(We){case 0:$+=ht,D+=bt,N+=Ct;break;case 1:C-=ht,A-=bt,O-=Ct;break;case 2:$-=ht,D-=bt,N-=Ct;break;case 3:C+=ht,A+=bt,O+=Ct}},Y=l.extent,H=e.clippingArea??UH,V=Y[0],J=Y[2],P=Y[1],I=Y[3],B=[I>H[3],J>H[2],P<H[1],V<H[0]],G=Math.max(V,H[0]),q=Math.min(J,H[2]),Z=Math.max(P,H[1]),K=Math.min(I,H[3]),fe=Ce=>Math.max(H[0],Math.min(H[2],Ce)),Pe=Ce=>Math.max(H[1],Math.min(H[3],Ce)),lt=n.uvRange[0],Tt=n.uvRange[1],it=n.uvRange[2],dt=n.uvRange[3],Be=Ce=>{var Gr;const _t=s[Ce].cornerTiles;x=0,T=0,S=1,C=0,A=0,O=0,$=0,D=0,N=0;let Se=1/0;for(let Ie=0;Ie<4;++Ie)Se=Math.min(Se,((Gr=_t[Ie])==null?void 0:Gr.level)??1/0);for(let Ie=0;Ie<4;++Ie){const Lt=_t[Ie];HT[Ie]=(Lt==null?void 0:Lt.level)===Se?Lt:null}let Ne=1,We=0;for(let Ie=0;Ie<4;++Ie){const Lt=HT[Ie];Lt&&(Ne=Math.max(Ne,Lt==null?void 0:Lt.renderData.geometryState.numVerticesPerSide),We=Lt.extent[2]-Lt.extent[0])}const ht=We,bt=Ne;be(bt>1);const Ct=ht/bt;for(let Ie=0;Ie<4;++Ie){const Lt=HT[(Ie+3)%4],Fe=HT[Ie%4];if(!Lt&&!Fe)continue;const mt=Ie===0?1:Ie===1?2:Ie===2?3:0,gt=Ie===0?2:Ie===1?3:Ie===2?0:1;if(Lt&&Fe){const Mt=a6[Ie][0]*Ct,$t=a6[Ie][1]*Ct,jr=Lt.extent,ai=fe(jr[mt===0||mt===1?2:0]+Mt),Hr=Pe(jr[mt===0||mt===3?3:1]+$t),Bt=Fe.extent,pr=fe(Bt[gt===0||gt===1?2:0]+Mt),Er=Pe(Bt[gt===0||gt===3?3:1]+$t),pi=Lt.renderData,vi=Fe.renderData,br=Bi(ai,Hr,pi.geometryState.samplerData),ar=Bi(pr,Er,vi.geometryState.samplerData);U(pi,ai,Hr,.5*(br+ar),Ie)}else{const Mt=Lt??Fe,$t=Lt?mt:gt,jr=Mt.extent,ai=a6[Ie],Hr=fe(jr[$t===0||$t===1?2:0]+ai[0]*Ct),Bt=Pe(jr[$t===0||$t===3?3:1]+ai[1]*Ct),pr=Mt.renderData,Er=Bi(Hr,Bt,pr.geometryState.samplerData);U(pr,Hr,Bt,Er,Ie)}}if(!c){const Ie=Math.sqrt(g*g+y*y+_*_);x=g/Ie,T=y/Ie,S=_/Ie}if(c||S*S<.999){const Ie=Math.sqrt(C*C+A*A+O*O);C/=Ie,A/=Ie,O/=Ie;const Lt=Math.sqrt($*$+D*D+N*N);$/=Lt,D/=Lt,N/=Lt,x=O*D-A*N,T=C*N-O*$,S=A*$-C*D;const Fe=1/Math.sqrt(x*x+T*T+S*S);x*=Fe,T*=Fe,S*=Fe}};for(let Ce=0;Ce<4;++Ce){const _t=Ce,Se=(Ce+1)%4,Ne=Ce===0||Ce===1?1:0,We=Ce===0||Ce===3?1:0,ht=me(Ne,lt,it),bt=me(We,Tt,dt),Ct=o[_t],Gr=Ce===0||Ce===3?Ct.count-1:0,Ie=o[Se],Lt=Ce===0||Ce===1?Ie.count-1:0,Fe=s[Ce].cornerTiles;let mt=-1;for(let $t=0;$t<4;++$t){const jr=Fe[$t];jr&&(mt===-1||dm(Fe[mt],jr)>0)&&(mt=$t)}const gt=mt,Mt=Fe[gt];if(Mt!==l){const $t=l.level-Mt.level,jr=2**$t,ai=[Mt.lij[0]+$t,Mt.lij[1]*jr,Mt.lij[2]*jr],Hr=[ai[1]+jr===l.lij[1],Ce===0&&(gt===1||gt===0&&Mt!==Fe[3])||Ce===1&&(gt===0||gt===1&&Mt!==Fe[2]),ai[1]===l.lij[1]+1,Ce===2&&(gt===3||gt===2&&Mt!==Fe[1])||Ce===3&&(gt===2||gt===3&&Mt!==Fe[0])],Bt=Hr.reduce((br,ar)=>br+(ar?1:0),0);be(Bt===1||Bt===2);let pr=-1,Er=-1;const pi=Mt.renderData;if(Bt===1){const br=Hr.findIndex(bi=>bi);be(0<=br&&br<=3),pr=(br+2)%4;const ar=t.geometryState.neighborData.edgeResolutions[br];Er=l.getNeighborEdgeStartVertexIndex(br,Mt)*ar+ar*(br===0&&Ce===0||br===1&&Ce===0||br===2&&Ce===1||br===3&&Ce===3?1:0)}else{be(Hr[1]||Hr[3]),pr=Hr[1]?3:1;const br=pi.geometryState.neighborData.edgeResolutions[pr];Er=Ce===0||Ce===3?0:br}const vi=pi.geometry.outerEdges[pr];{const br=Ct.index0+Gr*Ct.stride,ar=Ie.index0+Lt*Ie.stride,bi=vi.index0+Er*vi.stride;{const Jr=vi.attributes.position,fr=Jr.typedBuffer,Qr=bi*Jr.typedBufferStride,Ai=t.localOrigin,ps=vi.localOrigin,In=fr[Qr]+ps[0]-Ai[0],Ln=fr[Qr+1]+ps[1]-Ai[1],_o=fr[Qr+2]+ps[2]-Ai[2];Eu(In,Ln,_o,a);{const ts=Ct.attributes.position,Ri=ts.typedBuffer,or=br*ts.typedBufferStride;Ri[or]=In,Ri[or+1]=Ln,Ri[or+2]=_o}{const ts=Ie.attributes.position,Ri=ts.typedBuffer,or=ar*ts.typedBufferStride;Ri[or]=In,Ri[or+1]=Ln,Ri[or+2]=_o}}Jh(Ct.attributes.uv0,br,ht,bt),Jh(Ie.attributes.uv0,ar,ht,bt);{const Jr=vi.attributes.normalCompressed.typedBuffer,fr=bi*vi.attributes.normalCompressed.typedBufferStride;{const Qr=Ct.attributes.normalCompressed,Ai=Qr.typedBuffer,ps=br*Qr.typedBufferStride;Ai[ps]=Jr[fr],Ai[ps+1]=Jr[fr+1]}{const Qr=Ie.attributes.normalCompressed,Ai=Qr.typedBuffer,ps=ar*Qr.typedBufferStride;Ai[ps]=Jr[fr],Ai[ps+1]=Jr[fr+1]}}}}else{const $t=B[_t],jr=B[Se];let ai;if($t||jr){const Er=me(V*(1-Ne)+J*Ne,G,q),pi=me(P*(1-We)+I*We,Z,K),vi=e.samplerData;ai=Bi(Er,pi,vi)}else ai=Mst(Fe);w(Ne,We,ai),Be(Ce);const Hr=g-i[0],Bt=y-i[1],pr=_-i[2];Eu(Hr,Bt,pr,a),Ct.setVertexFromValuesRawPositionUVNormal(Gr,Hr,Bt,pr,ht,bt,x,T,S),Ie.setVertexFromValuesRawPositionUVNormal(Lt,Hr,Bt,pr,ht,bt,x,T,S)}}for(let Ce=0;Ce<4;++Ce)HT[Ce]=null}function Mst(t){var n,o;const e=t.reduce((a,l)=>Math.min(a,(l==null?void 0:l.level)??1/0),1/0);Ks&&(be(!t[0]||!t[2]||cz(t[0],t[2],tt.SOUTH_WEST)),be(!t[1]||!t[3]||cz(t[1],t[3],tt.NORTH_WEST)));let r=0,i=0;for(let a=0;a<4;++a){const l=t[a];if(l&&l.level===e){const c=a===0||a===1,u=a===0||a===3,d=l.extent,p=d[c?0:2],g=d[u?1:3],y=(o=(n=l.renderData)==null?void 0:n.geometryState)==null?void 0:o.samplerData;i+=Bi(p,g,y),r++}}const s=r?i/r:0;return be(s!=null),s}function HN(t){const e=t.vao,r=t.geometry.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(r,0,0,r.length)}const a6=[[0,1],[1,0],[0,-1],[-1,0]],Gn=new Tit,UH=I7(-1/0,-1/0,1/0,1/0),HT=[null,null,null,null];function _be(t,e,r){if(!e)return!1;const i=dm(t,e);return i>0||i===0&&r>=2}let $st=class extends LH{constructor(e,r,i,s,n){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Gt(),this._baseUsedMemory=900,this.init(e,r,i,s,n)}init(e,r,i,s,n){super.init(e,r,i,s,n);const o=n.view.renderSpatialReference,a=n.spatialReference,l=o!=null&&d7(o)&&a!=null&&a.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;const c=this.surface.isWebMercatorOnPlateeCarree,u=this._extentInRenderSR,d=this.extent;if(c){const p=Te(d[0],d[1],0);mo(p,at.WebMercator,p,at.PlateCarree);const g=Te(d[2],d[3],0);mo(g,at.WebMercator,g,at.PlateCarree),u[0]=p[0],u[1]=p[1],u[2]=g[0],u[3]=g[1]}else for(let p=0;p<4;++p)u[p]=d[p]*l;this.centerAtSeaLevel[0]=.5*(u[0]+u[2]),this.centerAtSeaLevel[1]=.5*(u[1]+u[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(u[2]-u[0],u[3]-u[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,r=.5*(e[2]-e[0]),i=.5*(e[3]-e[1]),s=Math.sqrt(r*r+i*i),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[Cs.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const r=this._aabb(),i=r[0],s=r[1],n=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let u=0;u<6;u++){const d=e[u],p=d[0],g=d[1],y=d[2],_=d[3];if(p*(p>0?i:o)+g*(g>0?s:a)+y*(y>0?n:l)+_>=0)return Po.OUTSIDE;c=c&&p*(p<0?i:o)+g*(g<0?s:a)+y*(y<0?n:l)+_<=0}return c?Po.INSIDE:Po.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return BMe(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,r,i,s){return JO[0]=1/r[0],JO[1]=1/r[1],JO[2]=1/r[2],gj(this._aabb(),e,JO,i,s)}createGeometry(){Est(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){Ast(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){Rst(this.renderData,this._horizontalScaleFactor)}get horizontalScale(){return this._horizontalScaleFactor}};const JO=E();let Ist=class{constructor(){this.extent=Jt(),this.minLevel=0,this.maxLevel=0,this.callback=null}},qM=class extends xe{constructor(){super(...arguments),this._queries=new It({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new It({initialSize:30}),this._queryPool=new Vo(Ist)}queryVisibleLevelRange(e,r,i,s){const n=this._queryPool.acquire();Fh(n.extent,e),n.minLevel=r??-Number.MAX_VALUE,n.maxLevel=i??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const r=this._queries.data[e];this._queryPool.release(r),r.callback(e>=this._queriesInvPtr),r.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const r=e.level;let i=0;for(;i<this._queriesInvPtr;){const s=this._queries.data[i],n=s.extent;r>=s.minLevel&&r<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};h([f()],qM.prototype,"updating",null),qM=h([k("esri.views.3d.terrain.ScaleRangeQueries")],qM);function Lst(t,e,r,i){const s=Math.cos(r);t[0]=Math.cos(e)*s*i,t[1]=Math.sin(e)*s*i,t[2]=Math.sin(r)*i}let Dst=class extends LH{constructor(e,r,i,s,n){super(),this._convexHull=new Array(24),this._boundingSphere=ds(),this._baseUsedMemory=1816,this.init(e,r,i,s,n)}init(e,r,i,s,n){super.init(e,r,i,s,n);const o=this.ellipsoid.radius,a=this.extentInRadians[0],l=this.extentInRadians[1],c=this.extentInRadians[2],u=this.extentInRadians[3],d=ft(l,u,.5),p=ft(a,c,.5),g=e===0?0:Math.min(Math.abs(l),Math.abs(u));this._edgeLen=(c-a)*Math.cos(g)*o,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=o-Math.sqrt(o*o-this._edgeLen2/4),Lst(this.centerAtSeaLevel,p,d,this.ellipsoid.radius),pe(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)se(e[Cs.MIDDLE],0,0,0),se(e[Cs.TOP],0,0,0),se(e[Cs.BOTTOM],0,0,0),e[Cs.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const r=e[Cs.MIDDLE],i=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,Nst(r,i,3*n));e[Cs.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!E0(e,this._boundingSphere))return Po.OUTSIDE;if(this.lij[0]<10)return Po.INTERSECTS;const r=this.convexHull,i=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<D2;n++){const o=n===ri.NEAR,a=e[n],l=a[0],c=a[1],u=a[2],d=a[3]-(o?i:0);let p=!1;for(let g=0;g<8;++g){const y=3*g;if(l*r[y]+c*r[y+1]+u*r[y+2]+d<0){if(p=!0,!s)break}else s=!1}if(!p)return Po.OUTSIDE}return s?Po.INSIDE:Po.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){vst(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Ks&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,r=e,i=this.elevationBounds,s=this.ellipsoid.radius,n=i[1];if(this.level===0)se(r,0,0,0),e[3]=s+n;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];o_(dte,a,l,s),o_(pte,a,c,s),le(r,dte,pte);const u=.5*(i[0]+i[1]);ee(r,r,(s+u)/ml(r));const d=this.convexHull;let p=0;const g=(_,v)=>{const w=_[0]-d[3*v],x=_[1]-d[3*v+1],T=_[2]-d[3*v+2];return Math.sqrt(w*w+x*x+T*T)};for(let _=0;_<8;++_){const v=g(r,_);p=Math.max(p,v)}const y=p;e[3]=y+2}}_updateConvexHull(){const e=this.extentInRadians,r=this.ellipsoid.radius;if(this.level===0)return;const i=this.elevationBounds,s=this._getPatchType(),n=this.surface.isWebMercator,o=n&&s===gu.HAS_NORTH_POLE,a=n&&s===gu.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,u=e[0],d=e[2],p=a?-c:e[1],g=o?c:e[3],y=.5*(u+d),_=i[0],v=r+(l?Math.min(0,_-1):_),w=(J,P,I)=>o_(J,P,I,v),x=E(),T=E(),S=E(),C=E();w(x,u,p),w(T,u,g),w(S,d,g),w(C,d,p);const A=(J,P)=>{for(let I=0;I<3;++I)this._convexHull[3*P+I]=J[I]};A(x,0),A(T,1),A(S,2),A(C,3);const O=i[1],$=r+(l?Math.max(0,O+1):O),D=E(),N=E(),z=E();o_(N,y,g,v),o_(z,y,p,v),le(D,N,z),pe(D,D);const U=E(),Y=E(),H=(J,P)=>{Rn(Y,J,P),pe(Y,Y);const I=-de(J,U)/de(Y,U);be(I>=0),ee(Y,Y,I),le(J,J,Y)};if(2**this.lij[0]>2*this.lij[1]){const J=z,P=E();rt(P,hte,J),pe(P,P),rt(U,J,P),pe(U,U),be(yu(de(U,J)/ml(J),0)),H(x,T),H(C,S),A(x,0),A(C,3)}else if(2**this.lij[0]!==2*this.lij[1]){const J=N,P=E();rt(P,hte,J),pe(P,P),rt(U,P,J),pe(U,U),H(T,x),H(S,C),A(T,1),A(S,2)}const V=(J,P)=>{const I=$/de(P,D);for(let B=0;B<3;++B)this._convexHull[3*J+B]=P[B]*I};V(4,x),V(5,T),V(6,S),V(7,C)}_getPatchType(){const e=this.lij[1],r=e===0,i=e===(1<<this.level)-1;return r?i?gu.HAS_BOTH_POLES:gu.HAS_NORTH_POLE:i?gu.HAS_SOUTH_POLE:gu.REGULAR}intersectsRay(e,r,i,s){const n=this._boundingSphere,o=n[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=n[0]-e[0],c=n[1]-e[1],u=n[2]-e[2],d=(l*r[0]+c*r[1]+u*r[2])/a,p=r[0]*d-l,g=r[1]*d-c,y=r[2]*d-u;return p*p+g*g+y*y<o*o}getDefaultVerticesPerSide(){return this.level<ute.length?ute[this.level]+1:2}updateCornerElevations(){xst(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){wst(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var _t;if(!Ks||this.level<=2)return;const e=this._boundingSphere,r=e[3],i=e,s=E(),n=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=n+o[0],l=1,c=0,u=this._center[Cs.MIDDLE][3],d=this.convexHull,p=(Se,Ne)=>{for(let We=0;We<3;++We)Se[We]=d[3*Ne+We]};{const Se=E(),Ne=E(),We=E(),ht=E(),bt=E(),Ct=(Gr,Ie,Lt,Fe)=>{p(Ne,Gr),p(We,Ie),p(ht,Lt),Rn(Ne,Ne,We),Rn(ht,ht,We),rt(Se,Ne,ht),pe(Se,Se);const mt=de(Se,We);p(bt,Fe);const gt=de(Se,bt),Mt=Math.abs(gt-mt);be(yu(Mt,0),`Non coplanar ${Gr},${Ie},${Lt},${Fe} diff = ${Mt}`)};Ct(0,1,2,3),Ct(4,5,6,7),Ct(0,1,4,5),Ct(1,2,5,6),Ct(2,3,6,7),Ct(3,0,7,4)}const g=Pn(24),y=(Se,Ne,We)=>{const ht=4*Se;for(let bt=0;bt<3;++bt)g[ht+bt]=Ne[bt];g[ht+3]=We},_=E(),v=E(),w=E(),x=E(),T=(Se,Ne,We,ht)=>{p(_,Ne),p(v,We),p(w,ht),Rn(_,_,v),pe(_,_),Rn(w,w,v),pe(w,w),rt(x,_,w),pe(x,x);const bt=de(x,v);y(Se,x,bt)};T(0,0,1,2),T(1,1,0,4),T(2,1,5,2),T(3,3,2,6),T(4,4,0,3),T(5,4,6,5);const S=1,C=(Se,Ne,We,ht)=>{const bt=4*Se;return g[bt]*Ne+g[bt+1]*We+g[bt+2]*ht-g[bt+3]},A=(Se,Ne,We,ht)=>C(Se,Ne,We,ht)>=-S,O=(Se,Ne)=>A(Se,Ne[0],Ne[1],Ne[2]),$=2**this.lij[0]>2*this.lij[1],D=(Se,Ne,We)=>Math.sqrt(vbe(Se,Ne,We,i[0],i[1],i[2]))<r,N=Se=>D(Se[0],Se[1],Se[2]),z=(Se,Ne)=>D(Se[Ne],Se[Ne+1],Se[Ne+2]),U=this.extentInRadians,Y=.5*(U[0]+U[2]),H=U[1],V=U[3],J=E(),P=E();o_(J,Y,V,a),o_(P,Y,H,a);const I=$?"Upper":"Lower";let B=!0;for(let Se=0;Se<6;++Se){for(let Ne=0;Ne<8;++Ne){const We=3*Ne,ht=A(Se,d[We],d[We+1],d[We+2]);B&&(B=ht),be(ht,`Tile[${this.lij}] Convex hull point ${Ne} outside of plane ${Se}`)}be(O(Se,P),`Tile[${this.lij}] (${I}) bottom mid outside of plane ${Se}`),be(O(Se,J),`Tile[${this.lij}] (${I}) top mid outside of plane ${Se}`)}be(B,"Not all convex hull points are inside  convex hull polyhedron"),be(N(P),`Tile[${this.lij}] (${I}) bottom mid outside of bounding sphere`),be(N(J),`Tile[${this.lij}] (${I}) top mid outside of bounding sphere`);for(let Se=0;Se<8;++Se){const Ne=z(d,3*Se);be(Ne,`Tile[${this.lij}] Convex hull point ${Se} outside of bounding sphere`)}for(let Se=0;Se<6;++Se)for(let Ne=0;Ne<8;++Ne){const We=3*Ne;A(Se,d[We],d[We+1],d[We+2])||console.error(`Tile[${this.lij}] Convex hull point ${Ne} outside of plane ${Se}`)}const G=this.extentInRadians,q=Math.max(G[2]-G[0],G[3]-G[1]),Z=Math.round(q*n),K=this.renderData;if(!K)return;const{geometry:fe,localOrigin:Pe}=K,lt=(_t=fe.vertexAttributes)==null?void 0:_t.position;if(!lt)return;const Tt=lt.count,it=E(),dt=fe.numVerticesPerSide-2,Be=dt*dt,Re=K.geometryState.neighborData,Ce=Re.edgeResolutions.reduce((Se,Ne)=>Se+Ne+1,0);for(let Se=0;Se<Tt;++Se){const Ne=Se<Be,We=!Ne&&Se<Be+Ce;let ht=!1,bt=-1;if(We){let Bt=Be;for(let pr=0;pr<4;++pr){const Er=Re.edgeResolutions[pr];if(Se===Bt||Se===Bt+Er-1){ht=!0;break}if(Bt+=Er,Se<Bt){bt=pr;break}}}const Ct=We?Re.edgePeerNeighbors[bt]:null,Gr=We&&Ct&&dm(this,Ct)>0;lt.getVec(Se,s),le(it,s,Pe);const Ie=ml(it)-n;let Lt=0,Fe=!1;const mt=o[0]-Ie,gt=Ie-o[1],Mt=mt>l,$t=gt>l,jr=Mt||$t,ai=()=>{const Bt=Ne?"internal":We&&!ht?"edge":ht?"corner":"pole";return`Tile[${this.lij}].vertex[${Se}]:${Bt}`+(Mt?"(below)":$t?"(above)":"")+(Gr?"(Neighbor)":"")},Hr=R3(it,i);if(Hr>=r+c){const Bt=Hr-r;jr||(console.error(`${ai()} is out of the bounding sphere by ${Bt.toFixed(0)} / ${r.toFixed(0)}[tol=${c}] h=${Ie.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(Bt/r).toFixed(0)})`),Fe=!0)}for(let Bt=0;Bt<6;++Bt)if(!A(Bt,it[0],it[1],it[2])){const pr=C(Bt,it[0],it[1],it[2]),Er=Se%dt,pi=(Se-Er)/dt;Bt===0&&mt||Bt===5&&gt||(console.error(`${ai()} (${Er},${pi})|${dt}] is out of the bounding trapezoid plane ${Bt} h=${Math.round(Ie)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(pr)} radii = ${Math.round(r)}/${Math.round(u)}} : maxL = ${Z}`),++Lt)}if(Fe||Lt>0)break}}get convexHull(){return this._convexHull}};const ute=[128,64,64,32,16,8,8,4];function Nst(t,e,r){return vbe(t[0],t[1],t[2],e[r],e[r+1],e[r+2])}function vbe(t,e,r,i,s,n){const o=i-t,a=s-e,l=n-r;return o*o+a*a+l*l}const o_=(t,e,r,i)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(r),a=Math.sin(r);t[0]=i*o*s,t[1]=i*o*n,t[2]=i*a},hte=[0,0,1],dte=E(),pte=E();let _h=class extends xe{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};h([f()],_h.prototype,"fovX",void 0),h([f()],_h.prototype,"fovY",void 0),h([f()],_h.prototype,"relativeWidthLimit",void 0),h([f()],_h.prototype,"relativeHeightLimit",void 0),h([f()],_h.prototype,"maxLod",void 0),h([f()],_h.prototype,"angledSplitBias",void 0),h([f()],_h.prototype,"aboveGround",void 0),h([f()],_h.prototype,"frustum",void 0),_h=h([k("esri.views.3d.terrain.SplitLimits")],_h);const Fst=Ci().vec3f(R.POSITION).vec2i16(R.UV0).vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0});let Ust=class{constructor(e){this._storage=new H3((r,i)=>e.newCache(r,i),"TileGeometry")}acquire(e){const i=Math.ceil(e/4)*4,s=this._storage.pop(fte(i));if(s)return s;const n=Fst.createBuffer(i);return n.release=()=>this._release(n),n}_release(e){const r=e.count;this._storage.put(fte(r),e)}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function fte(t){return t.toString()}let bbe=class extends Za{constructor(){super(...arguments),this.blendMode=Ae.Normal}};h([F({count:Ae.COUNT})],bbe.prototype,"blendMode",void 0);let dC=class extends bbe{constructor(){super(...arguments),this.output=Is.Composite,this.baseOpacityMode=_c.NotRequired,this.premultipliedSource=Ph.Off}};h([F({count:Is.COUNT})],dC.prototype,"output",void 0),h([F({count:_c.COUNT})],dC.prototype,"baseOpacityMode",void 0),h([F()],dC.prototype,"premultipliedSource",void 0);var _v;function kst(t){const e=new dr;if(e.include(ebe),t.background===_v.Only){const r=t.output===Is.ColorComposite;return r?e.fragment.uniforms.add(new Pt("backgroundColor",i=>i.backgroundColor)):e.fragment.include(IH),e.fragment.code.add(b`
    void main() {
      fragColor = vec4(${r?b`backgroundColor`:b`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(tbe,t),e.fragment.uniforms.add(new Ze("tex",r=>r.texture)),e.fragment.uniforms.add(new Ee("opacity",r=>r.opacity)),e.fragment.code.add(b`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(_v||(_v={}));const Bst=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return _v},build:kst},Symbol.toStringTag,{value:"Module"}));let zst=class extends Kve{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Mn}},wbe=class xbe extends Sr{initializeProgram(e){return new vr(e.rctx,xbe.shader.get().build(this.configuration),hr)}initializePipeline(){return Et({blending:Dl(ve.ONE,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ut})}};wbe.shader=new _r(Bst,()=>he(()=>import("./BlendLayers.glsl-6e66a6cb.js"),[],import.meta.url));let Tbe=class extends dC{constructor(){super(...arguments),this.background=_v.BelowLayer}};h([F()],Tbe.prototype,"background",void 0);let l6=class{constructor(e,r,i,s,n,o){this.texture=e,this.type=r,e.retain(),this.offsetAndScale=Ot(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Te(s,n,o)}destroy(){this.texture.release()}};function Eg(t,e){return[t,e]}function a_(t,e,r){return t[0]=e,t[1]=r,t}function Vst(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}const ih=new gv("0/0/0/0");let Gst=class Sbe{static create(e,r,i=null){const s=qh(e.spatialReference),n=r.origin||Eg(e.origin.x,e.origin.y),o=Eg(e.size[0]*r.resolution,e.size[1]*r.resolution),a=Eg(-1/0,-1/0),l=Eg(1/0,1/0),c=Eg(1/0,1/0);i!=null&&(a_(a,Math.max(0,Math.floor((i.xmin-n[0])/o[0])),Math.max(0,Math.floor((n[1]-i.ymax)/o[1]))),a_(l,Math.max(0,Math.floor((i.xmax-n[0])/o[0])),Math.max(0,Math.floor((n[1]-i.ymin)/o[1]))),a_(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:u,rows:d}=r;let p,g,y,_;return!i&&u&&d&&(a_(a,u[0],d[0]),a_(l,u[1],d[1]),a_(c,u[1]-u[0]+1,d[1]-d[0]+1)),e.isWrappable?(p=Eg(Math.ceil(Math.round((s.valid[1]-s.valid[0])/r.resolution)/e.size[0]),c[1]),g=Eg(Math.floor((s.origin[0]-n[0])/o[0]),a[1]),y=Eg(p[0]+g[0]-1,l[1]),_=!0):(g=a,y=l,p=c,_=!1),new Sbe(r.level,r.resolution,r.scale,n,a,l,c,o,g,y,p,_)}constructor(e,r,i,s,n,o,a,l,c,u,d,p){this.level=e,this.resolution=r,this.scale=i,this.origin=s,this.first=n,this.last=o,this.size=a,this.norm=l,this.worldStart=c,this.worldEnd=u,this.worldSize=d,this.wrap=p}normalizeCol(e){if(!this.wrap)return e;const r=this.worldSize[0];return e<0?r-1-Math.abs((e+1)%r):e%r}denormalizeCol(e,r){return this.wrap?this.worldSize[0]*r+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,r,i=!1){ih.set(r);const s=i?ih.col:this.denormalizeCol(ih.col,ih.world),n=ih.row;return Vst(e,this.getXForColumn(s),this.getYForRow(n+1),this.getXForColumn(s+1),this.getYForRow(n)),e}getTileCoords(e,r,i=!1){ih.set(r);const s=i?ih.col:this.denormalizeCol(ih.col,ih.world);return Array.isArray(e)?a_(e,this.getXForColumn(s),this.getYForRow(ih.row)):(e.x=this.getXForColumn(s),e.y=this.getYForRow(ih.row)),e}},uz=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}forEach(e,r){const{spans:i,lodInfo:s}=this,{level:n}=s;if(i.length!==0)for(const{row:o,colFrom:a,colTo:l}of i)for(let c=a;c<=l;c++)e.call(r,n,o,s.normalizeCol(c),s.getWorldForColumn(c))}};uz.pool=new Vo(uz);let c6=class{constructor(e,r,i){this.row=e,this.colFrom=r,this.colTo=i}};const fs=new gv("0/0/0/0");let jst=class Ebe{static create(e,r){e[1]>r[1]&&([e,r]=[r,e]);const[i,s]=e,[n,o]=r,a=n-i,l=o-s,c=l!==0?a/l:0,u=(Math.ceil(s)-s)*c,d=(Math.floor(s)-s)*c;return new Ebe(i,Math.floor(s),Math.ceil(o),c,a<0?u:d,a<0?d:u,a<0?n:i,a<0?i:n)}constructor(e,r,i,s,n,o,a,l){this.x=e,this.ymin=r,this.ymax=i,this.invM=s,this.leftAdjust=n,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const ql=[[0,0],[0,0],[0,0],[0,0]],Hst=1e-6;let aAt=class{constructor(e,r=null,i=e.lods[0].level,s=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=r,this.scales=[],this._infoByScale={},this._infoByLevel={};const n=e.lods.filter(a=>a.level>=i&&a.level<=s);this.minScale=n[0].scale,this.maxScale=n[n.length-1].scale;const o=this._lodInfos=n.map(a=>Gst.create(e,a,r));n.forEach((a,l)=>{this._infoByLevel[a.level]=o[l],this._infoByScale[a.scale]=o[l],this.scales[l]=a.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,r,i=!1){fs.set(r);const s=this._infoByLevel[fs.level];return s?s.getTileBounds(e,fs,i):e}getTileCoords(e,r,i=!1){fs.set(r);const s=this._infoByLevel[fs.level];return s?s.getTileCoords(e,fs,i):e}getTileCoverage(e,r=192,i=!0,s="closest"){if(!i&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const n=s==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),o=uz.pool.acquire(n),a=this._wrap;let l,c,u,d=1/0,p=-1/0;const g=o.spans;ql[0][0]=ql[0][1]=ql[1][1]=ql[3][0]=-r,ql[1][0]=ql[2][0]=e.size[0]+r,ql[2][1]=ql[3][1]=e.size[1]+r;for(const w of ql)e.toMap(w,w),w[0]=n.getColumnForX(w[0]),w[1]=n.getRowForY(w[1]);const y=[];let _=3;for(let w=0;w<4;w++){if(ql[w][1]===ql[_][1]){_=w;continue}const x=jst.create(ql[w],ql[_]);d=Math.min(x.ymin,d),p=Math.max(x.ymax,p),y[x.ymin]===void 0&&(y[x.ymin]=[]),y[x.ymin].push(x),_=w}if(d==null||p==null||p-d>100)return null;let v=[];for(l=d;l<p;){y[l]!=null&&(v=v.concat(y[l])),c=1/0,u=-1/0;for(let w=v.length-1;w>=0;w--){const x=v[w];c=Math.min(c,x.getLeftCol()),u=Math.max(u,x.getRightCol())}if(c=Math.floor(c),u=Math.floor(u),l>=n.first[1]&&l<=n.last[1])if(a)if(n.size[0]<n.worldSize[0]){const w=Math.floor(u/n.worldSize[0]);for(let x=Math.floor(c/n.worldSize[0]);x<=w;x++)g.push(new c6(l,Math.max(n.getFirstColumnForWorld(x),c),Math.min(n.getLastColumnForWorld(x),u)))}else g.push(new c6(l,c,u));else c>n.last[0]||u<n.first[0]||(c=Math.max(c,n.first[0]),u=Math.min(u,n.last[0]),g.push(new c6(l,c,u)));l+=1;for(let w=v.length-1;w>=0;w--){const x=v[w];x.ymax>=l?x.incrRow():v.splice(w,1)}}return o}getTileParentId(e){fs.set(e);const r=this._infoByLevel[fs.level],i=this._lodInfos.indexOf(r)-1;return i<0?null:(this._getTileIdAtLOD(fs,this._lodInfos[i],fs),fs.id)}getTileResolution(e){const r=this._infoByLevel[typeof e=="object"?e.level:e];return r?r.resolution:-1}getTileScale(e){const r=this._infoByLevel[e.level];return r?r.scale:-1}intersects(e,r){fs.set(r);const i=this._infoByLevel[fs.level],s=e.lodInfo;if(s.resolution>i.resolution){this._getTileIdAtLOD(fs,s,fs);const o=s.denormalizeCol(fs.col,fs.world);for(const a of e.spans)if(a.row===fs.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(s.resolution<i.resolution){const[o,a,l,c]=e.spans.reduce((_,v)=>(_[0]=Math.min(_[0],v.row),_[1]=Math.max(_[1],v.row),_[2]=Math.min(_[2],v.colFrom),_[3]=Math.max(_[3],v.colTo),_),[1/0,-1/0,1/0,-1/0]),u=i.denormalizeCol(fs.col,fs.world),d=s.getColumnForX(i.getXForColumn(u)),p=s.getRowForY(i.getYForRow(fs.row)),g=s.getColumnForX(i.getXForColumn(u+1))-1,y=s.getRowForY(i.getYForRow(fs.row+1))-1;return!(d>c||g<l||p>a||y<o)}const n=s.denormalizeCol(fs.col,fs.world);return e.spans.some(o=>o.row===fs.row&&o.colFrom<=n&&o.colTo>=n)}normalizeBounds(e,r,i){if(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],this._wrap){const s=qh(this.tileInfo.spatialReference),n=-i*(s.valid[1]-s.valid[0]);e[0]+=n,e[2]+=n}return e}getSmallestInfoForScale(e){const r=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>r[0])return this._infoByScale[r[0]];for(let i=1;i<r.length-1;i++)if(e>r[i]+Hst)return this._infoByScale[r[i-1]];return this._infoByScale[r[r.length-1]]}getClosestInfoForScale(e){const r=this.scales;return this._infoByScale[e]||(e=r.reduce((i,s)=>Math.abs(s-e)<Math.abs(i-e)?s:i,r[0])),this._infoByScale[e]}scaleToLevel(e){const r=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let i=r.length-1;i>=0;i--)if(e<r[i])return i===r.length-1?this._infoByScale[r[r.length-1]].level:this._infoByScale[r[i]].level+(r[i]-e)/(r[i]-r[i+1]);return this._infoByScale[r[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,r,i){const s=this._infoByLevel[i.level];return e.set(i),r.resolution<s.resolution?null:(r.resolution===s.resolution||(e.level=r.level,e.col=Math.floor(i.col*s.resolution/r.resolution+.01),e.row=Math.floor(i.row*s.resolution/r.resolution+.01)),e)}},u6=class{constructor(){this._map=new Map,this._observable=new E3}get size(){return xt(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const r=this._map.delete(e);return r&&this._observable.notify(),r}entries(){return xt(this._observable),this._map.entries()}forEach(e,r){xt(this._observable),this._map.forEach((i,s)=>e.call(r,i,s,this),r)}get(e){return xt(this._observable),this._map.get(e)}has(e){return xt(this._observable),this._map.has(e)}keys(){return xt(this._observable),this._map.keys()}set(e,r){return this._map.set(e,r),this._observable.notify(),this}values(){return xt(this._observable),this._map.values()}[Symbol.iterator](){return xt(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}},qst=class{constructor(e,r){this.item=e,this.controller=r,this.promise=null}},Wst=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new u6,this._controllers=new u6,this._processingItems=new u6,this._pausedSignal=Zx(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new Z$(e.peeker),this.process=e.process;const r=e.scheduler;e.priority&&r&&(this._task=r.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=di(this._schedule),this._task=di(this._task)}get updating(){var e;return!!((e=this._task)!=null&&e.updating)||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const r=this._controllers.get(e);r&&r.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(r=>e.push(r)),this._controllers.clear(),e.forEach(r=>r.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((r,i)=>e(i))}get(e){const r=this._deferreds.get(e);return r?r.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,r){const i=this.get(e);if(i)return i;const s=new AbortController;let n=null;r&&(n=Uo(r,()=>s.abort()));const o=()=>{const u=this._processingItems.get(e);u&&u.controller.abort(),a(),c.reject(ur())},a=()=>{l.remove(),n!=null&&n.remove(),this._deferreds.delete(e),this._controllers.delete(e),this._queue.remove(e),this._processingItems.delete(e),this._scheduleNext()},l=UL(s.signal,o),c=Go();return this._deferreds.set(e,c),this._controllers.set(e,s),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}peek(){return this._queue.peek()}popLast(){return this._queue.popLast()}reset(){const e=[];this._processingItems.forEach(r=>e.push(r)),this._processingItems.clear();for(const r of e)this._queue.push(r.item),r.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=w2(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,r){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(r))}_processError(e,r){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(r))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(e==null)return;let r;const i=new AbortController,s=new qst(e,i);this._processingItems.set(e,s);try{r=this.process(e,i.signal)}catch(n){this._processError(s,n)}Fl(r)?(s.promise=r,r.then(n=>this._processResult(s,n),n=>this._processError(s,n))):this._processResult(s,r)}get test(){return{update:e=>this.runTask(e)}}};function Yst(t,e){return t.length=0,e.forEach(r=>t.push(r)),t}const h6=new Set,QO=[],Nb=new Map,mte=[0,0];let l_=class extends xe{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:r,strategy:i}=this;this._queue=new Wst({concurrency:e,process:(s,n)=>{const o=this._keyToItem.get(s);return r(o,{signal:n})},peeker:i==="scale-first"?s=>this._peekByScaleFirst(s):s=>this._peekByCenterFirst(s)})}destroy(){this.clear(),this._queue=Oe(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(e){const r=typeof e=="string"?e:e.id;this._queue.abort(r)}clear(){this._queue.clear(),this._keyToItem.clear()}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const r=typeof e=="string"?e:e.id;return this.has(r)&&this._queue.isOngoing(r)}pause(){this._queue.pause()}push(e){const r=e.key.id;if(this._queue.has(r))return this._queue.get(r);const i=this._queue.push(r),s=()=>{this._keyToItem.delete(r)};return this._keyToItem.set(r,e),i.then(s,s),i}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const r=this.tileInfoView;let i=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;e.forEach(u=>{const d=this._keyToItem.get(u),p=this.tileInfoView.getTileScale(d.key);Nb.has(p)||(Nb.set(p,[]),i=Math.max(p,i),s=Math.min(p,s)),Nb.get(p).push(d.key),h6.add(p)});let n=this.state.scale;Nb.has(n)||(Yst(QO,h6),QO.sort((u,d)=>u-d),n=QO.reduce((u,d)=>Math.abs(d-n)<Math.abs(u-n)?d:u,QO[0])),n=Math.min(n,i),n=Math.max(n,s);const o=Nb.get(n),a=r.getClosestInfoForScale(n),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((u,d)=>{const p=a.denormalizeCol(u.col,u.world),g=a.denormalizeCol(d.col,d.world);return Math.sqrt((l-p)*(l-p)+(c-u.row)*(c-u.row))-Math.sqrt((l-g)*(l-g)+(c-d.row)*(c-d.row))}),h6.clear(),Nb.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const r=this.tileInfoView,i=this.state.center;let s,n=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);r.getTileCoords(mte,a.key);const l=X0(mte,i);l<n&&(n=l,s=a.key)}),s.id}};h([f({constructOnly:!0})],l_.prototype,"concurrency",void 0),h([f({constructOnly:!0})],l_.prototype,"process",void 0),h([f()],l_.prototype,"state",void 0),h([f({constructOnly:!0})],l_.prototype,"strategy",void 0),h([f({constructOnly:!0})],l_.prototype,"tileInfoView",void 0),l_=h([k("esri.views.2d.tiling.TileQueue")],l_);new gv(0,0,0,0);function Xst(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Zst(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Jst(t,e,r,i,s,n,o){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t}function Cbe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=r*n-i*s;return l?(l=1/l,t[0]=n*l,t[1]=-i*l,t[2]=-s*l,t[3]=r*l,t[4]=(s*a-n*o)*l,t[5]=(i*o-r*a)*l,t):null}function Qst(t){return t[0]*t[3]-t[1]*t[2]}function Abe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1],d=r[2],p=r[3],g=r[4],y=r[5];return t[0]=i*c+n*u,t[1]=s*c+o*u,t[2]=i*d+n*p,t[3]=s*d+o*p,t[4]=i*g+n*y+a,t[5]=s*g+o*y+l,t}function kH(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(r),u=Math.cos(r);return t[0]=i*u+n*c,t[1]=s*u+o*c,t[2]=i*-c+n*u,t[3]=s*-c+o*u,t[4]=a,t[5]=l,t}function Rbe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1];return t[0]=i*c,t[1]=s*c,t[2]=n*u,t[3]=o*u,t[4]=a,t[5]=l,t}function BH(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=i*c+n*u+a,t[5]=s*c+o*u+l,t}function Kst(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t}function ent(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function zH(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function tnt(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function rnt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function int(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function Obe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function snt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function nnt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t}function ont(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function ant(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],u=e[2],d=e[3],p=e[4],g=e[5],y=Qn();return Math.abs(r-l)<=y*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=y*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-u)<=y*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(n-d)<=y*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-p)<=y*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-g)<=y*Math.max(1,Math.abs(a),Math.abs(g))}const lnt=Abe,cnt=Obe;Object.freeze(Object.defineProperty({__proto__:null,add:int,copy:Xst,determinant:Qst,equals:ant,exactEquals:ont,frob:rnt,fromRotation:Kst,fromScaling:ent,fromTranslation:zH,identity:Zst,invert:Cbe,mul:lnt,multiply:Abe,multiplyScalar:snt,multiplyScalarAndAdd:nnt,rotate:kH,scale:Rbe,set:Jst,str:tnt,sub:cnt,subtract:Obe,translate:BH},Symbol.toStringTag,{value:"Module"}));function Pbe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function unt(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function hnt(t,e,r,i,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function dnt(t,e){return new Float32Array(t,e,6)}function Mbe(t,e,r,i){const s=e[i],n=e[i+1];t[i]=r[0]*s+r[2]*n+r[4],t[i+1]=r[1]*s+r[3]*n+r[5]}function pnt(t,e,r,i=0,s=0,n=2){const o=s||e.length/n;for(let a=i;a<o;a++)Mbe(t,e,r,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:unt,create:Pbe,createView:dnt,fromValues:hnt,transform:Mbe,transformMany:pnt},Symbol.toStringTag,{value:"Module"}));function WM(){return[1,0,0,1,0,0]}function fnt(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function mnt(t,e,r,i,s,n){return[t,e,r,i,s,n]}function gnt(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:fnt,create:WM,createView:gnt,fromValues:mnt},Symbol.toStringTag,{value:"Module"}));function ynt(t){return t instanceof Float32Array&&t.length>=2}function _nt(t){return Array.isArray(t)&&t.length>=2}function KO(t){return ynt(t)||_nt(t)}const eP={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new Uh({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:at.WebMercator}),minus180Line:new Uh({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:at.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new Uh({paths:[[[180,-180],[180,180]]],spatialReference:at.WGS84}),minus180Line:new Uh({paths:[[[-180,-180],[-180,180]]],spatialReference:at.WGS84})}};function T1(t,e){return Math.ceil((t-e)/(2*e))}function $be(t,e){const r=pC(t);for(const i of r)for(const s of i)s[0]+=e;return t}function pC(t){return lD(t)?t.rings:t.paths}async function vnt(t,e,r,i){const s=$ve(t),n=e[0].spatialReference,o={...i,responseType:"json",query:{...s.query,f:"json",sr:E$(n),target:JSON.stringify({geometryType:M3(e[0]),geometries:e}),cutter:JSON.stringify(r)}},a=await Hi(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(u=>{const d=$x(u);return d.spatialReference=n,d})}}async function bnt(t,e,r){const i=typeof t=="string"?Wn(t):t,s=e[0].spatialReference,n=M3(e[0]),o={...r,query:{...i.query,f:"json",sr:E$(s),geometries:JSON.stringify(Mtt(e))}},{data:a}=await Hi(i.path+"/simplify",o);return Ive(a.geometries,n,s)}const Ibe=ne.getLogger("esri.geometry.support.normalizeUtils");function wnt(t){return t.type==="polygon"}function xnt(t){return t[0].type==="polygon"}function Tnt(t){return t[0].type==="polyline"}function Snt(t,e){if(!(t instanceof Uh||t instanceof Np)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw Ibe.error(s),new X(s)}const r=pC(t),i=[];for(const s of r){const n=[];i.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],u=s[o+1][1],d=Math.sqrt((c-a)*(c-a)+(u-l)*(u-l)),p=(u-l)/d,g=(c-a)/d,y=d/e;if(y>1){for(let x=1;x<=y-1;x++){const T=x*e,S=g*T+a,C=p*T+l;n.push([S,C])}const _=(d+Math.floor(y-1)*e)/2,v=g*_+a,w=p*_+l;n.push([v,w])}n.push([c,u])}}return wnt(t)?new Np({rings:i,spatialReference:t.spatialReference}):new Uh({paths:i,spatialReference:t.spatialReference})}function gte(t,e,r){if(e){const i=Snt(t,1e6);t=JT(i,!0)}return r&&(t=$be(t,r)),t}function yte(t,e,r){if(Array.isArray(t)){const i=t[0];if(i>e){const s=T1(i,e);t[0]=i+s*(-2*e)}else if(i<r){const s=T1(i,r);t[0]=i+s*(-2*r)}}else{const i=t.x;if(i>e){const s=T1(i,e);t=t.clone().offset(s*(-2*e),0)}else if(i<r){const s=T1(i,r);t=t.clone().offset(s*(-2*r),0)}}return t}function Ent(t,e){let r=-1;for(let i=0;i<e.cutIndexes.length;i++){const s=e.cutIndexes[i],n=e.geometries[i],o=pC(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let u=0;for(let p=0;p<l.length;p++){const g=l[p][0];u=g>u?g:u}u=Number(u.toFixed(9));const d=-360*T1(u,180);for(let p=0;p<l.length;p++){const g=n.getPoint(a,p);n.setPoint(a,p,g.clone().offset(d,0))}return!0}})}if(s===r){if(xnt(t))for(const a of pC(n))t[s]=t[s].addRing(a);else if(Tnt(t))for(const a of pC(n))t[s]=t[s].addPath(a)}else r=s,t[s]=n}return t}async function Cnt(t,e,r){if(!Array.isArray(t))return Cnt([t],e);e&&typeof e!="string"&&Ibe.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const i=typeof e=="string"?e:(e==null?void 0:e.url)??kr.geometryServiceUrl;let s,n,o,a,l,c,u,d,p=0;const g=[],y=[];for(const S of t)if(S!=null)if(s||(s=S.spatialReference,n=qh(s),o=s.isWebMercator,c=o?102100:4326,a=eP[c].maxX,l=eP[c].minX,u=eP[c].plus180Line,d=eP[c].minus180Line),n)if(S.type==="mesh")y.push(S);else if(S.type==="point")y.push(yte(S.clone(),a,l));else if(S.type==="multipoint"){const C=S.clone();C.points=C.points.map(A=>yte(A,a,l)),y.push(C)}else if(S.type==="extent"){const C=S.clone()._normalize(!1,!1,n);y.push(C.rings?new Np(C):C)}else if(S.extent){const C=S.extent,A=T1(C.xmin,l)*(2*a);let O=A===0?S.clone():$be(S.clone(),A);C.offset(A,0),C.intersects(u)&&C.xmax!==a?(p=C.xmax>p?C.xmax:p,O=gte(O,o),g.push(O),y.push("cut")):C.intersects(d)&&C.xmin!==l?(p=C.xmax*(2*a)>p?C.xmax*(2*a):p,O=gte(O,o,360),g.push(O),y.push("cut")):y.push(O)}else y.push(S.clone());else y.push(S);else y.push(S);let _=T1(p,a),v=-90;const w=_,x=new Uh;for(;_>0;){const S=360*_-180;x.addPath([[S,v],[S,-1*v]]),v*=-1,_--}if(g.length>0&&w>0){const S=Ent(g,await vnt(i,g,x,r)),C=[],A=[];for(let D=0;D<y.length;D++){const N=y[D];if(N!=="cut")A.push(N);else{const z=S.shift(),U=t[D];U!=null&&U.type==="polygon"&&U.rings&&U.rings.length>1&&z.rings.length>=U.rings.length?(C.push(z),A.push("simplify")):A.push(o?O0(z):z)}}if(!C.length)return A;const O=await bnt(i,C,r),$=[];for(let D=0;D<A.length;D++){const N=A[D];N!=="simplify"?$.push(N):$.push(o?O0(O.shift()):O.shift())}return $}const T=[];for(let S=0;S<y.length;S++){const C=y[S];if(C!=="cut")T.push(C);else{const A=g.shift();T.push(o===!0?O0(A):A)}}return T}function Ant(t,e,r){const i=qh(r);if(i==null)return t;const[s,n]=i.valid,o=2*n;let a=0,l=0;e>n?a=Math.ceil(Math.abs(e-n)/o):e<s&&(a=-Math.ceil(Math.abs(e-s)/o)),t>n?l=Math.ceil(Math.abs(t-n)/o):t<s&&(l=-Math.ceil(Math.abs(t-s)/o));let c=t+(a-l)*o;const u=c-e;return u>n?c-=o:u<s&&(c+=o),c}const Rnt=96,Ont=39.37;function VH(t,e){return e.type?ir(t,e.x,e.y):Ns(t,e)}function Pnt(t){return qo(t)}function Mnt(t,e){const r=t.targetGeometry,i=e.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const $nt=function(){const t=ke();return function(e,r,i){const s=r.targetGeometry;VH(t,s);const n=.5*qN(r);return e.xmin=t[0]-n*i[0],e.ymin=t[1]-n*i[1],e.xmax=t[0]+n*i[0],e.ymax=t[1]+n*i[1],e.spatialReference=s.spatialReference,e}}();function qN(t){return t.scale*Int(t.targetGeometry)}function Int(t){return t!=null&&No(t.spatialReference)?1/(Pnt(t.spatialReference)*Ont*Rnt):1}function Lnt(t){return XL(t.rotation)||0}const GH=function(){const t=ke(),e=ke(),r=ke();return function(i,s,n,o,a,l){return gG(t,s),xl(e,n,.5*l),ir(r,1/o*l,-1/o*l),zH(i,e),a&&kH(i,i,a),Rbe(i,i,r),BH(i,i,t),i}}(),Dnt=function(){const t=ke();return function(e,r,i,s){const n=qN(r),o=Lnt(r);return VH(t,r.targetGeometry),GH(e,t,i,n,o,s)}}(),Nnt=function(){const t=ke();return function(e,r,i,s){const n=qN(r);return VH(t,r.targetGeometry),GH(e,t,i,n,0,s)}}();function Fnt(t){const e=qh(t);return e?e.valid[1]-e.valid[0]:0}function Unt(t,e){return Math.round(Fnt(t)/e)}var hz;const Ko=[0,0];let Zg=hz=class extends st{constructor(t){super(t),this._viewpoint2D={center:ke(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new Xr,this.id=0,this.inverseTransform=WM(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=WM(),this.transformNoRotation=WM(),this.displayMat3=zo(),this.displayViewMat3=zo(),this.viewMat3=zo(),this.viewMat2d=Pbe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,r=t.targetGeometry;e.center[0]=r.x,e.center[1]=r.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=r.spatialReference}this._update()}copy(t){const e=this.size,r=this.viewpoint;return r&&e?(this.viewpoint=Mnt(r,t.viewpoint),this._set("size",Ns(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new hz({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,r){return KO(e)?Wg(t,e,this.inverseTransform):(Ko[0]=e,Ko[1]=r,Wg(t,Ko,this.inverseTransform))}toScreen(t,e,r){return KO(e)?Wg(t,e,this.transform):(Ko[0]=e,Ko[1]=r,Wg(t,Ko,this.transform))}toScreenNoRotation(t,e,r){return KO(e)?Wg(t,e,this.transformNoRotation):(Ko[0]=e,Ko[1]=r,Wg(t,Ko,this.transformNoRotation))}toScreenClosest(t,e,r){KO(e)?(Ko[0]=e[0],Ko[1]=e[1]):(Ko[0]=e,Ko[1]=r);const[i]=Ko,{center:s,extent:n,spatialReference:o,transform:a}=this;return(i<n.xmin||i>n.xmax)&&(Ko[0]=Ant(i,s[0],o)),Wg(t,Ko,a)}getScreenTransform(t,e){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,s=this._get("size");return GH(t,r,s,e,0,i),t}_update(){const{center:t,spatialReference:e,scale:r,rotation:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new id({targetGeometry:new nt(t[0],t[1],e),scale:r,rotation:i});if(this._set("viewpoint",o),!n||!e||!r)return;this.resolution=qN(o),this.rotation=i,this.scale=r,this.spatialReference=e,Ns(this.center,t);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;WV(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=YV(this.viewMat3),u=mu(n[0]/2,n[1]/2),d=mu(-n[0]/2,-n[1]/2),p=XL(i);aI(c,c,u),XV(c,c,p),aI(c,c,d),qx(this.displayViewMat3,this.displayMat3,c);const g=zH(this.viewMat2d,u);return kH(g,g,p),BH(g,g,d),$nt(this.extent,o,n),Dnt(this.transform,o,n,s),Cbe(this.inverseTransform,this.transform),Nnt(this.transformNoRotation,o,n,s),this.worldScreenWidth=Unt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};h([f({readOnly:!0})],Zg.prototype,"id",void 0),h([f({value:1,json:{write:!0}})],Zg.prototype,"pixelRatio",null),h([f({json:{write:!0}})],Zg.prototype,"size",null),h([f()],Zg.prototype,"spatialReference",void 0),h([f({type:id,json:{write:!0}})],Zg.prototype,"viewpoint",null),Zg=hz=h([k("esri.views.2d.ViewState")],Zg);const knt=Zg;var dz,pz,_te,vte,bte,wte,xte,Tte,Ste,Ete,Cte,Ate,Rte,Ote,Pte,Mte,$te,Ite,Lte,Dte,Nte,Fte,Ute,kte,Bte,zte,Vte,Gte,jte,Hte,qte,Wte,Yte,Xte,Zte,Jte,Qte,Kte,ere,tre,rre,ire,sre,nre,ore,are,lre,cre,ure,hre,dre,pre,fre,mre,gre,yre,_re,vre,bre,wre,xre;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(dz||(dz={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(pz||(pz={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(_te||(_te={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(vte||(vte={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(bte||(bte={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(wte||(wte={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(xte||(xte={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(Tte||(Tte={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(Ste||(Ste={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(Ete||(Ete={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(Cte||(Cte={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(Ate||(Ate={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(Rte||(Rte={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(Ote||(Ote={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(Pte||(Pte={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(Mte||(Mte={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}($te||($te={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(Ite||(Ite={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(Lte||(Lte={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(Dte||(Dte={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees"}(Nte||(Nte={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(Fte||(Fte={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(Ute||(Ute={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(kte||(kte={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(Bte||(Bte={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(zte||(zte={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(Vte||(Vte={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(Gte||(Gte={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(jte||(jte={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(Hte||(Hte={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(qte||(qte={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(Wte||(Wte={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(Yte||(Yte={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(Xte||(Xte={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(Zte||(Zte={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(Jte||(Jte={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(Qte||(Qte={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(Kte||(Kte={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(ere||(ere={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(tre||(tre={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(rre||(rre={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(ire||(ire={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(sre||(sre={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(nre||(nre={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(ore||(ore={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(are||(are={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(lre||(lre={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(cre||(cre={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(ure||(ure={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(hre||(hre={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(dre||(dre={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(pre||(pre={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(fre||(fre={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(mre||(mre={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(gre||(gre={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(yre||(yre={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(_re||(_re={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(vre||(vre={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(bre||(bre={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(wre||(wre={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(xre||(xre={}));var fz,u1,mz,uL,gz,hL,yz,h1,_z;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(fz||(fz={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(u1||(u1={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(mz||(mz={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(uL||(uL={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(gz||(gz={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(hL||(hL={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(yz||(yz={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(h1||(h1={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(_z||(_z={}));let sh=class{};sh.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:u1.VISIBLE}},sh.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:u1.VISIBLE}},sh.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:u1.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:dz.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:pz.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},sh.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:u1.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:mz.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:hL.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:uL.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:hL.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:gz.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:uL.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:yz.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[_z.HORIZONTAL]}},sh.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:u1.VISIBLE}},sh.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},sh.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:h1.MAP}},sh.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:h1.MAP},"line-width":{type:"number",minimum:0,default:1}},sh.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:h1.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:h1.MAP}},sh.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},sh.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:h1.MAP}};let Bnt=class extends zve{_createTransforms(){return{dvs:zo(),tileMat3:zo()}}};const znt=.125;let Vnt=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new knt({viewpoint:new id({targetGeometry:new nt(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new Bnt(new gv(0,0,0,0),0,0,0,512,512,4096,4096)}dispose(){this._renderParams=null}renderBackground(e,r,i,s,n,o,a,l,c,u){const d=this._backgroundTile;this._updateRenderParams(e,r,d,i,n,o,a,l,c,u),this._renderParams.stencilSymbols=!1,i.drawBackground(this._renderParams,d,s)}renderContent(e,r,i,s,n,o,a,l,c,u,d,p){this._stencilSymbols(e,r,i,s,n,o,a,Math.round(1/l),c,u,d,p);let g=1;i.stencilRef=g++,e.setStencilFunction(Ar.EQUAL,i.stencilRef,255),this._render(e,r,i,n,o,a,l,c,u,d,p),s.forAll(y=>{y.sourceLayerInfo.data.stencilRef=g++,this._renderSymbols(e,y.sourceLod,y.sourceLayerInfo.data,n,o,a,Math.round(1/l),y.offset,u,d,p)})}_stencilSymbols(e,r,i,s,n,o,a,l,c,u,d,p){let g=1;i.stencilRef=g++,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(Di.KEEP,Di.KEEP,Di.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(Ar.ALWAYS,i.stencilRef,255),this._stencilTileSymbols(e,r,i,n,o,a,l,c,u,d,p);for(const y of s.toArray()){const{sourceLod:_,offset:v,sourceLayerInfo:w}=y;w.data.stencilRef=g++,e.setStencilFunction(Ar.ALWAYS,w.data.stencilRef,255),this._stencilTileSymbols(e,_,w.data,n,o,a,l,v,u,d,p)}e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,r,i,s,n,o,a,l,c,u,d){e.setStencilFunction(Ar.EQUAL,i.stencilRef,255),this._render(e,r,i,s,n,o,a,l,c,u,d,fz.SYMBOL)}_render(e,r,i,s,n,o,a,l,c,u,d,p){this._updateRenderParams(e,r,i,s,o,a,l,c,u,d),this._renderParams.stencilSymbols=!1,s.drawTile(this._renderParams,i,n,p)}_stencilTileSymbols(e,r,i,s,n,o,a,l,c,u,d){this._updateRenderParams(e,r,i,s,o,a,l,c,u,d),this._renderParams.stencilSymbols=!0,i.triangleCount=0,s.drawSymbols(this._renderParams,i,n)}_updateRenderParams(e,r,i,s,n,o,a,l,c,u){"type"in i&&i.type==="vector-tile"&&!i.stage&&i.attachWithContext(e);const d=r[0]-n.getLevelShift(r[0]),p=this._renderParams;p.context=e,p.painter=s,p.glyphMosaic=s.glyphMosaic,p.spriteMosaic=s.spriteMosaic,p.pixelRatio=c*u,p.displayLevel=d,p.requiredLevel=d;const g=n.getScale(r[0]),[y,_]=n.getOffset(r,o*g),v=znt*o*g/l,w=i.transforms.dvs;w[0]=v,w[4]=-v,w[6]=-1-y-a[0]*o*2,w[7]=1+_+(1-a[1])*o*2-2,p.state.size[0]=l/u,p.state.size[1]=l/u,p.state.pixelRatio=u}},Lbe=class Dbe extends Sr{initializeProgram(e){return new vr(e.rctx,Dbe.shader.get().build(this.configuration),hr)}initializePipeline(){return Et({blending:Dl(ve.ONE,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ut})}};Lbe.shader=new _r(Wit,()=>he(()=>import("./RasterColorizer.glsl-1e3dce3d.js"),[],import.meta.url));let aE=class extends dC{constructor(){super(...arguments),this.colorizerType=F1.Stretch,this.stretchType=yv.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};h([F({count:F1.COUNT})],aE.prototype,"colorizerType",void 0),h([F({count:yv.COUNT})],aE.prototype,"stretchType",void 0),h([F()],aE.prototype,"applyColormap",void 0),h([F()],aE.prototype,"requireBilinearWithNN",void 0);let Tre=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const r=this._fbos.get(e);if(r)return r;const i=new dd(this._rctx,new Or(e),new uM(Cn.DEPTH24_STENCIL8,e));return this._fbos.set(e,i),i}};const Gnt=ne.getLogger("esri.views.3d.terrain");let jnt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new Vnt,this._bindParameters=new QD(null,null),this._blendLayersTechniqueConfig=new Tbe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=ef(this._rctx,q3)}dispose(){this._fbos.forEach(Ke),this._fbos=null,this._vtFBO=Ke(this._vtFBO),this._vaoQuad=Ke(this._vaoQuad),this._vectorTileHelper=Ke(this._vectorTileHelper),this._backgroundTechnique=Zt(this._backgroundTechnique),this._applyOpacityTechnique=Zt(this._applyOpacityTechnique),this._blendLayersTechnique=Zt(this._blendLayersTechnique)}_getBlendLayersTechnique(e,r,i,s=Ph.Off,n=_v.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(wbe,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,r){const i=this._getBlendLayersTechnique(Ae.Normal,r?Is.ColorComposite:Is.GridComposite,_c.NotRequired,Ph.Off,_v.Only),s=this._rctx.bindTechnique(i,e,this._bindParameters);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Qt.TRIANGLE_STRIP,0,nm(this._vaoQuad,"geometry"))}drawGroup(e,r,i,s,n,o=Ph.On){r===Is.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),e.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,r,i,s,n,o=Ph.Off){if(e.texture==null)return;e.fboTexture=r===Is.GroupBackgroundComposite||s===Ae.Normal&&n===_c.NotRequired&&o===Ph.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,r,i,s,n,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,Vt.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=s===Ae.Normal&&n===_c.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(a,r,s,n);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const u=this._rctx.bindTechnique(l,c,null);this._render(u)}_getRasterColorizerTechnique(e,r,i,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new aE,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?yv.Noop:yv.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(Lbe,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,r,i,s,n,o,a,l,c){const u=this._rctx,d=o.sourceLayerInfo.data,p=o.tile.surface.layerViewByIndex(o.layerIndex,Vt.MAP),g=n===_c.Required||e.opacity<1||s!==Ae.Normal||r!==Is.Composite,y=g?Ph.On:Ph.Off,_=this._getBlendLayersTechnique(s,r,n,y);u.setPipelineState(_.getPipeline());let v=null,w=null;g?(w=this.currentFBO(i),this._vtFBO==null&&(this._vtFBO=new Tre(this._rctx)),v=this._vtFBO.get(i),u.bindFramebuffer(v),this._clearCurrentFBO()):c&&u.clearSafe(ii.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(u,o.sourceLod,p.painter,p.layer.styleRepository,p.schemaHelper,Math.round(1/o.scale),o.offset,l,a,p.contentZoom),d&&this._vectorTileHelper.renderContent(u,o.sourceLod,d,o.vtlNeighborInfos,p.painter,p.layer.styleRepository,p.schemaHelper,Math.round(1/o.scale),o.offset,l,a,p.contentZoom)}catch(x){Gnt.warnOnce("A render call containing vector tiles did not resolve correctly.",x)}return v==null||(u.bindFramebuffer(w),e.texture=v.colorTexture,e.offset=_m,e.scale=1,this.drawRasterData(e,r,i,s,n,y),c)}copyFBOToTexture(e){const r=this._rctx,i=r.bindTexture(e.texture,Rt.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;r.gl.copyTexImage2D(Ji.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),r.bindTexture(i,Rt.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clearSafe(ii.COLOR_BUFFER_BIT|ii.DEPTH_BUFFER_BIT|ii.STENCIL_BUFFER_BIT)}_initFBO(e,r,i){this._rctx.bindFramebuffer(e),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let s=this._fbos.length;s<=r;s++)this._fbos.push(new Tre(this._rctx));this._initFBO(this._fbos[r].get(e),e,i)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const r=this.currentFBO(e),i=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const r=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},Hnt=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new It({allocator:e=>e||new qnt})}},qnt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},Wnt=class{constructor(e,r,i,s,n,o){this.start=e,this.end=r,this.blendMode=i,this.opacity=s,this.output=n,this.baseOpacity=o}},Ynt=class{constructor(e,r,i,s){this._rctx=e,this.tileSize=r,this._techniques=i,this._cache=s,this._passParameters=new zst,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new jnt(this._rctx,this._techniques),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=Ke(this._composition),this._backgroundTexture=Zt(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,r){if(!e.renderData)return;const i=e.surface,s=i.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1,c=!1;const u=i.view.state.contentPixelRatio;let d=!1;dL.clear(),Fb.length=0;const p=e.layerInfo[Vt.MAP];let g=0,y=null;for(;g<p.length;g++){const v=i.layerViewByIndex(g,Vt.MAP),w=v.layer.opacity,x=v.fullOpacity;if(c=c||SP(v.layer),h3(v)){let C=v.layer.blendMode!=="normal";if(Cx(v.layer.parent)){const A=vz(v.layer.parent);A!=null&&A!==""&&(C=Nbe(v.layer.parent)||C)}C&&(d=C,l=!1)}if(w===0&&!d){p[g].pendingUpdates&=~(pt.TEXTURE_NOFADING&pt.TEXTURE_FADING);continue}++o;const T=p2(v),S=d6(e,g,T);if(S){if(p[g].pendingUpdates&=~(pt.TEXTURE_NOFADING&pt.TEXTURE_FADING),Cx(v.layer.parent)){const C=vz(v.layer.parent);C!=null&&C!==""&&Fbe(v.layer.parent,g)}T?a=Math.max(a,this.tileSize*u):s===1&&x===1&&(v.isOpaque||this._dataToTexture(S)&&S.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,y===null&&(y=g)}}const _=a/this.tileSize;n!==0&&y!==null?n===1&&!d&&this._useLayerTexture(e,y)||this._composeMapLayers(e,r,g-1,c,a,_,!l||d,dL,d):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=_m,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useBackgroundTexture(e,r){const i=this._ensureBackgroundTexture(this.tileSize);let s=hm.Immediate;(e.surface.view.layerViewManager.updating||r>0)&&(s=hm.Delayed);const n=e.renderData;n.textureReference==null&&(s=hm.Immediate),n.setTextureReference(new l6(i,Ws.FADING,Sre,e.surface.baseOpacity,0,1),s)}_useLayerTexture(e,r){const i=e.surface.layerViewByIndex(r,Vt.MAP),s=SP(i.layer),n=s?e.surface.baseOpacity:1,o=s?1:e.surface.baseOpacity,a=i.fullOpacity,l=d6(e,r,!1);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new l6(l.sourceLayerInfo.data,Ws.FADING,l,n,o,a)),!0)}_composeMapLayers(e,r,i,s,n,o,a,l,c){this._composition.ensureBuffer(n);const u=e.surface.baseOpacity;let d=!1,p=Dt.LINEAR_MIPMAP_LINEAR,g=!1,y=0;for(let x=i;x>=0;x--){const T=e.surface.layerViewByIndex(x,Vt.MAP),S=p2(T),C=d6(e,x,S),A=T.layer.opacity;if(!C||A===0&&!c)continue;const O=!SP(T.layer)&&!d;O&&(d=!0);let $=!1;l.forEach(Y=>{Y.start===x&&(Y.output=s?Is.Composite:a&&O?this.backgroundIsGrid?Is.GridComposite:Is.ColorComposite:Is.Composite,Y.baseOpacity=O?u:1,Fb.push(Y),this._composition.openGroup(n),$=!0)}),this._passParameters.baseOpacity=O&&!$&&u<1?u:1;const D=this._passParameters.baseOpacity<1?_c.Required:_c.NotRequired,N=y===0,z=$?Is.GroupBackgroundComposite:a&&N?this.backgroundIsGrid?Is.GridComposite:Is.ColorComposite:Is.Composite,U=lz[h3(T)?T.layer.blendMode:"normal"];for(this._passParameters.opacity=A,yrt(C)?g=this._composition.drawVectorData(this._passParameters,z,n,U,D,C,o,this.tileSize,g):grt(C)?(this._composition.drawImageryTileData(this._passParameters,z,n,U,D,C),this._hasNearestInterpolation(C)&&(p=Dt.NEAREST)):this._dataToTexture(C)&&(this._passParameters.texture=C.sourceLayerInfo.data.texture,this._passParameters.offset=C.offset,this._passParameters.scale=C.scale,this._composition.drawRasterData(this._passParameters,z,n,U,D));Fb.length>0&&Fb[Fb.length-1].end===x;){const Y=Fb.pop();this._passParameters.baseOpacity=Y.baseOpacity;const H=this._passParameters.baseOpacity<1?_c.Required:_c.NotRequired;this._passParameters.opacity=Y.opacity,this._passParameters.offset=_m,this._passParameters.scale=1,this._composition.drawGroup(this._passParameters,Y.output,n,lz[Y.blendMode],H)}y++}const _=e.renderData,v=c||d&&u<1,w=_.ensureTexture(n,v,()=>this._buildTexture(n,v,p));this._composition.copyFBOToTexture(w),this._composition.unbind(),_.setTextureReference(new l6(w,r,Sre,d?1:u,0,1))}_hasNearestInterpolation(e){const r=e.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(e){if(vrt(e)){const r=e.sourceLayerInfo;r.data=this._buildTexture(r.data,!0),e.tile.setMemoryDirty()}return _rt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,r,i=Dt.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const s=new Or;s.wrapMode=Ft.CLAMP_TO_EDGE,s.samplingMode=i,s.maxAnisotropy=this._maxAnisotropy,s.preMultiplyAlpha=!0,s.flipped=!0,s.hasMipmap=!0,r||(s.pixelFormat=ut.RGB);const n=this._rctx;let o;if(typeof e=="number"){s.width=s.height=e;const l=`${e} ${s.pixelFormat}`;o=this._cache.pop(l),o?o.retain():o=new oE(new Rt(n,s),this._cache)}else if(Jtt(e)){s.isOpaque=e.isOpaque,s.isOpaque&&(s.pixelFormat=ut.RGB);const l=`${e} ${s.pixelFormat}`;o=this._cache.pop(l),o?(o.retain(),o.texture.setData(e.image)):o=new oE(new Rt(n,s,e.image),this._cache),e.release()}else try{s.width=e.width,s.height=e.height,o=new oE(new Rt(n,s,e))}catch{o=new oE(sfe(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const a=n.bindTexture(o.texture,Rt.TEXTURE_UNIT_FOR_UPDATES);return o.generateMipmap(),n.bindTexture(a,Rt.TEXTURE_UNIT_FOR_UPDATES),o}get test(){return{backgroundTexture:this._backgroundTexture}}};function d6(t,e,r){To.layerIndex=e,To.vtlNeighborInfos.clear();const i=t.layerInfo[Vt.MAP][e];if(ir(To.offset,0,0),To.tile=t,To.scale=1,To.sourceLod=t.lij,To.sourceLayerInfo=i,To.isVTLBackground=r,i.data)return r&&t.forEachLoadedNeighbor((n,o)=>{if(n.level!==t.level)return;const a=n.layerInfo[Vt.MAP][e];if(!Fve(a)||i.data===a.data)return;const l=To.vtlNeighborInfos.pushNew();l.offset=Ff[o],l.sourceLod=n.lij,l.sourceLayerInfo=a}),To;const s=i.upsampleInfo;if(s){const n=s.tile.layerInfo[Vt.MAP][e];return To.tile=s.tile,Ns(To.offset,s.offset),To.scale=s.scale,To.sourceLod=s.tile.lij,To.sourceLayerInfo=n,To}return r?To:null}function vz(t){return t.uid}function Nbe(t){let e=t.blendMode!=="normal";return Cx(t.parent)&&(e=Nbe(t.parent)||e),e}function Fbe(t,e){Cx(t.parent)&&Fbe(t.parent,e);const r=vz(t);if(r!=null&&r!==""){const i=dL.get(r);i?i.start=e:dL.set(r,new Wnt(e,e,t.blendMode,t.opacity,Is.Composite,1))}}const dL=new Map,Fb=new Array,To=new Hnt,Sre={offset:[0,0],scale:1},Ff=new Array;Ff[tt.NORTH]=[0,-1],Ff[tt.NORTH_EAST]=[-1,-1],Ff[tt.EAST]=[-1,0],Ff[tt.SOUTH_EAST]=[-1,1],Ff[tt.SOUTH]=[0,1],Ff[tt.SOUTH_WEST]=[1,1],Ff[tt.WEST]=[1,0],Ff[tt.NORTH_WEST]=[1,-1];const Ube=200,p6=40,Xnt=.8,Znt=10,lE=1e-6;function Jnt(t,e,r){const i=e,s=r;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(i[a]<l){if(s[a]<=lE)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-lE){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(i[a]>l){if(s[a]>=-lE)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]>=lE){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let Ere=class{constructor(e,r,i,s,n){this.aabb=e,this.axis=r,this.d=i,this.midStartIndex=s,this.rightStartIndex=n}},jH=class bz{constructor(e,r,i,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=r,this.positions=s,this._rayDirection=E(),this.bspNodeTree=new Array;const n=i-r,o=n<=kbe?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=rot(e,r,i,s.data,s.stride),l=me(Math.log2(n/p6),2,Znt),c=(u,d,p)=>{const g=eot(o,a,u,d),y=d-u;if(y<=p6){const S=new Ere(g,void 0,0,u,d);return this.bspNodeTree.push(S),S}const{axis:_,midValue:v}=tot(g),w=Knt(o,a,u,d,_,v),x=(S,C)=>{if(p>l)return;const A=C-S;return A<p6||A>=Xnt*y?void 0:c(S,C,p+1)},T=new Ere(g,_,v,w.next,w.mid);return this.bspNodeTree.push(T),T.leftNode=x(u,w.next),T.rightNode=x(w.mid,d),T};c(0,n,0),this.triangleVertexIndices=iot(o,e,r,i)}}intersectRayTriangleRange(e,r){{if(e>=r)return;const i=this.triangleVertexIndices,s=this.positions.data,n=this.positions.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],u=this._rayDirection,d=u[0],p=u[1],g=u[2];for(let y=e,_=3*e;y<r;++y){let v=i[_++]*n;const w=s[v++],x=s[v++],T=s[v];v=i[_++]*n;const S=s[v++],C=s[v++],A=s[v];v=i[_++]*n;const O=S-w,$=C-x,D=A-T,N=s[v++]-w,z=s[v++]-x,U=s[v]-T,Y=p*U-z*g,H=g*N-U*d,V=d*z-N*p,J=O*Y+$*H+D*V;if(Math.abs(J)<=Number.EPSILON)continue;const P=a-w,I=l-x,B=c-T,G=P*Y+I*H+B*V;if(J>0){if(G<0||G>J)continue}else if(G>0||G<J)continue;const q=I*D-$*B,Z=B*O-D*P,K=P*$-O*I,fe=d*q+p*Z+g*K;if(J>0){if(fe<0||G+fe>J)continue}else if(fe>0||G+fe<J)continue;const Pe=(N*q+z*Z+U*K)/J;if(Pe>=0){const lt=this.indices[y]+this.firstTriangleIndex,Tt=fj(O,$,D,N,z,U,Qnt);this._callback(Pe,Tt,lt,!1)}}}bz.numFacesTested+=r-e}intersectRay(e,r){bz.numFacesTested=0;const i=Te(e.r0[0],e.r0[1],e.r0[2]),s=Te(e.r1[0],e.r1[1],e.r1[2]),n=s[0]-i[0],o=s[1]-i[1],a=s[2]-i[2];if(n*n+o*o+a*a<lE)return;this._rayOrigin=i;const l=this._rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=r;const u=this.bspNodeTree[0];this.intersectRayBSP(u,0,c)}intersectRayBSP(e,r,i){const s=this._rayOrigin,n=this._rayDirection;if(!Jnt(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=r,c=e.midStartIndex;if(l<c){const u=e.leftNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=i;if(l<c){const u=e.rightNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};jH.numFacesTested=0;const Qnt=E(),Ub=[1/0,1/0,1/0],kb=[-1/0,-1/0,-1/0];function Knt(t,e,r,i,s,n){let o=r,a=i;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=i;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function eot(t,e,r,i){if(i<=r)return K1(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[r];for(let n=0;n<3;++n)Ub[n]=e[s+0+n],kb[n]=e[s+3+n]}for(let s=r+1;s<i;++s){const n=6*t[s];for(let o=0;o<3;++o)Ub[o]=Math.min(Ub[o],e[n+0+o]),kb[o]=Math.max(kb[o],e[n+3+o])}return K1(Ub[0],Ub[1],Ub[2],kb[0],kb[1],kb[2])}function tot(t){const e=t[3]-t[0],r=t[4]-t[1],i=t[5]-t[2],s=e>r?e>i?0:r>i?1:2:r>i?1:i>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function rot(t,e,r,i,s){const n=r-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l]*s,u=t[l+1]*s,d=t[l+2]*s;for(let p=0;p<3;++p){const g=i[c+p],y=i[u+p],_=i[d+p];o[6*a+p]=Math.min(g,y,_),o[6*a+3+p]=Math.max(g,y,_)}}return o}function iot(t,e,r,i){const s=i-r;let n=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)n=Math.max(e[3*a+l],n);const o=n<=kbe?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(t[a]+r);for(let c=0;c<3;++c){const u=e[l+c];o[3*a+c]=u}}return o}const kbe=65535;let ys=class extends ga{constructor(){super(...arguments),this.output=L.Color,this.overlayMode=wp.Disabled,this.tileBlendInput=xp.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=et.Terrain}};h([F({count:L.COUNT})],ys.prototype,"output",void 0),h([F({count:wp.COUNT})],ys.prototype,"overlayMode",void 0),h([F({count:xp.COUNT})],ys.prototype,"tileBlendInput",void 0),h([F()],ys.prototype,"spherical",void 0),h([F()],ys.prototype,"doublePrecisionRequiresObfuscation",void 0),h([F()],ys.prototype,"receiveShadows",void 0),h([F()],ys.prototype,"hasSlicePlane",void 0),h([F()],ys.prototype,"backfaceCullingEnabled",void 0),h([F()],ys.prototype,"textureFadingEnabled",void 0),h([F()],ys.prototype,"renderOccluded",void 0),h([F()],ys.prototype,"hasScreenSpaceReflections",void 0),h([F()],ys.prototype,"hasCloudsReflections",void 0),h([F()],ys.prototype,"invisible",void 0),h([F()],ys.prototype,"tileBorders",void 0),h([F()],ys.prototype,"visualizeNormals",void 0),h([F()],ys.prototype,"screenSizePerspective",void 0),h([F()],ys.prototype,"receiveAmbientOcclusion",void 0),h([F({count:et.COUNT})],ys.prototype,"pbrMode",void 0),h([F({constValue:Tr.Compressed})],ys.prototype,"normalType",void 0),h([F({constValue:xs.Compressed})],ys.prototype,"textureCoordinateType",void 0),h([F({constValue:!1})],ys.prototype,"highStepCount",void 0),h([F({constValue:!1})],ys.prototype,"useCustomDTRExponentForWater",void 0),h([F({constValue:!1})],ys.prototype,"useFillLights",void 0),h([F({constValue:!0})],ys.prototype,"hasColorTexture",void 0);const f6=7,sot=10,m6=tn();var ha;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(ha||(ha={}));let vh=class extends Eme{get _isGlobal(){return this._stage.viewingMode===$e.Global}get _techniques(){return this._context.techniqueRepository}get _rctx(){return this._context.renderContext.rctx}constructor(e,r,i,s,n){super({}),this._overlayRenderer=e,this._stage=r,this._allTiles=i,this._ellipsoidRadius=s,this.type=Mi.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new ys,this._passParameters=new rbe,this._renderDataPool=new Vo(gst),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new Yve,this._transparencyState=ha.Opaque,this._castShadows=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=Ti.Occlude,this.produces=new Map([[oe.OPAQUE_TERRAIN,()=>this._produces()],[oe.TRANSPARENT_TERRAIN,()=>this._produces()],[oe.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileTextureCache=new H3((o,a)=>n.newCache(o,a),"TileTexture"),this.tileGeometryCache=new Ust(n)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this)}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?xme:lN}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===ha.TransparentWithDraped||e===ha.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return l0}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?JI:Ti.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,pt.TEXTURE_FADING)}updateTileTexture(e,r){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,r===pt.TEXTURE_FADING?Ws.FADING:Ws.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(r))}updateTileGeometryState(e){for(const i of e.layerInfo[Vt.ELEVATION])i.pendingUpdates&=~pt.GEOMETRY;e.resetPendingUpdate(pt.GEOMETRY);const r=e.renderData.updateGeometryState();return r&&this.setDirty(),r}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const r=e.renderData;r&&(r.releaseGeometry(),this._renderDataPool.release(r),r.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const r=sot-f6,i=Math.max(0,Math.floor((e.level-r)/f6)*f6);if(this._isGlobal&&i===0)return Mn;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=cs.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=cs.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=cs.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new Ynt(this._rctx,this._tileSize,this._techniques,this._tileTextureCache),this.updateTileBackground(),this._emptyTex=sfe(this._rctx)}uninitializeRenderContext(){this._emptyTex=Ke(this._emptyTex),this._tileRenderer=Ke(this._tileRenderer)}intersect(e,r,i,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==ha.Opaque)return;const n=not,o=oot;ce(n,s,i),se(o,1/n[0],1/n[1],1/n[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,u=e.options.store===Xn.MIN,d=!!e.results.ground.target,p=h4e(e.verticalOffset),g=e.tolerance;let y,_=u&&a.dist!=null?a.dist:1/0;const v=x=>{const T=x.renderData;if(!(T!=null&&T.vao))return;const S=T.geometry;_D(m6,S.boundingBox);const C=T.localOrigin;p!=null&&(p.localOrigin=C,p.applyToAabb(m6));const A=m6;if(Bb[0]=i[0]-C[0],Bb[1]=i[1]-C[1],Bb[2]=i[2]-C[2],!gj(A,Bb,o,g,_))return;const O=(V,J,P)=>{V.set(this.type,x,J,P,$i),_=u&&a.dist!=null?a.dist:1/0},$=(V,J)=>{if(J!=null&&V>=0&&(e.options.backfacesTerrain||de(J,n)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||r==null||r(i,s,V))){if((c.dist==null||V<c.dist)&&O(c,V,J),e.options.isFiltered)return;e.options.store===Xn.ALL&&(y==null?(y=sG(e.ray),O(y,V,J),e.results.all.push(y)):V<y.dist&&O(y,V,J)),(a.dist==null||V<a.dist)&&O(a,V,J),e.options.store!==Xn.MIN&&(l.dist==null||V>l.dist)&&O(l,V,J)}},D=aot;ce(D,s,C);const N=S.indices,z=S.vertexAttributes,U=z.getField(R.POSITION,cn),Y=new j3(U.typedBuffer,3,z.stride/4),H=S.indexCount/3;if(!p&&H>Ube){const V=x.renderData;V.intersectionData==null&&(V.intersectionData=new jH(N,0,H,Y)),V.intersectionData.intersectRay({r0:Bb,r1:D},$)}else tA(Bb,D,0,H,N,Y,null,p,$)},w=this._rootTiles;w!=null&&(()=>{const x=this._tileIterator;x.reset(w);const T=e.options.invisibleTerrain;for(let S=x.next();S;S=x.next())!(S.visible||T&&S.intersectsClippingArea)||p==null&&!S.intersectsRay(i,n,g,_)||d&&this._useStencilForTile(S)?x.skipSubtree():v(S)})()}processScaleRangeQueries(e,r){var i;if(!r.done)for(this._updatePatchGroups();e.updating&&!r.done;){e.prepare();for(const s of this._visiblePatchesByOrigin.values())for(const n of s)((i=n.renderData)==null?void 0:i.textureReference)!=null&&e.queriesForTile(n);e.process(),r.madeProgress()}}prepareTechnique(e){const r=te("enable-feature:terrain-shadows")&&e.bindParameters.shadowMap.enabled;if(r!==this._castShadows&&(this._castShadows=r,this._patchesByOriginDirty=!0),e.bindParameters.slot===oe.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&JI))return null}else{const i=this.transparency===ha.Opaque?oe.OPAQUE_TERRAIN:oe.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==i)return null}if(this.transparency===ha.Empty)return null;switch(e.output){case L.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.lastFrameColor!=null,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssao!=null,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(L.Color,e.bindParameters.slot===oe.OCCLUDED_TERRAIN);case L.Shadow:case L.ShadowExcludeHighlight:return this._castShadows?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.Shadow,!1)):null;case L.Depth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.Depth,!1);case L.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.Normal,!1);case L.ObjectAndLayerIdColor:return this._updateTechnique(L.ObjectAndLayerIdColor,!1);case L.Highlight:return this._overlayRenderer.hasHighlights?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.Highlight,!1)):null}return null}renderNode(e,r){switch(this._updatePatchGroups(),r.useStencil=!1,e.output){case L.Color:{const i=e.bindParameters.slot===oe.OCCLUDED_TERRAIN?Ei.Occluded:Ei.Color;this._renderMaterialPass(e,r,i);break}case L.Depth:case L.Normal:this._renderAuxiliaryPass(e,r,Ei.Color,this._visiblePatchesByOrigin);break;case L.Highlight:this._renderAuxiliaryPass(e,r,Ei.Highlight,this._visiblePatchesByOrigin);break;case L.Shadow:case L.ShadowExcludeHighlight:this._renderAuxiliaryPass(e,r,null,this._allPatchesByOrigin);break;case L.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,r,Ei.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(e){if(this._tileRenderer==null)return;const r=this._tileRenderer;let i;if(e!=null){const s=qe.toUnitRGBA(e);i=Te(s[0]||0,s[1]||0,s[2]||0)}r.setBackground(i),this._allTiles.forAll(s=>r.updateTileTexture(s,Ws.FADING)),this._techniqueConfiguration.tileBlendInput=r.backgroundIsGrid?xp.GridComposite:r.backgroundColor!=null?xp.ColorComposite:xp.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==f2.NONE){const e=Array.from(this._visiblePatchesByOrigin.values()),r=this._stencilEnabledLayerExtents;for(const i of e)Xve(this.renderOrder,i,r);e.sort((i,s)=>Zve(i[0],s[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var r;const e=this._rootTiles;if(e!=null){(r=e[0])==null||r.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const r=this._tileIterator;for(r.resetOne(e);!r.done;){const i=r.next(),s=i.renderData;if(!s){this._numTilesCulled++;continue}const n=s.localOrigin;if(this._castShadows){let a=this._allPatchesByOrigin.get(n);a||(a=new Array,this._allPatchesByOrigin.set(n,a)),a.push(i)}if(!i.visible){this._numTilesCulled++,r.skipSubtree();continue}let o=this._visiblePatchesByOrigin.get(n);o||(o=new Array,this._visiblePatchesByOrigin.set(n,o)),o.push(i),r.skipSubtree()}}_useStencilForTile(e){for(const r of this._stencilEnabledLayerExtents)if(e.intersectsExtent(r))return!0;return!1}_renderAuxiliaryPass(e,r,i,s){const n=e.rctx;this._passParameters.overlayContent=i,n.bindTechnique(r,this._passParameters,e.bindParameters);const o=this._stencilEnabledLayerExtents.length>0;s.forEach(a=>{const l=a[0].renderData.localOrigin;r.program.bindDraw(new VB(l),e.bindParameters,this._passParameters);for(let c=0;c<a.length;c++)this._renderPatch(e,r,a[c],Qt.TRIANGLES,o,i)}),e.rctx.bindVAO(null)}_renderMaterialPass(e,r,i){var p;const{rctx:s}=e;this._passParameters.overlayContent=i,s.bindTechnique(r,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const n=e.bindParameters.camera,o=r.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const g=vge(this._stage.viewingMode,this._ellipsoidRadius),y=this.pointsOfInterest.centerOnSurfaceFrequent.distance;g.update({distance:y,fovY:n.fovY})}const a=this._stencilEnabledLayerExtents.length>0,l=i===Ei.Occluded;l&&(o.bindTexture("tex",this._emptyTex),o.setUniform3fv("textureOpacities",Mn),o.setUniform4fv("texOffsetAndScale",Ec));const c=((p=this._tileRenderer)==null?void 0:p.backgroundColor)!=null?this._tileRenderer.backgroundColor:Mn;this._techniqueConfiguration.tileBlendInput===xp.ColorComposite&&o.setUniform3fv("backgroundColor",c);const u=this.wireframe?Qt.LINES:Qt.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&o.bindTexture("texNext",this._emptyTex);const d=this._visiblePatchesByOrigin;for(const g of d.values()){const y=g[0].renderData.localOrigin;r.program.bindDraw(new VB(y),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const _ of g){const v=_.renderData,w=v.textureReference;if(w!=null){if(!l){o.setUniform4fv("texOffsetAndScale",w.offsetAndScale),o.bindTexture("tex",w.texture.texture);const x=v.textureFadeFactor,T=x<1?v.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&T!=null&&x<1?(o.setUniform1f("fadeFactor",x),o.setUniform4fv("nextTexOffsetAndScale",T.offsetAndScale),o.setUniform3fv("nextTexOpacities",T.opacities),o.bindTexture("texNext",T.texture.texture)):o.setUniform1f("fadeFactor",1),v.textureIsFading&&this.setNeedsRender(),o.setUniform3fv("textureOpacities",w.opacities)}this._renderPatch(e,r,_,u,a,i),_.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,r,i,s,n,o){const a=i.renderData,l=a.vao,c=l==null?void 0:l.indexBuffer;if(c==null)return void(Ks&&console.error("Rendered tile with no indices: ",i.lij," : ",a));const u=r.program;o==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(u,a.overlay),n&&(r.useStencil=this._useStencilForTile(i),e.rctx.setPipelineState(r.getPipeline()));const d=a.geometry.indexCount;e.rctx.bindVAO(l),u.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,d,c.indexType,0)}_bindOverlayPatchData(e,r){e.setUniform4fv("overlayTexOffset",r.offsets),e.setUniform4fv("overlayTexScale",r.scales)}_updateTechnique(e,r){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=r,this._shaderTechnique=this._techniques.releaseAndAcquire(ibe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};h([f({readOnly:!0})],vh.prototype,"_isGlobal",null),h([f({value:!1})],vh.prototype,"renderingDisabled",null),h([f({value:!0})],vh.prototype,"visible",null),h([f()],vh.prototype,"renderPatchBorders",null),h([f()],vh.prototype,"visualizeNormals",null),h([f()],vh.prototype,"cullBackFaces",null),h([f({value:f2.FRONT_TO_BACK})],vh.prototype,"renderOrder",null),h([f()],vh.prototype,"wireframe",null),vh=h([k("esri.views.3d.terrain.TerrainRenderer")],vh);const not=E(),oot=E(),Bb=E(),aot=E();let lot=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},ip=class extends xe{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),ae(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(r=>!(!TE(r)||r.isRejected())&&!(r.isFulfilled()&&!cot(r,this.viewSpatialReference,this.viewingMode))&&(e=r,!((r==null?void 0:r.type)==="vector-tile"||aL(r)))),e)if(e.isResolved()){const r=VN(e,this.viewSpatialReference,this.viewingMode);if(r!=null){const i=new wl(r.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const r=e.when().catch(()=>{}).then(()=>{r!==this._waitTask||this.destroyed||this._update()});this._waitTask=r}_lockTilingScheme(e){if(this.viewingMode===$e.Global){const r=e.levels.length-1;e.spatialReference.isWebMercator?e=wl.makeWebMercatorAuxiliarySphere(r):Y0(e.spatialReference)&&(e=wl.makeGCSWithTileSize(e.spatialReference,e.pixelSize,r))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(ae(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===$e.Global){const e=this.extentHelper.viewSpatialReference,r=Y0(e)||Wp(e)||Yp(e);e.isWebMercator?this.tilingScheme=wl.WebMercatorAuxiliarySphere:r&&(this.tilingScheme=wl.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||E1(e,this.extent)||(this.tilingScheme=wl.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function cot(t,e,r){return VN(t,e,r)!=null}h([f()],ip.prototype,"tilingScheme",void 0),h([f({readOnly:!0})],ip.prototype,"extent",void 0),h([f({value:!1})],ip.prototype,"tilingSchemeLocked",void 0),h([f({constructOnly:!0})],ip.prototype,"viewSpatialReference",void 0),h([f({constructOnly:!0})],ip.prototype,"layers",void 0),h([f({constructOnly:!0})],ip.prototype,"extentHelper",void 0),h([f({constructOnly:!0})],ip.prototype,"viewingMode",void 0),ip=h([k("esri.views.3d.terrain.TilingSchemeLogic")],ip);let uot=class{constructor(){this.offset=ke(),this.scale=0,this.tile=null}init(e,r,i,s){this.tile=e,this.offset[0]=r,this.offset[1]=i,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}};var YM;let kt=YM=class extends Ps.EventedMixin(xe){constructor(t){var e,r;super(t),this._scaleRangeQueries=new qM,this._iteratorPool=new Vo(Yve,i=>i.remove=()=>this._iteratorPool.release(i)),this._postorderIterator=new Cit,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new lot,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=E(),this._eyePosSurfaceSR=E(),this._splitLimits=new _h,this._frustum=WC(),this._viewProjectionMatrix=ge(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new Yh,this._frameTask=Kx,this._allTiles=new It,this._upsampleInfoPool=new Vo(uot),this._shouldEmitChangeEvent=!1,this._rootTilesExtent=Gt(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=at.WebMercator,this.visibleElevationBounds=new Yw(1/0,-1/0),this.rootTileElevationBounds=new Yw(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this.overlayManager=new La({...t,surface:this}),this._isGlobal=!((r=(e=t.view)==null?void 0:e.state)!=null&&r.isLocal),this._tileConstructor=this._isGlobal?Dst:$st}initialize(){const t=this.view,e=t.resourceController;this._lercDecoder=eit(e);const r=e.memoryController;this._tileCache=new H3((l,c)=>r.newCache(l,c),"terrain-tile"),this._upsampleMapCache=r.newCache("terrain-upsample",l=>l.unloadMapData()),this._elevationQueryCache=new Qrt(r.newCache("elevation-query"));const i=this.overlayManager;this._renderer=new vh(i.renderer,t._stage,this._allTiles,Mr(t.spatialReference).radius,r),this.addHandles([ae(()=>i.rendersOccluded,l=>this._renderer.setRenderOccludedOverlay(l)),ae(()=>i.renderer.isEmpty,()=>this._evaluateTransparency()),ae(()=>this.renderer.visible,l=>this.suspended=!l)],"overlayManager"),this.addHandles([ae(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?Ws.UNFADED:Ws.IMMEDIATE)},Br),ae(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?Ws.UNFADED:Ws.IMMEDIATE),Br),ae(()=>this.backgroundColor,(l,c)=>{l!=null&&l.equals(c)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(l))},Fr),ae(()=>this.snapLevel,()=>this._viewChanged=!0,Fr),ae(()=>this.view.pointsOfInterest,l=>{this._renderer.pointsOfInterest=l,this._watchUpdatingTracking.removeAll(),l&&this._watchUpdatingTracking.add(()=>l.focus.renderLocation,()=>this._allTilesSorted=!1)}),ae(()=>Zr.TERRAIN_TILE_TREE_SHOW_TILES,l=>{l&&!this._treeDebugger?he(()=>import("./TerrainTileTree3DDebugger-67b378e0.js"),["./TerrainTileTree3DDebugger-67b378e0.js","./TileTreeDebugger-8a24bf3f.js"],import.meta.url).then(({TerrainTileTree3DDebugger:c})=>{!this._treeDebugger&&Zr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new c({view:t}))}):l||(this._treeDebugger=Oe(this._treeDebugger))},zr)]);const{spatialReference:s}=t;this._extentHelper=mit(this.viewingMode,{layers:t.map.allLayers,layerViews:t.allLayerViews,viewSpatialReference:s});const n=new RC({getCollections:()=>{var l,c;return(c=(l=t.defaultsFromMap)==null?void 0:l.mapCollections)==null?void 0:c.map(({layers:u})=>u)},getChildrenFunction:l=>l&&"layers"in l?l.layers:null}),o=new ip({layers:n,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:s});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=e.createStreamDataRequester(yp.ELEVATION),this._mapDataRequester=e.createStreamDataRequester(yp.BASEMAP);const a=e.scheduler;this._frameTask=a.registerTask(ct.TERRAIN_SURFACE,this),this.addHandles([ae(()=>this._extentHelper.stencilEnabledExtents,l=>this._renderer.setStencilEnabledLayerExtents(l),zr),ae(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Fr),ae(()=>this.extent,()=>this._updateRootTiles(),zr),t.on("resize",()=>this._viewChangeUpdate()),ae(()=>{const l=t.state;return[this._lodBias,this.lodSnapping,t.quality,l.camera,l.contentCamera,l.fixedContentCamera]},()=>this._viewChangeUpdate(),Br),ae(()=>{var l,c;return(c=(l=t.qualitySettings)==null?void 0:l.tiledSurface)==null?void 0:c.textureFadeDuration},l=>this._renderer.textureFadingEnabled=l>0,zr),ae(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.physicallyBasedRenderingEnabled},l=>this._renderer.pbrMode=l?et.Terrain:et.Disabled,zr),ae(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Fr)]),this.addHandles(t.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Zt(this._lercDecoder),this._removeAllTiles(),this._set("tilingSchemeLogic",Oe(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((t,e)=>this._unregisterTiledLayerView(e)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Oe(this.overlayManager)),this._tileCache=Oe(this._tileCache),LH.prune(),this._treeDebugger=Oe(this._treeDebugger),this._renderer=Oe(this._renderer),this._iteratorPool=Oe(this._iteratorPool),this._upsampleMapCache=Oe(this._upsampleMapCache),this._elevationQueryCache=Oe(this._elevationQueryCache),this._set("view",null),this._extentHelper=Oe(this._extentHelper),this._upsampleInfoPool=Oe(this._upsampleInfoPool),uit(),tst()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var t,e;if(this.lodSnapping===QE.ON){const r=this.view,i=this.tilingScheme,s=(e=(t=r.pointsOfInterest)==null?void 0:t.cameraOnSurface)==null?void 0:e.scale;if(i&&s){const n=r.state.contentCamera;let o=qD(r,n.eye,n.viewForward,n.up).tilt;o>90&&(o=180-o);const a=2*(o/90)**2,l=i.levelAtScale(s)-a,c=Math.min(l+r.qualitySettings.tiledSurface.lodBias,this._splitLimits.maxLod||1/0);return c<=0?null:c}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?QE.ON:QE.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:t}=this,{clippingArea:e}=this.view;if(e==null||t==null)return null;const r=Gt(),i=Tve(e,r,t)?r:null,s=this._get("extent");return E1(i,s)?s:i}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const t=V8(this.groundExtent,this._userClippingExtent,Gt()),e=this._get("extent");return E1(t,e)?e:t}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var t;return(t=this.tilingSchemeLogic)==null?void 0:t.extent}get updating(){var t,e;return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||(t=this._watchUpdatingTracking)!=null&&t.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||(e=this.overlayManager)!=null&&e.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){var t,e,r;return((r=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:r.opacity)??1}set baseOpacity(t){this.view.map.ground.opacity=t}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(t){this._renderer.renderOrder=t,this._set("renderOrder",t)}get rootTiles(){return this._rootTiles}get spatialReference(){var t;return((t=this.tilingScheme)==null?void 0:t.spatialReference)??null}get backgroundColor(){var t,e,r;return(r=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:r.surfaceColor}set backgroundColor(t){this.view.map.ground.surfaceColor=t}set slicePlaneEnabled(t){this._renderer.slicePlaneEnabled=t,this._set("slicePlaneEnabled",t),this._evaluateTransparency()}get tilingSchemeLocked(){var t;return((t=this.tilingSchemeLogic)==null?void 0:t.tilingSchemeLocked)??!1}get wireframe(){var t;return(t=this._renderer)==null?void 0:t.wireframe}set wireframe(t){t!==this._renderer.wireframe&&(this._renderer.wireframe=t,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===ha.Opaque}set suspended(t){this._set("suspended",t),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(t,e,r,i){this._renderer.intersect(t,e,r,i)}getElevation(t,e,r,i){const s=this._rootTiles;if(!(s!=null&&s.length)||s[0].layerInfo[Vt.ELEVATION].length===0)return null;const n=Oa;return n[0]=t,n[1]=e,n[2]=r,mo(n,i,n,this._spatialReference)?Are(s,n[0],n[1]):(ne.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(t,e,r){const i=this._rootTiles,s=i?i[0].layerInfo[Vt.ELEVATION].length:0;if(i!=null&&i.length&&s!==0)for(let n=0;n<e;++n){const o=3*n;r(n,Are(i,t[o],t[o+1]))}else for(let n=0;n<e;++n)r(n,null)}getScale(t){if(!this.tilingScheme)return null;if(!Ll(t,Oa,this.spatialReference))return ne.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const e=this._rootTiles;if(e!=null){for(const r of e)if(r!=null&&r.containsPoint(Oa)){let i=r;for(;i.children[0]&&!i.rendered;){const s=i.children[0].extent;let n=0;Oa[0]>s[2]&&(n+=1),Oa[1]<s[1]&&(n+=2),i=i.children[n]}return this._getLodBiasCorrectedScale(i.level)}}return 1/0}getSphereElevationBounds(t,e){var o;if(Oa[0]=t[0],Oa[1]=t[1],Oa[2]=t[2],Oa[3]=t[3],!mo(Oa,e,Oa,(o=this.tilingScheme)==null?void 0:o.spatialReference))return ne.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let r=1/0,i=-1/0;const s=a=>{if(a&&fW(a.extent,Oa))if(a.isLeaf||a.rendered)r=Math.min(r,a.elevationBounds[0]),i=Math.max(i,a.elevationBounds[1]);else for(const l of a.children)s(l)},n=this._rootTiles;if(n!=null)for(const a of n)s(a);return{min:r,max:i}}getRootElevationBounds(){return{min:this.rootTileElevationBounds.min,max:this.rootTileElevationBounds.max}}getSphereScale(t,e){if(!this.tilingScheme)return null;if(!Ll(t,Oa,this.spatialReference))return ne.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Oa[3]=e;let r=null;const i=n=>{if(n&&fW(n.extent,Oa)){const o=n.children;if(o[0]&&!n.rendered)for(const a of o)i(a);else{const a=this._getLodBiasCorrectedScale(n.level);r=r==null?a:Math.min(r,a)}}},s=this._rootTiles;if(s!=null)for(const n of s)i(n);return r}queryVisibleScaleRange(t,e,r,i){const s=e?this.tilingScheme.levelAtScale(e):0,n=r?this.tilingScheme.levelAtScale(r):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(t,s+o,n+o,i)}_evaluateTransparency(){var n,o;const t=this.baseOpacity,e=this.overlayManager.renderer.isEmpty,r=this._renderer.transparency,i=this._allSurfaceLayersTransparent()?e?ha.Empty:ha.TransparentWithDraped:t>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?ha.Opaque:ha.Semitransparent,s=r!==i;return s&&(this._renderer.transparency=i,(o=(n=this.view)==null?void 0:n._stage)==null||o.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){var r,i,s;const t=this.tilingSchemeLogic.tilingScheme;if(t===this.tilingScheme)return;up(!!t,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((i=(r=this.view)==null?void 0:r.state)!=null&&i.isLocal),this.tilingScheme&&this._removeAllTiles();const e=(t==null?void 0:t.spatialReference)??at.WebMercator;this._spatialReference=e,this._isWebMercator=!!(e!=null&&e.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&d7((s=this.view)==null?void 0:s.renderSpatialReference),this._set("tilingScheme",t),this._updateClippingExtent(),t&&(this._updateTiledLayers(),this._renderer.setTileSize(t.pixelSize),this.overlayManager.setSpatialReference(t.spatialReference),this._updateRootTiles())}_acquireTile(t,e,r,i){const s=this._tileCache.pop(YM._tileMemcacheKey);return s?(s.init(t,e,r,i,this),s):new this._tileConstructor(t,e,r,i,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:t,tilingScheme:e}=this;if(!e)return;const r=pot;let i=e.rootTilesInExtent(t,r,5*Fw);if(this._rootTiles!=null){if(i.length>Fw)return void ne.getLogger(this).warn(i5e);const s=this._rootTiles.map(o=>o.lij),n=Bxe(s,i,Cre);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this._rootTiles.filter(a=>!(n.removed.findIndex(l=>Cre(l,a.lij))>-1)||(this._purgeTile(a),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,i.length>Fw&&(ne.getLogger(this).warn(s5e),i=e.rootTilesInExtent(t,r,Fw)),this._setRootTiles(i.map(s=>this._newRootTile(s)));E1(r,this._rootTilesExtent)||(this._rootTilesExtent=Gt(r)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const t=this._allTiles.filter(e=>e.isLoaded&&e.intersectsClippingArea);t.forEach(e=>this._renderer.updateTileGeometryState(e)),t.forEach(e=>e.renderData.updateNeighborData()),this._updateTilesGeometries(t),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(t){if(t.length===0)return;t.sort(dm);const e=this.renderer;t.forEach(r=>e.updateGeometryIfNeeded(r)),t.forEach(r=>this._pendingTilesForElevationUpdateEvent.add(r))}_shouldSplit(t){return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===pt.SPLIT}_newRootTile(t){const e=this._acquireTile(0,t[1],t[2],null);return this._shouldSplit(e)&&e.setPendingUpdate(pt.SPLIT),this._loadTile(e),this._markTileToUpdate(e),this._updateRootTileElevationBounds(),e}_setRootTiles(t){if(this._rootTiles=t,this._allTiles.clear(),t!=null){const e=this._iteratorPool.acquire();for(e.reset(t);!e.done;)this._allTiles.push(e.next());e.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(t)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(t){t.updateClippingStatus(this.extent)&&t.resetPendingUpdate(pt.GEOMETRY)&&this._updateTileGeometryState(t)}_updateTilesVisibility(t){if(t==null)return;const e=Iit(t),r=this.visibleElevationBounds;let i=e?r.min:1/0,s=e?r.max:-1/0;const n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(t);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(pt.GEOMETRY)&&this._updateTileGeometryState(l),l.setPendingUpdate(pt.RENDERDATA),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(i=Math.min(l.elevationBounds[0],i),s=Math.max(l.elevationBounds[1],s))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(i)&&isFinite(s)&&(r.min!==i||r.max!==s)&&(this.visibleElevationBounds=new Yw(i,s))}_updateRootTileElevationBounds(){let t=1/0,e=-1/0;const r=this._rootTiles;r!=null&&r.forEach(({elevationBounds:s})=>{t=Math.min(t,s[0]),e=Math.max(e,s[1])});const i=this.rootTileElevationBounds;i.min===t&&i.max===e||(this.rootTileElevationBounds=new Yw(t,e))}_updateViewDependentParameters(){const{camera:t,contentCamera:e}=this.view.state,r=Math.tan(.5*e.fovX),i=Math.tan(.5*e.fovY),s=this.tilingScheme.pixelSize,n=2**-this._lodBias*t.pixelRatio;this._splitLimits.aboveGround=t.aboveGround,this._splitLimits.fovX=r,this._splitLimits.fovY=i,this._splitLimits.relativeWidthLimit=s/t.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/t.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=gI(this._splitLimits.frustum??WC(),e.frustum):this._splitLimits.frustum=null,gI(this._frustum,t.frustum),Pr(this._viewProjectionMatrix,e.projectionMatrix,e.viewMatrix),ie(this._eyePosRenderSR,e.eye),mo(t.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(t){t.rendered&&!t.shouldLoad&&(Bbe(t)?this._loadChildren(t):dot(t)&&this._loadParent(t))}_updateTileGeometryState(t){t.updateVisibility(),this._renderer.updateTileGeometryState(t)&&this._markTileToUpdate(t),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(t){t.forEachLoadedNeighbor(e=>this._pendingTilesToUpdate.add(e))}_updateTileTexture(t,e){const r=t.resetPendingUpdate(pt.TEXTURE_FADING)?pt.TEXTURE_FADING:!!t.resetPendingUpdate(pt.TEXTURE_NOFADING)&&pt.TEXTURE_NOFADING;r&&(this._renderer.updateTileTexture(t,r),this._usedMemory=null,e.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const t=y6.extent;Mu(t),this._pendingTilesForElevationUpdateEvent.forEach(e=>M0(t,e.extent,t)),this._pendingTilesForElevationUpdateEvent.clear(),y6.spatialReference=this.spatialReference,this.emit("elevation-change",y6),this._shouldEmitChangeEvent=!1}runTask(t){this._handleLayerViewChanges(t),this._frameTask.processQueue(t),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,t),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(t),this._sortTiles(t);const e=!this.view.state.fixedContentCamera;this._mergeAndSplit(t,e),this._updateElevation(t),this._updateTextures(t),e||this._mergeAndSplit(t,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),t.done&&t.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(t){if(!this._viewChanged||!this._rootTiles||t.done)return;this._viewChanged=!1;const e=this._iteratorPool.acquire();e.reset(this._rootTiles);const r=this.snapLevel,i=this._splitLimits,s=this._eyePosRenderSR;for(;!e.done;){const n=e.next(),o=n.shouldSplit(i,s,r);if(o!==pt.SPLIT){if(n.resetPendingUpdate(pt.SPLIT)&&n.updateAgentSuspension(),o===pt.ELEVATION&&n.updateAgents(Vt.ELEVATION),e.skipSubtree(),!n.isLeaf){n.setPendingUpdate(pt.MERGE),n.resetPendingUpdate(pt.SPLIT);const a=this._iteratorPool.acquire();a.resetOne(n);const l=this._viewProjectionMatrix;for(let c=a.next();!a.done;c=a.next())this._updateClippingStatus(c),c.updateVisibility(),c.updateScreenDepth(l);a.remove()}}else n.resetPendingUpdate(pt.MERGE),n.isLeaf&&(n.setPendingUpdate(pt.SPLIT),e.skipSubtree()),n.rendered&&n.setPendingUpdate(pt.RENDERDATA)}e.remove(),this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),t.madeProgress()}_sortTiles(t){t.done||this._allTilesSorted||(Mit(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),t.madeProgress())}_markTileToUpdate(t){be(t.isLoaded),t.intersectsClippingArea&&(this._pendingTilesToUpdate.add(t),this._markAllTileNeighborsForGeometryUpdate(t))}_updatePendingTileGeometries(){const t=this._pendingTilesToUpdate,e=Array.from(t.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea);if(e.length===0)return void t.clear();const r=(s,n)=>{!(n!=null&&n.isLoaded)||!n.intersectsClippingArea||n.level<s.level||t.has(n)||(t.add(n),e.push(n),n.renderData.updateNeighborData())};e.sort(dm);const i=e.length;for(let s=0;s<i;++s){const n=e[s];be(n.isLoaded),be(n.intersectsClippingArea);const o=n.renderData;o.updateNeighborData();const a=o._dirtyEdgeResolutions,l=o.geometryState.neighborData.cornerPeerNeighbors,c=u=>{var p;const d=cL[u];r(n,(p=l[u])==null?void 0:p.findCorner(lL(d),g=>g.isLoaded))};for(let u=0;u<4;++u)if(a&1<<u){const d=o.geometryState.neighborData.edgePeerNeighbors[u];d&&(d==null?void 0:d.level)>=n.level&&d.forAllSubtreeOnSide(MH(em[u]),p=>!(!p.isLoaded||!p.intersectsClippingArea)&&(be(t.has(p)||dm(n,p)<0),r(n,p),!0)),c((u+1)%4),c(u)}}t.clear(),this._updateTilesGeometries(e),this._shouldEmitChangeEvent=!0,Ks&&oL&&this.checkAllTilesWaterproofness()}_mergeAndSplit(t,e){if(this.suspended||t.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let r=!1;const i=this.view.state.fixedContentCamera;let s=!1;for(;!t.done;){s=!0;let n=!1;const o=!this._allTiles.some(a=>{var c;if(!r&&!i&&!a.visible)return t.done;let l=a;if(a.resetPendingUpdate(pt.MERGE)){if(!e)return a.setPendingUpdate(pt.MERGE),t.done;for(;(c=l.parent)!=null&&c.resetPendingUpdate(pt.MERGE);)l=l.parent;this._mergeTile(l),n=!0,t.madeProgress()}else a.resetPendingUpdate(pt.SPLIT)&&(this._splitTile(a),n=!0,t.madeProgress());return!t.done&&l===a&&a.resetPendingUpdate(pt.RENDERDATA)&&(this._updateRenderData(a),t.madeProgress()),t.done});if(n&&(this._allTilesSorted=!1,this._allTilesDirty=!0),o){if(!r){r=!0;continue}if(!n)break}else this._allTilesDirty=!0}s?t.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(t)}_updateElevation(t){t.done||(this._allTiles.some(e=>(e.resetPendingUpdate(pt.GEOMETRY)&&(this._updateTileGeometryState(e),this._updateTileTexture(e,t),this._shortBatches&&this._updatePendingTileGeometries(),t.madeProgress()),t.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(t){t.done||this._allTiles.some(e=>(this._updateTileTexture(e,t),t.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(cs.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const t=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-t)*t5e}_getLodBiasCorrectedScale(t){const e=this.tilingScheme.levels,r=me(t-this._lodBias,0,e.length-1),i=r-Math.floor(r);return e[Math.floor(r)].scale*(1-i)+e[Math.ceil(r)].scale*i}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(t=>this._purgeTile(t)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeDescendantTiles(t){if(!t.children[0])return!1;let e=!1;for(let r=0;r<4;++r)e=this._purgeTile(t.children[r])||e;return t.unsetChildren(),e}_purgeTile(t){const e=this._purgeDescendantTiles(t)||t.rendered;return this._allTiles.removeUnordered(t),this._unloadTile(t),this._tileCache.put(YM._tileMemcacheKey,t),e}_unloadTile(t){this._pendingTilesToUpdate.delete(t),this._pendingTilesForElevationUpdateEvent.delete(t),t.unload(this._renderer)}_splitTile(t){up(t.isLeaf,"tile that is already split should not be split again!");const e=t.level+1,r=2*t.lij[1],i=2*t.lij[2];t.setChildren(this._createTile(e,r,i,t),this._createTile(e,r,i+1,t),this._createTile(e,r+1,i,t),this._createTile(e,r+1,i+1,t)),t.setPendingUpdate(pt.RENDERDATA),t.updateAgentSuspension(),this._allTiles.pushArray(t.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(t,e=t.level){tP.spatialReference=this.spatialReference,tP.extent=t.extent,tP.scale=this._getLodBiasCorrectedScale(e),this.emit("scale-change",tP)}_createTile(t,e,r,i){up(!!i,"_createTile sanity check");const s=this._acquireTile(t,e,r,i);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(pt.SPLIT),s}get _shortBatches(){return this.view.state.mode!==xr.IDLE}_mergeTile(t){up(!t.hasPendingUpdate(pt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(t)&&(up(!t.renderData,"_mergeTile sanity check"),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t),this._shortBatches&&this._updatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(t){up(t.rendered,"parent should be rendered"),this._unloadTile(t);const e=t.children;e.forEach(r=>this._loadTile(r)),e.forEach(r=>this._pendingTilesToUpdate.add(r)),this._markAllTileNeighborsForGeometryUpdate(t),this._emitTileScaleChange(t,t.level+1),this._shortBatches&&this._updatePendingTileGeometries()}_loadParent(t){const e=t.parent;this._unloadChildren(e),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e,e.level),this._shortBatches&&this._updatePendingTileGeometries()}_unloadChildren(t){const e=t.children;if(e[0])for(let r=0;r<4;++r){const i=e[r];this._unloadChildren(i),this._unloadTile(i)}}_loadTile(t){t.load(),t.setPendingUpdate(pt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(t)}_elevationDataArrived(t,e,r){const i=new pit(t.lij,t.extent,r);t.dataArrived(e,Vt.ELEVATION,i);const s=[t],n=t.level,o=this._iteratorPool.acquire();for(o.reset(s);!o.done;){const a=o.next();a.findElevationBoundsForLayer(e,n),a.computeElevationBounds()}n===0&&this._updateRootTileElevationBounds(),o.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(t=fa){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let e=!1;const r=new Set;let i=-1;for(const s of this.view.allLayerViews.items)if(r.add(s.uid),d3(s)||VT(s))if(this._basemapLayerViewHandles.has(s.uid)&&!VT(s)){const n=this._layerClassFromLayerView(s),o=this._getLayerIdxByUID(n,s.uid);o!=null&&((o<i||i==null)&&(e=!0),i=o)}else this._registerTiledLayerView(s),s.layer.loaded&&(e=!0);this._basemapLayerViewHandles.forEach((s,n)=>{r.has(n)||(this._unregisterTiledLayerView(n),e=!0)}),e&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),t.madeProgress()}_allSurfaceLayersTransparent(){var e,r;let t=((r=(e=this.view.map)==null?void 0:e.ground)==null?void 0:r.opacity)===0;for(const i of this.view.allLayerViews.items)if(nz(i)&&!SP(i.layer)&&i.fullOpacity!==0)return t=!1,t;return t}_hasCompositeBlendMode(){for(const t of this.view.allLayerViews.items)if((h3(t)||VT(t))&&kit(lz[t.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(t){return sz(t)?Vt.ELEVATION:Vt.MAP}_registerTiledLayerView(t){const e=[];if((h3(t)||VT(t))&&e.push(ae(()=>t.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Ws.UNFADED)})),!VT(t)){const r=this._layerClassFromLayerView(t);e.push(ae(()=>t.suspended,()=>this._updateTiledLayers())),e.push(ae(()=>t.fullOpacity,()=>this._updateTileTextures(Ws.UNFADED))),e.push(ae(()=>"effectiveScaleRange"in t.layer?t.layer.effectiveScaleRange:null,()=>this._restartAllAgents(r))),e.push(t.on("data-changed",()=>{const i=this._getLayerIdxByUID(r,t.uid);i!=null&&this._invalidateLayerData(i,r)}))}this._unregisterTiledLayerView(t.uid),this._basemapLayerViewHandles.set(t.uid,e)}_unregisterTiledLayerView(t){const e=this._basemapLayerViewHandles.get(t);if(e){for(const r of e)r.remove();this._basemapLayerViewHandles.delete(t)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const t=this.view.allLayerViews,e=[[],[]];let r=null;t.forEach(i=>{if(!i.layer||i.suspended||!d3(i)||!i.fullExtent)return;const s=this._layerClassFromLayerView(i);if(s===Vt.MAP){const n=i.displayLevelRange.maxLevel;n!==1/0&&(r===null||n>r)&&(r=n)}e[s].push(i)});for(const i of q_){const s=this._layerViews[i],n=e[i];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[i].clear();for(let u=0;u<o;u++){const d=n[u].uid;this._layerIndexByUid[i].set(d,u);const p=s.indexOf(n[u]);l[u]=p,u!==p&&(a=!0),p>-1&&(c[p]=u)}if(a){const u=this._postorderIterator;for(u.reset(this._rootTiles);!u.done;)u.next().modifyLayers(c,l,i);this._layerViews[i]=n,this._restartAllAgents(i),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(r)&&this._viewChangeUpdate()}_restartAllAgents(t){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;){const r=e.next();r.restartAgents(t),t===Vt.ELEVATION&&r.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(t,e){return this._layerViews[e][t]}numLayers(t){return this._layerViews[t].length}_updateTileTextures(t){this._allTiles.forAll(e=>{e.updateAgents(Vt.MAP),t===Ws.IMMEDIATE?this.renderer.updateTileTexture(e,pt.TEXTURE_NOFADING):e.updateRenderData(Vt.MAP,t)}),this._evaluateTransparency()}_invalidateLayerData(t,e){this._allTiles.forAll(r=>r.removeLayerAgent(t,e)),this._allTiles.forAll(r=>r.invalidateLayerData(t,e))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(t=cs.UPDATE){this.renderer.setNeedsRender(t)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(t,e,r,i){const s=this.layerViewByIndex(e,r),n=s.layer;return!n.tilemapCache||p2(s)?this._requestTileData(t,r,s,i):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(t.lij[0],t.lij[1],t.lij[2],{...i,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,wt(i),Os(o)||this._dataMissing(t,r,s,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(t,r,s,i),i.signal)))}_requestTileData(t,e,r,i){return e===Vt.ELEVATION?sz(r)?this._requestElevationTileData(t,r,i):Promise.reject():nz(r)?this._requestMapTileData(t,r,i):Promise.reject()}_requestElevationTileData(t,e,r){++this._asyncWorkItems;const i=o=>{if(Ys(r))return;const a=this._layerIndexByUid[Vt.ELEVATION].get(e.uid);a!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(t,a,o)):ne.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",Vt.ELEVATION,t.lij.toString())},s=o=>{Os(o)||(this._dataMissing(t,Vt.ELEVATION,e,o),this.requestUpdate())};if(Uee(e.layer))return e.layer.fetchTile(t.lij[0],t.lij[1],t.lij[2],{noDataValue:zC,signal:r.signal}).then(o=>{if(!Ys(r))return this._frameTask.schedule(()=>i(o),r.signal,s);ne.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const n=e.getTileUrl(t.lij[0],t.lij[1],t.lij[2]);return this._elevationDataRequester.request(n,"binary",r).then(o=>this._lercDecoder.decode(o,{noDataValue:zC},r.signal)).then(o=>{o?i(new Krt(o)):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(t,e,r){++this._asyncWorkItems;const i=(c,u)=>{--this._asyncWorkItems,_x(u),Ys(r)||(this._dataMissing(t,Vt.MAP,e,c),this.requestUpdate())},s=c=>u=>i(u,c),n=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),Ys(r)?_x(c):this._mapTileDataArrived(t,e,c)},r.signal,s(c)).catch(s(c)),o=(c,u=null)=>this._frameTask.schedule(()=>i(c,u));if(p2(e)){const c=e.schemaHelper.getLevelRowColumn(t.lij);return e.fetchTile(c[0],c[1],c[2],r).then(n,o)}if(zN(e))return e.fetchTile(t.lij[0],t.lij[1],t.lij[2],r).then(n,o);if(OH(e)&&Uee(e.layer))return e.layer.fetchTile(t.lij[0],t.lij[1],t.lij[2],r).then(c=>{if(Ys(r))return ne.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(ur());n(c)},o);let a=e.getTileUrl(t.lij[0],t.lij[1],t.lij[2]);Jrt(e.layer)&&e.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${e.layer.refreshTimestamp}`);const l=e.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,r).then(n,o)}_mapTileDataArrived(t,e,r){const i=this._getLayerIdxByUID(Vt.MAP,e.uid);i!=null?t.dataArrived(i,Vt.MAP,r):(_x(r),ne.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(t,e){return this._layerIndexByUid[t].get(e)}_dataMissing(t,e,r,i){const s=this._getLayerIdxByUID(e,r.uid);s!=null?t.dataMissing(s,e,i):ne.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(t){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(e=>{e.renderData&&this.overlayManager.setTileParameters(e)}),this._renderer.setNeedsRender(t))}get performanceInfo(){const t=this._performanceInfo;return t.numNodes=this._allTiles.length,t.numLeaves=t.numVisible=t.numRendered=t.numLoadedPerLevel.length=t.numRenderedPerLevel.length=0,this._allTiles.forAll(e=>{e.isLeaf&&t.numLeaves++;const r=e.level;e.renderData&&(t.numLoadedPerLevel[r]=(t.numLoadedPerLevel[r]||0)+1),e.visible&&(t.numVisible++,e.rendered&&(t.numRenderedPerLevel[r]=(t.numRenderedPerLevel[r]||0)+1,t.numRendered++))}),t}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((t,e)=>t+e.usedMemory,0)):null}getUsedMemoryForLayerView(t){let e=0;const r=this._layerClassFromLayerView(t),i=this._getLayerIdxByUID(r,t.uid);return i!=null&&this._allTiles.forAll(s=>e+=s.getUsedMemoryForLayer(r,i)),e}getTile(t){if(t==null||this._rootTiles==null)return null;const e=t.split("/").map(o=>+o);if(e[0]===0)return this._rootTiles.find(o=>o.lij[1]===e[1]&&o.lij[2]===e[2]);const r=2**e[0],i=Math.floor(e[1]/r),s=Math.floor(e[2]/r);let n;if(this._rootTiles.some(o=>o.lij[1]===i&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<e[0]-1;for(;n.lij[0]<e[0];){let a=e[1]&o?2:0;if((e[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return up(n.lij[0]===e[0]&&n.lij[1]===e[1]&&n.lij[2]===e[2],"not the right tile?"),n}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(t){this._renderer.renderPatchBorders=t}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(t){this._renderer.visualizeNormals=t}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(t){this._renderer.renderingDisabled=t}get test(){const t=this;return{renderer:t._renderer,lercDecoder:t._lercDecoder,forceReload:()=>{t._rootTiles!=null&&t._rootTiles.length>0&&(t._mergeTile(t._rootTiles[0]),t._viewChangeUpdate())},getTiles:()=>t._allTiles.toArray(),getRenderedTiles(){g6.clear(),t._allTiles.forAll(r=>{r.visible&&r.rendered&&g6.push(r)});const e=g6.toArray();return Xve(t.renderOrder,e),e},lockTilingScheme(e,r){t._extentHelper.defaultTiledLayersExtent=r,t.tilingSchemeLogic.test.lockTilingScheme(e)}}}checkAllTilesWaterproofness(){if(!oL)return;const t=this._rootTiles;if(t==null)return;const e=n=>{var o,a,l;return((l=(a=(o=n==null?void 0:n.renderData)==null?void 0:o.geometry)==null?void 0:a.indices)==null?void 0:l.length)>0},r=(n,o)=>{e(n)&&console.error("Tile[",n.lij,"] has geometry although parent[",o.lij,"] has geom")},i=n=>{var o,a;if(n.intersectsClippingArea)if(n.renderData&&!n.renderData.geometryState&&console.error("Tile[",n.lij,"] has renderData but not geometryState"),n.renderData&&!n.renderData.geometry&&console.error("Tile[",n.lij,"] has renderData but not geometryInfo"),!((o=n.renderData)!=null&&o.geometry)||(((a=n.renderData.geometry.indices)==null?void 0:a.length)??0)>0||console.error("Tile[",n.lij,"] has renderData but no indices - geometryInfo: ",n.renderData.geometry),e(n)){n.checkGeometryWaterproofness();for(const l of n.children)r(l,n)}else if(n.isLeaf)console.error("Tile[",n.lij,"] has no geometry and no children, from root to leaf");else for(const l of n.children)i(l)},s=n=>{var c;const o=((c=n.parent)==null?void 0:c.visible)??!0,a=n.visible;n.computeVisibility();const l=n.visible;if(a!==l&&o&&console.error(" Tile[",n.lij,"] has out of date visibility: ",a," instead of ",l),!n.isLeaf)for(const u of n.children)s(u)};for(const n of t)i(n),s(n)}get isGlobal(){return this._isGlobal}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(t){return this.isGlobal&&t[2]===this.lijEastEnd(t[0])-1}isWestEndWrap(t){return this.isGlobal&&t[2]===0}lijEastEnd(t){return 2**(t+(this.spatialReference!=null&&this.spatialReference.isGeographic?1:0))}wrapEastWest(t){const e=this.lijEastEnd(t[0]),r=t[2];if(0<=r&&r<e)return t;if(!this.isGlobal)return null;const i=(r+(r<0?e:0))%e;return[t[0],t[1],i]}enableInternalChecks(t){mrt(t)}enableWaterproofnessChecks(t){frt(t)}};kt._tileMemcacheKey="TerrainTileMemcache",h([f()],kt.prototype,"_renderer",void 0),h([f({constructOnly:!0})],kt.prototype,"_scaleRangeQueries",void 0),h([f({constructOnly:!0})],kt.prototype,"view",void 0),h([f({constructOnly:!0})],kt.prototype,"overlayManager",void 0),h([f()],kt.prototype,"_hasPendingUpdates",void 0),h([f()],kt.prototype,"_asyncWorkItems",void 0),h([f()],kt.prototype,"_allTilesDirty",void 0),h([f()],kt.prototype,"_allTilesSorted",void 0),h([f()],kt.prototype,"_viewChanged",void 0),h([f()],kt.prototype,"_splitLimits",void 0),h([f({readOnly:!0})],kt.prototype,"_watchUpdatingTracking",void 0),h([f()],kt.prototype,"_frameTask",void 0),h([f({readOnly:!0})],kt.prototype,"snapLevel",null),h([f({readOnly:!0})],kt.prototype,"lodSnapping",null),h([f()],kt.prototype,"_userClippingExtent",null),h([f()],kt.prototype,"_rootTilesExtent",void 0),h([f({readOnly:!0})],kt.prototype,"extent",null),h([f({readOnly:!0})],kt.prototype,"groundExtent",null),h([f({readOnly:!0})],kt.prototype,"_tilingSchemeExtent",null),h([f({readOnly:!0})],kt.prototype,"updating",null),h([f({readOnly:!0})],kt.prototype,"running",null),h([f(hit)],kt.prototype,"updatingProgress",void 0),h([f({readOnly:!0})],kt.prototype,"updatingProgressValue",null),h([f()],kt.prototype,"_maxNumUpdating",void 0),h([f()],kt.prototype,"baseOpacity",null),h([f()],kt.prototype,"hasCompositeBlendMode",void 0),h([f({readOnly:!0})],kt.prototype,"viewingMode",null),h([f()],kt.prototype,"maxTextureScale",void 0),h([f({readOnly:!0})],kt.prototype,"ready",null),h([f({value:f2.FRONT_TO_BACK})],kt.prototype,"renderOrder",null),h([f({readOnly:!0})],kt.prototype,"rootTiles",null),h([f()],kt.prototype,"_rootTiles",void 0),h([f({readOnly:!0})],kt.prototype,"spatialReference",null),h([f({type:qe})],kt.prototype,"backgroundColor",null),h([f({value:!1})],kt.prototype,"slicePlaneEnabled",null),h([f({readOnly:!0})],kt.prototype,"tilingScheme",void 0),h([f({readOnly:!0})],kt.prototype,"tilingSchemeLocked",null),h([f({readOnly:!0})],kt.prototype,"tilingSchemeLogic",void 0),h([f()],kt.prototype,"wireframe",null),h([f({value:!1})],kt.prototype,"suspended",null),h([f()],kt.prototype,"textureFadeDuration",null),h([f()],kt.prototype,"visibleElevationBounds",void 0),h([f()],kt.prototype,"rootTileElevationBounds",void 0),h([f()],kt.prototype,"_layerViewsDirty",void 0),h([f()],kt.prototype,"renderPatchBorders",null),h([f()],kt.prototype,"visualizeNormals",null),h([f()],kt.prototype,"renderingDisabled",null),kt=YM=h([k("esri.views.3d.terrain.TerrainSurface")],kt);const hot=kt;function Cre(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Bbe(t){const e=t.children;if(!e[0])return!1;for(const r of e)if(r.shouldLoad)return!0;for(const r of e)if(Bbe(r))return!0;return!1}function dot(t){var e;return t.isLeaf&&(((e=t.parent)==null?void 0:e.shouldLoad)??!1)}const Oa=Jt(),pot=Gt(),g6=new It,y6={spatialReference:null,extent:Gt(),context:"ground"},tP={spatialReference:null,extent:null,scale:0};function Are(t,e,r){var i;for(const s of t){if(!s.containsPointXY(e,r))continue;let n=s;for(;n&&!n.renderData;){const a=(e>n.extentMidX?1:0)+(r<n.extentMidY?2:0);n=n.children[a]}const o=((i=n==null?void 0:n.renderData)==null?void 0:i.geometryState.samplerData)??null;return Bi(e,r,o)}return null}let fot=class{constructor(e,r,i,s){this.operation=e,this.geometry=r,this.states=i,this.sync=s}},cE=class extends xe{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,r){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c},u)=>{let d=!1;if(l===Pi.UPDATE){const p=o.get(u);if(p){if(c&qs.TRANSFORMATION){const g=this.model.getObject(n);this.model.updateRenderGeometryTransformation(g,a,p)&&(d=!0)}d||r.updates.push({renderGeometry:p,updateType:c})}else Je(!1,"ModelDirtySet.commitLayer: invalid update")}if(l===Pi.REMOVE||d){const p=o.get(u);p?(r.removes.push(p),o.delete(u)):l===Pi.REMOVE&&Je(!1,"ModelDirtySet.commitLayer: invalid remove")}if(l===Pi.ADD||d){const p=this.model.getObject(n);if(p!=null){const g=this.model.getRenderGeometry(p,a);r.adds.push(g),o.set(u,g)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(e,r){const i=this._dirtyGeomRecords.get(e);i&&i.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c,sync:u},d)=>{let p=!1;if(l===Pi.UPDATE&&u){const g=o.get(d);if(g){if(c&qs.TRANSFORMATION){const y=this.model.getObject(n);this.model.updateRenderGeometryTransformation(y,a,g)&&(p=!0)}p||r.updates.push({renderGeometry:g,updateType:c})}else Je(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,r){const i=this._residentGeomRecords.get(e);i&&i.forEach(s=>s.forEach(n=>r.push(n)))}_objectStateChanged(e,r){for(const i of r.geometries)this._updateOrCreateDirtyRecord(r,i,null,Pi.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(qs.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(qs.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(qs.OCCLUDEE,e)}attributesChanged({object:e,geometry:r,sync:i}){this._updateOrCreateDirtyRecord(e,r,null,Pi.UPDATE,qs.GEOMETRY,i)}layerAdded(e){e.objects.forAll(r=>this._layerObjectAdded(e,r))}layerRemoved(e){e.objects.forAll(r=>this._layerObjectRemoved(e,r))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,r){const i=e.id;for(const s of r.geometries)this._geometryAdded(r,s,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const r of e.objects)this._layerObjectAdded(e.layer,r)}layerObjectsRemoved(e){for(const r of e.objects)this._layerObjectRemoved(e.layer,r)}_layerObjectRemoved(e,r){const i=e.id;for(const s of r.geometries)this._geometryRemoved(r,s,i)}transformationChanged(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,r,Pi.UPDATE,qs.TRANSFORMATION)})}shaderTransformationChanged(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(s=>{s.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,Pi.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,Pi.REMOVE)}_updateOrCreateDirtyRecord(e,r,i,s,n=qs.NONE,o=!1){i=i??this._getParentLayerId(e);const a=e.id,l=r.id,c=this._ensureDirtyRecord(i,a),u=c.get(l);if(u){const d=u.operation;d===Pi.REMOVE&&s===Pi.ADD&&u.states!==qs.NONE?u.operation=Pi.UPDATE:d===Pi.REMOVE&&s===Pi.ADD||d===Pi.ADD&&s===Pi.REMOVE?c.delete(l):d!==Pi.UPDATE||s!==Pi.REMOVE&&s!==Pi.UPDATE?(Je((d===Pi.REMOVE||d===Pi.ADD)&&s===Pi.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),u.states|=n):(u.operation=s,u.states|=n),u.sync=u.sync||o}else c.set(l,new fot(s,r,n,o));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,r){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}get _hasDirtyGeometryRecords(){return hc(this._dirtyGeomRecords,e=>hc(e,r=>r&&r.size>0))}_ensureDirtyRecord(e,r){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:X2e}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let r="";return this._dirtyGeomRecords.forEach((i,s)=>{i.forEach((n,o)=>{r.length>0&&(r+=`
`),r+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){r+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)r+=a[l][c]+", "}})}),r}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((r,i)=>r+i.size,0)},commit:r=>e._dirtyGeomRecords.forEach((i,s)=>e.commitLayer(s,r))}}};h([f({constructOnly:!0})],cE.prototype,"model",void 0),h([f()],cE.prototype,"dirty",void 0),cE=h([k("esri.views.3d.webgl-engine.lib.ModelDirtySet")],cE);const mot=cE;let XM=class extends xe{constructor(){super(...arguments),this.dirtySet=new mot({model:this}),this._content=new Map,this._originFactory=new Kj(null)}getObject(e){return this._content.get(e)}add(e){const r=e.id;Je(!this._content.has(r),"Model/Stage already contains object to be added"),this._content.set(r,e),WI(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),WI(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const r of e)r&&(Je(!this._content.has(r.id),"Model/Stage already contains object to be added"),this._content.set(r.id,r))}removeMany(e){for(const r of e)r&&(Je(this._content.has(r.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(r.id))}has(e){return this._content.has(e.id)}forEachOfType(e,r){this._content.forEach(i=>{i.type===e&&r(i)})}getRenderGeometry(e,r){const i=new h2(r,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});i.transformation=e.getCombinedStaticTransformation(r,Rre);const{localOrigin:s}=r;return i.localOrigin=s??this._originFactory.getOrigin(i.boundingSphere),i}updateRenderGeometryTransformation(e,r,i){if(e==null)return!1;i.transformation=e.getCombinedStaticTransformation(r,Rre);const s=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==s}getStats(){const e={},r=Array.from(this._content.values());for(let i=0;i<Ki.COUNT;++i)e[i]=r.filter(s=>s.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};h([f({constructOnly:!0})],XM.prototype,"dirtySet",void 0),XM=h([k("esri.views.3d.webgl-engine.parts.Model")],XM);const Rre=ge();let got=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let r=0;for(let i=0;i<e.length;i+=2)r+=e[i+1];return r}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=yot(e)}forEachComponent(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i],n=s+r[i+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i];if(!e(s,s+r[i+1]))return!1}return!0}computeOffsetRanges(e){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let s=0;s<i.length;s+=2){const n=i[s],o=n+i[s+1],a=e[n],l=e[o];r[s]=a,r[s+1]=l-a}return r}};function yot(t){const e=new Array;if(t.length===0)return e;let r=t[0],i=1;for(let s=1;s<t.length;s++){const n=t[s];r+i===n?i+=1:(e.push(r),e.push(i),r=n,i=1)}return e.push(r),e.push(i),e}let _ot=class{constructor(e,r){this.offsets=r,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const i=this.count;this.visibility=new got(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let s=0;s<i;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:r}=vot(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=r}}};function vot(t,e,r){const i=[],s=[];let n=r.length,o=r.length;return e.forEachComponent(a=>(t[a]>0?(n!==a-1&&(i.length&&i.push(r[n+1]-i[i.length-1]),i.push(r[a])),n=a):(o!==a-1&&(s.length&&s.push(r[o+1]-s[s.length-1]),s.push(r[a])),o=a),!0)),i.length&&i.push(r[n+1]-i[i.length-1]),s.length&&s.push(r[o+1]-s[s.length-1]),{highlightRanges:i,defaultRanges:s}}let uE=class extends xe{constructor(){super(...arguments),this.visible=vx.Hidden}destroy(){this.intersectionGeometry=Oe(this.intersectionGeometry)}};var vx;h([f({autoDestroy:!0})],uE.prototype,"renderable",void 0),h([f({autoDestroy:!0})],uE.prototype,"components",void 0),uE=h([k("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],uE),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(vx||(vx={}));function bot(t,e,r,i){if(r>=e)return t;t==null&&(t=wot());const s=t.isVisibleBit;let n=t.data;const o=Vbe(n),a=r/o|0,l=r-o*a,c=(e-1)/o|0,u=n,d=i===s;if(!(r<u.length*o)&&d){const p=a+1,g=Math.ceil(u.length*OL),y=c+1;let _=Math.max(p,g);_=Math.min(_,y),n=new Uint32Array(_),n.set(u)}return a<n.length&&(n[a]=Tot(n[a],l,d)),t.data=n,t}function zbe(t,e){if(t==null)return!0;const{isVisibleBit:r,data:i}=t,s=Vbe(i);return e<i.length*s?xot(r,i,e,s):!t.isVisibleBit}function wot(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function xot(t,e,r,i){const s=r/i|0,n=r-s*i;return Sot(e[s],n)===t}function Vbe(t){return t.BYTES_PER_ELEMENT*8}function Tot(t,e,r){return t&~(1<<e)|(r?1:0)<<e}function Sot(t,e){return(t&1<<e)!=0}let Eot=class{constructor(e,r){this._components=r,this._indices=e.indices?Pp(e.indices):$v(e.positions.length/3),this._positions=e.positions,this._componentIntersectionData=new Array(r.count)}destroy(){this._positions=null,this._indices=null,this._componentIntersectionData.length=0,this._perComponentAabbs=null}getComponentAabb(e,r){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let i=0;i<6;i++)r[i]=this._perComponentAabbs[6*e+i];return r}getComponentPositions(e,r){r.indices=this._indices,r.data=this._positions,r.stride=3,r.startIndex=this._components.offsets[e],r.endIndex=this._components.offsets[e+1]}intersect(e,r,i,s,n,o,a){const l=new j3(this._positions,3),c=this._indices,u=this._components.offsets,d=Nge(e,r,Cot),p=e[2],g=r[2];this._components.visibility.forEachComponent(y=>{if(!zbe(this._components.pickability,y))return!0;const _=this.getComponentAabb(y,Aot);if(o!=null){const T=o[y];n!=null?n.componentOffset=T:(e[2]=p-T,r[2]=g-T)}if(n!=null&&n.applyToAabb(_),!mj(_,e,d,i))return!0;const v=u[y]/3,w=u[y+1]/3,x=(T,S,C)=>a(y,T,Sl(S,S,s),C);return n==null&&w-v>Ube?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new jH(this._indices,v,w,l)),this._componentIntersectionData[y].intersectRay({r0:e,r1:r},x)):tA(e,r,v,w,c,l,void 0,n,x),!0})}_computePerComponentAabbs(){const e=this._components.count,r=Gi(6*e),i=this._indices,s=this._positions,n=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=n[a],c=n[a+1];let u=1/0,d=1/0,p=1/0,g=-1/0,y=-1/0,_=-1/0;for(let v=l;v<c;v++){const w=3*i[v],x=s[w],T=s[w+1],S=s[w+2];u=Math.min(u,x),d=Math.min(d,T),p=Math.min(p,S),g=Math.max(g,x),y=Math.max(y,T),_=Math.max(_,S)}r[o++]=u,r[o++]=d,r[o++]=p,r[o++]=g,r[o++]=y,r[o++]=_}return r}get positions(){return this._positions}get indices(){return this._indices}};const Cot=E(),Aot=tn();let Rot=class{constructor(e,r,i){this.material=e,this.geometry=r,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}},Oot=class{constructor(e,r,i,s){this.vao=e,this.primitiveType=r,this.parameters=i,this.indexed=s}dispose(){this.vao.dispose()}},HH=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function Pot(t,e){return{near:t,far:e}}function mA(t){return t?p3(t,1/0,-1/0):Pot(1/0,-1/0)}function p3(t,e,r){return t.near=e,t.far=r,t}function m2(t,e){e!=null&&(t.near=Math.min(t.near,e.near),t.far=Math.max(t.far,e.far))}function rP(t,e){return t.near<=e&&e<=t.far}const wz={near:0,far:0};function Mot(t,e){const r=mA(),{eye:i,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=de(Rn(Zl,a.center,i),n),c=GD(a,n);if(rP(r,l-c)&&rP(r,l+c))return;const u=Not(a,s);if(u===-1)return;if(u===0)return bf.far=l+c,bf.near=l-c,void m2(r,bf);const d=iP.pushNew();d.near=l-c,d.far=l+c,d.mask=u,d.object=o});for(let o=0;o<iP.length;o++){const a=iP.data[o];if(rP(r,a.near)&&rP(r,a.far))continue;bf.far=a.far,bf.near=1/0,Dot(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,i,$ot,c=>{let u=Iot;for(let d=0;d<Gbe&&c.length>0;d++){if(!(a.mask&1<<d))continue;Lot(s[d],c,u);const p=c;c=u,u=p}for(let d=0;d<c.length;d+=3){se(Fa,c.data[d],c.data[d+1],c.data[d+2]);const p=de(Rn(Fa,Fa,i),n);bf.near=Math.min(bf.near,p)}})===0&&(bf.near=0),m2(r,bf)}return iP.length=0,r}const iP=new It({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),bf=mA(),Fa=E(),c_=E(),$ot=new It({deallocator:null}),Iot=new It({deallocator:null});function Lot(t,e,r){r.length=0;const i=e.length-3;_6(Fa,e,i);const s=Wr(t,Fa);s<=0&&(r.push(Fa[0]),r.push(Fa[1]),r.push(Fa[2]));let n=0,o=s;for(;n<i;n+=3){_6(c_,e,n);const a=Wr(t,c_);o*a<0&&($r(Fa,c_,Fa,a/(a-o)),Ua(r,Fa)),a<=0&&Ua(r,c_),o=a,ie(Fa,c_)}o*s<0&&(_6(c_,e,i),$r(Fa,c_,Fa,s/(s-o)),Ua(r,Fa))}function _6(t,e,r){return se(t,e.data[r],e.data[r+1],e.data[r+2])}function Ua(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function Dot(t,e,r,i){sv(Pre,t.quaternion),Rn(Zl,e,t.center),Cp(Zl,Zl,Pre);const s=8*((Zl[0]<-t.halfSize[0]?-1:Zl[0]>t.halfSize[0]?1:0)+3*(Zl[1]<-t.halfSize[1]?-1:Zl[1]>t.halfSize[1]?1:0)+9*(Zl[2]<-t.halfSize[2]?-1:Zl[2]>t.halfSize[2]?1:0)+13),n=Ore[s];if(n===0)return n;JV(sP,t.quaternion),ZV(sP,sP,t.halfSize);const o=(a,l)=>{const c=Ore[s+l+1];return se(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),Sl(a,a,sP),le(a,t.center,a)};return r.length=0,Ua(r,o(v6,0)),Ua(r,o(Mre,1)),Ua(r,o(Zl,2)),Ua(r,o($re,3)),i(r),n===1||(r.length=0,Ua(r,v6),Ua(r,$re),Ua(r,o(Zl,4)),Ua(r,o(Ire,5)),i(r),n===2||(r.length=0,Ua(r,v6),Ua(r,Ire),Ua(r,o(Zl,6)),Ua(r,Mre),i(r))),n}const Ore=(()=>{const t=new Array(216);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),t})(),Gbe=4;function Not(t,e){let r=0;for(let i=0;i<Gbe;i++){const s=P_(t,e[i]);if(s>0)return-1;s===0&&(r|=1<<i)}return r}const sP=Fi(),Pre=Bu(),Zl=E(),v6=E(),Mre=E(),$re=E(),Ire=E();let Fot=class{constructor(e){this._objects=e}submit(e,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(e,r,i))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?Mot(e,this._objects.visibleObjects):null}};function Uot(t){const e=Ci().vec3f(R.POSITION);return t.normals&&e.vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===xs.Default?e.vec2f(R.UV0):t.textureCoordinates===xs.Atlas&&(e.vec2f(R.UV0),e.vec4u16(R.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(R.COLOR,{glNormalized:!0}),e}let kot=class{constructor(){this.externalColor=Jt(),this.externalColorMixMode=Zs.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},Bot=class extends qi{constructor(e,r){super(e,"int",gr.Draw,(i,s,n)=>i.setUniform1i(e,r(s,n)))}};var Ip;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(Ip||(Ip={}));const qH=429496.7296;function jbe(t,e){o3(t/qH*.5+.5,e)}function zot(t,e){switch(e.componentData){case Ip.Varying:return Vot(t,e);case Ip.Uniform:return Got(t);case Ip.COUNT:return;default:e.componentData}}function Vot(t,e){const{vertex:r,fragment:i}=t;r.include(zu),r.uniforms.add(new xu("componentColorTex",n=>n.componentParameters.texture.texture)),t.attributes.add(R.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===L.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(z0e),r.constants.add("elevationScale","float",2*qH),r.constants.add("stride","float",te("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(b`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),r.code.add(b`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?b`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:b`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(b`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?b`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function Got(t){const{vertex:e,fragment:r}=t;e.uniforms.add(new qI("externalColor",i=>i.componentParameters.externalColor)),r.uniforms.add(new Bot("externalColorMixMode",i=>i.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(b`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(b`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}var mc;function jot(t,e){const r=t.vertex;switch(r.code.add(b`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case mc.None:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) {}`);break;case mc.Opaque:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case mc.Transparent:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case mc.COUNT:break;default:e.vertexDiscardMode}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(mc||(mc={}));var Lp;function VAt(t){return t&&Wp(t)?Lp.Mars:t&&Yp(t)?Lp.Moon:Lp.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(Lp||(Lp={}));var uc;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(uc||(uc={}));let er=class extends Za{constructor(){super(...arguments),this.output=L.Color,this.textureCoordinateType=xs.None,this.componentData=Ip.Uniform,this.cullFace=oi.Back,this.vertexDiscardMode=mc.None,this.doubleSidedMode=ji.WindingOrder,this.alphaDiscardMode=Ur.Opaque,this.integratedMeshMode=uc.None,this.transparencyPassType=Qe.NONE,this.ellipsoidMode=Lp.Earth,this.pbrMode=et.Disabled,this.normalType=Tr.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};h([F({count:L.COUNT})],er.prototype,"output",void 0),h([F({count:xs.COUNT})],er.prototype,"textureCoordinateType",void 0),h([F({count:Ip.COUNT})],er.prototype,"componentData",void 0),h([F({count:oi.COUNT})],er.prototype,"cullFace",void 0),h([F({count:mc.COUNT})],er.prototype,"vertexDiscardMode",void 0),h([F({count:ji.COUNT})],er.prototype,"doubleSidedMode",void 0),h([F({count:Ur.COUNT})],er.prototype,"alphaDiscardMode",void 0),h([F({count:uc.COUNT})],er.prototype,"integratedMeshMode",void 0),h([F({count:Qe.COUNT})],er.prototype,"transparencyPassType",void 0),h([F({count:Lp.COUNT})],er.prototype,"ellipsoidMode",void 0),h([F({count:et.COUNT})],er.prototype,"pbrMode",void 0),h([F({count:Tr.COUNT})],er.prototype,"normalType",void 0),h([F()],er.prototype,"spherical",void 0),h([F()],er.prototype,"doublePrecisionRequiresObfuscation",void 0),h([F()],er.prototype,"hasVertexColors",void 0),h([F()],er.prototype,"hasNormals",void 0),h([F()],er.prototype,"hasSlicePlane",void 0),h([F()],er.prototype,"hasColorTexture",void 0),h([F()],er.prototype,"receiveAmbientOcclusion",void 0),h([F()],er.prototype,"receiveShadows",void 0),h([F()],er.prototype,"blendingEnabled",void 0),h([F()],er.prototype,"hasScreenSpaceReflections",void 0),h([F()],er.prototype,"hasPolygonOffset",void 0),h([F()],er.prototype,"hasMetallicRoughnessTexture",void 0),h([F()],er.prototype,"hasEmissionTexture",void 0),h([F()],er.prototype,"hasOcclusionTexture",void 0),h([F()],er.prototype,"hasNormalTexture",void 0),h([F()],er.prototype,"hasOccludees",void 0),h([F()],er.prototype,"multipassEnabled",void 0),h([F()],er.prototype,"cullAboveGround",void 0),h([F()],er.prototype,"hasCloudsReflections",void 0),h([F()],er.prototype,"snowCover",void 0),h([F()],er.prototype,"objectAndLayerIdColor",void 0),h([F({constValue:!1})],er.prototype,"occlusionPass",void 0),h([F({constValue:gr.Draw})],er.prototype,"pbrTextureBindType",void 0),h([F({constValue:!0})],er.prototype,"hasSliceHighlight",void 0),h([F({constValue:!1})],er.prototype,"hasSliceInVertexProgram",void 0),h([F({constValue:!1})],er.prototype,"useCustomDTRExponentForWater",void 0),h([F({constValue:!1})],er.prototype,"hasVertexTangents",void 0),h([F({constValue:!0})],er.prototype,"supportsTextureAtlas",void 0),h([F({constValue:!1})],er.prototype,"highStepCount",void 0),h([F({constValue:!1})],er.prototype,"instancedDoublePrecision",void 0),h([F({constValue:!1})],er.prototype,"hasModelTransformation",void 0),h([F({constValue:!0})],er.prototype,"useFillLights",void 0),h([F({constValue:!1})],er.prototype,"objectAndLayerIdColorInstanced",void 0);function Lre(t,e){t.include(Dv,e),t.fragment.include(t3);const r=t.fragment;r.uniforms.add(new qI("baseColor",i=>i.baseColor)),r.uniforms.add(new L1("objectOpacity",i=>i.objectOpacity)),e.hasVertexColors?r.code.add(b`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(b`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(b`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Dre(t,e){const r=t.fragment;switch(e.doubleSidedMode){case ji.None:r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case ji.View:t.include(lx,e),r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case ji.WindingOrder:r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case ji.COUNT:}switch(e.normalType){case Tr.Attribute:case Tr.Compressed:t.include(EN,e),r.code.add(b`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Tr.ScreenDerivative:t.include(lx,e),r.code.add(b`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Tr.Ground:e.spherical?(t.include(lx,e),r.code.add(b`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(b`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),r.code.add(b`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case Tr.COUNT:}}function Hot(t,e){const r=t.fragment;if(e.hasColorTexture&&(e.output===L.Color||e.alphaDiscardMode!==Ur.Opaque)){t.include(SG,e);const i=e.textureCoordinateType===xs.Atlas;r.uniforms.add(new xu("baseColorTexture",s=>s.texture)),i?(t.include(cfe),r.code.add(b`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):r.code.add(b`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else r.code.add(b`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function qot(t){const e=new dr;e.include(lx,t),e.include(EN,t),e.include(Dv,t),e.include(Rp,t),e.include(F2,t),e.include(zot,t),e.include(VGe,t),e.include(Y7e,t),e.include(Hot,t),e.include(jot,t);const{vertex:r,fragment:i}=e;t.pbrMode!==et.Normal&&t.pbrMode!==et.Schematic||(e.include(CG,t),t.hasNormalTexture&&e.include(q0e,t));const s=t.output===L.Shadow||t.output===L.ShadowHighlight||t.output===L.ShadowExcludeHighlight;s&&t.componentData===Ip.Varying?r.code.add(b`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(b`#define discardShadows(castShadows) {}`);const n=t.integratedMeshMode===uc.ColorOverlay||t.integratedMeshMode===uc.ColorOverlayWithWater,o=n&&t.output===L.Color&&t.pbrMode===et.WaterOnIntegratedMesh;return n&&(e.include(hv,t),e.include(bqe,t),t.spherical?r.code.add(b`
      const float invEllipsoidRadius = ${b.float(1/(t.ellipsoidMode===Lp.Earth?mr.radius:t.ellipsoidMode===Lp.Mars?Ep.radius:gm.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(b`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),r.code.add(b`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===L.ObjectAndLayerIdColor?b`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${b.float(qn)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===L.ObjectAndLayerIdColor?b`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?b`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:b`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?b`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===L.Alpha&&(i.include(Nu),e.include(Nl,t),e.include(Lre,t),n&&i.uniforms.add(new Ze("ovColorTex",(a,l)=>UB(a,l))),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?b`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?b`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),t.output===L.Color&&(i.include(Nu),e.include(Nl,t),e.include(Lre,t),e.include(Dre,t),e.include(hv,t),t.receiveShadows?(e.include(RN,t),i.code.add(b`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(b`float evaluateShadow() { return 0.0; }`),n&&i.uniforms.add(new Ze("ovColorTex",(a,l)=>UB(a,l))),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?b`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?b`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===et.Normal||t.pbrMode===et.Schematic?(Jp(i),i.code.add(b`
        ${t.pbrMode===et.Normal?b`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?i.code.add(b`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(b`vec3 shadingNormal = normalVertex;`),i.code.add(b`${t.spherical?b`vec3 normalGround = normalize(positionWorld());`:b`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(b`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();

        ${t.snowCover?b`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${n?b` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?i.code.add(b`float shadow = evaluateShadow();`):t.spherical?(V2(i),i.code.add(b`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(b`float shadow = 0.0;`),o&&i.uniforms.add(new Ze("ovNormalTex",(a,l)=>{var c;return(c=l.overlay)==null?void 0:c.getTexture(Ei.WaterNormal)})),t.snowCover&&i.code.add(b`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),i.code.add(b`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?b` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?b`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(b`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===Qe.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(t.output===L.Depth||s)&&(e.include(Em,t),i.code.add(b`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===L.Normal&&(e.include(Dre,t),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${t.normalType===Tr.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===L.ObjectAndLayerIdColor&&e.fragment.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?b`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===L.Highlight&&(e.include(_y),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?b`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}const Wot=Object.freeze(Object.defineProperty({__proto__:null,build:qot},Symbol.toStringTag,{value:"Module"}));let Hbe=class qbe extends Sr{initializeConfiguration(e,r){r.spherical=e.viewingMode===$e.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new vr(e.rctx,qbe.shader.get().build(this.configuration),Wbe)}_setPipelineState(e){const r=this.configuration,i=r.integratedMeshMode!==uc.None,s=e===Qe.NONE,n=e===Qe.FrontFace;return Et({blending:r.output!==L.Color&&r.output!==L.Alpha||!r.blendingEnabled?null:s?Ac:Bm(e),culling:ZD(r.cullFace),depthTest:{func:vy(e)},depthWrite:s||n?Xa:null,colorWrite:Ut,stencilWrite:i||r.hasOccludees?Gp:null,stencilTest:i?NGe(Wa.IntegratedMeshMaskExcluded):r.hasOccludees?by:null,polygonOffset:s||n?r.hasPolygonOffset?{factor:2,units:2}:null:wN})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};Hbe.shader=new _r(Wot,()=>he(()=>import("./ComponentShader.glsl-a9f2bfd0.js"),[],import.meta.url));const Wbe=new Map([[R.POSITION,0],[R.NORMAL,1],[R.NORMALCOMPRESSED,1],[R.COLOR,2],[R.UV0,3],[R.UVREGION,4],[R.COMPONENTINDEX,5]]);let Yot=class extends Vr{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},WH=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function Zi(t={}){return(e,r)=>{const i=e._parameterCount??0;if(e._parameterCount=i+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,r,{get(){return this[i]},set(n){const o=this[i];if(o==null)this[i]=n;else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,r,{get(){return this[i]},set(s){this[i]!==s&&(t.dispose&&this[i]&&this[i].dispose(),this[i]=s,this._setDirty())}})}}function Nre(){return(t,e)=>{const r=t._parameterCount??0;t._parameterCount=r+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(r),Object.defineProperty(t,e,{get(){return this[r]},set(i){this[r]!==i&&(this[r]=i,this._setDirty())}})}}let WN=class{constructor(e){this._low=E(),this._high=E(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){ie(this._low,ie(Fre,e));const r=Rn(Fre,e,this._low);ie(this._high,r)}get(e){return le(e,this._low,this._high)}getLowScaled(e){return ee(e,this._low,1)}};const Fre=os();let vn=class extends Yot{constructor(e,r){super(),this.toMapSpace=r,this.baseColor=Ot(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Oo(CN),this.emissiveFactor=Te(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new ZM,this.componentParameters=new fC,this.textureAlphaCutoff=FI,this.alphaDiscardMode=Ur.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Lp.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new er;const i=new WN(e.position),s=K0e(e.rotationScale);Ov(s,s),this.transformNormalGlobalFromModel=Nue(Lu(s,s)),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=Zt(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,r,i,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasEmissionTexture=this.emissionTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.transparencyPassType=r.identifier===Tl.Material&&i.transparencyPassType!=null?i.transparencyPassType:Qe.NONE,n.multipassEnabled=r.identifier===Tl.Material&&i.multipassEnabled,n.cullAboveGround=r.identifier===Tl.Material&&i.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?ji.View:ji.None,n.hasColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();if(n.blendingEnabled=o===na.Transparent||o===na.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?Jot(i)?Zot(i)?uc.ColorOverlayWithWater:uc.ColorOverlay:uc.NoOverlay:uc.None,n.hasPolygonOffset=this.polygonOffsetEnabled,n.pbrMode=n.integratedMeshMode===uc.ColorOverlayWithWater?et.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?et.Schematic:et.Normal:et.Disabled,n.normalType=n.integratedMeshMode===uc.None?n.hasNormals?Tr.Compressed:Tr.ScreenDerivative:Tr.Ground,n.hasSlicePlane=i.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,r.identifier===Tl.ShadowMap)n.output=L.Shadow,n.vertexDiscardMode=mc.None;else if(r.identifier===Tl.Highlight)n.output=L.Highlight,n.vertexDiscardMode=mc.None;else{switch(o===na.OpaqueAndTransparent?n.vertexDiscardMode=r.transparent?mc.Opaque:mc.Transparent:n.vertexDiscardMode=mc.None,n.output=r.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,r.output){case L.Color:n.receiveAmbientOcclusion=i.ssao!=null,n.hasOccludees=i.hasOccludees,n.receiveShadows=i.shadowMap.ready,n.hasScreenSpaceReflections=i.ssr.lastFrameColor!=null,n.hasCloudsReflections=i.cloudsFade.data!=null;break;case L.Alpha:n.hasOccludees=i.hasOccludees;break;case L.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(i)}return this._technique=e.releaseAndAcquire(Hbe,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,r,i){if(this.objectOpacity===0)return;const s=i.renderable.geometry,n=i.components,o=i.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case na.Opaque:e.materialOpaque.submitDraw(this,s,a,o);break;case na.Transparent:e.materialTransparent.submitDraw(this,s,a,o);break;case na.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,a,o),e.materialTransparent.submitDraw(this,s,a,o);break;case na.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,a,o),Xot(r)&&e.highlightIntegratedMesh.submitDraw(this,s,a,o)}const u=this.componentParameters.castShadows!==an.None;u&&e.shadowMap.submitDraw(this,s,a,o),l!=null&&(e.highlight.submitDraw(this,s,l,o),u&&e.highlightShadowMap.submitDraw(this,s,l,o)),u&&c!=null&&e.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?na.IntegratedMesh:this.objectOpacity<1?na.Transparent:this.componentParameters.opaqueOverride===an.All?na.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Ur.Blend||this.alphaDiscardMode===Ur.MaskBlend?na.Transparent:this.componentParameters.transparent===an.None?na.Opaque:this.componentParameters.transparent===an.All?na.Transparent:na.OpaqueAndTransparent}};var na,an;h([Zi({vectorOps:Woe})],vn.prototype,"baseColor",void 0),h([Zi()],vn.prototype,"usePBR",void 0),h([Zi()],vn.prototype,"hasParametersFromSource",void 0),h([Zi({vectorOps:aW})],vn.prototype,"mrrFactors",void 0),h([Zi({vectorOps:aW})],vn.prototype,"emissiveFactor",void 0),h([Zi({dispose:!0})],vn.prototype,"baseColorTexture",void 0),h([Zi({dispose:!0})],vn.prototype,"metallicRoughnessTexture",void 0),h([Zi({dispose:!0})],vn.prototype,"emissionTexture",void 0),h([Zi({dispose:!0})],vn.prototype,"occlusionTexture",void 0),h([Zi({dispose:!0})],vn.prototype,"normalTexture",void 0),h([Zi()],vn.prototype,"objectOpacity",void 0),h([Nre()],vn.prototype,"commonMaterialParameters",void 0),h([Nre()],vn.prototype,"componentParameters",void 0),h([Zi()],vn.prototype,"textureAlphaCutoff",void 0),h([Zi()],vn.prototype,"alphaDiscardMode",void 0),h([Zi()],vn.prototype,"isIntegratedMesh",void 0),h([Zi()],vn.prototype,"polygonOffsetEnabled",void 0),h([Zi()],vn.prototype,"ellipsoidMode",void 0),h([Zi()],vn.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(na||(na={}));let ZM=class extends WH{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=oi.Back,this.hasSlicePlane=!0}};h([Zi()],ZM.prototype,"doubleSided",void 0),h([Zi()],ZM.prototype,"cullFace",void 0),h([Zi()],ZM.prototype,"hasSlicePlane",void 0);let fC=class extends WH{constructor(){super(...arguments),this.externalColor=Ot(1,1,1,1),this.externalColorMixMode=Zs.Multiply,this.castShadows=an.All}get transparent(){return this.externalColor[3]<1?an.All:an.None}get opaqueOverride(){return this.externalColorMixMode===Zs.Replace&&this.externalColor[3]===1?an.All:an.None}get visible(){return this.externalColor[3]>0?an.All:an.None}get type(){return Ip.Uniform}};h([Zi({vectorOps:Woe})],fC.prototype,"externalColor",void 0),h([Zi()],fC.prototype,"externalColorMixMode",void 0),h([Zi()],fC.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(an||(an={}));let hE=class extends WH{constructor(){super(...arguments),this.texture=null,this.transparent=an.None,this.opaqueOverride=an.None,this.castShadows=an.None}get type(){return Ip.Varying}};function Xot(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(Ei.Highlight))!=null}function Zot(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(Ei.WaterNormal))!=null}function Jot(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(Ei.ColorNoRasterImage))!=null}h([Zi()],hE.prototype,"texture",void 0),h([Zi()],hE.prototype,"transparent",void 0),h([Zi()],hE.prototype,"opaqueOverride",void 0),h([Zi()],hE.prototype,"castShadows",void 0);const pL=Ci().vec3f(R.POSITION).u16(R.COMPONENTINDEX),Ybe=Ci().vec2u8(R.SIDENESS),Qot=Ul(Ybe),xz=Ci().vec3f(R.POSITION0).vec3f(R.POSITION1).vec3f(R.NORMAL).u16(R.COMPONENTINDEX).u8(R.VARIANTOFFSET,{glNormalized:!0}).u8(R.VARIANTSTROKE).u8(R.VARIANTEXTENSION,{glNormalized:!0}),Tz=Ci().vec3f(R.POSITION0).vec3f(R.POSITION1).vec3f(R.NORMALA).vec3f(R.NORMALB).u16(R.COMPONENTINDEX).u8(R.VARIANTOFFSET,{glNormalized:!0}).u8(R.VARIANTSTROKE).u8(R.VARIANTEXTENSION,{glNormalized:!0}),Xbe=new Map([[R.POSITION0,0],[R.POSITION1,1],[R.COMPONENTINDEX,2],[R.VARIANTOFFSET,3],[R.VARIANTSTROKE,4],[R.VARIANTEXTENSION,5],[R.NORMAL,6],[R.NORMALA,6],[R.NORMALB,7],[R.SIDENESS,8]]);function Ure(t,e,r){const i=e/3,s=new Uint32Array(r+1),n=new Uint32Array(r+1),o=(w,x)=>{w<x?s[w+1]++:n[x+1]++};for(let w=0;w<i;w++){const x=t[3*w],T=t[3*w+1],S=t[3*w+2];o(x,T),o(T,S),o(S,x)}let a=0,l=0;for(let w=0;w<r;w++){const x=s[w+1],T=n[w+1];s[w+1]=a,n[w+1]=l,a+=x,l+=T}const c=new Uint32Array(6*i),u=s[r],d=(w,x,T)=>{if(w<x){const S=s[w+1]++;c[2*S]=x,c[2*S+1]=T}else{const S=n[x+1]++;c[2*u+2*S]=w,c[2*u+2*S+1]=T}};for(let w=0;w<i;w++){const x=t[3*w],T=t[3*w+1],S=t[3*w+2];d(x,T,w),d(T,S,w),d(S,x,w)}const p=(w,x)=>{const T=2*w,S=x-w;for(let C=1;C<S;C++){const A=c[T+2*C],O=c[T+2*C+1];let $=C-1;for(;$>=0&&c[T+2*$]>A;$--)c[T+2*$+2]=c[T+2*$],c[T+2*$+3]=c[T+2*$+1];c[T+2*$+2]=A,c[T+2*$+3]=O}};for(let w=0;w<r;w++)p(s[w],s[w+1]),p(u+n[w],u+n[w+1]);const g=new Int32Array(3*i),y=(w,x)=>w===t[3*x]?0:w===t[3*x+1]?1:w===t[3*x+2]?2:-1,_=(w,x)=>{const T=y(w,x);g[3*x+T]=-1},v=(w,x,T,S)=>{const C=y(w,x);g[3*x+C]=S;const A=y(T,S);g[3*S+A]=x};for(let w=0;w<r;w++){let x=s[w];const T=s[w+1];let S=n[w];const C=n[w+1];for(;x<T&&S<C;){const A=c[2*x],O=c[2*u+2*S];A===O?(v(w,c[2*x+1],O,c[2*u+2*S+1]),x++,S++):A<O?(_(w,c[2*x+1]),x++):(_(O,c[2*u+2*S+1]),S++)}for(;x<T;)_(w,c[2*x+1]),x++;for(;S<C;)_(c[2*u+2*S],c[2*u+2*S+1]),S++}return g}let Zbe=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?eat:Kot}write(e,r,i){const s=this._edgeHashFunction(i);oP.seed=s;const n=oP.getIntRange(0,255),o=oP.getIntRange(0,this.settings.variants-1),a=.7,l=oP.getFloat(),c=255*(.5*tat(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(r,i.position0),e.position1.setVec(r,i.position1),e.componentIndex.set(r,i.componentIndex),e.variantOffset.set(r,n),e.variantStroke.set(r,o),e.variantExtension.set(r,c)}trim(e,r){return e.slice(0,r)}};const YH=new Float32Array(6),fL=new Uint32Array(YH.buffer),R0=new Uint32Array(1);function Kot(t){const e=YH;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],R0[0]=5381;for(let r=0;r<fL.length;r++)R0[0]=31*R0[0]+fL[r];return R0[0]}function eat(t){const e=YH;e[0]=zb(t.position0[0]),e[1]=zb(t.position0[1]),e[2]=zb(t.position0[2]),e[3]=zb(t.position1[0]),e[4]=zb(t.position1[1]),e[5]=zb(t.position1[2]),R0[0]=5381;for(let r=0;r<fL.length;r++)R0[0]=31*R0[0]+fL[r];return R0[0]}const kre=1e4;function zb(t){return Math.round(t*kre)/kre}function tat(t,e){const r=t<0?-1:1;return Math.abs(t)**e*r}let mL=class{constructor(){this._commonWriter=new Zbe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return xz.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),le(nP,i.faceNormal0,i.faceNormal1),pe(nP,nP),e.normal.setVec(r,nP)}trim(e,r){return this._commonWriter.trim(e,r)}};mL.Layout=xz,mL.glLayout=Ul(xz,1);let gL=class{constructor(){this._commonWriter=new Zbe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return Tz.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),e.normalA.setVec(r,i.faceNormal0),e.normalB.setVec(r,i.faceNormal1)}trim(e,r){return this._commonWriter.trim(e,r)}};gL.Layout=Tz,gL.glLayout=Ul(Tz,1);const nP=E(),oP=new gE,W_=-1;var yL;function rat(t,e,r,i=lat){const s=t.vertices.position,n=t.vertices.componentIndex,o=At(i.anglePlanar),a=At(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),u=Sz.edge,d=u.position0,p=u.position1,g=u.faceNormal0,y=u.faceNormal1,_=aat(t),v=oat(t),w=v.length/4,x=e.allocate(w);let T=0;const S=w,C=r.allocate(S);let A=0,O=0,$=0;const D=Gxe(0,w),N=new Float32Array(w);N.forEach((V,J,P)=>{s.getVec(v[4*J],d),s.getVec(v[4*J+1],p),P[J]=hi(d,p)}),D.sort((V,J)=>N[J]-N[V]);const z=new Array,U=new Array;for(let V=0;V<w;V++){const J=D[V],P=N[J],I=v[4*J],B=v[4*J+1],G=v[4*J+2],q=v[4*J+3],Z=q===W_;if(s.getVec(I,d),s.getVec(B,p),Z)se(g,_[3*G],_[3*G+1],_[3*G+2]),ie(y,g),u.componentIndex=n.get(I),u.cosAngle=de(g,y);else{if(se(g,_[3*G],_[3*G+1],_[3*G+2]),se(y,_[3*q],_[3*q+1],_[3*q+2]),u.componentIndex=n.get(I),u.cosAngle=de(g,y),sat(u,c))continue;u.cosAngle<-.9999&&ie(y,g)}O+=P,$++,Z||iat(u,l)?(e.write(x,T++,u),z.push(P)):nat(u,o)&&(r.write(C,A++,u),U.push(P))}const Y=new Float32Array(z.reverse()),H=new Float32Array(U.reverse());return{regular:{instancesData:e.trim(x,T),lodInfo:{lengths:Y}},silhouette:{instancesData:r.trim(C,A),lodInfo:{lengths:H}},averageEdgeLength:O/$}}function iat(t,e){return t.cosAngle<e}function sat(t,e){return t.cosAngle>e}function nat(t,e){const r=un(t.cosAngle),i=Sz.fwd,s=Sz.ortho;return Rm(i,t.position1,t.position0),r*(de(rt(s,t.faceNormal0,t.faceNormal1),i)>0?-1:1)>e}function oat(t){const e=t.faces.length/3,r=t.faces,i=t.neighbors;let s=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],u=i[3*a+2],d=r[3*a],p=r[3*a+1],g=r[3*a+2];s+=l===W_||d<p?1:0,s+=c===W_||p<g?1:0,s+=u===W_||g<d?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],u=i[3*a+2],d=r[3*a],p=r[3*a+1],g=r[3*a+2];(l===W_||d<p)&&(n[o++]=d,n[o++]=p,n[o++]=a,n[o++]=l),(c===W_||p<g)&&(n[o++]=p,n[o++]=g,n[o++]=a,n[o++]=c),(u===W_||g<d)&&(n[o++]=g,n[o++]=d,n[o++]=a,n[o++]=u)}return n}function aat(t){const e=t.faces.length/3,r=t.vertices.position,i=t.faces,s=b6.v0,n=b6.v1,o=b6.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=i[3*l],u=i[3*l+1],d=i[3*l+2];r.getVec(c,s),r.getVec(u,n),r.getVec(d,o),ce(n,n,s),ce(o,o,s),rt(s,n,o),pe(s,s),a[3*l]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(yL||(yL={}));const Sz={edge:{position0:E(),position1:E(),faceNormal0:E(),faceNormal1:E(),componentIndex:0,cosAngle:0},ortho:E(),fwd:E()},b6={v0:E(),v1:E(),v2:E()},lat={anglePlanar:4,angleSignificantEdge:35};function cat(t){const e=uat(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return Bre.updateSettings(t.writerSettings),zre.updateSettings(t.writerSettings),rat(e,Bre,zre)}function uat(t,e,r,i){if(e){const o=Ure(r,i,t.count);return new hat(r,i,o,t)}const s=NB(t.buffer,t.stride/4,{originalIndices:r,originalIndicesLength:i}),n=Ure(s.indices,i,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:pL.createView(s.buffer)}}let hat=class{constructor(e,r,i,s){this.faces=e,this.facesLength=r,this.neighbors=i,this.vertices=s}};const Bre=new mL,zre=new gL,tRt=Ci().vec3f(R.POSITION0).vec3f(R.POSITION1),dat=Ci().vec3f(R.POSITION0).vec3f(R.POSITION1).u16(R.COMPONENTINDEX);let pat=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},fat=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0;const i=new Or(this.textureWidth,1);i.samplingMode=Dt.NEAREST,i.wrapMode=Ft.CLAMP_TO_EDGE,this._texture=new Rt(this._rctx,i),this._data=new jo(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,r,i,s,n,o){const a=e*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,r,i,s){const n=e*this._fieldCount+r;this._dirty=!0,this._data.set(n,i,s)}getDataElement(e,r,i){const s=e*this._fieldCount+r;return this._dirty=!0,this._data.get(s,i)}resizeToFit(e){const r=(e+1)*this._fieldCount;if(r>this._data.count){const i=Math.ceil(r/this.textureWidth)*this.textureWidth,s=new jo(new ArrayBuffer(4*i));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>e*r&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const Jbe=65536;let mat=class{constructor(e,r=1){this.textureBuffer=new fat(e,r),this._indexManager=new pat(Jbe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},Qbe=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const i of this._buffers)if(i.availableCount>=e)return i;if(e>Jbe)return null;const r=new mat(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const Vre=ne.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let gat=class{constructor(e,r){this._renderManager=e,this._viewingMode=r,this._objects=[new It,new It],this._renderSubmit=new Fot(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=te("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new Qbe(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){Je(this._objects[vx.Hidden].length===0&&this._objects[vx.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy();const e=this._objects.flatMap(r=>r.toArray());for(const r of e)r==null||r.destroy()}createObject(e){const r=new uE;return r.toMapSpace=e.toMapSpace,r.transform=e.transform,r.obb=XY(e.obb),r.components=new _ot(this._componentBufferManager,Pp(e.geometry.componentOffsets)),r.renderable=this._createRenderable(e,r.components),r.intersectionGeometry=new Eot(e.geometry.positionData,r.components),this._objects[r.visible].push(r),r}destroyObject(e){const r=e;this._objects[r.visible].removeUnordered(r),r.destroy(),this._notifyDirty()}setObjectVisibility(e,r){const i=e;r!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[r].push(i),i.visible=r,this._notifyDirty())}preSubmit(e){const r=e.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=Yn(r,i.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,r){const i=e.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,r){const i=e;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,r){return e.components.visibility.forEachComponent(r)}getComponentCount(e){const r=e,i=r.components.visibility.componentCount();return{visible:i,invisible:r.components.count-i}}setComponentData(e,r){const i=e,s=i.renderable.material,n=i.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new kot,c=o.textureBuffer,u=new Uint8Array(4),d=new Uint32Array(u.buffer);let p=0,g=0,y=0,_=n.verticalOffsets,v=1/0,w=-1/0,x=!1,T=!1,S=0;for(let C=0;C<n.count;C++){r(C,l),p+=+(l.externalColor[3]<1),g+=+(l.externalColorMixMode===Zs.Replace&&l.externalColor[3]===1),y+=+l.castShadows,B0e(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(a[C],0,u[0],u[1],u[2],u[3]),x||(x=C>0&&S!==d[0]),S=d[0],T||(T=l.elevationOffset!==0),T&&_==null&&(_=new Array(C).fill(0)),_!=null&&(_[C]=l.elevationOffset),v=Math.min(v,l.elevationOffset),w=Math.max(w,l.elevationOffset),jbe(l.elevationOffset,u),c.setData(a[C],1,u[0],u[1],u[2],u[3]);const A=l.objectAndLayerIdColor;A!=null&&c.setData(a[C],2,A[0],A[1],A[2],A[3]),l.pickable!==zbe(n.pickability,C)&&(n.pickability=bot(n.pickability,n.count,C,l.pickable))}n.verticalOffsets=T?_:null,i.offsetObb=T?lde(i.obb,v,w,this._viewingMode,i.offsetObb!=null?i.offsetObb:XY(i.obb)):null,x||T||this._hasObjectAndLayerId?(s.componentParameters=new hE,s.componentParameters.castShadows=w6(y,n.count),s.componentParameters.transparent=w6(p,n.count),s.componentParameters.opaqueOverride=w6(g,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new fC,s.componentParameters.castShadows=l.castShadows?an.All:an.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,r,i,s=!1){e.intersectionGeometry.getComponentAabb(r,i);const n=e,o=n.components.verticalOffsets;if(s||o==null)return i;const a=o[r];if(this._viewingMode===$e.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=u4e(a);return l.localOrigin=n.transform.position,l.applyToAabb(i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,r,i){return e.intersectionGeometry.getComponentPositions(r,i)}intersect(e,r,i,s,n,o){const a=e;n!=null&&(n.localOrigin=a.transform.position);const l=Ov(Gre,a.transform.rotationScale);Rn(aP,r,a.transform.position),Rn(lP,i,a.transform.position),Sl(aP,aP,l),Sl(lP,lP,l);const c=Lu(Gre,l);return a.intersectionGeometry.intersect(aP,lP,s,c,n,a.components.verticalOffsets,o)}addEdges(e,r,i,s){const n=e,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return r.addComponentObject(e,n.transform,{center:n.obb.center,radius:n4e(n.obb)},a,o,l,i,s)}async extractEdgeInformation(e,r,i){const s=e,n=s.components.visibility;if(n.allInvisible())return{buffer:dat.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=pL.createBuffer(a.length/3);fA(c.position.typedBuffer,a,c.position.typedBufferStride,3),Gye(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const u=c.count,d=this._computeVisibilityIndices(o,n,l,u);return{origin:Ii(s.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:d,indicesLength:d.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(e,r,i){let s=0;for(let n=0;n<i.length-1;n++){const o=i[n],a=i[n+1];for(let l=o;l<a;l++){const c=r?r[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,r,i,s){if(e&&r.allVisible())return e;let n=0;r.forEachComponentRange((l,c)=>(n+=i[c]-i[l],!0));const o=Cu(e)?new Array(n):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return r.forEachComponentRange((l,c)=>{const u=i[l],d=i[c];for(let p=u;p<d;p++)o[a++]=e?e[p]:p;return!0}),o}addComponentHighlight(e,r){const i=e.components;i.highlightCounts==null&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(e,r){const i=e.components;if(i.highlightCounts==null)return void Vre.warn("Removing non-existing highlight.");const s=i.highlightCounts[r],n=i.highlightCounts[i.count];if(s!==0){if(s>1)return i.highlightCounts[r]=s-1,void(i.highlightCounts[i.count]=n-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),n===1?i.highlightCounts=null:i.highlightCounts[i.count]=n-1}else Vre.warn("Removing non-existing highlight.")}clearHighlights(e){const r=e.components;r.highlightCounts!=null&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[vx.Visible]}_createRenderable(e,r){const i=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=Cr.createVertex(i,yr.STATIC_DRAW,s.vertices.data),a=s.indices?Cr.createIndex(i,yr.STATIC_DRAW,s.indices):null,l=Ul(Uot(n)),c=new Uint16Array(s.vertices.count);for(let _=0;_<r.count;_++){const v=r.offsets[_],w=r.offsets[_+1],x=r.materialDataIndices[_];if(s.indices!=null)for(let T=v;T<w;T++)c[s.indices[T]]=x;else for(let T=v;T<w;T++)c[T]=x}const u=Cr.createVertex(i,yr.STATIC_DRAW,c.buffer),d=new vn(e.transform,e.toMapSpace),p=new Fu(i,Wbe,{data:l,componentIndices:yat},{data:o,componentIndices:u},a),g=new Oot(p,Qt.TRIANGLES,n,a!=null),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteLength+u.byteLength+(a!=null?a.byteLength:0)};return new Rot(d,g,y)}_notifyDirty(){this._renderManager.notifyDirty()}};const yat=Ul(Ci().u16(R.COMPONENTINDEX));function w6(t,e){return t===e?an.All:t===0?an.None:an.Some}const Gre=zo(),aP=E(),lP=E();let XH=class extends Vr{constructor(){super(...arguments),this.opacity=1}};function _at(t){const e=new dr;return e.include(Wo),e.fragment.uniforms.add(new Ze("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new Ee("opacity",r=>r.opacity)),e.fragment.code.add(b`
    void main() {
      fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const vat=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:XH,build:_at},Symbol.toStringTag,{value:"Module"}));var Mo;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(Mo||(Mo={}));let _L=class extends Za{constructor(){super(...arguments),this.alphaMode=Mo.None,this.hasOpacityFactor=!1}};h([F({count:Mo.COUNT})],_L.prototype,"alphaMode",void 0),h([F()],_L.prototype,"hasOpacityFactor",void 0);let ZH=class Kbe extends Sr{initializeProgram(e){return new vr(e.rctx,Kbe.shader.get().build(this.configuration),hr)}initializePipeline(){switch(this.configuration.alphaMode){case Mo.None:return Et({colorWrite:Ut});case Mo.Alpha:return Et({blending:Jn(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ut});case Mo.PremultipliedAlpha:case Mo.COUNT:return Et({blending:Dl(ve.ONE,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ut})}}};ZH.shader=new _r(vat,()=>he(()=>import("./Compositing.glsl-2aeda6b8.js"),[],import.meta.url));let ewe=class extends Vr{};function bat(){const t=new dr;return t.include(Wo),t.fragment.uniforms.add(new Ze("tex",e=>e.texture)),t.fragment.code.add(b`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const wat=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:ewe,build:bat},Symbol.toStringTag,{value:"Module"}));let twe=class rwe extends Sr{initializeProgram(e){return new vr(e.rctx,rwe.shader.get().build(),hr)}initializePipeline(){return Et({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};twe.shader=new _r(wat,()=>he(()=>import("./HUDCompositing.glsl-f275e3ec.js"),[],import.meta.url));let iwe=class extends Vr{};function xat(){const t=new dr;return t.include(Wo),t.fragment.uniforms.add(new Ze("colorTexture",e=>e.colorTexture),new Ze("alphaTexture",e=>e.alphaTexture),new Ze("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(b`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const Tat=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:iwe,build:xat},Symbol.toStringTag,{value:"Module"}));let swe=class nwe extends Sr{initializeProgram(e){return new vr(e.rctx,nwe.shader.get().build(),hr)}initializePipeline(){return Et({blending:Jn(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ut})}};swe.shader=new _r(Tat,()=>he(()=>import("./OITCompositing.glsl-8319ab06.js"),[],import.meta.url));let Sat=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._configuration=new _L,this._passParameters=new XH,this._oitParameters=new iwe,this._hudParameters=new ewe}compositeOIT(e,r,i,s){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=s;const n=this._techniqueRepository.acquire(swe);this._rctx.bindTechnique(n,this._oitParameters,e),this._rctx.screen.draw(),n.release()}compositeHUD(e,r){this._hudParameters.texture=r;const i=this._techniqueRepository.acquire(twe);this._rctx.bindTechnique(i,this._hudParameters,e),this._rctx.screen.draw(),i.release()}composite(e,r,i=Mo.None,s=1){this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=r,this._passParameters.opacity=s;const n=this._techniqueRepository.acquire(ZH,this._configuration);this._rctx.bindTechnique(n,this._passParameters,e),this._rctx.screen.draw(),n.release()}};const Eat=1e4,Ez=100,Cat=500,Aat=500,Rat=.1;function Oat(t,e,r){return Yj(e,t)*(r[1]-r[0])+r[0]}function Pat(t,e,r){let i=0;if(!e.some(n=>(i+=n.numGeometries,i>=Eat)))return Uat.compute(t,e);const s=mA();return r.forAll(n=>m2(s,Mat(t,n))),s}function Mat(t,e){if(!e.visible)return;const r=mA(),i=e.getSpatialQueryAccelerator();return i?$at(r,t,i):Iat(r,t,e.objects),r}function $at(t,e,r){const i=e.eye,s=e.viewForward,n=e.frustum,o=l=>l.visible,a=r.objectCount;if(a<Cat)p3(lu,e.near,Math.min(t.near,e.far)),r.forEachInDepthRange(i,s,Gh.DepthOrder.FRONT_TO_BACK,lu,(l,c)=>{Cz(t,e,l),lu.far=t.near,c.setRange(lu)},n,o),p3(lu,Math.max(t.far,e.near),e.far),r.forEachInDepthRange(i,s,Gh.DepthOrder.BACK_TO_FRONT,lu,(l,c)=>{Cz(t,e,l),lu.near=t.far,c.setRange(lu)},n,o);else{const l=Math.max(Math.min(a,Aat),Math.ceil(a*Rat)),c=r.findClosest(s,Gh.DepthOrder.FRONT_TO_BACK,n,o,l),u=r.findClosest(s,Gh.DepthOrder.BACK_TO_FRONT,n,o,l);c&&u&&(jre(t,e,c.boundingVolumeWorldSpace.bounds),jre(t,e,u.boundingVolumeWorldSpace.bounds))}}function Iat(t,e,r){Vb.clear(),r.forAll(i=>{i.visible&&i.geometries.length!==0&&Vb.add(i)}),Vb.empty||(Vb.sort(e),p3(lu,e.near,Math.min(t.near,e.far)),Vb.forEachInDepthRange(lu,Gh.DepthOrder.FRONT_TO_BACK,(i,s)=>{s<t.near&&Cz(t,e,i)}),p3(lu,Math.max(t.far,e.near),e.far),Vb.forEachInDepthRange(lu,Gh.DepthOrder.BACK_TO_FRONT,(i,s,n)=>{t.far=Math.max(t.far,n)}))}function Cz(t,e,r){if(!r.visible||!E0(e.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,s=Fat;r.geometries.forEach(n=>{Pr(s,i,n.transformation);const o=jx(s);owe(t,e,n.boundingInfo,s,o)})}function owe(t,e,r,i,s){if(r==null)return;De(ca,r.center,i);const{eye:n,viewForward:o}=e,a=o[0]*(ca[0]-n[0])+o[1]*(ca[1]-n[1])+o[2]*(ca[2]-n[2]);if(ca[3]=r.radius*s,!(a-ca[3]>t.near&&a+ca[3]<t.far)&&E0(e.frustum,ca))if(r.radius>Ez&&r.getChildren())for(const l of r.getChildren())owe(t,e,l,i,s);else Az.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function jre(t,e,r){const i=e.eye,s=e.viewForward,n=(r[0]-i[0])*s[0]+(r[1]-i[1])*s[1]+(r[2]-i[2])*s[2];t.near=Math.min(t.near,n-r[3]),t.far=Math.max(t.far,n+r[3])}let Lat=class{constructor(){this._items=new It({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const r=e.eye,i=e.viewForward;this._items.forAll(s=>{const n=s.object.boundingVolumeWorldSpace.bounds,o=(n[0]-r[0])*i[0]+(n[1]-r[1])*i[1]+(n[2]-r[2])*i[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,r,i){if(r===Gh.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.object,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.object,n.near,n.far)}}},Dat=class{constructor(){this._view=ge(),this._viewProj=ge(),this._frustum=WC(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,r){this._reset(),Ss(this._view,e.viewMatrix),Pr(this._viewProj,e.projectionMatrix,this._view),gI(this._frustum,e.frustum);const i=this._view,s=i[2],n=i[6],o=i[10],a=i[14];r.forAll(p=>p.forEachGeometry(g=>{if(!g.visible||!g.castShadow)return;const y=g.boundingSphere,_=s*y[0]+n*y[1]+o*y[2]+a,v=_-y[3],w=_+y[3];this._geometries.push(g),this._near.push(-w),this._far.push(-v)}));const l=new HH;if(this._geometries.length===0)return l;for(let p=0;p<this._geometries.length;++p)this._near[p]>l.far&&(l.far=this._near[p]),this._near[p]>2&&this._far[p]<l.near&&(l.near=this._far[p]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let u=0,d=0;for(let p=0;p<this._geometries.length;++p)this._near[p]<l.near&&(this._near[p]>=c.near?l.near=this._near[p]:this._nearCandidates[u++]=p),this._far[p]>l.far&&(this._far[p]<=c.far?l.far=this._far[p]:this._farCandidates[d++]=p);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((p,g)=>this._near[p]<this._near[g]?-1:this._near[p]>this._near[g]?1:0),this._farCandidates.sort((p,g)=>this._far[p]<this._far[g]?1:this._far[p]>this._far[g]?-1:0);for(let p=0;p<this._nearCandidates.length;++p){const g=this._nearCandidates[p];if(this._near[g]<l.near){const y=this._geometries[g],_=y.boundingInfo;this._includeNearBoundingInfoRec(_,y.shaderTransformation,l)}}for(let p=0;p<this._farCandidates.length;++p){const g=this._farCandidates[p];if(this._far[g]>l.far){const y=this._geometries[g],_=y.boundingInfo;this._includeFarBoundingInfoRec(_,y.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,r,i){if(e==null)return;const s=e.center;De(ca,s,r);const n=jx(r),o=ca[0],a=ca[1],l=ca[2],c=e.radius*n,u=this._frustum;if(u[0][0]*o+u[0][1]*a+u[0][2]*l+u[0][3]>c||u[1][0]*o+u[1][1]*a+u[1][2]*l+u[1][3]>c||u[2][0]*o+u[2][1]*a+u[2][2]*l+u[2][3]>c||u[3][0]*o+u[3][1]*a+u[3][2]*l+u[3][3]>c)return;const d=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],p=d+c;if(!(-(d-c)<2||-p>=i.near))if(-p>this._looseRange.near)i.near=-p;else{if(c>Ez){const g=e.getChildren();if(g!==void 0){for(const y of g)this._includeNearBoundingInfoRec(y,r,i);return}}Az.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,r,i){if(e==null)return;let s=e.radius;const n=e.center;De(ca,n,r);const o=jx(r),a=ca[0],l=ca[1],c=ca[2];s*=o;const u=this._frustum;if(u[0][0]*a+u[0][1]*l+u[0][2]*c+u[0][3]>s||u[1][0]*a+u[1][1]*l+u[1][2]*c+u[1][3]>s||u[2][0]*a+u[2][1]*l+u[2][2]*c+u[2][3]>s||u[3][0]*a+u[3][1]*l+u[3][2]*c+u[3][3]>s)return;const d=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-d<=i.far))if(-d<this._looseRange.far)i.far=-d;else{if(s>Ez){const p=e.getChildren();if(p!==void 0){for(const g of p)this._includeFarBoundingInfoRec(g,r,i);return}}Az.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}},Nat=class{constructor(){this._modelViewProj=ge(),this._clipPosition=[Jt(),Jt(),Jt(),Jt(),Jt(),Jt(),Jt(),Jt()]}unionDepthRangeWithAABB(e,r,i,s,n){const o=this._modelViewProj;Pr(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],u=l===0||l===3||l===4||l===7?s[0]:n[0],d=l===0||l===1||l===4||l===5?s[1]:n[1],p=l<4?s[2]:n[2];c[0]=o[0]*u+o[4]*d+o[8]*p+o[12],c[1]=o[1]*u+o[5]*d+o[9]*p+o[13],c[2]=o[2]*u+o[6]*d+o[10]*p+o[14],c[3]=o[3]*u+o[7]*d+o[11]*p+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[x6[l][0]],u=this._clipPosition[x6[l][1]],d=this._clipPosition[x6[l][2]],p=this._clipTriangle(c,u,d);let g=!0;for(let y=0;y<p.length;++y)if(p[y][3]>=2){g=!1;break}if(!g){a=!0;for(let y=0;y<p.length;++y){const _=p[y][3];Number.isFinite(_)&&(e.near=Math.min(_,e.near),e.far=Math.max(_,e.far))}}}return a}_inside(e,r){return r===0?e[0]>=-e[3]:r===1?e[1]>=-e[3]:r===2?e[0]<=e[3]:r===3?e[1]<=e[3]:void Je(!1)}_intersect(e,r,i){let s=0;return i===0?s=(-e[3]-e[0])/(r[0]-e[0]+r[3]-e[3]):i===1?s=(-e[3]-e[1])/(r[1]-e[1]+r[3]-e[3]):i===2?s=(e[3]-e[0])/(r[0]-e[0]-r[3]+e[3]):i===3&&(s=(e[3]-e[1])/(r[1]-e[1]-r[3]+e[3])),R7(Jt(),e,r,s)}_clipTriangle(e,r,i){let s=[e,r,i];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}};const x6=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],ca=ds(),Fat=ge(),lu=mA(),Vb=new Lat,Uat=new Dat,Az=new Nat;let kat=class{},Bat=class extends Vr{constructor(){super(...arguments),this.textures=new kat}};function zat(){const t=new dr;return t.attributes.add(R.POSITION,"vec2"),t.vertex.uniforms.add(new nr("drawPosition",(e,r)=>Vat(e,r))),t.varyings.add("vUV","vec2"),t.vertex.code.add(b`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new Ze("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new Ze("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new Ze("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new Op("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new Op("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(b`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function Vat(t,e){const r=e.camera.pixelRatio,i=t.magnifier.offset.x*r,s=t.magnifier.offset.y*r;Nh(t.magnifier.position,Hre);const n=e.camera.screenToRender(Hre,Gat),o=Math.ceil(r*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return Si(jat,(n[0]+i)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const Hre=Vi(),Gat=sae(),jat=Jt();async function Hat(t){const e=he(()=>import("./mask-svg-023bbc42.js"),[],import.meta.url),r=he(()=>import("./overlay-svg-d62383f3.js"),[],import.meta.url),i=Cm((await e).default,{signal:t}),s=Cm((await r).default,{signal:t}),n={mask:await i,overlay:await s};return wt(t),n}let xw=class extends xe{constructor(){super(...arguments),this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new Bat,this.events=new Ps,this.attributeLocations=new Map([[R.POSITION,0]]),this._tmpScreenPoint=Vi(),this._tmpRenderPoint=sae()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const r=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this.addHandles(ae(()=>{var i;return(i=this._magnifier)==null?void 0:i.version},r)),r()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,r){const i=this._validMagnifier;if(i==null)return;const s=r.camera.pixelRatio,n=Math.ceil(s*i.size);if(this._updateResources(e,n),this._resources==null)return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*n);o.input.resize(a,a),Nh(i.position,this._tmpScreenPoint);const l=r.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=r.camera.fullWidth,u=r.camera.fullHeight,d=.5*a,p=.5*a;l[0]=me(l[0],d,c-d-1),l[1]=me(l[1],p,u-p-1);const g=Math.floor(l[0]-d),y=Math.floor(l[1]-p),_=this._resources.program;_.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,g,y,a,a,0),this._passParameters.magnifier=i,e.useProgram(_),_.bindPass(this._passParameters,r),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Qt.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const r=e.maskUrl,i=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===r&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:r,overlayUrl:i,task:cy(async s=>{const n=r==null||i==null?Hat(s):null,o=r!=null?Cm(r,{signal:s}):n.then(l=>l.mask),a=i!=null?Cm(i,{signal:s}):n.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,r){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==r){const s=this._createTextureResources(e,r);if(s==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=s}return}const i=this._createTextureResources(e,r);i!=null&&(this._resources={program:this._createProgram(e),vao:ef(e,xG,this.attributeLocations,0,1),pipelineState:Et({blending:Dl(ve.ONE,ve.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Ut})},this._passParameters.textures=i)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,r){if(this._imageSources==null)return null;this._imageSources.overlay.width=r,this._imageSources.overlay.height=r,this._imageSources.mask.width=r,this._imageSources.mask.height=r;const i=new Or;i.internalFormat=ut.RGBA,i.wrapMode=Ft.CLAMP_TO_EDGE,i.flipped=!0,i.preMultiplyAlpha=!jne(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const s=new Rt(e,i,this._imageSources.overlay);i.pixelFormat=i.internalFormat=ut.ALPHA,i.preMultiplyAlpha=!1;const n=new Rt(e,i,this._imageSources.mask);return i.pixelFormat=i.internalFormat=ut.RGBA,i.flipped=!1,{input:new Rt(e,i),mask:n,overlay:s,size:r}}_createProgram(e){return new vr(e,zat(),this.attributeLocations)}};h([f()],xw.prototype,"_imageSources",void 0),h([f()],xw.prototype,"_imageLoadTask",void 0),h([f({readOnly:!0})],xw.prototype,"updating",null),xw=h([k("esri/views/3d/webgl-engine/lib/MagnifierHelper")],xw);let qat=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new jo(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,r,i,s,n,o=null,a=null,l=null){if(!(e&&r&&i&&s)||(this._layerUidToId.set(s,i),this._layerUidToPopupEnabled.set(s,n),!n))return;let c=this._layerUidToGraphicsUidToObjectId.get(s);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(s,c)),c.set(r,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const r=this.getObjectAndLayerIdColorArray(e);return Ot(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(e.layerUid);if(r===void 0)return ne.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(r===!1)return this.colorZero;let i=this._uidToRenderColor.get(e.layerUid);i||(i=new Map,this._uidToRenderColor.set(e.layerUid,i));let s=i.get(e.graphicUid);if(!s){for(;!s;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");i.set(e.graphicUid,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new jo(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[r,i]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(i.layerUid);let n=null;s?(n=s.get(i.graphicUid),n||ne.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid)):ne.getLogger(this).warn("getColorMapping: no entry found for layerUid "+i.layerUid);const o=this._layerUidToId.get(i.layerUid);o||ne.getLogger(this).warn("no layerId found for uid "+i.layerUid),n&&o&&e.set(r,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:n.objectId,lid:o,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",oid:n.objectId,lid:o})}return e}};var f3;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(f3||(f3={}));let Cg=class{constructor(e,r,i=f3.FrontToBack){this._rctx=e,this._techniqueRepository=r,this._sorting=i,this._draws=new It({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,r,i,s){const n=this._draws.pushNew();n.geometry=r,n.geometryRanges=i,n.material=e,n.depthSquaredHint=s,n.indexType=(r.indexed?r.vao.indexBuffer.indexType:null)??0}prepare(e,r){return this._draws.map(i=>i.material.prepareTechnique(this._techniqueRepository,e,r,i.geometry.parameters))}dispatch(e,r,i){const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=i[a];l===n&&l.configuration.transparencyPassType===Qe.NONE||(s.bindTechnique(l,e,r),n=l);const c=this._draws.data[a],u=c.geometry;s.bindVAO(u.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,e),this._previouslyBoundDraw.set(l,c.material));const d=c.geometryRanges,p=d.length;if(c.indexType!==0){const g=JM.get(c.indexType);for(let y=0;y<p;y+=2){const _=d[y],v=d[y+1];s.drawElements(u.primitiveType,v,c.indexType,_*g)}}else for(let g=0;g<p;g+=2){const y=d[g],_=d[g+1];s.drawArrays(u.primitiveType,y,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===f3.FrontToBack?1:-1;this._draws.sort((r,i)=>{const s=e*(r.depthSquaredHint-i.depthSquaredHint);return s!==0?s:r.geometry.vao.byteSize-i.geometry.vao.byteSize})}get count(){return this._draws.length}};const JM=new Map;JM.set(Xe.UNSIGNED_BYTE,1),JM.set(Xe.UNSIGNED_SHORT,2),JM.set(Xe.UNSIGNED_INT,4);let Rz=class extends P9e{constructor(){super({}),this._passes=null,this.produces=new Map([[oe.OPAQUE_MATERIAL,e=>this._produces(e)],[oe.TRANSPARENT_MATERIAL,e=>!!(this._passes&&this._passes.materialTransparent.count>0)&&this._produces(e)],[oe.INTEGRATED_MESH,e=>this._produces(e)]]),this._materialPassParameters=new fqe,this._shadowPassParameters=new mqe,this._highlightPassParameters=new gqe,this._systems=new Set}initializeRenderContext(e){this._context=e;const r=e.renderContext.rctx,i=e.techniqueRepository;this._passes={materialOpaque:new Cg(r,i),materialTransparent:new Cg(r,i,f3.BackToFront),materialIntegratedMesh:new Cg(r,i),shadowMap:new Cg(r,i),highlight:new Cg(r,i),highlightIntegratedMesh:new Cg(r,i),highlightShadowMap:new Cg(r,i),defaultShadowMap:new Cg(r,i)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e){return this._systems.size!==0&&this._passes!==null&&(e===L.Highlight?this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0:e!==L.ShadowHighlight||this._passes.highlight.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!==null){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,e.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this._context.techniqueRepository.frameUpdate()}}prepareTechniques(e){if(this._systems.size===0)return null;const r=e.output===L.Shadow||e.output===L.ShadowHighlight||e.output===L.ShadowExcludeHighlight?this._shadowPassParameters:e.output===L.Highlight?this._highlightPassParameters:this._materialPassParameters,i=e.bindParameters;return this._updateParameters(i.camera,r,i.slot===oe.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e,(s,n)=>s.prepare(n,e.bindParameters))}renderNode(e,r){this._invoke(e,(i,s)=>i.dispatch(s,e.bindParameters,r))}_invoke(e,r){if(this._passes===null)return null;switch(e.bindParameters.slot){case oe.OPAQUE_MATERIAL:switch(e.output){case L.Color:case L.Depth:case L.Normal:case L.ObjectAndLayerIdColor:return r(this._passes.materialOpaque,this._materialPassParameters);case L.Highlight:return r(this._passes.highlight,this._highlightPassParameters);case L.Shadow:return r(this._passes.shadowMap,this._shadowPassParameters);case L.ShadowHighlight:return r(this._passes.highlightShadowMap,this._shadowPassParameters);case L.ShadowExcludeHighlight:return r(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case oe.TRANSPARENT_MATERIAL:switch(e.output){case L.Color:case L.Alpha:case L.Depth:case L.Normal:case L.ObjectAndLayerIdColor:return r(this._passes.materialTransparent,this._materialPassParameters)}break;case oe.INTEGRATED_MESH:switch(e.output){case L.Color:case L.Depth:case L.Normal:case L.ObjectAndLayerIdColor:return r(this._passes.materialIntegratedMesh,this._materialPassParameters);case L.Highlight:return r(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const r=new HH;return this._systems.forEach(i=>m2(r,i.queryShadowCasterDepthRange(e))),r}_updateParameters(e,r,i){const s=e.viewInverseTransposeMatrix;se(T6,s[3],s[7],s[11]),S6.set(T6),ie(r.transformWorldFromViewTH,S6.high),ie(r.transformWorldFromViewTL,S6.low),ie(r.slicePlaneLocalOrigin,T6),Iu(r.transformViewFromCameraRelativeRS,e.viewMatrix),Ss(r.transformProjFromView,e.projectionMatrix),r.identifier===Tl.Material&&(this._materialPassParameters.transparent=i,Lu(qre,r.transformViewFromCameraRelativeRS),Ov(r.transformNormalViewFromGlobal,qre))}};Rz=h([k("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],Rz);const T6=E(),qre=Fi(),S6=new WN;let Wat=class{constructor(e=null,r=null,i=null){this.composite=e,this.normal=r,this.highlight=i}},QM=class extends xe{constructor(e){super({}),this._context=e,this._renderPlugins=new It,this._slots=new Array;for(let r=0;r<oe.MAX_SLOTS;++r)this._slots[r]=[]}normalizeCtorArgs(){return{}}add(e,r){const i=()=>{if(r!=null&&r.aborted)throw e.uninitializeRenderContext(),ur();this._renderPlugins.push(e),e.produces.forEach((n,o)=>{this._slots[o].push(e)}),this._context.requestRender(),this.notifyChange("updating")},s=e.initializeRenderContext(this._context,r);if(Fl(s))return s.then(i);i()}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(i=>i!==e);e.uninitializeRenderContext(),this._context.requestRender(),this.notifyChange("updating")}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(e)||r)}),r}renderFeatureChanged(){this._renderPlugins.forAll(e=>{e.renderFeatureChanged&&e.renderFeatureChanged()})}prepare(e){this._context.renderContext.bindParameters.slot=e,this._slots[e].forEach(r=>{const i=r.produces.get(e);i&&i(L.Color)&&(Wre(r)&&r.prepareTechnique(this._context.renderContext),Yre(r)&&r.prepareTechniques(this._context.renderContext))})}_getRenderables(e){this._context.renderContext.bindParameters.slot=e;const r=new Map;return this._slots[e].forEach(i=>{const s=i.produces.get(e);if(s&&s(L.Color)&&(!i.isDecoration||this._context.renderContext.bindParameters.decorations!==Al.OFF))if(Wre(i)){const n=i.prepareTechnique(this._context.renderContext);n!=null&&r.set(i,n)}else if(Yre(i)){const n=i.prepareTechniques(this._context.renderContext);n!=null&&r.set(i,n)}else r.set(i,null)}),r}render(e,r=null,i=null){return this._getRenderables(e).forEach((s,n)=>i=n.renderNode(this._context.renderContext,s,r,i)),i}renderComposition(e,r){const i=this._getRenderables(e);let s=null;return i.forEach((n,o)=>{const a=o.renderNode(this._context.renderContext,n,r,null);s==null||s.release(),s=a,r.composite=s}),s}queryDepthRange(e){const r=new HH;return this._renderPlugins.forAll(i=>{var n;const s=(n=i.queryDepthRange)==null?void 0:n.call(i,e);m2(r,s)}),r}get updating(){return this._renderPlugins.some(e=>e.running)}produces(e,r=L.Color){return this._slots[e].some(i=>{const s=i.produces.get(e);return!!s&&s(r)})}consumes(e){return this._renderPlugins.some(r=>r.consumes().required.includes(e))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,r)=>e|r.renderOccludedFlags,Ti.None)}get usedMemory(){return this._renderPlugins.reduce((e,r)=>e+(r.usedMemory??0),0)}};function Wre(t){return"prepareTechnique"in t}function Yre(t){return"prepareTechniques"in t}h([f({readOnly:!0})],QM.prototype,"updating",null),QM=h([k("esri.views.3d.webgl-engine.lib.RenderPluginManager")],QM);let Tw=class extends Iv{constructor(e){super(e),this._context=null,this.opacity=1,this.alphaMode=Mo.None,this._blitConfiguration=new _L,this._blitParameters=new XH,this.produces=new Map([[oe.BLIT,()=>this._context!=null]])}consumes(){return Tme}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){this._context=null}destroy(){}renderNode(e,r,i,s){var a;const n=(a=i==null?void 0:i.composite)==null?void 0:a.colorTexture;if(!this._context||!n)return s;const o=this._context.techniqueRepository.acquire(ZH,this._blitConfiguration);return o!=null&&o.compiled?(e.rctx.bindFramebuffer(s==null?void 0:s.fbo),this._blitParameters.texture=n,this._blitParameters.opacity=this.opacity,e.rctx.bindTechnique(o,this._blitParameters,e.bindParameters),e.rctx.screen.draw(),o.release(),s):(this._context.requestRender(),s)}};h([f()],Tw.prototype,"_context",void 0),h([f()],Tw.prototype,"opacity",void 0),h([f()],Tw.prototype,"alphaMode",void 0),Tw=h([k("esri.views.3d.webgl-engine.effects.blit.Blit")],Tw);let awe=class extends Vr{};function Yat(){const t=new dr,{outputs:e,fragment:r}=t;return t.include(Wo),r.uniforms.add(new xu("textureInput",i=>i.input)),r.constants.add("outlineSize","int",Math.ceil(JH/2)),e.add("fragGrid","vec2"),r.code.add(b`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${b.int(lp)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -outlineSize; x < cellSize + outlineSize; x += 2) {
        for(int y = -outlineSize; y < cellSize + outlineSize; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`),t}const lp=32,JH=9,lwe=.4,Xat=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:awe,blurSize:lwe,build:Yat,gridCellPixelSize:lp,outlineSize:JH},Symbol.toStringTag,{value:"Module"}));function Zat(){const t=new dr,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(R.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(R.UV0,"vec2"),e.uniforms.add(new Ze("coverageTex",n=>n.coverageTexture),new Ir("coverageRounding",n=>n.coverageRounding)),i.add(b`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new Ze("tex",n=>n.blurTexture),new Ze("highlightTexture",n=>n.highlightTexture),new nr("uColor",n=>n.color),new nr("haloColor",n=>n.haloColor),new nr("opacities",n=>Si(Jat,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),r.constants.add("outlineSize","float",JH),r.constants.add("blurSize","float",lwe),s.add(b`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - (outlineSize - blurSize) / outlineSize;
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const Jat=Jt(),Qat=Object.freeze(Object.defineProperty({__proto__:null,build:Zat},Symbol.toStringTag,{value:"Module"}));let cwe=class uwe extends Sr{initializeProgram(e){return new vr(e.rctx,uwe.shader.get().build(),hr)}initializePipeline(){return Et({blending:Jn(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ut})}};cwe.shader=new _r(Qat,()=>he(()=>import("./HighlightApply.glsl-694a28f7.js"),[],import.meta.url));let hwe=class extends Vr{constructor(){super(...arguments),this.blurSize=ke()}};function Kat(){const t=new dr,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(R.POSITION,"vec2"),e.add(R.UV0,"vec2"),r.add("blurCoordinate","vec3"),i.uniforms.add(new Ze("coverageTex",n=>n.coverageTexture),new Ir("coverageRounding",n=>n.coverageRounding)),i.code.add(b`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`),s.uniforms.add(new W0e("blurSize",n=>n.blurSize),new xu("tex",n=>n.blurInputTexture)),s.code.add(b`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const elt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:hwe,build:Kat},Symbol.toStringTag,{value:"Module"}));let dwe=class pwe extends Sr{initializeProgram(e){return new vr(e.rctx,pwe.shader.get().build(),hr)}initializePipeline(){return Et({colorWrite:Ut})}};dwe.shader=new _r(elt,()=>he(()=>import("./HighlightBlur.glsl-c29ce663.js"),[],import.meta.url));let fwe=class mwe extends Sr{initializeProgram(e){return new vr(e.rctx,mwe.shader.get().build(),hr)}initializePipeline(){return Et({colorWrite:Ut})}};fwe.shader=new _r(Xat,()=>he(()=>import("./HighlightDownsample.glsl-a9410b33.js"),[],import.meta.url));let tlt=class extends Vr{constructor(){super(...arguments),this.color=Ot(1,0,1,1),this.haloColor=Ot(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.coverageRounding=tr(1,1)}},dE=class extends Iv{constructor(e){super(e),this._context=null,this._passParameters=new tlt,this._downsampleDrawParameters=new awe,this._blurDrawParameters=new hwe,this._blurColorFormat=te("mac")?cr.RGBA:cr.RGBA4,this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0},this.produces=new Map([[oe.HIGHLIGHT,()=>!0]])}consumes(){return Sme}initializeRenderContext(e){this._context=e,this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(dwe)),this._downsampleTechnique==null&&(this._downsampleTechnique=this._context.techniqueRepository.acquire(fwe)),this._applyTechnique==null&&(this._applyTechnique=this._context.techniqueRepository.acquire(cwe)),this.addHandles([ae(()=>this.view.highlightOptions.color,r=>{this._passParameters.color=jC(r??Eve),this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color),this._context.requestRender()},Br),ae(()=>this.view.highlightOptions.haloColor,r=>{this._passParameters.haloColor=r!=null?jC(r):this._passParameters.color,this._context.requestRender()},Br),ae(()=>this.view.highlightOptions.haloOpacity,r=>{this._passParameters.haloOpacity=r??Cve,this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity,this._context.requestRender()},Br),ae(()=>this.view.highlightOptions.fillOpacity,r=>{this._passParameters.fillOpacity=r??Ave,this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity,this._context.requestRender()},Br)])}uninitializeRenderContext(){this._context=null}dispose(){this._blurTechnique=Zt(this._blurTechnique),this._downsampleTechnique=Zt(this._downsampleTechnique),this._applyTechnique=Zt(this._applyTechnique),this._grid.coverage=Zt(this._grid.coverage),this._grid.vao=Ke(this._grid.vao)}renderNode(e,r,i,s){var S,C;const n=(S=i==null?void 0:i.highlight)==null?void 0:S.colorTexture;if(!this._context||!n)return;if(!(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled))return void this._context.requestRender();const o=e.bindParameters.camera,a=o.fullWidth,l=o.fullHeight,c=o.pixelRatio,u=Math.ceil(a/c),d=Math.ceil(l/c),p=this._context.fbos,g=p.rctx;this._gridUpdateResources(n),this._gridComputeCoverage(n,e.bindParameters),this._passParameters.highlightTexture=n,this._passParameters.coverageTexture=(C=this._grid.coverage)==null?void 0:C.colorTexture;const{width:y,height:_}=n.descriptor;ir(this._passParameters.coverageRounding,y/(Math.ceil(y/lp)*lp),_/(Math.ceil(_/lp)*lp));const v=g.bindTechnique(this._blurTechnique,this._passParameters,e.bindParameters),w=this._grid.vao;g.bindVAO(w);const x=p.acquire(this._blurColorFormat,u,d);g.bindFramebuffer(x.fbo),g.setViewport(0,0,u,d),g.clear(ii.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=n,ir(this._blurDrawParameters.blurSize,1/u,0),v.bindDraw(this._blurDrawParameters,e.bindParameters,this._passParameters),g.drawArrays(this._blurTechnique.primitiveType,0,nm(w,"geometry"));const T=p.acquire(this._blurColorFormat,u,d);g.bindFramebuffer(T.fbo),g.clear(ii.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=x.colorTexture,ir(this._blurDrawParameters.blurSize,0,1/d),v.bindDraw(this._blurDrawParameters,e.bindParameters,this._passParameters),g.drawArrays(this._blurTechnique.primitiveType,0,nm(w,"geometry")),g.bindFramebuffer(s==null?void 0:s.fbo),g.setViewport4fv(o.fullViewport),this._passParameters.blurTexture=T.colorTexture,g.bindTechnique(this._applyTechnique,this._passParameters,e.bindParameters),g.drawArrays(this._applyTechnique.primitiveType,0,nm(w,"geometry")),T.release(),x.release()}_gridUpdateResources(e){var p;if(!this._context)return;const r=this._context.fbos.rctx,i=this._grid,s=Math.ceil(e.descriptor.height/lp),n=Math.ceil(e.descriptor.width/lp);if(i.vao&&i.verticalCellCount===s&&i.horizontalCellCount===n)return;i.verticalCellCount=s,i.horizontalCellCount=n;const o=s+1,a=n+1,l=1/s,c=1/n,u=new Float32Array(6*4*o*a);let d=0;for(let g=0;g<o;g++)for(let y=0;y<a;y++)u[d++]=(y-.5)*c*2-1,u[d++]=(g-.5)*l*2-1,u[d++]=y*c,u[d++]=g*l,u[d++]=(y+.5)*c*2-1,u[d++]=(g-.5)*l*2-1,u[d++]=y*c,u[d++]=g*l,u[d++]=(y-.5)*c*2-1,u[d++]=(g+.5)*l*2-1,u[d++]=y*c,u[d++]=g*l,u[d++]=(y-.5)*c*2-1,u[d++]=(g+.5)*l*2-1,u[d++]=y*c,u[d++]=g*l,u[d++]=(y+.5)*c*2-1,u[d++]=(g-.5)*l*2-1,u[d++]=y*c,u[d++]=g*l,u[d++]=(y+.5)*c*2-1,u[d++]=(g+.5)*l*2-1,u[d++]=y*c,u[d++]=g*l;(p=i.vao)==null||p.dispose(),i.vao=new pd(r,hr,{geometry:q3},{geometry:Cr.createVertex(r,yr.STATIC_DRAW,u)})}_gridComputeCoverage(e,r){var l;if(!this._context)return;const i=this._context.fbos.rctx,s=this._grid,n=e.descriptor,o=Math.ceil(n.width/lp),a=Math.ceil(n.height/lp);(l=s.coverage)==null||l.release(),s.coverage=this._context.fbos.acquire(cr.RG,o,a),this._downsampleDrawParameters.input=e,i.bindFramebuffer(s.coverage.fbo),i.bindTechnique(this._downsampleTechnique,this._passParameters,r).bindDraw(this._downsampleDrawParameters,r,this._passParameters),i.setViewport(0,0,o,a),i.screen.draw()}get test(){return{coverage:this._grid.coverage}}};h([f()],dE.prototype,"_context",void 0),h([f()],dE.prototype,"view",void 0),dE=h([k("esri.views.3d.webgl-engine.effects.highlight.Highlight")],dE);let QH=class extends Za{constructor(){super(...arguments),this.receiveShadows=!0}};h([F()],QH.prototype,"receiveShadows",void 0);const rlt=.99999,ilt=.025;function slt(t){const e=new dr;e.include(dv,t),e.include(AN),e.include(Wo);const r=e.fragment;return r.include(zu),r.include(Nu),r.uniforms.add(new Ze("defaultDepthTex",(i,s)=>s.shadowMap.getSnapshot(u2.Default)),new Ze("highlightDepthTex",(i,s)=>s.shadowMap.getSnapshot(u2.Highlight)),new Ze("depthMap",(i,s)=>{var n;return(n=s.linearDepth)==null?void 0:n.colorTexture}),new Ze("highlightTexture",i=>i.highlight),new nr("uColor",i=>i.shadowColor),new Ir("nearFar",(i,s)=>s.camera.nearFar),new Ee("opacity",i=>i.shadowOpacity),new Ee("occludedOpacity",i=>i.occludedShadowOpacity),new Ee("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new Pt("lightingMainDirectionView",(i,s)=>pe(Zre,De(Zre,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new Li("inverseViewMatrix",(i,s)=>Ls(Xre,Ya(Xre,s.camera.viewMatrix,s.camera.center)))),r.constants.add("unoccludedHighlightFlag","vec4",bj),r.code.add(b`
    vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, ivec2 iuv) {
      float leftPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(-1, 0), 0), nearFar);
      float rightPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(1, 0), 0), nearFar);
      float bottomPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, -1), 0), nearFar);
      float topPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, 1), 0), nearFar);

      bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
      bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);

      vec3 fragCoordHorizontal = pickLeft
                                  ? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
                                  : vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
      vec3 fragCoordVertical = pickBottom
                                  ? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
                                  : vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);

      vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
      vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);

      vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
      // Flip normal depending on triangle winding order for consistency
      return pickLeft == pickBottom ? normal : -normal;
    }

    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${b.float(rlt)}) {
        discard;
      }

      ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
      float depth = rgba2float(texelFetch(depthMap, iuv, 0));
      // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth == 0.0) {
        discard;
      }

      float currentPixelDepth = linearDepthFromFloat(depth, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        discard;
      }

      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);

      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;

      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, iuv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${b.float(ilt)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `),e}const Xre=ge(),Zre=E(),nlt=Object.freeze(Object.defineProperty({__proto__:null,build:slt},Symbol.toStringTag,{value:"Module"}));let olt=class extends Ij{constructor(){super(...arguments),this.shadowColor=Ot(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},gwe=class ywe extends Sr{constructor(e){super(e,new QH,()=>this.destroy())}initializeProgram(e){return new vr(e.rctx,ywe.shader.get().build(this.configuration),hr)}initializePipeline(){return Et({blending:Jn(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ut,depthTest:null,depthWrite:null})}get primitiveType(){return Qt.TRIANGLE_STRIP}};gwe.shader=new _r(nlt,()=>he(()=>import("./ShadowHighlight.glsl-972240ef.js"),[],import.meta.url));const alt=.001953125,llt=4e4,clt=5e4;let Sw=class extends Iv{constructor(e){super(e),this._maxOpacity=1,this._passParameters=new olt,this._drawParameters=new oje,this._shadowDifference=.2,this._context=null,this.produces=new Map([[oe.SHADOW_HIGHLIGHT,()=>this._isVisible]])}consumes(){return Sme}initializeRenderContext(e){this._context=e,this.addHandles([ae(()=>this.view.highlightOptions.shadowOpacity,r=>{this._passParameters.shadowOpacity=r??Ove,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},Br),ae(()=>this.view.highlightOptions.shadowDifference,r=>{this._shadowDifference=r??Pve,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},Br),ae(()=>this.view.highlightOptions.shadowColor,r=>{this._passParameters.shadowColor=jC(r??Rve),this._updateMaxOpacity()},Br)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}uninitializeRenderContext(){this._context=null}enable(){this._context&&this._technique==null&&(this._technique=this._context.techniqueRepository.acquire(gwe))}renderNode(e,r,i,s){var c,u;const n=(c=i==null?void 0:i.highlight)==null?void 0:c.colorTexture;if(!(this._context&&i&&n&&this._isVisible))return;if(!((u=this._technique)!=null&&u.compiled))return void this._context.requestRender();const o=e.bindParameters;if(!o.shadowMap.enabled||!o.linearDepth)return;const a=e.rctx,l=this._technique;this._passParameters.highlight=n,this._drawParameters.origin=o.camera.center,a.bindFramebuffer(s==null?void 0:s.fbo),a.bindTechnique(l,this._passParameters,o).bindDraw(this._drawParameters,o,this._passParameters),a.screen.draw()}updateParameters(e,r){this._passParameters.opacityElevation=1-AC(llt,clt,e.relativeElevation);const i=this.viewingMode===$e.Global?pe(Jre,e.center):se(Jre,0,0,1),s=de(i,r);this._passParameters.dayNightTerminator=AC(0,1,me(30*s,0,1)),this._isVisible&&this.enable()}get _isVisible(){const{opacityElevation:e,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*e*r>=alt}};h([f()],Sw.prototype,"_context",void 0),h([f()],Sw.prototype,"view",void 0),h([f()],Sw.prototype,"viewingMode",void 0),Sw=h([k("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],Sw);const Jre=E(),Gb={maxSearchSteps:8,maxDistanceAreaTex:16};function ult(){const t=new dr;return t.include(Wo),t.fragment.uniforms.add(new Ze("edgesTexture",e=>e.inputTexture)),t.fragment.uniforms.add(new Ze("areaTexture",e=>e.areaTexture)),t.fragment.uniforms.add(new Ze("searchTexture",e=>e.searchTexture)),t.fragment.code.add(b`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
        return texture(tex, coord + offset.x * resolution, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.int(Gb.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.int(Gb.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.int(Gb.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.int(Gb.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${b.int(Gb.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        vec2 size = vec2(textureSize(edgesTexture, 0));
        vec2 resolution = 1.0 / size;
        vec2 pixelCoord = uv * size;
        vec4 offsets[2];
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${b.int(Gb.maxSearchSteps)} );

        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
          d.y = coords.x;
          d = d * size.x - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
          d.y = coords.y;
          d = d * size.y - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `),t}const hlt=Object.freeze(Object.defineProperty({__proto__:null,build:ult},Symbol.toStringTag,{value:"Module"}));let _we=class vwe extends Sr{initializeProgram(e){return new vr(e.rctx,vwe.shader.get().build(),hr)}initializePipeline(){return Et({colorWrite:Ut})}};_we.shader=new _r(hlt,()=>he(()=>import("./BlendWeights.glsl-72f11b10.js"),[],import.meta.url));function dlt(){const t=new dr;return t.include(Wo),t.fragment.uniforms.add(new Ze("blendWeightsTexture",e=>e.inputTexture),new Ze("colorTexture",e=>e.color)),t.fragment.code.add(b`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const plt=Object.freeze(Object.defineProperty({__proto__:null,build:dlt},Symbol.toStringTag,{value:"Module"}));let bwe=class wwe extends Sr{initializeProgram(e){return new vr(e.rctx,wwe.shader.get().build(),hr)}initializePipeline(){return Et({colorWrite:Ut})}};bwe.shader=new _r(plt,()=>he(()=>import("./Blur.glsl-49f73770.js"),[],import.meta.url));const Qre={threshold:.05,localConstrastAdaption:2};function flt(){const t=new dr;return t.include(Wo),t.fragment.uniforms.add(new Ze("colorTexture",e=>e.color)),t.outputs.add("fragEdges","vec2"),t.fragment.code.add(b`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${b.float(Qre.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${b.float(Qre.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `),t}const mlt=Object.freeze(Object.defineProperty({__proto__:null,build:flt},Symbol.toStringTag,{value:"Module"}));let xwe=class Twe extends Sr{initializeProgram(e){return new vr(e.rctx,Twe.shader.get().build(),hr)}initializePipeline(){return Et({colorWrite:Ut})}};xwe.shader=new _r(mlt,()=>he(()=>import("./EdgeDetect.glsl-eacd2859.js"),[],import.meta.url));let glt=class extends Vr{},Y_=class extends Iv{constructor(e){super(e),this._context=null,this._areaTexture=null,this._searchTexture=null,this._isEnabled=!1,this._smaaParameters=new glt,this.produces=new Map([[oe.ANTIALIASING,()=>this._isEnabled&&this._context!=null]])}consumes(){return Tme}get updating(){return this._abortController!=null}initializeRenderContext(e){this._context=e,this.addHandles([ae(()=>this.view.qualitySettings.antialiasingEnabled,r=>{var i;return r||(i=this._context)!=null&&i.isFeatureEnabled($s.Antialiasing)?this.enable():this.disable()},Br)])}renderFeatureChanged(){var e;this.view.qualitySettings.antialiasingEnabled||(e=this._context)!=null&&e.isFeatureEnabled($s.Antialiasing)?this.enable():this.disable()}uninitializeRenderContext(){this.disable(),this._context=null}enable(){if(this._isEnabled||!this._context||this._abortController)return;if(this._edgeTechnique==null&&(this._edgeTechnique=this._context.techniqueRepository.acquire(xwe)),this._blendTechnique==null&&(this._blendTechnique=this._context.techniqueRepository.acquire(_we)),this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(bwe)),this._areaTexture&&this._searchTexture)return void(this._isEnabled=!0);this._abortController=new AbortController;const e=this._abortController.signal;he(()=>import("./SMAAData-660b7d34.js"),[],import.meta.url).then(r=>this._loadTextures(this._context,r,e)).then(()=>{var r;(r=this._context)==null||r.requestRender(),this._abortController=null}).catch(r=>{Os(r)||this._disposeTextures()})}_loadTextures(e,r,i){return wt(i),e?Promise.all([Cm(r.areaTexture).then(s=>Kre(e.fbos.rctx,Dt.LINEAR,ut.RGB,s)),Cm(r.searchTexure).then(s=>Kre(e.fbos.rctx,Dt.NEAREST,ut.LUMINANCE,s))]).then(([s,n])=>{Ys(i)?(s.dispose(),n.dispose(),wt(i)):(this._areaTexture=s,this._searchTexture=n,this._isEnabled=!0)}):Promise.reject()}_disposeTextures(){this._areaTexture=Ke(this._areaTexture),this._searchTexture=Ke(this._searchTexture)}disable(){this._abortController=Ml(this._abortController),this._isEnabled=!1}destroy(){this.disable(),this._disposeTextures()}renderNode(e,r,i,s){var p,g,y,_;const n=(p=i==null?void 0:i.composite)==null?void 0:p.colorTexture;if(!(this._isEnabled&&this._context&&i&&n))return s;if(!((g=this._edgeTechnique)!=null&&g.compiled&&((y=this._blendTechnique)!=null&&y.compiled)&&((_=this._blurTechnique)!=null&&_.compiled)))return this._context.requestRender(),s;const o=n.descriptor.width,a=n.descriptor.height,l=this._context.fbos,c=e.rctx;c.setViewport(0,0,o,a);const u=l.acquire(cr.RG,o,a);c.bindFramebuffer(u.fbo),c.setClearColor(0,0,0,1),c.clear(ii.COLOR_BUFFER_BIT),this._smaaParameters.color=n,c.bindTechnique(this._edgeTechnique,this._smaaParameters),c.screen.draw();const d=l.acquire(cr.RGBA,o,a);return c.bindFramebuffer(d.fbo),c.setClearColor(0,0,1,1),c.clear(ii.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=u.colorTexture,this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,c.bindTechnique(this._blendTechnique,this._smaaParameters),c.screen.draw(),c.bindFramebuffer(s==null?void 0:s.fbo),u.release(),c.setClearColor(0,1,0,1),c.clear(ii.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=d.colorTexture,c.bindTechnique(this._blurTechnique,this._smaaParameters),c.screen.draw(),d.release(),s}};function Kre(t,e,r,i){const s=new Or;return s.pixelFormat=r,s.wrapMode=Ft.CLAMP_TO_EDGE,s.width=i.width,s.height=i.height,s.samplingMode=e,new Rt(t,s,i)}h([f()],Y_.prototype,"view",void 0),h([f()],Y_.prototype,"_context",void 0),h([f()],Y_.prototype,"_abortController",void 0),h([f({readOnly:!0})],Y_.prototype,"updating",null),Y_=h([k("esri.views.3d.webgl-engine.effects.smaa.SMAA")],Y_);let ylt=class{constructor(){this._step=rie,this._dilation=1,this._firstIdleTime=0}frame(e,r){if(r?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,te("disable-feature:high-quality-idle"))this._dilation=1;else{const s=r?performance.now()-this._firstIdleTime:0;if(s>=eie+vlt)return this._step=1/0,void(this._dilation=1);this._dilation=s>=eie?blt:1}const i=me(e/_lt,rie,xlt);this._step===1/0?this._step=i:this._step=this._step*tie+i*(1-tie)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const _lt=.5,eie=12e4,vlt=1e4,blt=10,tie=.9,wlt=30,rie=1e3/1,xlt=1e3/wlt;let Tlt=class{constructor(e,r){this._fbos=e,this.compositingHelper=r,this._width=4,this._height=4}dispose(){this._color=Zt(this._color),this.releaseBuffers()}get framebuffer(){return this.color.detachDepth(),this.color.attachDepth(this.depth),this.color.fbo}get colorTexture(){return this.color.colorTexture}get depthTexture(){return this.depth.attachment}initializeFrame(e,r,i){this._fbos.interactive=!i;const s=this._fbos.rctx;this._width=e.fullWidth,this._height=e.fullHeight,_1(this,s.parameters.maxTextureSize);const n=this._color;return this._color=null,this.releaseBuffers(),this.bindFbo(),s.setClearStencil(0),s.setClearColor(r[0],r[1],r[2],r[3]),s.clearSafe(ii.COLOR_BUFFER_BIT|ii.DEPTH_BUFFER_BIT|ii.STENCIL_BUFFER_BIT),n}releaseBuffers(){var e;(e=this._color)==null||e.detachDepth(),this._depth=Zt(this._depth)}renderHUDVisibility(e,r,i){return(e==null?void 0:e.fbo.width)===this._width&&(e==null?void 0:e.fbo.height)===this._height||(e==null||e.release(),e=this._fbos.acquire(cr.RGBA4,this._width,this._height)),e.attachDepth(i||this.depth),this._fbos.rctx.bindFramebuffer(e.fbo),this.renderToFBO(r,Slt),e.detachDepth(),e}compositeToHUDVisibility(e,r){var i;this._fbos.rctx.bindFramebuffer((i=e.hudVisibility)==null?void 0:i.fbo),this.compositingHelper.compositeHUD(e,r)}renderOITPass(e,r,i){let s,n;switch(r){case Qe.Color:s=this._fbos.acquire(cr.RGBA16F,this._width,this._height),n=[0,0,0,0];break;case Qe.Alpha:s=this._fbos.acquire(cr.R16F,this._width,this._height),n=[1,1,1,1];break;case Qe.FrontFace:s=this._fbos.acquire(cr.RGBA,this._width,this._height),n=[0,0,0,0]}return i?(s.acquireDepth(Hs.DEPTH16_BUFFER),this._fbos.rctx.bindFramebuffer(s.fbo),this.renderToFBO(e,n,!0,!0),s.releaseDepth()):(s.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(s.fbo),this.renderToFBO(e,n),s.detachDepth()),s}compositeToFramebuffer(e,r,i,s){this.bindFbo(),this.compositingHelper.composite(e,r,i,s)}compositeTransparentOntoOpaque(e,r,i,s,n){n?(this._fbos.rctx.bindFramebuffer(n.fbo),this._fbos.rctx.setClearColor(0,0,0,1e-13),this._fbos.rctx.clearSafe(ii.COLOR_BUFFER_BIT)):this.bindFbo(),this.compositingHelper.compositeOIT(e,r.colorTexture,i.colorTexture,s.colorTexture)}renderDepthDetached(e){this._bindTarget(this.color),e(),this._bindTarget(this.color,this.depth)}renderToCachedFBO(e,r,i,s=cr.RGBA,n=Hs.DEPTH16_BUFFER,o=this._width,a=this._height,l=null){return(e==null?void 0:e.fbo.width)===o&&(e==null?void 0:e.fbo.height)===a||(e=Zt(e)),e=e??this._fbos.acquire(s,o,a),n!=null&&e.acquireDepth(n),l==null||l.forEach(c=>{e.acquireColor(c.format,c.attachment)}),this._fbos.rctx.bindFramebuffer(e.fbo),this.renderToFBO(r,i,!0,!0),e}renderToFBO(e,r,i=!1,s=!1){const n=this._fbos.rctx;let o=0;if(r){const l=Math.max(1e-13,r[3]);n.setClearColor(r[0],r[1],r[2],l),o|=ii.COLOR_BUFFER_BIT}i&&(o|=ii.DEPTH_BUFFER_BIT),s===!1?s=0:(s===!0&&(s=255),o|=ii.STENCIL_BUFFER_BIT),o&&n.clearSafe(o,s),e(),n.gl.flush()}renderToTargets(e,r,i,s,n=!1,o=!1){this._bindTarget(r,i),this.renderToFBO(e,s,n,o),r.detachDepth()}bindFbo(){this._bindTarget(this.color,this.depth)}_bindTarget(e,r){e.detachDepth(),e.attachDepth(r),this._fbos.rctx.bindFramebuffer(e.fbo)}get width(){return this._width}get height(){return this._height}get color(){return this._color||(this._color=this._fbos.acquire(cr.RGBA,this._width,this._height)),this._color}get depth(){return this._depth||(this._depth=this._fbos.acquireDepth(Hs.DEPTH_STENCIL_TEXTURE,this._width,this._height)),this._depth}};const Slt=[0,1,0,1],YN=255,Elt=1/YN;function Clt(t){const e=new dr,r=e.fragment;return r.include(zu),r.include(Nu),e.include(AN),e.include(Wo),e.include(RN,t),r.uniforms.add(new Ze("depthMap",(i,s)=>{var n;return(n=s.linearDepth)==null?void 0:n.colorTexture}),new Li("inverseViewMatrix",(i,s)=>Ls(iie,Ya(iie,s.camera.viewMatrix,s.camera.center))),new Ir("nearFar",(i,s)=>s.camera.nearFar)),r.constants.add("sampleValue","float",Elt),e.outputs.add("sampleCount","float"),r.code.add(b`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMapTex, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`),e}const iie=ge(),Alt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:YN,build:Clt},Symbol.toStringTag,{value:"Module"}));var g2;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(g2||(g2={}));let Oz=class extends Za{constructor(){super(...arguments),this.visualization=g2.Gradient,this.bandsEnabled=!1}};h([F({count:g2.COUNT})],Oz.prototype,"visualization",void 0),h([F()],Oz.prototype,"bandsEnabled",void 0);let Swe=class extends Vr{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=V3(Rlt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const Rlt=Ot(.01,0,.25,1);function Olt(t){const e=new dr,r=e.fragment;r.include(zu),r.include(Nu),e.include(AN),e.include(Wo);const{visualization:i,bandsEnabled:s}=t;r.constants.add("inverseSampleValue","float",YN),r.uniforms.add(new Ze("shadowCastMap",a=>a.shadowCastMap),new Ee("sampleScale",a=>a.sampleScale),new Ee("opacityFromElevation",a=>a.opacityFromElevation),new nr("uColor",a=>a.color));const n=i===g2.Gradient,o=i===g2.Threshold;return n&&s?r.uniforms.add(new Ee("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new Ee("threshold",a=>a.threshold)),r.code.add(b`
      void main(void) {
        float record = texture(shadowCastMap, uv).r;
        float pixelSamples = record * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?b`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?b`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?b`* strength`:""});
      }
    `),e}const Plt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:Swe,build:Olt},Symbol.toStringTag,{value:"Module"}));let Ewe=class Cwe extends Sr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new vr(e.rctx,Cwe.shader.get().build(this.configuration),hr)}initializePipeline(){return Et({blending:Ac,colorWrite:Ut,depthTest:null,depthWrite:null})}get primitiveType(){return Qt.TRIANGLE_STRIP}};Ewe.shader=new _r(Plt,()=>he(()=>import("./ShadowCastVisualize.glsl-2d755ffd.js"),[],import.meta.url));const Mlt=4e4,$lt=5e4,Awe=1/512;let KM=class extends xe{constructor(e,r,i,s){super({}),this._techniqueRepository=e,this._rctx=r,this._data=i,this._requestRender=s,this._passParameters=new Swe(this._data),this._techniqueConfig=new Oz,this._enabled=!1,this._vao=ef(r)}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Ke(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(Ewe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const r=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(r,this._passParameters,e),this._rctx.drawArrays(r.primitiveType,0,nm(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>Awe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const r=this._passParameters.color;tx(e,r)||(Fh(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};h([f()],KM.prototype,"opacityFromElevation",null),KM=h([k("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],KM);let Rwe=class Owe extends Sr{constructor(e){super(e,new QH,()=>this.destroy())}initializeProgram(e){return new vr(e.rctx,Owe.shader.get().build(this.configuration),hr)}initializePipeline(){return Et({blending:Jn(ve.ONE,ve.ONE,ve.ONE,ve.ONE),colorWrite:Ut,depthTest:null,depthWrite:null})}get primitiveType(){return Qt.TRIANGLE_STRIP}};Rwe.shader=new _r(Alt,()=>he(()=>import("./ShadowCastAccumulate.glsl-b55432ae.js"),[],import.meta.url));let Da=class extends xe{constructor(e,r,i,s,n,o){super({}),this.fbos=e,this._stage=i,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new Ij,this._cachedLightDirections=[],this._depthRange=wz,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new QD(new eH(e,i.viewingMode),null),this._bindParameters.shadowMap.enabled=!0,this._vao=ef(this._rctx),this._accumulationRenderer=new KM(r,this._rctx,this,o);const a=this._stage.view.resourceController.scheduler;this.addHandles([a.registerTask(ct.SHADOW_ACCUMULATOR,this),ae(()=>i.renderView,l=>{this.removeHandles(sie),l!=null&&this.addHandles(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),sie)},Br),ae(()=>this._previewing,()=>this._requestRenderIfEnabled(),Fr)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=Ke(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Ke(this._fbo),this._vao=Ke(this._vao),this._accumulationTechniqueCached=Zt(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new Rwe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){var e;return((e=this._bindParameters.linearDepth)==null?void 0:e.colorTexture)!==null&&this._depthRange!==wz&&this._opacityFromElevation>Awe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const r=this._cachedLightDirections;if(pm(r,e,Y1))return;const i=Math.min(YN,e.length);r.length=i,this._sampleCount=i;for(let s=0;s<i;++s)r[s]=ie(r[s]??E(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,r,i,s){if(this._depthRange=r,this._updateCamera(i),this._bindParameters.contentCamera=s,this._bindParameters.linearDepth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(Ilt,this._sampleCount-this._progress);for(let o=0;o<n;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const r=this._fbo!=null;e.enabled!==r&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,r){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||r<0||r>=this._fbo.height?0:(this._fbo.readPixels(e,r,1,1,ut.RED,en.UNSIGNED_BYTE,nie),nie[0]/this._progress)}_enable(){this._progress=0;const e=new Or;e.pixelFormat=ut.RED,e.internalFormat=Ve.R8,e.wrapMode=Ft.CLAMP_TO_EDGE,this._fbo=new dd(this._rctx,e)}_disable(){this._fbo=Ke(this._fbo)}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(ii.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,nm(this._vao,"geometry"))}_updateCamera(e){!e.equals(this._bindParameters.camera)&&this._fbo&&(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-AC(Mlt,$lt,e.relativeElevation))}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};h([f()],Da.prototype,"_progress",void 0),h([f()],Da.prototype,"_sampleCount",void 0),h([f()],Da.prototype,"_fbo",void 0),h([f()],Da.prototype,"_depthRange",void 0),h([f()],Da.prototype,"_previewing",void 0),h([f()],Da.prototype,"_accumulationRenderer",void 0),h([f()],Da.prototype,"_isRefining",null),h([f()],Da.prototype,"_isActive",null),h([f()],Da.prototype,"canAccumulate",null),h([f()],Da.prototype,"_isDoneAccumulating",null),h([f()],Da.prototype,"_opacityFromElevation",null),h([f()],Da.prototype,"running",null),Da=h([k("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Da);const Ilt=6,sie="renderView",nie=new Uint8Array(1),oie=$m();let Llt=class{constructor(){this._plane=$m()}get isEnabled(){return!xhe(this.plane,oie)}get plane(){return this._plane}set plane(e){Av(e||oie,this._plane)}};function Dlt(t,e){const r=-t[0],i=-t[1],s=-t[2],n=e[3],o=e[7],a=e[11],l=e[15];e[0]+=n*r,e[1]+=n*i,e[2]+=n*s,e[4]+=o*r,e[5]+=o*i,e[6]+=o*s,e[8]+=a*r,e[9]+=a*i,e[10]+=a*s,e[12]+=l*r,e[13]+=l*i,e[14]+=l*s}function Nlt(t,e){const r=t[0],i=t[1],s=t[2];e[12]+=r*e[0]+i*e[4]+s*e[8],e[13]+=r*e[1]+i*e[5]+s*e[9],e[14]+=r*e[2]+i*e[6]+s*e[10],e[14]+=r*e[3]+i*e[7]+s*e[11]}let Flt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const r=this._originData.get(e.id)||new Ult(e);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(r=>{Ss(r.viewMatrix,e),Nlt(r.origin.vec3,r.viewMatrix)})}},Ult=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=ge()}},klt=class extends jfe{constructor(e,r){super(),this.distanceFalloffFactor=e,this.transparency=r,this.transformNormalViewFromGlobal=Fi()}},Blt=class extends Hfe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Fi(),this.slicePlaneLocalOrigin=E(),this.transformNormalGlobalFromModel=Fi()}};function zlt(t){const e=b`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const Vlt=tr(.5,-4e-4);function Glt(t,e){const r=t.vertex;r.include(zlt),r.constants.add("depthBias","vec2",Vlt),r.uniforms.add(new Ir("inverseViewport",(i,s)=>s.inverseViewport)),e.legacy?(r.uniforms.add(new Li("proj",(i,s)=>s.camera.projectionMatrix)),r.code.add(b`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new fd("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal),new Li("transformProjFromView",i=>i.transformProjFromView)),r.code.add(b`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(b`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function jlt(t,e){const r=t.fragment;r.constants.add("coverageTestThreshold","float",.01),e.antialiasing?r.code.add(b`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(b`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function Hlt(t,e){const r=t.vertex;e.silhouette?(r.code.add(b`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function qlt(t,e){const r=t.vertex;r.include(zu),r.uniforms.add(new Ee("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(b`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(new xu("componentDataTex",i=>i.componentDataTexture)),t.attributes.add(R.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*qH),r.code.add(b`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),e.legacy?r.code.add(b`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new qC("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(b`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(R.NORMALA,"vec3"),t.attributes.add(R.NORMALB,"vec3"),r.code.add(b`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(R.NORMAL,"vec3"),r.code.add(b`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?r.code.add(b`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(PG,e),r.uniforms.add(new fd("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new qC("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Cc("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new Cc("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Pt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new Pt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)),r.code.add(b`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?b`normalize(transformWorldFromModelTL + rotatedModelPosition);`:b`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new Li("transformProjFromView",(i,s)=>s.camera.projectionMatrix)),r.code.add(b`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(b`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function Wlt(t){return t.mode===Js.SKETCH||t.mode===Js.MIXED}var Js,d1;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(Js||(Js={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(d1||(d1={}));function KH(t,e){const r=t.vertex;switch(t.attributes.add(R.SIDENESS,"vec2"),e.mode===Js.MIXED?r.code.add(b`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(b`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case Js.MIXED:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Js.SKETCH:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Js.SOLID:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Js.COUNT:break;default:e.mode}}function Ylt(t,e){const r=t.vertex;switch(t.include(KH,e),e.mode){case Js.SOLID:r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Js.SKETCH:r.uniforms.add(new L1("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Js.MIXED:r.uniforms.add(new L1("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function Xlt(t,e){t.include(KH,e);const{vertex:r,fragment:i}=t;switch(Wlt(e)&&(r.uniforms.add(new xu("strokesTexture",s=>s.strokesTexture.texture)),r.uniforms.add(new L1("strokesLog2Resolution",s=>Math.log2(s.strokesTexture.resolution)),new L1("strokeVariants",s=>s.strokesTexture.variants)),t.varyings.add("vStrokeUV","vec2"),i.uniforms.add(new xu("strokesTexture",s=>s.strokesTexture.texture),new L1("strokesNormalizationScale",s=>s.strokesTexture.normalizationScale)),r.code.add(b`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),t.fragment.include(zu),i.code.add(b`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case Js.SOLID:r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(b`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Js.SKETCH:r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(b`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Js.MIXED:t.varyings.add("vType","float"),r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(b`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function Zlt(t){const e=new dr,{vertex:r,fragment:i}=e;return t.legacy&&r.uniforms.add(new aie("model"),new aie("localView")),e.include(Glt,t),e.include(qlt,t),e.include(Ylt,t),e.include(KH,t),e.include(Xlt,t),e.include(us,t),e.include(Hlt,t),e.include(jlt,t),e.include(Nl,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),t.multipassEnabled&&e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add(new Ir("pixelToNDC",(s,n)=>ir(Jlt,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new nr("viewport",(s,n)=>n.camera.fullViewport),new Ee("pixelRatio",(s,n)=>n.camera.pixelRatio)),e.attributes.add(R.POSITION0,"vec3"),e.attributes.add(R.POSITION1,"vec3"),e.attributes.add(R.VARIANTOFFSET,"float"),e.attributes.add(R.VARIANTSTROKE,"float"),e.attributes.add(R.VARIANTEXTENSION,"float"),r.code.add(b`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      ${t.multipassEnabled?"vViewPos = viewPos;":""}

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?b`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:b`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===Js.SKETCH?b`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===Js.MIXED?b`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),i.code.add(b`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.multipassEnabled?"terrainDepthTest(vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const Jlt=ke();let aie=class extends qi{constructor(e){super(e,"mat4")}};const Qlt=Object.freeze(Object.defineProperty({__proto__:null,build:Zlt},Symbol.toStringTag,{value:"Module"}));let Pwe=class Mwe extends Sr{initializeProgram(e){return new vr(e.rctx,Mwe.shader.get().build(this.configuration),Xbe)}initializePipeline(e){return e.blendMinMax?Et({blending:Jn(ve.ONE,ve.ONE,ve.ZERO,ve.ONE,zp.ADD,e.blendMinMax.MAX),depthTest:{func:Ar.LEQUAL},colorWrite:Ut}):Et({depthTest:{func:Ar.LEQUAL},depthWrite:Xa,colorWrite:Ut})}};Pwe.shader=new _r(Qlt,()=>he(()=>import("./EdgeShader.glsl-9983eea7.js"),[],import.meta.url));let bh=class extends ga{constructor(){super(...arguments),this.mode=Js.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.spherical=!1}};h([F({count:Js.COUNT})],bh.prototype,"mode",void 0),h([F()],bh.prototype,"hasSlicePlane",void 0),h([F()],bh.prototype,"silhouette",void 0),h([F()],bh.prototype,"legacy",void 0),h([F()],bh.prototype,"antialiasing",void 0),h([F()],bh.prototype,"doublePrecisionRequiresObfuscation",void 0),h([F()],bh.prototype,"multipassEnabled",void 0),h([F()],bh.prototype,"cullAboveGround",void 0),h([F()],bh.prototype,"spherical",void 0),h([F({constValue:!1})],bh.prototype,"occlusionPass",void 0);const Klt=8,E6=128,ect={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},tct={solid:Js.SOLID,sketch:Js.SKETCH,uber:Js.MIXED};let C6=class $we{constructor(e,r,i){this._rctx=e,this._shaderTechniqueRepository=r,this._configuration=new bh,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[zt.TRANSPARENT]:{[zt.TRANSPARENT]:new It,[zt.OPAQUE]:new It},[zt.OPAQUE]:{[zt.TRANSPARENT]:new It,[zt.OPAQUE]:new It}},this._renderablesDirty=!1,this._drawParameters=new Blt,this._settings={...ect,...i},this.key=$we.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:Zr.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=tct[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=i.spherical}dispose(){this._technique=Zt(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,r){this._renderablesDirty&&this._sortRenderables();const i=this._sortedRenderables[r];i[zt.TRANSPARENT].forAll(e),i[zt.OPAQUE].forAll(e)}updateTechnique(e,r){return this._configuration.multipassEnabled=!!e.multipassEnabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(Pwe,this._configuration,this._technique),this._technique}bindRegularEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),e,r)}bindSilhouetteEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),e,r)}renderRegularEdges(e,r,i,s,n){this._render(e,r,r.regular.vao,i,s,n)}renderSilhouetteEdges(e,r,i,s,n){this._render(e,r,r.silhouette.vao,i,s,n)}_render(e,r,i,s,n,o){o>0&&(this._bindDraw(e,r,s,n),this._rctx.bindVAO(i),this._rctx.drawArraysInstanced(Qt.TRIANGLE_FAN,0,4,o))}_bindDraw(e,r,i,s){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),e.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const n=new WN(r.transform.position),o=Lu(lie,Ov(lie,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=s.camera.viewInverseTransposeMatrix;se(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,s,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[zt.TRANSPARENT][zt.TRANSPARENT].clear(),this._sortedRenderables[zt.TRANSPARENT][zt.OPAQUE].clear(),this._sortedRenderables[zt.OPAQUE][zt.TRANSPARENT].clear(),this._sortedRenderables[zt.OPAQUE][zt.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==zt.INVISIBLE&&r.edgeTransparency!==zt.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const e=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[zt.TRANSPARENT][zt.TRANSPARENT].sort(e),this._sortedRenderables[zt.TRANSPARENT][zt.OPAQUE].sort(e),this._sortedRenderables[zt.OPAQUE][zt.TRANSPARENT].sort(e),this._sortedRenderables[zt.OPAQUE][zt.OPAQUE].sort(e)}static getKey(e,r,i){return`edges-t:${e}:${r}:${i}`}};const lie=zo();function qRt(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:new OUe(t.layout)}}function cP(t){return new ame(t.layout).createView(t.buffer)}let rct=class extends Bve{constructor(e){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},e)}async process(e,r,i){if(i)return cat(e);const s=await this.invoke(new A6(e),r);return this._unpackOutput(s)}async extractEdgeLocations(e,r){const i=await this.invokeMethod("extractEdgeLocations",new A6(e),r);return cP(i)}async extractComponentsEdgeLocations(e,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new A6(e),r);return cP(i)}_unpackOutput(e){return{regular:{instancesData:cP(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:cP(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},A6=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=Cu(e.indices)?e.indices:e.indices.buffer,this.indicesType=Cu(e.indices)?"Array":$L(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function ict(t){const r=qT.resolution,i=r/2,s=new Uint8Array(4*r*r),n=4*r*i,o=qT.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,u=qT.strokes.length;let d=(c-1)*u*l;for(const{distance:g,pressure:y}of qT.strokes){let _=g,v=y,w=d;for(let x=0;x<c;x++){x!==0&&(_=cie(_,m3.DISTANCE),v=cie(v,m3.PRESSURE));for(let T=0;T<qT.resolution;T++){const S=.5+(_?_[T%_.length]/a:0),C=v?v[T%v.length]:1;o3(S,s,w),o3(C,s,w+n),w+=4}w-=l*(u+1)}d+=l}const p=new Rt(t,new Or(r),s);return new nct(r,a,o,u,p)}function cie(t,e){if(!t)return null;const r=t.length/2,i=sct*r,s=new Array(r);let n=0;const o=e===m3.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;s[n++]=o?Math.min(i,1-(1-l)*uie):Math.min(i,l*uie)}return s}var m3;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(m3||(m3={}));const sct=.1,uie=.5;let nct=class{constructor(e,r,i,s,n){this.resolution=e,this.normalizationScale=r,this.amplitude=i,this.variants=s,this.texture=n}dispose(){this.texture=Ke(this.texture)}};const qT={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function hie(t){let e=null;for(const r of t){const i=r.type;if(oct(r)){if(e==null)e=i;else if(e!==i)return"uber"}}return e??"uber"}function die(t){let e=zt.INVISIBLE;for(const{material:r}of t)if(Iwe(r)){if(r.color[3]*r.opacity<1)return zt.TRANSPARENT;e=zt.OPAQUE}return e}function pie(t){let e=zt.INVISIBLE;for(const{material:r}of t)if(Iwe(r)){switch(r.objectTransparency){case zt.TRANSPARENT:case zt.INVISIBLE:return zt.TRANSPARENT;case zt.OPAQUE:if(r.opacity<1)return zt.TRANSPARENT}e=zt.OPAQUE}return e}function Iwe(t){return t.size*t.color[3]*t.opacity>0}function oct(t){return t.size*t.color[3]>0}function fie(t,e,r,i){for(let s=0;s<t.length;s++){const n=t[s].index,o=e[s],a=e[s+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,n)}else for(let l=o;l<a;l++)r.set(l,n)}}let wh=class extends xe{constructor(t){super(t),this._updatingHandles=new Yh,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=E(),this._localOrigins=new Flt(new Kj(t.renderSR))}initialize(){this._worker=new rct(this.schedule),this._componentColorManager=new Qbe(this.rctx,3);const t=Ybe.createBuffer(4);for(let e=0;e<4;e++)t.sideness.set(e,0,e===0||e===3?0:1),t.sideness.set(e,1,e===0||e===1?0:1);this._verticesBufferObject=Cr.createVertex(this.rctx,yr.STATIC_DRAW,t.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(t=>this._discardObjectEntry(t)),this._perObjectData.clear(),this._strokesTexture=Ke(this._strokesTexture),this._componentColorManager=Oe(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=Ke(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",hct))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(t,e,r,i,s,n,o,a){if(this.hasObject(t))return this.getObjectMemoryUsage(t);let l;const c=new gie(new Promise(d=>l=d),r.center,r.radius);this._perObjectData.set(t,c);const u=await this._updatingHandles.addPromise(this._addComponentGeometry(e,c,i,s,n,o,a));return this.setNeedsRender(),l(),u}async addOrUpdateObject3D(t,e,r,i){if(this.destroyed)return void ne.getLogger(this).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(t);let n;(s==null?void 0:s.renderables.length)>0&&this._perObjectDataEvictionCache.add(s);const o=t.boundingVolumeWorldSpace.bounds,a=new gie(new Promise(c=>n=c),o,im(o));this._perObjectData.set(t,a);const l=new Array;if(r.mergeGeometries&&t.geometries.length>1&&act(t))l.push(this._addObjectMergedGeometries(t,a,e,r,i));else for(let c=0;c<t.geometries.length;c++){const u=t.geometries[c];u.material.supportsEdges&&l.push(this._addGeometry(t,a,u,e[0],r,i))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}fastUpdateObject3DEdgesTransform(t){if(this.destroyed)return!1;const e=this._perObjectData.get(t);if(!e)return!1;const{geometries:r}=t,{renderables:i}=e;if(r.length===0||i.length===0)return!0;if(i.length>1)return!1;const[s]=i,n=s.transform;if(!(n instanceof R6))return!1;const[o]=r;if(o.localOrigin!==n.origin.origin)return!1;const a=ge(),l=this._computeModelTransformWithLocalOrigin(t,o,a);return s.transform=new R6(a,l),this.setNeedsRender(),!0}_discardObjectEntry(t){t&&(t.renderables.length&&(t.renderables.forEach(e=>this._removeRenderable(e)),this.setNeedsRender()),t.loaded=null)}hasObject(t){return this._perObjectData.has(t)}async updateAllComponentOpacities(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));if(r==null)return;const i=e instanceof Array?s=>e[s]:()=>e;r.renderables.forEach(s=>{const n=s.components.meta.length;for(let o=0;o<n;o++){const a=i(o),l=s.components.meta[o],c=l.index;l.material.opacity=a,s.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(t){const e=await this._getObjectEntry(t);return e!=null?e.renderables.reduce((r,i)=>r+i.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(t,e,r,i){const s=t instanceof zm,n=!!r.hasSlicePlane,o=hie(e),a=C6.getKey(o,n,s),l=await this._updatingHandles.addPromise(this._getObjectEntry(t));l!=null&&(l.renderables.forEach(c=>{if(a!==c.rendererKey){const u=this._renderers.get(c.rendererKey),d=this._acquireRenderer(o,n,s);u.removeRenderable(c),--u.refCount,c.rendererKey=a,d.addRenderable(c)}for(let u=0;u<e.length;u++)c.components.meta[u].material=e[u];i&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));r!=null&&(r.renderables.forEach(i=>{const s=i.components.meta;for(let n=0;n<s.length;n++)i.components.meta[n].verticalOffset=(e==null?void 0:e[n])??0;this._updateComponentBuffer(i.components)}),this.setNeedsRender())}async updateObjectVisibility(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));r!=null&&(r.renderables.forEach(i=>i.visible=e),this.setNeedsRender())}removeObject(t){const e=this._perObjectData.get(t);e&&(this._perObjectData.delete(t),this._discardObjectEntry(e))}async _getObjectEntry(t){const e=this._perObjectData.get(t);if(!e)throw new Error("no object");return await e.loaded,e.loaded==null?null:e}render(t,e){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(t.camera.viewMatrix);const r=t.camera.viewInverseTransposeMatrix,i=E(),s=new WN;let n=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)return this._renderers.delete(l.key),void l.dispose();let c=!0,u=!0;l.forEachRenderable(d=>{d.visible&&(n+=d.statistics.averageEdgeLength,o++,c&&d.regular&&(l.updateTechnique(t,!1),c=!1),u&&d.silhouette&&(l.updateTechnique(t,!0),u=!1))},e)}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new klt(40*n/o,e);se(i,r[3],r[7],r[11]),s.set(i),ie(a.transformWorldFromViewTH,s.high),ie(a.transformWorldFromViewTL,s.low),Iu(a.transformViewFromCameraRelativeRS,t.camera.viewMatrix),Lu(bie,a.transformViewFromCameraRelativeRS),Ov(a.transformNormalViewFromGlobal,bie),a.transformProjFromView=t.camera.projectionMatrix,this._updateObjectCameraDistances(t),this._renderers.forEach(l=>{this._renderRegularEdges(l,t,a),this._renderSilhouetteEdges(l,t,a)})}_updateTransparency(t){const e=die(t.components.meta),r=pie(t.components.meta);e===t.edgeTransparency&&r===t.objectTransparency||(t.edgeTransparency=e,t.objectTransparency=r,this._renderers.get(t.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(t,e,r){t.getCombinedShaderTransformation(e,r);const i=e.localOrigin!=null?this._localOrigins.register(e.localOrigin):this._localOrigins.acquire(se(this._tmpModelPosition,r[12],r[13],r[14]));return e.localOrigin=i.origin,Dlt(i.origin.vec3,r),i}_updateComponentBuffer(t){const{meta:e,buffer:r}=t,i=new Uint8Array(4);for(let s=0;s<e.length;s++){const n=e[s].material,o=e[s].index,a=me(Math.round(n.size*Klt),0,255),l=me(n.extensionLength,-E6,255-E6)+E6,c=n.type==="solid"?yL.SOLID:yL.SKETCH,u=255*n.opacity,d=n.color,p=255*d[0],g=255*d[1],y=255*d[2],_=255*d[3];r.textureBuffer.setData(o,0,p,g,y,_),r.textureBuffer.setData(o,1,a,l,c,u),jbe(e[s].verticalOffset,i),r.textureBuffer.setData(o,2,i[0],i[1],i[2],i[3])}}_createComponentBuffers(t){if(this._componentColorManager==null)return null;const e=new Array,r=this._componentColorManager.getBuffer(t.length);for(let s=0;s<t.length;s++){const n=t[s],o=r.acquireIndex();e.push({index:o,verticalOffset:0,material:n})}const i=new lct(r,e);return this._updateComponentBuffer(i),i}_extractEdges(t,e,r,i,s,n=s.length){return this._worker.process({data:e,indices:s,indicesLength:n,writerSettings:t,skipDeduplicate:r},this._workerAbort.signal,i)}_createRenderable(t,e,r,i,s){const n=c=>this._verticesBufferObject!=null?new cct(new pd(this.rctx,Xbe,{vertices:Qot,instances:c===d1.REGULAR?mL.glLayout:gL.glLayout},{vertices:this._verticesBufferObject,instances:Cr.createVertex(this.rctx,yr.STATIC_DRAW,c===d1.REGULAR?t.regular.instancesData.buffer:t.silhouette.instancesData.buffer)}),c===d1.REGULAR?t.regular.lodInfo:t.silhouette.lodInfo):null,o=t.regular.lodInfo.lengths.length>0?n(d1.REGULAR):null,a=t.silhouette.lodInfo.lengths.length>0?n(d1.SILHOUETTE):null,l=((o==null?void 0:o.vao.usedMemory)??0)+((a==null?void 0:a.vao.usedMemory)??0);return new uct(o,a,{gpuMemoryUsage:l,externalMemoryUsage:s,averageEdgeLength:t.averageEdgeLength},r,die(e.meta),pie(e.meta),e,i)}async _addGeometry(t,e,r,i,s,n){if(r.edgeIndicesLength<=0)return;const o=r.attributes.get(R.POSITION),a=ge(),l=this._computeModelTransformWithLocalOrigin(t,r,a),c=new vie(o,a,l);return this._addPositionData(e,c,r.edgeIndicesLength,i,s,n)}async _addPositionData(t,e,r,i,s,n=!1){if(t.loaded==null)return;const o=this._createComponentBuffers([i]);if(o==null)return;const a=this._acquireRenderer(i.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=e,u=e.position.indices,d=e.position,p=d.data.length/d.size,g=pL.createBuffer(p);for(let v=0;v<p;v++)g.position.set(v,0,d.data[v*d.size]),g.position.set(v,1,d.data[v*d.size+1]),g.position.set(v,2,d.data[v*d.size+2]);fie(o.meta,[0,g.componentIndex.count],g.componentIndex);const y=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,g,!1,n,u,r));if(t.loaded==null)return;const _=this._createRenderable(y,o,new R6(l,c),a.key,!1);t.renderables.push(_),a.addRenderable(_),this._gpuMemoryUsage+=_.statistics.gpuMemoryUsage}async _addComponentGeometry(t,e,r,i,s,n,o){if(e.loaded==null)return 0;const a=this._createComponentBuffers(n);if(a==null)return 0;const l=hie(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),u=pL.createBuffer(r.length/3);fA(u.position.typedBuffer,r,u.position.typedBufferStride,3),fie(a.meta,s,u.componentIndex,i);const d=!0,p=c.writerSettings,g=await this._updatingHandles.addPromise(this._extractEdges(p,u,d,!1,i));if(e.loaded==null)return 0;const y=this._createRenderable(g,a,t,c.key,!0);return e.renderables.push(y),c.addRenderable(y),y.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(t,e,r,i,s){const n=new Map;let o=0,a=null,l=0;const c=t.geometries.filter(x=>{if(x.edgeIndicesLength<=0||!x.material.supportsEdges)return!1;!a&&x.localOrigin&&(a=x);const T=x.attributes.get(R.POSITION);return l+=T.data.length/T.size,o+=x.edgeIndicesLength,!0});if(c.length===0)return;const u=l>=65536?Uint32Array:Uint16Array,d=o?new u(o):null,p=[];let g=0;c.forEach(x=>{const T=x.attributes.get(R.POSITION),S=T.indices;let C=n.get(T.data);if(C==null){C=p.length/3;for(let A=0;A<T.data.length;A+=T.size)p.push(T.data[A]),p.push(T.data[A+1]),p.push(T.data[A+2]);n.set(T.data,C)}for(let A=0;A<x.edgeIndicesLength;A++)d[g++]=C+S[A]});const y=a||t.geometries[0],_=ge(),v=this._computeModelTransformWithLocalOrigin(t,y,_);for(let x=0;x<t.geometries.length;x++)t.geometries[x].localOrigin=v.origin;const w=new vie(new Ue(p,d,3),_,v);await this._updatingHandles.addPromise(this._addPositionData(e,w,d.length,r[0],i,s))}_acquireRenderer(t,e,r){const i=C6.getKey(t,e,r);let s=this._renderers.get(i);return this._strokesTexture==null&&(this._strokesTexture=ict(this.rctx)),s||(s=new C6(this.rctx,this.techniqueRepository,{type:t,hasSlicePlane:e,strokesTexture:this._strokesTexture,legacy:r,spherical:this.viewingMode===$e.Global}),this._renderers.set(i,s)),++s.refCount,s}_removeRenderable(t){mie(t.regular),mie(t.silhouette);const e=this._renderers.get(t.rendererKey);if(e){e.removeRenderable(t),--e.refCount,"origin"in t.transform&&this._localOrigins.release(t.transform.origin),this._gpuMemoryUsage-=t.statistics.externalMemoryUsage?0:t.statistics.gpuMemoryUsage;for(const r of t.components.meta)t.components.buffer.releaseIndex(r.index)}}_updateObjectCameraDistances(t){const e=t.camera.eye,r=t.camera.viewForward,i=E(),s=n=>{Rn(i,n.center,e);const o=de(i,r),a=n.radius,l=o<-a?1/0:o<a?0:o-a;n.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(t,e,r){const i=t.bindRegularEdges(r,e),s=r.transparency,n=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!yie(o)||!o.visible)return;const a=uP(o.regular.lod.lengths,o.distanceToCamera,n);t.renderRegularEdges(i,o,r,e,a)},s)}_renderSilhouetteEdges(t,e,r){const i=t.bindSilhouetteEdges(r,e),s=r.transparency,n=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!_ie(o)||!o.visible)return;const a=uP(o.silhouette.lod.lengths,o.distanceToCamera,n);t.renderSilhouetteEdges(i,o,r,e,a)},s)}get test(){return{hasRenderedPrimitives:t=>{let e=!1;const r=t.perScreenPixelRatio,i=(s,n)=>s.forEachRenderable(o=>{o.visible&&!e&&(yie(o)&&(e=uP(o.regular.lod.lengths,o.distanceToCamera,r)>0),!e&&_ie(o)&&(e=uP(o.silhouette.lod.lengths,o.distanceToCamera,r)>0))},n);return this._renderers.forEach(s=>{e||(i(s,zt.OPAQUE),i(s,zt.TRANSPARENT))}),e},getObjectData:t=>this._perObjectData.get(t)}}};function mie(t){t!=null&&(t.vao.vertexBuffers.instances.dispose(),t.vao.disposeVAOOnly(),t.vao=null)}function act(t){let e=null,r=null;for(let i=0;i<t.geometries.length;i++){const s=t.geometries[i];if(s.material.supportsEdges){if(e){if(!pm(e,s.transformation))return!1}else e=s.transformation;if(r||s.localOrigin==null){if((r==null?void 0:r.localOrigin)!=null&&s.localOrigin!=null&&r.localOrigin.id!==s.localOrigin.id)return!1}else r=s}}return!0}h([f({constructOnly:!0})],wh.prototype,"rctx",void 0),h([f({constructOnly:!0})],wh.prototype,"renderSR",void 0),h([f({constructOnly:!0})],wh.prototype,"viewingMode",void 0),h([f({constructOnly:!0})],wh.prototype,"techniqueRepository",void 0),h([f({constructOnly:!0})],wh.prototype,"setNeedsRender",void 0),h([f({constructOnly:!0})],wh.prototype,"schedule",void 0),h([f({readOnly:!0})],wh.prototype,"_updatingHandles",void 0),h([f({readOnly:!0})],wh.prototype,"updating",null),wh=h([k("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],wh);class gie{constructor(e,r,i){this.center=r,this.radius=i,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}class lct{constructor(e,r){this.buffer=e,this.meta=r}}class cct{constructor(e,r){this.vao=e,this.lod=r}}let R6=class{constructor(e,r){this.modelMatrix=e,this.origin=r}};class uct{constructor(e,r,i,s,n,o,a,l){this.regular=e,this.silhouette=r,this.statistics=i,this.transform=s,this.edgeTransparency=n,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}}function yie(t){return t.regular!=null}function _ie(t){return t.silhouette!=null}function uP(t,e,r){const i=e*r,s=jxe(t,i,!0);return s===-1?i<t[0]?t.length:0:t.length-s}class vie{constructor(e,r,i){this.position=e,this.modelTransform=r,this.origin=i}}const bie=Fi(),hct=()=>Promise.reject();function md(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let wie=class{constructor(e,r,i,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=r,this.resultAvailable=i,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},Uf=!1;function dct(t,e){if(e.disjointTimerQuery)return null;let r=t.getExtension("EXT_disjoint_timer_query_webgl2");return r&&md(t)?new wie(()=>t.createQuery(),i=>{t.deleteQuery(i),Uf=!1},i=>t.getQueryParameter(i,t.QUERY_RESULT_AVAILABLE),i=>t.getQueryParameter(i,t.QUERY_RESULT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{Uf||(Uf=!0,t.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{t.endQuery(r.TIME_ELAPSED_EXT),Uf=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>t.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=t.getExtension("EXT_disjoint_timer_query"),r?new wie(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),Uf=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{Uf||(Uf=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),Uf=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function pct(t,e){const r=t.capabilities.disjointTimerQuery;return r==null?null:new fct(r,e)}let fct=class{constructor(e,r){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(i,null)})}start(){Uf||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(e);if(r==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,i}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var gi;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINES="laser lines",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(gi||(gi={}));const xie="Total";let mct=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new Zf(xie),this._cpuTimeSamplers=new Map(Object.values(gi).map(r=>[r,new Zf(r)])),this._enableGPUTimer=0,this._totalGPUTime=new Zf("GPU"),this._gpuTimeSamplers=new Map(Object.values(gi).map(r=>[r,new Zf(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const r=[...Object.values(gi),xie];this._gpuTimerPool=pct(this._rctx,r)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=Ke(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&this._gpuTimerPool.start()}advance(e){const r=performance.now();if(this._cpuTimeSamplers.get(e).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,this._gpuTimerPool){const i=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(i),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const r=this._gpuTimerPool.stop(gi.FINISH);this._gpuTimeSamplers.get(gi.FINISH).record(r),this._rctx.gl.flush()}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}},Jl=class extends xe{get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(t=null,e=!te("disable-feature:high-quality-idle")){this._renderStateFeatures=M5(e,t),this.notifyChange("_renderStateFeatures"),this._renderPlugins.renderFeatureChanged(),this._requestRender()}isFeatureEnabled(t,e=this._state){return this._renderStateFeatures.get(e,t)??!1}setFeatureEnabled(t,e,r){this._renderStateFeatures.set(e,t,r),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled($s.HighQualityTransparency)}get hasReflections(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled($s.WaterReflection))}get hasDecorations(){return this._materialRenderersHas.decorations||this._renderPlugins.hasDecorations}get hasHighlights(){return this._materialRenderersHas.highlights||this._renderPlugins.produces(oe.OPAQUE_MATERIAL,L.Highlight)||this._renderPlugins.produces(oe.DRAPED_MATERIAL,L.Highlight)}get hasShadowHighlights(){return this._materialRenderersHas.highlights||this._renderPlugins.produces(oe.OPAQUE_MATERIAL,L.ShadowHighlight)}get _magnifierEnabled(){return this._bindParameters.decorations===Al.ON&&this._magnifierHelper.enabled}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled($s.HighResolutionAtmosphere)}get hasWater(){return this._materialRenderersHas.water||this._hasOverlayWater}constructor(t,e,r,i,s,n,o,a){super({}),this._stage=t,this._techniqueRepository=i,this._rctx=s,this._compositingHelper=n,this._magnifierHelper=o,this._requestRender=a,this._materialRenderers=new It,this._needsTransparentPass=!1,this._materialRenderersHas={hudElements:!1,highlights:!1,water:!1,decorations:!1,occludees:!1},this._hasOverlayWater=!1,this.renderOverlay=l=>{},this._isRendering=!1,this._backgroundColor=Ot(0,0,0,1),this._sliceHelper=new Llt,this._state=xr.IDLE,this._highQualityTransparencyEnabled=!0,this._terrainTransparency=ha.Opaque,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new ylt,this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new Wat,this._releaseGeometryLinearDepth=l=>l==null?void 0:l.release(),this._geometryLinearDepthFormat=Hs.DEPTH16_BUFFER,this.fboCache=new Q6e(s),this._renderStateFeatures=M5(!te("disable-feature:high-quality-idle"),t.view.qualityProfile),this._offscreen=new Tlt(this.fboCache,this._compositingHelper),this.performanceInfo=new mct(this._rctx),this._shadowMap=new eH(this.fboCache,t.viewingMode),this._highlight=new dE({view:t.view}),this._shadowHighlight=new Sw({view:t.view,viewingMode:t.viewingMode}),this._shadowAccumulator=new Da(this.fboCache,i,t,l=>{const c=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(l.camera,l.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=c},(l,c,u)=>{l.shadowMap.start(l.camera,c,u,!0,this._stage.view.qualitySettings.maximumPixelRatio),this._renderShadowCascades(L.Shadow,l.shadowMap),l.shadowMap.finish(),l.camera.setGLViewport(this._rctx),this._prepare(l.camera,l.contentCamera)},a),this._ssao=new YS({view:this._stage.view}),this._renderContext=new VWe(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper),this._renderPlugins=new QM({renderContext:this._renderContext,techniqueRepository:i,textureRepository:r,materialRepository:e,requestRender:a,controller:t,fbos:this.fboCache,isFeatureEnabled:l=>this.isFeatureEnabled(l)}),this.renderPassManager=new Rz,this._renderPlugins.add(this.renderPassManager),this._smaa=new Y_({view:this._stage.view}),this._renderPlugins.add(this._smaa),this._blit=new Tw({opacity:1,alphaMode:Mo.None}),this._renderPlugins.add(this._blit),this._renderPlugins.add(this._ssao),this._renderPlugins.add(this._highlight),this._renderPlugins.add(this._shadowHighlight),this.addHandles([ae(()=>this._stage.view.state.camera,()=>a(),Br),ae(()=>Zr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,l=>{this._renderHiddenTransparentEdges=l?()=>this._renderEdges(zt.TRANSPARENT):()=>{},a()},zr),ae(()=>{var l;return(l=this._stage.view.environment.background)==null?void 0:l.color},l=>{const c=l?jC(l):Ec;Si(this._backgroundColor,c[0]*c[3],c[1]*c[3],c[2]*c[3],c[3]),a()},Br)])}normalizeCtorArgs(){return{}}destroy(){this._smaa.destroy(),this._blit.destroy(),this._gpuTimerHandle=di(this._gpuTimerHandle),this._materialRenderers.forAll(t=>t.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._shadowMap.dispose(),this._ssao.destroy(),this._highlight.dispose(),this._shadowHighlight.destroy(),this._shadowAccumulator.dispose(),this._edgeView=Oe(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),pme.prune()}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=Zt(this._bindParameters.ssr.lastFrameColor),this._bindParameters.multipassTerrain.linearDepth=Zt(this._bindParameters.multipassTerrain.linearDepth),this._bindParameters.multipassGeometry.linearDepth=Zt(this._bindParameters.multipassGeometry.linearDepth)}_disposeOffscreenBuffers(){this._offscreen.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._bindParameters.linearDepth=Zt(this._bindParameters.linearDepth),this._bindParameters.hudVisibility=Zt(this._bindParameters.hudVisibility)}get updating(){return this._smaa.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const t=this._stage.view.resourceController;this._edgeView=new wh({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:gct(t)}),this.addHandles(ae(()=>{var e;return(e=this._edgeView)==null?void 0:e.updating},()=>this._requestRender(),Fr)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return rD(this._bindParameters.ssr.reprojectionMatrix,$i)}set _reprojectionMatrix(t){Nz(this._bindParameters.ssr.reprojectionMatrix,t)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var t;return!!((t=this._shadowMap)!=null&&t.enabled)}setParameters(t){var i;const{_shadowMap:e,_bindParameters:r}=this;if(((i=t.qualitySettings)==null?void 0:i.reflections)!==void 0&&this._ssrEnabled!==t.qualitySettings.reflections&&(this._ssrEnabled=t.qualitySettings.reflections,this._requestRender()),t.shadowMap!==void 0&&this._shadowMap.enabled!==t.shadowMap&&(this._shadowMap.enabled=t.shadowMap,this._requestRender()),t.shadowMapMaxCascades!==void 0&&e.maxCascades!==t.shadowMapMaxCascades&&(e.maxCascades=t.shadowMapMaxCascades,this._requestRender()),t.environment!=null){t.environment.weather!=null&&(this._bindParameters.weather=t.environment.weather,this._bindParameters.weatherVisible=!!t.weatherVisible);const s=t.environment.lighting.type!=="virtual";r.enableFillLights!==s&&(r.enableFillLights=s,this._requestRender())}t.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==t.highQualityTransparency&&(this._highQualityTransparencyEnabled=t.highQualityTransparency,this._requestRender()),t.hasOverlayWater!==void 0&&this._hasOverlayWater!==t.hasOverlayWater&&(this._hasOverlayWater=t.hasOverlayWater,this._requestRender()),t.slicePlane!==void 0&&this._sliceHelper.plane!==t.slicePlane&&(this._sliceHelper.plane=t.slicePlane,this._requestRender()),t.terrainTransparency!==void 0&&this._terrainTransparency!==t.terrainTransparency&&(this._terrainTransparency=t.terrainTransparency,this._requestRender()),t.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(t.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(t,e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:i,updates:s}=t;if(r.length===0&&i.length===0&&s.length===0)return;const n=R_e(t);let o=!1;n.forEach((a,l)=>{if(e.done)return;let c=this._materialRenderers.find(u=>u.material===l);if(c==null&&a.adds.length>0){const u=new eC({material:l});u.initializeRenderContext(this._renderPlugins._context),c=u,this._materialRenderers.push(c)}c&&(c.modify(a),c.isEmpty&&(o=!0)),a.removes.forEach(u=>t.removes.removeUnordered(u)),a.adds.forEach(u=>t.adds.removeUnordered(u)),a.updates.forEach(u=>t.updates.removeUnordered(u)),e.madeProgress()}),o&&this._materialRenderers.filterInPlace(a=>!a.isEmpty||(a.dispose(),!1)),this._updateHasFlags(),this._requestRender()}_updateHasFlags(){const t=this._materialRenderersHas;t.decorations=!1,t.highlights=!1,t.hudElements=!1,t.water=!1,t.occludees=!1,this._materialRenderers.forAll(e=>{t.highlights||(t.highlights=e.hasHighlights),t.occludees||(t.occludees=e.hasOccludees),t.water||(t.water=e.hasWater),t.decorations||(t.decorations=e.isDecoration),t.hudElements||(t.hudElements=e.material.produces(oe.LINE_CALLOUTS_HUD_DEPTH,L.Color)||e.material.produces(oe.HUD_MATERIAL,L.Color)||e.material.produces(oe.LABEL_MATERIAL,L.Color))}),this._bindParameters.hasOccludees=t.occludees}updateAnimation(t){const e=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(r=>this._hasAnimations=r.updateAnimation(t)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(t)||this._hasAnimations,this._hasAnimations!==e&&(this._gpuTimerHandle=e?di(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(t,e,r,i,s){const n=t!=null;this._isRendering=!0,this.performanceInfo.startFrame(),this.fboCache.frame(),this._disposeBindBuffers();const o=this._offscreen,{camera:a,contentCamera:l,mode:c,alignPixelEnabled:u}=r;this._state=c,this._bindParameters.overlay=this.renderOverlay(s),this.performanceInfo.advance(gi.OVERLAY),this._renderContext.time=s,this._bindParameters.transparencyPassType=Qe.NONE,this._bindParameters.alignPixelEnabled=u,this._bindParameters.decorations=i;const d=$m(this._sliceHelper.plane);i===Al.OFF&&(this._sliceHelper.plane=null),a.setGLViewport(this._rctx);const p=o.initializeFrame(a,this._backgroundColor,n);this.hasReflections?this._bindParameters.ssr.lastFrameColor=p:p==null||p.release(),this._prepare(a,l),this._renderPlugins.prepareRender(),this.performanceInfo.advance(gi.PREPARE);const g=this._computeDepthRange(a);this._renderShadowMap(a,this._bindParameters.lighting.mainLight.direction,g),this.performanceInfo.advance(gi.SHADOW_MAP),this._ensureBindParameters(a,l);const y=this._renderPlugins.produces(oe.OPAQUE_TERRAIN)&&(this._terrainTransparency===ha.Semitransparent||this._terrainTransparency===ha.TransparentWithDraped),_=this._highQualityTransparency&&y,v=this._needsTransparentPass||this._renderPlugins.produces(oe.TRANSPARENT_MATERIAL);this._prepareShaders(_,v),this._renderLinearDepth(),this.performanceInfo.advance(gi.LINEAR_DEPTH),this._renderShadowAccumulation(g,a,l),this.performanceInfo.advance(gi.ACCUMULATED_SHADOWS),this._ensureBindParametersSSR(s),this._renderSSAO(),this.performanceInfo.advance(gi.SSAO),this._renderContext.output=L.Color,o.bindFbo(),this._renderOpaqueGeometry(),this._renderPlugins.render(oe.ENVIRONMENT_OPAQUE),this.performanceInfo.advance(gi.OPAQUE),this._renderTerrainLinearDepth(_),this._setMultipassTerrain(_),this._renderEdges(zt.OPAQUE),this.performanceInfo.advance(gi.OPAQUE_EDGES),o.bindFbo(),this._renderPlugins.render(oe.VOXEL),this.performanceInfo.advance(gi.VOXEL),this._renderHiddenTransparentEdges(),v&&(this._oitEnabled?this._renderOITPass(Xw.Geometry):this._renderTransparentMaterial()),this.performanceInfo.advance(gi.TRANSPARENT);const w=this._renderGeometryLinearDepth(_);this._renderHUDVisibility(w),_||this._renderInternalSlot(oe.LINE_CALLOUTS),this.performanceInfo.advance(gi.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(e),this.performanceInfo.advance(gi.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(zt.TRANSPARENT,w),this._releaseGeometryLinearDepth(w),this.performanceInfo.advance(gi.TRANSPARENT_EDGES);const x=y?this._renderTransparentTerrain():null;x&&this._bindParameters.hudVisibility&&(_?this._renderLineCallouts(fl.Occluded):o.compositeToHUDVisibility(this._bindParameters,x.colorTexture),this._renderHUD(fl.Occluded,o.color),this.performanceInfo.advance(gi.HUD_OCCLUDED)),this.performanceInfo.advance(gi.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),x&&(o.compositeToFramebuffer(this._bindParameters,x.colorTexture,Mo.PremultipliedAlpha,1),x.release(),_&&(this._renderEdges(zt.OPAQUE),this.performanceInfo.advance(gi.OPAQUE_EDGES),v&&(this._oitEnabled?this._renderOITPass(Xw.Geometry):this._renderTransparentMaterial()),this.performanceInfo.advance(gi.TRANSPARENT),this._renderEdges(zt.TRANSPARENT),this.performanceInfo.advance(gi.TRANSPARENT_EDGES))),this._bindParameters.ssao=Zt(this._bindParameters.ssao),_&&this._renderLineCallouts(fl.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),o.bindFbo(),this._renderInternalSlot(oe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderPlugins.render(oe.ENVIRONMENT_TRANSPARENT),this.performanceInfo.advance(gi.ENVIRONMENT),this._renderLaserlines(),this.performanceInfo.advance(gi.LASER_LINES),this._renderOccluded(),this.performanceInfo.advance(gi.OCCLUDED);const T=this._magnifierEnabled&&t==null?this.fboCache.acquire(cr.RGBA,this._offscreen.width,this._offscreen.height):null,S=this._renderComposite(T??t,this._offscreen.color)??t;this.performanceInfo.advance(gi.ANTIALIASING),this._renderHUD(fl.NotOccluded,S),this.performanceInfo.advance(gi.HUD),this._renderHighlights(S,this._bindParameters),this.performanceInfo.advance(gi.HIGHLIGHTS),this._magnifierEnabled&&this._magnifierHelper.render(this._rctx,this._bindParameters),S!==t&&(this._rctx.bindFramebuffer(t==null?void 0:t.fbo),this._compositingHelper.composite(this._bindParameters,T==null?void 0:T.colorTexture,Mo.None)),T!==t&&(T==null||T.release()),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),this._offscreen.releaseBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=d,this._isRendering=!1,this.performanceInfo.finishFrame(),n&&(this._releaseFBOs(),this._disposeOffscreenBuffers())}_prepareShaders(t,e){this._renderContext.output=L.Color,this._prepareOpaqueGeometrySlots(),this._setMultipassTerrain(t),this._renderPlugins.prepare(oe.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),t||this._prepareInternalSlots(this._materialRenderers,oe.LINE_CALLOUTS),e&&this._prepareTransparencySlots(),this._prepareInternalSlots(this._materialRenderers,oe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderPlugins.prepare(oe.ENVIRONMENT_TRANSPARENT),this._renderPlugins.prepare(oe.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(t){if(t==null||!te("enable-feature:objectAndLayerId-rendering"))return;const e=this._renderContext.output;this._rctx.bindFramebuffer(t.fbo),this._offscreen.renderToFBO(()=>this._renderAllGeometry(L.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(t.fbo),this._offscreen.renderToFBO(()=>{this._bindParameters.hudRenderStyle=fl.NotOccluded,this._renderInternalSlot(oe.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=e}finish(t){this._hasAnimations||this._animationTimestep.clear();const e=this.performanceInfo.gpuSamplingEnabled,r=t===cs.BACKGROUND;if(r||e){const i=r?this.performanceInfo.elapsedTime:0,s=e?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),n=Math.max(i,s);this._animationTimestep.frame(n,r)}}readDepthPixels(t,e,r){var o;const i=(o=this._bindParameters.linearDepth)==null?void 0:o.fbo;if(i!=null&&i.colorTexture)return void i.readPixels(e[0],e[1],e[2],e[3],ut.RGBA,en.UNSIGNED_BYTE,r);const s=this.fboCache.acquire(cr.RGBA,this._offscreen.width,this._offscreen.height).acquireDepth(Hs.DEPTH16_BUFFER);this._rctx.bindFramebuffer(s.fbo),this._ensureBindParameters(t,t),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const n=ii.COLOR_BUFFER_BIT|ii.DEPTH_BUFFER_BIT|ii.STENCIL_BUFFER_BIT;this._rctx.clearSafe(n),this._renderAllGeometry(L.Depth),s.fbo.readPixels(e[0],e[1],e[2],e[3],ut.RGBA,en.UNSIGNED_BYTE,r),s.release()}readHUDVisibility(t,e,r,i,s){var n;(n=this._bindParameters.hudVisibility)==null||n.fbo.readPixels(t,e,r,i,ut.RGBA,en.UNSIGNED_BYTE,s)}readAccumulatedShadow(t){return this._shadowAccumulator.readAccumulatedShadow(t[0],t[1])}_setMultipassTerrain(t){this._setMultipassEnabled(t),this._setTerrainCulling(t)}_setMultipassEnabled(t){this._bindParameters.multipassEnabled=t}_setTerrainCulling(t){this._bindParameters.multipassTerrain.cullAboveGround=t}_renderEdges(t,e){const r=this._edgeView;if(r!=null&&r.shouldRender()){const{width:i,height:s,depth:n}=this._offscreen,o=this.fboCache.acquire(cr.RGBA,i,s),a=()=>r.render(this._bindParameters,t);this._offscreen.renderToTargets(a,o,e??n,Tie),this._offscreen.compositeToFramebuffer(this._bindParameters,o.colorTexture,Mo.Alpha,1),o.release()}}_renderShadowMap(t,e,r){const i=this._shadowMap;i.enabled&&(i.start(t,e,r,this.isFeatureEnabled($s.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(t,e),this._needsShadowHighlight?(this._renderShadowCascades(L.ShadowHighlight,this._shadowMap),i.moveSnapshot(u2.Highlight),i.clear(),this._renderShadowCascades(L.ShadowExcludeHighlight,this._shadowMap),i.copySnapshot(u2.Default),this._renderShadowCascades(L.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(L.Shadow),i.finish(),t.setGLViewport(this._rctx))}_renderShadowCascades(t,e=this._shadowMap){for(const r of e.cascades)r.camera.setGLViewport(this._rctx),this._prepare(r.camera,r.camera),this._renderAllGeometry(t)}get _needsLinearDepth(){return this._renderPlugins.consumes(L.Depth)||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?(this._bindParameters.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.linearDepth,()=>this._renderAllGeometry(L.Depth),[0,0,0,0],cr.RGBA,Hs.DEPTH_STENCIL_BUFFER),this._bindParameters.linearDepth.releaseDepth(),this._offscreen.bindFbo()):this._bindParameters.linearDepth=Zt(this._bindParameters.linearDepth)}_renderTerrainLinearDepth(t){if(t){const e=this._renderContext.output;this._renderContext.output=L.Depth,this._bindParameters.multipassTerrain.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassTerrain.linearDepth,()=>this._renderTransparentTerrain(),[-1e10,-1e10,-1e10,1]),this._bindParameters.multipassTerrain.linearDepth.releaseDepth(),this._renderContext.output=e}else this._bindParameters.multipassTerrain.linearDepth=Zt(this._bindParameters.multipassTerrain.linearDepth)}_renderGeometryLinearDepth(t){if(!t)return void(this._bindParameters.multipassGeometry.linearDepth=Zt(this._bindParameters.multipassGeometry.linearDepth));const e=this._renderContext.output;return this._bindParameters.multipassGeometry.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassGeometry.linearDepth,()=>this._renderOpaqueGeometryAndTransparentMaterial(L.Depth),[1,1,1,1],cr.RGBA,this._geometryLinearDepthFormat),this._renderContext.output=e,this._bindParameters.multipassGeometry.linearDepth.detachDepth()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(t){if(!this._needsDepthRange)return wz;const e=Pat(t,this._materialRenderers,this._stage.layers);return m2(e,this._renderPlugins.queryDepthRange(t)),e.near=Math.max(t.near,e.near),e.far=Math.min(t.far,e.far),e}_renderAllGeometry(t){this._renderContext.output=t,this._renderPlugins.prepare(oe.TRANSPARENT_TERRAIN),this._renderOpaqueGeometryAndTransparentMaterial(t),this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(t){this._renderContext.output=t,this._renderPlugins.prepare(oe.TRANSPARENT_MATERIAL),this._renderOpaqueGeometry(),this._renderTransparentMaterial()}_renderSSAO(){if(!this._renderPlugins.produces(oe.SSAO))return;const t=this._offscreen.renderToCachedFBO(null,()=>this._renderAllGeometry(L.Normal),[0,0,0,0],cr.RGBA4,Hs.DEPTH24_BUFFER);t.releaseDepth(),this._offscreen.bindFbo(),this._pluginInput.normal=t,this._bindParameters.ssao=this._renderPlugins.render(oe.SSAO,this._pluginInput),t.release()}_prepareOpaqueGeometrySlots(){this._renderPlugins.prepare(oe.INTEGRATED_MESH),this._renderPlugins.prepare(oe.OPAQUE_TERRAIN),this._renderPlugins.prepare(oe.OPAQUE_MATERIAL),this._renderPlugins.prepare(oe.ENVIRONMENT_OPAQUE),this._prepareInternalSlots(this._materialRenderers,oe.OPAQUE_MATERIAL)}_renderOpaqueGeometry(){this._renderPlugins.render(oe.INTEGRATED_MESH),this._renderPlugins.render(oe.OPAQUE_TERRAIN),this._renderInternalSlot(oe.OPAQUE_MATERIAL),this._renderPlugins.render(oe.OPAQUE_MATERIAL)}_renderTransparentMaterial(){this._renderInternalSlot(oe.TRANSPARENT_MATERIAL),this._renderPlugins.render(oe.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){if(!this._renderPlugins.produces(oe.TRANSPARENT_TERRAIN))return;const t=()=>this._renderPlugins.render(oe.TRANSPARENT_TERRAIN,null);if(this._renderContext.output!==L.Color)return void t();const{width:e,height:r,depth:i}=this._offscreen,s=this.fboCache.acquire(cr.RGBA,e,r);return this._offscreen.renderToTargets(t,s,i,[0,0,0,0]),s}_renderHUDVisibility(t){this._shouldRenderInternalSlot(this._materialRenderers,oe.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,()=>this._renderInternalSlot(oe.OCCLUSION_PIXELS),t),this._offscreen.bindFbo()):this._bindParameters.hudVisibility=Zt(this._bindParameters.hudVisibility)}_renderLineCallouts(t){if(this._bindParameters.hudRenderStyle=t,t===fl.Occluded){const e=()=>this._renderInternalSlot(oe.LINE_CALLOUTS),{width:r,height:i,color:s}=this._offscreen,n=this.fboCache.acquireDepth(Hs.DEPTH16_BUFFER,r,i);this._offscreen.renderToTargets(e,s,n,void 0,!0,!0),n.release()}else this._renderInternalSlot(oe.LINE_CALLOUTS)}_renderLaserlines(){if(this._renderPlugins.render(oe.LASERLINES),this._renderPlugins.produces(oe.LASERLINES_CONTRAST_CONTROL)){const t=this._offscreen,{width:e,height:r,depth:i}=t,s=this.fboCache.acquire(cr.RGBA,e,r),n=()=>this._renderPlugins.render(oe.LASERLINES_CONTRAST_CONTROL);t.renderToTargets(n,s,i,Tie),t.compositeToFramebuffer(this._bindParameters,s.colorTexture,Mo.PremultipliedAlpha,1),s.release()}}_renderHUD(t,e){if(this._materialRenderersHas.hudElements)if(this._oitEnabled){const r=this._renderOITPass(Xw.HUD,t);this._rctx.bindFramebuffer(e==null?void 0:e.fbo),this._compositingHelper.composite(this._bindParameters,r.colorTexture,Mo.PremultipliedAlpha),r.release()}else if(t===fl.Occluded){const r=()=>this._renderHUDElements(t),{width:i,height:s,color:n}=this._offscreen,o=this.fboCache.acquireDepth(Hs.DEPTH16_BUFFER,i,s);this._offscreen.renderToTargets(r,n,o,void 0,!0,!0),o.release()}else this._rctx.bindFramebuffer(null),e==null||e.acquireDepth(Hs.DEPTH16_BUFFER),this._rctx.bindFramebuffer(e==null?void 0:e.fbo),this._renderHUDElements(t),e==null||e.releaseDepth()}_renderHUDElements(t){this._bindParameters.hudRenderStyle=t,this._prepareInternalSlots(this._materialRenderers,oe.LINE_CALLOUTS_HUD_DEPTH,oe.HUD_MATERIAL,oe.LABEL_MATERIAL),this._renderInternalSlot(oe.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(oe.HUD_MATERIAL),this._renderInternalSlot(oe.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._renderPlugins.produces(oe.SHADOW_HIGHLIGHT)&&this.hasShadowHighlights}_renderHighlights(t,e){if(!this.hasHighlights||e.decorations===Al.OFF)return;const r=()=>{this._renderAllGeometry(L.Highlight),this._rctx.clearSafe(ii.DEPTH_BUFFER_BIT),this._renderHUDElements(fl.Both)},i=this._offscreen.renderToCachedFBO(null,r,[0,0,0,0],cr.RGBA4,Hs.DEPTH_STENCIL_BUFFER);i.releaseDepth(),this._needsShadowHighlight&&(this._pluginInput.highlight=i,this._renderPlugins.render(oe.SHADOW_HIGHLIGHT,this._pluginInput,t)),this._renderPlugins.produces(oe.HIGHLIGHT)&&(this._pluginInput.composite=null,this._pluginInput.normal=null,this._pluginInput.highlight=i,this._renderPlugins.render(oe.HIGHLIGHT,this._pluginInput,t)),i.release()}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(t,e,r){var i;this._needsShadowCast&&((i=this._bindParameters.linearDepth)!=null&&i.colorTexture)&&this._shadowAccumulator.renderAccumulation(this._bindParameters.linearDepth,t,e,r)}_prepareTransparencySlots(){this._renderContext.output=L.Alpha,this._bindParameters.transparencyPassType=Qe.Alpha,this._prepareInternalSlots(this._materialRenderers,oe.TRANSPARENT_MATERIAL),this._renderPlugins.prepare(oe.TRANSPARENT_MATERIAL),this._renderContext.output=L.Color,this._bindParameters.transparencyPassType=Qe.Color,this._prepareInternalSlots(this._materialRenderers,oe.TRANSPARENT_MATERIAL),this._renderPlugins.prepare(oe.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=Qe.FrontFace,this._prepareInternalSlots(this._materialRenderers,oe.TRANSPARENT_MATERIAL),this._renderPlugins.prepare(oe.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=Qe.NONE}_renderOITPass(t,e=fl.Both){const r=t===Xw.HUD,i=r?this.fboCache.acquire(cr.RGBA,this._offscreen.width,this._offscreen.height):null,s=r?()=>this._renderHUDElements(e):()=>this._renderTransparentMaterial(),n=this._renderContext.output;this._renderContext.output=L.Alpha,this._bindParameters.transparencyPassType=Qe.Alpha;const o=this._offscreen.renderOITPass(s,Qe.Alpha,r);this._renderContext.output=L.Color,this._bindParameters.transparencyPassType=Qe.Color;const a=this._offscreen.renderOITPass(s,Qe.Color,r);this._bindParameters.transparencyPassType=Qe.FrontFace;const l=this._offscreen.renderOITPass(s,Qe.FrontFace,r);return this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,a,o,l,i),i==null||i.releaseDepth(),l.release(),a.release(),o.release(),this._bindParameters.transparencyPassType=Qe.NONE,this._renderContext.output=n,i}_renderOccluded(){let t=0;Wl.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&n.material.parameters.renderOccluded===Ti.OccludeAndTransparentStencil&&(t|=n.material.parameters.renderOccluded,Wl.push(n))});const e=this._offscreen,r=(n,o,a,l,c)=>{if(!(t&o))return;const{width:u,height:d,depth:p}=e,g=this.fboCache.acquire(cr.RGBA,u,d);e.renderToTargets(a,g,p,[0,0,0,0],l,c),e.compositeToFramebuffer(this._bindParameters,g.colorTexture,Mo.PremultipliedAlpha,n),g.release()};Wl.length!==0&&(this._prepareInternalSlots(Wl,oe.OCCLUDER_MATERIAL,oe.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(oe.OCCLUDER_MATERIAL,Wl),r(.5,Ti.OccludeAndTransparentStencil,()=>this._renderInternalSlot(oe.TRANSPARENT_OCCLUDER_MATERIAL,Wl),!1,!1)),Wl.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&(n.material.parameters.renderOccluded===Ti.OccludeAndTransparent||n.material.parameters.renderOccluded===Ti.Transparent||n.material.parameters.renderOccluded===Ti.Opaque)&&(t|=n.material.parameters.renderOccluded,Wl.push(n))});const i=this._renderPlugins.renderOccludedFlags;if(t|=i,!t)return;const s=n=>{this._renderContext.renderOccludedMask=n,this._prepareInternalSlots(Wl,oe.OPAQUE_MATERIAL,oe.TRANSPARENT_MATERIAL,oe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),i>Ti.Occlude&&this._renderPlugins.render(oe.OCCLUDED_TERRAIN),this._renderInternalSlot(oe.OPAQUE_MATERIAL,Wl),this._renderInternalSlot(oe.TRANSPARENT_MATERIAL,Wl),this._renderInternalSlot(oe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Wl),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=L.Color,r(.5,Ti.OccludeAndTransparent,()=>s(Ti.OccludeAndTransparent),!0,Wa.OutlineVisualElementMask),r(.5,Ti.Transparent,()=>s(Ti.Transparent),!0,Wa.OutlineVisualElementMask),r(1,Ti.Opaque,()=>s(Ti.Opaque),!0,Wa.OutlineVisualElementMask),Wl.clear()}_renderComposite(t,e){this._renderPlugins.consumes(L.CompositeColor)&&(this._pluginInput.composite=e);let r=null;const i=this._renderPlugins.produces(oe.COMPOSITE);i&&(r=this._renderPlugins.renderComposition(oe.COMPOSITE,this._pluginInput),this._pluginInput.composite=r);const s=this._renderPlugins.produces(oe.ANTIALIASING),n=this._renderPlugins.render(s?oe.ANTIALIASING:oe.BLIT,this._pluginInput,t);return i&&(r==null||r.release()),n}_prepare(t,e){this._needsTransparentPass=this._materialRenderers.some(r=>r.material.produces(oe.TRANSPARENT_MATERIAL,L.Color)),this._bindParameters.camera=t,this._bindParameters.contentCamera=e}_ensureBindParameters(t,e){this._bindParameters.camera=t,this._bindParameters.contentCamera=e;const r=this._renderContext.offscreenRenderingHelper;this._bindParameters.mainColor=r.colorTexture,this._bindParameters.mainDepth=r.depthTexture}_ensureBindParametersSSR(t){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=t),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=$i:(Ls(Eie,this._bindParameters.camera.viewMatrix),Ls(Sie,this._bindParameters.camera.projectionMatrix),Pr(jb,Eie,Sie),Pr(jb,this._renderContext.lastFrameCamera.viewMatrix,jb),Pr(jb,this._renderContext.lastFrameCamera.projectionMatrix,jb),this._reprojectionMatrix=jb);const e=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=e>0?Math.min(e,t-this._ssrEnableTime)/e:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=$i,this._ssrEnableTime=null}_shouldRenderInternalSlot(t,e){return this._bindParameters.slot=e,t.some(r=>r.prepareTechnique(this._renderContext)!=null)}_prepareInternalSlots(t,...e){for(const r of e)this._bindParameters.slot=r,t.forAll(i=>i.prepareTechnique(this._renderContext)!=null)}_renderInternalSlot(t,e=this._materialRenderers){this._bindParameters.slot=t,e.forAll(r=>{const i=r.prepareTechnique(this._renderContext);i&&r.renderNode(this._renderContext,i)})}get memoryInfo(){return{fbos:this.fboCache.usedMemory,vaos:this._materialRenderers.reduce((t,e)=>t+e.usedMemory,0),plugins:this._renderPlugins.usedMemory}}getMemoryForMaterial(t){if(t==null)return 0;const e=this._materialRenderers.find(r=>r.material===t);return(e==null?void 0:e.usedMemory)??0}get usedMemory(){var t;return this.fboCache.usedMemory+(((t=this.edgeView)==null?void 0:t.usedMemory)??0)+this._renderPlugins.usedMemory}get test(){const t=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{t._renderStateFeatures=M5(),this._renderPlugins.renderFeatureChanged(),this._requestRender()},releaseGeometryLinearDepth(e){t._releaseGeometryLinearDepth=e??(r=>r==null?void 0:r.release()),t._geometryLinearDepthFormat=e?Hs.DEPTH_STENCIL_TEXTURE:Hs.DEPTH16_BUFFER},getFramebufferTexture:e=>{var r,i;switch(e){case Zw.Color:return t._offscreen.colorTexture;case Zw.LinearDepth:return(r=t._bindParameters.linearDepth)==null?void 0:r.colorTexture;case Zw.ShadowMap:return t._shadowMap.depthTexture;case Zw.HudVisibility:return(i=t._bindParameters.hudVisibility)==null?void 0:i.colorTexture}}}}};var Xw,Zw;h([f()],Jl.prototype,"_renderPlugins",void 0),h([f()],Jl.prototype,"_shadowAccumulator",void 0),h([f()],Jl.prototype,"_state",void 0),h([f()],Jl.prototype,"_renderStateFeatures",void 0),h([f({readOnly:!0})],Jl.prototype,"fullResolutionAtmosphere",null),h([f()],Jl.prototype,"_smaa",void 0),h([f()],Jl.prototype,"_blit",void 0),h([f({autoDestroy:!0})],Jl.prototype,"_edgeView",void 0),h([f()],Jl.prototype,"updating",null),h([f()],Jl.prototype,"isCameraFinal",null),Jl=h([k("esri.views.3d.webgl-engine.lib.Renderer")],Jl),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(Xw||(Xw={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.ShadowMap=2]="ShadowMap",t[t.HudVisibility=3]="HudVisibility"}(Zw||(Zw={}));const Tie=[0,0,0,0],Wl=new It,Sie=ge(),Eie=ge(),jb=ge();function gct(t){return e=>t.immediate.schedule(e)}let yct=class{constructor(e){this._rctx=e,this._vao=t8e(e)}destroy(){this._vao=Ke(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(Qt.TRIANGLES,0,3))}get test(){var e,r,i,s;return{cachedWebGLObjects:O6((e=this._vao)==null?void 0:e.glName)+O6((i=(r=this._vao)==null?void 0:r.indexBuffer)==null?void 0:i.glName)+O6((s=this._vao)==null?void 0:s.vertexBuffers.geometry)}}};function O6(t){return t!=null?1:0}let Lwe=class Dwe{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=Dwe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return Cr.createIndex(this._rctx,yr.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,yt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Qt.POINTS,1,Xe.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){var e;return{cachedWebGLObjects:(e=this._indexBuffer)!=null&&e.glName?1:0}}},Cie=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:ve.ONE,dstRGB:ve.ZERO,srcAlpha:ve.ONE,dstAlpha:ve.ZERO},this.blendEquation={mode:zp.ADD,modeAlpha:zp.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Vh.BACK,this.frontFace=Qx.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Ar.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Vh.FRONT_AND_BACK,func:Ar.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Vh.FRONT_AND_BACK,fail:Di.KEEP,zFail:Di.KEEP,zPass:Di.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},_ct=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const r=new Map;this._allocations.forEach(i=>{r.set(i,(r.get(i)??0)+1)}),r.forEach((i,s)=>{const n=s.split(`
`);n.shift(),n.shift(),e+=`${i}: ${n.shift()}
`,n.forEach(o=>e+=`   ${o}
`)})}return e}};const vct={RECORD_ALLOCATIONS:!1};let bct=class{constructor(){for(this._current=new Array,this._allocations=new _ct(vct.RECORD_ALLOCATIONS);this._current.length<bs.COUNT;)this._current.push(0)}increment(e,r,i=1){this._current[e]+=i,this._allocations.add(r)}decrement(e,r,i=1){this._current[e]-=i,this._allocations.remove(r)}get current(){return this._current}get total(){return this.current.reduce((e,r,i)=>e+(i<bs.UNCOUNTED?r:0),0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let r=0;r<bs.COUNT;++r){const i=this._current[r];i>0&&(e+=`${bs[r]}: ${i}
`)}}return e+=this._allocations.information,e}},wct=class{constructor(e,r,i){const s=r.textureFilterAnisotropic,n=i.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=s?Math.min(e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),md(e)?(this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES)):(this.maxUniformBufferBindings=0,this.maxVertexUniformBlocks=0,this.maxFragmentUniformBlocks=0,this.maxUniformBlockSize=0,this.uniformBufferOffsetAlignment=1,this.maxArrayTextureLayers=1,this.maxSamples=1)}};const xct=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var Aie,Nwe={exports:{}};(Aie=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(Nwe.exports=Aie);const Tct=Q3(Nwe.exports);var Rie,Pz={exports:{}};Pz.exports,Rie=Pz,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(Rie.exports=e)}();const Oie=Q3(Pz.exports);var Fwe={exports:{}};(function(t){(function(e){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(t.exports=r)})()})(Fwe);const Sct=Q3(Fwe.exports);var nh=999,Pie=9999,P6=0,M6=1,Mie=2,$ie=3,Iie=4,hP=5,Ect=6,Cct=7,Act=8,Lie=9,Rct=10,Die=11,Oct=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function Pct(){var t,e,r,i=0,s=0,n=nh,o=[],a=[],l=1,c=0,u=0,d=!1,p=!1,g="";return function(U){return a=[],U!==null?_(U.replace?U.replace(/\r\n/g,`
`):U):v()};function y(U){U.length&&a.push({type:Oct[n],data:U,position:u,line:l,column:c})}function _(U){var Y;for(i=0,r=(g+=U).length;t=g[i],i<r;){switch(Y=i,n){case P6:i=C();break;case M6:i=S();break;case Mie:i=T();break;case $ie:i=A();break;case Iie:i=D();break;case Die:i=$();break;case hP:i=N();break;case Pie:i=z();break;case Lie:i=x();break;case nh:i=w()}Y!==i&&(g[Y]===`
`?(c=0,++l):++c)}return s+=i,g=g.slice(i),a}function v(U){return o.length&&y(o.join("")),n=Rct,y("(eof)"),a}function w(){return o=o.length?[]:o,e==="/"&&t==="*"?(u=s+i-1,n=P6,e=t,i+1):e==="/"&&t==="/"?(u=s+i-1,n=M6,e=t,i+1):t==="#"?(n=Mie,u=s+i,i):/\s/.test(t)?(n=Lie,u=s+i,i):(d=/\d/.test(t),p=/[^\w_]/.test(t),u=s+i,n=d?Iie:p?$ie:Pie,i)}function x(){return/[^\s]/g.test(t)?(y(o.join("")),n=nh,i):(o.push(t),e=t,i+1)}function T(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,i+1):(y(o.join("")),n=nh,i)}function S(){return T()}function C(){return t==="/"&&e==="*"?(o.push(t),y(o.join("")),n=nh,i+1):(o.push(t),e=t,i+1)}function A(){if(e==="."&&/\d/.test(t))return n=hP,i;if(e==="/"&&t==="*")return n=P6,i;if(e==="/"&&t==="/")return n=M6,i;if(t==="."&&o.length){for(;O(o););return n=hP,i}if(t===";"||t===")"||t==="("){if(o.length)for(;O(o););return y(t),n=nh,i+1}var U=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||U){for(;O(o););return n=nh,i}return o.push(t),e=t,i+1}function O(U){for(var Y,H,V=0;;){if(Y=Oie.indexOf(U.slice(0,U.length+V).join("")),H=Oie[Y],Y===-1){if(V--+U.length>0)continue;H=U.slice(0,1).join("")}return y(H),u+=H.length,(o=o.slice(H.length)).length}}function $(){return/[^a-fA-F0-9]/.test(t)?(y(o.join("")),n=nh,i):(o.push(t),e=t,i+1)}function D(){return t==="."||/[eE]/.test(t)?(o.push(t),n=hP,e=t,i+1):t==="x"&&o.length===1&&o[0]==="0"?(n=Die,o.push(t),e=t,i+1):/[^\d]/.test(t)?(y(o.join("")),n=nh,i):(o.push(t),e=t,i+1)}function N(){return t==="f"&&(o.push(t),e=t,i+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,i+1):/[^\d]/.test(t)?(y(o.join("")),n=nh,i):(o.push(t),e=t,i+1)}function z(){if(/[^\d\w_]/.test(t)){var U=o.join("");return n=Tct.indexOf(U)>-1?Act:Sct.indexOf(U)>-1?Cct:Ect,y(o.join("")),n=nh,i}return o.push(t),e=t,i+1}}function Mct(t){var e=Pct(),r=[];return r=(r=r.concat(e(t))).concat(e(null))}function $ct(t){return Mct(t)}function Ict(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const $6=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function Lct(t,e="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=i.exec(s.data);if(n){const o=n[1].replaceAll(/\s\s+/g," ");if(o===r)return o;if(o===e)return s.data="#version "+r,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function Dct(t,e){for(let r=e-1;r>=0;r--){const i=t[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function pE(t,e,r,i){i=i||r;for(const s of t)if(s.type==="ident"&&s.data===r)return i in e?e[i]++:e[i]=0,pE(t,e,i+"_"+e[i],i);return r}function Uwe(t,e,r="afterVersion"){function i(l,c){for(let u=c;u<l.length;u++){const d=l[u];if(d.type==="operator"&&d.data===";")return u}return null}function s(l){let c=-1,u=0,d=-1;for(let p=0;p<l.length;p++){const g=l[p];if(g.type==="preprocessor"&&(/\#(if|ifdef|ifndef)\s+.+/.test(g.data)?++u:/\#endif\s*.*/.test(g.data)&&--u),r!=="afterVersion"&&r!=="afterPrecision"||g.type==="preprocessor"&&g.data.startsWith("#version")&&(d=Math.max(d,p)),r==="afterPrecision"&&g.type==="keyword"&&g.data==="precision"){const y=i(l,p);if(y===null)throw new Error("precision statement not followed by any semicolons!");d=Math.max(d,y)}c<d&&u===0&&(c=p)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function Nct(t,e,r,i="lowp"){Uwe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Fct(t,e,r,i,s="lowp"){Uwe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Uct(t,e){let r,i,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(r=n),o.data==="]")){i=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return r&&i&&t.splice(r,i-r+1),s}function Nie(t,e){if(t.startsWith("#version 300"))return t;const r=$ct(t);if(Lct(r,"100","300 es")==="300 es")return t;let i=null,s=null;const n={},o={};for(let a=0;a<r.length;++a){const l=r[a];switch(l.type){case"keyword":e===cc.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===cc.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===cc.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(i||(i=pE(r,n,"fragColor"),Nct(r,i,"vec4")),l.data=i),e===cc.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=Uct(r,a+1),u=pE(r,n,"fragData");Fct(r,u,"vec4",c,"mediump"),l.data=u}else e===cc.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(s||(s=pE(r,n,"gl_FragDepth")),l.data=s);break;case"ident":if(xct.includes(l.data)){if(e===cc.VERTEX_SHADER&&Dct(r,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=pE(r,n,l.data)),l.data=o[l.data]}}}for(let a=r.length-1;a>=0;--a){const l=r[a];if(l.type==="preprocessor"){const c=l.data.match(/\#extension\s+(.*)\:/);if(c&&c[1]&&$6.has(c[1].trim())){const p=r[a+1];r.splice(a,p&&p.type==="whitespace"?2:1)}const u=l.data.match(/\#ifdef\s+(.*)/);u&&u[1]&&$6.has(u[1].trim())&&(l.data="#if 1");const d=l.data.match(/\#ifndef\s+(.*)/);d&&d[1]&&$6.has(d[1].trim())&&(l.data="#if 0")}}return kct(t,Ict(r))}function kct(t,e){return e}const Bct=4294967295;let zct=class{constructor(e,r,i,s,n=new Map){this._context=e,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),this._context.type===rr.WEBGL2&&(r=Nie(r,cc.VERTEX_SHADER),i=Nie(i,cc.FRAGMENT_SHADER)),this._vShader=Fie(this._context,cc.VERTEX_SHADER,r),this._fShader=Fie(this._context,cc.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(bs.Shader,this),ok()&&(this.vertexShader=r,this.fragmentShader=i);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),ok()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===rr.WEBGL2){const l=o;for(const[c,u]of this._uniformBlockBindings){const d=l.getUniformBlockIndex(a,c);d<Bct&&l.uniformBlockBinding(a,d,u)}}this._glName=a,this._context.instanceCounter.increment(bs.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,r=this._context.instanceCounter;this._nameToUniformLocation.forEach(i=>i&&r.decrement(bs.Uniform,i)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(r.decrement(bs.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,r.decrement(bs.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,r.decrement(bs.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const r=this._nameToUniformLocation.get(e);if(r!==void 0)return r;if(this.glName){const i=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,i),i&&this._context.instanceCounter.increment(bs.Uniform,i),i}return null}hasUniform(e){return this._getUniformLocation(e)!=null}setUniform1i(e,r){const i=this._nameToUniform1.get(e);i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(e),r),this._nameToUniform1.set(e,r))}setUniform1iv(e,r){Fd(this._nameToUniform1v,e,r)&&this._context.gl.uniform1iv(this._getUniformLocation(e),r)}setUniform2iv(e,r){Fd(this._nameToUniform2,e,r)&&this._context.gl.uniform2iv(this._getUniformLocation(e),r)}setUniform3iv(e,r){Fd(this._nameToUniform3,e,r)&&this._context.gl.uniform3iv(this._getUniformLocation(e),r)}setUniform4iv(e,r){Fd(this._nameToUniform4,e,r)&&this._context.gl.uniform4iv(this._getUniformLocation(e),r)}setUniform1f(e,r){const i=this._nameToUniform1.get(e);i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(e),r),this._nameToUniform1.set(e,r))}setUniform1fv(e,r){Fd(this._nameToUniform1v,e,r)&&this._context.gl.uniform1fv(this._getUniformLocation(e),r)}setUniform2f(e,r,i){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),this._nameToUniform2.set(e,[r,i])):r===s[0]&&i===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),s[0]=r,s[1]=i)}setUniform2fv(e,r){Fd(this._nameToUniform2,e,r)&&this._context.gl.uniform2fv(this._getUniformLocation(e),r)}setUniform3f(e,r,i,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),this._nameToUniform3.set(e,[r,i,s])):r===n[0]&&i===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),n[0]=r,n[1]=i,n[2]=s)}setUniform3fv(e,r){Fd(this._nameToUniform3,e,r)&&this._context.gl.uniform3fv(this._getUniformLocation(e),r)}setUniform4f(e,r,i,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),this._nameToUniform4.set(e,[r,i,s,n])):o!==void 0&&r===o[0]&&i===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),o[0]=r,o[1]=i,o[2]=s,o[3]=n)}setUniform4fv(e,r){Fd(this._nameToUniform4,e,r)&&this._context.gl.uniform4fv(this._getUniformLocation(e),r)}setUniformMatrix3fv(e,r,i=!1){Fd(this._nameToUniformMatrix3,e,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),i,r)}setUniformMatrix4fv(e,r,i=!1){Fd(this._nameToUniformMatrix4,e,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),i,r)}stop(){}};function Fie(t,e,r){const i=t.gl,s=i.createShader(e);return i.shaderSource(s,r),i.compileShader(s),ok()&&!i.getShaderParameter(s,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===cc.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(s)),console.error(Vct(r))),s}function Vct(t){let e=2;return t.replaceAll(`
`,()=>`
`+Gct(e++)+":")}function Gct(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Fd(t,e,r){const i=t.get(e);return i?Nz(i,r):(t.set(e,Array.from(r)),!0)}let jct=class{constructor(e){this._rctx=e,this._store=new B2}dispose(){this._store.forEach(e=>e.forEach(r=>r.dispose())),this._store.clear()}acquire(e,r,i,s){const n=this._store.get(e,r);if(n!=null)return n.ref(),n;const o=new zct(this._rctx,e,r,i,s);return o.ref(),this._store.set(e,r,o),o}get test(){let e=0;return this._store.forEach(r=>r.forEach(i=>e+=i.hasGLName?2:1)),{cachedWebGLProgramObjects:e}}},gA=class{constructor(){this._result=!1}dispose(){this._program=Ke(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},Hct=class extends gA{constructor(e){super(),this._rctx=e,this._helperProgram=null,this._rctx.type===rr.WEBGL2&&te("mac")&&te("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){var e;super.dispose(),(e=this._helperProgram)==null||e.dispose(),this._helperProgram=null}_test(e){const r=this._rctx,i=r.getBoundFramebufferObject(),{x:s,y:n,width:o,height:a}=r.getViewport();r.resetState();const l=new Or(1);l.wrapMode=Ft.CLAMP_TO_EDGE,l.samplingMode=Dt.NEAREST;const c=new dd(r,l),u=Cr.createIndex(this._rctx,yr.STATIC_DRAW,new Uint8Array([0]));r.bindFramebuffer(c),r.setViewport(0,0,1,1),r.useProgram(this._helperProgram),r.bindBuffer(u,yt.ELEMENT_ARRAY_BUFFER),r.drawElements(Qt.POINTS,1,Xe.UNSIGNED_BYTE,0),r.useProgram(e),r.bindVAO(null),r.drawArrays(Qt.TRIANGLES,0,258);const d=new Uint8Array(4);return c.readPixels(0,0,1,1,ut.RGBA,en.UNSIGNED_BYTE,d),r.setViewport(s,n,o,a),r.bindFramebuffer(i),c.dispose(),u.dispose(),d[0]===255}_prepareProgram(){const r=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${b.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,i=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${b.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(r,i,new Map([]))}_prepareHelperProgram(){const e=Lwe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},qct=class extends gA{constructor(e){super(),this._rctx=e,this._program=Uie(this._rctx,!1),this._obfuscated=Uie(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=Ke(this._obfuscated)}_test(e){if(te("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const r=this._runProgram(e),i=this._runProgram(this._obfuscated);return r!==0&&(i===0||r/i>5)}_runProgram(e){const r=this._rctx;r.resetState();const i=new Or(1);i.wrapMode=Ft.CLAMP_TO_EDGE,i.samplingMode=Dt.NEAREST;const s=new dd(r,i),n=Cr.createVertex(r,yr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Fu(r,new Map([["position",0]]),{geometry:[new Zn("position",2,Xe.UNSIGNED_SHORT,0,4)]},{geometry:n}),a=Te(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Te(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);fk(a,c,3);const u=new Float32Array(6);fk(l,u,3),r.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",u[0],u[2],u[4]),e.setUniform3f("u_lowB",u[1],u[3],u[5]),r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(Qt.TRIANGLE_STRIP,0,4);const d=new Uint8Array(4);s.readPixels(0,0,1,1,ut.RGBA,en.UNSIGNED_BYTE,d),o.dispose(),s.dispose();const p=(a[2]-l[2])/25,g=Yj(d);return Math.abs(p-g)}};function Uie(t,e){const r=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,i=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(r,i,new Map([["position",0]]))}let Wct=class extends gA{constructor(e){var s,n,o,a,l;if(super(),this._rctx=e,!e.gl)return;if(e.type===rr.WEBGL1)return void(this._result=!(!((s=e.capabilities.textureFloat)!=null&&s.textureFloat)||!((n=e.capabilities.colorBufferFloat)!=null&&n.textureFloat)));if(!((o=e.capabilities.textureFloat)!=null&&o.textureFloat&&((a=e.capabilities.colorBufferFloat)!=null&&a.textureFloat)&&((l=e.capabilities.colorBufferFloat)!=null&&l.floatBlend)))return;const r=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new Or(1);i.wrapMode=Ft.CLAMP_TO_EDGE,i.dataType=en.FLOAT,i.internalFormat=Ve.RGBA32F,i.samplingMode=Dt.NEAREST;const s=new dd(r,i),n=Cr.createVertex(r,yr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Fu(r,new Map([["a_pos",0]]),{geometry:[new Zn("a_pos",2,Xe.UNSIGNED_SHORT,0,4)]},{geometry:n});r.useProgram(e);const a=r.getBoundFramebufferObject(),{x:l,y:c,width:u,height:d}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(Qt.TRIANGLE_STRIP,0,4);const p=Et({blending:t0e});r.setPipelineState(p),r.drawArrays(Qt.TRIANGLE_STRIP,0,4);const g=r.gl.getError();return r.setViewport(l,c,u,d),r.bindFramebuffer(a),o.dispose(),s.dispose(),g!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},Yct=class extends gA{constructor(e){super(),this._rctx=e;const r=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,i=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new Or(1);i.wrapMode=Ft.CLAMP_TO_EDGE,i.samplingMode=Dt.NEAREST;const s=new dd(r,i),n=new Uint8Array(4),o=Cr.createVertex(r,yr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new Fu(r,new Map([["a_position",0]]),{geometry:[new Zn("a_position",2,Xe.SHORT,0,4)]},{geometry:o});r.useProgram(e);const l=new Rt(r,i,new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),r.bindTexture(l,0);const c=r.getBoundFramebufferObject();r.bindFramebuffer(s),r.useProgram(e);const{x:u,y:d,width:p,height:g}=r.getViewport();r.setViewport(0,0,1,1),r.bindVAO(a),r.drawArrays(Qt.TRIANGLE_STRIP,0,4),r.setViewport(u,d,p,g),s.readPixels(0,0,1,1,ut.RGBA,en.UNSIGNED_BYTE,n),a.dispose(),s.dispose();const y=n[0]!==255||n[1]!==255||n[2]!==255||n[3]!==255;return y&&ne.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${n[0]}.${n[1]}.${n[2]}.${n[3]}]`),r.bindFramebuffer(c),y}};new Zn("a_pos",2,Xe.BYTE,0,2);new Zn("a_pos",2,Xe.BYTE,0,4),new Zn("a_tex",2,Xe.BYTE,2,4);const Xct={geometry:[new Zn("a_pos",2,Xe.UNSIGNED_SHORT,0,4)]};let Zct=class extends gA{constructor(e){super(),this._rctx=e;const r=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const r=this._rctx;if(!r.gl)return e.dispose(),!0;const i=new Or(1);i.wrapMode=Ft.CLAMP_TO_EDGE,i.samplingMode=Dt.NEAREST;const s=new dd(r,i),n=Cr.createVertex(r,yr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Fu(r,new Map([["a_pos",0]]),Xct,{geometry:n}),a=new Or;a.samplingMode=Dt.LINEAR,a.wrapMode=Ft.CLAMP_TO_EDGE;const l=new Rt(r,a,fE);r.useProgram(e),r.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=r.getBoundFramebufferObject(),{x:u,y:d,width:p,height:g}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.setClearColor(0,0,0,0),r.setBlendingEnabled(!1),r.clearSafe(ii.COLOR_BUFFER_BIT),r.bindVAO(o),r.drawArrays(Qt.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);return s.readPixels(0,0,1,1,ut.RGBA,en.UNSIGNED_BYTE,y),o.dispose(),s.dispose(),l.dispose(),r.setViewport(u,d,p,g),r.bindFramebuffer(c),y[0]!==255}};const fE=new Image;fE.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",fE.width=5,fE.height=5,fE.decode();let Jct=class{constructor(e){this.rctx=e,this.floatBufferBlend=new Wct(e),this.svgPremultipliesAlpha=new Zct(e),this.doublePrecisionRequiresObfuscation=new qct(e),this.ignoresSamplerPrecision=new Yct(e),this.drawArraysRequiresIndicesTypeReset=new Hct(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function Qct(t,e){if(e.disjointTimerQuery)return null;if(md(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const r=t.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function Kct(t,e){if(e.compressedTextureETC)return null;const r=t.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function eut(t,e){if(e.compressedTextureS3TC)return null;const r=t.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function tut(t,e){if(md(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const r=t.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}}function rut(t,e){if(e.textureFilterAnisotropic)return null;const r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function iut(t,e){if(md(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const r=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}function sut(t,e){if(md(t)){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),i=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),i=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}function kie(t,e,r,i,s){if(i&&md(t))return!0;if(e[r])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function nut(t,e){if(!md(t)||e.textureNorm16)return null;const r=t.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function out(t,e){const r=e.loseContext&&t.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}function aut(t,e){if(md(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const r=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}let lut=class{constructor(e,r){this._gl=e,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=Qct(this._gl,this._disabledExtensions)),this._drawBuffers}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=aut(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=Kct(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=eut(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=rut(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=dct(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=iut(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=sut(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=tut(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=kie(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get loseContext(){return this._loseContext||(this._loseContext=out(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=nut(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=kie(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},cut=class{constructor(t,e){this.gl=t,this.instanceCounter=new bct,this.programCache=new jct(this),this._state=new Cie,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=md(t)?rr.WEBGL2:rr.WEBGL1,this._loadExtensions(),this.configure(e)}get gl2(){return this.type===rr.WEBGL1?null:this.gl}configure(t){this._capabilities=new lut(this.gl,t),this._parameters=new wct(this.gl,this._capabilities,t),Rt.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const e=this.gl.getParameter(this.gl.VIEWPORT);this._state=new Cie,this._state.viewport={x:e[0],y:e[1],width:e[2],height:e[3]},this._stateTracker=new I6e({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const i=r.color;this.setBlendColor(i.r,i.g,i.b,i.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const i=r.function;this.setStencilFunction(i.func,i.ref,i.mask);const s=r.operation;this.setStencilOp(s.fail,s.zFail,s.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)},setDrawBuffers:r=>{const{drawBuffers:i}=this._capabilities;if(r)i==null||i.drawBuffers(r.buffers);else{const{drawFramebuffer:s}=this._state;s===null||s.colorAttachments.length===0?i==null||i.drawBuffers([sk.BACK]):i==null||i.drawBuffers([ka.COLOR_ATTACHMENT0])}}}),this.enforceState(),Ke(this._driverTest),this._driverTest=new Jct(this)}dispose(){Ke(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(yt.ARRAY_BUFFER),this.unbindBuffer(yt.ELEMENT_ARRAY_BUFFER),this.type===rr.WEBGL2&&(this.unbindBuffer(yt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(yt.PIXEL_PACK_BUFFER),this.unbindBuffer(yt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(yt.COPY_READ_BUFFER),this.unbindBuffer(yt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,Ah()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(t){this._stateTracker.setPipeline(t)}setBlendingEnabled(t){this._state.blend!==t&&(t===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=t,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var t;(t=this._state.program)==null||t.stop(),this._state.program=null}externalTextureUnitUpdate(t,e){for(let r=0;r<t.length;++r)this._state.textureUnitMap[t[r]]=null;e>=0&&(this._state.activeTexture=e)}externalVertexArrayObjectUpdate(){const t=this.capabilities.vao;t&&(t.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(t,e,r,i){t===this._state.blendColor.r&&e===this._state.blendColor.g&&r===this._state.blendColor.b&&i===this._state.blendColor.a||(this.gl.blendColor(t,e,r,i),this._state.blendColor.r=t,this._state.blendColor.g=e,this._state.blendColor.b=r,this._state.blendColor.a=i,this._stateTracker.invalidateBlending())}setBlendFunction(t,e){t===this._state.blendFunction.srcRGB&&e===this._state.blendFunction.dstRGB||(this.gl.blendFunc(t,e),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=e,this._state.blendFunction.dstAlpha=e,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(t,e,r,i){this._state.blendFunction.srcRGB===t&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===e&&this._state.blendFunction.dstAlpha===i||(this.gl.blendFuncSeparate(t,e,r,i),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=e,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendEquation(t){this._state.blendEquation.mode!==t&&(this.gl.blendEquation(t),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(t,e){this._state.blendEquation.mode===t&&this._state.blendEquation.modeAlpha===e||(this.gl.blendEquationSeparate(t,e),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setColorMask(t,e,r,i){this._state.colorMask.r===t&&this._state.colorMask.g===e&&this._state.colorMask.b===r&&this._state.colorMask.a===i||(this.gl.colorMask(t,e,r,i),this._state.colorMask.r=t,this._state.colorMask.g=e,this._state.colorMask.b=r,this._state.colorMask.a=i,this._stateTracker.invalidateColorWrite())}setClearColor(t,e,r,i){this._state.clearColor.r===t&&this._state.clearColor.g===e&&this._state.clearColor.b===r&&this._state.clearColor.a===i||(this.gl.clearColor(t,e,r,i),this._state.clearColor.r=t,this._state.clearColor.g=e,this._state.clearColor.b=r,this._state.clearColor.a=i)}setFaceCullingEnabled(t){this._state.faceCulling!==t&&(t===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=t,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(t){this._state.polygonOffsetFill!==t&&(t===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=t,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(t,e){this._state.polygonOffset[0]===t&&this._state.polygonOffset[1]===e||(this._state.polygonOffset[0]=t,this._state.polygonOffset[1]=e,this.gl.polygonOffset(t,e),this._stateTracker.invalidatePolygonOffset())}setCullFace(t){this._state.cullFace!==t&&(this.gl.cullFace(t),this._state.cullFace=t,this._stateTracker.invalidateCulling())}setFrontFace(t){this._state.frontFace!==t&&(this.gl.frontFace(t),this._state.frontFace=t,this._stateTracker.invalidateCulling())}setScissorTestEnabled(t){this._state.scissorTest!==t&&(t===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=t)}setScissorRect(t,e,r,i){this._state.scissorRect.x===t&&this._state.scissorRect.y===e&&this._state.scissorRect.width===r&&this._state.scissorRect.height===i||(this.gl.scissor(t,e,r,i),this._state.scissorRect.x=t,this._state.scissorRect.y=e,this._state.scissorRect.width=r,this._state.scissorRect.height=i)}setDepthTestEnabled(t){this._state.depthTest!==t&&(t===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=t,this._stateTracker.invalidateDepthTest())}setClearDepth(t){this._state.clearDepth!==t&&(this.gl.clearDepth(t),this._state.clearDepth=t)}setDepthFunction(t){this._state.depthFunction!==t&&(this.gl.depthFunc(t),this._state.depthFunction=t,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(t){this._state.depthWrite!==t&&(this.gl.depthMask(t),this._state.depthWrite=t,this._stateTracker.invalidateDepthWrite())}setDepthRange(t,e){this._state.depthRange.zNear===t&&this._state.depthRange.zFar===e||(this.gl.depthRange(t,e),this._state.depthRange.zNear=t,this._state.depthRange.zFar=e,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(t){this._state.stencilTest!==t&&(t===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=t,this._stateTracker.invalidateStencilTest())}setClearStencil(t){t!==this._state.clearStencil&&(this.gl.clearStencil(t),this._state.clearStencil=t)}setStencilFunction(t,e,r){this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===e&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(t,e,r),this._state.stencilFunction.face=Vh.FRONT_AND_BACK,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=e,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(t,e,r,i){this._state.stencilFunction.face===t&&this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFuncSeparate(t,e,r,i),this._state.stencilFunction.face=t,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(t){this._state.stencilWriteMask!==t&&(this.gl.stencilMask(t),this._state.stencilWriteMask=t,this._stateTracker.invalidateStencilWrite())}setStencilOp(t,e,r){this._state.stencilOperation.face===Vh.FRONT_AND_BACK&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===e&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(t,e,r),this._state.stencilOperation.face=Vh.FRONT_AND_BACK,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=e,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(t,e,r,i){this._state.stencilOperation.face===t&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOpSeparate(t,e,r,i),this._state.stencilOperation.face=t,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setActiveTexture(t,e=!1){const r=this._state.activeTexture;return t>=0&&(e||t!==this._state.activeTexture)&&(this.gl.activeTexture(Z4+t),this._state.activeTexture=t),r}clear(t){t&&this.gl.clear(t)}clearSafe(t,e=255){t&&(t&ii.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),t&ii.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),t&ii.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(e),this.gl.clear(t))}drawArrays(t,e,r){Ah()&&(this._numOfDrawCalls++,this._numOfTriangles+=Bie(t,r)),this.gl.drawArrays(t,e,r),fp(this.gl)}drawArraysInstanced(t,e,r,i){var s;(s=this.gl2)==null||s.drawArraysInstanced(t,e,r,i),fp(this.gl)}drawElements(t,e,r,i){if(Ah()&&(this._numOfDrawCalls++,this._numOfTriangles+=Bie(t,e)),this.gl.drawElements(t,e,r,i),Ah()){const s=k6e(this);if(s){const n=this.getBoundVAO(),o=n==null?void 0:n.indexBuffer,a=n==null?void 0:n.vertexBuffers,l={indexBuffer:o,vertexBuffers:a},c={mode:t,count:e,type:r,offset:i},u=(o==null?void 0:o.size)??0,d=i+e,p=u<d?`. Buffer is too small. Attempted to draw index ${d} of ${u}`:"";console.error(`drawElements: ${s}${p}`,{args:c,vao:l})}}}logInfo(){Ah()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){Ah()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(t,e,r,i){r=Math.max(Math.round(r),1),i=Math.max(Math.round(i),1);const s=this._state.viewport;s.x===t&&s.y===e&&s.width===r&&s.height===i||(s.x=t,s.y=e,s.width=r,s.height=i,this.gl.viewport(t,e,r,i))}setViewport4fv(t){this.setViewport(t[0],t[1],t[2],t[3])}getViewport(){const t=this._state.viewport;return{x:t.x,y:t.y,width:t.width,height:t.height}}useProgram(t){var e;this._state.program!==t&&((e=this._state.program)==null||e.stop(),this._state.program=t,this.gl.useProgram((t==null?void 0:t.glName)??null))}bindTexture(t,e,r=!1){(e>=this.parameters.maxTextureImageUnits||e<0)&&console.error("Input texture unit is out of range of available units!");const i=this._state.textureUnitMap[e];return(t==null?void 0:t.glName)==null?(i!=null&&(this.setActiveTexture(e,r),this.gl.bindTexture(i.descriptor.target,null)),this._state.textureUnitMap[e]=null,i):r||i!==t?(this.setActiveTexture(e,r),this.gl.bindTexture(t.descriptor.target,t.glName),t.applyChanges(),this._state.textureUnitMap[e]=t,i):(t.isDirty&&(this.setActiveTexture(e,r),t.applyChanges()),i)}unbindTexture(t){if(t!=null)for(let e=0;e<this.parameters.maxTextureImageUnits;e++)this._state.textureUnitMap[e]===t&&(this.bindTexture(null,e),this._state.textureUnitMap[e]=null)}bindFramebuffer(t,e=!1){if(e||this._state.readFramebuffer!==t||this._state.drawFramebuffer!==t){if(this._stateTracker.invalidateDrawBuffers(),t==null)return this.gl.bindFramebuffer(oo.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);t.initializeAndBind(oo.FRAMEBUFFER),this._state.readFramebuffer=t,this._state.drawFramebuffer=t}}bindFramebufferSeparate(t,e,r=!1){const i=e===oo.READ_FRAMEBUFFER,s=i?this._state.readFramebuffer:this._state.drawFramebuffer;(r||s!==t)&&(t==null?this.gl.bindFramebuffer(e,null):t.initializeAndBind(e),i?this._state.readFramebuffer=t??null:this._state.drawFramebuffer=t??null)}blitFramebuffer(t,e,r=0,i=0,s=t.width,n=t.height,o=0,a=0,l=e.width,c=e.height,u=ii.COLOR_BUFFER_BIT,d=Dt.NEAREST){this.bindFramebufferSeparate(t,oo.READ_FRAMEBUFFER),this.bindFramebufferSeparate(e,oo.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,i,s,n,o,a,l,c,u,d)}bindBuffer(t,e){if(t)switch(e??(e=t.bufferType),e){case yt.ARRAY_BUFFER:this._state.vertexBuffer=ol(this.gl,t,e,this._state.vertexBuffer);break;case yt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=ol(this.gl,t,e,this._state.indexBuffer);break;case yt.UNIFORM_BUFFER:this._state.uniformBuffer=ol(this.gl,t,e,this._state.uniformBuffer);break;case yt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=ol(this.gl,t,e,this._state.pixelPackBuffer);break;case yt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=ol(this.gl,t,e,this._state.pixelUnpackBuffer);break;case yt.COPY_READ_BUFFER:this._state.copyReadBuffer=ol(this.gl,t,e,this._state.copyReadBuffer);break;case yt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=ol(this.gl,t,e,this._state.copyWriteBuffer)}}bindRenderbuffer(t){const e=this.gl;t||(e.bindRenderbuffer(e.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==t&&(e.bindRenderbuffer(e.RENDERBUFFER,t.glName),this._state.renderbuffer=t)}_getBufferBinding(t,e){if(e>=this.parameters.maxUniformBufferBindings||e<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let i=r[e];return i==null&&(i={buffer:null,offset:0,size:0},r[e]=i),i}bindBufferBase(t,e,r){const i=this._getBufferBinding(t,e);i!=null&&(i.buffer===r&&i.offset===0&&i.size===0||(this.gl.bindBufferBase(t,e,r?r.glName:null),i.buffer=r,i.offset=0,i.size=0))}bindBufferRange(t,e,r,i,s){const n=this._getBufferBinding(t,e);if(n!=null&&!(n.buffer===r&&n.offset===i&&n.size===s)){if(i%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(t,e,r.glName,i,s),n.buffer=r,n.offset=i,n.size=s}}bindUBO(t,e,r,i){e!=null?(Ah()&&(i??e.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),e.initialize(),r!==void 0&&i!==void 0?this.bindBufferRange(yt.UNIFORM_BUFFER,t,e.buffer,r,i):this.bindBufferBase(yt.UNIFORM_BUFFER,t,e.buffer)):this.bindBufferBase(yt.UNIFORM_BUFFER,t,null)}unbindUBO(t){for(let e=0,r=this._state.uniformBufferBindingPoints.length;e<r;e++){const i=this._state.uniformBufferBindingPoints[e];i!=null&&i.buffer===t.buffer&&this.bindBufferBase(yt.UNIFORM_BUFFER,e,null)}}unbindBuffer(t){switch(t){case yt.ARRAY_BUFFER:this._state.vertexBuffer=ol(this.gl,null,t,this._state.vertexBuffer);break;case yt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=ol(this.gl,null,t,this._state.indexBuffer);break;case yt.UNIFORM_BUFFER:this._state.uniformBuffer=ol(this.gl,null,t,this._state.uniformBuffer);break;case yt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=ol(this.gl,null,t,this._state.pixelPackBuffer);break;case yt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=ol(this.gl,null,t,this._state.pixelUnpackBuffer);break;case yt.COPY_READ_BUFFER:this._state.copyReadBuffer=ol(this.gl,null,t,this._state.copyReadBuffer);break;case yt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=ol(this.gl,null,t,this._state.copyWriteBuffer)}}bindVAO(t=null){t!=null?this._state.vertexArrayObject!==t&&(t.bind(),this._state.vertexArrayObject=t):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}async clientWaitAsync(t=10){const e=this.gl,r=e.fenceSync(nk.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let i;this.instanceCounter.increment(bs.Sync,r),e.flush();do await _C(t),i=e.clientWaitSync(r,0,0);while(i===fI.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(bs.Sync,r),e.deleteSync(r),i===fI.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(t=oo.FRAMEBUFFER){return t===oo.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(yt.ARRAY_BUFFER),this.unbindBuffer(yt.ELEMENT_ARRAY_BUFFER),this.type===rr.WEBGL2&&(this.unbindBuffer(yt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(yt.PIXEL_PACK_BUFFER),this.unbindBuffer(yt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(yt.COPY_READ_BUFFER),this.unbindBuffer(yt.COPY_WRITE_BUFFER));for(let t=0;t<this.parameters.maxTextureImageUnits;++t)this.bindTexture(null,t);this.setBlendingEnabled(!1),this.setBlendFunction(ve.ONE,ve.ZERO),this.setBlendEquation(zp.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Vh.BACK),this.setFrontFace(Qx.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Ar.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Ar.ALWAYS,0,0),this.setStencilOp(Di.KEEP,Di.KEEP,Di.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var s,n,o;const t=this.capabilities.vao;t&&t.bindVertexArray(null);const{gl:e,gl2:r}=this;for(let a=0;a<this.parameters.maxVertexAttributes;a++)e.disableVertexAttribArray(a);if(this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(yt.ARRAY_BUFFER,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(yt.ELEMENT_ARRAY_BUFFER,null),r!=null){this._state.uniformBuffer?r.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):r.bindBuffer(yt.UNIFORM_BUFFER,null);for(let a=0;a<this._parameters.maxUniformBufferBindings;a++){const l=this._state.uniformBufferBindingPoints[a];if(l!=null){const{buffer:c,offset:u,size:d}=l;c!==null?u===0&&d===0?r.bindBufferBase(yt.UNIFORM_BUFFER,a,c.glName):r.bindBufferRange(yt.UNIFORM_BUFFER,a,c.glName,u,d):r.bindBufferBase(yt.UNIFORM_BUFFER,a,null)}}this._state.pixelPackBuffer?r.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):r.bindBuffer(yt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?r.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):r.bindBuffer(yt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?r.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):r.bindBuffer(yt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?r.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):r.bindBuffer(yt.COPY_WRITE_BUFFER,null),r.bindFramebuffer(oo.READ_FRAMEBUFFER,null),r.readBuffer(r.BACK),this._state.readFramebuffer&&(r.bindFramebuffer(oo.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),r.readBuffer(ka.COLOR_ATTACHMENT0)),r.bindFramebuffer(oo.DRAW_FRAMEBUFFER,((s=this._state.drawFramebuffer)==null?void 0:s.glName)??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,e.bindFramebuffer(oo.FRAMEBUFFER,((n=this._state.drawFramebuffer)==null?void 0:n.glName)??null);if(t&&this._state.vertexArrayObject){const a=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(a)}e.useProgram(((o=this._state.program)==null?void 0:o.glName)??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),this._state.faceCulling===!0?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let a=0;a<this.parameters.maxTextureImageUnits;a++){e.activeTexture(Z4+a),e.bindTexture(Ji.TEXTURE_2D,null),e.bindTexture(Ji.TEXTURE_CUBE_MAP,null),this.type===rr.WEBGL2&&(e.bindTexture(Ji.TEXTURE_3D,null),e.bindTexture(Ji.TEXTURE_2D_ARRAY,null));const l=this._state.textureUnitMap[a];l!=null&&e.bindTexture(l.descriptor.target,l.glName)}e.activeTexture(Z4+this._state.activeTexture);const i=this._state.viewport;e.viewport(i.x,i.y,i.width,i.height),this.resetInfo()}_loadExtensions(){this.type===rr.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}};function ol(t,e,r,i){return e?i!==e&&t.bindBuffer(r,e.glName):t.bindBuffer(r,null),e}function Bie(t,e){switch(t){case Qt.POINTS:return 2*e;case Qt.TRIANGLES:return e/3;case Qt.TRIANGLE_STRIP:case Qt.TRIANGLE_FAN:return e-2;default:return 0}}let uut=class extends cut{constructor(e,r,i){super(e,r),this.gl=e,this.newCache=i,this._appleAmdDriverHelper=null,this._refCount=1,this.screen=new yct(this)}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){var e;super.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose(),this.screen.destroy()}bindTechnique(e,r,i,s){return this.useProgram(e.program),this.setPipelineState(e.getPipeline(!!s)),e.program.bindPass(r,i),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new Lwe(this)),this._appleAmdDriverHelper.run())}get test(){var e;return{cachedWebGLObjects:this.programCache.test.cachedWebGLProgramObjects+this.screen.test.cachedWebGLObjects+(((e=this._appleAmdDriverHelper)==null?void 0:e.test.cachedWebGLObjects)??0)}}};function zie(t){return!!t.frameUpdate}let Ew=class extends xe{constructor(e,r,i){super({}),this._stage=e,this._techniqueRepository=r,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Ps,this._frameTask=e.view.resourceController.scheduler.registerTask(ct.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Ki.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(iH,new sH)),this._textureTechnique}acquire(e){const r=this._textures.get(e);return r?(r.ref(),r.loadingPromise??r):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(r=>{const i=r.texture.frameUpdate(r.previousToken);i>=0&&i!==r.previousToken&&(r.previousToken=i,e=!0)}),e&&this.events.emit("changed",cs.BACKGROUND)}_createNewRef(e){const r=this._stage.getObject(e);if(r==null)return Je(r!==void 0),null;const i=r.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),s=new hut(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&r.unload()})});return this._textures.set(e,s),s.ref(),r.glTexture?(this._updateGLTexture(s,r.glTexture),zie(r)&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=r.load(this._rctx),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),zie(r)&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,Os(l)||ne.getLogger(this).error(l),null);return Fl(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,r){e.glTexture=r,this.events.emit("changed",cs.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};h([f()],Ew.prototype,"_loadingCount",void 0),h([f()],Ew.prototype,"_frameTask",void 0),h([f()],Ew.prototype,"updating",null),Ew=h([k("esri.views.3d.webgl-engine.lib.TextureRepository")],Ew);let hut=class{constructor(e,r){this.id=e,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(ne.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function dut(t,e){return new n_e(r=>PWe(r,t),r=>r,e)}let mE=class extends xe{constructor(){super(...arguments),this._passParameters=new put,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=Ml(this._resourcesTask),this._passParameters.waveNormal=Ke(this._passParameters.waveNormal),this._passParameters.wavePerturbation=Ke(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=cy(async r=>{await Promise.allSettled([this._loadImageResource(e,ei("esri/images/materials/water/normals.jpg"),i=>this._passParameters.waveNormal=i,r),this._loadImageResource(e,ei("esri/images/materials/water/perturbation.jpg"),i=>this._passParameters.wavePerturbation=i,r)])})),this._resourcesTask.finished?Z0.LOADED:Z0.LOADING}async _loadImageResource(e,r,i,s){try{const n=await Cm(r,{signal:s});wt(s);const o=new Or(n.width,n.height);o.pixelFormat=ut.RGB,o.samplingMode=Dt.LINEAR_MIPMAP_LINEAR,o.hasMipmap=!0,o.maxAnisotropy=8,i(new Rt(e,o,n))}catch(n){ne.getLogger(this).error("Failed to load water material normal texture.",n)}}};h([f()],mE.prototype,"_resourcesTask",void 0),h([f({type:Boolean,readOnly:!0})],mE.prototype,"updating",null),mE=h([k("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],mE);let put=class extends Vr{};const Vie=2048,fut=1.5,mut=8;function gut(t,e){const{format:r,quality:i,rotation:s,disableDecorations:n}=t||{},o=eq(t,e.padding),a=Tut(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=xut(t,a),u=Cut(r),d=Mut[u];return{format:u,quality:me(i??d,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!!(t!=null&&t.ignoreBackground),ignorePadding:!!(t!=null&&t.ignorePadding)}}function yut(t,e){const r=gut(t,e),i=r.area,s=r.width/i.width,n=eq(r,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,u=Math.floor(l*s+o),d=Math.floor(c*s+a),p=(t==null?void 0:t.layers)??[],g=r.ignoreBackground,y=r.ignorePadding;return{framebufferWidth:u,framebufferHeight:d,region:{x:Math.floor(i.x*s)+n.left,y:Math.floor(i.y*s)+n.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:s,layers:p,disableDecorations:r.disableDecorations,ignoreBackground:g,ignorePadding:y,objectAndLayerIdColor:!1}}function I6(t,e,r){const{ctx:i,canvas:s}=kwe(t,r),n=i.getImageData(0,0,t.width,t.height),o=vut(s,e);return Bwe(s),{dataUrl:o,data:n}}function L6(t,e){const{ctx:r,canvas:i}=kwe(t,e),s=r.getImageData(0,0,t.width,t.height);return Bwe(i),s}function kwe(t,e){const r=_ut();e.premultipliedAlpha&&Rut(t),r.width=t.width,r.height=t.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(t,0,0),e.flipY&&Aut(i),{ctx:i,canvas:r}}function Bwe(t){t.width=0,t.height=0}function _ut(){return D6==null&&(D6=document.createElement("canvas")),D6}let D6=null;function vut(t,e){const r=Out[e.format],i=e.quality/100;return t.toDataURL(r,i)}function but(t,e,r,i=0,s=0,n=t.width-i,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:u,data:d}=e,p=n/c,g=o/u,y=Math.ceil(p/2),_=Math.ceil(g/2),v=t.width;for(let w=0;w<u;w++)for(let x=0;x<c;x++){const T=4*(x+(a?u-w-1:w)*c);let S=0,C=0,A=0,O=0,$=0,D=0;const N=(w+.5)*g;for(let z=Math.floor(w*g);z<(w+1)*g;z++){const U=Math.abs(N-(z+.5))/_,Y=(x+.5)*p,H=U*U;for(let V=Math.floor(x*p);V<(x+1)*p;V++){const J=Math.abs(Y-(V+.5))/y,P=Math.sqrt(H+J*J);if(P>=1)continue;let I=2*P*P*P-3*P*P+1;const B=4*(i+V+(s+z)*v);D+=I*l[B+3],C+=I,!r&&l[B+3]<255&&(I=I*l[B+3]/255),A+=I*l[B],O+=I*l[B+1],$+=I*l[B+2],S+=I}}d[T]=A/S,d[T+1]=O/S,d[T+2]=$/S,d[T+3]=D/C}return e}function wut(t,e,r){if(!e)return t;const{framebufferWidth:i,framebufferHeight:s,pixelRatio:n,region:o}=t,a=eq(t,r),l=a.left+a.right,c=a.top+a.bottom,u=i-l,d=s-c,p=Math.min(mut,Math.min((Vie-l)/u,(Vie-c)/d));return p<fut?t:{...t,framebufferWidth:Math.round(u*p)+l,framebufferHeight:Math.round(d*p)+c,pixelRatio:n*p,resample:{region:{x:Math.round((o.x-a.left)*p)+a.left,y:Math.round((o.y-a.top)*p)+a.top,width:Math.round(o.width*p),height:Math.round(o.height*p)},width:i,height:s}}}function xut(t,e){if(!t)return e;const r=t.width,i=t.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return e;const s=e.width/e.height;return i==null?{width:Math.floor(r),height:Math.floor(r/s)}:{width:Math.floor(i*s),height:Math.floor(i)}}function Tut(t,e){const r={x:0,y:0,width:e.width,height:e.height};if(t!=null&&t.area){t.area.x!=null&&(r.x=Math.floor(t.area.x)),t.area.y!=null&&(r.y=Math.floor(t.area.y));const i=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(r.width=e.width-r.x,r.height=e.height-r.y,i!=null&&s!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,s);else if(i==null&&s!=null){const n=Math.min(r.width,i);r.height=n/r.width*r.height,r.width=n}else if(i!=null&&s==null){const n=Math.min(r.height,s);r.width=n/r.height*r.width,r.height=n}}return Sut(Eut(r,t),e)}function Sut(t,e){const r=Math.floor(Math.max(t.x,0)),i=Math.floor(Math.max(t.y,0)),s={x:r,y:i,width:Math.floor(Math.min(t.width,e.width-r)),height:Math.floor(Math.min(t.height,e.height-i))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),u=s.height-c;return{x:s.x,y:Math.floor(s.y+u/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function Eut(t,e){if((e==null?void 0:e.width)==null||e.height==null)return t;const r=e.width/e.height,i=t.width/t.height;if(i===r)return t;if(i<r){const n=Math.floor(t.height*r);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/r);return t.y-=(s-t.height)/2,t.height=s,t}function eq(t,e){return!e||t&&t.ignorePadding?$ut:e}function Cut(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return Put}}function Aut(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function Rut(t){const e=t.data,r=e.length;for(let i=0;i<r;i+=4){const s=e[i+3];if(s!==255&&s>0){const n=255/s;e[i]=e[i]*n,e[i+1]=e[i+1]*n,e[i+2]=e[i+2]*n}}}const Out={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Gie=98,Put="png",Mut={png:100,jpg:Gie,jpeg:Gie},$ut={top:0,right:0,bottom:0,left:0};let Iut=class{constructor(e,r,i){this.parameters=e,this.frameHasDecorations=r,this.fbos=i}},Lut=class{constructor(e,r,i){this._rctx=e,this._renderFunctions=r,this._forceCameraHook=i,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(cs.BACKGROUND);const r=Go();return this._screenshotQueue.push({settings:e,resolver:r}),r.promise}update(e,r){for(const i of this._screenshotQueue){if(this._rctx==null){i.resolver.reject();continue}const s={...i.settings,pixelRatio:i.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,s,r);i.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,r,i){e.width=r.width,e.height=r.height;const s=e.getContext("2d"),n=i.pixelRatio;return s.save(),s.translate(0,r.height),s.scale(1,-1),i.region&&s.translate(-i.region.x,-i.region.y),s.scale(n,n),r=this._renderFunctions.renderOverlay(e,i.disableDecorations?Al.OFF:Al.ON,r),s.restore(),r}_readbackScreenshot(e,r){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},r):this._readbackScreenshotImmediate(e,r)}_readbackScreenshotResampled(e,r){const{framebufferWidth:i,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=CF(i,s,a);this._rctx.gl.readPixels(0,0,i,s,ut.RGBA,Xe.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=CF(n.width,n.height,a);return but(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,r){const{framebufferHeight:i,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=CF(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,i-(s.y+s.height),s.width,s.height,ut.RGBA,Xe.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,r,i){const s=e.parameters.camera,n={width:r.framebufferWidth,height:r.framebufferHeight};_1(n,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let o=!1;const a=r.disableDecorations&&e.frameHasDecorations,l=n.width!==s.fullWidth||n.height!==s.fullHeight,c=r.ignorePadding&&s.pixelRatio!==r.pixelRatio,u=l||a||c||r.objectAndLayerIdColor;let d=null;r.objectAndLayerIdColor&&(d=e.fbos.acquire(cr.RGBA,n.width,n.height),d.acquireDepth(Hs.DEPTH_STENCIL_BUFFER));let p=null;if(u){const v=s.clone();if(r.ignorePadding){const C=V3(v.padding);for(let A=0;A<4;A++)C[A]=Math.round(C[A]/v.pixelRatio*r.pixelRatio);v.padding=C}v.fullWidth=n.width,v.fullHeight=n.height,v.pixelRatio=r.pixelRatio;const w=s.fovX-v.fovX,x=s.fovY-v.fovY;w<0&&w<x?v.fovX=s.fovX:x<0&&x<w&&(v.fovY=s.fovY);const T={camera:v,contentCamera:v,mode:xr.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(T),o=!0,p=e.fbos.acquire(cr.RGBA,n.width,n.height);const S=r.disableDecorations?Al.OFF:Al.ON;this._renderFunctions.renderScene(p,d,T,S,i)}const g=()=>{this._rctx.bindFramebuffer(null),p==null||p.release()};this._rctx.bindFramebuffer(p==null?void 0:p.fbo);const y=this._readbackScreenshot(r,g);let _=null;if(r.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),d==null||d.release()};this._rctx.bindFramebuffer(d==null?void 0:d.fbo),_=this._readbackScreenshot(r,v),this._rctx.bindFramebuffer(null)}if(u&&!this._rctx.contextAttributes.alpha)for(let v=3;v<y.data.length;v+=4)y.data[v]=255;if(_&&!this._rctx.contextAttributes.alpha)for(let v=3;v<_.data.length;v+=4)_.data[v]=255;return o&&this._forceCameraHook(e.parameters),[y,_]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},zn=class extends xe{constructor(e){super({}),this.events=new Ps,this.waterTextureRepository=new mE,this._magnifierHelper=new xw,this.objectAndLayerIdRenderHelper=te("enable-feature:objectAndLayerId-rendering")?new qat:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),this.addHandles([ae(()=>{var s;return(s=this.waterTextureRepository)==null?void 0:s.updating},()=>this.requestRender(),zr),ae(()=>e.view.qualityProfile,s=>{var n;return(n=this.renderer)==null?void 0:n.updateRenderFeatures(s)},Br),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const{memoryController:r}=e.view.resourceController;this.stippleTextureRepository=kqe(this._rctx,r),this.markerTextureRepository=dut(this._rctx,r),this._shaderTechniqueRepository=new Kye({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this.stippleTextureRepository,waterTextureRepository:this.waterTextureRepository,markerTextureRepository:this.markerTextureRepository}),this._textureRepository=new Ew(e,this._shaderTechniqueRepository,this._rctx),this.addHandles(this._textureRepository.events.on("changed",s=>this.requestRender(s))),this._materialRepository=new e_e(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new Sat(this._rctx,this._shaderTechniqueRepository),this.renderer=new Jl(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,s=>this.requestRender(s));const i={renderScene:(s,n,o,a,l)=>this.renderer.render(s,n,o,a,l),requestRenderScene:s=>this.requestRender(s),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(s,n,o)=>e.options.screenshot.renderOverlay(s,n,o)};this._screenshotManager=new Lut(this._rctx,i,s=>this.events.emit("force-camera-for-screenshot",s)),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=di(this._frameTask),this._shaderTechniqueRepository=Oe(this._shaderTechniqueRepository)}requestRender(e=cs.UPDATE){this._needsRender=!0,e===cs.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(r=>r[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,r,i,s,n,o=n){const a=s.constrainWindowSize(r,i,n*s.pixelRatio,o*s.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(s,a,l);let c=Number.MAX_VALUE;for(let u=0;u<a[2]*a[3];u++){const d=Oat(4*u,l,s.nearFar);c>d&&d!==s.nearFar[0]&&d!==s.nearFar[1]&&(c=d)}if(e){const u=e.pickDepth(r*s.pixelRatio,i*s.pixelRatio,s);u!=null&&c>u&&u!==s.nearFar[0]&&u!==s.nearFar[1]&&(c=u)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const r=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<r)&&(this._tmpDepthBuffer=new Uint8Array(r)),this._tmpDepthBuffer}async reloadShaders(){Hve(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const r=e.view.state;let i=!1,s=cs.BACKGROUND,n=!1;const o={preRender:({time:a})=>{i=this.updating,s=this._needsUpdate?cs.UPDATE:cs.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||r.forcedAnimationTime!=null||i||this._needsRender){const c=l/this.renderer.animationTimeDilation,u=new Bge(r.camera,c,r.forcedAnimationTime);this.renderer.updateAnimation(u)&&this.requestRender(cs.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&r.camera.fullWidth>0&&r.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,r,Al.ON,a),n=!0,l&&this.renderer.hasReflections&&(this.requestRender(cs.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=this.renderer.hasSlicePlane||this._magnifierHelper.enabled||this.renderer.hasDecorations||this.renderer.hasHighlights,c=new Iut(r,l,this.renderer.fboCache);this._textureRepository.update(),this._screenshotManager.update(c,a)},finish:()=>{n&&(this.renderer.finish(r.mode===xr.IDLE?s:cs.UPDATE),n=!1)}};this._frameTask=B1(o)}_initializeContext(e){const r=e.options;this._canvas=r.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:r.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:r.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:r.preserveDrawingBuffer??!1},s=F6e("3d",this._canvas,i);s!=null&&md(s)?(this._rctx=this._newRenderingContext(s,e),this._loadShaderOnlyExtensions(),!r.alpha&&this._rctx.contextAttributes.alpha&&ne.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&te("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):ne.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(e,r){const i={disabledExtensions:r.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:r.options.debugWebGLExtensions||{},maxAnisotropy:8},s=(n,o)=>r.view.resourceController.memoryController.newCache(n,o);return new uut(e,i,s)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjectCollection==null&&(this._componentObjectCollection=new gat(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};h([f({type:Boolean,readOnly:!0})],zn.prototype,"updating",null),h([f({autoDestroy:!0})],zn.prototype,"_rctx",void 0),h([f({autoDestroy:!0})],zn.prototype,"_container",void 0),h([f({autoDestroy:!0})],zn.prototype,"_canvas",void 0),h([f({autoDestroy:!0})],zn.prototype,"stippleTextureRepository",void 0),h([f({autoDestroy:!0})],zn.prototype,"markerTextureRepository",void 0),h([f({autoDestroy:!0})],zn.prototype,"waterTextureRepository",void 0),h([f({autoDestroy:!0})],zn.prototype,"_magnifierHelper",void 0),h([f({readOnly:!0})],zn.prototype,"objectAndLayerIdRenderHelper",void 0),h([f({autoDestroy:!0})],zn.prototype,"_textureRepository",void 0),h([f({autoDestroy:!0,readOnly:!0})],zn.prototype,"renderer",void 0),h([f({autoDestroy:!0})],zn.prototype,"_screenshotManager",void 0),h([f()],zn.prototype,"componentObjectCollection",null),h([f({autoDestroy:!0})],zn.prototype,"_componentObjectCollection",void 0),h([f()],zn.prototype,"_needsUpdate",void 0),h([f()],zn.prototype,"_needsWaterReflectionUpdate",void 0),zn=h([k("esri.views.3d.webgl-engine.parts.RenderView")],zn);let Ql=class extends xe{constructor(e){super(e),this._model=new XM,this._layers=new It,this._asyncChangeSet=new zB,this._syncChangeSet=new zB,this._layerSyncSet=new Set}initialize(){this._set("renderView",new zn(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(ct.STAGE,this),this.addHandles(this._frameTask)}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),WI(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(WI(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){var r,i;e!=null&&((r=this._model)==null||r.removeMany(e),(i=this.renderView)==null||i.requestRender())}forEachOfType(e,r){this._model.forEachOfType(e,r)}handleEvent(e,r){this.destroyed||(this._model.dirtySet[e](r),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const r=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{if(e.done)return;const s=this._layerSyncSet.has(i.id)||i.updatePolicy===D0.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;r.commitLayer(i.id,n),this._layerSyncSet.delete(i.id),n.empty||(this.renderer.modify(n,s?fa:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,fa),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==D0.ASYNC||(r.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(r=>{this._layerSyncSet.has(r.id)||r.updatePolicy===D0.SYNC?(e.commitLayer(r.id,this._syncChangeSet),this._layerSyncSet.delete(r.id)):e.commitSyncUpdates(r.id,this._syncChangeSet)});for(const r of this._layerSyncSet)e.commitLayer(r,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,fa),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,fa),this.renderView.requestRender())}schedule(e,r){return this._frameTask.schedule(e,r)}reschedule(e,r){return this._frameTask.reschedule(e,r)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,fa))}addRenderPlugin(e,r){const i=this.renderer.renderPlugins.add(e,r),s=()=>{Lee(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(Fl(i))return i.then(s);s()}removeRenderPlugin(e){this.destroyed||(Lee(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){const e=this;return{getCount:r=>e._model.test.content.filter(i=>i.type===r).length,model:e._model}}};Ql.DebugSettings={endFrameContentValidation:!1},h([f({constructOnly:!0})],Ql.prototype,"view",void 0),h([f({constructOnly:!0})],Ql.prototype,"options",void 0),h([f({readOnly:!0})],Ql.prototype,"viewingMode",null),h([f({constructOnly:!0})],Ql.prototype,"container",void 0),h([f({readOnly:!0})],Ql.prototype,"updating",null),h([f({constructOnly:!0})],Ql.prototype,"_model",void 0),h([f({autoDestroy:!0})],Ql.prototype,"renderView",void 0),h([f({readOnly:!0})],Ql.prototype,"renderer",null),h([f({readOnly:!0})],Ql.prototype,"running",null),Ql=h([k("esri.views.3d.webgl-engine.Stage")],Ql);let SOt=class extends BD{constructor(e,r,i,s){super(r,i),this.point=e,this.createGraphic=s}};function zwe(t){return hd(t)&&t.intersector===Mi.PCL&&!!t.target}let COt=class extends Qhe{constructor(e,r,i,s,n){super(e),this.layerUid=e,this.sublayerUid=r,this.nodeIndex=i,this.componentIndex=s,this.triangleNr=n}},ROt=class extends BD{constructor(e,r,i){super(r,null),this.point=e,this.createVoxelGraphic=i}};function XN(t){return hd(t)&&t.intersector===Mi.I3S&&!!t.target}function Vwe(t){return hd(t)&&t.intersector===Mi.VOXEL&&!!t.target}function jie(t,e){var r,i;return zD(t)||VD(t)?g3((r=t.target)==null?void 0:r.object,e):XWe(t)?(i=e.map)==null?void 0:i.ground:zwe(t)||XN(t)||A_e(t)||Vwe(t)?g3(t.target,e):null}function POt(t,e){const r=Mz(t,e);return r!=null&&r.type==="graphic"?r.graphic:null}function Mz(t,e){var r;if(t==null)return null;if(zD(t)||VD(t))return Hie((r=t.target)==null?void 0:r.object,e);if(zwe(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(Vwe(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return A_e(t)||bH(t)?Hie(t.target,e):XN(t)?Dut(t.target,e):null}function Hie(t,e){if((t==null?void 0:t.graphicUid)==null)return null;const r=g3(t,e);if(r==null)return null;if(r===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const i=e.allLayerViews.find(s=>s.layer===r);return!i||i.suspended||t.graphicUid==null?null:"getHit"in i?i.getHit(t.graphicUid):null}function Dut(t,e){const r=g3(t,e);if(r==null)return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?Fut(i.getGraphicFromIntersectorTarget(t)):null}function Nut(t,e){const r=g3(t,e);if(r==null)return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(t):null}function Fut(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function g3(t,e){return(t==null?void 0:t.layerUid)==null?null:e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid)}function MOt(t,e){if(zD(t)||VD(t))return im(t.target.object.boundingVolumeWorldSpace.bounds);if(bH(t)){lae(dP,t.transformation);const r=Math.max(dP[0],dP[1],dP[2]);return t.target.baseBoundingSphere.radius*r}if(XN(t)){const r=Nut(t.target,e);return r?.5*Mce(r):null}return null}function $Ot(t){return!zD(t)&&!VD(t)&&(bH(t)?t.target.numLodLevels>1:!!XN(t))}const dP=E();async function Uut(t,e){if(t.type==="2d")return t.hitTest(e);const r=await t.hitTest(e);if(r.results.length===0)return r;const i=(r.results[0].distance??0)*(1+kut),s=r.results.findIndex(n=>(n.distance??0)>i);return s!==-1&&(r.results=r.results.slice(0,s)),r}const kut=.05;function IOt(t){return t&&typeof t.highlight=="function"}function But(t){return t&&typeof t.maskOccludee=="function"}function LOt(t,e,r){return t==null||t>r&&(e===0||t<e)}function DOt(t,e){return t!=null&&t>0||e!=null&&e>0}function NOt(t){const e=t.effectiveScaleRange;return{minScale:(e==null?void 0:e.minScale)??0,maxScale:(e==null?void 0:e.maxScale)??0}}let N6,F6;function zut(t){const e=Kpe(t);for(;e.length>1;){const r=qie(e.shift());if(r.available)return r}return qie(e.shift())}function qie(t){switch(t){case rr.WEBGL1:return Vut();case rr.WEBGL2:return Gut()}}function Vut(){return N6||(N6=qut()),N6}function Gut(){return F6||(F6=Wut()),F6}let Gwe=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},jut=class extends Gwe{constructor(){super(...arguments),this.type=rr.WEBGL1}},Hut=class extends Gwe{constructor(){super(...arguments),this.type=rr.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function jwe(t,e){if(t===rr.WEBGL1&&typeof WebGLRenderingContext>"u"||t===rr.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const r=document.createElement("canvas");if(!r)return null;let i=ak(r,t,{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=ak(r,t),i!=null&&(e.majorPerformanceCaveat=!0)),i==null)return i;if(t===rr.WEBGL1){const n=i.getParameter(i.VERSION),o=n==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return s&&(e.supportsHighPrecisionFragment=s.precision>0),i}function qut(){const t=new jut,e=jwe(rr.WEBGL1,t);return e==null||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function Wut(){const t=new Hut,e=jwe(rr.WEBGL2,t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function Yut(t){const e=zut(t);if(!e.available)return new X("webgl:required",t==="3d"?"WebGL2 is required but not supported.":"WebGL is required but not supported.",new Error().stack);if(t==="3d"&&e.majorPerformanceCaveat)return new X("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new X("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new X("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===rr.WEBGL1){if(!e.supportsElementIndexUint)return new X("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new X("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new X("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function Xut(t){return t&&"nodeType"in t}function Zut(t){return t&&typeof t.render=="function"}const Wie={component:"esri-component"};let X_=class extends xe{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){var e,r;return this._get("id")??((e=this.widget)==null?void 0:e.id)??((r=this.node)==null?void 0:r.id)}set id(e){this._set("id",e)}set node(e){const r=this._get("node");e!==r&&(e&&e.classList.add(Wie.component),r&&r.classList.remove(Wie.component),this._set("node",e))}castNode(e){var r;return(r=this.widget)==null||r.destroy(),e?typeof e=="string"||Xut(e)?(this._set("widget",null),AD(e)):(Zut(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};h([f()],X_.prototype,"id",null),h([f()],X_.prototype,"node",null),h([zi("node")],X_.prototype,"castNode",null),h([f({readOnly:!0})],X_.prototype,"widget",void 0),X_=h([k("esri.views.ui.Component")],X_);const e$=X_,Hwe="calcite-mode-";function Jut(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function Qut(){return Jut().startsWith("dark")}function Kut(){return`${Hwe}${Qut()?"dark":"light"}`}function eht(t){tht(t),t.classList.add(Kut())}function tht(t){Array.from(t.classList).forEach(e=>{e.startsWith(Hwe)&&t.classList.remove(e)})}const rht={left:0,top:0,bottom:0,right:0},qwe={bottom:30,top:15,right:15,left:15},wf="esri-ui",al={ui:wf,corner:`${wf}-corner`,innerContainer:`${wf}-inner-container`,manualContainer:`${wf}-manual-container`,cornerContainer:`${wf}-corner-container`,topLeft:`${wf}-top-left`,topRight:`${wf}-top-right`,bottomLeft:`${wf}-bottom-left`,bottomRight:`${wf}-bottom-right`};function iht(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function pP(t){return t===0?"0":`${t}px`}function U6(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function k6(t,{top:e,bottom:r,left:i,right:s}){t.style.top=e,t.style.bottom=r,t.style.left=i,t.style.right=s}let sp=class extends Ps.EventedAccessor{constructor(t){super(t),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=xc(),this.view=null,this._applyViewPadding=()=>{const e=this.container;e&&k6(e,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const e=this._innerContainer;e&&k6(e,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([ae(()=>{var t;return[(t=this.view)==null?void 0:t.padding,this.container]},this._applyViewPadding,zr),ae(()=>this.padding,this._applyUIPadding,zr),ae(()=>[this.container,this._locale],([t,e])=>{t&&t.setAttribute("lang",e)},zr),_7(t=>{this._locale=t})])}destroy(){this.container=null;for(const t of this._components)t.destroy();this._components.length=0,this._componentMap.clear()}set container(t){const e=this._get("container");t!==e&&(t&&(t.classList.add(al.ui),eht(t),this._attachContainers(t)),e&&(e.classList.remove(al.ui),k6(e,{top:"",bottom:"",left:"",right:""}),cue(e)),this._set("container",t))}get height(){var s;const t=((s=this.view)==null?void 0:s.height)??0;if(t===0)return t;const e=this._getViewPadding(),{top:r,bottom:i}=e;return Math.max(t-r-i,0)}get padding(){return this._get("padding")}set padding(t){this._overrideIfSome("padding",t)}castPadding(t){return typeof t=="number"?{bottom:t,top:t,right:t,left:t}:{...qwe,...t}}get width(){var s;const t=((s=this.view)==null?void 0:s.width)??0;if(t===0)return t;const e=this._getViewPadding(),{left:r,right:i}=e;return Math.max(t-r-i,0)}add(t,e){let r,i,s;if(Array.isArray(t))return void t.forEach(o=>this.add(o,e));const n=U6(t);n&&({index:r,position:e,component:t,key:i}=n),e&&typeof e=="object"&&({index:r,key:i,position:e,internal:s}=e),!t||e&&!this._isValidPosition(e)||this._add(t,e,r,i,s)}remove(t,e){var i;if(!t)return;if(Array.isArray(t))return t.map(s=>this.remove(s,e));const r=this._find(t);if(r){if(this._componentMap.has(r)&&((i=this._componentMap.get(r))==null?void 0:i.key)!==e)return;const s=this._components.indexOf(r),n=r.node.parentNode;return n==null||n.removeChild(r.node),this._componentMap.delete(r),this._components.splice(s,1)[0]}}empty(t,e={removeInternal:!1}){if(Array.isArray(t)){for(const s of t)this.empty(s,e);return}const r=this._positionNameToContainerLookup[t??"manual"],i=Array.prototype.slice.call(r.children).map(s=>this._findByNode(s)).filter(s=>{var n;return s==null?!1:!(((n=this._componentMap.get(s))==null?void 0:n.internal)??!1)||e.removeInternal});for(const s of i)this.remove(s)}move(t,e){if(Array.isArray(t)&&t.forEach(n=>this.move(n,e)),!t)return;let r;const i=U6(t)||U6(e);if(i&&(r=i.index,e=i.position,t=i.component||t),e&&!this._isValidPosition(e))return;const s=this.remove(t);s&&this.add(s,{position:e,index:r})}find(t){if(!t)return null;const e=this._findById(t);return e&&(e.widget||e.node)}getComponents(t,e={includeInternal:!1}){return t?Array.isArray(t)?t.flatMap(r=>this._getComponentsAtPosition(r,e)):this._getComponentsAtPosition(t,e):this._components.filter(r=>{var i;return e.includeInternal||!((i=this._componentMap.get(r))!=null&&i.internal)}).map(({widget:r,node:i})=>r??i)}getPosition(t){for(const e in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[e].contains(t))return e;return null}_add(t,e,r,i,s){t instanceof e$||(t=new e$({node:t})),this._place({component:t,position:e,index:r}),this._components.push(t),this._componentMap.set(t,{key:i,internal:s})}_find(t){return t?t instanceof e$?this._findByComponent(t):typeof t=="string"?this._findById(t):this._findByNode(t.domNode||t):null}_getViewPadding(){var t;return((t=this.view)==null?void 0:t.padding)??rht}_attachContainers(t){t.appendChild(this._innerContainer),t.appendChild(this._manualContainer)}_initContainers(){const t=document.createElement("div");t.classList.add(al.innerContainer,al.cornerContainer);const e=document.createElement("div");e.classList.add(al.innerContainer,al.manualContainer);const r=document.createElement("div");r.classList.add(al.topLeft,al.corner),t.appendChild(r);const i=document.createElement("div");i.classList.add(al.topRight,al.corner),t.appendChild(i);const s=document.createElement("div");s.classList.add(al.bottomLeft,al.corner),t.appendChild(s);const n=document.createElement("div");n.classList.add(al.bottomRight,al.corner),t.appendChild(n),this._innerContainer=t,this._manualContainer=e;const o=LDe();this._cornerNameToContainerLookup={"top-left":r,"top-right":i,"bottom-left":s,"bottom-right":n,"top-leading":o?i:r,"top-trailing":o?r:i,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup={manual:e,...this._cornerNameToContainerLookup}}_isValidPosition(t){return!!this._positionNameToContainerLookup[t]}_place(t){const e=t.position??"manual",{component:r,index:i}=t,s=this._positionNameToContainerLookup[e],n=i!=null&&i>-1;if(iht(r.widget)&&r.widget.startup(),!n)return void s.appendChild(r.node);const o=Array.from(s.children);if(i===0)return void(s.firstChild?iY(r.node,s.firstChild):s.appendChild(r.node));i>=o.length?s.appendChild(r.node):iY(r.node,o[i])}_toPixelPosition(t){return{top:pP(t.top),left:pP(t.left),right:pP(t.right),bottom:pP(t.bottom)}}_findByComponent(t){return this._components.find(e=>e===t)??null}_findById(t){return this._components.find(({id:e})=>e===t)??null}_findByNode(t){return this._components.find(({node:e})=>e===t)??null}_getComponentsAtPosition(t,e){const r=this._positionNameToContainerLookup[t];return Array.prototype.slice.call(r.children).map(i=>this._findByNode(i)).filter(v3).filter(i=>{var s;return e.includeInternal||!((s=this._componentMap.get(i))!=null&&s.internal)}).map(({widget:i,node:s})=>i??s)}};h([f()],sp.prototype,"_locale",void 0),h([f()],sp.prototype,"container",null),h([f()],sp.prototype,"height",null),h([f({value:qwe})],sp.prototype,"padding",null),h([zi("padding")],sp.prototype,"castPadding",null),h([f()],sp.prototype,"view",void 0),h([f()],sp.prototype,"width",null),sp=h([k("esri.views.ui.UI")],sp);const sht=sp,nht="randomUUID"in crypto;function Wwe(){if(nht)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=r=>t[r].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function zOt(){return`{${Wwe()}}`}const oht={handleInterceptedEvent:(t,e,r,i)=>(t.scheduleRender(),e.properties[`on${i.type}`].apply(e.properties.bind||r,[i]))},aht={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}},lht=t=>({...aht,...t}),cht=(t,e)=>{const r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r},uht=(t,e)=>t.find(e),Yie=(t,e,r=!1)=>{let i=t;return e.forEach((s,n)=>{const o=i!=null&&i.children?uht(i.children,a=>a.domNode===s):void 0;r&&!o&&n!==e.length-1||(i=o)}),i},hht=t=>{let e;const r={...oht,...t},i=lht(r),s=i.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],u=(p,g,y)=>{var w;let _;i.eventHandlerInterceptor=(x,T,S,C)=>function(A){let O;s("domEvent",A);const $=cht(A.currentTarget,_.domNode),D=$.some(z=>{var U;return customElements.get((U=z==null?void 0:z.tagName)==null?void 0:U.toLowerCase())});if(A.eventPhase===Event.CAPTURING_PHASE||!D)$.reverse(),O=Yie(_.getLastRender(),$);else{const z=A.composedPath(),U=z.slice(z.indexOf(A.currentTarget),z.indexOf(_.domNode)).reverse();O=Yie(_.getLastRender(),U,!0)}let N;return O&&(N=r.handleInterceptedEvent(e,O,this,A)),s("domEventProcessed",A),N},(w=r.postProcessProjectionOptions)==null||w.call(r,i);const v=y();_=p(g,v,i),i.eventHandlerInterceptor=void 0,l.push(_),c.push(y),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(_,v)};let d=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let p=0;p<l.length;p++){const g=c[p]();s("rendered",void 0),l[p].update(g),s("patched",void 0)}s("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(d=r.modifyDoRenderImplementation(d,l,c)),e={renderNow:d,scheduleRender:()=>{n||a||(n=requestAnimationFrame(d))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(p,g)=>{u(S0.append,p,g)},insertBefore:(p,g)=>{u(S0.insertBefore,p,g)},merge:(p,g)=>{u(S0.merge,p,g)},replace:(p,g)=>{u(S0.replace,p,g)},detach:p=>{for(let g=0;g<c.length;g++)if(c[g]===p)return c.splice(g,1),l.splice(g,1)[0];throw new Error("renderFunction was not found")}},e},Cw={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let Aw,Ywe,ZN,Xwe=!1,vL=!1,tq=!1,ac=!1,Xie=null,$z=!1;const dht=t=>{const e=new URL(t,yo.$resourcesUrl$);return e.origin!==vA.location.origin?e.href:e.pathname},pht=t=>yo.$resourcesUrl$=t,vv=(t,e="")=>()=>{},Zie="http://www.w3.org/1999/xlink",Jie={},fht="http://www.w3.org/2000/svg",mht="http://www.w3.org/1999/xhtml",ght=t=>t!=null,rq=t=>(t=typeof t,t==="object"||t==="function");function yht(t){var e,r,i;return(i=(r=(e=t.head)===null||e===void 0?void 0:e.querySelector('meta[name="csp-nonce"]'))===null||r===void 0?void 0:r.getAttribute("content"))!==null&&i!==void 0?i:void 0}const Zwe=(t,e,...r)=>{let i=null,s=null,n=null,o=!1,a=!1;const l=[],c=d=>{for(let p=0;p<d.length;p++)i=d[p],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof t!="function"&&!rq(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?bL(null,i):i),a=o)};if(c(r),e){e.key&&(s=e.key),e.name&&(n=e.name);{const d=e.className||e.class;d&&(e.class=typeof d!="object"?d:Object.keys(d).filter(p=>d[p]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,bht);const u=bL(t,null);return u.$attrs$=e,l.length>0&&(u.$children$=l),u.$key$=s,u.$name$=n,u},bL=(t,e)=>{const r={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return r.$attrs$=null,r.$key$=null,r.$name$=null,r},_ht={},vht=t=>t&&t.$tag$===_ht,bht={forEach:(t,e)=>t.map(Qie).forEach(e),map:(t,e)=>t.map(Qie).map(e).map(wht)},Qie=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),wht=t=>{if(typeof t.vtag=="function"){const r=Object.assign({},t.vattrs);return t.vkey&&(r.key=t.vkey),t.vname&&(r.name=t.vname),Zwe(t.vtag,r,...t.vchildren||[])}const e=bL(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},xht=t=>Xht.map(e=>e(t)).find(e=>!!e),Tht=(t,e)=>t!=null&&!rq(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,Sht=t=>t,VOt=(t,e,r)=>{const i=Sht(t);return{emit:s=>Eht(i,e,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:s})}},Eht=(t,e,r)=>{const i=yo.ce(e,r);return t.dispatchEvent(i),i},Kie=new WeakMap,Cht=(t,e,r)=>{let i=xL.get(t);Qht&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=e:i.replaceSync(e)):i=e,xL.set(t,i)},Aht=(t,e,r,i)=>{var s;let n=Jwe(e,r);const o=xL.get(n);if(t=t.nodeType===11?t:Qh,o)if(typeof o=="string"){t=t.head||t;let a=Kie.get(t),l;if(a||Kie.set(t,a=new Set),!a.has(n)){{l=Qh.createElement("style"),l.innerHTML=o;const c=(s=yo.$nonce$)!==null&&s!==void 0?s:yht(Qh);c!=null&&l.setAttribute("nonce",c),t.insertBefore(l,t.querySelector("link"))}a&&a.add(n)}}else t.adoptedStyleSheets.includes(o)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,o]);return n},Rht=t=>{const e=t.$cmpMeta$,r=t.$hostElement$,i=e.$flags$,s=vv("attachStyles",e.$tagName$),n=Aht(r.shadowRoot?r.shadowRoot:r.getRootNode(),e,t.$modeName$);i&10&&(r["s-sc"]=n,r.classList.add(n+"-h"),i&2&&r.classList.add(n+"-s")),s()},Jwe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),ese=(t,e,r,i,s,n)=>{if(r!==i){let o=sse(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=tse(r),u=tse(i);l.remove(...c.filter(d=>d&&!u.includes(d))),l.add(...u.filter(d=>d&&!c.includes(d)))}else if(e==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?t.style.setProperty(l,i[l]):t.style[l]=i[l])}else if(e!=="key")if(e==="ref")i&&i(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):sse(vA,a)?e=a.slice(2):e=a[2]+e.slice(3),r&&yo.rel(t,e,r,!1),i&&yo.ael(t,e,i,!1);else{const l=rq(i);if((o||l&&i!==null)&&!s)try{if(t.tagName.includes("-"))t[e]=i;else{const u=i??"";e==="list"?o=!1:(r==null||t[e]!=u)&&(t[e]=u)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),i==null||i===!1?(i!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(Zie,e):t.removeAttribute(e)):(!o||n&4||s)&&!l&&(i=i===!0?"":i,c?t.setAttributeNS(Zie,e,i):t.setAttribute(e,i))}}},Oht=/\s/,tse=t=>t?t.split(Oht):[],Qwe=(t,e,r,i)=>{const s=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,n=t&&t.$attrs$||Jie,o=e.$attrs$||Jie;for(i in n)i in o||ese(s,i,n[i],void 0,r,e.$flags$);for(i in o)ese(s,i,n[i],o[i],r,e.$flags$)},wL=(t,e,r,i)=>{const s=e.$children$[r];let n=0,o,a,l;if(Xwe||(tq=!0,s.$tag$==="slot"&&(Aw&&i.classList.add(Aw+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=Qh.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=Qh.createTextNode("");else{if(ac||(ac=s.$tag$==="svg"),o=s.$elm$=Qh.createElementNS(ac?fht:mht,s.$flags$&2?"slot-fb":s.$tag$),ac&&s.$tag$==="foreignObject"&&(ac=!1),Qwe(null,s,ac),ght(Aw)&&o["s-si"]!==Aw&&o.classList.add(o["s-si"]=Aw),s.$children$)for(n=0;n<s.$children$.length;++n)a=wL(t,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?ac=!1:o.tagName==="foreignObject"&&(ac=!0)}return o["s-hn"]=ZN,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=Ywe,o["s-sn"]=s.$name$||"",l=t&&t.$children$&&t.$children$[r],l&&l.$tag$===s.$tag$&&t.$elm$&&y3(t.$elm$,!1)),o},y3=(t,e)=>{yo.$flags$|=1;const r=t.childNodes;for(let i=r.length-1;i>=0;i--){const s=r[i];s["s-hn"]!==ZN&&s["s-ol"]&&(txe(s).insertBefore(s,iq(s)),s["s-ol"].remove(),s["s-ol"]=void 0,tq=!0),e&&y3(s,e)}yo.$flags$&=-2},Kwe=(t,e,r,i,s,n)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===ZN&&(o=o.shadowRoot);s<=n;++s)i[s]&&(a=wL(null,r,s,t),a&&(i[s].$elm$=a,o.insertBefore(a,iq(e))))},exe=(t,e,r,i,s)=>{for(;e<=r;++e)(i=t[e])&&(s=i.$elm$,sxe(i),vL=!0,s["s-ol"]?s["s-ol"].remove():y3(s,!0),s.remove())},Pht=(t,e,r,i)=>{let s=0,n=0,o=0,a=0,l=e.length-1,c=e[0],u=e[l],d=i.length-1,p=i[0],g=i[d],y,_;for(;s<=l&&n<=d;)if(c==null)c=e[++s];else if(u==null)u=e[--l];else if(p==null)p=i[++n];else if(g==null)g=i[--d];else if(fP(c,p))Rw(c,p),c=e[++s],p=i[++n];else if(fP(u,g))Rw(u,g),u=e[--l],g=i[--d];else if(fP(c,g))(c.$tag$==="slot"||g.$tag$==="slot")&&y3(c.$elm$.parentNode,!1),Rw(c,g),t.insertBefore(c.$elm$,u.$elm$.nextSibling),c=e[++s],g=i[--d];else if(fP(u,p))(c.$tag$==="slot"||g.$tag$==="slot")&&y3(u.$elm$.parentNode,!1),Rw(u,p),t.insertBefore(u.$elm$,c.$elm$),u=e[--l],p=i[++n];else{for(o=-1,a=s;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===p.$key$){o=a;break}o>=0?(_=e[o],_.$tag$!==p.$tag$?y=wL(e&&e[n],r,o,t):(Rw(_,p),e[o]=void 0,y=_.$elm$),p=i[++n]):(y=wL(e&&e[n],r,n,t),p=i[++n]),y&&txe(c.$elm$).insertBefore(y,iq(c.$elm$))}s>l?Kwe(t,i[d+1]==null?null:i[d+1].$elm$,r,i,n,d):n>d&&exe(e,s,l)},fP=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,iq=t=>t&&t["s-ol"]||t,txe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,Rw=(t,e)=>{const r=e.$elm$=t.$elm$,i=t.$children$,s=e.$children$,n=e.$tag$,o=e.$text$;let a;o===null?(ac=n==="svg"?!0:n==="foreignObject"?!1:ac,n==="slot"||Qwe(t,e,ac),i!==null&&s!==null?Pht(r,i,e,s):s!==null?(t.$text$!==null&&(r.textContent=""),Kwe(r,null,e,s,0,s.length-1)):i!==null&&exe(i,0,i.length-1),ac&&n==="svg"&&(ac=!1)):(a=r["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(r.data=o)},rxe=t=>{const e=t.childNodes;let r,i,s,n,o,a;for(i=0,s=e.length;i<s;i++)if(r=e[i],r.nodeType===1){if(r["s-sr"]){for(o=r["s-sn"],r.hidden=!1,n=0;n<s;n++)if(a=e[n].nodeType,e[n]["s-hn"]!==r["s-hn"]||o!==""){if(a===1&&o===e[n].getAttribute("slot")){r.hidden=!0;break}}else if(a===1||a===3&&e[n].textContent.trim()!==""){r.hidden=!0;break}}rxe(r)}},Dh=[],ixe=t=>{let e,r,i,s,n,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(r=e["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,s=e["s-sn"],o=i.length-1;o>=0;o--)r=i[o],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==e["s-hn"]&&(rse(r,s)?(n=Dh.find(u=>u.$nodeToRelocate$===r),vL=!0,r["s-sn"]=r["s-sn"]||s,n?n.$slotRefNode$=e:Dh.push({$slotRefNode$:e,$nodeToRelocate$:r}),r["s-sr"]&&Dh.map(u=>{rse(u.$nodeToRelocate$,r["s-sn"])&&(n=Dh.find(d=>d.$nodeToRelocate$===r),n&&!u.$slotRefNode$&&(u.$slotRefNode$=n.$slotRefNode$))})):Dh.some(u=>u.$nodeToRelocate$===r)||Dh.push({$nodeToRelocate$:r}));e.nodeType===1&&ixe(e)}},rse=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",sxe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(sxe)},Mht=(t,e)=>{const r=t.$hostElement$,i=t.$cmpMeta$,s=t.$vnode$||bL(null,null),n=vht(e)?e:Zwe(null,null,e);ZN=r.tagName,i.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},i.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=r[o])),n.$tag$=null,n.$flags$|=4,t.$vnode$=n,n.$elm$=s.$elm$=r.shadowRoot||r,Aw=r["s-sc"],Ywe=r["s-cr"],Xwe=(i.$flags$&1)!==0,vL=!1,Rw(s,n);{if(yo.$flags$|=1,tq){ixe(n.$elm$);let o,a,l,c,u,d,p=0;for(;p<Dh.length;p++)o=Dh[p],a=o.$nodeToRelocate$,a["s-ol"]||(l=Qh.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(p=0;p<Dh.length;p++)if(o=Dh[p],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,u=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(d=l["s-nr"],d&&d["s-sn"]===a["s-sn"]&&c===d.parentNode&&(d=d.nextSibling,!d||!d["s-nr"])){u=d;break}(!u&&c!==a.parentNode||a.nextSibling!==u)&&a!==u&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,u))}else a.nodeType===1&&(a.hidden=!0)}vL&&rxe(n.$elm$),yo.$flags$&=-2,Dh.length=0}},$ht=(t,e)=>{},sq=(t,e)=>(t.$flags$|=16,$ht(t,t.$ancestorComponent$),edt(()=>Iht(t,e))),Iht=(t,e)=>{const r=t.$hostElement$,i=vv("scheduleUpdate",t.$cmpMeta$.$tagName$),s=r;let n;return e?n=bx(s,"componentWillLoad"):n=bx(s,"componentWillUpdate"),n=ise(n,()=>bx(s,"componentWillRender")),i(),ise(n,()=>Lht(t,s,e))},Lht=async(t,e,r)=>{const i=t.$hostElement$,s=vv("update",t.$cmpMeta$.$tagName$);i["s-rc"],r&&Rht(t);const n=vv("render",t.$cmpMeta$.$tagName$);Dht(t,e,i),n(),s(),Nht(t)},Dht=(t,e,r)=>{try{Xie=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(Cw.hasRenderFn||Cw.reflect)&&(Cw.vdomRender||Cw.reflect)&&(Cw.hydrateServerSide||Mht(t,e))}catch(a){_A(a,t.$hostElement$)}return Xie=null,null},Nht=t=>{const e=t.$cmpMeta$.$tagName$,r=t.$hostElement$,i=vv("postUpdate",e),s=r;t.$ancestorComponent$,bx(s,"componentDidRender"),t.$flags$&64?(bx(s,"componentDidUpdate"),i()):(t.$flags$|=64,bx(s,"componentDidLoad"),i())},GOt=t=>{{const e=yA(t),r=e.$hostElement$.isConnected;return r&&(e.$flags$&18)===2&&sq(e,!1),r}},bx=(t,e,r)=>{if(t&&t[e])try{return t[e](r)}catch(i){_A(i)}},ise=(t,e)=>t&&t.then?t.then(e):e(),Fht=(t,e)=>yA(t).$instanceValues$.get(e),Uht=(t,e,r,i)=>{const s=yA(t),n=t,o=s.$instanceValues$.get(e),a=s.$flags$,l=n;r=Tht(r,i.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){s.$instanceValues$.set(e,r);{if(i.$watchers$&&a&128){const d=i.$watchers$[e];d&&d.map(p=>{try{l[p](r,o,e)}catch(g){_A(g,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,e)===!1)return;sq(s,!1)}}}},kht=(t,e,r)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const i=Object.entries(e.$members$),s=t.prototype;i.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return Fht(this,n)},set(a){Uht(this,n,a,e)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){yo.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=i.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},Bht=async(t,e,r,i,s)=>{if(!(e.$flags$&32)&&(s=t.constructor,e.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>e.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[e.$modeName$=xht(t)]);const a=Jwe(r,e.$modeName$);if(!xL.has(a)){const l=vv("registerStyles",r.$tagName$);Cht(a,o,!!(r.$flags$&1)),l()}}e.$ancestorComponent$,(()=>sq(e,!0))()},zht=t=>{},Vht=t=>{if(!(yo.$flags$&1)){const e=yA(t),r=e.$cmpMeta$,i=vv("connectedCallback",r.$tagName$);e.$flags$&1?(nxe(t,e,r.$listeners$),zht(e.$lazyInstance$)):(e.$flags$|=1,r.$flags$&12&&Ght(t),r.$members$&&Object.entries(r.$members$).map(([s,[n]])=>{if(n&31&&t.hasOwnProperty(s)){const o=t[s];delete t[s],t[s]=o}}),Bht(t,e,r)),i()}},Ght=t=>{const e=t["s-cr"]=Qh.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},jht=t=>{if(!(yo.$flags$&1)){const e=yA(t);e.$rmListeners$&&(e.$rmListeners$.map(r=>r()),e.$rmListeners$=void 0)}},jOt=(t,e)=>{const r={$flags$:e[0],$tagName$:e[1]};r.$members$=e[2],r.$listeners$=e[3],r.$watchers$=t.$watchers$,r.$attrsToReflect$=[];const i=t.prototype.connectedCallback,s=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){Yht(this,r)},connectedCallback(){Vht(this),i&&i.call(this)},disconnectedCallback(){jht(this),s&&s.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)})}}),t.is=r.$tagName$,kht(t,r)},HOt=(t,e)=>e,nxe=(t,e,r,i)=>{r&&r.map(([s,n,o])=>{const a=qht(t,s),l=Hht(e,o),c=Wht(s);yo.ael(a,n,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>yo.rel(a,n,l,c))})},Hht=(t,e)=>r=>{try{Cw.lazyLoad||t.$hostElement$[e](r)}catch(i){_A(i)}},qht=(t,e)=>e&4?Qh:e&8?vA:e&16?Qh.body:t,Wht=t=>Zht?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,oxe=new WeakMap,yA=t=>oxe.get(t),Yht=(t,e)=>{const r={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return nxe(t,r,e.$listeners$),oxe.set(t,r)},sse=(t,e)=>e in t,_A=(t,e)=>(0,console.error)(t,e),xL=new Map,Xht=[],vA=typeof window<"u"?window:{},Qh=vA.document||{head:{}},qOt=vA.HTMLElement||class{},yo={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,r,i)=>t.addEventListener(e,r,i),rel:(t,e,r,i)=>t.removeEventListener(e,r,i),ce:(t,e)=>new CustomEvent(t,e)},Zht=(()=>{let t=!1;try{Qh.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),Jht=t=>Promise.resolve(t),Qht=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),Iz=[],axe=[],lxe=(t,e)=>r=>{t.push(r),$z||($z=!0,e&&yo.$flags$&4?Kht(Lz):yo.raf(Lz))},nse=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(r){_A(r)}t.length=0},Lz=()=>{nse(Iz),nse(axe),($z=Iz.length>0)&&yo.raf(Lz)},Kht=t=>Jht().then(t),WOt=lxe(Iz,!1),edt=lxe(axe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.10.0
 */const cxe="calcite-mode-auto",uxe="calcite-mode-dark",tdt="calcite-mode-light",YOt={autoMode:cxe,darkMode:uxe,lightMode:tdt,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var hxe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],TL=hxe.join(","),dxe=typeof Element>"u",bv=dxe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,SL=!dxe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},EL=function t(e,r){var i;r===void 0&&(r=!0);var s=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"inert"),n=s===""||s==="true",o=n||r&&e&&t(e.parentNode);return o},rdt=function(e){var r,i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"contenteditable");return i===""||i==="true"},pxe=function(e,r,i){if(EL(e))return[];var s=Array.prototype.slice.apply(e.querySelectorAll(TL));return r&&bv.call(e,TL)&&s.unshift(e),s=s.filter(i),s},fxe=function t(e,r,i){for(var s=[],n=Array.from(e);n.length;){var o=n.shift();if(!EL(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,i);i.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var u=bv.call(o,TL);u&&i.filter(o)&&(r||!e.includes(o))&&s.push(o);var d=o.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(o),p=!EL(d,!1)&&(!i.shadowRootFilter||i.shadowRootFilter(o));if(d&&p){var g=t(d===!0?o.children:d.children,!0,i);i.flatten?s.push.apply(s,g):s.push({scopeParent:o,candidates:g})}else n.unshift.apply(n,o.children)}}return s},mxe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},gxe=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||rdt(e))&&!mxe(e)?0:e.tabIndex},idt=function(e,r){var i=gxe(e);return i<0&&r&&!mxe(e)?0:i},sdt=function(e,r){return e.tabIndex===r.tabIndex?e.documentOrder-r.documentOrder:e.tabIndex-r.tabIndex},yxe=function(e){return e.tagName==="INPUT"},ndt=function(e){return yxe(e)&&e.type==="hidden"},odt=function(e){var r=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(i){return i.tagName==="SUMMARY"});return r},adt=function(e,r){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===r)return e[i]},ldt=function(e){if(!e.name)return!0;var r=e.form||SL(e),i=function(a){return r.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=i(window.CSS.escape(e.name));else try{s=i(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=adt(s,e.form);return!n||n===e},cdt=function(e){return yxe(e)&&e.type==="radio"},udt=function(e){return cdt(e)&&!ldt(e)},hdt=function(e){var r,i=e&&SL(e),s=(r=i)===null||r===void 0?void 0:r.host,n=!1;if(i&&i!==e){var o,a,l;for(n=!!((o=s)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(s)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!n&&s;){var c,u,d;i=SL(s),s=(c=i)===null||c===void 0?void 0:c.host,n=!!((u=s)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(s))}}return n},ose=function(e){var r=e.getBoundingClientRect(),i=r.width,s=r.height;return i===0&&s===0},ddt=function(e,r){var i=r.displayCheck,s=r.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var n=bv.call(e,"details>summary:first-of-type"),o=n?e.parentElement:e;if(bv.call(o,"details:not([open]) *"))return!0;if(!i||i==="full"||i==="legacy-full"){if(typeof s=="function"){for(var a=e;e;){var l=e.parentElement,c=SL(e);if(l&&!l.shadowRoot&&s(l)===!0)return ose(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(hdt(e))return!e.getClientRects().length;if(i!=="legacy-full")return!0}else if(i==="non-zero-area")return ose(e);return!1},pdt=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var r=e.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var i=0;i<r.children.length;i++){var s=r.children.item(i);if(s.tagName==="LEGEND")return bv.call(r,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}r=r.parentElement}return!1},CL=function(e,r){return!(r.disabled||EL(r)||ndt(r)||ddt(r,e)||odt(r)||pdt(r))},Dz=function(e,r){return!(udt(r)||gxe(r)<0||!CL(e,r))},fdt=function(e){var r=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(r)||r>=0)},mdt=function t(e){var r=[],i=[];return e.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=idt(a,o),c=o?t(s.candidates):a;l===0?o?r.push.apply(r,c):r.push(a):i.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),i.sort(sdt).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(r)},gdt=function(e,r){r=r||{};var i;return r.getShadowRoot?i=fxe([e],r.includeContainer,{filter:Dz.bind(null,r),flatten:!1,getShadowRoot:r.getShadowRoot,shadowRootFilter:fdt}):i=pxe(e,r.includeContainer,Dz.bind(null,r)),mdt(i)},XOt=function(e,r){r=r||{};var i;return r.getShadowRoot?i=fxe([e],r.includeContainer,{filter:CL.bind(null,r),flatten:!0,getShadowRoot:r.getShadowRoot}):i=pxe(e,r.includeContainer,CL.bind(null,r)),i},ZOt=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return bv.call(e,TL)===!1?!1:Dz(r,e)},ydt=hxe.concat("iframe").join(","),JOt=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return bv.call(e,ydt)===!1?!1:CL(r,e)};const _dt={getShadowRoot:!0};function QOt(t){const e="dir",r=`[${e}]`,i=vdt(t,r);return i?i.getAttribute(e):"ltr"}function _xe(t){return t.getRootNode()}function vxe(t){return t.host||null}function KOt(t,{selector:e,id:r}){function i(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=_xe(s),o=r?"getElementById"in n?n.getElementById(r):null:e?n.querySelector(e):null,a=vxe(n);return o||(a?i(a):null)}return i(t)}function vdt(t,e){function r(i){return i?i.closest(e)||r(vxe(_xe(i))):null}return r(t)}function bdt(t,e){return bxe(t,e)}function bxe(t,e){if(!t)return;const r=e(t);if(r!==void 0)return r;const{parentNode:i}=t;return bxe(i instanceof ShadowRoot?i.host:i,e)}function ePt(t,e){return!!bdt(e,r=>r===t?!0:void 0)}function wdt(t){return typeof(t==null?void 0:t.setFocus)=="function"}async function tPt(t){if(t)return wdt(t)?t.setFocus():t.focus()}function rPt(t){t&&(gdt(t,_dt)[0]||t).focus()}const _3=":not([slot])";function iPt(t,e,r){e&&!Array.isArray(e)&&typeof e!="string"&&(r=e,e=null);const i=e?Array.isArray(e)?e.map(s=>`[slot="${s}"]`).join(","):`[slot="${e}"]`:_3;return r!=null&&r.all?xdt(t,i,r):Tdt(t,i,r)}function wxe(t,e){return t?Array.from(t.children||[]).filter(r=>r==null?void 0:r.matches(e)):[]}function xdt(t,e,r){let i=e===_3?wxe(t,_3):Array.from(t.querySelectorAll(e));i=r&&r.direct===!1?i:i.filter(n=>n.parentElement===t),i=r!=null&&r.matches?i.filter(n=>n==null?void 0:n.matches(r.matches)):i;const s=r==null?void 0:r.selector;return s?i.map(n=>Array.from(n.querySelectorAll(s))).reduce((n,o)=>[...n,...o],[]).filter(n=>!!n):i}function Tdt(t,e,r){let i=e===_3?wxe(t,_3)[0]||null:t.querySelector(e);i=r&&r.direct===!1||(i==null?void 0:i.parentElement)===t?i:null,i=r!=null&&r.matches?i!=null&&i.matches(r.matches)?i:null:i;const s=r==null?void 0:r.selector;return s?i==null?void 0:i.querySelector(s):i}function sPt(t,e,r){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[r]}function nPt(t){return(!!t).toString()}function oPt(t){return Adt(t)||Edt(t)}function Sdt(t){return Cdt(t).filter(e=>e.nodeType===Node.TEXT_NODE).map(e=>e.textContent).join("").trim()}function Edt(t){return!!Sdt(t)}function Cdt(t){return t.target.assignedNodes({flatten:!0})}function Adt(t){return!!Rdt(t).length}function Rdt(t){return t.target.assignedElements({flatten:!0})}function aPt(t){return!!(t.isPrimary&&t.button===0)}function lPt(t,e){if(t.parentNode!==e.parentNode)return!1;const r=Array.from(t.parentNode.children);return r.indexOf(t)<r.indexOf(e)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.10.0
 */function ase(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>t.contains(uxe)||t.contains(cxe)&&e?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&i(o),n=o};let n=r();i(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function Odt(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?ase():document.addEventListener("DOMContentLoaded",()=>ase(),{once:!0}))}const Pdt=Odt;Pdt();let xxe;function Mdt(){try{dht(".")}catch{pht(dc(ei(xxe)))}}function $dt(t){var r;const e=[];for(const i of Object.keys(t))customElements.get(`calcite-${i}`)||e.push((r=t[i])==null?void 0:r.call(t));return e.length>0?Promise.all(e):null}xxe="components/assets";const Txe=Symbol("widget"),Sxe=Symbol("widget-test-data"),Idt=[],Ldt={},AL=new WeakMap;function Exe(t,e){let r=e.children;if(r!=null&&r.length)for(let s=0;s<r.length;++s)r[s]=Exe(t,r[s]);else r=Idt;const i=e.vnodeSelector;if(RL(i)){const s=e.properties||Ldt,n=s.key||i;return{vnodeSelector:"div",properties:{key:n,afterCreate:Ddt,afterUpdate:Ndt,afterRemoved:Cxe,parentWidget:t,widgetConstructor:i,widgetProperties:{...s,key:n,children:r}},children:void 0,text:void 0,domNode:null}}return e}function Ddt(t,e,r,{parentWidget:i,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=t,AL.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),i.addHandles(Rr(()=>Cxe(t))),queueMicrotask(()=>{o[Sxe].projector.renderNow()})}function Ndt(t,e,r,{widgetProperties:i}){var n;const s=AL.get(t);s&&(s.set(i),(n=s.afterUpdate)==null||n.call(s,s,t))}function Cxe(t){var r;const e=AL.get(t);e&&((r=e.afterRemoved)==null||r.call(e,e,t),e.destroy(),AL.delete(t))}function RL(t){return typeof t=="function"&&t[Txe]}const Hp={arrowDown:"esri-icon-arrow-down",arrowUp:"esri-icon-arrow-up",basemap:"esri-icon-basemap",bookmark:"esri-icon-bookmark",calendar:"esri-icon-calendar",checkMark:"esri-icon-check-mark",checkboxUnchecked:"esri-icon-checkbox-unchecked",close:"esri-icon-close",collapse:"esri-icon-collapse",defaultAction:"esri-icon-default-action",description:"esri-icon-description",directions:"esri-icon-directions",dockBottom:"esri-icon-dock-bottom",dockLeft:"esri-icon-dock-left",dockRight:"esri-icon-dock-right",down:"esri-icon-down",downArrow:"esri-icon-down-arrow",download:"esri-icon-download",dragHorizontal:"esri-icon-drag-horizontal",dragVertical:"esri-icon-drag-vertical",duplicate:"esri-icon-duplicate",edit:"esri-icon-edit",elevationProfile:"esri-icon-elevation-profile",environmentSettings:"esri-icon-environment-settings",erase:"esri-icon-erase",error:"esri-icon-error",expand:"esri-icon-expand",fontFallbackText:"esri-icon-font-fallback-text",forward:"esri-icon-forward",gear:"esri-icon-gear",handleHorizontal:"esri-icon-handle-horizontal",handleVertical:"esri-icon-handle-vertical",home:"esri-icon-home",icon:"esri-icon",launchLinkExternal:"esri-icon-launch-link-external",layerList:"esri-icon-layer-list",layers:"esri-icon-layers",left:"esri-icon-left",leftArrows:"esri-icon-left-arrow",leftTriangleArrow:"esri-icon-left-triangle-arrow",lineOfSight:"esri-icon-line-of-sight",link:"esri-icon-link",linkExternal:"esri-icon-link-external",linkHorizontal:"esri-icon-link-horizontal",loadingIndicator:"esri-icon-loading-indicator",locate:"esri-icon-locate",locateCircled:"esri-icon-locate-circled",locked:"esri-icon-locked",mapPin:"esri-icon-map-pin",maximize:"esri-icon-maximize",measure:"esri-icon-measure",measureArea:"esri-icon-measure-area",measureBuildingHeightShadow:"esri-icon-measure-building-height-shadow",measureLine:"esri-icon-measure-line",menu:"esri-icon-menu",minimize:"esri-icon-minimize",minus:"esri-icon-minus",nonVisible:"esri-icon-non-visible",northNavigation:"esri-icon-north-navigation",noticeTriangle:"esri-icon-notice-triangle",organization:"esri-icon-organization",pan:"esri-icon-pan",pan2:"esri-icon-pan2",partlyCloudy:"esri-icon-partly-cloudy",pause:"esri-icon-pause",play:"esri-icon-play",playCircled:"esri-icon-play-circled",plus:"esri-icon-plus",polyline:"esri-icon-polyline",printer:"esri-icon-printer",radioChecked:"esri-icon-radio-checked",radioUnchecked:"esri-icon-radio-unchecked",refresh:"esri-icon-refresh",reverse:"esri-icon-reverse",right:"esri-icon-right",rightArrow:"esri-icon-right-arrow",rightTriangleArrow:"esri-icon-right-triangle-arrow",rotate:"esri-icon-rotate",save:"esri-icon-save",search:"esri-icon-search",settings2:"esri-icon-settings2",slice:"esri-icon-slice",swap:"esri-icon-swap",table:"esri-icon-table",timeClock:"esri-icon-time-clock",tracking:"esri-icon-tracking",trash:"esri-icon-trash",unlockedLinkHorizontal:"esri-icon-unlocked-link-horizontal",up:"esri-icon-up",upArrow:"esri-icon-up-arrow",upDownArrows:"esri-icon-up-down-arrows",urbanModel:"esri-icon-urban-model",vertexGps:"esri-icon-vertex-gps",visible:"esri-icon-visible",zoomInFixed:"esri-icon-zoom-in-fixed",zoomInMagnifyingGlass:"esri-icon-zoom-in-magnifying-glass",zoomOutFixed:"esri-icon-zoom-out-fixed",zoomToObject:"esri-icon-zoom-to-object"},lse=new Set;function Fdt(t){lse.add(t),t.finally(()=>lse.delete(t))}var Axe;const Udt="esri.widgets.Widget";let kdt=0;const Bdt={widgetIcon:Hp.checkboxUnchecked};function Rxe(t,e){for(const r in e)t[r]!=null&&(typeof t[r]=="object"&&typeof e[r]=="object"?Rxe(t[r],e==null?void 0:e[r]):t[r]=e[r]);return t}const zdt=hht({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,r=/capture$/i;t.eventHandlerInterceptor=(i,s,n,o)=>{const a=e==null?void 0:e(i,s,n,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in n)||l){const c=i[2].toLowerCase()+i.slice(3),u=g=>a==null?void 0:a.call(n,g);n.addEventListener(c,u,l);const d=()=>n.removeEventListener(c,u,l),p=o.afterRemoved;o.afterRemoved=g=>{p==null||p(g),d()}}return a}},handleInterceptedEvent(t,e,r,i){const{eventPhase:s,type:n}=i,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(Ghe(),t.scheduleRender(),l[a].call(l.bind||r,i))}});let B6=!1,bn=class extends a7(Ps.EventedAccessor){constructor(t,e){super(t,e),this._attached=!1,this._projector=zdt,this._readyForTrueRender=!1,this.iconClass=Bdt.widgetIcon,this.icon=null,this.key=this,this._loadLocale=sne(async()=>{var o;if((o=this._messageBundleProps)!=null&&o.length){const a=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:l,propertyName:c})=>{if(this.destroyed)return;let u=await b7(l);this.uiStrings&&Object.keys(this.uiStrings)&&(u=Rxe(ye(u),this.uiStrings)),this[c]=u}));if(this.destroyed)return;for(const l of a)l.status==="rejected"&&ne.getLogger(this).error("widget-intl:locale-error",this.declaredClass,l.reason)}await this.loadLocale()}),Mdt();const r="esri-widget-uid-"+Wwe(),i=this.render.bind(this);this._trackingTarget=new BL(()=>this.scheduleRender());const s=()=>{var u;if(!this._readyForTrueRender||this.destroyed)return null;const o=i();let{properties:a}=o;a||(o.properties=a={});const{key:l}=a;if(l||(a.key=r),RL(o.vnodeSelector)){if(!this.visible)return{vnodeSelector:"div",properties:{key:`${r}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}}else this.visible?a.styles||(a.styles={}):(a.class="",a.styles={display:"none"}),a.styles.display||(a.styles.display="");let c=0;return(u=o.children)==null||u.forEach(d=>{if(RL(d.vnodeSelector))return;let{properties:p}=d;p||(d.properties=p={}),p.key||(p.key=`${this.id}--${c++}`)}),Exe(this,o)};this.render=()=>{if(B6)return s();let o=PDe(this)??null;if(o)return o;this._trackingTarget.clear(),B6=!0;try{o=fm(this._trackingTarget,s)}catch(a){throw console.error(a),a}finally{B6=!1}return o&&MDe(this,o),o};const n=this.beforeFirstRender();n?this._resourcesFetch=n.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),Fdt(this._resourcesFetch)}normalizeCtorArgs(t,e){const r={...t};return e&&(r.container=e),r}postInitialize(){}beforeFirstRender(){var e;const t=this.loadDependencies();return(e=this._messageBundleProps)!=null&&e.length||t?Promise.all([t,this._loadLocale()]).then(()=>{}).catch(Tq):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(Oe(this._trackingTarget),Oe(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,U4(this))}set container(t){this._get("container")||this._set("container",t)}castContainer(t){return AD(t)}get domNode(){return this.container}set domNode(t){this.container=t}get id(){var t;return this._get("id")||((t=this.container)==null?void 0:t.id)||Date.now().toString(16)+"-widget-"+kdt++}set id(t){t&&this._set("id",t)}get label(){return this.declaredClass.split(".").pop()}set label(t){this._overrideIfSome("label",t)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(t){this._set("visible",t)}get[(Axe=Txe,Sxe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(U4(this),this._projector.scheduleRender())}own(t){Vse(ne.getLogger(this.declaredClass),"`Widget.own()` is deprecated in favor of Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(t)}classes(...t){return IDe.apply(this,t)}renderNow(){U4(this),this._projector.renderNow()}_postInitialize(){var e;if(this.destroyed)return;this.scheduleRender(),(e=this._delegatedEventNames)!=null&&e.length&&this.addHandles(ae(()=>this.viewModel,(r,i)=>{i&&this.removeHandles("delegated-events"),r&&NL(r)&&this.addHandles(this._delegatedEventNames.map(s=>b2(r,s,n=>{this.emit(s,n)})),"delegated-events")},Br)),this.postInitialize();const t=async()=>{await this._loadLocale().catch(Tq),this.scheduleRender()};this.addHandles([_7(t),ae(()=>this.uiStrings,t),$u(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(t){t&&(this._projector.merge(t,this.render),this._attached=!0)}_detach(t){var e;this._attached&&(this._projector.detach(this.render),this._attached=!1),(e=t==null?void 0:t.parentNode)==null||e.removeChild(t)}};bn[Axe]=!0,h([f()],bn.prototype,"_readyForTrueRender",void 0),h([f({value:null})],bn.prototype,"container",null),h([zi("container")],bn.prototype,"castContainer",null),h([f()],bn.prototype,"iconClass",void 0),h([f()],bn.prototype,"icon",void 0),h([f()],bn.prototype,"id",null),h([f()],bn.prototype,"label",null),h([f()],bn.prototype,"renderable",null),h([f()],bn.prototype,"uiStrings",void 0),h([f()],bn.prototype,"viewModel",void 0),h([f({value:!0})],bn.prototype,"visible",null),h([f()],bn.prototype,"key",void 0),h([f()],bn.prototype,"children",void 0),h([f()],bn.prototype,"afterCreate",void 0),h([f()],bn.prototype,"afterUpdate",void 0),h([f()],bn.prototype,"afterRemoved",void 0),bn=h([k(Udt)],bn);const bA=bn;function cse(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function Vdt(t,e){return t.length!==e.length||t.some((r,i)=>r.text!==e[i].text)}function mP(t,e,r){!r||!e||t.find(i=>i.layerView===e&&i.text===r)||t.push({text:r,layerView:e})}function Gdt(t){return t.type==="bing-maps"}const Ag=[];let Ow=class extends xe{constructor(t){super(t),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new St,this.view=null,this._allLayerViewsChange=e=>{var i;this.removeHandles("suspension");const r=(i=this.view)==null?void 0:i.allLayerViews;r&&this.addHandles(r.map(s=>ae(()=>{var n;return[s.suspended,(n=s.layer)==null?void 0:n.attributionVisible]},()=>this._updateAttributionItems())).toArray(),"suspension"),e!=null&&e.removed&&e.removed.forEach(s=>{this._pendingAttributions.delete(s),this._fetchedAttributionData.delete(s)}),this._updateAttributionItems()},this.addHandles([Bo(()=>{var e;return(e=this.view)==null?void 0:e.allLayerViews},"change",e=>this._allLayerViewsChange(e),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),$u(()=>{var e;return((e=this.view)==null?void 0:e.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){var t;return(t=this.view)!=null&&t.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const t=this.view,e=t==null?void 0:t.allLayerViews;Ag.length=0,t&&e?(e.forEach(r=>{var n,o;if(r.suspended||!((n=r.layer)!=null&&n.attributionVisible))return;const i=r.layer;if(cse(i,"user"))return void mP(Ag,r,i.copyright);if(i.hasAttributionData){if(this._fetchedAttributionData.has(r)){const a=this._fetchedAttributionData.get(r);return void(a?mP(Ag,r,this._getDynamicAttribution(a,t,i)):cse(i)&&mP(Ag,r,i.copyright))}return void this._fetchAttributionData(r)}const s="portalItem"in i?(o=i.portalItem)==null?void 0:o.accessInformation:void 0;mP(Ag,r,s||i.copyright)}),Vdt(this.items,Ag)&&(this.items.removeAll(),this.items.addMany(Ag)),Ag.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(t){if(this._pendingAttributions.has(t))return;this._pendingAttributions.add(t);const e=await mm(t.layer.fetchAttributionData());if(this._pendingAttributions.has(t)){const r=e.ok?this._createContributionIndex(e.value,Gdt(t.layer)):null;this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,r)}this._updateAttributionItems()}_createContributionIndex(t,e){const r=t.contributors,i={};if(!r)return i;for(let s=0;s<r.length;s++){const n=r[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(e&&a.zoomMin?1:0),u=a.zoomMax-(e&&a.zoomMax?1:0),d=new Xr({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:at.WGS84}),p={extent:O0(d),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let g=c;g<=u;g++)i[g]??(i[g]=[]),i[g].push(p)}}return i.maxKey=Math.max.apply(null,Object.keys(i)),i}_getDynamicAttribution(t,e,r){var c;const{extent:i,scale:s}=e;let n=((c=r.tileInfo)==null?void 0:c.scaleToZoom(s))??0;if(n=Math.min(t.maxKey??0,Math.round(n)),!i||n==null||n<=-1)return"";const o=t[n],a=C3(i.center.clone().normalize(),e.spatialReference),l=new Set;return o?o.filter(u=>{const d=u.id,p=!l.has(d)&&a&&u.extent&&y7(u.extent,a);return p&&l.add(d),p}).sort((u,d)=>d.score-u.score||u.objectId-d.objectId).map(u=>u.attribution).join(", "):""}};h([f({readOnly:!0,type:St})],Ow.prototype,"items",void 0),h([f({readOnly:!0})],Ow.prototype,"state",null),h([f()],Ow.prototype,"view",void 0),Ow=h([k("esri.widgets.Attribution.AttributionViewModel")],Ow);const Oxe=Ow,vc={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",disabledElement:"esri-disabled-element",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",noBookmarksIcon:"esri-widget__no-bookmark-icon",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};function nq(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:Hdt(t[e])}}}function jdt(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function Hdt(t){return function(e,...r){jdt(e)?UDe(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...r)}}function JN(t){return(e,r)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:r})}}var qdt=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},Pxe=function(t,e){for(var r=0,i=t.length;r<i;r++){var s=t[r];Array.isArray(s)?Pxe(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=qdt(s)),e.push(s))}},Wdt=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:r[0],domNode:null};var s=[];return Pxe(r,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function Do(t,e,...r){return typeof t!="function"||RL(t)?Wdt(t,e,...r):t(e,...r)}function cPt(...t){return t}const Hb="esri-attribution",u_={base:Hb,poweredBy:`${Hb}__powered-by`,sources:`${Hb}__sources`,open:`${Hb}--open`,sourcesOpen:`${Hb}__sources--open`,link:`${Hb}__link`,widgetIcon:Hp.description};let sa=class extends bA{constructor(e,r){super(e,r),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.iconClass=u_.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new Oxe}initialize(){this.addHandles(Bo(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,r)=>(e.includes(r.text)||e.push(r.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[u_.open]:this._isOpen};return Do("div",{bind:this,class:this.classes(u_.base,vc.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return Do("div",{class:u_.poweredBy},"Powered by"," ",Do("a",{class:u_.link,href:"http://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,r=this._isInteractive,i=r?0:void 0,{attributionText:s}=this,n={[u_.sourcesOpen]:e,[vc.interactive]:r};return Do("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(u_.sources,n),innerHTML:s,tabIndex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let r=!1;const{clientHeight:i,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(r=!0),this._isOpen){const l=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,l&&(this._isOpen=!1,r=!0)}r&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};h([f()],sa.prototype,"_isOpen",void 0),h([f()],sa.prototype,"_isInteractive",null),h([f()],sa.prototype,"_attributionTextOverflowed",void 0),h([f()],sa.prototype,"_prevSourceNodeHeight",void 0),h([f({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],sa.prototype,"attributionText",null),h([f()],sa.prototype,"iconClass",void 0),h([f()],sa.prototype,"icon",void 0),h([f()],sa.prototype,"itemDelimiter",void 0),h([f()],sa.prototype,"label",null),h([f(),JN("esri/widgets/Attribution/t9n/Attribution")],sa.prototype,"messages",void 0),h([f()],sa.prototype,"view",null),h([f({type:Oxe})],sa.prototype,"viewModel",void 0),h([nq()],sa.prototype,"_toggleState",null),sa=h([k("esri.widgets.Attribution")],sa);const Ydt=sa;function Xdt(t){var e,r;return((e=t==null?void 0:t.spatialReference)==null?void 0:e.isWebMercator)||((r=t==null?void 0:t.spatialReference)==null?void 0:r.isGeographic)||!1}const Zdt=t=>{let e=class extends t{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return LL(i),this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return h([f()],e.prototype,"goToOverride",void 0),h([f()],e.prototype,"view",void 0),e=h([k("esri.widgets.support.GoTo")],e),e},Jdt="esri.widgets.CompassViewModel";let Z_=class extends Zdt(xe){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(ae(()=>this.view,this._updateRotationWatcher,zr))}destroy(){this.view=null}get canShowNorth(){return Xdt(this.view)}get state(){var e;return!((e=this.view)!=null&&e.ready)||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){var r,i;if(!((r=this.view)!=null&&r.ready))return;const e={};((i=this.view)==null?void 0:i.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const r=-e.heading;this.orientation={x:0,y:0,z:r}}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles(e.type==="2d"?ae(()=>e==null?void 0:e.rotation,this._updateForRotation,zr):ae(()=>e==null?void 0:e.camera,this._updateForCamera,zr))}};h([f({readOnly:!0})],Z_.prototype,"canShowNorth",null),h([f()],Z_.prototype,"orientation",void 0),h([f({readOnly:!0})],Z_.prototype,"state",null),h([f()],Z_.prototype,"view",void 0),Z_=h([k(Jdt)],Z_);const Mxe=Z_,use="esri-compass",z6={base:use,widgetIcon:Hp.locateCircled,iconContainer:`${use}__icon-container`};let np=class extends bA{constructor(e,r){super(e,r),this.iconClass=z6.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new Mxe,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=i=>({transform:`rotateZ(${i.z}deg)`})}loadDependencies(){return $dt({button:()=>he(()=>import("./calcite-button-b09ccd7e.js"),["./calcite-button-b09ccd7e.js","./label2-643354c2.js","./interactive-cebe64a6.js","./loadable-736feb88.js","./t9n-1d4da167.js","./observers-375e9296.js","./icon-ced4c0ed.js","./loader-0aad22a4.js"],import.meta.url),icon:()=>he(()=>import("./calcite-icon-860a926f.js"),["./calcite-icon-860a926f.js","./icon-ced4c0ed.js","./observers-375e9296.js"],import.meta.url)})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:r}=this.viewModel,i=r==="rotation"?"arrow-up":"compass-needle",{messages:s}=this;return Do("div",{class:this.classes(z6.base,vc.widget)},Do("calcite-button",{"aria-label":s.reset,class:vc.widgetButton,disabled:r==="disabled",kind:"neutral",onclick:this._reset,round:!0,scale:"s",title:s.reset},Do("div",{"aria-hidden":"true",class:z6.iconContainer,title:s.reset},Do("calcite-icon",{icon:i,scale:"m",styles:this._toRotationTransform(e)}))))}};h([f()],np.prototype,"goToOverride",null),h([f()],np.prototype,"iconClass",void 0),h([f()],np.prototype,"icon",void 0),h([f()],np.prototype,"label",null),h([f(),JN("esri/widgets/Compass/t9n/Compass")],np.prototype,"messages",void 0),h([f()],np.prototype,"view",null),h([f({type:Mxe})],np.prototype,"viewModel",void 0),np=h([k("esri.widgets.Compass")],np);const Qdt=np,qb="esri-navigation-toggle",xf={base:qb,widgetIcon:Hp.pan2,button:`${qb}__button`,activeButton:`${qb}__button--active`,panButton:`${qb}__button--pan`,rotateButton:`${qb}__button--rotate`,isLayoutHorizontal:`${qb}--horizontal`};let Pw=class extends xe{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.addHandles($u(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e,r;return(e=this.view)!=null&&e.ready&&((r=this.view)==null?void 0:r.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){var r;const e=(r=this.view)==null?void 0:r.inputManager;e&&(e.primaryDragAction=this.navigationMode==="pan"?"pan":"rotate")}};h([f({readOnly:!0})],Pw.prototype,"state",null),h([f()],Pw.prototype,"navigationMode",void 0),h([f()],Pw.prototype,"view",void 0),Pw=h([k("esri.widgets.NavigationToggleViewModel")],Pw);const $xe=Pw;let xh=class extends bA{constructor(e,r){super(e,r),this.iconClass=xf.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new $xe}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){var l,c;const e=((l=this.viewModel)==null?void 0:l.state)==="disabled",r=((c=this.viewModel)==null?void 0:c.navigationMode)==="pan",i={[vc.disabled]:e,[xf.isLayoutHorizontal]:this.layout==="horizontal"},s={[xf.activeButton]:r},n={[xf.activeButton]:!r},o=e?-1:0,a=this.messages.toggle;return Do("div",{"aria-label":a,bind:this,class:this.classes(xf.base,vc.widget,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,title:a},Do("div",{class:this.classes(xf.button,vc.widgetButton,xf.panButton,s)},Do("span",{class:Hp.pan})),Do("div",{class:this.classes(xf.button,vc.widgetButton,xf.rotateButton,n)},Do("span",{class:Hp.rotate})))}_toggle(){this.toggle()}};h([f()],xh.prototype,"iconClass",void 0),h([f()],xh.prototype,"icon",void 0),h([f()],xh.prototype,"label",null),h([f({value:"vertical"})],xh.prototype,"layout",null),h([f(),JN("esri/widgets/NavigationToggle/t9n/NavigationToggle")],xh.prototype,"messages",void 0),h([f()],xh.prototype,"view",null),h([f({type:$xe})],xh.prototype,"viewModel",void 0),h([nq()],xh.prototype,"_toggle",null),xh=h([k("esri.widgets.NavigationToggle")],xh);const Kdt=xh,ro="esri-feature",ept={base:ro,container:`${ro}__size-container`,title:`${ro}__title`,main:`${ro}__main-container`,btn:`${ro}__button`,icon:`${ro}__icon`,content:`${ro}__content`,contentNode:`${ro}__content-node`,contentNodeText:`${ro}__content-node--text`,contentElement:`${ro}__content-element`,text:`${ro}__text`,lastEditedInfo:`${ro}__last-edited-info`,fields:`${ro}__fields`,fieldHeader:`${ro}__field-header`,fieldData:`${ro}__field-data`,fieldDataDate:`${ro}__field-data--date`,loadingSpinnerContainer:`${ro}__loading-container`,spinner:`${ro}__loading-spinner`};let kf=class extends bA{constructor(){super(...arguments),this.enabled=!0,this.iconClass=null,this.icon=null,this.title=""}render(){const t=this.enabled?0:-1,e={[vc.disabled]:!this.enabled,[vc.interactive]:this.enabled};return Do("div",{bind:this,class:this.classes(vc.widgetButton,vc.widget,e),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:t,title:this.title},Do("span",{"aria-hidden":"true",class:this.classes(ept.icon,this.iconClass??""),role:"presentation"}),Do("span",{class:Hp.fontFallbackText},this.title))}_triggerAction(){this.action.call(this)}};h([f()],kf.prototype,"action",void 0),h([f()],kf.prototype,"enabled",void 0),h([f()],kf.prototype,"iconClass",void 0),h([f()],kf.prototype,"icon",void 0),h([f()],kf.prototype,"title",void 0),h([nq()],kf.prototype,"_triggerAction",null),kf=h([k("esri.widgets.IconButton")],kf);const hse=kf;let J_=class extends xe{get canZoomIn(){var r,i,s;if(!((r=this.view)==null?void 0:r.ready))return!1;const e=(s=(i=this.view)==null?void 0:i.constraints)==null?void 0:s.effectiveMaxScale;return e===0||this._scale>e}get canZoomOut(){var i;const{view:t}=this;if(!(t==null?void 0:t.ready))return!1;const r=(i=t.constraints)==null?void 0:i.effectiveMinScale;return r===0||this._scale<r}get _scale(){var e,r,i;const t=(r=(e=this.view)==null?void 0:e.animation)==null?void 0:r.target;return(t&&"then"in t||t==null?void 0:t.scale)??((i=this.view)==null?void 0:i.scale)??0}};h([f({readOnly:!0})],J_.prototype,"canZoomIn",null),h([f({readOnly:!0})],J_.prototype,"canZoomOut",null),h([f()],J_.prototype,"view",void 0),h([f()],J_.prototype,"_scale",null),J_=h([k("esri.widgets.Zoom.ZoomConditions2D")],J_);const tpt=J_;let Mw=class extends xe{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};h([f({readOnly:!0})],Mw.prototype,"canZoomIn",null),h([f({readOnly:!0})],Mw.prototype,"canZoomOut",null),h([f()],Mw.prototype,"view",void 0),Mw=h([k("esri.widgets.Zoom.ZoomConditions3D")],Mw);const rpt=Mw;let Jg=class extends xe{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return this._zoomConditions!=null&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new tpt({view:e}):e.type==="3d"&&(this._zoomConditions=new rpt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():yC(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():yC(e.goTo({zoomFactor:.5}))}};h([f()],Jg.prototype,"_zoomConditions",void 0),h([f()],Jg.prototype,"canZoomIn",null),h([f()],Jg.prototype,"canZoomOut",null),h([f({readOnly:!0})],Jg.prototype,"state",null),h([f()],Jg.prototype,"view",null),Jg=h([k("esri.widgets.Zoom.ZoomViewModel")],Jg);const Ixe=Jg,V6={base:"esri-zoom",widgetIcon:Hp.zoomInMagnifyingGlass,horizontalLayout:"esri-zoom--horizontal"};let op=class extends bA{constructor(t,e){super(t,e),this.iconClass=V6.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new Ixe}initialize(){this._zoomInButton=new hse({action:this.zoomIn.bind(this),iconClass:Hp.plus}),this._zoomOutButton=new hse({action:this.zoomOut.bind(this),iconClass:Hp.minus})}destroy(){this._zoomInButton=Oe(this._zoomInButton),this._zoomOutButton=Oe(this._zoomOutButton)}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}set layout(t){t!=="horizontal"&&(t="vertical"),this._set("layout",t)}set view(t){this.viewModel.view=t}get view(){return this.viewModel.view}render(){const t=this.viewModel,e={[V6.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:r,canZoomOut:i}=t;this._zoomInButton.enabled=r,this._zoomOutButton.enabled=i;const{zoomIn:s,zoomOut:n}=this.messages;return this._zoomInButton.title=s,this._zoomOutButton.title=n,Do("div",{class:this.classes(V6.base,vc.widget,e)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};h([f()],op.prototype,"iconClass",void 0),h([f()],op.prototype,"icon",void 0),h([f()],op.prototype,"label",null),h([f({value:"vertical"})],op.prototype,"layout",null),h([f(),JN("esri/widgets/Zoom/t9n/Zoom")],op.prototype,"messages",void 0),h([f()],op.prototype,"view",null),h([f({type:Ixe})],op.prototype,"viewModel",void 0),op=h([k("esri.widgets.Zoom")],op);const ipt=op;function spt(t){return(t==null?void 0:t.view)!==void 0}let t$=class extends sht{constructor(t){super(t),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=e=>{this.components.forEach(r=>{const i=this._find(r),s=i==null?void 0:i.widget;spt(s)&&(s.view=e)})},this._componentsWatcher=(e,r)=>{this._removeComponents(r),this._addComponents(e),this._adjustPadding(e)}}initialize(){this.addHandles([ae(()=>this.components,this._componentsWatcher,zr),ae(()=>this.view,this._updateViewAwareWidgets,zr)])}_add(t,e,r,i,s){let n=t;if(typeof t=="string"&&this._defaultPositionLookup[t]){if(this._find(t))return;n=this._createComponent(t)}super._add(n,e,r,i,s)}_removeComponents(t){t.forEach(e=>{const r=this._find(e);r&&(this.remove(r),r.destroy())})}_adjustPadding(t){if(!t.includes("attribution")&&!this._isOverridden("padding")){const{top:e}=this.padding;this.padding=e}}_addComponents(t){this.constructed&&t.forEach(e=>this.add(this._createComponent(e),this._defaultPositionLookup[e]))}_createComponent(t){const e=this._createWidget(t);return new e$({id:t,node:e})}_createWidget(t){const{view:e}=this;switch(t){case"attribution":return new Ydt({view:e});case"compass":return new Qdt({view:e});case"navigation-toggle":return new Kdt({view:e});case"zoom":return new ipt({view:e})}}};h([f()],t$.prototype,"components",void 0),t$=h([k("esri.views.ui.DefaultUI")],t$);const Lxe=t$;let r$=class extends Lxe{constructor(t){super(t),this.components=["attribution","zoom","navigation-toggle","compass"]}};h([f()],r$.prototype,"components",void 0),r$=h([k("esri.views.ui.3d.DefaultUI3D")],r$);const Dxe=r$;let ze=class extends FLe(w5e(KDe(W5e))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new xm({slicePlane:mhe},this),this._resourceController=ert(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new EB({view:this}),this.labeler=new G_({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new Hx,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new o1,this.environmentManager=new dh,this.floors=new St,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new Z5e({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new Stt,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new Dxe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new Mve,z$e(),t!=null&&t.environment||(this._defaults.environment=new uw,this.environment=this._defaults.environment);const e=(r=null)=>{r!=null&&r.type===qr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.addHandles([Bo(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",r=>e(r),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),ae(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new h7e({view:this}),this.stateManager=new ks({view:this})}initialize(){this.groundView=new l5e({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(Bo(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},zr),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},zr),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>G2e(e>0?1e3/Math.ceil(e):0),zr),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,Br),this.updatingHandles.add(()=>{var e,r;return(r=(e=this.map)==null?void 0:e.ground)==null?void 0:r.opacity},()=>this._updateDefaultHitTestOptions(),Br),this.addHandles(ae(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Fr))}destroy(){var t;this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Oe(this.sharedSymbolResources),this._set("labeler",Oe(this.labeler)),this._set("deconflictor",Oe(this.deconflictor)),this._resourceController=Oe(this._resourceController),this._set("stateManager",Oe(this.stateManager)),this._set("inputManager",Oe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Oe(this.environmentManager)),this._set("environment",Oe(this.environment)),this.groundView=Oe(this.groundView),this._exitBasemapTerrain(),(t=this._stage)==null||t.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){if(this.viewingMode==="global")return null;const t=this.map;let e=this._userClippingArea||fq(t,"clippingArea");return!this._userClippingArea&&!fq(t,"clippingEnabled")||e==null?(this._clippingArea=null,null):e instanceof Xr?this.spatialReference&&(e=gP(e,this.spatialReference),e==null)?(ne.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),e.intersection(this._groundAndLayersExtent)==null&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(ne.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?ne.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===$e.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:gP(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||at.WGS84,r=gP(this.clippingArea,e);r!=null&&(t=t!=null?t.intersection(r):r);const i=this._get("dataExtent");return t!=null&&t.equals(i)?i:t}get _groundAndLayersExtent(){const t=this.spatialReference||at.WGS84;let e;const r=n=>{const o=gP(n,t);o!=null&&(e!=null?e.union(o):e=o.clone())},i=this.basemapTerrain;if(i!=null&&i.spatialReference){const n=i.groundExtent;r(new Xr({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const n=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||r(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof uw?t:t instanceof wpe?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):uw.fromWebsceneEnvironment(t):ya(uw,t):new uw}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){var t;return this.navigating||(((t=this.toolViewManager)==null?void 0:t.interacting)??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){BM.isValidProfile(t)&&(BM.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||BM.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");Av(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?MLe(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?B3.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var s,n,o,a;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,r=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(l=>{if(l.isFulfilled()){if(l.updating){if(e=!0,l.suspended||d3(l))return;++r,t+=l.updatingProgress}}else++r});for(const l of this._updatingObjects)l!=null&&l.updating&&(r+=.1,t+=.5*.1);for(const l of this._updatingObjectsWithProgress)l!=null&&l.updating&&(++r,t+=l.updatingProgress);const i=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||i||this._createGraphicsViewController||(s=this.inputManager)!=null&&s.updating||(o=(n=this.map)==null?void 0:n.allLayers)!=null&&o.some(l=>!l.isFulfilled())||(a=this.textures)!=null&&a.updating),e?(this._numUpdating=Math.max(r,this._numUpdating),t+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const l=performance.now();if(t<1){const c=Math.min((l-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-c)+t*c}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?l:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var r;const t=this._predeterminedViewingMode;if(t!=null)return z4(t);const e=this.spatialReference;return e?((r=this.defaultsFromMap)==null?void 0:r.viewingMode)!=null&&e.equals(this.defaultsFromMap.spatialReference)?z4(this.defaultsFromMap.viewingMode):I9(e,$e.Global)?"global":"local":"global"}set viewingMode(t){this.ready?ne.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get quality(){var t,e;return((e=(t=this._resourceController)==null?void 0:t.memoryController)==null?void 0:e.memoryFactor)??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new Art(this)}on(t,e,r,i){return this.viewEvents.on(t,e,r,i)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return ne.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,i=r.graphics!=null&&(r.graphics.include!=null||r.graphics.exclude!=null),s=mX(t)?fX(this,t):t,n=Nh(s);r.enableDraped=r.include&&!r.include.has(l0)||r.exclude&&r.exclude.has(l0);const o=this.sceneIntersectionHelper,a=Du(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=i?Xn.ALL:Xn.MIN,o.intersectIntersectorScreen(n,a,r),i){for(const l of a.results.all){const c=Mz(l,this);if(c==null)return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(r.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return ne.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?_p(this.elevationProvider,t):null)??0;return Ll(t,Wb,this.renderSpatialReference,e),this.state.camera.projectToScreen(Wb,G6),Ou(G6[0],G6[1])}pixelSizeAt(t){return this.ready?t?(Ll(t,Wb,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(Wb)):0:(ne.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t,()=>this.pixelSizeAt(t)):1}hitTest(t,e){if(!this.ready)return ne.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=mX(t)?fX(this,t):t,i=Vi(r.x,r.y),s=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=Du(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=Xn.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(i,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=jie(a,this),c=l!=null&&"type"in l&&l.type==="integrated-mesh"?l:null,u={screenPoint:r,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:hd(a)?a.distanceInRenderSpace:0,layer:c}};return Zr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(u.intersector=n),Promise.resolve(u)}async popupHitTest(t){const{results:e,ground:r}=await Uut(this,t);let i=null;return!(e.length===0||Math.abs((e[0].distance??0)-r.distance)<1e-5)||r.layer&&r.layer.type==="integrated-mesh"||(i=r.mapPoint),{results:e,screenPoint:t,mapPoint:i}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new X("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return I6(r,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return L6(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e);return[L6(r[0],this._pixelFormat()),L6(r[1],this._pixelFormat())]}_completeSettings(t){const e=yut(t,this);return e.pixelRatio/=this.state.pixelRatio,wut(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!te("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e),i=I6(r[0],e,this._pixelFormat()),s=this._completeSettings(t);return s.format="png",[i,I6(r[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return TX.importLayerView(t)}hasLayerViewModule(t){return TX.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,r;return this.map&&"initialViewProperties"in this.map&&((t=this.map.initialViewProperties)==null?void 0:t.spatialReference)||((e=this.defaultsFromMap)==null?void 0:e.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=Yut(this.type);const e=te("safari");if(e&&e<9&&(t=new X("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw ne.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return t!=null?kY(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const r=this._predeterminedViewingMode;if(r!=null)return this._validateSpatialReferenceForViewingMode(t,e,r)?{constraints:this._makeSpatialReferenceConstraints(t,e,r)}:null;const i=this._validateSpatialReferenceForViewingMode(t,e,$e.Local),s=this._validateSpatialReferenceForViewingMode(t,e,$e.Global);return i||s?i&&s?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:i?{constraints:this._makeSpatialReferenceConstraints(t,e,$e.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,$e.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,r){return!!I9(t,r)&&(e==null||!!sW(e)||(!TE(e)||VN(e,t,r)!=null)&&(!iW(e)||r!==$e.Global))}_makeSpatialReferenceConstraints(t,e,r){if(e==null)return[{spatialReference:t,viewingMode:r}];const i=t.isWebMercator,s=t.isWGS84;return sW(e)&&(i||s)?!s||r===$e.Local||PH(e.tileInfo,e.fullExtent,t,$e.Global)===null?[{spatialReference:t,viewingMode:r},{spatialReference:at.WebMercator,viewingMode:r}]:[{spatialReference:i?at.WGS84:at.WebMercator,viewingMode:r}]:TE(e)||iW(e)||!i&&!s?TE(e)&&i&&r!==$e.Global?[{spatialReference:t,viewingMode:r},{spatialReference:at.WGS84,viewingMode:$e.Local}]:[{spatialReference:t,viewingMode:r}]:[{spatialReference:t,viewingMode:r},{spatialReference:i?at.WGS84:at.WebMercator,viewingMode:r}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport({spatialReference:t})!=null,r=this._predeterminedViewingMode;return e||(r!=null?ne.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${z4(r)} viewing mode.`):t.isGeographic&&ne.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let r=this.spatialReference||at.WGS84;return mo(t,this.renderSpatialReference,t,r)||(r=at.WGS84,mo(t,this.renderSpatialReference,t,r)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=r):e=new nt(t,r),e}trackGraphicState(t){if(!t.graphic)return ne.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let r=null,i=!1;const s=n=>{var o;!i&&n!=null&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(r=n.processor.graphicsCore.trackGraphicState(t))};return e!=null?s(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),Rr(()=>{i=!0,r!=null&&(r.remove(),r=null)})}highlight(t){if(Array.isArray(t))return U1(t.map(r=>this.highlight(r)));if(St.isCollection(t))return U1(t.toArray().map(r=>this.highlight(r)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):Rr()}maskOccludee(t){if(!t)return ne.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let r=null,i=!1;const s=n=>{!i&&n!=null&&But(n)&&(r=n.maskOccludee(t))};return e!=null?s(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),Rr(()=>{i=!0,r!=null&&(r.remove(),r=null)})}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await Fx(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new X("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((r,i)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(t.layer)&&(s.remove(),this.whenLayerView(t.layer).then(r,i))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,mC.INCLUDE),r=this._externalToInternalRenderItems(t.exclude,mC.EXCLUDE);return{include:e.layerUids,exclude:r.layerUids,graphics:{include:e.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(Wb)?(e=this.computeMapPointFromVec3d(Wb,e),t.intersector===Mi.TERRAIN&&this.basemapTerrain&&(e.z=_p(this.basemapTerrain,e)??0),e):null}_intersectResultsToHits(t,e){const r=new Array;let i=null;for(let s=0;s<t.length;s++){const n=t[s],o=jie(n,this);if(o!=null&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=Mz(n,this);if(a==null)continue;if(a.type==="graphic"){if(i==null&&s!==t.length-1&&(i=new Set),i!=null){const u=this._getGraphicFilterUid(a.graphic);if(i.has(u))continue;i.add(u)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;if(a.type==="media"){const u=a.element.toSource(l);r.push({...a,mapPoint:l,distance:c,sourcePoint:u})}else r.push({...a,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(t){var s;const e=t.sourceLayer,r=t.layer,i=e&&"objectIdField"in e?e:r&&"objectIdField"in r?r:e;if(i){const n=i.objectIdField??DLe,o=(s=t.attributes)==null?void 0:s[n];if(o)return`o-${i.id}-${o}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const r=this._getGraphicFilterUid(e);return t==null||(t.include==null||t.include.has(r))&&(t.exclude==null||!t.exclude.has(r))}_externalToInternalRenderItems(t,e,r={layerUids:void 0,graphicUids:void 0}){if(!t)return r;if(t instanceof iv)npt(r,this._getGraphicFilterUid(t)),e===mC.INCLUDE&&(this.graphicsView!=null&&t.layer===this?WT(r,this.graphicsView.processor.layer.id):t.layer&&WT(r,t.layer.uid));else if(q6(t))for(const i of t)i===this.graphics&&this.graphicsView!=null?WT(r,this.graphicsView.processor.layer.id):i===this.map.ground?WT(r,l0):this._externalToInternalRenderItems(i,e,r);else"uid"in t&&WT(r,t.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new hot({view:this})),this._set("elevationProvider",new nE({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Na({view:this})),this._set("featureTiles",new Vn({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var r;const e=(r=this.basemapTerrain)==null?void 0:r.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const i=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?Pm(nD(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>Zr.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(he(()=>import("./FeatureTileTree3DDebugger-fb508e23.js"),["./FeatureTileTree3DDebugger-fb508e23.js","./TileTreeDebugger-8a24bf3f.js"],import.meta.url)).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&Zr.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):e||!this._featureTreeDebugger||Zr.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Br),this.updatingHandles.add(()=>this.clippingArea,t,Br),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,Br)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new Dtt(this.map,t));const e=this.state.isGlobal,r=PLe(e,t);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",ktt.create(this.state.viewingMode,r)),e||this.addHandles(ae(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.extent},i=>{const s=this.renderCoordsHelper.spatialReference;i==null||i[0]===0&&i[1]===0&&i[2]===0&&i[3]===0||!OD(i,this.basemapTerrain.spatialReference,dse,s)||(this.renderCoordsHelper.extent=dse)},Fr),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Yx/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===qr.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(ae(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),Fr),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e,r){if(!this.overlay||!this.overlay.hasVisibleItems)return r;const i=t.getContext("2d");return i.putImageData(r,0,0),this.overlay.renderCanvas(t,{disableDecorations:e===Al.OFF}),i.getImageData(0,0,r.width,r.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(i,s,n)=>this._renderScreenshotOverlay(i,s,n)}},e=new Ett(this.state.viewingMode,i=>this._stage.layers.forAll(i),this);this._set("sceneIntersectionHelper",e);const r=AD(this.surface);this._stage=new Ql({view:this,options:t,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,i=>this._stage.renderer.setParameters({highQualityTransparency:i}),zr),ae(()=>this.magnifier,i=>this._stage.renderView.magnifier=i,Br),this.on("pointer-move",()=>{var i;return(i=this._stage)==null?void 0:i.renderer.resetAnimation()}),b2(this._stage.renderView.canvas,"webglcontextlost",i=>this.fatalError=new X("webgl-context-lost",i.statusMessage))],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Yx/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Oe(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new Prt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await he(()=>import("./GraphicsView3D-ed2632a7.js"),["./GraphicsView3D-ed2632a7.js","./GraphicsProcessor-4211cdcd.js","./diffUtils-ef6bbcbf.js","./Query-8ec96004.js","./Graphics3DObjectStates-7c6ad957.js","./UniqueValueRenderer-3d9243c5.js","./ColorStop-2602b4bf.js","./colorRamps-b2150d6f.js","./jsonUtils-46c07947.js","./DictionaryLoader-4dd3c670.js","./FieldsIndex-6b49ca64.js","./UnknownTimeZone-ab7c6b01.js","./heatmapUtils-2351b1fb.js","./defaults-06f3d090.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-865d3f13.js","./PooledRBush-6417eb86.js","./quickselect-29477ff4.js","./popupUtils-ef16fd02.js"],import.meta.url)).default;wt(t),await Fx(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){var r;const t=kY(this.viewingMode);if(t===$e.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(Bo(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const{map:i}=this,s=i&&"initialViewProperties"in i?(r=i.initialViewProperties)==null?void 0:r.environment:void 0;s&&(this.environment=s)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new Ww(this._stage,this.resourceController.scheduler));const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(i=>i(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",Oe(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(l0);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(l0);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}};function WT(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function npt(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function gP(t,e){return t!=null&&Bp(t.spatialReference,e)?Pm(t,e):null}var mC;ze.type="3d",h([f()],ze.prototype,"_userClippingArea",void 0),h([f()],ze.prototype,"_resourceController",void 0),h([f()],ze.prototype,"_stage",void 0),h([f({readOnly:!0})],ze.prototype,"deconflictor",void 0),h([f({readOnly:!0})],ze.prototype,"labeler",void 0),h([f(c9(Hx,"analyses"))],ze.prototype,"analyses",void 0),h([f({type:Jx,readOnly:!0})],ze.prototype,"animation",null),h([f({readOnly:!0})],ze.prototype,"basemapTerrain",void 0),h([f({readOnly:!0})],ze.prototype,"elevationProvider",void 0),h([f()],ze.prototype,"camera",null),h([f({type:Il})],ze.prototype,"contentCamera",null),h([f({readOnly:!0})],ze.prototype,"canvas",void 0),h([f({type:nt})],ze.prototype,"center",null),h([f({type:Xr})],ze.prototype,"clippingArea",null),h([f({type:o1})],ze.prototype,"constraints",void 0),h([f({type:Xr,readOnly:!0})],ze.prototype,"renderDataExtent",null),h([f({type:Xr,readOnly:!0})],ze.prototype,"dataExtent",null),h([f({type:Xr,readOnly:!0})],ze.prototype,"_groundAndLayersExtent",null),h([f({value:null,type:uw})],ze.prototype,"environment",null),h([zi("environment")],ze.prototype,"castEnvironment",null),h([f({readOnly:!0})],ze.prototype,"environmentManager",void 0),h([f({type:Xr})],ze.prototype,"extent",null),h([f()],ze.prototype,"floors",void 0),h([f()],ze.prototype,"screenCenter",null),h([f()],ze.prototype,"frustum",null),h([f({type:Number,readOnly:!0})],ze.prototype,"fullOpacity",void 0),h([f({readOnly:!0})],ze.prototype,"graphicsView",void 0),h([f({readOnly:!0})],ze.prototype,"analysisViewManager",void 0),h([f()],ze.prototype,"groundView",void 0),h([f({type:Boolean})],ze.prototype,"initialExtentRequired",null),h([f()],ze.prototype,"_defaultsFromMapSettings",null),h([f()],ze.prototype,"interacting",null),h([f()],ze.prototype,"stationary",null),h([f()],ze.prototype,"navigating",null),h([f()],ze.prototype,"map",void 0),h([f({readOnly:!0})],ze.prototype,"mapCoordsHelper",void 0),h([f()],ze.prototype,"padding",null),h([f({type:Na,readOnly:!0})],ze.prototype,"pointsOfInterest",void 0),h([f({type:Vn,readOnly:!0})],ze.prototype,"featureTiles",void 0),h([f()],ze.prototype,"_featureTreeDebugger",void 0),h([f({type:Boolean})],ze.prototype,"screenSizePerspectiveEnabled",void 0),h([f({constructOnly:!0})],ze.prototype,"deactivatedWebGLExtensions",void 0),h([f({constructOnly:!0})],ze.prototype,"debugWebGLExtensions",void 0),h([f({constructOnly:!0})],ze.prototype,"renderCanvas",void 0),h([f({constructOnly:!0})],ze.prototype,"state",void 0),h([f({readOnly:!0})],ze.prototype,"inputManager",void 0),h([f({readOnly:!0})],ze.prototype,"stateManager",void 0),h([f({type:["low","medium","high"]})],ze.prototype,"qualityProfile",null),h([f({type:Dee,get(){let t=this._get("qualitySettings");return t||(t=new Dee,BM.apply(this.qualityProfile,t)),t}})],ze.prototype,"qualitySettings",void 0),h([f()],ze.prototype,"slicePlane",null),h([f({readOnly:!0})],ze.prototype,"typeSpecificPreconditionsReady",null),h([f({readOnly:!0})],ze.prototype,"renderCoordsHelper",void 0),h([f({readOnly:!0})],ze.prototype,"sceneIntersectionHelper",void 0),h([f({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],ze.prototype,"resolution",null),h([f({type:Number})],ze.prototype,"scale",null),h([f()],ze.prototype,"heightModelInfo",null),h([f()],ze.prototype,"spatialReference",void 0),h([f({type:Boolean,constructOnly:!0})],ze.prototype,"alphaCompositingEnabled",void 0),h([f({constructOnly:!0})],ze.prototype,"preserveDrawingBufferEnabled",void 0),h([f({type:Boolean})],ze.prototype,"supersampleScreenshotsEnabled",void 0),h([f({readOnly:!0})],ze.prototype,"type",void 0),h([f(),zi(t=>t instanceof Lxe?t:Tx(Dxe,t))],ze.prototype,"ui",void 0),h([f({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],ze.prototype,"updating",null),h([f()],ze.prototype,"_updatingObjects",null),h([f()],ze.prototype,"_updatingObjectsWithProgress",null),h([f({type:Number,readOnly:!0,dependsOn:["updating"]})],ze.prototype,"updatingProgress",void 0),h([f({type:["global","local"]})],ze.prototype,"viewingMode",null),h([f({type:id})],ze.prototype,"viewpoint",null),h([f({type:Number})],ze.prototype,"zoom",null),h([f({type:Mve})],ze.prototype,"highlightOptions",void 0),h([f({readOnly:!0})],ze.prototype,"quality",null),h([f({readOnly:!0})],ze.prototype,"resolutionScale",null),h([f()],ze.prototype,"textures",void 0),ze=h([k("esri.views.SceneView")],ze),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(mC||(mC={}));const Wb=E(),G6=Vi(),dse=Gt(),opt=ze,apt=new Yae({basemap:"satellite"}),pse=new opt({map:apt,center:[13.4,52.5],zoom:5,container:"viewDiv"}),lpt=new Il({position:[13.392154,52.512202,300],tilt:60});pse.on("click",()=>pse.goTo(lpt));export{dlt as $,iwe as A,xat as B,Tfe as C,UI as D,D8e as E,Q7e as F,vje as G,fje as H,qot as I,Vit as J,zit as K,jN as L,Git as M,MWe as N,XI as O,Zat as P,hwe as Q,Kat as R,l6e as S,awe as T,lwe as U,Yat as V,lp as W,JH as X,slt as Y,ult as Z,rbe as _,ofe as a,Wvt as a$,flt as a0,GGe as a1,QGe as a2,Mj as a3,YN as a4,Clt as a5,nYe as a6,Swe as a7,Olt as a8,Zlt as a9,hit as aA,Br as aB,cy as aC,Ml as aD,Ys as aE,he as aF,JE as aG,sne as aH,Rr as aI,Bo as aJ,nD as aK,Pi as aL,U1 as aM,jse as aN,Fl as aO,Ds as aP,R as aQ,Ue as aR,h2 as aS,qs as aT,nH as aU,Nv as aV,Ft as aW,Fi as aX,hs as aY,qvt as aZ,e3 as a_,cZe as aa,sJe as ab,GKe as ac,cet as ad,ret as ae,Yh as af,zr as ag,h as ah,f as ai,Np as aj,k as ak,G7 as al,Oe as am,yW as an,xe as ao,Bp as ap,X as aq,$u as ar,D0 as as,soe as at,St as au,ae as av,Fr as aw,V1 as ax,FB as ay,iv as az,v8e as b,Q7 as b$,ui as b0,mo as b1,at as b2,rd as b3,rt as b4,pe as b5,se as b6,ne as b7,E as b8,RC as b9,ft as bA,U0 as bB,Kmt as bC,oce as bD,pXe as bE,kse as bF,Hi as bG,tV as bH,d2 as bI,Gmt as bJ,N3 as bK,Kh as bL,Fo as bM,R7 as bN,Jt as bO,me as bP,ED as bQ,xv as bR,It as bS,j6 as bT,xse as bU,XPe as bV,pce as bW,lgt as bX,cgt as bY,igt as bZ,OC as b_,Os as ba,h2t as bb,d2t as bc,qAe as bd,LVe as be,Tm as bf,Owt as bg,JTt as bh,ISt as bi,ct as bj,E3 as bk,xt as bl,MSt as bm,TCe as bn,Wmt as bo,iMe as bp,Xr as bq,qo as br,vV as bs,qe as bt,_0 as bu,yV as bv,Wce as bw,l$e as bx,Ev as by,k3 as bz,bfe as c,q$ as c$,ma as c0,mne as c1,agt as c2,h8 as c3,jmt as c4,ZOe as c5,td as c6,Q3 as c7,$3 as c8,mm as c9,te as cA,Vo as cB,Pc as cC,si as cD,nHe as cE,V7 as cF,$x as cG,lD as cH,qyt as cI,kr as cJ,Yft as cK,sft as cL,rm as cM,Eoe as cN,pSe as cO,Tne as cP,Ggt as cQ,Xae as cR,wft as cS,Lc as cT,rHe as cU,Hyt as cV,wMe as cW,mce as cX,egt as cY,fgt as cZ,oMe as c_,wt as ca,z1 as cb,dG as cc,Coe as cd,Au as ce,ly as cf,Qi as cg,JT as ch,Aue as ci,Pm as cj,nt as ck,Uh as cl,S2 as cm,ngt as cn,ogt as co,Nmt as cp,sPe as cq,H0 as cr,kmt as cs,Umt as ct,Fmt as cu,ni as cv,ya as cw,st as cx,ye as cy,$ve as cz,qfe as d,pmt as d$,H$ as d0,Ymt as d1,tgt as d2,A$ as d3,K$e as d4,v2 as d5,CTt as d6,cmt as d7,T5e as d8,G5e as d9,oft as dA,uft as dB,Dgt as dC,pm as dD,A3e as dE,Koe as dF,eae as dG,qr as dH,bP as dI,fGe as dJ,tn as dK,v3 as dL,Mgt as dM,r2t as dN,Gt as dO,Mu as dP,Lmt as dQ,A0t as dR,qh as dS,G1 as dT,eP as dU,B7 as dV,k7 as dW,qae as dX,z7 as dY,xmt as dZ,$be as d_,Fx as da,Zyt as db,c3t as dc,PH as dd,a7 as de,Ps as df,Yr as dg,C3 as dh,Itt as di,rEe as dj,Ht as dk,dIe as dl,ahe as dm,wne as dn,DL as dp,dV as dq,Nx as dr,$C as ds,Zse as dt,wc as du,KMe as dv,TC as dw,e$e as dx,Wwe as dy,GL as dz,d9e as e,Nr as e$,T1 as e0,z3 as e1,zx as e2,y8 as e3,_s as e4,g8 as e5,v8 as e6,S$ as e7,Cue as e8,Xft as e9,qRt as eA,pL as eB,tRt as eC,dat as eD,v1e as eE,hEe as eF,iHe as eG,sgt as eH,CHe as eI,AHe as eJ,M3 as eK,zye as eL,Zxt as eM,Xxt as eN,EC as eO,pv as eP,oy as eQ,ZPe as eR,dgt as eS,YPe as eT,hgt as eU,No as eV,T3e as eW,Jxt as eX,uHe as eY,YT as eZ,Ni as e_,o3 as ea,wCe as eb,eit as ec,Zt as ed,Krt as ee,xC as ef,B3 as eg,oM as eh,Eq as ei,B5e as ej,cft as ek,Wn as el,qft as em,GOt as en,jOt as eo,qOt as ep,QOt as eq,Zwe as er,nPt as es,_ht as et,dht as eu,xc as ev,mpt as ew,cat as ex,uat as ey,rat as ez,x9e as f,z1e as f$,sv as f0,Cp as f1,Bu as f2,os as f3,Q$ as f4,vpt as f5,ySe as f6,Sx as f7,i7 as f8,a2e as f9,cpt as fA,Bxe as fB,Wft as fC,Go as fD,ECe as fE,B0 as fF,zOt as fG,Cnt as fH,ugt as fI,Ott as fJ,Ptt as fK,Tx as fL,W3e as fM,ie as fN,De as fO,ge as fP,F2e as fQ,Sq as fR,XTt as fS,gC as fT,uy as fU,V$e as fV,ift as fW,pft as fX,B1e as fY,OQe as fZ,yH as f_,zAe as fa,Gyt as fb,Lpt as fc,Mvt as fd,GA as fe,HMe as ff,Zne as fg,$pt as fh,kL as fi,S3 as fj,VCt as fk,Dc as fl,TD as fm,C0t as fn,E$ as fo,ooe as fp,Dmt as fq,Qs as fr,$h as fs,dc as ft,zi as fu,w2 as fv,Adt as fw,WOt as fx,oPt as fy,VOt as fz,$G as g,zz as g$,_H as g0,ev as g1,V1e as g2,wJe as g3,QB as g4,dit as g5,cyt as g6,Mae as g7,LL as g8,K4e as g9,h0e as gA,Tj as gB,Cwt as gC,Awt as gD,Q1 as gE,Ic as gF,$wt as gG,bpt as gH,Lo as gI,ja as gJ,pvt as gK,aD as gL,Pn as gM,Gi as gN,E1 as gO,jL as gP,Zr as gQ,Uo as gR,ym as gS,As as gT,DOt as gU,V8 as gV,Ol as gW,Mr as gX,MGe as gY,iG as gZ,Bz as g_,mW as ga,ur as gb,est as gc,zut as gd,T8 as ge,jn as gf,K$ as gg,PC as gh,IL as gi,wEe as gj,xEe as gk,TEe as gl,SEe as gm,qrt as gn,Kpt as go,Qpt as gp,G4 as gq,Qoe as gr,tv as gs,GVe as gt,Rs as gu,jgt as gv,qgt as gw,DSt as gx,bCe as gy,Ewt as gz,gUe as h,zIe as h$,jxe as h0,upt as h1,I2 as h2,d7 as h3,tG as h4,JV as h5,G0t as h6,Z0t as h7,eG as h8,Rn as h9,H7 as hA,Mh as hB,_W as hC,KOt as hD,vdt as hE,lPt as hF,$w as hG,m9 as hH,Nxt as hI,gQ as hJ,emt as hK,Ixt as hL,bc as hM,hmt as hN,Tmt as hO,$Ae as hP,mmt as hQ,dmt as hR,C8 as hS,Ga as hT,hi as hU,ds as hV,IIe as hW,Gh as hX,ud as hY,O1 as hZ,h0t as h_,ee as ha,le as hb,UGe as hc,Zs as hd,PGe as he,j3 as hf,Ls as hg,L7 as hh,z0 as hi,uEe as hj,Mxt as hk,lX as hl,fy as hm,Dwt as hn,Lwt as ho,oI as hp,iy as hq,BI as hr,nA as hs,Sl as ht,Lu as hu,ir as hv,qx as hw,sNe as hx,WV as hy,oIe as hz,Uje as i,F as i$,Ii as i0,ei as i1,dz as i2,pz as i3,jyt as i4,lpe as i5,Wyt as i6,Yyt as i7,Hmt as i8,qmt as i9,zEe as iA,Ex as iB,kxt as iC,F0 as iD,DLe as iE,Tpt as iF,zTe as iG,qTe as iH,X6 as iI,XTe as iJ,Tp as iK,jxt as iL,dr as iM,Rl as iN,qa as iO,b as iP,us as iQ,Nl as iR,Ze as iS,Ee as iT,L as iU,FI as iV,tf as iW,Qe as iX,_r as iY,Dl as iZ,ve as i_,YAe as ia,WAe as ib,gAe as ic,oW as id,K1 as ie,Rgt as ig,UE as ih,c9 as ii,M0 as ij,j8 as ik,Cmt as il,Kw as im,xSe as io,Dp as ip,Rdt as iq,rPt as ir,HOt as is,sPt as it,iPt as iu,ASe as iv,Bve as iw,hc as ix,umt as iy,hme as iz,Qye as j,Dx as j$,oi as j0,Sr as j1,vr as j2,Et as j3,Bm as j4,ZD as j5,vy as j6,Xa as j7,vN as j8,Ut as j9,rr as jA,Ar as jB,Vh as jC,Di as jD,He as jE,ri as jF,ktt as jG,$e as jH,PLe as jI,u0 as jJ,$s as jK,Xn as jL,sG as jM,ROt as jN,cSt as jO,Aet as jP,PTt as jQ,GTt as jR,OTt as jS,ATt as jT,Iw as jU,cXe as jV,RTt as jW,Eue as jX,i4 as jY,eY as jZ,Smt as j_,Gp as ja,ny as jb,by as jc,xN as jd,ga as je,tH as jf,bN as jg,oe as jh,eYe as ji,EG as jj,z2 as jk,Je as jl,eN as jm,hwt as jn,Hge as jo,yj as jp,PZe as jq,$Ze as jr,lvt as js,cd as jt,$N as ju,Oc as jv,hpt as jw,kpt as jx,Iv as jy,Mi as jz,pst as k,MJe as k$,$gt as k0,gpt as k1,Hz as k2,rv as k3,Xyt as k4,P3 as k5,ld as k6,S8 as k7,hft as k8,_C as k9,Le as kA,O3 as kB,ePt as kC,mZ as kD,M1e as kE,I1e as kF,kZe as kG,jc as kH,iC as kI,nC as kJ,c1e as kK,rQe as kL,OZe as kM,DHe as kN,wm as kO,Gye as kP,Kft as kQ,FHe as kR,PJe as kS,SJe as kT,EJe as kU,$Je as kV,AJe as kW,RJe as kX,nd as kY,CJe as kZ,jo as k_,nmt as ka,di as kb,rct as kc,WL as kd,I7 as ke,p4 as kf,mr as kg,cV as kh,roe as ki,bV as kj,Joe as kk,Eyt as kl,Xt as km,jI as kn,Ki as ko,i_e as kp,zm as kq,Ti as kr,Ot as ks,Fh as kt,ce as ku,uee as kv,Hw as kw,ho as kx,Mn as ky,mvt as kz,Tqe as l,Zxe as l$,X3 as l0,iN as l1,cn as l2,NHe as l3,OJe as l4,nN as l5,Te as l6,Uu as l7,Mv as l8,yx as l9,iSt as lA,WB as lB,ln as lC,Nh as lD,lmt as lE,l0t as lF,ej as lG,Cv as lH,Du as lI,l0 as lJ,Vi as lK,M as lL,Aft as lM,b3 as lN,nne as lO,Dpt as lP,smt as lQ,fpt as lR,MLe as lS,W2e as lT,Vpt as lU,zpt as lV,Kxt as lW,Qxt as lX,Gpt as lY,Bpt as lZ,Ese as l_,_a as la,Cb as lb,BL as lc,fm as ld,rgt as le,Jmt as lf,Tq as lg,Uxt as lh,Xmt as li,Zmt as lj,Qmt as lk,MC as ll,mD as lm,pgt as ln,l0e as lo,e0t as lp,h7 as lq,r0t as lr,t0t as ls,pp as lt,HC as lu,po as lv,FC as lw,_p as lx,Ss as ly,V3 as lz,N_e as m,nft as m$,_mt as m0,tPt as m1,_dt as m2,JOt as m3,gdt as m4,XOt as m5,ZOt as m6,gxe as m7,aPt as m8,YOt as m9,hr as mA,Ac as mB,Qt as mC,Ci as mD,yy as mE,my as mF,p_t as mG,jC as mH,m_t as mI,h_t as mJ,Q9 as mK,d_t as mL,lSt as mM,_7 as mN,Zft as mO,b7 as mP,Vs as mQ,At as mR,hMe as mS,k0 as mT,JN as mU,bA as mV,Do as mW,zmt as mX,M0t as mY,$se as mZ,Jz as m_,$m as ma,yhe as mb,lLe as mc,LOt as md,Ao as me,Hft as mf,yC as mg,cUe as mh,Vgt as mi,BHe as mj,Ift as mk,Ou as ml,Am as mm,Ch as mn,xl as mo,gG as mp,mG as mq,sae as mr,$r as ms,y0t as mt,HIe as mu,Ll as mv,dFe as mw,_Le as mx,E0t as my,nr as mz,o8e as n,pd as n$,b2 as n0,KTe as n1,VL as n2,dft as n3,fIe as n4,Ov as n5,UFe as n6,fu as n7,ke as n8,tr as n9,zfe as nA,Pr as nB,Li as nC,W0e as nD,Ir as nE,Cc as nF,N8 as nG,lv as nH,KD as nI,zu as nJ,_y as nK,Zn as nL,Xe as nM,Eme as nN,wr as nO,_e as nP,ko as nQ,Si as nR,$ce as nS,q0t as nT,W0t as nU,X0t as nV,lV as nW,co as nX,rhe as nY,_D as nZ,Ke as n_,Jft as na,XL as nb,Amt as nc,qp as nd,aft as ne,ine as nf,XEe as ng,Pse as nh,gv as ni,Gne as nj,s7 as nk,rft as nl,O0 as nm,dEe as nn,Nq as no,zce as np,de as nq,V0t as nr,H0t as ns,Ogt as nt,UMe as nu,P_ as nv,xI as nw,Vr as nx,Igt as ny,dwt as nz,bYe as o,imt as o$,Cr as o0,yr as o1,SOt as o2,lUe as o3,ZEt as o4,yp as o5,OD as o6,$ae as o7,Rye as o8,XS as o9,a2 as oA,yc as oB,eGe as oC,eB as oD,Jj as oE,b1e as oF,fSt as oG,d1e as oH,JB as oI,dH as oJ,e7 as oK,Iu as oL,DZe as oM,p1e as oN,g1e as oO,NZe as oP,LZe as oQ,FZe as oR,Dm as oS,IZe as oT,XX as oU,u1t as oV,Mc as oW,lk as oX,MZe as oY,c1t as oZ,f2t as o_,phe as oa,NOt as ob,ck as oc,Nu as od,AN as oe,Pt as of,Ya as og,Ul as oh,Za as oi,Wo as oj,gc as ok,d0t as ol,G3 as om,JD as on,xme as oo,u0t as op,V7e as oq,k8e as or,$c as os,R1t as ot,C1t as ou,A1t as ov,SIe as ow,tx as ox,vWe as oy,bWe as oz,_v as p,kye as p$,rmt as p0,ot as p1,pX as p2,FVe as p3,Swt as p4,$V as p5,omt as p6,Yn as p7,p0t as p8,dI as p9,Kx as pA,$Ot as pB,MOt as pC,R3 as pD,vmt as pE,dvt as pF,hX as pG,Xd as pH,Oo as pI,Tce as pJ,UNe as pK,gIe as pL,Uue as pM,Jf as pN,$i as pO,_1e as pP,BZe as pQ,Fz as pR,RNe as pS,lft as pT,uTe as pU,f0 as pV,t2t as pW,mQ as pX,i2t as pY,Wxt as pZ,Fye as p_,Rue as pa,bmt as pb,dX as pc,Xp as pd,EV as pe,ige as pf,Pu as pg,sd as ph,e2 as pi,qn as pj,wN as pk,Ige as pl,W7e as pm,_j as pn,Bh as po,Pgt as pp,MV as pq,f_t as pr,VC as ps,Y1 as pt,f0t as pu,XN as pv,tI as pw,XWe as px,POt as py,Gxt as pz,kst as q,J$e as q$,Dye as q0,bE as q1,vE as q2,wQ as q3,kHe as q4,Pxt as q5,jae as q6,Emt as q7,wAe as q8,fmt as q9,W as qA,yY as qB,Dce as qC,Nse as qD,qxe as qE,Qft as qF,B1 as qG,u4e as qH,COt as qI,FO as qJ,c_e as qK,Uot as qL,mIe as qM,j0t as qN,i0t as qO,XY as qP,vx as qQ,cvt as qR,Vx as qS,xs as qT,Tve as qU,O2 as qV,zt as qW,jye as qX,Hye as qY,Pwt as qZ,Tue as q_,qEe as qa,KEe as qb,Bye as qc,y7 as qd,Uft as qe,Qpe as qf,D6e as qg,fa as qh,_0t as qi,hFe as qj,c2 as qk,Y0 as ql,ki as qm,m0t as qn,g0t as qo,X0 as qp,Pp as qq,_Z as qr,Jn as qs,Ns as qt,N$ as qu,Mft as qv,Pft as qw,NC as qx,Sue as qy,Q$e as qz,XH as r,Ec as r$,wi as r0,Dw as r1,Ux as r2,U0e as r3,Pj as r4,s8e as r5,S1e as r6,Jne as r7,ohe as r8,zE as r9,c_t as rA,Yee as rB,fz as rC,sh as rD,uL as rE,UC as rF,NV as rG,Ox as rH,amt as rI,CBe as rJ,FV as rK,oae as rL,Rx as rM,she as rN,dLe as rO,vm as rP,DD as rQ,BNe as rR,c0t as rS,bZ as rT,fvt as rU,T3 as rV,Av as rW,jvt as rX,Wr as rY,x0t as rZ,z3e as r_,$St as ra,Gx as rb,VIe as rc,sm as rd,CN as re,Ur as rf,VAt as rg,xft as rh,UL as ri,Ipt as rj,WC as rk,Iwt as rl,Rfe as rm,lde as rn,Y0t as ro,E0 as rp,MIe as rq,kY as rr,fW as rs,ztt as rt,Nee as ru,Sse as rv,Uz as rw,fft as rx,u_t as ry,fG as rz,_at as s,zGe as s$,n3t as s0,hL as s1,vl as s2,bl as s3,yz as s4,mz as s5,_z as s6,gz as s7,Xee as s8,PQe as s9,P2 as sA,Jet as sB,Sj as sC,Ts as sD,dtt as sE,Bue as sF,Lpe as sG,OV as sH,Z1 as sI,Mpe as sJ,$Fe as sK,Rm as sL,PD as sM,NE as sN,ID as sO,fhe as sP,v0t as sQ,zFe as sR,Cft as sS,Bxt as sT,wmt as sU,ppt as sV,C3t as sW,ymt as sX,zxt as sY,wl as sZ,Mpt as s_,LT as sa,wD as sb,SD as sc,xD as sd,F3 as se,CMe as sf,Zet as sg,Wje as sh,Hje as si,ZFe as sj,_xt as sk,yxt as sl,xm as sm,o2t as sn,An as so,uo as sp,rCt as sq,Kj as sr,go as ss,Wpt as st,lc as su,Vxt as sv,_Y as sw,Dxt as sx,bGe as sy,bD as sz,ewe as t,U2e as t$,Kl as t0,Or as t1,dd as t2,ef as t3,en as t4,Rt as t5,ii as t6,nm as t7,zp as t8,Dt as t9,o3t as tA,K0e as tB,h1 as tC,Zee as tD,ZCt as tE,KCt as tF,u1 as tG,YCt as tH,aAt as tI,r6 as tJ,MM as tK,zo as tL,Fu as tM,lye as tN,mu as tO,wrt as tP,xrt as tQ,tHe as tR,xce as tS,l_t as tT,gE as tU,xPe as tV,Fp as tW,kMe as tX,s2t as tY,e2t as tZ,A$e as t_,ut as ta,Ve as tb,Yxt as tc,$v as td,WTt as te,QHe as tf,YTt as tg,qye as th,Xpt as ti,BC as tj,VCe as tk,M$ as tl,ZL as tm,VHe as tn,zHe as to,c2t as tp,Ro as tq,LSt as tr,Hgt as ts,i2e as tt,Wgt as tu,Dft as tv,Lft as tw,Nft as tx,vTe as ty,JCt as tz,Ufe as u,$Tt as u$,Wst as u0,iF as u1,sF as u2,Hxt as u3,uz as u4,q0 as u5,Pbe as u6,Kst as u7,Abe as u8,pnt as u9,UTt as uA,FTt as uB,Eet as uC,kTt as uD,BTt as uE,fK as uF,gK as uG,mK as uH,DTt as uI,NTt as uJ,Mte as uK,xte as uL,Tte as uM,Ste as uN,jte as uO,yre as uP,bre as uQ,$te as uR,_re as uS,vD as uT,H_e as uU,zTt as uV,iXe as uW,sXe as uX,ITt as uY,LTt as uZ,j_e as u_,Wg as ua,BH as ub,kH as uc,_te as ud,Zst as ue,bte as uf,tXe as ug,AXe as uh,RP as ui,Bte as uj,Dte as uk,vAe as ul,Nte as um,Qte as un,Fte as uo,Gte as up,ore as uq,are as ur,lre as us,cre as ut,gmt as uu,Lgt as uv,MTt as uw,VTt as ux,Jte as uy,tre as uz,SUe as v,u2t as v$,Oet as v0,nXe as v1,rV as v2,Bmt as v3,$dt as v4,vc as v5,P0t as v6,LDe as v7,Hp as v8,IDe as v9,$0 as vA,m0e as vB,w0t as vC,_m as vD,GFe as vE,SS as vF,P0 as vG,I8 as vH,T0t as vI,b0t as vJ,eLe as vK,NIe as vL,T7 as vM,$o as vN,OIe as vO,IV as vP,jft as vQ,zgt as vR,Qn as vS,xx as vT,Vz as vU,Dyt as vV,hZe as vW,fv as vX,s0t as vY,o0t as vZ,Rwt as v_,HTt as va,PL as vb,aMe as vc,Qut as vd,N2e as ve,nMe as vf,W$ as vg,X$ as vh,ypt as vi,ept as vj,cPt as vk,NY as vl,ZTt as vm,qTt as vn,nV as vo,fMe as vp,mMe as vq,Zdt as vr,IOt as vs,$ft as vt,Oft as vu,Rft as vv,QL as vw,f$e as vx,RWe as vy,Cyt as vz,vfe as w,mSt as w0,PSt as w1,$8e as x,BE as y,bat as z};
